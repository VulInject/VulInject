struct op_sample * op_cpu_buffer_write_reserve ( struct op_entry * entry , unsigned long size ) { entry -> event = ring_buffer_lock_reserve ( op_ring_buffer , sizeof ( op_sample ) + size * sizeof ( entry -> sample -> data [ 0 ] ) ) ; entry -> sample = ring_buffer_event_data ( entry -> event ) ; entry -> size = size ; entry -> data = entry -> sample -> data ; return entry -> sample ; } 