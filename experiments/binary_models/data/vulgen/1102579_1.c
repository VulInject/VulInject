void btrfs_get_ordered_extents_for_logging ( struct btrfs_inode * inode , struct list_head * list ) { struct btrfs_ordered_inode_tree * tree = & inode -> ordered_tree ; struct rb_node * n ; ASSERT ( inode_is_locked ( & inode -> vfs_inode ) ) ; spin_lock_irq ( & tree -> lock ) ; for ( n = rb_first ( & tree -> tree ) ; n ; n = rb_next ( n ) ) { struct btrfs_ordered_extent * ordered ; ordered = rb_entry ( n , btrfs_ordered_extent , rb_node ) ; if ( test_bit ( BTRFS_ORDERED_LOGGED , & ordered -> flags ) ) { continue ; } ASSERT ( list_empty ( & ordered -> log_list ) ) ; list_add_tail ( & ordered -> log_list , list ) ; trace_btrfs_ordered_extent_lookup_for_logging ( inode , ordered ) ; } spin_unlock_irq ( & tree -> lock ) ; } 