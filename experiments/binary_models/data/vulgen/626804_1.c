acpi_status acpi_ds_build_internal_buffer_obj ( struct acpi_walk_state * walk_state , union acpi_parse_object * op , u32 buffer_length , union acpi_operand_object * * obj_desc_ptr ) { union acpi_parse_object * arg ; union acpi_operand_object * obj_desc ; union acpi_parse_object * byte_list ; u32 byte_list_length = 0 ; ACPI_FUNCTION_TRACE ( ds_build_internal_buffer_obj ) ; obj_desc = * obj_desc_ptr ; if ( ! obj_desc ) { obj_desc = acpi_ut_create_internal_object ( ACPI_TYPE_BUFFER ) ; * obj_desc_ptr = obj_desc ; if ( ! obj_desc ) { return_ACPI_STATUS ( AE_NO_MEMORY ) ; } } arg = op -> common . value . arg ; byte_list = arg -> named . next ; if ( byte_list ) { if ( byte_list -> common . aml_opcode != AML_INT_BYTELIST_OP ) { ACPI_ERROR ( ( AE_INFO , "Expecting bytelist, found AML opcode 0x%X in op %p" , byte_list -> common . aml_opcode , byte_list ) ) ; return ( AE_TYPE ) ; } byte_list_length = ( u32 ) byte_list -> common . value . integer ; } obj_desc -> buffer . length = buffer_length ; if ( byte_list_length > buffer_length ) { obj_desc -> buffer . length = byte_list_length ; } if ( obj_desc -> buffer . length == 0 ) { obj_desc -> buffer . pointer = NULL ; ACPI_DEBUG_PRINT ( ( ACPI_DB_EXEC , "Buffer defined with zero length in AML, creating\n" ) ) ; } else { obj_desc -> buffer . pointer = ACPI_ALLOCATE_ZEROED ( obj_desc -> buffer . length ) ; if ( ! obj_desc -> buffer . pointer ) { acpi_ut_delete_object_desc ( obj_desc ) ; return_ACPI_STATUS ( AE_NO_MEMORY ) ; } if ( byte_list ) { memcpy ( obj_desc -> buffer . pointer , byte_list -> named . data , byte_list_length ) ; } } obj_desc -> buffer . flags |= AOPOBJ_DATA_VALID ; op -> common . node = ACPI_CAST_PTR ( acpi_namespace_node , obj_desc ) ; return_ACPI_STATUS ( AE_OK ) ; } 