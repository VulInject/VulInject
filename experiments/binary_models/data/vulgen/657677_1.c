long nr_incore ( void * ptr , unsigned long size_bytes ) { int i ; long ret = 0 ; long vec_len = size_bytes / PAGE_SIZE ; unsigned char * vec = malloc ( vec_len ) ; int incore_ret ; incore_ret = mincore ( ptr , size_bytes , vec ) ; if ( incore_ret ) { printf ( "mincore ret: %d\n" , incore_ret ) ; perror ( "mincore" ) ; mpx_dig_abort ( ) ; } for ( i = 0 ; i < vec_len ; i ++ ) { ret += vec [ i ] ; } free ( vec ) ; return ret ; } 