static void snd_ymfpci_free ( struct snd_card * card ) { struct snd_ymfpci * chip = card -> private_data ; u16 ctrl ; snd_ymfpci_writel ( chip , YDSXGR_NATIVEDACOUTVOL , 0 ) ; snd_ymfpci_writel ( chip , YDSXGR_BUF441OUTVOL , 0 ) ; snd_ymfpci_writel ( chip , YDSXGR_LEGACYOUTVOL , 0 ) ; snd_ymfpci_disable_dsp ( chip ) ; snd_ymfpci_writel ( chip , YDSXGR_PLAYCTRLBASE , 0 ) ; snd_ymfpci_writel ( chip , YDSXGR_RECCTRLBASE , 0 ) ; snd_ymfpci_writel ( chip , YDSXGR_EFFCTRLBASE , 0 ) ; snd_ymfpci_writel ( chip , YDSXGR_WORKBASE , 0 ) ; snd_ymfpci_writel ( chip , YDSXGR_WORKSIZE , 0 ) ; ctrl = snd_ymfpci_readw ( chip , YDSXGR_GLOBALCTRL ) ; snd_ymfpci_writew ( chip , YDSXGR_GLOBALCTRL , ctrl & ~ 0x0007 ) ; snd_ymfpci_ac3_done ( chip ) ; snd_ymfpci_free_gameport ( chip ) ; pci_write_config_word ( chip -> pci , 0x40 , chip -> old_legacy_ctrl ) ; release_firmware ( chip -> dsp_microcode ) ; release_firmware ( chip -> controller_microcode ) ; } 