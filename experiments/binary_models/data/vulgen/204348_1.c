void pvrdma_qp_recv ( PVRDMADev * dev , uint32_t qp_handle ) { RdmaRmQP * qp ; PvrdmaRqWqe * wqe ; PvrdmaRing * ring ; qp = rdma_rm_get_qp ( & dev -> rdma_dev_res , qp_handle ) ; if ( unlikely ( ! qp ) ) { return ; } ring = & ( ( PvrdmaRing * ) qp -> opaque ) [ 1 ] ; wqe = ( PvrdmaRqWqe * ) pvrdma_ring_next_elem_read ( ring ) ; while ( wqe ) { CompHandlerCtx * comp_ctx ; comp_ctx = g_malloc ( sizeof ( CompHandlerCtx ) ) ; comp_ctx -> dev = dev ; comp_ctx -> cq_handle = qp -> recv_cq_handle ; comp_ctx -> cqe . wr_id = wqe -> hdr . wr_id ; comp_ctx -> cqe . qp = qp_handle ; comp_ctx -> cqe . opcode = IBV_WC_RECV ; rdma_backend_post_recv ( & dev -> backend_dev , & qp -> backend_qp , qp -> qp_type , ( ibv_sge * ) & wqe -> sge [ 0 ] , wqe -> hdr . num_sge , comp_ctx ) ; pvrdma_ring_read_inc ( ring ) ; wqe = pvrdma_ring_next_elem_read ( ring ) ; } } 