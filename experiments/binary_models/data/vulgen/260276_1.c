static int rv3032_hwmon_read_temp ( struct device * dev , long * mC ) { struct rv3032_data * rv3032 = dev_get_drvdata ( dev ) ; u8 buf [ 2 ] ; int temp , prev = 0 ; int ret ; ret = regmap_bulk_read ( rv3032 -> regmap , RV3032_TLSB , buf , sizeof ( buf ) ) ; if ( ret ) { return ret ; } temp = sign_extend32 ( buf [ 1 ] , 7 ) << 4 ; temp |= FIELD_GET ( RV3032_TLSB_TEMP , buf [ 0 ] ) ; { prev = temp ; ret = regmap_bulk_read ( rv3032 -> regmap , RV3032_TLSB , buf , sizeof ( buf ) ) ; if ( ret ) { return ret ; } temp = sign_extend32 ( buf [ 1 ] , 7 ) << 4 ; temp |= FIELD_GET ( RV3032_TLSB_TEMP , buf [ 0 ] ) ; } temp != prev ; return 0 ; } 