CURLcode curl_easy_setopt_ccsid ( CURL * curl , CURLoption tag , ... ) { CURLcode result ; va_list arg ; struct Curl_easy * data ; char * s ; char * cp ; unsigned int ccsid ; curl_off_t pfsize ; data = ( Curl_easy * ) curl ; va_start ( arg , tag ) ; switch ( tag ) { case CURLOPT_ABSTRACT_UNIX_SOCKET : case CURLOPT_ALTSVC : case CURLOPT_AWS_SIGV4 : case CURLOPT_CAINFO : case CURLOPT_CAPATH : case CURLOPT_COOKIE : case CURLOPT_COOKIEFILE : case CURLOPT_COOKIEJAR : case CURLOPT_COOKIELIST : case CURLOPT_CRLFILE : case CURLOPT_CUSTOMREQUEST : case CURLOPT_DEFAULT_PROTOCOL : case CURLOPT_DNS_SERVERS : case CURLOPT_DNS_INTERFACE : case CURLOPT_DNS_LOCAL_IP4 : case CURLOPT_DNS_LOCAL_IP6 : case CURLOPT_DOH_URL : case CURLOPT_EGDSOCKET : case CURLOPT_ENCODING : case CURLOPT_FTPPORT : case CURLOPT_FTP_ACCOUNT : case CURLOPT_FTP_ALTERNATIVE_TO_USER : case CURLOPT_HSTS : case CURLOPT_INTERFACE : case CURLOPT_ISSUERCERT : case CURLOPT_KEYPASSWD : case CURLOPT_KRBLEVEL : case CURLOPT_LOGIN_OPTIONS : case CURLOPT_MAIL_AUTH : case CURLOPT_MAIL_FROM : case CURLOPT_NETRC_FILE : case CURLOPT_NOPROXY : case CURLOPT_PASSWORD : case CURLOPT_PINNEDPUBLICKEY : case CURLOPT_PRE_PROXY : case CURLOPT_PROXY : case CURLOPT_PROXYPASSWORD : case CURLOPT_PROXYUSERNAME : case CURLOPT_PROXYUSERPWD : case CURLOPT_PROXY_CAINFO : case CURLOPT_PROXY_CAPATH : case CURLOPT_PROXY_CRLFILE : case CURLOPT_PROXY_KEYPASSWD : case CURLOPT_PROXY_PINNEDPUBLICKEY : case CURLOPT_PROXY_SERVICE_NAME : case CURLOPT_PROXY_SSLCERT : case CURLOPT_PROXY_SSLCERTTYPE : case CURLOPT_PROXY_SSLKEY : case CURLOPT_PROXY_SSLKEYTYPE : case CURLOPT_PROXY_SSL_CIPHER_LIST : case CURLOPT_PROXY_TLS13_CIPHERS : case CURLOPT_PROXY_TLSAUTH_PASSWORD : case CURLOPT_PROXY_TLSAUTH_TYPE : case CURLOPT_PROXY_TLSAUTH_USERNAME : case CURLOPT_RANDOM_FILE : case CURLOPT_RANGE : case CURLOPT_REFERER : case CURLOPT_REQUEST_TARGET : case CURLOPT_RTSP_SESSION_ID : case CURLOPT_RTSP_STREAM_URI : case CURLOPT_RTSP_TRANSPORT : case CURLOPT_SASL_AUTHZID : case CURLOPT_SERVICE_NAME : case CURLOPT_SOCKS5_GSSAPI_SERVICE : case CURLOPT_SSH_HOST_PUBLIC_KEY_MD5 : case CURLOPT_SSH_KNOWNHOSTS : case CURLOPT_SSH_PRIVATE_KEYFILE : case CURLOPT_SSH_PUBLIC_KEYFILE : case CURLOPT_SSLCERT : case CURLOPT_SSLCERTTYPE : case CURLOPT_SSLENGINE : case CURLOPT_SSLKEY : case CURLOPT_SSLKEYTYPE : case CURLOPT_SSL_CIPHER_LIST : case CURLOPT_SSL_EC_CURVES : case CURLOPT_TLS13_CIPHERS : case CURLOPT_TLSAUTH_PASSWORD : case CURLOPT_TLSAUTH_TYPE : case CURLOPT_TLSAUTH_USERNAME : case CURLOPT_UNIX_SOCKET_PATH : case CURLOPT_URL : case CURLOPT_USERAGENT : case CURLOPT_USERNAME : case CURLOPT_USERPWD : case CURLOPT_XOAUTH2_BEARER : s = va_arg ( arg , char * ) ; ccsid = va_arg ( , ) ; if ( s ) { s = dynconvert ( ASCII_CCSID , s , - 1 , ccsid ) ; if ( ! s ) { result = CURLE_OUT_OF_MEMORY ; break ; } } result = curl_easy_setopt ( curl , tag , s ) ; free ( s ) ; break ; case CURLOPT_COPYPOSTFIELDS : s = va_arg ( arg , char * ) ; ccsid = va_arg ( , ) ; pfsize = data -> set . postfieldsize ; if ( ! s || ! pfsize || ccsid == NOCONV_CCSID || ccsid == ASCII_CCSID ) { result = curl_easy_setopt ( curl , CURLOPT_COPYPOSTFIELDS , s ) ; break ; } if ( pfsize == - 1 ) { s = dynconvert ( ASCII_CCSID , s , - 1 , ccsid ) ; if ( ! s ) { result = CURLE_OUT_OF_MEMORY ; break ; } } else { size_t len ; if ( pfsize ( 0 || pfsize ) SIZE_MAX ) { result = CURLE_OUT_OF_MEMORY ; break ; } len = pfsize ; pfsize = len * MAX_CONV_EXPANSION ; if ( pfsize > SIZE_MAX ) { pfsize = SIZE_MAX ; } cp = malloc ( pfsize ) ; if ( ! cp ) { result = CURLE_OUT_OF_MEMORY ; break ; } pfsize = convert ( cp , pfsize , ASCII_CCSID , s , len , ccsid ) ; data -> set . postfieldsize = pfsize ; s = cp ; } result = curl_easy_setopt ( curl , CURLOPT_POSTFIELDS , s ) ; data -> set . str [ STRING_COPYPOSTFIELDS ] = s ; break ; case CURLOPT_ERRORBUFFER : default : result = Curl_vsetopt ( curl , tag , arg ) ; break ; } va_end ( arg ) ; return result ; } 