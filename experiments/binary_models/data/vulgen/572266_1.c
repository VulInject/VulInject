static void mem_chunk_free ( struct mem_chunk * c ) { unsigned long * d ; unsigned long r , i ; int err ; if ( cfg_get ( misctest , mt_cfg , mem_check_content ) && c -> flags & MC_F_CHECK_CONTENTS ) { err = 0 ; for ( r = 0 ; r < c -> size / sizeof ( * d ) ; r ++ ) { if ( d [ r ] != ~ ( unsigned long ) & d [ r ] ) { err ++ ; } d [ r ] = ( unsigned long ) & d [ r ] ; } for ( i = 0 ; i < c -> size % sizeof ( * d ) ; i ++ ) { if ( ( ( unsigned char * ) & d [ r ] ) [ i ] != ( unsigned char ) ~ ( ( unsigned long ) & d [ r ] >> i * 8 ) ) { err ++ ; } ( ( char * ) & d [ r ] ) [ i ] = ( unsigned char ) ( ( unsigned long ) & d [ r ] >> i * 8 ) ; } if ( err ) { ERR ( "%d errors while checking %ld bytes at %p\n" , err , c -> size , d ) ; } } shm_free ( c -> addr ) ; c -> addr = 0 ; c -> flags = 0 ; } 