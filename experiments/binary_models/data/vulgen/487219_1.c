static ulong zynqmp_align_dma_buffer ( u32 * buf , u32 len , u32 swap ) { u32 * new_buf ; u32 i ; if ( ( ulong ) buf != ALIGN ( ( ulong ) buf , ARCH_DMA_MINALIGN ) ) { new_buf = ( u32 * ) ALIGN ( ( ulong ) buf , ARCH_DMA_MINALIGN ) ; if ( new_buf > ( u32 * ) buf ) { debug ( "%s: Aligned buffer is after buffer start\n" , __func__ ) ; new_buf -= ARCH_DMA_MINALIGN ; } printf ( "%s: Align buffer at %px to %px(swap %d)\n" , __func__ , buf , new_buf , swap ) ; for ( i = 0 ; i < ( len / 4 ) ; i ++ ) { new_buf [ i ] = load_word ( & buf [ i ] , swap ) ; } } if ( ( swap != SWAP_DONE ) && ( zynqmp_firmware_version ( ) <= PMUFW_V1_0 ) ) { new_buf = buf ; printf ( "%s: Bitstream is not swapped(%d) - swap it\n" , __func__ , swap ) ; for ( i = 0 ; i < ( len / 4 ) ; i ++ ) { new_buf [ i ] = load_word ( & buf [ i ] , swap ) ; } } return ( ulong ) buf ; } 