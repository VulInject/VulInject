static void mvpp2_xdp_finish_tx ( struct mvpp2_port * port , u16 txq_id , int nxmit , int nxmit_byte ) { unsigned int thread = mvpp2_cpu_to_thread ( port -> priv , smp_processor_id ( ) ) ; struct mvpp2_tx_queue * aggr_txq ; struct mvpp2_txq_pcpu * txq_pcpu ; struct mvpp2_tx_queue * txq ; struct netdev_queue * nq ; txq = port -> txqs [ txq_id ] ; txq_pcpu = per_cpu_ptr ( txq -> pcpu , thread ) ; nq = netdev_get_tx_queue ( port -> dev , txq_id ) ; aggr_txq = & port -> priv -> aggr_txqs [ thread ] ; txq_pcpu -> reserved_num -= nxmit ; txq_pcpu -> count += nxmit ; aggr_txq -> count += nxmit ; wmb ( ) ; mvpp2_aggr_txq_pend_desc_add ( port , nxmit ) ; if ( txq_pcpu -> count >= txq_pcpu -> stop_threshold ) { netif_tx_stop_queue ( nq ) ; } } 