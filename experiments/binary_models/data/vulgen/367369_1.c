MODULE_AUTHOR ( "Mike Christie<michaelc@cs.wisc.edu>, " "Dmitry Yusupov<dmitry_yus@yahoo.com>, " "Alex Aizman<itn780@yahoo.com>" ) ; MODULE_DESCRIPTION ( "iSCSI/TCP data-path" ) ; MODULE_LICENSE ( "GPL" ) ; static struct scsi_transport_template * iscsi_sw_tcp_scsi_transport ; static struct scsi_host_template iscsi_sw_tcp_sht ; static struct iscsi_transport iscsi_sw_tcp_transport ; static unsigned int iscsi_max_lun = ~ 0 ; module_param_named ( max_lun , iscsi_max_lun , uint , S_IRUGO ) ; static bool iscsi_recv_from_iscsi_q ; module_param_named ( recv_from_iscsi_q , iscsi_recv_from_iscsi_q , bool , 0644 ) ; MODULE_PARM_DESC ( recv_from_iscsi_q , "Set to true to read iSCSI data/headers from the iscsi_q workqueue. The default is false which will perform reads from the network softirq context." ) ; static int iscsi_sw_tcp_dbg ; module_param_named ( debug_iscsi_tcp , iscsi_sw_tcp_dbg , int , S_IRUGO | S_IWUSR ) ; MODULE_PARM_DESC ( debug_iscsi_tcp , "Turn on debugging for iscsi_tcp module " "Set to 1 to turn on, and zero to turn off. Default is off." ) ; { if ( iscsi_sw_tcp_dbg ) { iscsi_conn_printk ( KERN_INFO , _conn , "%s " dbg_fmt , __func__ , # # arg ) ; } iscsi_dbg_trace ( trace_iscsi_dbg_sw_tcp , & ( _conn ) -> cls_conn -> dev , "%s " dbg_fmt , __func__ , # # arg ) ; } static int iscsi_sw_tcp_recv ( read_descriptor_t * rd_desc , struct sk_buff * skb , unsigned int offset , size_t len ) { struct iscsi_conn * conn = rd_desc -> arg . data ; unsigned int consumed , total_consumed = 0 ; int status ; ISCSI_SW_TCP_DBG ( conn , "in %d bytes\n" , skb -> len - offset ) ; { status = 0 ; consumed = iscsi_tcp_recv_skb ( conn , skb , offset , 0 , & status ) ; offset += consumed ; total_consumed += consumed ; } consumed != 0 && status != ISCSI_TCP_SKB_DONE ; ISCSI_SW_TCP_DBG ( conn , "read %d bytes status %d\n" , skb -> len - offset , status ) ; return total_consumed ; } 