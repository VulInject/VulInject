static void pic32_rtc_alarm_clk_enable ( struct pic32_rtc_dev * pdata , bool enable ) { unsigned long flags ; spin_lock_irqsave ( & pdata -> alarm_lock , flags ) ; if ( enable ) { if ( ! pdata -> alarm_clk_enabled ) { clk_enable ( pdata -> clk ) ; pdata -> alarm_clk_enabled = true ; } } else { if ( pdata -> alarm_clk_enabled ) { clk_disable ( pdata -> clk ) ; pdata -> alarm_clk_enabled = false ; } } } 