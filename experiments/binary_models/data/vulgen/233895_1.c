int dissect_h263_picture_layer ( tvbuff_t * tvb , packet_info * pinfo , proto_tree * tree , gint offset , gint length _U_ , gboolean is_rfc4626 ) { proto_tree * h263_opptype_tree = NULL ; proto_item * opptype_item = NULL ; unsigned int offset_in_bits = offset << 3 ; unsigned int saved_bit_offset ; guint64 source_format ; guint64 ufep ; guint64 picture_coding_type ; guint64 PB_frames_mode = 0 ; guint64 custom_pcf = 0 ; guint64 picture_type_code = 0 ; guint64 cpm ; guint64 pei ; if ( is_rfc4626 ) { proto_tree_add_bits_item ( tree , hf_h263_psc , tvb , offset_in_bits , 6 , ENC_BIG_ENDIAN ) ; offset_in_bits = offset_in_bits + 6 ; } else { proto_tree_add_bits_item ( tree , hf_h263_psc , tvb , offset_in_bits , 22 , ENC_BIG_ENDIAN ) ; offset_in_bits = offset_in_bits + 22 ; } proto_tree_add_bits_item ( tree , hf_h263_TR , tvb , offset_in_bits , 8 , ENC_BIG_ENDIAN ) ; offset_in_bits = offset_in_bits + 8 ; offset_in_bits = offset_in_bits + 2 ; proto_tree_add_bits_item ( tree , hf_h263_split_screen_indicator , tvb , offset_in_bits , 1 , ENC_BIG_ENDIAN ) ; offset_in_bits ++ ; proto_tree_add_bits_item ( tree , hf_h263_document_camera_indicator , tvb , offset_in_bits , 1 , ENC_BIG_ENDIAN ) ; offset_in_bits ++ ; proto_tree_add_bits_item ( tree , hf_h263_full_picture_freeze_release , tvb , offset_in_bits , 1 , ENC_BIG_ENDIAN ) ; offset_in_bits ++ ; proto_tree_add_bits_ret_val ( tree , hf_h263_source_format , tvb , offset_in_bits , 3 , & source_format , ENC_BIG_ENDIAN ) ; offset_in_bits = offset_in_bits + 3 ; if ( source_format != H263_PLUSPTYPE ) { proto_tree_add_bits_ret_val ( tree , hf_h263_payload_picture_coding_type , tvb , offset_in_bits , 1 , & picture_coding_type , ENC_BIG_ENDIAN ) ; col_append_str ( pinfo -> cinfo , COL_INFO , val_to_str ( ( guint32 ) picture_coding_type , picture_coding_type_vals , "Unknown (%u)" ) ) ; offset_in_bits ++ ; proto_tree_add_bits_item ( tree , hf_h263_opt_unres_motion_vector_mode , tvb , offset_in_bits , 1 , ENC_BIG_ENDIAN ) ; offset_in_bits ++ ; proto_tree_add_bits_item ( tree , hf_h263_syntax_based_arithmetic_coding_mode , tvb , offset_in_bits , 1 , ENC_BIG_ENDIAN ) ; offset_in_bits ++ ; proto_tree_add_bits_item ( tree , hf_h263_optional_advanced_prediction_mode , tvb , offset_in_bits , 1 , ENC_BIG_ENDIAN ) ; offset_in_bits ++ ; proto_tree_add_bits_ret_val ( tree , hf_h263_PB_frames_mode , tvb , offset_in_bits , 1 , & PB_frames_mode , ENC_BIG_ENDIAN ) ; offset_in_bits ++ ; } else { proto_tree_add_bits_ret_val ( tree , hf_h263_UFEP , tvb , offset_in_bits , 3 , & ufep , ENC_BIG_ENDIAN ) ; offset_in_bits = offset_in_bits + 3 ; if ( ufep == 1 ) { opptype_item = proto_tree_add_bits_item ( tree , hf_h263_opptype , tvb , offset_in_bits , 18 , ENC_BIG_ENDIAN ) ; h263_opptype_tree = proto_item_add_subtree ( opptype_item , ett_h263_optype ) ; proto_tree_add_bits_item ( h263_opptype_tree , hf_h263_ext_source_format , tvb , offset_in_bits , 3 , ENC_BIG_ENDIAN ) ; offset_in_bits += 3 ; proto_tree_add_bits_ret_val ( h263_opptype_tree , hf_h263_custom_pcf , tvb , offset_in_bits , 1 , & custom_pcf , ENC_BIG_ENDIAN ) ; offset_in_bits ++ ; saved_bit_offset = offset_in_bits ; offset_in_bits ++ ; offset_in_bits ++ ; offset_in_bits ++ ; offset_in_bits ++ ; offset_in_bits ++ ; offset_in_bits ++ ; offset_in_bits ++ ; offset_in_bits ++ ; offset_in_bits ++ ; offset_in_bits ++ ; offset_in_bits ++ ; offset_in_bits ++ ; offset_in_bits ++ ; offset_in_bits ++ ; proto_tree_add_bits_item ( h263_opptype_tree , hf_h263_not_dissected , tvb , saved_bit_offset , offset_in_bits - saved_bit_offset , ENC_BIG_ENDIAN ) ; } proto_tree_add_bits_ret_val ( tree , hf_h263_picture_type_code , tvb , offset_in_bits , 3 , & picture_type_code , ENC_BIG_ENDIAN ) ; offset_in_bits += 3 ; saved_bit_offset = offset_in_bits ; offset_in_bits ++ ; offset_in_bits ++ ; offset_in_bits ++ ; offset_in_bits ++ ; offset_in_bits ++ ; offset_in_bits ++ ; proto_tree_add_bits_item ( tree , hf_h263_not_dissected , tvb , saved_bit_offset , offset_in_bits - saved_bit_offset , ENC_BIG_ENDIAN ) ; proto_tree_add_bits_ret_val ( tree , hf_h263_cpm , tvb , offset_in_bits , 1 , & cpm , ENC_BIG_ENDIAN ) ; offset_in_bits ++ ; if ( cpm == 1 ) { proto_tree_add_bits_item ( tree , hf_h263_psbi , tvb , offset_in_bits , 2 , ENC_BIG_ENDIAN ) ; offset_in_bits += 2 ; } return offset_in_bits >> 3 ; } proto_tree_add_bits_item ( tree , hf_h263_pquant , tvb , offset_in_bits , 5 , ENC_BIG_ENDIAN ) ; offset_in_bits = offset_in_bits + 5 ; if ( source_format != H263_PLUSPTYPE ) { proto_tree_add_bits_ret_val ( tree , hf_h263_cpm , tvb , offset_in_bits , 1 , & cpm , ENC_BIG_ENDIAN ) ; offset_in_bits ++ ; } if ( ( PB_frames_mode == 1 ) || ( picture_type_code == 2 ) ) { if ( custom_pcf == 0 ) { proto_tree_add_bits_item ( tree , hf_h263_trb , tvb , offset_in_bits , 3 , ENC_BIG_ENDIAN ) ; offset_in_bits = offset_in_bits + 3 ; } else { proto_tree_add_bits_item ( tree , hf_h263_trb , tvb , offset_in_bits , 5 , ENC_BIG_ENDIAN ) ; offset_in_bits = offset_in_bits + 5 ; } } if ( ( PB_frames_mode == 1 ) || ( picture_type_code == 2 ) ) { offset_in_bits = offset_in_bits + 2 ; } proto_tree_add_bits_ret_val ( tree , hf_h263_pei , tvb , offset_in_bits , 1 , & pei , ENC_BIG_ENDIAN ) ; offset_in_bits ++ ; while ( pei == 1 ) { proto_tree_add_bits_item ( tree , hf_h263_psupp , tvb , offset_in_bits , 8 , ENC_BIG_ENDIAN ) ; offset_in_bits += 8 ; proto_tree_add_bits_ret_val ( tree , hf_h263_pei , tvb , offset_in_bits , 1 , & pei , ENC_BIG_ENDIAN ) ; offset_in_bits ++ ; } return offset_in_bits >> 3 ; } 