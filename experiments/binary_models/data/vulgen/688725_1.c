static void traverse_siblings_chip_id ( int cpu , bool add , int chipid ) { const struct cpumask * mask ; struct device_node * np ; int i , plen ; const __be32 * prop ; mask = add ?cpu_online_mask : cpu_present_mask ; for_each_cpu ( , ) { np = of_get_cpu_node ( i , NULL ) ; prop = of_get_property ( np , "ibm,chip-id" , & plen ) ; if ( prop && plen == sizeof ( int ) && of_read_number ( prop , 1 ) == chipid ) { if ( add ) { cpumask_set_cpu ( cpu , cpu_core_mask ( i ) ) ; cpumask_set_cpu ( i , cpu_core_mask ( cpu ) ) ; } else { cpumask_clear_cpu ( cpu , cpu_core_mask ( i ) ) ; cpumask_clear_cpu ( i , cpu_core_mask ( cpu ) ) ; } } of_node_put ( np ) ; } } 