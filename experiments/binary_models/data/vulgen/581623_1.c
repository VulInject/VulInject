void recv_igmp_report ( struct iface * iface , struct in_addr src , char * buf , u_int16_t len , u_int8_t type ) { struct igmp_hdr igmp_hdr ; struct group * group ; log_debug ( "recv_igmp_report: interface %s" , iface -> name ) ; memcpy ( & igmp_hdr , buf , sizeof ( igmp_hdr ) ) ; if ( igmp_chksum ( & igmp_hdr ) == - 1 ) { log_debug ( "recv_igmp_report: invalid chksum, interface %s" , iface -> name ) ; return ; } if ( ! IN_MULTICAST ( ntohl ( igmp_hdr . grp_addr ) ) ) { log_debug ( "recv_igmp_report: invalid group, interface %s" , iface -> name ) ; return ; } if ( ( group = group_list_add ( iface , igmp_hdr . grp_addr ) ) == NULL ) { return ; } if ( iface -> state == IF_STA_QUERIER ) { switch ( type ) { case PKT_TYPE_MEMBER_REPORTv1 : group_fsm ( group , GRP_EVT_V1_REPORT_RCVD ) ; break ; case PKT_TYPE_MEMBER_REPORTv2 : group_fsm ( group , GRP_EVT_V2_REPORT_RCVD ) ; break ; default : fatalx ( "recv_igmp_report: unknown IGMP report type" ) ; } } else { group_fsm ( group , GRP_EVT_REPORT_RCVD ) ; } } 