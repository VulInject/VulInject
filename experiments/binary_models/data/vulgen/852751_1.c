void print_peername ( BIO * bio ) { struct sockaddr_storage ss ; socklen_t slen ; char host [ NI_MAXHOST ] , port [ NI_MAXSERV ] ; int fd ; if ( BIO_get_fd ( bio , & fd ) <= 0 ) { err_ssl ( 1 , "BIO_get_fd" ) ; } slen = sizeof ( ss ) ; if ( getpeername ( fd , ( sockaddr * ) & ss , & slen ) == - 1 ) { err ( 1 , "getpeername" ) ; } if ( getnameinfo ( ( sockaddr * ) & ss , ss . ss_len , host , sizeof ( host ) , port , sizeof ( port ) , NI_NUMERICHOST | NI_NUMERICSERV ) ) { err ( 1 , 0 ) ; } printf ( "peer: %s %s\n" , host , port ) ; if ( fflush ( stdout ) != 0 ) { err ( 1 , "fflush stdout" ) ; } } 