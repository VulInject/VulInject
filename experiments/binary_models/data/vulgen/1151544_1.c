void arch_jump_label_transform ( struct jump_entry * e , enum jump_label_type type ) { union mips_instruction * insn_p ; union mips_instruction insn ; insn_p = ( mips_instruction * ) msk_isa16_mode ( e -> code ) ; BUG_ON ( ( e -> target & ~ J_RANGE_MASK ) != ( ( e -> code + 4 ) & ~ J_RANGE_MASK ) ) ; BUG_ON ( ( e -> target & J_ALIGN_MASK ) != J_ISA_BIT ) ; if ( type == JUMP_LABEL_JMP ) { insn . j_format . opcode = J_ISA_BIT ?mm_j32_op : j_op ; insn . j_format . target = e -> target >> J_RANGE_SHIFT ; } else { insn . word = 0 ; } get_online_cpus ( ) ; mutex_lock ( & text_mutex ) ; if ( IS_ENABLED ( CONFIG_CPU_MICROMIPS ) ) { insn_p -> halfword [ 0 ] = insn . word >> 16 ; insn_p -> halfword [ 1 ] = insn . word ; } else { * insn_p = insn ; } flush_icache_range ( ( unsigned long ) insn_p , ( unsigned long ) insn_p + sizeof ( * insn_p ) ) ; put_online_cpus ( ) ; } 