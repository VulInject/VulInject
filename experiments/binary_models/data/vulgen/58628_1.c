static int cx88_audio_initdev ( struct pci_dev * pci , const struct pci_device_id * pci_id ) { struct snd_card * card ; struct cx88_audio_dev * chip ; struct cx88_core * core = NULL ; int err ; if ( ! enable [ devno ] ) { ++ devno ; return ( - ENOENT ) ; } err = snd_card_new ( & pci -> dev , index [ devno ] , id [ devno ] , THIS_MODULE , sizeof ( cx88_audio_dev ) , & card ) ; if ( err < 0 ) { return err ; } card -> private_free = snd_cx88_dev_free ; err = snd_cx88_create ( card , pci , & chip , & core ) ; if ( err < 0 ) { error } err = snd_cx88_pcm ( chip , 0 , "CX88 Digital" ) ; if ( err < 0 ) { error } err = snd_ctl_add ( card , snd_ctl_new1 ( & snd_cx88_volume , chip ) ) ; if ( err < 0 ) { error } err = snd_ctl_add ( card , snd_ctl_new1 ( & snd_cx88_dac_switch , chip ) ) ; if ( err < 0 ) { error } err = snd_ctl_add ( card , snd_ctl_new1 ( & snd_cx88_source_switch , chip ) ) ; if ( err < 0 ) { error } if ( core -> sd_wm8775 ) { err = snd_ctl_add ( card , snd_ctl_new1 ( & snd_cx88_alc_switch , chip ) ) ; if ( err < 0 ) { error } } strscpy ( card -> driver , "CX88x" , sizeof ( card -> driver ) ) ; sprintf ( card -> shortname , "Conexant CX%x" , pci -> device ) ; sprintf ( card -> longname , "%s at %#llx" , card -> shortname , ( unsigned long long ) pci_resource_start ( pci , 0 ) ) ; strscpy ( card -> mixername , "CX88" , sizeof ( card -> mixername ) ) ; dprintk ( 0 , "%s/%i: ALSA support for cx2388x boards\n" , card -> driver , devno ) ; err = snd_card_register ( card ) ; if ( err < 0 ) { error } pci_set_drvdata ( pci , card ) ; devno ++ ; return 0 ; error snd_card_free ( card ) ; return err ; } 