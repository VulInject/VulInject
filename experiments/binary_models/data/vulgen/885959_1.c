int wiidebug_init ( struct wiimote_data * wdata ) { struct wiimote_debug * dbg ; unsigned long flags ; int ret = - ENOMEM ; dbg = kzalloc ( sizeof ( * dbg ) , GFP_KERNEL ) ; if ( ! dbg ) { return - ENOMEM ; } dbg -> wdata = wdata ; dbg -> eeprom = debugfs_create_file ( "eeprom" , S_IRUSR , dbg -> wdata -> hdev -> debug_dir , dbg , & wiidebug_eeprom_fops ) ; if ( ! dbg -> eeprom ) { err } dbg -> drm = debugfs_create_file ( "drm" , S_IRUSR , dbg -> wdata -> hdev -> debug_dir , dbg , & wiidebug_drm_fops ) ; if ( ! dbg -> drm ) { err_drm } spin_lock_irqsave ( & wdata -> state . lock , flags ) ; spin_unlock_irqrestore ( & wdata -> state . lock , flags ) ; return 0 ; err_drm debugfs_remove ( dbg -> eeprom ) ; err kfree ( dbg ) ; return ret ; } 