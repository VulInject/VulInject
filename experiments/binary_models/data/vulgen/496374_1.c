M_fs_error_t M_fs_file_seek_sys ( M_fs_file_t * fd , M_int64 offset , M_fs_file_seek_t from ) { off_t ret ; int whence ; if ( from == M_FS_FILE_SEEK_END ) { whence = SEEK_END ; } if ( from == M_FS_FILE_SEEK_CUR ) { whence = SEEK_CUR ; } else { whence = SEEK_SET ; } while ( offset != 0 ) { M_int64 amt_to_move = offset ; if ( sizeof ( off_t ) == 4 ) { if ( offset > M_INT32_MAX ) { amt_to_move = M_INT32_MAX ; } if ( offset < M_INT32_MIN ) { amt_to_move = M_INT32_MIN ; } } ret = lseek ( fd -> fd , ( off_t ) amt_to_move , whence ) ; if ( ret == - 1 ) { return M_fs_error_from_syserr ( errno ) ; } offset -= amt_to_move ; } return M_FS_ERROR_SUCCESS ; } 