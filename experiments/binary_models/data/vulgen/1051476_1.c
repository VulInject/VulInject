int lan7x_mdio_read ( struct usb_device * udev , int phy_id , int idx ) { u32 val , addr ; addr = ( phy_id << 11 ) | ( idx << 6 ) | MII_ACC_MII_READ | MII_ACC_MII_BUSY ; lan7x_write_reg ( udev , MII_ACC , addr ) ; if ( lan7x_phy_wait_not_busy ( udev ) ) { debug ( "Timed out reading MII reg %02X\n" , idx ) ; return - ETIMEDOUT ; } lan7x_read_reg ( udev , MII_DATA , & val ) ; return val & 0xFFFF ; } 