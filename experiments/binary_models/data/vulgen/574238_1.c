static void notify_proxy ( struct sc_context * ctx , const char * title , const char * subtitle , const char * text , const char * icon , const char * sound , const char * group ) { const char notificationproxy [ ] "/Library/OpenSC/Applications/NotificationProxy.app/Contents/MacOS/NotificationProxy" ; ; if ( child > 0 ) { int status ; if ( 0 == waitpid ( child , & status , WNOHANG ) ) { kill ( child , SIGKILL ) ; usleep ( 100 ) ; if ( 0 == waitpid ( child , & status , WNOHANG ) ) { sc_log ( ctx , "Can't kill %ld, skipping current notification" , ( long ) child ) ; return ; } } } child = fork ( ) ; switch ( child ) { case 0 : if ( 0 > execl ( notificationproxy , notificationproxy , title ?title : "" , subtitle ?subtitle : "" , text ?text : "" , icon ?icon : "" , group ?group : "" , sound ?sound : "" , ( char * ) NULL ) ) { perror ( "exec failed" ) ; exit ( 0 ) ; } break ; case - 1 : sc_log ( ctx , "failed to fork for notification" ) ; break ; default : if ( ctx ) { sc_log ( ctx , "Created %ld for notification:" , ( long ) child ) ; sc_log ( ctx , "%s %s %s %s %s %s %s" , notificationproxy , title ?title : "" , subtitle ?subtitle : "" , text ?text : "" , icon ?icon : "" , group ?group : "" , sound ?sound : "" ) ; } break ; } } 