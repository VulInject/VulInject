static void __flow_cache_shrink ( struct flow_cache * fc , struct flow_cache_percpu * fcp , unsigned int shrink_to ) { struct flow_cache_entry * fle ; struct hlist_node * tmp ; LIST_HEAD ( gc_list ) ; unsigned int deleted = 0 ; struct netns_xfrm * xfrm = container_of ( fc , netns_xfrm , flow_cache_global ) ; unsigned int i ; for ( i = 0 ; i < flow_cache_hash_size ( fc ) ; i ++ ) { unsigned int saved = 0 ; hlist_for_each_entry_safe ( , , , ) { if ( saved < shrink_to && flow_entry_valid ( fle , xfrm ) ) { saved ++ ; } else { deleted ++ ; hlist_del ( & fle -> u . hlist ) ; list_add_tail ( & fle -> u . gc_list , & gc_list ) ; } } } } 