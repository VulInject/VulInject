static unsigned short snd_via82xx_codec_read ( struct snd_ac97 * ac97 , unsigned short reg ) { struct via82xx * chip = ac97 -> private_data ; unsigned int xval , val = 0xffff ; int again = 0 ; xval = ac97 -> num << VIA_REG_AC97_CODEC_ID_SHIFT ; xval |= ac97 -> num ?VIA_REG_AC97_SECONDARY_VALID : VIA_REG_AC97_PRIMARY_VALID ; xval |= VIA_REG_AC97_READ ; xval |= ( reg & 0x7f ) << VIA_REG_AC97_CMD_SHIFT ; while ( 1 ) { snd_via82xx_codec_xwrite ( chip , xval ) ; udelay ( 20 ) ; if ( snd_via82xx_codec_valid ( chip , ac97 -> num ) >= 0 ) { udelay ( 25 ) ; val = snd_via82xx_codec_xread ( chip ) ; break ; } } return val & 0xffff ; } 