void intel_fbc_init ( struct drm_i915_private * dev_priv ) { struct intel_fbc * fbc = & dev_priv -> fbc ; enum pipe pipe ; INIT_WORK ( & fbc -> work . work , intel_fbc_work_fn ) ; INIT_WORK ( & fbc -> underrun_work , intel_fbc_underrun_work_fn ) ; mutex_init ( & fbc -> lock ) ; fbc -> enabled = false ; fbc -> active = false ; fbc -> work . scheduled = false ; if ( need_fbc_vtd_wa ( dev_priv ) ) { mkwrite_device_info ( dev_priv ) -> has_fbc = false ; } i915 . enable_fbc = intel_sanitize_fbc_option ( dev_priv ) ; DRM_DEBUG_KMS ( "Sanitized enable_fbc value: %d\n" , i915 . enable_fbc ) ; if ( ! HAS_FBC ( dev_priv ) ) { fbc -> no_fbc_reason = "unsupported by this chipset" ; return ; } for_each_pipe ( , ) { fbc -> possible_framebuffer_bits |= INTEL_FRONTBUFFER_PRIMARY ( pipe ) ; if ( fbc_on_pipe_a_only ( dev_priv ) ) { break ; } } if ( intel_fbc_hw_is_active ( dev_priv ) ) { intel_fbc_hw_deactivate ( dev_priv ) ; } } 