ipf_stack_t * ipf_find_stack ( const zoneid_t orig_zone , ipf_devstate_t * isp ) { ipf_stack_t * ifs ; boolean_t gz_stack ; zoneid_t zone ; if ( orig_zone == GLOBAL_ZONEID && ( isp -> ipfs_zoneid != IPFS_ZONE_UNSET ) ) { if ( orig_zone == isp -> ipfs_zoneid ) { gz_stack = B_FALSE ; } else { gz_stack = isp -> ipfs_gz ; } zone = isp -> ipfs_zoneid ; } else { gz_stack = B_FALSE ; zone = orig_zone ; } mutex_enter ( & ipf_stack_lock ) ; for ( ifs = ipf_stacks ; ifs != NULL ; ifs = ifs -> ifs_next ) { if ( ifs -> ifs_zone == zone && ifs -> ifs_gz_controlled == gz_stack ) { break ; } } mutex_exit ( & ipf_stack_lock ) ; return ( ifs ) ; } 