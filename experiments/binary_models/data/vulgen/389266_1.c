static ssize_t dlpar_store ( struct class * class , struct class_attribute * attr , const char * buf , size_t count ) { struct pseries_hp_errorlog * hp_elog ; struct completion hotplug_done ; char * argbuf ; char * args ; int rc ; args = argbuf = kstrdup ( buf , GFP_KERNEL ) ; hp_elog = kzalloc ( sizeof ( * hp_elog ) , GFP_KERNEL ) ; if ( ! hp_elog || ! argbuf ) { pr_info ( "Could not allocate resources for DLPAR operation\n" ) ; kfree ( argbuf ) ; kfree ( hp_elog ) ; return - ENOMEM ; } rc = dlpar_parse_resource ( & args , hp_elog ) ; if ( rc ) { dlpar_store_out } rc = dlpar_parse_action ( & args , hp_elog ) ; if ( rc ) { dlpar_store_out } rc = dlpar_parse_id_type ( & args , hp_elog ) ; if ( rc ) { dlpar_store_out } init_completion ( & hotplug_done ) ; queue_hotplug_event ( hp_elog , & hotplug_done , & rc ) ; wait_for_completion ( & hotplug_done ) ; dlpar_store_out kfree ( argbuf ) ; kfree ( hp_elog ) ; return rc ?rc : count ; } 