_cairo_recording_surface_mask ( , , , , ) { cairo_status_t status ; cairo_recording_surface_t * surface = abstract_surface ; cairo_command_mask_t * command ; cairo_composite_rectangles_t composite ; TRACE ( ( stderr , "%s: surface=%d\n" , __FUNCTION__ , surface -> base . unique_id ) ) ; status = _cairo_composite_rectangles_init_for_mask ( & composite , & surface -> base , op , source , mask , clip ) ; if ( unlikely ( status ) ) { return status ; } command = _cairo_malloc ( sizeof ( cairo_command_mask_t ) ) ; if ( unlikely ( command == NULL ) ) { status = _cairo_error ( CAIRO_STATUS_NO_MEMORY ) ; CLEANUP_COMPOSITE } status = _command_init ( surface , & command -> header , CAIRO_COMMAND_MASK , op , & composite ) ; if ( unlikely ( status ) ) { CLEANUP_COMMAND } status = _cairo_pattern_init_snapshot ( & command -> source . base , source ) ; if ( unlikely ( status ) ) { CLEANUP_COMMAND } status = _cairo_pattern_init_snapshot ( & command -> mask . base , mask ) ; if ( unlikely ( status ) ) { CLEANUP_SOURCE } status = _cairo_recording_surface_commit ( surface , & command -> header ) ; if ( unlikely ( status ) ) { CLEANUP_MASK } _cairo_recording_surface_destroy_bbtree ( surface ) ; _cairo_composite_rectangles_fini ( & composite ) ; return CAIRO_STATUS_SUCCESS ; CLEANUP_MASK _cairo_pattern_fini ( & command -> mask . base ) ; CLEANUP_SOURCE _cairo_pattern_fini ( & command -> source . base ) ; CLEANUP_COMMAND _cairo_clip_destroy ( command -> header . clip ) ; CLEANUP_COMPOSITE _cairo_composite_rectangles_fini ( & composite ) ; return status ; } 