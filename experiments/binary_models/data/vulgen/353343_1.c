static void __arch_timer_setup ( unsigned type , struct clock_event_device * clk ) { clk -> features = CLOCK_EVT_FEAT_ONESHOT ; if ( type == ARCH_TIMER_TYPE_CP15 ) { if ( arch_timer_c3stop ) { clk -> features |= CLOCK_EVT_FEAT_C3STOP ; } clk -> name = "arch_sys_timer" ; clk -> rating = 450 ; clk -> cpumask = cpumask_of ( smp_processor_id ( ) ) ; clk -> irq = arch_timer_ppi [ arch_timer_uses_ppi ] ; switch ( arch_timer_uses_ppi ) { case ARCH_TIMER_VIRT_PPI : clk -> set_state_shutdown = arch_timer_shutdown_virt ; clk -> set_state_oneshot_stopped = arch_timer_shutdown_virt ; clk -> set_next_event = arch_timer_set_next_event_virt ; break ; case ARCH_TIMER_PHYS_SECURE_PPI : case ARCH_TIMER_PHYS_NONSECURE_PPI : case ARCH_TIMER_HYP_PPI : clk -> set_state_shutdown = arch_timer_shutdown_phys ; clk -> set_state_oneshot_stopped = arch_timer_shutdown_phys ; clk -> set_next_event = arch_timer_set_next_event_phys ; break ; default : BUG ( ) ; } } else { clk -> features |= CLOCK_EVT_FEAT_DYNIRQ ; clk -> name = "arch_mem_timer" ; clk -> rating = 400 ; clk -> cpumask = cpu_all_mask ; if ( arch_timer_mem_use_virtual ) { clk -> set_state_shutdown = arch_timer_shutdown_virt_mem ; clk -> set_state_oneshot_stopped = arch_timer_shutdown_virt_mem ; clk -> set_next_event = arch_timer_set_next_event_virt_mem ; } else { clk -> set_state_shutdown = arch_timer_shutdown_phys_mem ; clk -> set_state_oneshot_stopped = arch_timer_shutdown_phys_mem ; clk -> set_next_event = arch_timer_set_next_event_phys_mem ; } } clk -> set_state_shutdown ( clk ) ; clockevents_config_and_register ( clk , arch_timer_rate , 0xf , 0x7fffffff ) ; } 