static int ftdi_gpio_init_ftx ( struct usb_serial_port * port ) { struct ftdi_private * priv = usb_get_serial_port_data ( port ) ; struct usb_serial * serial = port -> serial ; const u16 cbus_cfg_addr = 0x1a ; const u16 cbus_cfg_size = 4 ; u8 * cbus_cfg_buf ; int result ; u8 i ; cbus_cfg_buf = kmalloc ( cbus_cfg_size , GFP_KERNEL ) ; result = ftdi_read_eeprom ( serial , cbus_cfg_buf , cbus_cfg_addr , cbus_cfg_size ) ; if ( result < 0 ) { out_free } priv -> gc . ngpio = 4 ; priv -> gpio_altfunc = 0xff ; for ( i = 0 ; i < priv -> gc . ngpio ; ++ i ) { if ( cbus_cfg_buf [ i ] == FTDI_FTX_CBUS_MUX_GPIO ) { priv -> gpio_altfunc &= ~ BIT ( i ) ; } } out_free kfree ( cbus_cfg_buf ) ; return result ; } 