void ipoib_event ( struct ib_event_handler * handler , struct ib_event * record ) { struct ipoib_dev_priv * priv = container_of ( handler , ipoib_dev_priv , event_handler ) ; if ( record -> element . port_num != priv -> port ) { return ; } ipoib_dbg ( priv , "Event %d on device %s port %d\n" , record -> event , record -> device -> name , record -> element . port_num ) ; if ( record -> event == IB_EVENT_PORT_ERR || record -> event == IB_EVENT_PORT_ACTIVE || record -> event == IB_EVENT_LID_CHANGE ) { queue_work ( ipoib_workqueue , & priv -> flush_normal ) ; } if ( record -> event == IB_EVENT_PKEY_CHANGE ) { queue_work ( ipoib_workqueue , & priv -> flush_heavy ) ; } if ( record -> event == IB_EVENT_GID_CHANGE && ! test_bit ( IPOIB_FLAG_DEV_ADDR_SET , & priv -> flags ) ) { queue_work ( ipoib_workqueue , & priv -> flush_light ) ; } } 