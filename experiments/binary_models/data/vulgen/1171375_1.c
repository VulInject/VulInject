cff_index_write ( , ) { int offset_size ; int offset ; int num_elem ; int i ; cff_index_element_t * element ; uint16_t count ; unsigned char buf [ 5 ] ; cairo_status_t status ; num_elem = _cairo_array_num_elements ( index ) ; count = cpu_to_be16 ( ( uint16_t ) num_elem ) ; status = _cairo_array_append_multiple ( output , & count , 2 ) ; if ( unlikely ( status ) ) { return status ; } offset = 1 ; for ( i = 0 ; i < num_elem ; i ++ ) { element = _cairo_array_index ( index , i ) ; offset += element -> length ; } if ( offset < 0x100 ) { offset_size = 1 ; } if ( offset < 0x10000 ) { offset_size = 2 ; } if ( offset < 0x1000000 ) { offset_size = 3 ; } else { offset_size = 4 ; } buf [ 0 ] = ( unsigned char ) offset_size ; status = _cairo_array_append ( output , buf ) ; if ( unlikely ( status ) ) { return status ; } offset = 1 ; encode_index_offset ( buf , offset_size , offset ) ; status = _cairo_array_append_multiple ( output , buf , offset_size ) ; if ( unlikely ( status ) ) { return status ; } for ( i = 0 ; i < num_elem ; i ++ ) { element = _cairo_array_index ( index , i ) ; offset += element -> length ; encode_index_offset ( buf , offset_size , offset ) ; status = _cairo_array_append_multiple ( output , buf , offset_size ) ; if ( unlikely ( status ) ) { return status ; } } for ( i = 0 ; i < num_elem ; i ++ ) { element = _cairo_array_index ( index , i ) ; if ( element -> length > 0 ) { status = _cairo_array_append_multiple ( output , element -> data , element -> length ) ; } if ( unlikely ( status ) ) { return status ; } } return CAIRO_STATUS_SUCCESS ; } 