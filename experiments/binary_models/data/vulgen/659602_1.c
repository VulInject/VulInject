symbolObj * msRemoveSymbol ( symbolSetObj * symbolset , int nSymbolIndex ) { int i ; symbolObj * symbol ; if ( symbolset -> numsymbols == 1 ) { msSetError ( MS_CHILDERR , "Cannot remove a symbolset's sole symbol" , "removeSymbol()" ) ; return NULL ; } if ( nSymbolIndex < 0 || nSymbolIndex >= symbolset -> numsymbols ) { msSetError ( MS_CHILDERR , "Cannot remove symbol, invalid nSymbolIndex %d" , "removeSymbol()" , nSymbolIndex ) ; return NULL ; } else { symbol = symbolset -> symbol [ nSymbolIndex ] ; for ( i = nSymbolIndex + 1 ; i < symbolset -> numsymbols ; i ++ ) { symbolset -> symbol [ i - 1 ] = symbolset -> symbol [ i ] ; } symbolset -> symbol [ i - 1 ] = NULL ; symbolset -> numsymbols -- ; MS_REFCNT_DECR ( symbol ) ; if ( symbolset -> map ) { int l , c , s , lb ; layerObj * layer ; classObj * cl ; styleObj * style ; labelObj * label ; for ( l = 0 ; l < symbolset -> map -> numlayers ; l ++ ) { layer = GET_LAYER ( symbolset -> map , l ) ; for ( c = 0 ; c < layer -> numclasses ; c ++ ) { cl = layer -> class [ c ] ; for ( s = 0 ; s < cl -> numstyles ; s ++ ) { style = cl -> styles [ s ] ; if ( style -> symbol >= nSymbolIndex ) { -- style -> symbol ; } } for ( lb = 0 ; lb < cl -> numlabels ; lb ++ ) { label = cl -> labels [ lb ] ; for ( s = 0 ; s < label -> numstyles ; s ++ ) { style = label -> styles [ s ] ; if ( style -> symbol >= nSymbolIndex ) { -- style -> symbol ; } } } } } for ( c = 0 ; c < MS_MAX_LABEL_PRIORITY ; c ++ ) { labelCacheSlotObj * cacheslot = & ( symbolset -> map -> labelcache . slots [ c ] ) ; for ( l = 0 ; l < cacheslot -> numlabels ; l ++ ) { labelCacheMemberObj * cachePtr = & ( cacheslot -> labels [ l ] ) ; for ( lb = 0 ; lb < cachePtr -> numtextsymbols ; lb ++ ) { label = cachePtr -> textsymbols [ lb ] -> label ; for ( s = 0 ; s < label -> numstyles ; s ++ ) { style = label -> styles [ s ] ; } } } } } return symbol ; } } 