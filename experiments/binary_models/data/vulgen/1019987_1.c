static void dissect_sapdiag_dyntatom ( tvbuff_t * tvb , packet_info * pinfo , proto_tree * tree , guint32 offset , guint32 length ) { guint32 final = offset + length ; guint16 atom_length = 0 , atom_item_length = 0 ; guint8 etype = 0 , attr = 0 ; proto_item * atom = NULL , * atom_item = NULL , * atom_item_attr = NULL ; proto_tree * atom_tree = NULL , * atom_item_tree = NULL , * atom_item_attr_tree = NULL ; while ( offset < final ) { etype = tvb_get_guint8 ( tvb , offset + 4 ) ; if ( ( etype != 114 ) && ( etype != 120 ) ) { atom_length = 0 ; atom = proto_tree_add_item ( tree , hf_sapdiag_item_dynt_atom , tvb , offset , atom_length , ENC_NA ) ; atom_tree = proto_item_add_subtree ( atom , ett_sapdiag ) ; proto_item_append_text ( atom , ", Etype=%s" , val_to_str ( etype , sapdiag_item_dynt_atom_item_etype_vals , "Unknown" ) ) ; } if ( atom_tree == NULL ) { expert_add_info ( pinfo , tree , & ei_sapdiag_atom_item_malformed ) ; break ; } atom_item = proto_tree_add_item ( atom_tree , hf_sapdiag_item_dynt_atom_item , tvb , offset , tvb_get_ntohs ( tvb , offset ) , ENC_NA ) ; atom_item_tree = proto_item_add_subtree ( atom_item , ett_sapdiag ) ; atom_item_length = add_item_value_uint16 ( tvb , atom_item , atom_item_tree , hf_sapdiag_item_value , offset , "Atom Length" ) ; atom_length += atom_item_length ; proto_item_set_len ( atom_tree , atom_length ) ; offset += 2 ; atom_item_length -= 2 ; add_item_value_uint8 ( tvb , atom_item , atom_item_tree , hf_sapdiag_item_value , offset , "Dlg Flag 1" ) ; offset += 1 ; atom_item_length -= 1 ; add_item_value_uint8 ( tvb , atom_item , atom_item_tree , hf_sapdiag_item_value , offset , "Dlg Flag 2" ) ; offset += 1 ; atom_item_length -= 1 ; proto_tree_add_item ( atom_item_tree , hf_sapdiag_item_dynt_atom_item_etype , tvb , offset , 1 , ENC_BIG_ENDIAN ) ; proto_item_append_text ( atom_item , ", EType=%d" , tvb_get_guint8 ( tvb , offset ) ) ; offset += 1 ; atom_item_length -= 1 ; add_item_value_uint8 ( tvb , atom_item , atom_item_tree , hf_sapdiag_item_value , offset , "Area" ) ; offset += 1 ; atom_item_length -= 1 ; add_item_value_uint8 ( tvb , atom_item , atom_item_tree , hf_sapdiag_item_value , offset , "Block" ) ; offset += 1 ; atom_item_length -= 1 ; add_item_value_uint8 ( tvb , atom_item , atom_item_tree , hf_sapdiag_item_value , offset , "Group" ) ; offset += 1 ; atom_item_length -= 1 ; add_item_value_uint16 ( tvb , atom_item , atom_item_tree , hf_sapdiag_item_value , offset , "Row" ) ; offset += 2 ; atom_item_length -= 2 ; add_item_value_uint16 ( tvb , atom_item , atom_item_tree , hf_sapdiag_item_value , offset , "Col" ) ; offset += 2 ; atom_item_length -= 2 ; atom_item_attr = proto_tree_add_item ( atom_item_tree , hf_sapdiag_item_dynt_atom_item_attr , tvb , offset , 1 , ENC_BIG_ENDIAN ) ; atom_item_attr_tree = proto_item_add_subtree ( atom_item_attr , ett_sapdiag ) ; attr = tvb_get_guint8 ( tvb , offset ) ; proto_item_append_text ( atom_item , ", Attr=%d" , attr ) ; proto_tree_add_item ( atom_item_attr_tree , hf_sapdiag_item_dynt_atom_item_attr_DIAG_BSD_PROTECTED , tvb , offset , 1 , ENC_BIG_ENDIAN ) ; proto_tree_add_item ( atom_item_attr_tree , hf_sapdiag_item_dynt_atom_item_attr_DIAG_BSD_INVISIBLE , tvb , offset , 1 , ENC_BIG_ENDIAN ) ; proto_tree_add_item ( atom_item_attr_tree , hf_sapdiag_item_dynt_atom_item_attr_DIAG_BSD_INTENSIFY , tvb , offset , 1 , ENC_BIG_ENDIAN ) ; proto_tree_add_item ( atom_item_attr_tree , hf_sapdiag_item_dynt_atom_item_attr_DIAG_BSD_JUSTRIGHT , tvb , offset , 1 , ENC_BIG_ENDIAN ) ; proto_tree_add_item ( atom_item_attr_tree , hf_sapdiag_item_dynt_atom_item_attr_DIAG_BSD_MATCHCODE , tvb , offset , 1 , ENC_BIG_ENDIAN ) ; proto_tree_add_item ( atom_item_attr_tree , hf_sapdiag_item_dynt_atom_item_attr_DIAG_BSD_PROPFONT , tvb , offset , 1 , ENC_BIG_ENDIAN ) ; proto_tree_add_item ( atom_item_attr_tree , hf_sapdiag_item_dynt_atom_item_attr_DIAG_BSD_YES3D , tvb , offset , 1 , ENC_BIG_ENDIAN ) ; proto_tree_add_item ( atom_item_attr_tree , hf_sapdiag_item_dynt_atom_item_attr_DIAG_BSD_COMBOSTYLE , tvb , offset , 1 , ENC_BIG_ENDIAN ) ; offset += 1 ; atom_item_length -= 1 ; switch ( etype ) { case 114 : { add_item_value_string ( tvb , pinfo , atom_item , atom_item_tree , hf_sapdiag_item_value , offset , atom_item_length , "Text" , 1 ) ; proto_item_append_text ( atom , ", Text=%s" , tvb_get_string_enc ( pinfo -> pool , tvb , offset , atom_item_length , ENC_ASCII ) ) ; break ; } case 115 : { add_item_value_uint8 ( tvb , atom_item , atom_item_tree , hf_sapdiag_item_value , offset , "V Length" ) ; offset += 1 ; add_item_value_uint8 ( tvb , atom_item , atom_item_tree , hf_sapdiag_item_value , offset , "V Height" ) ; offset += 1 ; add_item_value_uint16 ( tvb , atom_item , atom_item_tree , hf_sapdiag_item_value , offset , "Function Code Offset" ) ; offset += 2 ; add_item_value_uint16 ( tvb , atom_item , atom_item_tree , hf_sapdiag_item_value , offset , "Text Offset" ) ; offset += 2 ; offset += add_item_value_stringz ( tvb , pinfo , atom_item , atom_item_tree , hf_sapdiag_item_value , offset , "Text" , 1 ) ; add_item_value_stringz ( tvb , pinfo , atom_item , atom_item_tree , hf_sapdiag_item_value , offset , "Function Code" , 1 ) ; break ; } case 116 : { add_item_value_uint8 ( tvb , atom_item , atom_item_tree , hf_sapdiag_item_value , offset , "V Length" ) ; offset += 1 ; add_item_value_uint8 ( tvb , atom_item , atom_item_tree , hf_sapdiag_item_value , offset , "V Height" ) ; offset += 1 ; add_item_value_uint8 ( tvb , atom_item , atom_item_tree , hf_sapdiag_item_value , offset , "Page Id" ) ; offset += 1 ; add_item_value_uint16 ( tvb , atom_item , atom_item_tree , hf_sapdiag_item_value , offset , "Function Code Offset" ) ; offset += 2 ; add_item_value_uint16 ( tvb , atom_item , atom_item_tree , hf_sapdiag_item_value , offset , "Text Offset" ) ; offset += 2 ; add_item_value_uint16 ( tvb , atom_item , atom_item_tree , hf_sapdiag_item_value , offset , "Id Offset" ) ; offset += 2 ; offset += add_item_value_stringz ( tvb , pinfo , atom_item , atom_item_tree , hf_sapdiag_item_value , offset , "Text" , 1 ) ; offset += add_item_value_stringz ( tvb , pinfo , atom_item , atom_item_tree , hf_sapdiag_item_value , offset , "Function Code" , 1 ) ; add_item_value_stringz ( tvb , pinfo , atom_item , atom_item_tree , hf_sapdiag_item_value , offset , "ID" , 1 ) ; break ; } case 118 : case 119 : { if ( global_sapdiag_highlight_items ) { expert_add_info_format ( pinfo , atom_item , & ei_sapdiag_atom_item_partial , "The Diag Atom is dissected partially (0x%.2x)" , etype ) ; } break ; } case 120 : { add_item_value_string ( tvb , pinfo , atom_item , atom_item_tree , hf_sapdiag_item_value , offset , atom_item_length , "XMLProp" , 1 ) ; proto_item_append_text ( atom , ", XMLProp=%s" , tvb_get_string_enc ( pinfo -> pool , tvb , offset , atom_item_length , ENC_ASCII ) ) ; break ; } case 121 : case 122 : case 123 : { add_item_value_uint8 ( tvb , atom_item , atom_item_tree , hf_sapdiag_item_value , offset , "Flag1" ) ; offset += 1 ; atom_item_length -= 1 ; add_item_value_uint8 ( tvb , atom_item , atom_item_tree , hf_sapdiag_item_value , offset , "DLen" ) ; offset += 1 ; atom_item_length -= 1 ; add_item_value_uint8 ( tvb , atom_item , atom_item_tree , hf_sapdiag_item_value , offset , "MLen" ) ; offset += 1 ; atom_item_length -= 1 ; add_item_value_uint16 ( tvb , atom_item , atom_item_tree , hf_sapdiag_item_value , offset , "MaxNrChars" ) ; offset += 2 ; atom_item_length -= 2 ; add_item_value_string ( tvb , pinfo , atom_item , atom_item_tree , hf_sapdiag_item_value , offset , atom_item_length , "Text" , 0 ) ; break ; } case 127 : { add_item_value_uint16 ( tvb , atom_item , atom_item_tree , hf_sapdiag_item_value , offset , "DRows" ) ; offset += 2 ; atom_item_length -= 2 ; add_item_value_uint16 ( tvb , atom_item , atom_item_tree , hf_sapdiag_item_value , offset , "DCols" ) ; offset += 2 ; atom_item_length -= 2 ; add_item_value_string ( tvb , pinfo , atom_item , atom_item_tree , hf_sapdiag_item_value , offset , atom_item_length , "Text" , 1 ) ; offset += atom_item_length ; break ; } case 129 : { add_item_value_uint8 ( tvb , atom_item , atom_item_tree , hf_sapdiag_item_value , offset , "Button" ) ; offset += 1 ; atom_item_length -= 1 ; add_item_value_uint16 ( tvb , atom_item , atom_item_tree , hf_sapdiag_item_value , offset , "Visible Label Length" ) ; offset += 2 ; atom_item_length -= 2 ; add_item_value_uint16 ( tvb , atom_item , atom_item_tree , hf_sapdiag_item_value , offset , "EventID Off" ) ; offset += 2 ; atom_item_length -= 2 ; add_item_value_uint8 ( tvb , atom_item , atom_item_tree , hf_sapdiag_item_value , offset , "EventID Len" ) ; offset += 1 ; atom_item_length -= 1 ; add_item_value_uint16 ( tvb , atom_item , atom_item_tree , hf_sapdiag_item_value , offset , "Text Off" ) ; offset += 2 ; atom_item_length -= 2 ; add_item_value_uint16 ( tvb , atom_item , atom_item_tree , hf_sapdiag_item_value , offset , "Text Length" ) ; offset += 2 ; atom_item_length -= 2 ; add_item_value_string ( tvb , pinfo , atom_item , atom_item_tree , hf_sapdiag_item_value , offset , atom_item_length , "Text" , 1 ) ; break ; } case 130 : case 131 : case 132 : { add_item_value_uint16 ( tvb , atom_item , atom_item_tree , hf_sapdiag_item_value , offset , "Flag1" ) ; offset += 2 ; atom_item_length -= 2 ; add_item_value_uint8 ( tvb , atom_item , atom_item_tree , hf_sapdiag_item_value , offset , "DLen" ) ; offset += 1 ; atom_item_length -= 1 ; add_item_value_uint8 ( tvb , atom_item , atom_item_tree , hf_sapdiag_item_value , offset , "MLen" ) ; offset += 1 ; atom_item_length -= 1 ; add_item_value_uint16 ( tvb , atom_item , atom_item_tree , hf_sapdiag_item_value , offset , "MaxNrChars" ) ; offset += 2 ; atom_item_length -= 2 ; add_item_value_string ( tvb , pinfo , atom_item , atom_item_tree , hf_sapdiag_item_value , offset , atom_item_length , "Text" , 0 ) ; break ; } default : if ( global_sapdiag_highlight_items ) { expert_add_info_format ( pinfo , atom_item , & ei_sapdiag_atom_item_unknown , "The Diag Atom has a unknown type that is not dissected (%d)" , etype ) ; } break ; } } } 