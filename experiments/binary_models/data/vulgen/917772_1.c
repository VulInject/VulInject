static int cert_verify_callback ( int preverify_ok , X509_STORE_CTX * ctx ) { X509 * err_cert ; int err , depth ; char * err_str ; if ( ! preverify_ok ) { err = X509_STORE_CTX_get_error ( ctx ) ; depth = X509_STORE_CTX_get_error_depth ( ctx ) ; err_cert = X509_STORE_CTX_get_current_cert ( ctx ) ; err_str = X509_NAME_oneline ( X509_get_subject_name ( err_cert ) , NULL , 0 ) ; error ( "Cert Chain verify error:num=%d:%s:depth=%d:%s" , err , X509_verify_cert_error_string ( err ) , depth , err_str ) ; } if ( ! preverify_ok && err == X509_V_ERR_DEPTH_ZERO_SELF_SIGNED_CERT ) { preverify_ok = 1 ; error ( "Self Signed Certificate Accepted as the agent was built with ACLK_SSL_ALLOW_SELF_SIGNED" ) ; } return preverify_ok ; } 