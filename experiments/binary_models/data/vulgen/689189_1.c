static enum caam_status do_keypriv_conv ( struct caam_dsa_keypair * outkey , const struct dsa_keypair * inkey , size_t l_bytes , size_t n_bytes ) { enum caam_status retstatus = CAAM_OUT_MEMORY ; size_t field_size ; DSA_TRACE ( "DSA Convert Key Private size l=%zu bytes, n=%zu bytes" , l_bytes , n_bytes ) ; retstatus = caam_calloc_buf ( & outkey -> g , l_bytes ) ; if ( retstatus != CAAM_NO_ERROR ) { return retstatus ; } field_size = crypto_bignum_num_bytes ( inkey -> g ) ; crypto_bignum_bn2bin ( inkey -> g , outkey -> g . data + l_bytes - field_size ) ; retstatus = caam_calloc_buf ( & outkey -> p , l_bytes ) ; if ( retstatus != CAAM_NO_ERROR ) { return retstatus ; } field_size = crypto_bignum_num_bytes ( inkey -> p ) ; crypto_bignum_bn2bin ( inkey -> p , outkey -> p . data + l_bytes - field_size ) ; retstatus = caam_calloc_buf ( & outkey -> q , n_bytes ) ; if ( retstatus != CAAM_NO_ERROR ) { return retstatus ; } field_size = crypto_bignum_num_bytes ( inkey -> q ) ; crypto_bignum_bn2bin ( inkey -> q , outkey -> q . data + n_bytes - field_size ) ; retstatus = caam_calloc_buf ( & outkey -> x , n_bytes ) ; if ( retstatus != CAAM_NO_ERROR ) { return retstatus ; } field_size = crypto_bignum_num_bytes ( inkey -> x ) ; crypto_bignum_bn2bin ( inkey -> x , outkey -> x . data + n_bytes - field_size ) ; cache_operation ( TEE_CACHECLEAN , outkey -> g . data , outkey -> g . length ) ; cache_operation ( TEE_CACHECLEAN , outkey -> p . data , outkey -> p . length ) ; cache_operation ( TEE_CACHECLEAN , outkey -> q . data , outkey -> q . length ) ; cache_operation ( TEE_CACHECLEAN , outkey -> x . data , outkey -> x . length ) ; return CAAM_NO_ERROR ; } 