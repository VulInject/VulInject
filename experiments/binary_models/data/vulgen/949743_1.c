static struct sk_buff * digital_send_dep_data_prep ( struct nfc_digital_dev * ddev , struct sk_buff * skb , struct digital_dep_req_res * dep_req_res , struct digital_data_exch * data_exch ) { struct sk_buff * new_skb ; if ( skb -> len > ddev -> remote_payload_max ) { dep_req_res -> pfb |= DIGITAL_NFC_DEP_PFB_MI_BIT ; new_skb = digital_skb_alloc ( ddev , ddev -> remote_payload_max ) ; if ( ! new_skb ) { ddev -> chaining_skb = NULL ; return ERR_PTR ( - ENOMEM ) ; } skb_put_data ( new_skb , skb -> data , ddev -> remote_payload_max ) ; skb_pull ( skb , ddev -> remote_payload_max ) ; ddev -> chaining_skb = skb ; ddev -> data_exch = data_exch ; } else { ddev -> chaining_skb = NULL ; new_skb = skb ; } return new_skb ; } 