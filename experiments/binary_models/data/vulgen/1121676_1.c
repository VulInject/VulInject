static int omap_hsmmc_reg_get ( struct omap_hsmmc_host * host ) { int ret ; struct mmc_host * mmc = host -> mmc ; ret = mmc_regulator_get_supply ( mmc ) ; if ( ret ) { return ret ; } if ( IS_ERR ( mmc -> supply . vqmmc ) ) { mmc -> supply . vqmmc = devm_regulator_get_optional ( host -> dev , "vmmc_aux" ) ; if ( IS_ERR ( mmc -> supply . vqmmc ) ) { ret = PTR_ERR ( mmc -> supply . vqmmc ) ; if ( ( ret != - ENODEV ) && host -> dev -> of_node ) { return ret ; } dev_dbg ( host -> dev , "unable to get vmmc_aux regulator %ld\n" , PTR_ERR ( mmc -> supply . vqmmc ) ) ; } } host -> pbias = devm_regulator_get_optional ( host -> dev , "pbias" ) ; if ( IS_ERR ( host -> pbias ) ) { ret = PTR_ERR ( host -> pbias ) ; if ( ( ret != - ENODEV ) && host -> dev -> of_node ) { dev_err ( host -> dev , "SD card detect fail? enable CONFIG_REGULATOR_PBIAS\n" ) ; return ret ; } dev_dbg ( host -> dev , "unable to get pbias regulator %ld\n" , PTR_ERR ( host -> pbias ) ) ; } ret = omap_hsmmc_disable_boot_regulators ( host ) ; if ( ret ) { return ret ; } return 0 ; } 