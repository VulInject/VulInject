gui_buffer_new_props ( , , , , , , , , ) { struct t_gui_buffer * new_buffer ; int first_buffer_creation ; if ( gui_buffer_search_by_name ( plugin_get_name ( plugin ) , name ) ) { gui_chat_printf ( NULL , _ ( "%sA buffer with same name (%s) already exists" ) , gui_chat_prefix [ GUI_CHAT_PREFIX_ERROR ] , name ) ; return NULL ; } if ( gui_buffers_count >= GUI_BUFFERS_MAX ) { gui_chat_printf ( NULL , _ ( "%sMaximum number of buffers is reached (%d)" ) , gui_chat_prefix [ GUI_CHAT_PREFIX_ERROR ] , GUI_BUFFERS_MAX ) ; return NULL ; } new_buffer = malloc ( sizeof ( * new_buffer ) ) ; if ( ! new_buffer ) { return NULL ; } new_buffer -> plugin = plugin ; new_buffer -> plugin_name_for_upgrade = NULL ; gui_layout_buffer_get_number ( gui_layout_current , plugin_get_name ( plugin ) , name , & ( new_buffer -> layout_number ) , & ( new_buffer -> layout_number_merge_order ) ) ; new_buffer -> name = strdup ( name ) ; new_buffer -> full_name = NULL ; new_buffer -> old_full_name = NULL ; gui_buffer_build_full_name ( new_buffer ) ; new_buffer -> short_name = NULL ; new_buffer -> type = GUI_BUFFER_TYPE_DEFAULT ; new_buffer -> notify = CONFIG_INTEGER ( config_look_buffer_notify_default ) ; new_buffer -> num_displayed = 0 ; new_buffer -> active = 1 ; new_buffer -> hidden = 0 ; new_buffer -> zoomed = 0 ; new_buffer -> print_hooks_enabled = 1 ; new_buffer -> day_change = 1 ; new_buffer -> clear = 1 ; new_buffer -> filter = 1 ; new_buffer -> close_callback = close_callback ; new_buffer -> close_callback_pointer = close_callback_pointer ; new_buffer -> close_callback_data = close_callback_data ; new_buffer -> closing = 0 ; new_buffer -> title = NULL ; new_buffer -> own_lines = gui_line_lines_alloc ( ) ; new_buffer -> mixed_lines = NULL ; new_buffer -> lines = new_buffer -> own_lines ; new_buffer -> next_line_id = 0 ; new_buffer -> time_for_each_line = 1 ; new_buffer -> chat_refresh_needed = 2 ; new_buffer -> nicklist = 0 ; new_buffer -> nicklist_case_sensitive = 0 ; new_buffer -> nicklist_root = NULL ; new_buffer -> nicklist_max_length = 0 ; new_buffer -> nicklist_display_groups = 1 ; new_buffer -> nicklist_count = 0 ; new_buffer -> nicklist_visible_count = 0 ; new_buffer -> nicklist_groups_count = 0 ; new_buffer -> nicklist_groups_visible_count = 0 ; new_buffer -> nicklist_nicks_count = 0 ; new_buffer -> nicklist_nicks_visible_count = 0 ; new_buffer -> nickcmp_callback = NULL ; new_buffer -> nickcmp_callback_pointer = NULL ; new_buffer -> nickcmp_callback_data = NULL ; gui_nicklist_add_group ( new_buffer , NULL , "root" , NULL , 0 ) ; new_buffer -> input = 1 ; new_buffer -> input_callback = input_callback ; new_buffer -> input_callback_pointer = input_callback_pointer ; new_buffer -> input_callback_data = input_callback_data ; new_buffer -> input_get_unknown_commands = 0 ; new_buffer -> input_get_empty = 0 ; new_buffer -> input_multiline = 0 ; gui_buffer_input_buffer_init ( new_buffer ) ; new_buffer -> input_undo_snap = malloc ( sizeof ( * ( new_buffer -> input_undo_snap ) ) ) ; ( new_buffer -> input_undo_snap ) -> data = NULL ; ( new_buffer -> input_undo_snap ) -> pos = 0 ; ( new_buffer -> input_undo_snap ) -> prev_undo = NULL ; ( new_buffer -> input_undo_snap ) -> next_undo = NULL ; new_buffer -> input_undo = NULL ; new_buffer -> last_input_undo = NULL ; new_buffer -> ptr_input_undo = NULL ; new_buffer -> input_undo_count = 0 ; new_buffer -> completion = gui_completion_new ( NULL , new_buffer ) ; new_buffer -> history = NULL ; new_buffer -> last_history = NULL ; new_buffer -> ptr_history = NULL ; new_buffer -> num_history = 0 ; new_buffer -> text_search = GUI_TEXT_SEARCH_DISABLED ; new_buffer -> text_search_exact = 0 ; new_buffer -> text_search_regex = 0 ; new_buffer -> text_search_regex_compiled = NULL ; new_buffer -> text_search_where = 0 ; new_buffer -> text_search_found = 0 ; new_buffer -> text_search_input = NULL ; new_buffer -> highlight_words = NULL ; new_buffer -> highlight_disable_regex = NULL ; new_buffer -> highlight_disable_regex_compiled = NULL ; new_buffer -> highlight_regex = NULL ; new_buffer -> highlight_regex_compiled = NULL ; new_buffer -> highlight_tags_restrict = NULL ; new_buffer -> highlight_tags_restrict_count = 0 ; new_buffer -> highlight_tags_restrict_array = NULL ; new_buffer -> highlight_tags = NULL ; new_buffer -> highlight_tags_count = 0 ; new_buffer -> highlight_tags_array = NULL ; new_buffer -> hotlist = NULL ; new_buffer -> hotlist_removed = NULL ; new_buffer -> hotlist_max_level_nicks = hashtable_new ( 32 , WEECHAT_HASHTABLE_STRING , WEECHAT_HASHTABLE_INTEGER , NULL , NULL ) ; new_buffer -> keys = NULL ; new_buffer -> last_key = NULL ; new_buffer -> keys_count = 0 ; new_buffer -> local_variables = hashtable_new ( 32 , WEECHAT_HASHTABLE_STRING , WEECHAT_HASHTABLE_STRING , NULL , NULL ) ; hashtable_set ( new_buffer -> local_variables , "plugin" , plugin_get_name ( plugin ) ) ; hashtable_set ( new_buffer -> local_variables , "name" , name ) ; first_buffer_creation = ( gui_buffers == NULL ) ; gui_buffer_insert ( new_buffer ) ; gui_buffers_count ++ ; new_buffer -> notify = gui_buffer_notify_get ( new_buffer ) ; gui_layout_window_assign_buffer ( new_buffer ) ; if ( properties ) { hashtable_map ( properties , & gui_buffer_apply_properties_cb , new_buffer ) ; } if ( first_buffer_creation ) { gui_buffer_visited_add ( new_buffer ) ; } else { ( void ) hook_signal_send ( "buffer_opened" , WEECHAT_HOOK_SIGNAL_POINTER , new_buffer ) ; } return new_buffer ; } 