void Perl_Deregister_MQ ( int serve ) { if ( -- Perl_hmq_refcnt <= 0 ) { unsigned fpflag = _control87 ( 0 , 0 ) ; init_PMWIN_entries ( ) ; * PMWIN_entries . DestroyMsgQueue ( Perl_hmq ) ; Perl_hmq = 0 ; _control87 ( fpflag , MCW_EM ) ; } if ( ( serve & REGISTERMQ_WILL_SERVE ) && Perl_hmq_servers <= 0 ) { * PMWIN_entries . CancelShutdown ( Perl_hmq , 1 ) ; } if ( ! ( serve & REGISTERMQ_IMEDIATE_UNMORPH ) && ( -- Perl_morph_refcnt <= 0 ) ) { PPIB pib ; PTIB tib ; DosGetInfoBlocks ( & tib , & pib ) ; if ( pib -> pib_ultype == 3 ) { pib -> pib_ultype = Perl_os2_initial_mode ; } else { Perl_warn_nocontext ( "Unexpected program mode %d when morphing back from PM" , pib -> pib_ultype ) ; } } } 