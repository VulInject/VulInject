int cms_msgSigDigest_add1 ( CMS_SignerInfo * dest , CMS_SignerInfo * src ) { unsigned char dig [ EVP_MAX_MD_SIZE ] ; unsigned int diglen ; if ( ! cms_msgSigDigest ( src , dig , & diglen ) ) { return 0 ; } if ( ! CMS_signed_add1_attr_by_NID ( dest , NID_id_smime_aa_msgSigDigest , V_ASN1_OCTET_STRING , dig , diglen ) ) { CMSerror ( ERR_R_MALLOC_FAILURE ) ; return 0 ; } return 1 ; } 