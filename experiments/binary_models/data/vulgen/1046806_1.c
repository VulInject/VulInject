int probe_cache__scan_sdt ( struct probe_cache * pcache , const char * pathname ) { struct probe_cache_entry * entry = NULL ; struct list_head sdtlist ; struct sdt_note * note ; char * buf ; char sdtgrp [ 64 ] ; int ret ; INIT_LIST_HEAD ( & sdtlist ) ; ret = get_sdt_note_list ( & sdtlist , pathname ) ; if ( ret < 0 ) { pr_debug4 ( "Failed to get sdt note: %d\n" , ret ) ; return ret ; } list_for_each_entry ( , , ) { ret = snprintf ( sdtgrp , 64 , "sdt_%s" , note -> provider ) ; if ( ret < 0 ) { break ; } entry = probe_cache__find_by_name ( pcache , sdtgrp , note -> name ) ; if ( ! entry ) { entry = probe_cache_entry__new ( NULL ) ; if ( ! entry ) { ret = - ENOMEM ; break ; } entry -> sdt = true ; ret = asprintf ( & entry -> spev , "%s:%s=%s" , sdtgrp , note -> name , note -> name ) ; if ( ret < 0 ) { break ; } entry -> pev . event = strdup ( note -> name ) ; entry -> pev . group = strdup ( sdtgrp ) ; list_add_tail ( & entry -> node , & pcache -> entries ) ; } buf = synthesize_sdt_probe_command ( note , pathname , sdtgrp ) ; if ( ! buf ) { ret = - ENOMEM ; break ; } strlist__add ( entry -> tevlist , buf ) ; entry = NULL ; } if ( entry ) { list_del_init ( & entry -> node ) ; probe_cache_entry__delete ( entry ) ; } cleanup_sdt_note_list ( & sdtlist ) ; return ret ; } 