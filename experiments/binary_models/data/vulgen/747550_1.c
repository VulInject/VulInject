static void rkisp1_dcrop_config ( struct rkisp1_resizer * rsz ) { struct rkisp1_device * rkisp1 = rsz -> rkisp1 ; struct v4l2_mbus_framefmt * sink_fmt ; struct v4l2_rect * sink_crop ; u32 dc_ctrl ; sink_crop = rkisp1_rsz_get_pad_crop ( rsz , NULL , RKISP1_RSZ_PAD_SINK , V4L2_SUBDEV_FORMAT_ACTIVE ) ; sink_fmt = rkisp1_rsz_get_pad_fmt ( rsz , NULL , RKISP1_RSZ_PAD_SINK , V4L2_SUBDEV_FORMAT_ACTIVE ) ; if ( sink_crop -> width == sink_fmt -> width && sink_crop -> height == sink_fmt -> height && sink_crop -> left == 0 && sink_crop -> top == 0 ) { dev_dbg ( rkisp1 -> dev , "capture %d crop disabled\n" , rsz -> id ) ; return ; } dc_ctrl = rkisp1_read ( rkisp1 , rsz -> config -> dual_crop . ctrl ) ; rkisp1_write ( rkisp1 , rsz -> config -> dual_crop . h_offset , sink_crop -> left ) ; rkisp1_write ( rkisp1 , rsz -> config -> dual_crop . v_offset , sink_crop -> top ) ; rkisp1_write ( rkisp1 , rsz -> config -> dual_crop . h_size , sink_crop -> width ) ; rkisp1_write ( rkisp1 , rsz -> config -> dual_crop . v_size , sink_crop -> height ) ; dc_ctrl |= rsz -> config -> dual_crop . yuvmode_mask ; dc_ctrl |= RKISP1_CIF_DUAL_CROP_CFG_UPD ; rkisp1_write ( rkisp1 , rsz -> config -> dual_crop . ctrl , dc_ctrl ) ; dev_dbg ( rkisp1 -> dev , "stream %d crop: %dx%d ->%dx%d\n" , rsz -> id , sink_fmt -> width , sink_fmt -> height , sink_crop -> width , sink_crop -> height ) ; } 