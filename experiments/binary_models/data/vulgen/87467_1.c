i370_ltorg ( ) { int litsize ; int lit_count = 0 ; int biggest_literal_size = 0 ; int biggest_align = 0 ; char pool_name [ 20 ] ; if ( strncmp ( now_seg -> name , ".text" , 5 ) ) { if ( i370_other_section == undefined_section ) { as_bad ( ".ltorg without prior .using in section %s" , now_seg -> name ) ; } if ( i370_other_section != now_seg ) { as_bad ( ".ltorg in section %s paired to .using in section %s" , now_seg -> name , i370_other_section -> name ) ; } } if ( ! longlong_poolP && ! word_poolP && ! short_poolP && ! byte_poolP ) { return ; } lit_count = 0 ; while ( lit_count < next_literal_pool_place ) { if ( biggest_literal_size < literals [ lit_count ] . size ) { biggest_literal_size = literals [ lit_count ] . size ; } lit_count ++ ; } if ( 1 == biggest_literal_size ) { biggest_align = 0 ; } if ( 2 == biggest_literal_size ) { biggest_align = 1 ; } if ( 4 == biggest_literal_size ) { biggest_align = 2 ; } if ( 8 == biggest_literal_size ) { biggest_align = 3 ; } else { as_bad ( "bad alignment of %d bytes in literal pool" , biggest_literal_size ) ; } if ( 0 == biggest_align ) { biggest_align = 1 ; } frag_align ( biggest_align , 0 , 0 ) ; record_alignment ( now_seg , biggest_align ) ; for ( litsize = 8 ; litsize ; litsize /= 2 ) { symbolS * current_poolP = NULL ; switch ( litsize ) { case 8 : current_poolP = longlong_poolP ; break ; case 4 : current_poolP = word_poolP ; break ; case 2 : current_poolP = short_poolP ; break ; case 1 : current_poolP = byte_poolP ; break ; default : as_bad ( "bad literal size\n" ) ; } if ( NULL == current_poolP ) { continue ; } sprintf ( pool_name , ".LITP%01d%06d" , litsize , lit_pool_num ) ; symbol_locate ( current_poolP , pool_name , now_seg , ( valueT ) frag_now_fix ( ) , frag_now ) ; symbol_table_insert ( current_poolP ) ; lit_count = 0 ; while ( lit_count < next_literal_pool_place ) { if ( litsize == literals [ lit_count ] . size ) { emit_expr ( & ( literals [ lit_count ] . exp ) , literals [ lit_count ] . size ) ; } lit_count ++ ; } } next_literal_pool_place = 0 ; longlong_poolP = NULL ; word_poolP = NULL ; short_poolP = NULL ; byte_poolP = NULL ; lit_pool_num ++ ; } 