window_menu_display_opened ( , , ) { const gchar * group_name ; const gchar * ui_path ; const gchar * display_name ; gchar * action_path ; gchar * merge_key ; guint merge_id ; gint n_screens ; gint i ; group_name = g_object_get_data ( G_OBJECT ( manager ) , "move-to-screen-group-name" ) ; ui_path = g_object_get_data ( G_OBJECT ( manager ) , "move-to-screen-ui-path" ) ; action_path = g_strdup_printf ( "%s/Move to Screen" , ui_path ) ; display_name = gdk_display_get_name ( display ) ; merge_key = g_strdup_printf ( "%s-display-merge-id" , display_name ) ; merge_id = gimp_ui_manager_new_merge_id ( manager ) ; g_object_set_data ( G_OBJECT ( manager ) , merge_key , GUINT_TO_POINTER ( merge_id ) ) ; g_free ( merge_key ) ; n_screens = gdk_display_get_n_screens ( display ) ; for ( i = 0 ; i < n_screens ; i ++ ) { GdkScreen * screen ; gchar * screen_name ; gchar * action_name ; screen = gdk_display_get_screen ( display , i ) ; screen_name = gdk_screen_make_display_name ( screen ) ; action_name = g_strdup_printf ( "%s-move-to-screen-%s" , group_name , screen_name ) ; g_free ( screen_name ) ; gimp_ui_manager_add_ui ( manager , merge_id , action_path , action_name , action_name , GTK_UI_MANAGER_MENUITEM , FALSE ) ; g_free ( action_name ) ; } g_free ( action_path ) ; g_signal_connect_object ( display , "closed" , G_CALLBACK ( window_menu_display_closed ) , G_OBJECT ( manager ) , 0 ) ; } 