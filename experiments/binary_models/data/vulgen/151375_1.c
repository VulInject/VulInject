static void axi_clkgen_calc_params ( unsigned long fin , unsigned long fout , unsigned int * best_d , unsigned int * best_m , unsigned int * best_dout ) { unsigned long d , d_min , d_max , _d_min , _d_max ; unsigned long m , m_min , m_max ; unsigned long f , dout , best_f , fvco ; fin /= 1000 ; fout /= 1000 ; best_f = ULONG_MAX ; * best_d = 0 ; * best_m = 0 ; * best_dout = 0 ; d_min = max_t ( , , 1 ) ; d_max = min_t ( , , 80 ) ; m_min = max_t ( , , 1 ) ; m_max = min_t ( , , 64 ) ; for ( m = m_min ; m <= m_max ; m ++ ) { _d_min = max ( d_min , DIV_ROUND_UP ( fin * m , fvco_max ) ) ; _d_max = min ( d_max , fin * m / fvco_min ) ; for ( d = _d_min ; d <= _d_max ; d ++ ) { fvco = fin * m / d ; dout = DIV_ROUND_CLOSEST ( fvco , fout ) ; dout = clamp_t ( , , 1 , 128 ) ; f = fvco / dout ; if ( abs ( f - fout ) < abs ( best_f - fout ) ) { best_f = f ; * best_d = d ; * best_m = m ; * best_dout = dout ; } } } } 