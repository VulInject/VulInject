int mrp_init_applicant ( struct net_device * dev , struct mrp_application * appl ) { struct mrp_applicant * app ; int err ; ASSERT_RTNL ( ) ; if ( ! rtnl_dereference ( dev -> mrp_port ) ) { err = mrp_init_port ( dev ) ; if ( err < 0 ) { err1 } } err = - ENOMEM ; app = kzalloc ( sizeof ( * app ) , GFP_KERNEL ) ; if ( ! app ) { err2 } err = dev_mc_add ( dev , appl -> group_address ) ; if ( err < 0 ) { err3 } app -> dev = dev ; app -> app = appl ; app -> mad = RB_ROOT ; skb_queue_head_init ( & app -> queue ) ; rcu_assign_pointer ( dev -> mrp_port -> applicants [ appl -> type ] , app ) ; setup_timer ( & app -> join_timer , mrp_join_timer , ( unsigned long ) app ) ; mrp_join_timer_arm ( app ) ; setup_timer ( & app -> periodic_timer , mrp_periodic_timer , ( unsigned long ) app ) ; mrp_periodic_timer_arm ( app ) ; return 0 ; err3 kfree ( app ) ; err2 mrp_release_port ( dev ) ; err1 return err ; } 