static ssize_t mb0_id_store ( struct device * dev , struct device_attribute * attr , const char * buf , size_t count ) { struct net_device * ndev = to_net_dev ( dev ) ; struct at91_priv * priv = netdev_priv ( ndev ) ; unsigned long can_id ; ssize_t ret ; int err ; rtnl_lock ( ) ; if ( ndev -> flags & IFF_UP ) { out } err = kstrtoul ( buf , 0 , & can_id ) ; if ( err ) { ret = err ; out } if ( can_id & CAN_EFF_FLAG ) { can_id &= CAN_EFF_MASK | CAN_EFF_FLAG ; } else { can_id &= CAN_SFF_MASK ; } priv -> mb0_id = can_id ; ret = count ; out rtnl_unlock ( ) ; return ret ; } 