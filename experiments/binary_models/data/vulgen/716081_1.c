int register_pci_controller ( struct pci_channel * hose ) { int i ; for ( i = 0 ; i < hose -> nr_resources ; i ++ ) { struct resource * res = hose -> resources + i ; if ( res -> flags & IORESOURCE_IO ) { if ( request_resource ( & ioport_resource , res ) < 0 ) { out } } else { if ( request_resource ( & iomem_resource , res ) < 0 ) { out } } } * hose_tail = hose ; hose_tail = & hose -> next ; if ( ! hose -> io_map_base ) { printk ( KERN_WARNING "registering PCI controller with io_map_base unset\n" ) ; } pcibios_enable_timers ( hose ) ; if ( pci_initialized ) { pcibios_scanbus ( hose ) ; mutex_unlock ( & pci_scan_mutex ) ; } return 0 ; out for ( -- i ; i >= 0 ; i -- ) { release_resource ( & hose -> resources [ i ] ) ; } printk ( KERN_WARNING "Skipping PCI bus scan due to resource conflict\n" ) ; return - 1 ; } 