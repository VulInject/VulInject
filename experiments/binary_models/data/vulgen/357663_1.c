void qla24xx_handle_adisc_event ( scsi_qla_host_t * vha , struct event_arg * ea ) { struct fc_port * fcport = ea -> fcport ; ql_dbg ( ql_dbg_disc , vha , 0x20d2 , "%s %8phC DS %d LS %d rc %d login %d|%d rscn %d|%d lid %d\n" , __func__ , fcport -> port_name , fcport -> disc_state , fcport -> fw_login_state , ea -> rc , fcport -> login_gen , ea -> sp -> gen2 , fcport -> rscn_gen , ea -> sp -> gen1 , fcport -> loop_id ) ; WARN_ONCE ( ! qla2xxx_is_valid_mbs ( ea -> data [ 0 ] ) , "mbs: %#x\n" , ea -> data [ 0 ] ) ; if ( ea -> data [ 0 ] != MBS_COMMAND_COMPLETE ) { ql_dbg ( ql_dbg_disc , vha , 0x2066 , "%s %8phC: adisc fail: post delete\n" , __func__ , ea -> fcport -> port_name ) ; fcport -> deleted = 0 ; qlt_schedule_sess_for_deletion ( ea -> fcport ) ; return ; } if ( ea -> fcport -> disc_state == DSC_DELETE_PEND ) { return ; } if ( ea -> sp -> gen2 != ea -> fcport -> login_gen ) { ql_dbg ( ql_dbg_disc , vha , 0x20d3 , "%s %8phC generation changed\n" , __func__ , ea -> fcport -> port_name ) ; return ; } if ( ea -> sp -> gen1 != ea -> fcport -> rscn_gen ) { qla_rscn_replay ( fcport ) ; qlt_schedule_sess_for_deletion ( fcport ) ; return ; } __qla24xx_handle_gpdb_event ( vha , ea ) ; } 