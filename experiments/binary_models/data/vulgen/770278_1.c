void ipcl_hash_remove_locked ( conn_t * connp , connf_t * connfp ) { ASSERT ( MUTEX_HELD ( & connfp -> connf_lock ) ) ; ASSERT ( MUTEX_HELD ( & connp -> conn_lock ) ) ; if ( ( connp ) -> conn_next != NULL ) { ( connp ) -> conn_next -> conn_prev = ( connp ) -> conn_prev ; } if ( ( connp ) -> conn_prev != NULL ) { ( connp ) -> conn_prev -> conn_next = ( connp ) -> conn_next ; } else { connfp -> connf_head = ( connp ) -> conn_next ; } ( connp ) -> conn_fanout = NULL ; ( connp ) -> conn_next = NULL ; ( connp ) -> conn_prev = NULL ; ( connp ) -> conn_flags |= IPCL_REMOVED ; ASSERT ( ( connp ) -> conn_ref == 2 ) ; ( connp ) -> conn_ref -- ; } ASSERT ( ( connp ) -> conn_fanout == NULL ) ; ASSERT ( ( connp ) -> conn_next == NULL ) ; ASSERT ( ( connp ) -> conn_prev == NULL ) ; if ( ( connfp ) -> connf_head != NULL ) { ( connfp ) -> connf_head -> conn_prev = ( connp ) ; ( connp ) -> conn_next = ( connfp ) -> connf_head ; } ( connp ) -> conn_fanout = ( connfp ) ; ( connfp ) -> connf_head = ( connp ) ; ( connp ) -> conn_flags = ( ( connp ) -> conn_flags & ~ IPCL_REMOVED ) | IPCL_CONNECTED ; CONN_INC_REF ( connp ) ; 