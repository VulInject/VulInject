static int __die ( const char * str , int err , struct pt_regs * regs ) { struct task_struct * tsk = current ; static int die_counter ; int ret ; pr_emerg ( "Internal error: %s: %x [#%d]" "\n" , , , ) ret = notify_die ( DIE_OOPS , str , regs , err , tsk -> thread . trap_no , SIGSEGV ) ; if ( ret == NOTIFY_STOP ) { return 1 ; } print_modules ( ) ; __show_regs ( regs ) ; pr_emerg ( "Process %.*s (pid: %d, stack limit = 0x%p)\n" , TASK_COMM_LEN , tsk -> comm , task_pid_nr ( tsk ) , end_of_stack ( tsk ) ) ; if ( ! user_mode ( regs ) || in_interrupt ( ) ) { dump_mem ( KERN_EMERG , "Stack: " , regs -> ARM_sp , ALIGN ( regs -> ARM_sp - THREAD_SIZE , THREAD_ALIGN ) + THREAD_SIZE ) ; dump_backtrace ( regs , tsk , KERN_EMERG ) ; dump_instr ( KERN_EMERG , regs ) ; } return 0 ; } 