int pl_load_db ( void ) { int i , nr_rows ; int nrcols ; str pipeid ; int limit ; str algorithm ; db1_res_t * res ; db_val_t * values ; db_row_t * rows ; db_key_t query_cols [ 3 ] { & rlp_pipeid_col & rlp_limit_col & rlp_algorithm_col } ; ; nrcols = 3 ; if ( pl_db_handle == NULL ) { LM_ERR ( "invalid DB handler\n" ) ; return - 1 ; } if ( pl_dbf . use_table ( pl_db_handle , & rlp_table_name ) < 0 ) { LM_ERR ( "error in use_table\n" ) ; return - 1 ; } if ( pl_dbf . query ( pl_db_handle , 0 , 0 , 0 , query_cols , 0 , nrcols , 0 , & res ) < 0 ) { LM_ERR ( "error while querying database\n" ) ; return - 1 ; } nr_rows = RES_ROW_N ( res ) ; rows = RES_ROWS ( res ) ; for ( i = 0 ; i < nr_rows ; i ++ ) { values = ROW_VALUES ( rows + i ) ; pipeid . s = VAL_STR ( values ) . s ; pipeid . len = strlen ( pipeid . s ) ; limit = VAL_INT ( values + 1 ) ; algorithm . s = VAL_STR ( values + 2 ) . s ; algorithm . len = strlen ( algorithm . s ) ; if ( pl_pipe_add ( & pipeid , & algorithm , limit ) != 0 ) { error } } pl_dbf . free_result ( pl_db_handle , res ) ; pl_print_pipes ( ) ; return 0 ; error pl_dbf . free_result ( pl_db_handle , res ) ; return - 1 ; } 