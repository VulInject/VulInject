npi_status_t npi_fflp_cfg_ip_cls_flow_key_get ( npi_handle_t handle , tcam_class_t l3_class , flow_key_cfg_t * cfg ) { uint64_t offset ; flow_class_key_ip_t flow_cfg_reg ; ASSERT ( TCAM_L3_CLASS_VALID ( l3_class ) ) ; if ( ! ( TCAM_L3_CLASS_VALID ( l3_class ) ) ) { NPI_ERROR_MSG ( ( handle . function , NPI_ERR_CTL , " npi_fflp_cfg_ip_cls_flow_key:" " Invalid class %d \n" , l3_class ) ) ; return ( NPI_FFLP_TCAM_CLASS_INVALID ) ; } offset = GET_FLOW_KEY_OFFSET ( l3_class ) ; cfg -> use_proto = 0 ; cfg -> use_dport = 0 ; cfg -> use_sport = 0 ; cfg -> ip_opts_exist = 0 ; cfg -> use_daddr = 0 ; cfg -> use_saddr = 0 ; cfg -> use_l2da = 0 ; cfg -> use_portnum = 0 ; REG_PIO_READ64 ( handle , offset , & flow_cfg_reg . value ) ; if ( flow_cfg_reg . bits . ldw . proto ) { cfg -> use_proto = 1 ; } if ( flow_cfg_reg . bits . ldw . l4_1 == 2 ) { cfg -> use_dport = 1 ; } if ( flow_cfg_reg . bits . ldw . l4_1 == 3 ) { cfg -> use_dport = 1 ; cfg -> ip_opts_exist = 1 ; } if ( flow_cfg_reg . bits . ldw . l4_0 == 2 ) { cfg -> use_sport = 1 ; } if ( flow_cfg_reg . bits . ldw . l4_0 == 3 ) { cfg -> use_sport = 1 ; cfg -> ip_opts_exist = 1 ; } if ( flow_cfg_reg . bits . ldw . ipda ) { cfg -> use_daddr = 1 ; } if ( flow_cfg_reg . bits . ldw . ipsa ) { cfg -> use_saddr = 1 ; } if ( flow_cfg_reg . bits . ldw . vlan ) { cfg -> use_vlan = 1 ; } if ( flow_cfg_reg . bits . ldw . l2da ) { cfg -> use_l2da = 1 ; } if ( flow_cfg_reg . bits . ldw . port ) { cfg -> use_portnum = 1 ; } NPI_DEBUG_MSG ( ( handle . function , NPI_FFLP_CTL , " npi_fflp_cfg_ip_cls_flow_get %llx \n" , flow_cfg_reg . value ) ) ; return ( NPI_SUCCESS ) ; } 