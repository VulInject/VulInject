uint fec_ptp_check_pps_event ( struct fec_enet_private * fep ) { u32 val ; struct ptp_clock_event event ; val = readl ( fep -> hwp + FEC_TCSR ( channel ) ) ; if ( val & FEC_T_TF_MASK ) { writel ( fep -> next_counter , fep -> hwp + FEC_TCCR ( channel ) ) ; { writel ( val , fep -> hwp + FEC_TCSR ( channel ) ) ; } readl ( fep -> hwp + FEC_TCSR ( channel ) ) & FEC_T_TF_MASK ; fep -> next_counter = ( fep -> next_counter + fep -> reload_period ) & fep -> cc . mask ; event . type = PTP_CLOCK_PPS ; ptp_clock_event ( fep -> ptp_clock , & event ) ; return 1 ; } return 0 ; } 