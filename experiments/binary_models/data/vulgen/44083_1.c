static void rtl8225_rf_set_tx_power ( struct ieee80211_hw * dev , int channel ) { struct rtl8180_priv * priv = dev -> priv ; u8 cck_power , ofdm_power ; const u8 * tmp ; u32 reg ; int i ; cck_power = priv -> channels [ channel - 1 ] . hw_value & 0xFF ; ofdm_power = priv -> channels [ channel - 1 ] . hw_value >> 8 ; cck_power = min ( cck_power , ( u8 ) 35 ) ; ofdm_power = min ( ofdm_power , ( u8 ) 35 ) ; rtl818x_iowrite8 ( priv , & priv -> map -> TX_GAIN_CCK , rtl8225_tx_gain_cck_ofdm [ cck_power / 6 ] >> 1 ) ; if ( channel == 14 ) { tmp = & rtl8225_tx_power_cck_ch14 [ ( cck_power % 6 ) * 8 ] ; } else { tmp = & rtl8225_tx_power_cck [ ( cck_power % 6 ) * 8 ] ; } for ( i = 0 ; i < 8 ; i ++ ) { rtl8225_write_phy_cck ( dev , 0x44 + i , * tmp ++ ) ; } msleep ( 1 ) ; rtl818x_iowrite8 ( priv , & priv -> map -> EEPROM_CMD , RTL818X_EEPROM_CMD_CONFIG ) ; rtl818x_iowrite8 ( priv , & priv -> map -> CONFIG3 , reg | RTL818X_CONFIG3_ANAPARAM_WRITE ) ; rtl818x_iowrite32 ( priv , & priv -> map -> ANAPARAM2 , RTL8225_ANAPARAM2_ON ) ; rtl818x_iowrite8 ( priv , & priv -> map -> CONFIG3 , reg & ~ RTL818X_CONFIG3_ANAPARAM_WRITE ) ; rtl818x_iowrite8 ( priv , & priv -> map -> EEPROM_CMD , RTL818X_EEPROM_CMD_NORMAL ) ; rtl818x_iowrite8 ( priv , & priv -> map -> TX_GAIN_OFDM , rtl8225_tx_gain_cck_ofdm [ ofdm_power / 6 ] >> 1 ) ; tmp = & rtl8225_tx_power_ofdm [ ofdm_power % 6 ] ; rtl8225_write_phy_ofdm ( dev , 5 , * tmp ) ; rtl8225_write_phy_ofdm ( dev , 7 , * tmp ) ; msleep ( 1 ) ; } 