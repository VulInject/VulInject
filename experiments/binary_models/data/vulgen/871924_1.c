static void show_dents ( vnode_t * dvp , offset_t * offp , char * buf , int cnt ) { char time_buf [ 40 ] ; struct stat64 st ; vnode_t * vp ; char * p ; dirent_t * d ; offset_t offset = ( offset_t ) - 1L ; int error ; uint_t mode ; char type ; p = buf ; while ( p < ( buf + cnt ) ) { d = ( dirent_t * ) ( void * ) p ; p += d -> d_reclen ; offset = d -> d_off ; error = fake_lookup ( dvp , d -> d_name , & vp ) ; if ( error != 0 ) { fprintf ( stderr , "%s: lookup error=%d\n" , d -> d_name , error ) ; continue ; } vn_rele ( vp ) ; if ( error != 0 ) { fprintf ( stderr , "%s: stat error=%d\n" , d -> d_name , error ) ; continue ; } if ( S_ISDIR ( st . st_mode ) ) { type = 'd' ; } if ( S_ISREG ( st . st_mode ) ) { type = ' ' ; } else { type = '?' ; } mode = st . st_mode & 0777 ; ( void ) strftime ( time_buf , sizeof ( time_buf ) , "%b %e %T %Y" , localtime ( & st . st_mtime ) ) ; printf ( "%c 0%3o %9" PRIu64 "  %s  %s\n" , type , mode , ( uint64_t ) st . st_size , time_buf , d -> d_name ) ; } * offp = offset ; } 