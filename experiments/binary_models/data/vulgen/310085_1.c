static struct sync_file_info * sync_file_info ( int fd ) { struct sync_file_info * info ; struct sync_fence_info * fence_info ; int err , num_fences ; info = calloc ( 1 , sizeof ( * info ) ) ; if ( info == NULL ) { return NULL ; } err = ioctl ( fd , SYNC_IOC_FILE_INFO , info ) ; if ( err < 0 ) { return NULL ; } num_fences = info -> num_fences ; if ( num_fences ) { info -> flags = 0 ; info -> num_fences = num_fences ; fence_info = calloc ( num_fences , sizeof ( * fence_info ) ) ; if ( ! fence_info ) { free ( info ) ; return NULL ; } info -> sync_fence_info = ( uint64_t ) ( unsigned long ) fence_info ; err = ioctl ( fd , SYNC_IOC_FILE_INFO , info ) ; if ( err < 0 ) { free ( fence_info ) ; free ( info ) ; return NULL ; } } return info ; } 