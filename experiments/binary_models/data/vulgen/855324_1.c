static int compress_stream_write__deflated ( struct compress_stream * stream , const char * buffer , size_t len ) { size_t idx = 0 ; while ( len > 0 ) { size_t chunkremain , chunksize ; if ( stream -> current_chunk == 0 ) { stream -> current = buffer [ idx ] ; } chunkremain = CHUNKSIZE - stream -> current_chunk ; stream -> current_chunk += chunksize ; len -= chunksize ; idx += chunksize ; if ( stream -> current_chunk == CHUNKSIZE ) { cl_git_pass ( stream -> next -> write ( stream -> next , & stream -> current , 1 ) ) ; stream -> current_chunk = 0 ; } } return 0 ; } 