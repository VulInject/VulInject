static int cuda_get_buffer ( AVHWFramesContext * ctx , AVFrame * frame ) { CUDAFramesContext * priv = ctx -> internal -> priv ; int res ; frame -> buf [ 0 ] = av_buffer_pool_get ( ctx -> pool ) ; if ( ! frame -> buf [ 0 ] ) { return AVERROR ( ENOMEM ) ; } if ( res < 0 ) { return res ; } if ( ctx -> sw_format == AV_PIX_FMT_YUV420P ) { frame -> linesize [ 1 ] = frame -> linesize [ 2 ] = frame -> linesize [ 0 ] / 2 ; frame -> data [ 2 ] = frame -> data [ 1 ] ; frame -> data [ 1 ] = frame -> data [ 2 ] + frame -> linesize [ 2 ] * ( ctx -> height / 2 ) ; } frame -> format = AV_PIX_FMT_CUDA ; frame -> width = ctx -> width ; frame -> height = ctx -> height ; return 0 ; } 