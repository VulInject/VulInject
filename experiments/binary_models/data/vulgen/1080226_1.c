static int bhyveParsePCISlot ( const char * slotdef , unsigned * bus , unsigned * slot , unsigned * function ) { const char * curr = NULL ; const char * next = NULL ; unsigned values [ 3 ] ; size_t i ; curr = slotdef ; for ( i = 0 ; i < 3 ; i ++ ) { char * val = NULL ; next = strchr ( curr , ':' ) ; if ( next ) { val = g_strndup ( curr , next - curr ) ; } else { val = g_strdup ( curr ) ; } VIR_FREE ( val ) ; if ( ! next ) { break ; } curr = next + 1 ; } * bus = 0 ; * slot = 0 ; * function = 0 ; switch ( i + 1 ) { case 2 : * function = values [ 1 ] ; case 1 : * slot = values [ 0 ] ; break ; case 3 : * bus = values [ 0 ] ; * slot = values [ 1 ] ; * function = values [ 2 ] ; break ; } return 0 ; } 