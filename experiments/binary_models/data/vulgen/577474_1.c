START_TEST ( ) { job * pjob = ( job * ) calloc ( 1 , sizeof ( job ) ) ; sprintf ( pjob -> ji_qs . ji_jobid , "1.napali" ) ; int found_one = 1 ; fail_unless ( mother_superior_cleanup ( pjob , 10 , & found_one ) == false ) ; pjob -> ji_qs . ji_substate = JOB_SUBSTATE_EXIT_WAIT ; fail_unless ( mother_superior_cleanup ( pjob , 1 , & found_one ) == true ) ; exiting_job_list . clear ( ) ; pjob -> ji_numnodes = 2 ; pjob -> ji_hosts [ 1 ] . hn_sister = SISTER_KILLDONE ; pjob -> ji_flags = MOM_EPILOGUE_RUN ; fail_unless ( mother_superior_cleanup ( pjob , 1 , & found_one ) == true ) ; fail_unless ( exiting_job_list . size ( ) == 1 ) ; fail_unless ( exiting_job_list [ 0 ] . jobid == "1.napali" ) ; called_fork_me = 0 ; pjob -> ji_flags = 0 ; fail_unless ( mother_superior_cleanup ( pjob , 1 , & found_one ) == true ) ; fail_unless ( called_open_socket == 1 ) ; fail_unless ( called_fork_me == 1 ) ; } END_TEST Suite * catch_child_suite ( void ) { Suite * s = suite_create ( "catch_child methods" ) ; TCase * tc_core = tcase_create ( "Core" ) ; tcase_add_test ( tc_core , test_catch_child_1 ) ; tcase_add_test ( tc_core , obit_reply_test ) ; tcase_add_test ( tc_core , test_eligible_for_exiting_check ) ; tcase_add_test ( tc_core , test_jobs_main_process ) ; tcase_add_test ( tc_core , test_non_mother_superior_cleanup ) ; tcase_add_test ( tc_core , test_mother_superior_cleanup ) ; s = suite_create ( "get_node_tests" ) ; tcase_add_test ( tc_core , test_get_node_1 ) ; tcase_add_test ( tc_core , test_get_node_2 ) ; tcase_add_test ( tc_core , test_get_node_3 ) ; suite_add_tcase ( s , tc_core ) ; return s ; } int main ( void ) { int number_failed = 0 ; SRunner * sr = NULL ; sr = srunner_create ( catch_child_suite ( ) ) ; srunner_set_log ( sr , "catch_child_suite.log" ) ; srunner_run_all ( sr , CK_NORMAL ) ; number_failed = srunner_ntests_failed ( sr ) ; return number_failed ; } 