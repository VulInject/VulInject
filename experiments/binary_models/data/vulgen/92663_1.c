static int stm32_hash_init_fallback ( struct crypto_tfm * tfm ) { struct stm32_hash_ctx * ctx = crypto_tfm_ctx ( tfm ) ; struct stm32_hash_dev * hdev = stm32_hash_find_dev ( ctx ) ; const char * name = crypto_tfm_alg_name ( tfm ) ; struct crypto_shash * xtfm ; xtfm = crypto_alloc_shash ( name , 0 , CRYPTO_ALG_NEED_FALLBACK ) ; if ( IS_ERR ( xtfm ) ) { dev_err ( hdev -> dev , "failed to allocate %s fallback\n" , name ) ; return PTR_ERR ( xtfm ) ; } dev_info ( hdev -> dev , "allocated %s fallback\n" , name ) ; ctx -> xtfm = xtfm ; return 0 ; } 