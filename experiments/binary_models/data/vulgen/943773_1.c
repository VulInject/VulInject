mpfr_pow_is_exact ( , , , , ) { mpz_t a , c ; mpfr_exp_t d , b , i ; int res ; MPFR_ASSERTD ( ! MPFR_IS_SINGULAR ( y ) ) ; MPFR_ASSERTD ( ! MPFR_IS_SINGULAR ( x ) ) ; MPFR_ASSERTD ( ! mpfr_integer_p ( y ) ) ; MPFR_ASSERTD ( MPFR_IS_POS ( x ) ) ; if ( MPFR_IS_NEG ( y ) ) { return 0 ; } mpz_init ( c ) ; d = mpfr_get_z_2exp ( c , y ) ; i = mpz_scan1 ( c , 0 ) ; mpz_fdiv_q_2exp ( c , c , i ) ; d += i ; MPFR_ASSERTD ( d < 0 ) ; mpz_init ( a ) ; b = mpfr_get_z_2exp ( a , x ) ; i = mpz_scan1 ( a , 0 ) ; mpz_fdiv_q_2exp ( a , a , i ) ; b += i ; for ( res = 1 ; d != 0 ; d ++ ) { if ( b % 2 != 0 ) { mpz_mul_2exp ( a , a , 1 ) ; b -- ; } MPFR_ASSERTD ( ( b % 2 ) == 0 ) ; if ( ! mpz_perfect_square_p ( a ) ) { res = 0 ; end } mpz_sqrt ( a , a ) ; b = b / 2 ; } { mpfr_t tmp ; mpfr_prec_t p ; MPFR_MPZ_SIZEINBASE2 ( p , a ) ; mpfr_init2 ( tmp , p ) ; res = mpfr_set_z ( tmp , a , MPFR_RNDN ) ; MPFR_ASSERTD ( res == 0 ) ; res = mpfr_mul_2si ( tmp , tmp , b , MPFR_RNDN ) ; MPFR_ASSERTD ( res == 0 ) ; * inexact = mpfr_pow_z ( z , tmp , c , rnd_mode ) ; mpfr_clear ( tmp ) ; res = 1 ; } end mpz_clear ( a ) ; mpz_clear ( c ) ; return res ; } 