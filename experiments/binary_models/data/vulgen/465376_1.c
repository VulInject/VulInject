void rdbReportError ( int corruption_error , int linenum , char * reason , ... ) { va_list ap ; char msg [ 1024 ] ; int len ; va_start ( ap , reason ) ; vsnprintf ( msg + len , sizeof ( msg ) - len , reason , ap ) ; va_end ( ap ) ; if ( isRestoreContext ( ) ) { serverLog ( LL_VERBOSE , "%s" , msg ) ; return ; } if ( rdbCheckMode ) { rdbCheckError ( "%s" , msg ) ; } if ( rdbFileBeingLoaded ) { serverLog ( LL_WARNING , "%s" , msg ) ; char * argv [ 2 ] { "" rdbFileBeingLoaded } ; ; redis_check_rdb_main ( 2 , argv , NULL ) ; } if ( corruption_error ) { serverLog ( LL_WARNING , "%s. Failure loading rdb format" , msg ) ; } else { serverLog ( LL_WARNING , "%s. Failure loading rdb format from socket, assuming connection error, resuming operation." , msg ) ; return ; } serverLog ( LL_WARNING , "Terminating server after rdb file reading failure." ) ; exit ( 1 ) ; } 