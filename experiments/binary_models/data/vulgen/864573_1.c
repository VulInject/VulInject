static u64 ptp_cavium_clock_get ( void ) { struct pci_dev * pdev ; void __iomem * base ; u64 ret = CLOCK_BASE_RATE * 16 ; pdev = pci_get_device ( PCI_VENDOR_ID_CAVIUM , PCI_DEVICE_ID_CAVIUM_RST , NULL ) ; base = pci_ioremap_bar ( pdev , PCI_RST_BAR_NO ) ; if ( ! base ) { error_put_pdev } ret = CLOCK_BASE_RATE * ( ( readq ( base + RST_BOOT ) >> 33 ) & 0x3f ) ; iounmap ( base ) ; error_put_pdev pci_dev_put ( pdev ) ; error return ret ; } 