static int gfx_v6_0_ring_test_ring ( struct amdgpu_ring * ring ) { struct amdgpu_device * adev = ring -> adev ; uint32_t tmp = 0 ; unsigned i ; int r ; WREG32 ( mmSCRATCH_REG0 , 0xCAFEDEAD ) ; r = amdgpu_ring_alloc ( ring , 3 ) ; if ( r ) { return r ; } amdgpu_ring_write ( ring , PACKET3 ( PACKET3_SET_CONFIG_REG , 1 ) ) ; amdgpu_ring_write ( ring , mmSCRATCH_REG0 - PACKET3_SET_CONFIG_REG_START ) ; amdgpu_ring_write ( ring , 0xDEADBEEF ) ; amdgpu_ring_commit ( ring ) ; for ( i = 0 ; i < adev -> usec_timeout ; i ++ ) { tmp = RREG32 ( mmSCRATCH_REG0 ) ; if ( tmp == 0xDEADBEEF ) { break ; } udelay ( 1 ) ; } return r ; } 