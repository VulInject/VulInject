static int s3c64xx_spi_remove ( struct platform_device * pdev ) { struct spi_master * master = platform_get_drvdata ( pdev ) ; struct s3c64xx_spi_driver_data * sdd = spi_master_get_devdata ( master ) ; pm_runtime_get_sync ( & pdev -> dev ) ; writel ( 0 , sdd -> regs + S3C64XX_SPI_INT_EN ) ; if ( ! is_polling ( sdd ) ) { dma_release_channel ( sdd -> rx_dma . ch ) ; dma_release_channel ( sdd -> tx_dma . ch ) ; } clk_disable_unprepare ( sdd -> ioclk ) ; clk_disable_unprepare ( sdd -> src_clk ) ; clk_disable_unprepare ( sdd -> clk ) ; pm_runtime_put_noidle ( & pdev -> dev ) ; pm_runtime_disable ( & pdev -> dev ) ; return 0 ; } 