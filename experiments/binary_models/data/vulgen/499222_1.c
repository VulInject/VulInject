void throwspell ( void ) { double inflict ; double dtemp ; int ch ; inflict = 0 ; mvaddstr ( 7 , 0 , "\n\n" ) ; if ( Player . p_magiclvl >= ML_ALLORNOTHING ) { mvaddstr ( 7 , 0 , "1:All or Nothing  " ) ; } if ( Player . p_magiclvl >= ML_MAGICBOLT ) { addstr ( "2:Magic Bolt  " ) ; } if ( Player . p_magiclvl >= ML_FORCEFIELD ) { addstr ( "3:Force Field  " ) ; } if ( Player . p_magiclvl >= ML_XFORM ) { addstr ( "4:Transform  " ) ; } if ( Player . p_magiclvl >= ML_INCRMIGHT ) { addstr ( "5:Increase Might\n" ) ; } if ( Player . p_magiclvl >= ML_INVISIBLE ) { mvaddstr ( 8 , 0 , "6:Invisibility  " ) ; } if ( Player . p_magiclvl >= ML_XPORT ) { addstr ( "7:Transport  " ) ; } if ( Player . p_magiclvl >= ML_PARALYZE ) { addstr ( "8:Paralyze  " ) ; } if ( Player . p_specialtype >= SC_COUNCIL ) { addstr ( "9:Specify" ) ; } mvaddstr ( 4 , 0 , "Spell ? " ) ; ch = getanswer ( " " , TRUE ) ; mvaddstr ( 7 , 0 , "\n\n" ) ; if ( Curmonster . m_type == SM_MORGOTH && ch != '3' ) { ILLSPELL ( ) ; } else { switch ( ch ) { case '1' : if ( drandom ( ) < 0.25 ) { inflict = Curmonster . m_energy * 1.01 + 1.0 ; if ( Curmonster . m_type == SM_DARKLORD ) { inflict *= 0.9 ; } } else { Curmonster . m_o_strength = Curmonster . m_strength *= 2.0 ; Curmonster . m_maxspeed *= 2.0 ; Curmonster . m_o_speed *= 2.0 ; Curmonster . m_speed = MAX ( 1.0 , Curmonster . m_speed * 2.0 ) ; } hitmonster ( inflict ) ; break ; case '2' : if ( Player . p_magiclvl < ML_MAGICBOLT ) { ILLSPELL ( ) ; } else { { mvaddstr ( 4 , 0 , "How much mana for bolt? " ) ; dtemp = floor ( infloat ( ) ) ; } dtemp ( 0.0 || dtemp ) Player . p_mana ; Player . p_mana -= dtemp ; if ( Curmonster . m_type == SM_DARKLORD ) { inflict = 0.0 ; } else { inflict = dtemp * ROLL ( 15.0 , sqrt ( Player . p_magiclvl / 3.0 + 1.0 ) ) ; } mvaddstr ( 5 , 0 , "Magic Bolt fired!\n" ) ; hitmonster ( inflict ) ; } break ; case '3' : if ( Player . p_magiclvl < ML_FORCEFIELD ) { ILLSPELL ( ) ; } if ( Player . p_mana < MM_FORCEFIELD ) { NOMANA ( ) ; } else { Player . p_mana -= MM_FORCEFIELD ; Shield = ( Player . p_maxenergy + Player . p_shield ) * 4.2 + 45.0 ; mvaddstr ( 5 , 0 , "Force Field up.\n" ) ; } break ; case '4' : if ( Player . p_magiclvl < ML_XFORM ) { ILLSPELL ( ) ; } if ( Player . p_mana < MM_XFORM ) { NOMANA ( ) ; } else { Player . p_mana -= MM_XFORM ; Whichmonster = ( int ) ROLL ( 0.0 , 100.0 ) ; longjmp ( Fightenv , 1 ) ; } break ; case '5' : if ( Player . p_magiclvl < ML_INCRMIGHT ) { ILLSPELL ( ) ; } if ( Player . p_mana < MM_INCRMIGHT ) { NOMANA ( ) ; } else { Player . p_mana -= MM_INCRMIGHT ; Player . p_might += ( 1.2 * ( Player . p_strength + Player . p_sword ) + 5.0 - Player . p_might ) / 2.0 ; mvprintw ( 5 , 0 , "New strength:  %.0f\n" , Player . p_might ) ; } break ; case '6' : if ( Player . p_magiclvl < ML_INVISIBLE ) { ILLSPELL ( ) ; } if ( Player . p_mana < MM_INVISIBLE ) { NOMANA ( ) ; } else { Player . p_mana -= MM_INVISIBLE ; Player . p_speed += ( 1.2 * ( Player . p_quickness + Player . p_quksilver ) + 5.0 - Player . p_speed ) / 2.0 ; mvprintw ( 5 , 0 , "New quickness:  %.0f\n" , Player . p_speed ) ; } break ; case '7' : if ( Player . p_magiclvl < ML_XPORT ) { ILLSPELL ( ) ; } if ( Player . p_mana < MM_XPORT ) { NOMANA ( ) ; } else { Player . p_mana -= MM_XPORT ; if ( Player . p_brains + Player . p_magiclvl < Curmonster . m_experience / 200.0 * drandom ( ) ) { mvaddstr ( 5 , 0 , "Transport backfired!\n" ) ; altercoordinates ( 0.0 , 0.0 , A_FAR ) ; cancelmonster ( ) ; } else { mvprintw ( 5 , 0 , "%s is transported.\n" , Enemyname ) ; if ( drandom ( ) < 0.3 ) { Curmonster . m_treasuretype = 0 ; } Curmonster . m_energy = 0.0 ; } } break ; case '8' : if ( Player . p_magiclvl < ML_PARALYZE ) { ILLSPELL ( ) ; } if ( Player . p_mana < MM_PARALYZE ) { NOMANA ( ) ; } else { Player . p_mana -= MM_PARALYZE ; if ( Player . p_magiclvl > Curmonster . m_experience / 1000.0 * drandom ( ) ) { mvprintw ( 5 , 0 , "%s is held.\n" , Enemyname ) ; Curmonster . m_speed = - 2.0 ; } else { mvaddstr ( 5 , 0 , "Monster unaffected.\n" ) ; } } break ; case '9' : if ( Player . p_specialtype < SC_COUNCIL ) { ILLSPELL ( ) ; } if ( Player . p_mana < MM_SPECIFY ) { NOMANA ( ) ; } else { Player . p_mana -= MM_SPECIFY ; mvaddstr ( 5 , 0 , "Which monster do you want [0-99] ? " ) ; Whichmonster = ( int ) infloat ( ) ; Whichmonster = MAX ( 0 , MIN ( 99 , Whichmonster ) ) ; longjmp ( Fightenv , 1 ) ; } break ; } } } 