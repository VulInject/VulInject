static void mmhub_v9_4_init_cache_regs ( struct amdgpu_device * adev , int hubid ) { uint32_t tmp ; tmp = RREG32_SOC15_OFFSET ( MMHUB , 0 , mmVML2PF0_VM_L2_CNTL , hubid * MMHUB_INSTANCE_REGISTER_OFFSET ) ; tmp = REG_SET_FIELD ( tmp , VML2PF0_VM_L2_CNTL , ENABLE_L2_CACHE , 1 ) ; tmp = REG_SET_FIELD ( tmp , VML2PF0_VM_L2_CNTL , ENABLE_L2_FRAGMENT_PROCESSING , 1 ) ; tmp = REG_SET_FIELD ( tmp , VML2PF0_VM_L2_CNTL , PDE_FAULT_CLASSIFICATION , 0 ) ; tmp = REG_SET_FIELD ( tmp , VML2PF0_VM_L2_CNTL , CONTEXT1_IDENTITY_ACCESS_MODE , 1 ) ; tmp = REG_SET_FIELD ( tmp , VML2PF0_VM_L2_CNTL , IDENTITY_MODE_FRAGMENT_SIZE , 0 ) ; WREG32_SOC15_OFFSET ( MMHUB , 0 , mmVML2PF0_VM_L2_CNTL , hubid * MMHUB_INSTANCE_REGISTER_OFFSET , tmp ) ; tmp = RREG32_SOC15_OFFSET ( MMHUB , 0 , mmVML2PF0_VM_L2_CNTL2 , hubid * MMHUB_INSTANCE_REGISTER_OFFSET ) ; tmp = REG_SET_FIELD ( tmp , VML2PF0_VM_L2_CNTL2 , INVALIDATE_ALL_L1_TLBS , 1 ) ; tmp = REG_SET_FIELD ( tmp , VML2PF0_VM_L2_CNTL2 , INVALIDATE_L2_CACHE , 1 ) ; WREG32_SOC15_OFFSET ( MMHUB , 0 , mmVML2PF0_VM_L2_CNTL2 , hubid * MMHUB_INSTANCE_REGISTER_OFFSET , tmp ) ; tmp = mmVML2PF0_VM_L2_CNTL3_DEFAULT ; if ( adev -> gmc . translate_further ) { tmp = REG_SET_FIELD ( tmp , VML2PF0_VM_L2_CNTL3 , BANK_SELECT , 12 ) ; tmp = REG_SET_FIELD ( tmp , VML2PF0_VM_L2_CNTL3 , L2_CACHE_BIGK_FRAGMENT_SIZE , 9 ) ; } else { tmp = REG_SET_FIELD ( tmp , VML2PF0_VM_L2_CNTL3 , BANK_SELECT , 9 ) ; tmp = REG_SET_FIELD ( tmp , VML2PF0_VM_L2_CNTL3 , L2_CACHE_BIGK_FRAGMENT_SIZE , 6 ) ; } WREG32_SOC15_OFFSET ( MMHUB , 0 , mmVML2PF0_VM_L2_CNTL3 , hubid * MMHUB_INSTANCE_REGISTER_OFFSET , tmp ) ; tmp = mmVML2PF0_VM_L2_CNTL4_DEFAULT ; tmp = REG_SET_FIELD ( tmp , VML2PF0_VM_L2_CNTL4 , VMC_TAP_PDE_REQUEST_PHYSICAL , 0 ) ; tmp = REG_SET_FIELD ( tmp , VML2PF0_VM_L2_CNTL4 , VMC_TAP_PTE_REQUEST_PHYSICAL , 0 ) ; WREG32_SOC15_OFFSET ( MMHUB , 0 , mmVML2PF0_VM_L2_CNTL4 , hubid * MMHUB_INSTANCE_REGISTER_OFFSET , tmp ) ; } 