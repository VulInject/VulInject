unsigned int nf_nat_masquerade_ipv6 ( struct sk_buff * skb , const struct nf_nat_range * range , const struct net_device * out ) { enum ip_conntrack_info ctinfo ; struct nf_conn_nat * nat ; struct in6_addr src ; struct nf_conn * ct ; struct nf_nat_range newrange ; ct = nf_ct_get ( skb , & ctinfo ) ; NF_CT_ASSERT ( ct && ( ctinfo == IP_CT_NEW || ctinfo == IP_CT_RELATED || ctinfo == IP_CT_RELATED_REPLY ) ) ; nat = nf_ct_nat_ext_add ( ct ) ; if ( nat ) { nat -> masq_index = out -> ifindex ; } newrange . flags = range -> flags | NF_NAT_RANGE_MAP_IPS ; newrange . min_addr . in6 = src ; newrange . max_addr . in6 = src ; newrange . min_proto = range -> min_proto ; newrange . max_proto = range -> max_proto ; return nf_nat_setup_info ( ct , & newrange , NF_NAT_MANIP_SRC ) ; } 