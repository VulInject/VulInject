static bool xml_tag_save_to_file ( const char * tag , void * data , const IXML_FIELD * fields , const char * path , bool force ) { IXmlOutputState_t state ; char * stream_buffer ; size_t stream_size ; FILE * stream = open_memstream ( & stream_buffer , & stream_size ) ; if ( ! stream ) { log_error ( "Cannot create memory stream (%s)" , strerror ( errno ) ) ; return false ; } IXmlInit ( & state , stream , 4 , IXML_OUTPUT_FLAG_NONE , NULL ) ; IXmlOutputStruct ( & state , tag , data , NULL , fields ) ; IXmlOutputDestroy ( & state ) ; fclose ( stream ) ; bool result = false ; char * path_tmp1 = strdup ( path ) ; char * path_tmp2 = strdup ( path ) ; if ( ! path_tmp1 || ! path_tmp2 ) { die ( "Out of memory" ) ; } char * dir_name = dirname ( path_tmp1 ) ; char * file_name = basename ( path_tmp2 ) ; if ( ( access ( dir_name , F_OK ) == - 1 ) && ( mkdir ( dir_name , S_IRWXU ) == - 1 ) ) { log_error ( "Cannot create parent directory %s (%s)" , dir_name , strerror ( errno ) ) ; error } if ( ! file_save_atomic ( dir_name , file_name , stream_buffer , stream_size , force ) ) { log_error ( "Saving %s failed (%s)" , path , strerror ( errno ) ) ; error } result = true ; error free ( path_tmp1 ) ; free ( stream_buffer ) ; return result ; } static IXML_FIELD vf_fields [ ] { { tag : "Name" format : 's' IXML_FIELD_INFO ( , ) } { tag : "Enable" format : 'u' IXML_FIELD_INFO ( , ) } { tag : "PKey" format : 'h' IXML_FIELD_INFO ( , ) } { tag : "Security" format : 'u' IXML_FIELD_INFO ( , ) } { tag : "Member" format : 's' IXML_FIELD_INFO ( , ) } { tag : "Application" format : 's' IXML_FIELD_INFO ( , ) } { tag : "QOSGroup" format : 's' IXML_FIELD_INFO ( , ) } { NULL } } ; ; 