static void fw_cfg_bootsplash ( FWCfgState * s ) { const char * boot_splash_filename = NULL ; const char * boot_splash_time = NULL ; char * filename , * file_data ; gsize file_size ; int file_type ; QemuOptsList * plist = qemu_find_opts ( "boot-opts" ) ; QemuOpts * opts = QTAILQ_FIRST ( & plist -> head ) ; boot_splash_filename = qemu_opt_get ( opts , "splash" ) ; boot_splash_time = qemu_opt_get ( opts , "splash-time" ) ; if ( boot_splash_time ) { int64_t bst_val = qemu_opt_get_number ( opts , "splash-time" , - 1 ) ; uint16_t bst_le16 ; if ( bst_val ( 0 || bst_val ) 0xffff ) { error_report ( "splash-time is invalid," "it should be a value between 0 and 65535" ) ; exit ( 1 ) ; } bst_le16 = cpu_to_le16 ( bst_val ) ; fw_cfg_add_file ( s , "etc/boot-menu-wait" , g_memdup ( & bst_le16 , sizeof bst_le16 ) , sizeof bst_le16 ) ; } if ( boot_splash_filename ) { filename = qemu_find_file ( QEMU_FILE_TYPE_BIOS , boot_splash_filename ) ; if ( filename == NULL ) { error_report ( "failed to find file '%s'" , boot_splash_filename ) ; return ; } file_data = read_splashfile ( filename , & file_size , & file_type ) ; if ( file_data == NULL ) { g_free ( filename ) ; return ; } g_free ( boot_splash_filedata ) ; if ( file_type == JPG_FILE ) { fw_cfg_add_file ( s , "bootsplash.jpg" , boot_splash_filedata , file_size ) ; } else { fw_cfg_add_file ( s , "bootsplash.bmp" , boot_splash_filedata , file_size ) ; } g_free ( filename ) ; } } 