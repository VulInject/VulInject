static int dissect_nlsp ( tvbuff_t * tvb , packet_info * pinfo , proto_tree * tree , void * data _U_ ) { proto_item * ti , * type_item ; proto_tree * nlsp_tree ; int offset = 0 ; guint8 nlsp_major_version ; guint8 nlsp_header_length ; guint8 packet_type_flags ; guint8 packet_type ; col_clear ( pinfo -> cinfo , COL_INFO ) ; ti = proto_tree_add_item ( tree , proto_nlsp , tvb , 0 , - 1 , ENC_NA ) ; nlsp_tree = proto_item_add_subtree ( ti , ett_nlsp ) ; proto_tree_add_item ( nlsp_tree , hf_nlsp_irpd , tvb , offset , 1 , ENC_BIG_ENDIAN ) ; offset += 1 ; nlsp_header_length = tvb_get_guint8 ( tvb , 1 ) ; proto_tree_add_uint ( nlsp_tree , hf_nlsp_header_length , tvb , offset , 1 , nlsp_header_length ) ; offset += 1 ; proto_tree_add_item ( nlsp_tree , hf_nlsp_minor_version , tvb , offset , 1 , ENC_BIG_ENDIAN ) ; offset += 1 ; offset += 1 ; packet_type_flags = tvb_get_guint8 ( tvb , offset ) ; packet_type = packet_type_flags & PACKET_TYPE_MASK ; col_add_str ( pinfo -> cinfo , COL_INFO , val_to_str ( packet_type , nlsp_packet_type_vals , "Unknown (%u)" ) ) ; if ( packet_type == NLSP_TYPE_L1_LSP ) { proto_tree_add_boolean ( nlsp_tree , hf_nlsp_nr , tvb , offset , 1 , packet_type_flags ) ; } type_item = proto_tree_add_uint ( nlsp_tree , hf_nlsp_type , tvb , offset , 1 , packet_type_flags ) ; offset += 1 ; nlsp_major_version = tvb_get_guint8 ( tvb , offset ) ; ti = proto_tree_add_item ( nlsp_tree , hf_nlsp_major_version , tvb , offset , 1 , ENC_BIG_ENDIAN ) ; if ( nlsp_major_version != 1 ) { expert_add_info_format ( pinfo , ti , & ei_nlsp_major_version , "Unknown NLSP version (%d vs 1)" , nlsp_major_version ) ; } offset += 1 ; offset += 2 ; switch ( packet_type ) { case NLSP_TYPE_L1_HELLO : case NLSP_TYPE_WAN_HELLO : nlsp_dissect_nlsp_hello ( tvb , pinfo , nlsp_tree , offset , packet_type , nlsp_header_length ) ; break ; case NLSP_TYPE_L1_LSP : nlsp_dissect_nlsp_lsp ( tvb , pinfo , nlsp_tree , offset , nlsp_header_length ) ; break ; case NLSP_TYPE_L1_CSNP : nlsp_dissect_nlsp_csnp ( tvb , pinfo , nlsp_tree , offset , nlsp_header_length ) ; break ; case NLSP_TYPE_L1_PSNP : nlsp_dissect_nlsp_psnp ( tvb , pinfo , nlsp_tree , offset , nlsp_header_length ) ; break ; default : expert_add_info ( pinfo , type_item , & ei_nlsp_type ) ; } return tvb_captured_length ( tvb ) ; } 