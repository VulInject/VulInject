void rfapiCountAllItRoutes ( int * pALRcount , int * pARRcount , int * pHRcount , int * pIRcount ) { struct bgp * bgp ; struct rfapi * h ; struct rfapi_import_table * it ; afi_t afi ; int total_active_local = 0 ; int total_active_remote = 0 ; int total_holddown = 0 ; int total_imported = 0 ; bgp = bgp_get_default ( ) ; assert ( bgp ) ; h = bgp -> rfapi ; assert ( h ) ; for ( it = h -> imports ; it ; it = it -> next ) { for ( afi = AFI_IP ; afi < AFI_MAX ; ++ afi ) { total_active_local += it -> local_count [ afi ] ; total_active_remote += it -> remote_count [ afi ] ; total_holddown += it -> holddown_count [ afi ] ; total_imported += it -> imported_count [ afi ] ; } } void * cursor ; int rc ; if ( h -> import_mac ) { for ( cursor = NULL , rc = skiplist_next ( h -> import_mac , NULL , ( void * * ) & it , & cursor ) ; ! rc ; rc = skiplist_next ( h -> import_mac , NULL , ( void * * ) & it , & cursor ) ) { total_active_local += it -> local_count [ AFI_L2VPN ] ; total_active_remote += it -> remote_count [ AFI_L2VPN ] ; total_holddown += it -> holddown_count [ AFI_L2VPN ] ; total_imported += it -> imported_count [ AFI_L2VPN ] ; } } if ( pALRcount ) { * pALRcount = total_active_local ; } if ( pARRcount ) { * pARRcount = total_active_remote ; } if ( pIRcount ) { * pIRcount = total_imported ; } } 