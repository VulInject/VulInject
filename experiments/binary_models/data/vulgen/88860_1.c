static void fcoe_fdmi_info ( struct fc_lport * lport , struct net_device * netdev ) { struct fcoe_interface * fcoe ; struct fcoe_port * port ; struct net_device * realdev ; int rc ; port = lport_priv ( lport ) ; fcoe = port -> priv ; realdev = fcoe -> realdev ; if ( lport -> vport ) { return ; } if ( realdev -> netdev_ops -> ndo_fcoe_get_hbainfo ) { struct netdev_fcoe_hbainfo * fdmi ; fdmi = kzalloc ( sizeof ( * fdmi ) , GFP_KERNEL ) ; if ( ! fdmi ) { return ; } rc = realdev -> netdev_ops -> ndo_fcoe_get_hbainfo ( realdev , fdmi ) ; if ( rc ) { printk ( KERN_INFO "fcoe: Failed to retrieve FDMI " "information from netdev.\n" ) ; return ; } snprintf ( fc_host_serial_number ( lport -> host ) , FC_SERIAL_NUMBER_SIZE , "%s" , fdmi -> serial_number ) ; snprintf ( fc_host_manufacturer ( lport -> host ) , FC_SERIAL_NUMBER_SIZE , "%s" , fdmi -> manufacturer ) ; snprintf ( fc_host_model ( lport -> host ) , FC_SYMBOLIC_NAME_SIZE , "%s" , fdmi -> model ) ; snprintf ( fc_host_model_description ( lport -> host ) , FC_SYMBOLIC_NAME_SIZE , "%s" , fdmi -> model_description ) ; snprintf ( fc_host_hardware_version ( lport -> host ) , FC_VERSION_STRING_SIZE , "%s" , fdmi -> hardware_version ) ; snprintf ( fc_host_driver_version ( lport -> host ) , FC_VERSION_STRING_SIZE , "%s" , fdmi -> driver_version ) ; snprintf ( fc_host_optionrom_version ( lport -> host ) , FC_VERSION_STRING_SIZE , "%s" , fdmi -> optionrom_version ) ; snprintf ( fc_host_firmware_version ( lport -> host ) , FC_VERSION_STRING_SIZE , "%s" , fdmi -> firmware_version ) ; lport -> fdmi_enabled = 1 ; } else { lport -> fdmi_enabled = 0 ; printk ( KERN_INFO "fcoe: No FDMI support.\n" ) ; } } 