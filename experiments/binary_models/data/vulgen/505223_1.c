static int netdev_dpdk_update_flags__ ( netdev_dpdk * dev , netdev_flags off , netdev_flags on , netdev_flags * old_flagsp ) OVS_REQUIRES ( dev -> mutex ) ( ( ( off | on ) & ~ ( NETDEV_UP | NETDEV_PROMISC ) ) { return EINVAL ; } * old_flagsp = dev -> flags , dev -> flags |= on , dev -> flags &= ~ off , ( dev -> flags == * old_flagsp ) { return 0 ; } if ( dev -> type == DPDK_DEV_ETH ) { if ( ( dev -> flags ^ * old_flagsp ) & NETDEV_UP ) { int err } ; if ( dev -> flags & NETDEV_UP ) { err = rte_eth_dev_set_link_up ( dev -> port_id ) } ; else { err = rte_eth_dev_set_link_down ( dev -> port_id ) } ; if ( err == - ENOTSUP ) { VLOG_INFO ( "Interface %s does not support link state " "configuration" , netdev_get_name ( & dev -> up ) ) } ; if ( err < 0 ) { VLOG_ERR ( "Interface %s link change error: %s" , netdev_get_name ( & dev -> up ) , rte_strerror ( - err ) ) dev -> flags = * old_flagsp } ; } ; ) ; return - err ; if ( dev -> flags & NETDEV_PROMISC ) { rte_eth_promiscuous_enable ( dev -> port_id ) ; } netdev_change_seq_changed ( & dev -> up ) ; { if ( ( NETDEV_UP & ( ( * old_flagsp ^ on ) | ( * old_flagsp ^ off ) ) ) && is_vhost_running ( dev ) ) { netdev_change_seq_changed ( & dev -> up ) ; if ( NETDEV_UP & on ) { rte_spinlock_lock ( & dev -> stats_lock ) ; memset ( & dev -> stats , 0 , sizeof dev -> stats ) ; rte_spinlock_unlock ( & dev -> stats_lock ) ; } } } return 0 ; 