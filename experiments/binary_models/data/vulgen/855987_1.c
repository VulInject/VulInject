static void zfs_znode_sa_init ( zfsvfs_t * zfsvfs , znode_t * zp , dmu_buf_t * db , dmu_object_type_t obj_type , sa_handle_t * sa_hdl ) { ASSERT ( ! POINTER_IS_VALID ( zp -> z_zfsvfs ) || ( zfsvfs == zp -> z_zfsvfs ) ) ; ASSERT ( MUTEX_HELD ( ZFS_OBJ_MUTEX ( zfsvfs , zp -> z_id ) ) ) ; mutex_enter ( & zp -> z_lock ) ; ASSERT ( zp -> z_sa_hdl == NULL ) ; ASSERT ( zp -> z_acl_cached == NULL ) ; if ( sa_hdl == NULL ) { VERIFY ( 0 == sa_handle_get_from_db ( zfsvfs -> z_os , db , zp , SA_HDL_SHARED , & zp -> z_sa_hdl ) ) ; } else { zp -> z_sa_hdl = sa_hdl ; sa_set_userp ( sa_hdl , zp ) ; } zp -> z_is_sa = ( obj_type == DMU_OT_SA ) ?B_TRUE : B_FALSE ; mutex_exit ( & zp -> z_lock ) ; vn_exists ( ZTOV ( zp ) ) ; } 