static int udb_radnode_cleanup_onechild ( udb_base * udb , udb_ptr * n ) { udb_ptr par , child ; uint8_t pidx = RADNODE ( n ) -> pidx ; radstrlen_type joinlen ; udb_ptr_new ( & par , udb , & RADNODE ( n ) -> parent ) ; udb_ptr_new ( & child , udb , & lookup ( n ) -> array [ 0 ] . node ) ; joinlen = lookup_len ( & par , pidx ) + lookup_len ( n , 0 ) + 1 ; if ( ! udb_radnode_str_space ( udb , & par , joinlen ) ) { udb_ptr_unlink ( & par , udb ) ; udb_ptr_unlink ( & child , udb ) ; udb_ptr_zero ( n , udb ) ; return 0 ; } lookup_string ( & par , pidx ) [ lookup_len ( & par , pidx ) ] = RADNODE ( & child ) -> pidx + RADNODE ( n ) -> offset ; memmove ( lookup_string ( & par , pidx ) + lookup_len ( & par , pidx ) + 1 , lookup_string ( n , 0 ) , lookup_len ( n , 0 ) ) ; lookup ( & par ) -> array [ pidx ] . len = joinlen ; udb_rptr_set_ptr ( & lookup ( & par ) -> array [ pidx ] . node , udb , & child ) ; udb_rptr_set_ptr ( & RADNODE ( & child ) -> parent , udb , & par ) ; RADNODE ( & child ) -> pidx = pidx ; udb_radnode_delete ( udb , n ) ; udb_ptr_unlink ( & par , udb ) ; udb_ptr_unlink ( & child , udb ) ; udb_ptr_zero ( n , udb ) ; return 1 ; } 