static int p80211knetdev_set_mac_address ( struct net_device * dev , void * addr ) { struct sockaddr * new_addr = addr ; struct p80211msg_dot11req_mibset dot11req ; struct p80211item_unk392 * mibattr ; struct p80211item_pstr6 * macaddr ; struct p80211item_uint32 * resultcode ; int result ; if ( netif_running ( dev ) ) { return - EBUSY ; } mibattr = & dot11req . mibattribute ; macaddr = ( p80211item_pstr6 * ) & mibattr -> data ; resultcode = & dot11req . resultcode ; dot11req . msgcode = DIDMSG_DOT11REQ_MIBSET ; dot11req . msglen = sizeof ( dot11req ) ; memcpy ( dot11req . devname , ( ( wlandevice * ) dev -> ml_priv ) -> name , WLAN_DEVNAMELEN_MAX - 1 ) ; mibattr -> did = DIDMSG_DOT11REQ_MIBSET_MIBATTRIBUTE ; mibattr -> status = P80211ENUM_msgitem_status_data_ok ; mibattr -> len = sizeof ( mibattr -> data ) ; macaddr -> did = DIDMIB_DOT11MAC_OPERATIONTABLE_MACADDRESS ; macaddr -> status = P80211ENUM_msgitem_status_data_ok ; macaddr -> len = sizeof ( macaddr -> data ) ; macaddr -> data . len = ETH_ALEN ; memcpy ( & macaddr -> data . data , new_addr -> sa_data , ETH_ALEN ) ; resultcode -> did = DIDMSG_DOT11REQ_MIBSET_RESULTCODE ; resultcode -> status = P80211ENUM_msgitem_status_no_value ; resultcode -> len = sizeof ( resultcode -> data ) ; resultcode -> data = 0 ; result = p80211req_dorequest ( dev -> ml_priv , ( u8 * ) & dot11req ) ; if ( result != 0 || resultcode -> data != P80211ENUM_resultcode_success ) { netdev_err ( dev , "Low-level driver failed dot11req_mibset(dot11MACAddress).\n" ) ; result = - EADDRNOTAVAIL ; } else { eth_hw_addr_set ( dev , new_addr -> sa_data ) ; } return result ; } 