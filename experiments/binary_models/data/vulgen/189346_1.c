int wl1251_hw_init_mem_config ( struct wl1251 * wl ) { int ret ; ret = wl1251_acx_mem_cfg ( wl ) ; if ( ret < 0 ) { return ret ; } wl -> target_mem_map = kzalloc ( sizeof ( wl1251_acx_mem_map ) , GFP_KERNEL ) ; if ( ! wl -> target_mem_map ) { wl1251_error ( "couldn't allocate target memory map" ) ; return - ENOMEM ; } ret = wl1251_acx_mem_map ( wl , wl -> target_mem_map , sizeof ( wl1251_acx_mem_map ) ) ; if ( ret < 0 ) { wl1251_error ( "couldn't retrieve firmware memory map" ) ; kfree ( wl -> target_mem_map ) ; return ret ; } return 0 ; } 