void virAuditSend ( virLogSource * source , const char * filename , size_t linenr , const char * funcname , const char * clienttty G_GNUC_UNUSED , const char * clientaddr G_GNUC_UNUSED , virAuditRecordType type G_GNUC_UNUSED , bool success , const char * fmt , ... ) { va_list args ; if ( ! auditlog && auditfd < 0 ) { return ; } if ( ! auditlog ) { return ; } va_start ( args , fmt ) ; str = g_strdup_vprintf ( fmt , args ) ; va_end ( args ) ; if ( auditlog && str ) { if ( success ) { virLogMessage ( source , VIR_LOG_INFO , filename , linenr , funcname , NULL , "success=yes %s" , str ) ; } else { virLogMessage ( source , VIR_LOG_WARN , filename , linenr , funcname , NULL , "success=no %s" , str ) ; } } if ( str && auditfd >= 0 ) { static const int record_types [ ] { [ VIR_AUDIT_RECORD_MACHINE_CONTROL ] = AUDIT_VIRT_CONTROL [ VIR_AUDIT_RECORD_MACHINE_ID ] = AUDIT_VIRT_MACHINE_ID [ VIR_AUDIT_RECORD_RESOURCE ] = AUDIT_VIRT_RESOURCE } ; ; if ( type >= G_N_ELEMENTS ( record_types ) || record_types [ type ] == 0 ) { VIR_WARN ( "Unknown audit record type %d" , type ) ; } if ( audit_log_user_message ( auditfd , record_types [ type ] , str , NULL , clientaddr , clienttty , success ) < 0 ) { VIR_WARN ( "Failed to send audit message %s: %s" , NULLSTR ( str ) , g_strerror ( errno ) ) ; } } } 