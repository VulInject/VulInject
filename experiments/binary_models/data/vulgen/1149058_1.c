START_TEST ( ) { int min_level , max_level , res ; char * level_str ; res = pr_trace_parse_levels ( NULL , NULL , NULL ) ; ck_assert_msg ( res < 0 , "Failed to handle null arguments" ) ; ck_assert_msg ( errno == EINVAL , "Failed to set errno to EINVAL, got %d (%s)" , errno , strerror ( errno ) ) ; res = pr_trace_parse_levels ( "" , & min_level , & max_level ) ; ck_assert_msg ( res < 0 , "Failed to handle empty string" ) ; ck_assert_msg ( errno == EINVAL , "Failed to set errno to EINVAL, got %d (%s)" , errno , strerror ( errno ) ) ; level_str = "foo" ; res = pr_trace_parse_levels ( level_str , & min_level , & max_level ) ; ck_assert_msg ( res < 0 , "Failed to handle invalid levels string" ) ; ck_assert_msg ( errno == EINVAL , "Failed to set errno to EINVAL, got %d (%s)" , errno , strerror ( errno ) ) ; level_str = pstrdup ( p , "-7" ) ; res = pr_trace_parse_levels ( level_str , & min_level , & max_level ) ; ck_assert_msg ( res < 0 , "Failed to handle negative levels string" ) ; ck_assert_msg ( errno == EINVAL , "Failed to set errno to EINVAL, got %d (%s)" , errno , strerror ( errno ) ) ; level_str = pstrdup ( p , "2147483653" ) ; res = pr_trace_parse_levels ( level_str , & min_level , & max_level ) ; ck_assert_msg ( res < 0 , "Failed to handle negative levels string" ) ; ck_assert_msg ( errno == EINVAL , "Failed to set errno to EINVAL, got %d (%s)" , errno , strerror ( errno ) ) ; level_str = pstrdup ( p , "0" ) ; res = pr_trace_parse_levels ( level_str , & min_level , & max_level ) ; ck_assert_msg ( res == 0 , "Failed to handle single level zero string" ) ; ck_assert_msg ( min_level == 0 , "Expected min level 0, got %d" , max_level ) ; ck_assert_msg ( max_level == 0 , "Expected max level 0, got %d" , max_level ) ; level_str = pstrdup ( p , "7" ) ; res = pr_trace_parse_levels ( level_str , & min_level , & max_level ) ; ck_assert_msg ( res == 0 , "Failed to handle single level string" ) ; ck_assert_msg ( min_level == 1 , "Expected min level 1, got %d" , max_level ) ; ck_assert_msg ( max_level == 7 , "Expected max level 7, got %d" , max_level ) ; level_str = pstrdup ( p , "abc-def" ) ; res = pr_trace_parse_levels ( level_str , & min_level , & max_level ) ; ck_assert_msg ( res < 0 , "Failed to handle invalid levels string" ) ; ck_assert_msg ( errno == EINVAL , "Failed to set errno to EINVAL, got %d (%s)" , errno , strerror ( errno ) ) ; level_str = pstrdup ( p , "1-def" ) ; res = pr_trace_parse_levels ( level_str , & min_level , & max_level ) ; ck_assert_msg ( res < 0 , "Failed to handle invalid levels string" ) ; ck_assert_msg ( errno == EINVAL , "Failed to set errno to EINVAL, got %d (%s)" , errno , strerror ( errno ) ) ; level_str = pstrdup ( p , "2147483653-10" ) ; res = pr_trace_parse_levels ( level_str , & min_level , & max_level ) ; ck_assert_msg ( res < 0 , "Failed to handle negative levels string" ) ; ck_assert_msg ( errno == EINVAL , "Failed to set errno to EINVAL, got %d (%s)" , errno , strerror ( errno ) ) ; level_str = pstrdup ( p , "10-2147483653" ) ; res = pr_trace_parse_levels ( level_str , & min_level , & max_level ) ; ck_assert_msg ( res < 0 , "Failed to handle negative levels string" ) ; ck_assert_msg ( errno == EINVAL , "Failed to set errno to EINVAL, got %d (%s)" , errno , strerror ( errno ) ) ; level_str = pstrdup ( p , "-7-5" ) ; res = pr_trace_parse_levels ( level_str , & min_level , & max_level ) ; ck_assert_msg ( res < 0 , "Failed to handle negative levels string" ) ; ck_assert_msg ( errno == EINVAL , "Failed to set errno to EINVAL, got %d (%s)" , errno , strerror ( errno ) ) ; level_str = pstrdup ( p , "0--1" ) ; res = pr_trace_parse_levels ( level_str , & min_level , & max_level ) ; ck_assert_msg ( res < 0 , "Failed to handle single level zero string" ) ; ck_assert_msg ( errno == EINVAL , "Failed to set errno to EINVAL, got %d (%s)" , errno , strerror ( errno ) ) ; level_str = pstrdup ( p , "8-7" ) ; res = pr_trace_parse_levels ( level_str , & min_level , & max_level ) ; ck_assert_msg ( res < 0 , "Failed to handle max level<min level" ) ; ck_assert_msg ( errno == EINVAL , "Failed to set errno to EINVAL, got %d (%s)" , errno , strerror ( errno ) ) ; level_str = pstrdup ( p , "1-7" ) ; res = pr_trace_parse_levels ( level_str , & min_level , & max_level ) ; ck_assert_msg ( res == 0 , "Failed to handle levels string" ) ; ck_assert_msg ( min_level == 1 , "Expected min level 1, got %d" , max_level ) ; } 