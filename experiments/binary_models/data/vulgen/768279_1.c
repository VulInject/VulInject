int msm_gem_map_vma ( struct msm_gem_address_space * aspace , struct msm_gem_vma * vma , int prot , struct sg_table * sgt , int size ) { int ret = 0 ; vma -> inuse ++ ; if ( vma -> mapped ) { return 0 ; } vma -> mapped = true ; if ( aspace && aspace -> mmu ) { ret = aspace -> mmu -> funcs -> map ( aspace -> mmu , vma -> iova , sgt , size , prot ) ; } if ( ret ) { vma -> mapped = false ; vma -> inuse -- ; } return ret ; } 