cJSON * dynsec_rolelist__all_to_json ( struct dynsec__rolelist * base_rolelist ) { struct dynsec__rolelist * rolelist , * rolelist_tmp ; cJSON * j_roles , * j_role ; j_roles = cJSON_CreateArray ( ) ; if ( j_roles == NULL ) { return NULL ; } HASH_ITER ( , , , ) { j_role = cJSON_CreateObject ( ) ; if ( j_role == NULL ) { return NULL ; } cJSON_AddItemToArray ( j_roles , j_role ) ; if ( cJSON_AddStringToObject ( j_role , "rolename" , rolelist -> role -> rolename ) == NULL || ( rolelist -> priority != - 1 && cJSON_AddIntToObject ( j_role , "priority" , rolelist -> priority ) == NULL ) ) { cJSON_Delete ( j_roles ) ; return NULL ; } } return j_roles ; } 