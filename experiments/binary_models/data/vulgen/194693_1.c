void shm_reallocate ( int val ) { struct shmid_ds * * newsegs ; unsigned short * newseqs ; newsegs = mallocarray ( val , sizeof ( shmid_ds * ) , M_SHM , M_WAITOK | M_ZERO ) ; memcpy ( newsegs , shmsegs , shminfo . shmmni * sizeof ( shmid_ds * ) ) ; free ( shmsegs , M_SHM , shminfo . shmmni * sizeof ( shmid_ds * ) ) ; shmsegs = newsegs ; newseqs = mallocarray ( val , ( unsigned short ) , M_SHM , M_WAITOK | M_ZERO ) ; memcpy ( newseqs , shmseqs , shminfo . shmmni * ( unsigned short ) ) ; shmseqs = newseqs ; shminfo . shmmni = val ; } 