void file_vprint ( struct client * c , const char * fmt , va_list ap ) { struct client_file find , * cf ; struct msg_write_open msg ; find . stream = 1 ; if ( ( cf = RB_FIND ( client_files , & c -> files , & find ) ) == NULL ) { cf = file_create_with_client ( c , 1 , NULL , NULL ) ; cf -> path = xstrdup ( "-" ) ; evbuffer_add_vprintf ( cf -> buffer , fmt , ap ) ; msg . stream = 1 ; msg . fd = STDOUT_FILENO ; msg . flags = 0 ; proc_send ( c -> peer , MSG_WRITE_OPEN , - 1 , & msg , sizeof msg ) ; } else { evbuffer_add_vprintf ( cf -> buffer , fmt , ap ) ; file_push ( cf ) ; } } 