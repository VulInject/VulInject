static void mt76x0_phy_rf_init ( struct mt76x02_dev * dev ) { int i ; mt76x0_rf_patch_reg_array ( dev , mt76x0_rf_central_tab , ARRAY_SIZE ( mt76x0_rf_central_tab ) ) ; mt76x0_rf_patch_reg_array ( dev , mt76x0_rf_2g_channel_0_tab , ARRAY_SIZE ( mt76x0_rf_2g_channel_0_tab ) ) ; RF_RANDOM_WRITE ( dev , mt76x0_rf_5g_channel_0_tab ) ; for ( i = 0 ; i < ARRAY_SIZE ( mt76x0_rf_bw_switch_tab ) ; i ++ ) { const struct mt76x0_rf_switch_item * item = & mt76x0_rf_bw_switch_tab [ i ] ; if ( item -> bw_band == RF_BW_20 ) { mt76x0_rf_wr ( dev , item -> rf_bank_reg , item -> value ) ; } if ( ( ( RF_G_BAND | RF_BW_20 ) & item -> bw_band ) == ( RF_G_BAND | RF_BW_20 ) ) { mt76x0_rf_wr ( dev , item -> rf_bank_reg , item -> value ) ; } } for ( i = 0 ; i < ARRAY_SIZE ( mt76x0_rf_band_switch_tab ) ; i ++ ) { if ( mt76x0_rf_band_switch_tab [ i ] . bw_band & RF_G_BAND ) { mt76x0_rf_wr ( dev , mt76x0_rf_band_switch_tab [ i ] . rf_bank_reg , mt76x0_rf_band_switch_tab [ i ] . value ) ; } } mt76x0_rf_wr ( dev , MT_RF ( 0 , 22 ) , min_t ( u8 , dev -> cal . rx . freq_offset , 0xbf ) ) ; mt76x0_rf_rr ( dev , MT_RF ( 0 , 22 ) ) ; mt76x0_rf_set ( dev , MT_RF ( 0 , 73 ) , BIT ( 7 ) ) ; mt76x0_rf_clear ( dev , MT_RF ( 0 , 73 ) , BIT ( 7 ) ) ; mt76x0_rf_set ( dev , MT_RF ( 0 , 73 ) , BIT ( 7 ) ) ; mt76x0_rf_set ( dev , MT_RF ( 0 , 4 ) , 0x80 ) ; } 