static gint dissect_dplay_super_packed_player ( proto_tree * tree , tvbuff_t * tvb , gint offset ) { guint32 flags , is_sysplayer , info_mask ; guint32 have_short_name , have_long_name , sp_length_type , pd_length_type ; guint32 player_count_type , have_parent_id , shortcut_count_type ; guint32 player_data_length , sp_data_length , player_count , shortcut_count ; proto_item * im_item = NULL ; proto_tree * im_tree = NULL ; gint len ; static int * const ssp_flags [ ] { & hf_dplay_spp_flags_sending & hf_dplay_spp_flags_in_group & hf_dplay_spp_flags_nameserver & hf_dplay_spp_flags_sysplayer NULL } ; ; proto_tree_add_item ( tree , hf_dplay_spp_size , tvb , offset , 4 , ENC_LITTLE_ENDIAN ) ; offset += 4 ; flags = tvb_get_letohl ( tvb , offset ) ; is_sysplayer = flags & 0x00000001 ; proto_tree_add_bitmask ( tree , tvb , offset , hf_dplay_spp_flags , ett_dplay_spp_flags , ssp_flags , ENC_LITTLE_ENDIAN ) ; offset += 4 ; proto_tree_add_item ( tree , hf_dplay_spp_id , tvb , offset , 4 , ENC_NA ) ; offset += 4 ; info_mask = tvb_get_letohl ( tvb , offset ) ; have_short_name = info_mask & 0x00000001 ; have_long_name = ( info_mask & 0x00000002 ) >> 1 ; sp_length_type = ( info_mask & 0x0000000c ) >> 2 ; pd_length_type = ( info_mask & 0x00000030 ) >> 4 ; player_count_type = ( info_mask & 0x000000c0 ) >> 6 ; have_parent_id = ( info_mask & 0x00000100 ) >> 8 ; shortcut_count_type = ( info_mask & 0x00000600 ) >> 9 ; im_item = proto_tree_add_item ( tree , hf_dplay_spp_player_info_mask , tvb , offset , 4 , ENC_LITTLE_ENDIAN ) ; im_tree = proto_item_add_subtree ( im_item , ett_dplay_spp_info_mask ) ; proto_tree_add_uint ( im_tree , hf_dplay_spp_have_short_name , tvb , offset , 4 , have_short_name ) ; proto_tree_add_uint ( im_tree , hf_dplay_spp_have_long_name , tvb , offset , 4 , have_long_name ) ; proto_tree_add_uint ( im_tree , hf_dplay_spp_sp_length_type , tvb , offset , 4 , sp_length_type ) ; proto_tree_add_uint ( im_tree , hf_dplay_spp_pd_length_type , tvb , offset , 4 , pd_length_type ) ; proto_tree_add_uint ( im_tree , hf_dplay_spp_player_count_type , tvb , offset , 4 , player_count_type ) ; proto_tree_add_uint ( im_tree , hf_dplay_spp_have_parent_id , tvb , offset , 4 , have_parent_id ) ; proto_tree_add_uint ( im_tree , hf_dplay_spp_shortcut_count_type , tvb , offset , 4 , shortcut_count_type ) ; offset += 4 ; if ( is_sysplayer ) { proto_tree_add_item ( tree , hf_dplay_spp_dialect , tvb , offset , 4 , ENC_LITTLE_ENDIAN ) ; } else { proto_tree_add_item ( tree , hf_dplay_spp_sys_player_id , tvb , offset , 4 , ENC_NA ) ; } offset += 4 ; if ( have_short_name ) { offset = display_unicode_string ( tree , hf_dplay_spp_short_name , tvb , offset ) ; } if ( have_long_name ) { offset = display_unicode_string ( tree , hf_dplay_spp_long_name , tvb , offset ) ; } if ( pd_length_type ) { len = spp_get_value ( pd_length_type , tvb , offset , & player_data_length ) ; proto_tree_add_item ( tree , hf_dplay_spp_player_data_length , tvb , offset , len , ENC_LITTLE_ENDIAN ) ; offset += len ; proto_tree_add_item ( tree , hf_dplay_spp_player_data , tvb , offset , player_data_length , ENC_NA ) ; offset += player_data_length ; } if ( sp_length_type ) { len = spp_get_value ( sp_length_type , tvb , offset , & sp_data_length ) ; proto_tree_add_item ( tree , hf_dplay_spp_sp_data_length , tvb , offset , len , ENC_LITTLE_ENDIAN ) ; offset += len ; proto_tree_add_item ( tree , hf_dplay_spp_sp_data , tvb , offset , sp_data_length , ENC_NA ) ; offset += sp_data_length ; } if ( player_count_type ) { guint32 i ; len = spp_get_value ( player_count_type , tvb , offset , & player_count ) ; proto_tree_add_item ( tree , hf_dplay_spp_player_count , tvb , offset , len , ENC_LITTLE_ENDIAN ) ; offset += len ; for ( i = 0 ; i < player_count ; ++ i ) { proto_tree_add_item ( tree , hf_dplay_spp_player_id , tvb , offset , 4 , ENC_NA ) ; offset += 4 ; } } if ( have_parent_id ) { proto_tree_add_item ( tree , hf_dplay_spp_parent_id , tvb , offset , 4 , ENC_NA ) ; offset += 4 ; } return offset ; } 