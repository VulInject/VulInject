encryption_detected_result * detectDiskEncryption ( TSK_IMG_INFO * img_info , TSK_DADDR_T offset ) { encryption_detected_result * result = ( encryption_detected_result * ) tsk_malloc ( sizeof ( encryption_detected_result ) ) ; if ( result == NULL ) { return result ; } result -> encryptionType = ENCRYPTION_DETECTED_NONE ; result -> desc [ 0 ] = '\0' ; if ( img_info == NULL ) { return result ; } if ( offset > ( uint64_t ) img_info -> size ) { return result ; } size_t len = 1024 ; char * buf = ( char * ) tsk_malloc ( len ) ; if ( buf == NULL ) { return result ; } if ( tsk_img_read ( img_info , offset , buf , len ) != ( ssize_t ) len ) { return result ; } if ( detectSymantecPGP ( buf , len ) ) { result -> encryptionType = ENCRYPTION_DETECTED_SIGNATURE ; snprintf ( result -> desc , TSK_ERROR_STRING_MAX_LENGTH , "Symantec PGP" ) ; free ( buf ) ; return result ; } if ( detectMcAfee ( buf , len ) ) { result -> encryptionType = ENCRYPTION_DETECTED_SIGNATURE ; snprintf ( result -> desc , TSK_ERROR_STRING_MAX_LENGTH , "McAfee Safeboot" ) ; free ( buf ) ; return result ; } if ( detectSophos ( buf , len ) ) { result -> encryptionType = ENCRYPTION_DETECTED_SIGNATURE ; snprintf ( result -> desc , TSK_ERROR_STRING_MAX_LENGTH , "Sophos Safeguard" ) ; free ( buf ) ; return result ; } if ( detectGuardianEdge ( buf , len ) ) { result -> encryptionType = ENCRYPTION_DETECTED_SIGNATURE ; snprintf ( result -> desc , TSK_ERROR_STRING_MAX_LENGTH , "Guardian Edge" ) ; free ( buf ) ; return result ; } if ( detectCheckPoint ( buf , len ) ) { result -> encryptionType = ENCRYPTION_DETECTED_SIGNATURE ; snprintf ( result -> desc , TSK_ERROR_STRING_MAX_LENGTH , "Check Point" ) ; free ( buf ) ; return result ; } if ( detectWinMagic ( buf , len ) ) { result -> encryptionType = ENCRYPTION_DETECTED_SIGNATURE ; snprintf ( result -> desc , TSK_ERROR_STRING_MAX_LENGTH , "WinMagic SecureDoc" ) ; free ( buf ) ; return result ; } free ( buf ) ; return result ; } 