static int get_dir_index_using_offset ( struct super_block * s , long long * next_block , unsigned int * next_offset , long long index_start , unsigned int index_offset , int i_count , long long f_pos ) { struct squashfs_sb_info * msblk = & s -> u . squashfs_sb ; struct squashfs_super_block * sblk = & msblk -> sblk ; int i , length = 0 ; struct squashfs_dir_index_2 index ; TRACE ( "Entered get_dir_index_using_offset, i_count %d, f_pos %d\n" , i_count , ( unsigned int ) f_pos ) ; if ( f_pos == 0 ) { finish } for ( i = 0 ; i < i_count ; i ++ ) { if ( msblk -> swap ) { struct squashfs_dir_index_2 sindex ; squashfs_get_cached_block ( s , ( char * ) & sindex , index_start , index_offset , sizeof ( sindex ) , & index_start , & index_offset ) ; SQUASHFS_SWAP_DIR_INDEX_2 ( & index , & sindex ) ; } else { squashfs_get_cached_block ( s , ( char * ) & index , index_start , index_offset , sizeof ( index ) , & index_start , & index_offset ) ; } squashfs_get_cached_block ( s , NULL , index_start , index_offset , index . size + 1 , & index_start , & index_offset ) ; length = index . index ; * next_block = index . start_block + sblk -> directory_table_start ; } * next_offset = ( length + * next_offset ) % SQUASHFS_METADATA_SIZE ; finish return length ; } 