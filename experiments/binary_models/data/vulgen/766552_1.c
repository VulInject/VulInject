static int __init aspeed_i2c_ic_of_init ( struct device_node * node , struct device_node * parent ) { struct aspeed_i2c_ic * i2c_ic ; int ret = 0 ; i2c_ic = kzalloc ( sizeof ( * i2c_ic ) , GFP_KERNEL ) ; if ( ! i2c_ic ) { return - ENOMEM ; } i2c_ic -> base = of_iomap ( node , 0 ) ; if ( ! i2c_ic -> base ) { ret = - ENOMEM ; err_free_ic } i2c_ic -> parent_irq = irq_of_parse_and_map ( node , 0 ) ; if ( ! i2c_ic -> parent_irq ) { ret = - EINVAL ; err_iounmap } if ( ! i2c_ic -> irq_domain ) { ret = - ENOMEM ; err_iounmap } i2c_ic -> irq_domain -> name = "aspeed-i2c-domain" ; irq_set_chained_handler_and_data ( i2c_ic -> parent_irq , aspeed_i2c_ic_irq_handler , i2c_ic ) ; pr_info ( "i2c controller registered, irq %d\n" , i2c_ic -> parent_irq ) ; return 0 ; err_iounmap iounmap ( i2c_ic -> base ) ; err_free_ic kfree ( i2c_ic ) ; return ret ; } 