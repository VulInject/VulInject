static int midx_snapshot_ref_one ( const char * refname UNUSED , const struct object_id * oid , int flag UNUSED , void * _data ) { struct midx_snapshot_ref_data * data = _data ; struct object_id peeled ; if ( ! peel_iterated_oid ( oid , & peeled ) ) { oid = & peeled ; } if ( oid_object_info ( the_repository , oid , NULL ) != OBJ_COMMIT ) { return 0 ; } fprintf ( data -> f -> fp , "%s%s\n" , data -> preferred ?"+" : "" , oid_to_hex ( oid ) ) ; return 0 ; } 