static ssize_t uv__fs_try_copy_file_range ( int in_fd , off_t * off , int out_fd , size_t len ) { ssize_t r ; if ( uv__load_relaxed ( & no_copy_file_range_support ) ) { errno = ENOSYS ; return - 1 ; } r = uv__fs_copy_file_range ( in_fd , off , out_fd , NULL , len , 0 ) ; if ( r != - 1 ) { return r ; } switch ( errno ) { case EACCES : if ( uv__is_buggy_cephfs ( in_fd ) ) { errno = ENOSYS ; } break ; case ENOSYS : uv__store_relaxed ( & no_copy_file_range_support , 1 ) ; break ; case EPERM : if ( uv__is_cifs_or_smb ( out_fd ) ) { errno = ENOSYS ; } break ; case ENOTSUP : case EXDEV : errno = ENOSYS ; break ; } return - 1 ; } 