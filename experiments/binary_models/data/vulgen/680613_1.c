static RBinXtrData * oneshot ( RBin * bin , const ut8 * buf , ut64 size , int idx ) { int nlib = 0 ; char * libname ; if ( ! load ( bin ) ) { return NULL ; } struct r_bin_dyldcache_obj_t * xtr_obj = bin -> cur -> xtr_obj ; struct r_bin_dyldcache_lib_t * lib = r_bin_dyldcache_extract ( xtr_obj , idx , & nlib ) ; if ( ! lib ) { free_xtr ( xtr_obj ) ; bin -> cur -> xtr_obj = NULL ; return NULL ; } if ( ! metadata ) { free ( lib ) ; return NULL ; } struct MACH0_ ( mach_header ) * hdr = MACH0_ ( get_hdr ) ( lib -> b ) ; if ( ! hdr ) { free ( lib ) ; free ( metadata ) ; return NULL ; } fill_metadata_info_from_hdr ( metadata , hdr ) ; r_bin_dydlcache_get_libname ( lib , & libname ) ; metadata -> libname = strdup ( libname ) ; RBinXtrData * res = r_bin_xtrdata_new ( lib -> b , lib -> offset , r_buf_size ( lib -> b ) , nlib , metadata ) ; r_buf_free ( lib -> b ) ; free ( hdr ) ; free ( lib ) ; return res ; } 