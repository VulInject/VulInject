static JSWorkerMessagePipe * js_new_message_pipe ( void ) { JSWorkerMessagePipe * ps ; int pipe_fds [ 2 ] ; char mxName [ 200 ] ; if ( pipe ( pipe_fds ) < 0 ) { return NULL ; } ps = malloc ( sizeof ( * ps ) ) ; if ( ! ps ) { close ( pipe_fds [ 0 ] ) ; close ( pipe_fds [ 1 ] ) ; return NULL ; } ps -> ref_count = 1 ; sprintf ( mxName , "Worker%pMx" , ps ) ; ps -> mutex = gf_mx_new ( mxName ) ; ps -> read_fd = pipe_fds [ 0 ] ; ps -> write_fd = pipe_fds [ 1 ] ; return ps ; } 