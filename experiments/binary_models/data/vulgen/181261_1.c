static int ds_print ( uintptr_t addr , uint_t flags , int argc , const mdb_arg_t * argv , ipc_ops_vec_t * iv ) { void * iddata ; if ( ! ( flags & DCMD_ADDRSPEC ) ) { uint_t oflags = 0 ; if ( mdb_getopts ( argc , argv , 'l' , MDB_OPT_SETBITS , 1 , & oflags , NULL ) != argc ) { return ( DCMD_USAGE ) ; } if ( mdb_walk_dcmd ( iv -> iv_wcmd , oflags ?iv -> iv_ocmd : "ipcperm" , argc , argv ) == - 1 ) { mdb_warn ( "can't walk '%s'" , iv -> iv_wcmd ) ; return ( DCMD_ERR ) ; } return ( DCMD_OK ) ; } iddata = mdb_alloc ( iv -> iv_idsize , UM_SLEEP | UM_GC ) ; if ( mdb_vread ( iddata , iv -> iv_idsize , addr ) == - 1 ) { mdb_warn ( "failed to read %s at %#lx" , iv -> iv_ocmd , addr ) ; return ( DCMD_ERR ) ; } if ( ! DCMD_HDRSPEC ( flags ) && iv -> iv_print ) { mdb_inc_indent ( 0 ) ; iv -> iv_print ( iddata , addr ) ; mdb_dec_indent ( CMN_INDENT ) ; } if ( DCMD_HDRSPEC ( flags ) || iv -> iv_print ) { ipcperm_header ( ) ; } ipcperm_print ( addr , ( kipc_perm * ) iddata ) ; if ( iv -> iv_print ) { mdb_inc_indent ( CMN_INDENT ) ; iv -> iv_print ( iddata , addr ) ; mdb_dec_indent ( CMN_INDENT ) ; } return ( DCMD_OK ) ; } 