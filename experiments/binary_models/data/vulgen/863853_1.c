static void __devinit init_peripheral_ep ( struct musb * musb , struct musb_ep * ep , u8 epnum , int is_in ) { struct musb_hw_ep * hw_ep = musb -> endpoints + epnum ; memset ( ep , 0 , sizeof ep ) ; ep -> current_epnum = epnum ; ep -> musb = musb ; ep -> hw_ep = hw_ep ; ep -> is_in = is_in ; INIT_LIST_HEAD ( & ep -> req_list ) ; sprintf ( ep -> name , "ep%d%s" , epnum , ( ! epnum || hw_ep -> is_shared_fifo ) ?"" : ( is_in ?"in" : "out" ) ) ; ep -> end_point . name = ep -> name ; INIT_LIST_HEAD ( & ep -> end_point . ep_list ) ; if ( ! epnum ) { ep -> end_point . maxpacket = 64 ; ep -> end_point . ops = & musb_g_ep0_ops ; musb -> g . ep0 = & ep -> end_point ; } else { if ( is_in ) { ep -> end_point . maxpacket = hw_ep -> max_packet_sz_tx ; } else { ep -> end_point . maxpacket = hw_ep -> max_packet_sz_rx ; } ep -> end_point . ops = & musb_ep_ops ; } } 