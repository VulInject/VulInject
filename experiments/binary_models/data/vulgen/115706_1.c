static int he_init_tpdrq ( struct he_dev * he_dev ) { he_dev -> tpdrq_base = dma_zalloc_coherent ( & he_dev -> pci_dev -> dev , CONFIG_TPDRQ_SIZE * sizeof ( he_tpdrq ) , & he_dev -> tpdrq_phys , GFP_KERNEL ) ; if ( he_dev -> tpdrq_base == NULL ) { hprintk ( "failed to alloc tpdrq\n" ) ; return - ENOMEM ; } he_dev -> tpdrq_tail = he_dev -> tpdrq_base ; he_dev -> tpdrq_head = he_dev -> tpdrq_base ; he_writel ( he_dev , he_dev -> tpdrq_phys , TPDRQ_B_H ) ; he_writel ( he_dev , 0 , TPDRQ_T ) ; return 0 ; } 