bgp_adj_out_unset ( , , , , ) { struct bgp_adj_out * adj ; struct bgp_advertise * adv ; for ( adj = rn -> adj_out ; adj ; adj = adj -> next ) { if ( adj -> peer == peer ) { break ; } } if ( ! adj ) { return ; } if ( adj -> adv ) { bgp_advertise_clean ( peer , adj , afi , safi ) ; } if ( adj -> attr ) { adj -> adv = bgp_advertise_new ( ) ; adv = adj -> adv ; adv -> rn = rn ; adv -> adj = adj ; BGP_ADV_FIFO_ADD ( & peer -> sync [ afi ] [ safi ] -> withdraw , & adv -> fifo ) ; BGP_WRITE_ON ( peer -> t_write , bgp_write , peer -> fd ) ; } else { BGP_ADJ_OUT_DEL ( rn , adj ) ; bgp_adj_out_free ( adj ) ; bgp_unlock_node ( rn ) ; } } 