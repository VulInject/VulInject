main ( ) { static enum iconv_ilseq_handler handlers [ ] { iconveh_error iconveh_question_mark iconveh_escape_sequence } ; ; size_t h ; for ( h = 0 ; h < SIZEOF ( handlers ) ; h ++ ) { enum iconv_ilseq_handler handler = handlers [ h ] ; static const char input [ ] "\304rger mit b\366sen B\374bchen ohne Augenma\337" ; ; static const uint32_t expected [ ] { 0xC4 'r' 'g' 'e' 'r' ' ' 'm' 'i' 't' ' ' 'b' 0xF6 's' 'e' 'n' ' ' 'B' 0xFC 'b' 'c' 'h' 'e' 'n' ' ' 'o' 'h' 'n' 'e' ' ' 'A' 'u' 'g' 'e' 'n' 'm' 'a' 0xDF 0 } ; ; uint32_t * result = u32_strconv_from_encoding ( input , "ISO-8859-1" , handler ) ; ASSERT ( result != NULL ) ; ASSERT ( u32_strcmp ( result , expected ) == 0 ) ; } for ( h = 0 ; h < SIZEOF ( handlers ) ; h ++ ) { enum iconv_ilseq_handler handler = handlers [ h ] ; static const char input [ ] "Rafa\263 Maszkowski" ; ; static const uint32_t expected [ ] { 'R' 'a' 'f' 'a' 0x0142 ' ' 'M' 'a' 's' 'z' 'k' 'o' 'w' 's' 'k' 'i' 0 } ; ; uint32_t * result = u32_strconv_from_encoding ( input , "ISO-8859-2" , handler ) ; ASSERT ( result != NULL ) ; ASSERT ( u32_strcmp ( result , expected ) == 0 ) ; free ( result ) ; } if ( iconv_supports_encoding ( "ISO-2022-JP-2" ) ) { for ( h = 0 ; h < SIZEOF ( handlers ) ; h ++ ) { enum iconv_ilseq_handler handler = handlers [ h ] ; static const char input [ ] "\244\263\244\363\244\313\244\301\244\317" ; ; static const uint32_t expected [ ] { 0x3053 0x3093 0x306B 0x3061 0x306F 0 } ; ; uint32_t * result = u32_strconv_from_encoding ( input , "autodetect_jp" , handler ) ; ASSERT ( result != NULL ) ; ASSERT ( u32_strcmp ( result , expected ) == 0 ) ; free ( result ) ; } for ( h = 0 ; h < SIZEOF ( handlers ) ; h ++ ) { enum iconv_ilseq_handler handler = handlers [ h ] ; static const char input [ ] "\202\261\202\361\202\311\202\277\202\315" ; ; static const uint32_t expected [ ] { 0x3053 0x3093 0x306B 0x3061 0x306F 0 } ; ; uint32_t * result = u32_strconv_from_encoding ( input , "autodetect_jp" , handler ) ; ASSERT ( result != NULL ) ; ASSERT ( u32_strcmp ( result , expected ) == 0 ) ; free ( result ) ; } for ( h = 0 ; h < SIZEOF ( handlers ) ; h ++ ) { enum iconv_ilseq_handler handler = handlers [ h ] ; static const char input [ ] "\033$B$3$s$K$A$O\033(B" ; ; static const uint32_t expected [ ] { 0x3053 0x3093 0x306B 0x3061 0x306F 0 } ; ; uint32_t * result = u32_strconv_from_encoding ( input , "autodetect_jp" , handler ) ; ASSERT ( result != NULL ) ; ASSERT ( u32_strcmp ( result , expected ) == 0 ) ; free ( result ) ; } } return 0 ; } 