int sandbox_sf_bind_emul ( struct sandbox_state * state , int busnum , int cs , struct udevice * bus , ofnode node , const char * spec ) { struct udevice * emul ; char name [ 20 ] , * str ; struct driver * drv ; int ret ; strncpy ( name , spec , sizeof ( name ) - 6 ) ; name [ sizeof ( name ) - 6 ] = '\0' ; strcat ( name , "-emul" ) ; drv = lists_driver_lookup_name ( "sandbox_sf_emul" ) ; if ( ! drv ) { puts ( "Cannot find sandbox_sf_emul driver\n" ) ; return - ENOENT ; } str = strdup ( name ) ; if ( ! str ) { return - ENOMEM ; } ret = device_bind ( bus , drv , str , NULL , node , & emul ) ; if ( ret ) { printf ( "Cannot create emul device for spec '%s' (err=%d)\n" , spec , ret ) ; return ret ; } state -> spi [ busnum ] [ cs ] . emul = emul ; return 0 ; } 