static void do_cancel_buffers ( struct cx8802_dev * dev ) { struct cx88_dmaqueue * q = & dev -> mpegq ; struct cx88_buffer * buf ; unsigned long flags ; spin_lock_irqsave ( & dev -> slock , flags ) ; while ( ! list_empty ( & q -> active ) ) { buf = list_entry ( q -> active . next , cx88_buffer , list ) ; list_del ( & buf -> list ) ; vb2_buffer_done ( & buf -> vb . vb2_buf , VB2_BUF_STATE_ERROR ) ; } } 