flatpak_bwrap_bundle_args ( , , , , ) { g_autofree gchar * data = NULL ; gchar * ptr ; gint i ; gsize data_len = 0 ; int fd ; g_auto ( ) args_tmpf = { 0 } ; if ( end == - 1 ) { end = bwrap -> argv -> len ; } for ( i = start ; i < end ; i ++ ) { data_len += strlen ( bwrap -> argv -> pdata [ i ] ) + 1 ; } data = g_new ( gchar , data_len ) ; ptr = data ; for ( i = start ; i < end ; i ++ ) { ptr = g_stpcpy ( ptr , bwrap -> argv -> pdata [ i ] ) + 1 ; } fd = glnx_steal_fd ( & args_tmpf . fd ) ; g_debug ( "bwrap --args %d = ..." , fd ) ; for ( i = start ; i < end ; i ++ ) { if ( flatpak_argument_needs_quoting ( bwrap -> argv -> pdata [ i ] ) ) { g_autofree char * quoted = g_shell_quote ( bwrap -> argv -> pdata [ i ] ) ; g_debug ( "    %s" , quoted ) ; } else { g_debug ( "    %s" , ( const char * ) bwrap -> argv -> pdata [ i ] ) ; } } flatpak_bwrap_add_fd ( bwrap , fd ) ; g_ptr_array_remove_range ( bwrap -> argv , start , end - start ) ; if ( one_arg ) { g_ptr_array_insert ( bwrap -> argv , start , g_strdup_printf ( "--args=%d" , fd ) ) ; } else { g_ptr_array_insert ( bwrap -> argv , start , g_strdup ( "--args" ) ) ; g_ptr_array_insert ( bwrap -> argv , start + 1 , g_strdup_printf ( "%d" , fd ) ) ; } return TRUE ; } 