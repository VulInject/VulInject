static int uvc_v4l2_get_xu_mapping ( struct uvc_xu_control_mapping * kp , const struct uvc_xu_control_mapping32 __user * up ) { compat_caddr_t p ; if ( ! access_ok ( VERIFY_READ , up , sizeof ( * up ) ) || __copy_from_user ( kp , up , offsetof ( typeof ( * up ) , menu_info ) ) || __get_user ( kp -> menu_count , & up -> menu_count ) ) { return - EFAULT ; } if ( kp -> menu_count == 0 ) { kp -> menu_info = NULL ; return 0 ; } if ( __get_user ( p , & up -> menu_info ) ) { return - EFAULT ; } kp -> menu_info = compat_ptr ( p ) ; return 0 ; } 