void PNGFAPI png_set_background_fixed ( png_structrp png_ptr , png_const_color_16p background_color , int background_gamma_code , int need_expand , png_fixed_point background_gamma ) { png_debug ( 1 , "in png_set_background_fixed" ) ; if ( background_gamma_code == PNG_BACKGROUND_GAMMA_UNKNOWN ) { png_warning ( png_ptr , "Application must supply a known background gamma" ) ; return ; } png_ptr -> transformations |= PNG_COMPOSE | PNG_STRIP_ALPHA ; png_ptr -> transformations &= ~ PNG_ENCODE_ALPHA ; png_ptr -> flags &= ~ PNG_FLAG_OPTIMIZE_ALPHA ; png_ptr -> background = * background_color ; png_ptr -> background_gamma = background_gamma ; png_ptr -> background_gamma_type = ( png_byte ) ( background_gamma_code ) ; if ( need_expand != 0 ) { png_ptr -> transformations |= PNG_BACKGROUND_EXPAND ; } else { png_ptr -> transformations &= ~ PNG_BACKGROUND_EXPAND ; } } 