static int lookup_commondir ( bool * separate , git_str * commondir , git_str * repository_path ) { git_str common_link = GIT_STR_INIT ; int error ; if ( ! git_fs_path_contains_file ( repository_path , GIT_COMMONDIR_FILE ) ) { if ( ( error = git_str_set ( commondir , repository_path -> ptr , repository_path -> size ) ) == 0 ) { error = git_fs_path_to_dir ( commondir ) ; } * separate = false ; done } * separate = true ; if ( ( error = git_str_joinpath ( & common_link , repository_path -> ptr , GIT_COMMONDIR_FILE ) ) < 0 || ( error = git_futils_readbuffer ( & common_link , common_link . ptr ) ) < 0 ) { done } git_str_rtrim ( & common_link ) ; if ( git_fs_path_is_relative ( common_link . ptr ) ) { if ( ( error = git_str_joinpath ( commondir , repository_path -> ptr , common_link . ptr ) ) < 0 ) { done } } else { git_str_swap ( commondir , & common_link ) ; } git_str_dispose ( & common_link ) ; done return error ; } 