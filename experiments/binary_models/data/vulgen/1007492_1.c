static wtap_opttype_return_val wtap_block_add_option_common ( wtap_block_t block , guint option_id , wtap_opttype_e type , wtap_option_t * * optp ) { wtap_option_t * opt ; const wtap_opttype_t * opttype ; guint i ; opttype = GET_OPTION_TYPE ( block -> info -> options , option_id ) ; if ( opttype == NULL ) { return WTAP_OPTTYPE_NO_SUCH_OPTION ; } if ( opttype -> data_type != type ) { return WTAP_OPTTYPE_TYPE_MISMATCH ; } if ( ! ( opttype -> flags & WTAP_OPTTYPE_FLAG_MULTIPLE_ALLOWED ) ) { if ( wtap_block_get_option ( block , option_id ) != NULL ) { return WTAP_OPTTYPE_ALREADY_EXISTS ; } } i = block -> options -> len ; g_array_set_size ( block -> options , i + 1 ) ; opt = & g_array_index ( block -> options , wtap_option_t , i ) ; opt -> option_id = option_id ; * optp = opt ; return WTAP_OPTTYPE_SUCCESS ; } 