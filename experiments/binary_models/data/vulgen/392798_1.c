static void note_page ( struct ptdump_state * pt_st , unsigned long addr , int level , u64 val ) { struct pg_state * st = container_of ( pt_st , pg_state , ptdump ) ; pgprotval_t new_prot , new_eff ; pgprotval_t cur , eff ; static const char units [ ] "BKMGTPE" ; ; struct seq_file * m = st -> seq ; new_prot = val & PTE_FLAGS_MASK ; if ( ! val ) { new_eff = 0 ; } else { new_eff = st -> prot_levels [ level ] ; } cur = st -> current_prot ; eff = st -> effective_prot ; if ( st -> level == - 1 ) { st -> current_prot = new_prot ; st -> effective_prot = new_eff ; st -> level = level ; st -> marker = address_markers ; st -> lines = 0 ; pt_dump_seq_printf ( m , st -> to_dmesg , "---[ %s ]---\n" , st -> marker -> name ) ; } if ( new_prot != cur || new_eff != eff || level != st -> level || addr >= st -> marker [ 1 ] . start_address ) { const char * unit = units ; unsigned long delta ; int width = ( unsigned long ) * 2 ; if ( st -> check_wx && ( eff & _PAGE_RW ) && ! ( eff & _PAGE_NX ) ) { note_wx ( st , addr ) ; } if ( ! st -> marker -> max_lines || st -> lines < st -> marker -> max_lines ) { pt_dump_seq_printf ( m , st -> to_dmesg , "0x%0*lx-0x%0*lx   " , width , st -> start_address , width , addr ) ; delta = addr - st -> start_address ; while ( ! ( delta & 1023 ) && unit [ 1 ] ) { delta >>= 10 ; unit ++ ; } pt_dump_cont_printf ( m , st -> to_dmesg , "%9lu%c " , delta , * unit ) ; } st -> lines ++ ; if ( addr >= st -> marker [ 1 ] . start_address ) { if ( st -> marker -> max_lines && st -> lines > st -> marker -> max_lines ) { unsigned long nskip = st -> lines - st -> marker -> max_lines ; pt_dump_seq_printf ( m , st -> to_dmesg , "... %lu entr%s skipped ... \n" , nskip , nskip == 1 ?"y" : "ies" ) ; } st -> marker ++ ; st -> lines = 0 ; pt_dump_seq_printf ( m , st -> to_dmesg , "---[ %s ]---\n" , st -> marker -> name ) ; } st -> start_address = addr ; st -> current_prot = new_prot ; st -> effective_prot = new_eff ; st -> level = level ; } } 