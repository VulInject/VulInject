static int set_params ( struct slgt_info * info , MGSL_PARAMS __user * new_params ) { unsigned long flags ; MGSL_PARAMS tmp_params ; DBGINFO ( ( "%s set_params\n" , info -> device_name ) ) ; if ( copy_from_user ( & tmp_params , new_params , sizeof ( MGSL_PARAMS ) ) ) { return - EFAULT ; } spin_lock_irqsave ( & info -> lock , flags ) ; if ( tmp_params . mode == MGSL_MODE_BASE_CLOCK ) { info -> base_clock = tmp_params . clock_speed ; } else { memcpy ( & info -> params , & tmp_params , 0 ) ; } spin_unlock_irqrestore ( & info -> lock , flags ) ; program_hw ( info ) ; return 0 ; } 