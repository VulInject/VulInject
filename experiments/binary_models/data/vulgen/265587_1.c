FSTATUS fe_register_trap ( uint16 trap_num ) { FSTATUS status ; IB_ENTER ( __func__ , 0 , 0 , 0 , 0 ) ; status = omgt_sa_register_trap ( fe_omgt_session , trap_num , NULL ) ; if ( status != FSUCCESS ) { IB_LOG_INFINI_INFO_FMT ( __func__ , "Failed to register for Trap %u notices, status: %u" , trap_num , status ) ; IB_EXIT ( __func__ , status ) ; return status ; } Status_t rc = VSTATUS_OK ; STL_INFORM_INFO * info = ( STL_INFORM_INFO * ) & samad . Data ; uint32_t rcv_buf_len = FE_SA_RECV_BUF_SIZE , madRc = 0 ; MAD_SET_METHOD_TYPE ( & samad , SUBN_ADM_SET ) ; MAD_SET_VERSION_INFO ( & samad , STL_BASE_VERSION , MCLASS_SUBN_ADM , STL_SA_CLASS_VERSION ) ; MAD_SET_ATTRIB_ID ( & samad , STL_SA_ATTR_INFORM_INFO ) ; SA_MAD_SET_HEADER ( & samad , SM_KEY , 0 ) ; info -> LIDRangeBegin = STL_LID_PERMISSIVE ; info -> IsGeneric = 1 ; info -> Subscribe = 1 ; info -> Type = TRAP_ALL ; info -> u . Generic . u1 . s . RespTimeValue = 19 ; info -> u . Generic . u2 . s . ProducerType = 0xFFFFFF ; info -> u . Generic . TrapNumber = trap_num ; rc = if3_mngr_send_mad ( fdsa , & samad , sizeof ( STL_INFORM_INFO ) , fe_sa_recv_buf , & rcv_buf_len , & madRc , NULL , NULL ) ; if ( rc != VSTATUS_OK || madRc != 0 ) { if ( rc != VSTATUS_OK ) { status = FERROR ; IB_LOG_INFINI_INFO_FMT ( __func__ , "Failed to register for Trap %u notices, status: %u" , trap_num , status ) ; } else { IB_LOG_INFINI_INFO_FMT ( __func__ , "Failed to register for Trap %u notices, MAD status: %u" , trap_num , madRc ) ; status = FINVALID_PARAMETER ; } } IB_EXIT ( __func__ , status ) ; return status ; } 