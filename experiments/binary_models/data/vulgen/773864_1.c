static int thermal_genl_event_cpu_capability_change ( struct param * p ) { struct thermal_genl_cpu_caps * cpu_cap = p -> cpu_capabilities ; struct sk_buff * msg = p -> msg ; struct nlattr * start_cap ; int i ; start_cap = nla_nest_start ( msg , THERMAL_GENL_ATTR_CPU_CAPABILITY ) ; if ( ! start_cap ) { return - EMSGSIZE ; } for ( i = 0 ; i < p -> cpu_capabilities_count ; ++ i ) { if ( nla_put_u32 ( msg , THERMAL_GENL_ATTR_CPU_CAPABILITY_ID , cpu_cap -> cpu ) ) { out_cancel_nest } if ( nla_put_u32 ( msg , THERMAL_GENL_ATTR_CPU_CAPABILITY_PERFORMANCE , cpu_cap -> performance ) ) { out_cancel_nest } if ( nla_put_u32 ( msg , THERMAL_GENL_ATTR_CPU_CAPABILITY_EFFICIENCY , cpu_cap -> efficiency ) ) { out_cancel_nest } ++ cpu_cap ; } nla_nest_end ( msg , start_cap ) ; return 0 ; out_cancel_nest return - EMSGSIZE ; } 