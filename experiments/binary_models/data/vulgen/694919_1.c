static struct netxen_rx_buffer * netxen_process_rcv ( struct netxen_adapter * adapter , struct nx_host_sds_ring * sds_ring , int ring , u64 sts_data0 ) { struct net_device * netdev = adapter -> netdev ; struct netxen_recv_context * recv_ctx = & adapter -> recv_ctx ; struct netxen_rx_buffer * buffer ; struct sk_buff * skb ; struct nx_host_rds_ring * rds_ring ; int index , length , cksum , pkt_offset ; rds_ring = & recv_ctx -> rds_rings [ ring ] ; index = netxen_get_sts_refhandle ( sts_data0 ) ; if ( unlikely ( index >= rds_ring -> num_desc ) ) { return NULL ; } buffer = & rds_ring -> rx_buf_arr [ index ] ; length = netxen_get_sts_totallength ( sts_data0 ) ; cksum = netxen_get_sts_status ( sts_data0 ) ; pkt_offset = netxen_get_sts_pkt_offset ( sts_data0 ) ; skb = netxen_process_rxbuf ( adapter , rds_ring , index , cksum ) ; if ( ! skb ) { return buffer ; } if ( length > rds_ring -> skb_size ) { skb_put ( skb , rds_ring -> skb_size ) ; } else { skb_put ( skb , length ) ; } if ( pkt_offset ) { skb_pull ( skb , pkt_offset ) ; } skb -> protocol = eth_type_trans ( skb , netdev ) ; napi_gro_receive ( & sds_ring -> napi , skb ) ; adapter -> stats . rx_pkts ++ ; adapter -> stats . rxbytes += length ; return buffer ; } 