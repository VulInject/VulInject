static int i40e_dcbnl_ieee_delapp ( struct net_device * netdev , struct dcb_app * app ) { struct i40e_pf * pf = i40e_netdev_to_pf ( netdev ) ; struct i40e_dcbx_config * old_cfg ; int i , j , ret ; if ( ! ( pf -> dcbx_cap & DCB_CAP_DCBX_VER_IEEE ) || ( pf -> dcbx_cap & DCB_CAP_DCBX_LLD_MANAGED ) ) { return - EINVAL ; } ret = dcb_ieee_delapp ( netdev , app ) ; if ( ret ) { return ret ; } old_cfg = & pf -> hw . local_dcbx_config ; pf -> tmp_cfg = * old_cfg ; for ( i = 1 ; i < pf -> tmp_cfg . numapps ; i ++ ) { if ( app -> selector == pf -> tmp_cfg . app [ i ] . selector && app -> protocol == pf -> tmp_cfg . app [ i ] . protocolid && app -> priority == pf -> tmp_cfg . app [ i ] . priority ) { pf -> tmp_cfg . app [ i ] . selector = 0 ; pf -> tmp_cfg . app [ i ] . protocolid = 0 ; pf -> tmp_cfg . app [ i ] . priority = 0 ; break ; } } if ( i == pf -> tmp_cfg . numapps ) { return - EINVAL ; } pf -> tmp_cfg . numapps -- ; for ( j = i ; j < pf -> tmp_cfg . numapps ; j ++ ) { pf -> tmp_cfg . app [ j ] = old_cfg -> app [ j + 1 ] ; } ret = i40e_hw_dcb_config ( pf , & pf -> tmp_cfg ) ; if ( ret ) { dev_info ( & pf -> pdev -> dev , "Failed setting DCB configuration err %pe aq_err %s\n" , ERR_PTR ( ret ) , i40e_aq_str ( & pf -> hw , pf -> hw . aq . asq_last_status ) ) ; return - EINVAL ; } return 0 ; } 