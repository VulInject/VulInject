struct netconfig * getnetconfig ( void * vdata ) { NCONF_HANDLE * nconf_handlep = ( NCONF_HANDLE * ) vdata ; struct netconfig * retp ; int ipv6_present = - 1 ; ( void ) mutex_lock ( & netpp_mutex ) ; if ( ( netpp == NULL ) || ( nconf_handlep == NULL ) ) { ( void ) mutex_unlock ( & netpp_mutex ) ; return ( NULL ) ; } ( void ) mutex_unlock ( & netpp_mutex ) ; for ( ; ; ) { retp = * ( nconf_handlep -> nc_curr ) ; if ( retp && ( strcmp ( retp -> nc_netid , "udp6" ) == 0 || strcmp ( retp -> nc_netid , "tcp6" ) == 0 ) ) { if ( ipv6_present == - 1 ) { ipv6_present = __can_use_af ( AF_INET6 ) ; } if ( ! ipv6_present ) { ++ ( nconf_handlep -> nc_curr ) ; continue ; } } break ; } if ( retp != NULL ) { ++ ( nconf_handlep -> nc_curr ) ; nc_error = NC_NOERROR ; } else { nc_error = NC_NOMOREENTRIES ; } return ( retp ) ; } 