static void mx25_tsadc_setup_clk ( struct platform_device * pdev , struct mx25_tsadc * tsadc ) { unsigned clk_div ; dev_dbg ( & pdev -> dev , "Found master clock at %lu Hz\n" , clk_get_rate ( tsadc -> clk ) ) ; clk_div = DIV_ROUND_UP ( clk_get_rate ( tsadc -> clk ) , 1750000 ) ; dev_dbg ( & pdev -> dev , "Setting up ADC clock divider to %u\n" , clk_div ) ; clk_div -= 2 ; clk_div /= 2 ; dev_dbg ( & pdev -> dev , "Resulting ADC conversion clock at %lu Hz\n" , clk_get_rate ( tsadc -> clk ) / ( 2 * clk_div + 2 ) ) ; regmap_update_bits ( tsadc -> regs , MX25_TSC_TGCR , MX25_TGCR_ADCCLKCFG ( 0x1f ) , MX25_TGCR_ADCCLKCFG ( clk_div ) ) ; } 