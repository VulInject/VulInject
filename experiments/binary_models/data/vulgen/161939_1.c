static void websock_client_read ( void * opaque , const uint8_t * buf , int size ) { const uint8_t ping [ ] { 0x89 0x85 0x07 0x77 0x9e 0xf9 0x6f 0x12 0xf2 0x95 0x68 } ; ; const uint8_t binary [ ] { 0x82 0x85 0x74 0x90 0xb9 0xdf 0x03 0xff 0xcb 0xb3 0x10 } ; ; Chardev * chr_client = opaque ; if ( websock_check_http_headers ( ( char * ) buf , size ) ) { qemu_chr_fe_write ( chr_client -> be , ping , sizeof ( ping ) ) ; } if ( buf [ 0 ] == 0x8a && buf [ 1 ] == 0x05 ) { g_assert ( strncmp ( ( char * ) buf + 2 , "hello" , 5 ) == 0 ) ; } else { g_assert ( buf [ 0 ] == 0x88 && buf [ 1 ] == 0x16 ) ; g_assert ( strncmp ( ( char * ) buf + 4 , "peer requested close" , 10 ) == 0 ) ; quit = true ; } } 