static void * adm_process_non_fc_descriptors ( struct adm_chan * achan , void * desc , struct scatterlist * sg , enum dma_transfer_direction direction ) { struct adm_desc_hw_single * single_desc ; u32 remainder = sg_dma_len ( sg ) ; u32 mem_addr = sg_dma_address ( sg ) ; u32 * incr_addr = & mem_addr ; u32 * src , * dst ; if ( direction == DMA_DEV_TO_MEM ) { src = & achan -> slave . src_addr ; dst = & mem_addr ; } else { src = & mem_addr ; dst = & achan -> slave . dst_addr ; } { single_desc = desc ; single_desc -> cmd = ADM_CMD_TYPE_SINGLE ; single_desc -> src_addr = * src ; single_desc -> dst_addr = * dst ; single_desc -> len = ( remainder > ADM_MAX_XFER ) ?ADM_MAX_XFER : remainder ; * incr_addr += single_desc -> len ; desc += sizeof ( * single_desc ) ; } remainder ; if ( sg_is_last ( sg ) ) { single_desc -> cmd |= ADM_CMD_LC ; } return desc ; } 