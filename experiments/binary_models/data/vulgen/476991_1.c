prof_otrpolicy_t otr_get_policy ( const char * const recipient ) { char * account_name = session_get_account_name ( ) ; ProfAccount * account = accounts_get_account ( account_name ) ; if ( g_list_find_custom ( account -> otr_manual , recipient , ( GCompareFunc ) g_strcmp0 ) ) { account_free ( account ) ; return PROF_OTRPOLICY_MANUAL ; } if ( g_list_find_custom ( account -> otr_opportunistic , recipient , ( GCompareFunc ) g_strcmp0 ) ) { account_free ( account ) ; return PROF_OTRPOLICY_OPPORTUNISTIC ; } if ( g_list_find_custom ( account -> otr_always , recipient , ( GCompareFunc ) g_strcmp0 ) ) { account_free ( account ) ; return PROF_OTRPOLICY_ALWAYS ; } if ( account -> otr_policy ) { prof_otrpolicy_t result = PROF_OTRPOLICY_MANUAL ; if ( g_strcmp0 ( account -> otr_policy , "manual" ) == 0 ) { result = PROF_OTRPOLICY_MANUAL ; } if ( g_strcmp0 ( account -> otr_policy , "opportunistic" ) == 0 ) { result = PROF_OTRPOLICY_OPPORTUNISTIC ; } if ( g_strcmp0 ( account -> otr_policy , "always" ) == 0 ) { result = PROF_OTRPOLICY_ALWAYS ; } account_free ( account ) ; return result ; } account_free ( account ) ; char * pref_otr_policy = prefs_get_string ( PREF_OTR_POLICY ) ; prof_otrpolicy_t result = PROF_OTRPOLICY_MANUAL ; if ( strcmp ( pref_otr_policy , "opportunistic" ) == 0 ) { result = PROF_OTRPOLICY_OPPORTUNISTIC ; } if ( strcmp ( pref_otr_policy , "always" ) == 0 ) { result = PROF_OTRPOLICY_ALWAYS ; } return result ; } 