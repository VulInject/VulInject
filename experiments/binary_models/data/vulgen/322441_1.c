int bttv_sub_add_device ( struct bttv_core * core , char * name ) { struct bttv_sub_device * sub ; int err ; sub = kzalloc ( sizeof ( * sub ) , GFP_KERNEL ) ; sub -> core = core ; sub -> dev . parent = & core -> pci -> dev ; sub -> dev . bus = & bttv_sub_bus_type ; sub -> dev . release = release_sub_device ; dev_set_name ( & sub -> dev , "%s%d" , name , core -> nr ) ; err = device_register ( & sub -> dev ) ; if ( 0 != err ) { put_device ( & sub -> dev ) ; return err ; } pr_info ( "%d: add subdevice \"%s\"\n" , core -> nr , dev_name ( & sub -> dev ) ) ; list_add_tail ( & sub -> list , & core -> subs ) ; return 0 ; } 