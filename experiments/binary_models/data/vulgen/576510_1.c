int cfs_crypto_hash_final ( struct cfs_crypto_hash_desc * hdesc , unsigned char * hash , unsigned int * hash_len ) { int err ; struct ahash_request * req = ( void * ) hdesc ; if ( ! hash || ! hash_len ) { err = 0 ; free_ahash } if ( * hash_len < size ) { err = - EOVERFLOW ; free_ahash } ahash_request_set_crypt ( req , NULL , hash , 0 ) ; err = crypto_ahash_final ( req ) ; if ( ! err ) { * hash_len = size ; } free_ahash crypto_free_ahash ( crypto_ahash_reqtfm ( req ) ) ; ahash_request_free ( req ) ; return err ; } 