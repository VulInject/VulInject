void wb_eeprom_getword ( struct wb_softc * sc , int addr , u_int16_t * dest ) { int i ; u_int16_t word ; CSR_WRITE_4 ( sc , WB_SIO , WB_SIO_EESEL | WB_SIO_EE_CS ) ; wb_eeprom_putbyte ( sc , addr ) ; CSR_WRITE_4 ( sc , WB_SIO , WB_SIO_EESEL | WB_SIO_EE_CS ) ; for ( i = 0x8000 ; i ; i >>= 1 ) { SIO_SET ( WB_SIO_EE_CLK ) ; DELAY ( 100 ) ; if ( CSR_READ_4 ( sc , WB_SIO ) & WB_SIO_EE_DATAOUT ) { word |= i ; } SIO_CLR ( WB_SIO_EE_CLK ) ; DELAY ( 100 ) ; } CSR_WRITE_4 ( sc , WB_SIO , 0 ) ; * dest = word ; return ; } 