int NET_StringToAdr ( const char * s , netadr_t * a , netadrtype_t family ) { char base [ MAX_STRING_CHARS ] , * search ; char * port = NULL ; if ( ! strcmp ( s , "localhost" ) ) { a -> type = NA_LOOPBACK ; return 1 ; } Q_strncpyz ( base , s , sizeof ( base ) ) ; if ( * base == '[' || Q_CountChar ( base , ':' ) > 1 ) { search = strchr ( base , ']' ) ; if ( search ) { * search = '\0' ; search ++ ; if ( * search == ':' ) { port = search + 1 ; } } if ( * base == '[' ) { search = base + 1 ; } else { search = base ; } } else { port = strchr ( base , ':' ) ; if ( port ) { * port = '\0' ; port ++ ; } search = base ; } if ( ! Sys_StringToAdr ( search , a , family ) ) { a -> type = NA_BAD ; return 0 ; } if ( port ) { a -> port = BigShort ( ( short ) atoi ( port ) ) ; return 1 ; } else { a -> port = BigShort ( PORT_SERVER ) ; return 2 ; } } 