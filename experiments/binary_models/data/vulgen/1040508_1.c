static void aspeed_kcs_irq_mask_update ( struct kcs_bmc_device * kcs_bmc , u8 mask , u8 state ) { struct aspeed_kcs_bmc * priv = to_aspeed_kcs_bmc ( kcs_bmc ) ; int rc ; u8 str ; if ( mask & KCS_BMC_EVENT_TYPE_OBE ) { if ( KCS_BMC_EVENT_TYPE_OBE & state ) { rc = read_poll_timeout_atomic ( aspeed_kcs_inb , str , ! ( str & KCS_BMC_STR_OBF ) , 1 , 100 , false , & priv -> kcs_bmc , priv -> kcs_bmc . ioreg . str ) ; if ( rc == - ETIMEDOUT ) { mod_timer ( & priv -> obe . timer , jiffies + OBE_POLL_PERIOD ) ; } } else { del_timer ( & priv -> obe . timer ) ; } } } static const struct kcs_bmc_device_ops aspeed_kcs_ops = { . irq_mask_update = aspeed_kcs_irq_mask_update . io_inputb = aspeed_kcs_inb . io_outputb = aspeed_kcs_outb . io_updateb = aspeed_kcs_updateb } ; 