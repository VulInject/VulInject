static rms_dialog_info_t * rms_dialog_action_check ( rms_dialog_info_t * di ) { rms_action_t * a ; if ( ! di ) { LM_ERR ( "Dialog info NULL\n" ) ; return NULL ; } clist_foreach ( , , ) { if ( ! a ) { LM_ERR ( "dialog action NULL\n" ) ; continue ; } if ( a -> type == RMS_HANGUP ) { LM_INFO ( "dialog action RMS_HANGUP [%s]\n" , di -> callid . s ) ; rms_hangup_call ( di ) ; if ( di -> bridged_di ) { rms_hangup_call ( di -> bridged_di ) ; } a -> type = RMS_STOP ; return di ; } if ( a -> type == RMS_BRIDGING ) { LM_INFO ( "dialog action RMS_BRIDGING [%s]\n" , di -> callid . s ) ; rms_bridging_call ( di , a ) ; a -> type = RMS_NONE ; shm_free ( a -> param . s ) ; return di ; } if ( a -> type == RMS_BRIDGED ) { LM_INFO ( "dialog action RMS_BRIDGED [%s]\n" , di -> callid . s ) ; LM_INFO ( "di_1[%p]di_2[%p]\n" , di , di -> bridged_di ) ; rms_bridged_call ( di , a ) ; a -> type = RMS_NONE ; return di ; } if ( a -> type == RMS_STOP ) { LM_INFO ( "dialog action RMS_STOP [%s][%p|%p]\n" , di -> callid . s , di , di -> prev ) ; di = rms_stop ( di ) ; a -> type = RMS_NONE ; return di ; } if ( a -> type == RMS_PLAY ) { LM_INFO ( "dialog action RMS_PLAY [%s]\n" , di -> callid . s ) ; rms_playfile ( & di -> media , a ) ; a -> type = RMS_NONE ; } if ( a -> type == RMS_DONE ) { LM_INFO ( "dialog action RMS_DONE [%s][%s]\n" , di -> callid . s , a -> route . s ) ; if ( a -> route . s ) { run_action_route ( di , a -> route . s ) ; rms_action_t * tmp = a -> prev ; clist_rm ( a , next , prev ) ; shm_free ( a ) ; a = tmp ; } else { a -> type = RMS_HANGUP ; } return di ; } } return di ; } 