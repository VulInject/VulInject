static void sienna_cichlid_stb_init ( struct smu_context * smu ) { struct amdgpu_device * adev = smu -> adev ; uint32_t reg ; reg = RREG32_PCIE ( MP1_Public | smnMP1_PMI_3_START ) ; smu -> stb_context . enabled = REG_GET_FIELD ( reg , MP1_PMI_3_START , ENABLE ) ; mtx_init ( & smu -> stb_context . lock , IPL_NONE ) ; reg = RREG32_PCIE ( MP1_Public | smnMP1_PMI_3_FIFO ) ; smu -> stb_context . stb_buf_size = 1 << REG_GET_FIELD ( reg , MP1_PMI_3_FIFO , DEPTH ) ; smu -> stb_context . stb_buf_size *= SIENNA_CICHLID_STB_DEPTH_UNIT_BYTES ; dev_info ( smu -> adev -> dev , "STB initialized to %d entries" , smu -> stb_context . stb_buf_size / SIENNA_CICHLID_STB_DEPTH_UNIT_BYTES ) ; } 