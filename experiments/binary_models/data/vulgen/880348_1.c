static int ultra_close_card ( struct net_device * dev ) { int ioaddr = dev -> base_addr - ULTRA_NIC_OFFSET ; struct ei_device * ei_local = netdev_priv ( dev ) ; netif_stop_queue ( dev ) ; netif_dbg ( ei_local , ifdown , dev , "Shutting down ethercard.\n" ) ; outb ( 0x00 , ioaddr + 6 ) ; NS8390_init ( dev , 0 ) ; return 0 ; } static struct net_device * dev_ultra [ MAX_ULTRA_CARDS ] ; static int io [ MAX_ULTRA_CARDS ] ; static int irq [ MAX_ULTRA_CARDS ] ; module_param_hw_array ( io , int , ioport , NULL , 0 ) ; module_param_hw_array ( irq , int , irq , NULL , 0 ) ; module_param_named ( msg_enable , ultra_msg_enable , uint , 0444 ) ; MODULE_PARM_DESC ( io , "I/O base address(es)" ) ; MODULE_PARM_DESC ( irq , "IRQ number(s) (assigned)" ) ; MODULE_PARM_DESC ( msg_enable , "Debug message level (see linux/netdevice.h for bitmap)" ) ; MODULE_DESCRIPTION ( "SMC Ultra/EtherEZ ISA/PnP Ethernet driver" ) ; MODULE_LICENSE ( "GPL" ) ; static int __init ultra_init_module ( void ) { struct net_device * dev ; int this_dev , found = 0 ; for ( this_dev = 0 ; this_dev < MAX_ULTRA_CARDS ; this_dev ++ ) { if ( io [ this_dev ] == 0 ) { if ( this_dev != 0 ) { break ; } printk ( KERN_NOTICE "smc-ultra.c: Presently autoprobing (not recommended) for a single card.\n" ) ; } dev = alloc_ei_netdev ( ) ; if ( ! dev ) { break ; } dev -> irq = irq [ this_dev ] ; dev -> base_addr = io [ this_dev ] ; if ( do_ultra_probe ( dev ) == 0 ) { dev_ultra [ found ++ ] = dev ; continue ; } free_netdev ( dev ) ; printk ( KERN_WARNING "smc-ultra.c: No SMC Ultra card found (i/o = 0x%x).\n" , io [ this_dev ] ) ; break ; } if ( found ) { return 0 ; } return - ENXIO ; } 