void RunModeDispatch ( int runmode , const char * custom_mode , const char * capture_plugin_name , const char * capture_plugin_args ) { char * local_custom_mode = NULL ; if ( custom_mode == NULL ) { custom_mode = RunModeGetConfOrDefault ( runmode , capture_plugin_name ) ; if ( custom_mode == NULL ) { FatalError ( "Unknown runtime mode. Aborting" ) ; } } RunMode * mode = RunModeGetCustomMode ( runmode , custom_mode ) ; if ( mode == NULL ) { SCLogError ( "The custom type \"%s\" doesn't exist " "for this runmode type \"%s\".  Please use --list-runmodes to " "see available custom types for this runmode" , custom_mode , RunModeTranslateModeToName ( runmode ) ) ; exit ( EXIT_FAILURE ) ; } if ( active_runmode ) { SCFree ( active_runmode ) ; } if ( unlikely ( active_runmode == NULL ) ) { FatalError ( "Unable to dup active mode" ) ; } if ( strcasecmp ( active_runmode , "autofp" ) == 0 ) { TmqhFlowPrintAutofpHandler ( ) ; } mode -> RunModeFunc ( ) ; if ( local_custom_mode != NULL ) { SCFree ( local_custom_mode ) ; } TmValidateQueueState ( ) ; if ( runmode != RUNMODE_UNIX_SOCKET ) { FlowManagerThreadSpawn ( ) ; FlowRecyclerThreadSpawn ( ) ; if ( RunModeNeedsBypassManager ( ) ) { BypassedFlowManagerThreadSpawn ( ) ; } StatsSpawnThreads ( ) ; } } 