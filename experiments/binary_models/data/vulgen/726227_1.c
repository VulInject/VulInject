gimp_drawable_gradient ( , , , , , , , , , , , , , , , , , , , ) { GimpImage * image ; GeglBuffer * buffer ; GeglBuffer * shapeburst = NULL ; GeglNode * render ; gint x , y , width , height ; g_return_if_fail ( GIMP_IS_DRAWABLE ( drawable ) ) ; g_return_if_fail ( gimp_item_is_attached ( GIMP_ITEM ( drawable ) ) ) ; g_return_if_fail ( GIMP_IS_CONTEXT ( context ) ) ; g_return_if_fail ( GIMP_IS_GRADIENT ( gradient ) ) ; image = gimp_item_get_image ( GIMP_ITEM ( drawable ) ) ; if ( ! gimp_item_mask_intersect ( GIMP_ITEM ( drawable ) , & x , & y , & width , & height ) ) { return ; } gimp_set_busy ( image -> gimp ) ; buffer = gegl_buffer_new ( GEGL_RECTANGLE ( x , y , width , height ) , gimp_drawable_get_format_with_alpha ( drawable ) ) ; if ( gradient_type >= GIMP_GRADIENT_SHAPEBURST_ANGULAR && gradient_type <= GIMP_GRADIENT_SHAPEBURST_DIMPLED ) { shapeburst = gimp_drawable_gradient_shapeburst_distmap ( drawable , metric , GEGL_RECTANGLE ( x , y , width , height ) , progress ) ; } gimp_drawable_gradient_adjust_coords ( drawable , gradient_type , GEGL_RECTANGLE ( x , y , width , height ) , & startx , & starty , & endx , & endy ) ; render = gegl_node_new_child ( NULL , "operation" , "gimp:gradient" , "context" , context , "gradient" , gradient , "start-x" , startx , "start-y" , starty , "end-x" , endx , "end-y" , endy , "gradient-type" , gradient_type , "gradient-repeat" , repeat , "offset" , offset , "gradient-reverse" , reverse , "gradient-blend-color-space" , blend_color_space , "supersample" , supersample , "supersample-depth" , max_depth , "supersample-threshold" , threshold , "dither" , dither , NULL ) ; gimp_gegl_apply_operation ( shapeburst , progress , C_ ( "undo-type" , "Gradient" ) , render , buffer , GEGL_RECTANGLE ( x , y , width , height ) , FALSE ) ; g_object_unref ( render ) ; if ( shapeburst ) { g_object_unref ( shapeburst ) ; } gimp_drawable_apply_buffer ( drawable , buffer , GEGL_RECTANGLE ( x , y , width , height ) , TRUE , C_ ( "undo-type" , "Gradient" ) , opacity , paint_mode , GIMP_LAYER_COLOR_SPACE_AUTO , GIMP_LAYER_COLOR_SPACE_AUTO , gimp_layer_mode_get_paint_composite_mode ( paint_mode ) , NULL , x , y ) ; gimp_drawable_update ( drawable , x , y , width , height ) ; g_object_unref ( buffer ) ; gimp_unset_busy ( image -> gimp ) ; } 