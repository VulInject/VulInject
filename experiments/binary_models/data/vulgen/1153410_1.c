int ipu_di_adjust_videomode ( struct ipu_di * di , struct videomode * mode ) { u32 diff ; if ( ! IS_ALIGNED ( mode -> hactive , 8 ) && mode -> hfront_porch < ALIGN ( mode -> hactive , 8 ) - mode -> hactive ) { dev_err ( di -> ipu -> dev , "hactive %d is not aligned to 8 and front porch is too small to compensate\n" , mode -> hactive ) ; return - EINVAL ; } diff = 2 - mode -> vfront_porch ; if ( mode -> vback_porch >= diff ) { mode -> vfront_porch = 2 ; mode -> vback_porch -= diff ; } if ( mode -> vsync_len > diff ) { mode -> vfront_porch = 2 ; mode -> vsync_len = mode -> vsync_len - diff ; } else { dev_warn ( di -> ipu -> dev , "failed to adjust videomode\n" ) ; return - EINVAL ; } dev_dbg ( di -> ipu -> dev , "videomode adapted for IPU restrictions\n" ) ; return 0 ; } 