int s5p_mfc_load_firmware ( struct s5p_mfc_dev * dev ) { struct firmware * fw_blob ; int i , err = - EINVAL ; mfc_debug_enter ( ) ; if ( dev -> fw_get_done ) { return 0 ; } for ( i = MFC_FW_MAX_VERSIONS - 1 ; i >= 0 ; i -- ) { if ( ! dev -> variant -> fw_name [ i ] ) { continue ; } err = request_firmware ( ( const firmware * * ) & fw_blob , dev -> variant -> fw_name [ i ] , & dev -> plat_dev -> dev ) ; if ( ! err ) { dev -> fw_ver = ( s5p_mfc_fw_ver ) i ; break ; } } if ( err != 0 ) { mfc_err ( "Firmware is not present in the /lib/firmware directory nor compiled in kernel\n" ) ; return - EINVAL ; } memcpy ( dev -> fw_buf . virt , fw_blob -> data , fw_blob -> size ) ; wmb ( ) ; dev -> fw_get_done = true ; release_firmware ( fw_blob ) ; mfc_debug_leave ( ) ; return 0 ; } 