static int listTargetFunc ( int operandLen , char * operands [ ] , cmdOptions_t * options , void * args ) { cmdOptions_t * optionList = options ; int ret = 0 ; int stmfRet ; int i , j ; int outerLoop ; stmfSessionList * sessionList ; stmfDevid devid ; boolean_t operandEntered , found , verbose = B_FALSE ; stmfDevidList * targetList ; wchar_t targetIdent [ STMF_IDENT_LENGTH + 1 ] ; stmfTargetProperties targetProps ; if ( ( stmfRet = stmfGetTargetList ( & targetList ) ) != STMF_STATUS_SUCCESS ) { switch ( stmfRet ) { case STMF_ERROR_NOT_FOUND : ret = 0 ; break ; case STMF_ERROR_SERVICE_OFFLINE : ( void ) fprintf ( stderr , "%s: %s\n" , cmdName , gettext ( "STMF service offline" ) ) ; break ; case STMF_ERROR_BUSY : ( void ) fprintf ( stderr , "%s: %s\n" , cmdName , gettext ( "resource busy" ) ) ; break ; case STMF_ERROR_SERVICE_DATA_VERSION : ( void ) fprintf ( stderr , "%s: %s\n" , cmdName , gettext ( "STMF service version incorrect" ) ) ; break ; case STMF_ERROR_PERM : ( void ) fprintf ( stderr , "%s: %s\n" , cmdName , gettext ( "permission denied" ) ) ; break ; default : ( void ) fprintf ( stderr , "%s: %s\n" , cmdName , gettext ( "unknown error" ) ) ; break ; } return ( 1 ) ; } for ( ; optionList -> optval ; optionList ++ ) { switch ( optionList -> optval ) { case 'v' : verbose = B_TRUE ; break ; } } if ( operandLen > 0 ) { outerLoop = operandLen ; operandEntered = B_TRUE ; } else { outerLoop = 1 ; operandEntered = B_FALSE ; } for ( i = 0 ; i < outerLoop ; i ++ ) { if ( operandEntered ) { bzero ( & devid , sizeof ( devid ) ) ; ( void ) parseDevid ( operands [ i ] , & devid ) ; } for ( found = B_FALSE , j = 0 ; j < targetList -> cnt ; j ++ ) { if ( operandEntered ) { if ( bcmp ( & devid , & ( targetList -> devid [ j ] ) , sizeof ( devid ) ) == 0 ) { found = B_TRUE ; } } if ( ( found && operandEntered ) || ! operandEntered ) { ( void ) mbstowcs ( targetIdent , ( char * ) targetList -> devid [ j ] . ident , STMF_IDENT_LENGTH ) ; targetIdent [ STMF_IDENT_LENGTH ] = 0 ; ( void ) printf ( "Target: %ws\n" , targetIdent ) ; if ( verbose ) { stmfRet = stmfGetTargetProperties ( & ( targetList -> devid [ j ] ) , & targetProps ) ; if ( stmfRet == STMF_STATUS_SUCCESS ) { printTargetProps ( & targetProps ) ; } else { ( void ) fprintf ( stderr , "%s:" , cmdName ) ; ( void ) fprintf ( stderr , "%s\n" , gettext ( " get properties" " failed" ) ) ; } stmfRet = stmfGetSessionList ( & ( targetList -> devid [ j ] ) , & sessionList ) ; if ( stmfRet == STMF_STATUS_SUCCESS ) { printSessionProps ( sessionList ) ; } else { ( void ) fprintf ( stderr , "%s:" , cmdName ) ; ( void ) fprintf ( stderr , "%s\n" , gettext ( " get session info" " failed" ) ) ; } } } } if ( operandEntered && ! found ) { ( void ) fprintf ( stderr , "%s: %s: %s\n" , cmdName , operands [ i ] , "not found" ) ; ret = 1 ; } } return ( ret ) ; } 