static void ath79_gpio_irq_handler ( struct irq_desc * desc ) { struct gpio_chip * gc = irq_desc_get_handler_data ( desc ) ; struct irq_chip * irqchip = irq_desc_get_chip ( desc ) ; struct ath79_gpio_ctrl * ctrl = container_of ( gc , ath79_gpio_ctrl , gc ) ; unsigned long flags , pending ; u32 both_edges , state ; int irq ; chained_irq_enter ( irqchip , desc ) ; raw_spin_lock_irqsave ( & ctrl -> lock , flags ) ; pending = ath79_gpio_read ( ctrl , AR71XX_GPIO_REG_INT_PENDING ) ; both_edges = ctrl -> both_edges & pending ; raw_spin_unlock_irqrestore ( & ctrl -> lock , flags ) ; for_each_set_bit ( , , ) generic_handle_domain_irq ( gc -> irq . domain , irq ) ; chained_irq_exit ( irqchip , desc ) ; } 