static int ksz8863_smi_probe ( struct mdio_device * mdiodev ) { struct regmap_config rc ; struct ksz_device * dev ; int ret ; int i ; dev = ksz_switch_alloc ( & mdiodev -> dev , mdiodev ) ; if ( ! dev ) { return - ENOMEM ; } for ( i = 0 ; i < ARRAY_SIZE ( ksz8863_regmap_config ) ; i ++ ) { rc = ksz8863_regmap_config [ i ] ; rc . lock_arg = & dev -> regmap_mutex ; if ( IS_ERR ( dev -> regmap [ i ] ) ) { return dev_err_probe ( & mdiodev -> dev , PTR_ERR ( dev -> regmap [ i ] ) , "Failed to initialize regmap%i\n" , ksz8863_regmap_config [ i ] . val_bits ) ; } } if ( mdiodev -> dev . platform_data ) { dev -> pdata = mdiodev -> dev . platform_data ; } ret = ksz_switch_register ( dev ) ; if ( ret ) { return ret ; } dev_set_drvdata ( & mdiodev -> dev , dev ) ; return 0 ; } 