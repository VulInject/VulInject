static int meth_get ( transaction_t * txn , void * params __attribute__ ( ( unused ) ) ) ( request_target_t * tgt = & txn -> req_tgt , int ( * action ) ( transaction_t * txn ) = NULL , unsigned levels = 0 , char * p , strlcpy ( tgt -> path , txn -> req_uri -> path , sizeof ( tgt -> path ) ) , p = tgt -> path , p += strlen ( namespace_tzdist . prefix ) , ( * p == '/' ) * p ++ = '\0' , ( * p ) { tgt -> collection = p p += strcspn ( p , "/" ) if ( * p == '/' ) { * p ++ = '\0' ; } } if ( ! strcmp ( tgt -> collection , "capabilities" ) ) { if ( ! * p ) { action = & action_capa ; } } ; if ( ! strcmp ( tgt -> collection , "leapseconds" ) ) { if ( ! * p ) { action = & action_leap ; } } ; if ( ! strcmp ( tgt -> collection , "zones" ) ) { if ( ! * p ) { action = & action_list } ; else { tgt -> resource = p p += strlen ( p ) } ; } ; ) ; if ( p [ - 1 ] == '/' ) { * -- p = '\0' ; } p = strstr ( tgt -> resource , "observances" ) ; if ( ! p ) { action = & action_get ; } if ( p [ - 1 ] == '/' ) { * -- p = '\0' ; action = & action_expand ; } for ( p = tgt -> resource ; p && ++ levels ; ( p = strchr ( p + 1 , '/' ) ) ) { } ( ! action || levels > 3 ) ; return json_error_response ( txn , TZ_INVALID_ACTION , NULL , NULL ) ; return action ( txn ) ; 