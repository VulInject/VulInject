static int ir_rc5_encode ( enum rc_proto protocol , u32 scancode , struct ir_raw_event * events , unsigned int max ) { int ret ; struct ir_raw_event * e = events ; unsigned int data , xdata , command , commandx , system , pre_space_data ; if ( protocol == RC_PROTO_RC5 ) { command = ( scancode & 0x003f ) >> 0 ; commandx = ( scancode & 0x0040 ) >> 6 ; system = ( scancode & 0x1f00 ) >> 8 ; data = ! commandx << 12 | system << 6 | command ; ret = ir_raw_gen_manchester ( & e , max , & ir_rc5_timings , RC5_NBITS - 1 , data ) ; if ( ret < 0 ) { return ret ; } } if ( protocol == RC_PROTO_RC5X_20 ) { xdata = ( scancode & 0x00003f ) >> 0 ; command = ( scancode & 0x003f00 ) >> 8 ; commandx = ! ( scancode & 0x004000 ) ; system = ( scancode & 0x1f0000 ) >> 16 ; data = commandx << 18 | system << 12 | command << 6 | xdata ; pre_space_data = data >> ( RC5X_NBITS - CHECK_RC5X_NBITS ) ; ret = ir_raw_gen_manchester ( & e , max , & ir_rc5x_timings [ 0 ] , CHECK_RC5X_NBITS - 1 , pre_space_data ) ; if ( ret < 0 ) { return ret ; } ret = ir_raw_gen_manchester ( & e , max - ( e - events ) , & ir_rc5x_timings [ 1 ] , RC5X_NBITS - CHECK_RC5X_NBITS , data ) ; if ( ret < 0 ) { return ret ; } } if ( protocol == RC_PROTO_RC5_SZ ) { ret = ir_raw_gen_manchester ( & e , max , & ir_rc5_sz_timings , RC5_SZ_NBITS - 1 , scancode & 0x2fff ) ; } else { return - EINVAL ; } return e - events ; } 