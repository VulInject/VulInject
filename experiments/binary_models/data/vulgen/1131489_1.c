static const BYTE * TEST_RC4_KEY = ( BYTE * ) "Key" ; static const char * TEST_RC4_PLAINTEXT = "Plaintext" ; static const BYTE * TEST_RC4_CIPHERTEXT = ( BYTE * ) "\xBB\xF3\x16\xE8\xD9\x40\xAF\x0A\xD3" ; static BOOL test_crypto_cipher_rc4 ( ) { size_t len ; BOOL rc = FALSE ; BYTE * text = NULL ; WINPR_RC4_CTX * ctx ; len = strnlen ( TEST_RC4_PLAINTEXT , sizeof ( TEST_RC4_PLAINTEXT ) ) ; if ( ! ( text = ( BYTE * ) calloc ( 1 , len ) ) ) { fprintf ( stderr , "%s: failed to allocate text buffer (len=%" PRIuz ")\n" , __FUNCTION__ , len ) ; out } if ( ( ctx = winpr_RC4_New ( TEST_RC4_KEY , strnlen ( ( const char * ) TEST_RC4_KEY , sizeof ( TEST_RC4_KEY ) ) ) ) == NULL ) { fprintf ( stderr , "%s: winpr_RC4_New failed\n" , __FUNCTION__ ) ; out } rc = winpr_RC4_Update ( ctx , len , ( const BYTE * ) TEST_RC4_PLAINTEXT , text ) ; winpr_RC4_Free ( ctx ) ; if ( ! rc ) { fprintf ( stderr , "%s: winpr_RC4_Update failed\n" , __FUNCTION__ ) ; out } if ( memcmp ( text , TEST_RC4_CIPHERTEXT , len ) != 0 ) { char * actual ; char * expected ; actual = winpr_BinToHexString ( text , len , FALSE ) ; expected = winpr_BinToHexString ( TEST_RC4_CIPHERTEXT , len , FALSE ) ; fprintf ( stderr , "%s: unexpected RC4 ciphertext: Actual: %s Expected: %s\n" , __FUNCTION__ , actual , expected ) ; free ( actual ) ; out } rc = TRUE ; out free ( text ) ; return rc ; } 