static uint32_t lpfc_rcv_plogi_npr_node ( struct lpfc_vport * vport , struct lpfc_nodelist * ndlp , void * arg , uint32_t evt ) { struct Scsi_Host * shost = lpfc_shost_from_vport ( vport ) ; struct lpfc_iocbq * cmdiocb = ( lpfc_iocbq * ) arg ; if ( lpfc_rcv_plogi ( vport , ndlp , cmdiocb ) ) { lpfc_cancel_retry_delay_tmo ( vport , ndlp ) ; spin_lock_irq ( shost -> host_lock ) ; ndlp -> nlp_flag &= ~ ( NLP_NPR_ADISC | NLP_NPR_2B_DISC ) ; spin_unlock_irq ( shost -> host_lock ) ; } if ( ! ( ndlp -> nlp_flag & NLP_NPR_2B_DISC ) ) { if ( ! ( ndlp -> nlp_flag & NLP_DELAY_TMO ) ) { ndlp -> nlp_prev_state = NLP_STE_NPR_NODE ; lpfc_nlp_set_state ( vport , ndlp , NLP_STE_PLOGI_ISSUE ) ; lpfc_issue_els_plogi ( vport , ndlp -> nlp_DID , 0 ) ; } } return ndlp -> nlp_state ; } 