static int __maybe_unused wm97xx_suspend ( struct device * dev ) { struct wm97xx * wm = dev_get_drvdata ( dev ) ; u16 reg ; int suspend_mode ; if ( device_may_wakeup ( & wm -> input_dev -> dev ) ) { suspend_mode = wm -> suspend_mode ; } else { suspend_mode = 0 ; } reg = wm97xx_reg_read ( wm , AC97_WM97XX_DIGITISER2 ) ; reg &= ~ WM97XX_PRP_DET_DIG ; if ( wm -> input_dev -> users ) { reg |= suspend_mode ; } wm -> ac97 -> bus -> ops -> write ( wm -> ac97 , AC97_WM97XX_DIGITISER2 , reg ) ; if ( wm -> id == WM9713_ID2 && ( ! wm -> input_dev -> users || ! suspend_mode ) ) { reg = wm97xx_reg_read ( wm , AC97_EXTENDED_MID ) | 0x8000 ; wm97xx_reg_write ( wm , AC97_EXTENDED_MID , reg ) ; } return 0 ; } 