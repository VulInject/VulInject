static int test_replace ( struct libmnt_test * ts , int argc , char * argv [ ] ) { struct libmnt_fs * fs = mnt_new_fs ( ) ; struct libmnt_table * tb = mnt_new_table ( ) ; int rc ; mnt_table_enable_comments ( tb , TRUE ) ; mnt_table_parse_fstab ( tb , NULL ) ; mnt_fs_set_source ( fs , argv [ 1 ] ) ; mnt_fs_set_target ( fs , argv [ 2 ] ) ; mnt_fs_append_comment ( fs , "# this is new filesystem\n" ) ; mnt_table_add_fs ( tb , fs ) ; mnt_unref_fs ( fs ) ; rc = mnt_table_replace_file ( tb , mnt_get_fstab_path ( ) ) ; mnt_unref_table ( tb ) ; return rc ; } 