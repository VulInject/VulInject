load_resource_1028 ( , , , ) { IptcData * iptc_data ; guchar * iptc_buf ; guint iptc_buf_len ; gchar * name ; GimpParasite * parasite ; gchar * res_data ; IFDBG ( 2 ) g_debug ( "Process image resource block: 1028: IPTC data" ) ; res_data = g_malloc ( res_a -> data_len ) ; if ( psd_read ( input , res_data , res_a -> data_len , error ) < res_a -> data_len ) { g_free ( res_data ) ; return - 1 ; } iptc_data = iptc_data_new_from_data ( res_data , res_a -> data_len ) ; IFDBG ( 3 ) iptc_data_dump ( iptc_data , 0 ) ; IFDBG ( 2 ) g_debug ( "Processing IPTC data as GIMP IPTC parasite" ) ; iptc_data_save ( iptc_data , & iptc_buf , & iptc_buf_len ) ; if ( iptc_buf_len > 0 ) { parasite = gimp_parasite_new ( GIMP_PARASITE_IPTC , GIMP_PARASITE_PERSISTENT , iptc_buf_len , iptc_buf ) ; gimp_image_attach_parasite ( image , parasite ) ; gimp_parasite_free ( parasite ) ; } iptc_data_unref ( iptc_data ) ; g_free ( iptc_buf ) ; IFDBG ( 2 ) g_debug ( "Processing IPTC data as psd parasite" ) ; name = g_strdup_printf ( "psd-image-resource-%.4s-%.4x" , res_a -> type , res_a -> id ) ; IFDBG ( 3 ) g_debug ( "Parasite name: %s" , name ) ; parasite = gimp_parasite_new ( name , 0 , res_a -> data_len , res_data ) ; gimp_image_attach_parasite ( image , parasite ) ; gimp_parasite_free ( parasite ) ; g_free ( name ) ; g_free ( res_data ) ; return 0 ; } 