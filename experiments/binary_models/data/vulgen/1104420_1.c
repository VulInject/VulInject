static ssize_t rr_xclient_read ( struct corerouter_peer * peer ) { struct corerouter_session * cs = peer -> session ; struct rawrouter_session * rr = ( rawrouter_session * ) cs ; ssize_t len = cr_read ( peer , "rr_xclient_read()" ) ; if ( ! len ) { return 0 ; } ssize_t i ; for ( i = 0 ; i < len ; i ++ ) { if ( rr -> xclient_rn == 1 ) { if ( ptr [ i ] != '\n' ) { return - 1 ; } size_t remains = len - ( i + 1 ) ; if ( remains > 0 ) { peer -> session -> main_peer -> out = peer -> in ; peer -> session -> main_peer -> out_pos = ( peer -> in -> pos - remains ) ; } cr_write_to_backend ( peer , rr_xclient_write ) ; return len ; } if ( ptr [ i ] == '\r' ) { rr -> xclient_rn = 1 ; } } return len ; } 