static gboolean put_nrb_option ( wtap_block_t block _U_ , guint option_id , wtap_opttype_e option_type _U_ , wtap_optval_t * optval , void * user_data ) { guint8 * * opt_ptrp = ( guint8 * * ) user_data ; guint32 size = 0 ; struct pcapng_option_header option_hdr ; guint32 pad ; switch ( option_id ) { case OPT_COMMENT : case OPT_NS_DNSNAME : size = ( guint32 ) strlen ( optval -> stringval ) & 0xffff ; option_hdr . type = ( guint16 ) option_id ; option_hdr . value_length = ( guint16 ) size ; memcpy ( * opt_ptrp , & option_hdr , 4 ) ; * opt_ptrp += 4 ; memcpy ( * opt_ptrp , optval -> stringval , size ) ; * opt_ptrp += size ; else { pad = 0 ; } if ( pad != 0 ) { memset ( * opt_ptrp , 0 , pad ) ; * opt_ptrp += pad ; } break ; case OPT_CUSTOM_STR_COPY : case OPT_CUSTOM_BIN_COPY : size = ( guint32 ) ( optval -> custom_opt . data . generic_data . custom_data_len + sizeof ( guint32 ) ) & 0xffff ; option_hdr . type = ( guint16 ) option_id ; option_hdr . value_length = ( guint16 ) size ; memcpy ( * opt_ptrp , & option_hdr , 4 ) ; * opt_ptrp += 4 ; memcpy ( * opt_ptrp , & optval -> custom_opt . pen , sizeof ( guint32 ) ) ; * opt_ptrp += sizeof ( guint32 ) ; memcpy ( * opt_ptrp , optval -> custom_opt . data . generic_data . custom_data , optval -> custom_opt . data . generic_data . custom_data_len ) ; * opt_ptrp += optval -> custom_opt . data . generic_data . custom_data_len ; if ( ( size % 4 ) ) { pad = 4 - ( size % 4 ) ; } else { pad = 0 ; } if ( pad != 0 ) { memset ( * opt_ptrp , 0 , pad ) ; * opt_ptrp += pad ; } break ; case OPT_NS_DNSIP4ADDR : option_hdr . type = ( guint16 ) option_id ; option_hdr . value_length = 4 ; memcpy ( * opt_ptrp , & option_hdr , 4 ) ; * opt_ptrp += 4 ; memcpy ( * opt_ptrp , & optval -> ipv4val , 4 ) ; * opt_ptrp += 4 ; break ; case OPT_NS_DNSIP6ADDR : option_hdr . type = ( guint16 ) option_id ; option_hdr . value_length = 16 ; memcpy ( * opt_ptrp , & option_hdr , 4 ) ; * opt_ptrp += 4 ; memcpy ( * opt_ptrp , & optval -> ipv6val , 16 ) ; * opt_ptrp += 16 ; break ; default : break ; } return TRUE ; } 