void cxlflash_restore_luntable ( struct cxlflash_cfg * cfg ) { struct llun_info * lli , * temp ; u32 lind ; int k ; struct device * dev = & cfg -> dev -> dev ; __be64 __iomem * fc_port_luns ; mutex_lock ( & global . mutex ) ; list_for_each_entry_safe ( , , , ) { lind = lli -> lun_index ; dev_dbg ( dev , "%s: Virtual LUNs on slot %d:\n" , __func__ , lind ) ; for ( k = 0 ; k < cfg -> num_fc_ports ; k ++ ) { if ( lli -> port_sel & ( 1 << k ) ) { fc_port_luns = get_fc_port_luns ( cfg , k ) ; writeq_be ( lli -> lun_id [ k ] , & fc_port_luns [ lind ] ) ; dev_dbg ( dev , "\t%d=%llx\n" , k , lli -> lun_id [ k ] ) ; } } } mutex_unlock ( & global . mutex ) ; } 