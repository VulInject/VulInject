hdata_get_var_array_size ( , , ) { struct t_hdata_var * var ; const char * ptr_size ; char * error ; long value ; int i , offset ; void * ptr_value ; var = hashtable_get ( hdata -> hash_var , name ) ; if ( ! var ) { return - 1 ; } ptr_size = var -> array_size ; if ( ! ptr_size ) { return - 1 ; } if ( strcmp ( ptr_size , "*" ) == 0 ) { if ( ( var -> type == WEECHAT_HDATA_STRING ) || ( var -> type == WEECHAT_HDATA_SHARED_STRING ) || ( var -> type == WEECHAT_HDATA_POINTER ) || ( var -> type == WEECHAT_HDATA_HASHTABLE ) ) { if ( ! ( * ( ( void * * ) ( pointer + var -> offset ) ) ) ) { return 0 ; } i = 0 ; while ( 1 ) { ptr_value = NULL ; switch ( var -> type ) { case WEECHAT_HDATA_STRING : case WEECHAT_HDATA_SHARED_STRING : ptr_value = ( * ( ( char * * * ) ( pointer + var -> offset ) ) ) [ i ] ; break ; case WEECHAT_HDATA_POINTER : ptr_value = ( * ( ( void * * * ) ( pointer + var -> offset ) ) ) [ i ] ; break ; case WEECHAT_HDATA_HASHTABLE : ptr_value = ( * ( ( t_hashtable * * * ) ( pointer + var -> offset ) ) ) [ i ] ; break ; } if ( ! ptr_value ) { break ; } i ++ ; } return i ; } } else { offset = hdata_get_var_offset ( hdata , ptr_size ) ; if ( offset >= 0 ) { switch ( hdata_get_var_type ( hdata , ptr_size ) ) { case WEECHAT_HDATA_CHAR : return ( int ) ( * ( ( char * ) ( pointer + offset ) ) ) ; case WEECHAT_HDATA_INTEGER : return * ( ( int * ) ( pointer + offset ) ) ; case WEECHAT_HDATA_LONG : return ( int ) ( * ( ( long * ) ( pointer + offset ) ) ) ; default : break ; } } else { error = NULL ; value = strtol ( ptr_size , & error , 10 ) ; if ( error && ! error [ 0 ] ) { return ( int ) value ; } } } return - 1 ; } 