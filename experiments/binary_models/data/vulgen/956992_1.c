struct mctrl_gpios * mctrl_gpio_init_noauto ( struct device * dev , unsigned int idx ) { struct mctrl_gpios * gpios ; enum mctrl_gpio_idx i ; gpios = devm_kzalloc ( dev , sizeof ( * gpios ) , GFP_KERNEL ) ; if ( ! gpios ) { return ERR_PTR ( - ENOMEM ) ; } for ( i = 0 ; i < UART_GPIO_MAX ; i ++ ) { char * gpio_str ; bool present ; gpio_str = kasprintf ( GFP_KERNEL , "%s-gpios" , mctrl_gpios_desc [ i ] . name ) ; present = device_property_present ( dev , gpio_str ) ; kfree ( gpio_str ) ; if ( ! present ) { continue ; } gpios -> gpio [ i ] = devm_gpiod_get_index_optional ( dev , mctrl_gpios_desc [ i ] . name , idx , mctrl_gpios_desc [ i ] . flags ) ; if ( IS_ERR ( gpios -> gpio [ i ] ) ) { return ERR_CAST ( gpios -> gpio [ i ] ) ; } } return gpios ; } 