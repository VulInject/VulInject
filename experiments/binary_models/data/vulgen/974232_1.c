static int skel_flush ( struct file * file , fl_owner_t id ) { struct usb_skel * dev ; int res ; dev = file -> private_data ; if ( dev == NULL ) { return - ENODEV ; } mutex_lock ( & dev -> io_mutex ) ; skel_draw_down ( dev ) ; spin_lock_irq ( & dev -> err_lock ) ; res = dev -> errors ?( dev -> errors == - EPIPE ?- EPIPE : - EIO ) else 0 ; dev -> errors = 0 ; spin_unlock_irq ( & dev -> err_lock ) ; return res ; } 