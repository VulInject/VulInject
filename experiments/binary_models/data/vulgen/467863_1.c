smp_dialog ( ) { GtkWidget * dialog ; GtkWidget * hbox ; GtkWidget * vbox2 ; GtkWidget * frame ; GtkWidget * grid ; GtkWidget * check_button ; GtkWidget * label ; GtkWidget * combo ; GtkWidget * spinbutton ; GtkAdjustment * data ; gint ty ; if ( g_Sdebug ) { g_print ( "smp_dialog START\n" ) ; } g_di . enable_preview_update = FALSE ; g_di . sample_show_selection = TRUE ; g_di . dst_show_selection = TRUE ; g_di . dst_show_color = TRUE ; g_di . sample_show_color = TRUE ; g_di . orig_inten_button = NULL ; gimp_ui_init ( PLUG_IN_BINARY ) ; g_di . dialog = dialog = gimp_dialog_new ( _ ( "Sample Colorize" ) , PLUG_IN_ROLE , NULL , 0 , gimp_standard_help_func , PLUG_IN_PROC , _ ( "_Reset" ) , RESPONSE_RESET , _ ( "Get _Sample Colors" ) , RESPONSE_GET_COLORS , _ ( "_Close" ) , GTK_RESPONSE_CLOSE , _ ( "_Apply" ) , GTK_RESPONSE_APPLY , NULL ) ; gimp_dialog_set_alternative_button_order ( GTK_DIALOG ( dialog ) , RESPONSE_GET_COLORS , RESPONSE_RESET , GTK_RESPONSE_APPLY , GTK_RESPONSE_CLOSE , - 1 ) ; gimp_window_set_transient ( GTK_WINDOW ( dialog ) ) ; grid = gtk_grid_new ( ) ; gtk_grid_set_row_spacing ( GTK_GRID ( grid ) , 12 ) ; gtk_grid_set_column_spacing ( GTK_GRID ( grid ) , 6 ) ; gtk_container_set_border_width ( GTK_CONTAINER ( grid ) , 12 ) ; gtk_box_pack_start ( GTK_BOX ( gtk_dialog_get_content_area ( GTK_DIALOG ( dialog ) ) ) , grid , TRUE , TRUE , 0 ) ; ty = 0 ; label = gtk_label_new ( _ ( "Destination:" ) ) ; gtk_label_set_xalign ( GTK_LABEL ( label ) , 1.0 ) ; gtk_grid_attach ( GTK_GRID ( grid ) , label , 0 , ty , 1 , 1 ) ; gtk_widget_show ( label ) ; combo = gimp_layer_combo_box_new ( smp_constrain , NULL , NULL ) ; gimp_int_combo_box_connect ( GIMP_INT_COMBO_BOX ( combo ) , gimp_item_get_id ( GIMP_ITEM ( g_values . dst ) ) , G_CALLBACK ( smp_dest_combo_callback ) , NULL , NULL ) ; gtk_grid_attach ( GTK_GRID ( grid ) , combo , 1 , ty , 1 , 1 ) ; gtk_widget_show ( combo ) ; label = gtk_label_new ( _ ( "Sample:" ) ) ; gtk_label_set_xalign ( GTK_LABEL ( label ) , 1.0 ) ; gtk_grid_attach ( GTK_GRID ( grid ) , label , 3 , ty , 1 , 1 ) ; gtk_widget_show ( label ) ; combo = gimp_layer_combo_box_new ( smp_constrain , NULL , NULL ) ; gimp_int_combo_box_prepend ( GIMP_INT_COMBO_BOX ( combo ) , GIMP_INT_STORE_VALUE , SMP_INV_GRADIENT , GIMP_INT_STORE_LABEL , _ ( "From reverse gradient" ) , GIMP_INT_STORE_ICON_NAME , GIMP_ICON_GRADIENT , - 1 ) ; gimp_int_combo_box_prepend ( GIMP_INT_COMBO_BOX ( combo ) , GIMP_INT_STORE_VALUE , SMP_GRADIENT , GIMP_INT_STORE_LABEL , _ ( "From gradient" ) , GIMP_INT_STORE_ICON_NAME , GIMP_ICON_GRADIENT , - 1 ) ; gimp_int_combo_box_connect ( GIMP_INT_COMBO_BOX ( combo ) , g_values . sample_id , G_CALLBACK ( smp_sample_combo_callback ) , NULL , NULL ) ; gtk_grid_attach ( GTK_GRID ( grid ) , combo , 4 , ty , 1 , 1 ) ; gtk_widget_show ( combo ) ; ty ++ ; hbox = gtk_box_new ( GTK_ORIENTATION_HORIZONTAL , 6 ) ; gtk_grid_attach ( GTK_GRID ( grid ) , hbox , 0 , ty , 2 , 1 ) ; gtk_widget_show ( hbox ) ; check_button = gtk_check_button_new_with_mnemonic ( _ ( "Sho_w selection" ) ) ; gtk_box_pack_start ( GTK_BOX ( hbox ) , check_button , FALSE , FALSE , 0 ) ; gtk_widget_show ( check_button ) ; g_signal_connect ( check_button , "toggled" , G_CALLBACK ( smp_toggle_callback ) , & g_di . dst_show_selection ) ; gtk_toggle_button_set_active ( GTK_TOGGLE_BUTTON ( check_button ) , g_di . dst_show_selection ) ; check_button = gtk_check_button_new_with_mnemonic ( _ ( "Show co_lor" ) ) ; gtk_box_pack_start ( GTK_BOX ( hbox ) , check_button , FALSE , FALSE , 0 ) ; gtk_widget_show ( check_button ) ; g_signal_connect ( check_button , "toggled" , G_CALLBACK ( smp_toggle_callback ) , & g_di . dst_show_color ) ; gtk_toggle_button_set_active ( GTK_TOGGLE_BUTTON ( check_button ) , g_di . dst_show_color ) ; hbox = gtk_box_new ( GTK_ORIENTATION_HORIZONTAL , 6 ) ; gtk_grid_attach ( GTK_GRID ( grid ) , hbox , 3 , ty , 2 , 1 ) ; gtk_widget_show ( hbox ) ; check_button = gtk_check_button_new_with_mnemonic ( _ ( "Show selec_tion" ) ) ; gtk_box_pack_start ( GTK_BOX ( hbox ) , check_button , FALSE , FALSE , 0 ) ; gtk_widget_show ( check_button ) ; g_signal_connect ( check_button , "toggled" , G_CALLBACK ( smp_toggle_callback ) , & g_di . sample_show_selection ) ; gtk_toggle_button_set_active ( GTK_TOGGLE_BUTTON ( check_button ) , g_di . sample_show_selection ) ; check_button = gtk_check_button_new_with_mnemonic ( _ ( "Show c_olor" ) ) ; gtk_box_pack_start ( GTK_BOX ( hbox ) , check_button , FALSE , FALSE , 0 ) ; gtk_widget_show ( check_button ) ; g_signal_connect ( check_button , "toggled" , G_CALLBACK ( smp_toggle_callback ) , & g_di . sample_show_color ) ; gtk_toggle_button_set_active ( GTK_TOGGLE_BUTTON ( check_button ) , g_di . sample_show_color ) ; ty ++ ; frame = gtk_frame_new ( NULL ) ; gtk_frame_set_shadow_type ( GTK_FRAME ( frame ) , GTK_SHADOW_IN ) ; gtk_grid_attach ( GTK_GRID ( grid ) , frame , 0 , ty , 2 , 1 ) ; gtk_widget_show ( frame ) ; g_di . dst_preview = gimp_preview_area_new ( ) ; gtk_widget_set_halign ( g_di . dst_preview , GTK_ALIGN_CENTER ) ; gtk_widget_set_hexpand ( g_di . dst_preview , TRUE ) ; gtk_widget_set_size_request ( g_di . dst_preview , PREVIEW_SIZE_X , PREVIEW_SIZE_Y ) ; gtk_container_add ( GTK_CONTAINER ( frame ) , g_di . dst_preview ) ; gtk_widget_show ( g_di . dst_preview ) ; frame = gtk_frame_new ( NULL ) ; gtk_frame_set_shadow_type ( GTK_FRAME ( frame ) , GTK_SHADOW_IN ) ; gtk_grid_attach ( GTK_GRID ( grid ) , frame , 3 , ty , 2 , 1 ) ; gtk_widget_show ( frame ) ; g_di . sample_preview = gimp_preview_area_new ( ) ; gtk_widget_set_halign ( g_di . sample_preview , GTK_ALIGN_CENTER ) ; gtk_widget_set_hexpand ( g_di . sample_preview , TRUE ) ; gtk_widget_set_size_request ( g_di . sample_preview , PREVIEW_SIZE_X , PREVIEW_SIZE_Y ) ; gtk_container_add ( GTK_CONTAINER ( frame ) , g_di . sample_preview ) ; gtk_widget_show ( g_di . sample_preview ) ; ty ++ ; frame = gtk_frame_new ( NULL ) ; vbox2 = gtk_box_new ( GTK_ORIENTATION_VERTICAL , 2 ) ; gtk_container_add ( GTK_CONTAINER ( frame ) , vbox2 ) ; gtk_grid_attach ( GTK_GRID ( grid ) , frame , 0 , ty , 2 , 1 ) ; g_di . in_lvl_gray_preview = gimp_preview_area_new ( ) ; gtk_widget_set_halign ( g_di . in_lvl_gray_preview , GTK_ALIGN_CENTER ) ; gtk_widget_set_hexpand ( g_di . in_lvl_gray_preview , TRUE ) ; gtk_widget_set_size_request ( g_di . in_lvl_gray_preview , DA_WIDTH , GRADIENT_HEIGHT ) ; gtk_widget_set_events ( g_di . in_lvl_gray_preview , LEVELS_DA_MASK ) ; gtk_box_pack_start ( GTK_BOX ( vbox2 ) , g_di . in_lvl_gray_preview , FALSE , TRUE , 0 ) ; gtk_widget_show ( g_di . in_lvl_gray_preview ) ; g_signal_connect ( g_di . in_lvl_gray_preview , "event" , G_CALLBACK ( level_in_events ) , NULL ) ; g_di . in_lvl_drawarea = gtk_drawing_area_new ( ) ; gtk_widget_set_halign ( g_di . in_lvl_drawarea , GTK_ALIGN_CENTER ) ; gtk_widget_set_hexpand ( g_di . in_lvl_drawarea , TRUE ) ; gtk_widget_set_size_request ( g_di . in_lvl_drawarea , DA_WIDTH , CONTROL_HEIGHT ) ; gtk_widget_set_events ( g_di . in_lvl_drawarea , LEVELS_DA_MASK ) ; gtk_box_pack_start ( GTK_BOX ( vbox2 ) , g_di . in_lvl_drawarea , FALSE , TRUE , 0 ) ; gtk_widget_show ( g_di . in_lvl_drawarea ) ; g_signal_connect ( g_di . in_lvl_drawarea , "event" , G_CALLBACK ( level_in_events ) , NULL ) ; g_signal_connect ( g_di . in_lvl_drawarea , "draw" , G_CALLBACK ( level_in_draw ) , NULL ) ; gtk_widget_show ( vbox2 ) ; gtk_widget_show ( frame ) ; frame = gtk_frame_new ( NULL ) ; vbox2 = gtk_box_new ( GTK_ORIENTATION_VERTICAL , 2 ) ; gtk_container_add ( GTK_CONTAINER ( frame ) , vbox2 ) ; gtk_grid_attach ( GTK_GRID ( grid ) , frame , 3 , ty , 2 , 1 ) ; g_di . sample_colortab_preview = gimp_preview_area_new ( ) ; gtk_widget_set_halign ( g_di . sample_colortab_preview , GTK_ALIGN_CENTER ) ; gtk_widget_set_hexpand ( g_di . sample_colortab_preview , TRUE ) ; gtk_widget_set_size_request ( g_di . sample_colortab_preview , DA_WIDTH , GRADIENT_HEIGHT ) ; gtk_box_pack_start ( GTK_BOX ( vbox2 ) , g_di . sample_colortab_preview , FALSE , TRUE , 0 ) ; gtk_widget_show ( g_di . sample_colortab_preview ) ; g_di . sample_drawarea = gtk_drawing_area_new ( ) ; gtk_widget_set_halign ( g_di . sample_drawarea , GTK_ALIGN_CENTER ) ; gtk_widget_set_hexpand ( g_di . sample_drawarea , TRUE ) ; gtk_widget_set_size_request ( g_di . sample_drawarea , DA_WIDTH , CONTROL_HEIGHT ) ; gtk_widget_set_events ( g_di . sample_drawarea , LEVELS_DA_MASK ) ; gtk_box_pack_start ( GTK_BOX ( vbox2 ) , g_di . sample_drawarea , FALSE , TRUE , 0 ) ; gtk_widget_show ( g_di . sample_drawarea ) ; g_signal_connect ( g_di . sample_drawarea , "event" , G_CALLBACK ( level_out_events ) , NULL ) ; g_signal_connect ( g_di . sample_drawarea , "draw" , G_CALLBACK ( level_out_draw ) , NULL ) ; gtk_widget_show ( vbox2 ) ; gtk_widget_show ( frame ) ; ty ++ ; hbox = gtk_box_new ( GTK_ORIENTATION_HORIZONTAL , 6 ) ; gtk_box_set_homogeneous ( GTK_BOX ( hbox ) , TRUE ) ; gtk_grid_attach ( GTK_GRID ( grid ) , hbox , 0 , ty , 2 , 1 ) ; label = gtk_label_new ( _ ( "Input levels:" ) ) ; gtk_box_pack_start ( GTK_BOX ( hbox ) , label , FALSE , FALSE , 0 ) ; gtk_widget_show ( label ) ; data = gtk_adjustment_new ( ( gfloat ) g_values . lvl_in_min , 0.0 , 254.0 , 1 , 10 , 0 ) ; g_di . adj_lvl_in_min = data ; spinbutton = gimp_spin_button_new ( g_di . adj_lvl_in_min , 0.5 , 0 ) ; gtk_spin_button_set_numeric ( GTK_SPIN_BUTTON ( spinbutton ) , TRUE ) ; gtk_box_pack_start ( GTK_BOX ( hbox ) , spinbutton , FALSE , FALSE , 0 ) ; gtk_widget_show ( spinbutton ) ; g_signal_connect ( g_di . adj_lvl_in_min , "value-changed" , G_CALLBACK ( smp_adj_lvl_in_min_upd_callback ) , & g_di ) ; data = gtk_adjustment_new ( ( gfloat ) g_values . lvl_in_gamma , 0.1 , 10.0 , 0.02 , 0.2 , 0 ) ; g_di . adj_lvl_in_gamma = data ; spinbutton = gimp_spin_button_new ( g_di . adj_lvl_in_gamma , 0.5 , 2 ) ; gtk_spin_button_set_numeric ( GTK_SPIN_BUTTON ( spinbutton ) , TRUE ) ; gtk_box_pack_start ( GTK_BOX ( hbox ) , spinbutton , FALSE , FALSE , 0 ) ; gtk_widget_show ( spinbutton ) ; g_signal_connect ( g_di . adj_lvl_in_gamma , "value-changed" , G_CALLBACK ( smp_text_gamma_upd_callback ) , & g_di ) ; data = gtk_adjustment_new ( ( gfloat ) g_values . lvl_in_max , 1.0 , 255.0 , 1 , 10 , 0 ) ; g_di . adj_lvl_in_max = data ; spinbutton = gimp_spin_button_new ( g_di . adj_lvl_in_max , 0.5 , 0 ) ; gtk_spin_button_set_numeric ( GTK_SPIN_BUTTON ( spinbutton ) , TRUE ) ; gtk_box_pack_start ( GTK_BOX ( hbox ) , spinbutton , FALSE , FALSE , 0 ) ; gtk_widget_show ( spinbutton ) ; g_signal_connect ( g_di . adj_lvl_in_max , "value-changed" , G_CALLBACK ( smp_adj_lvl_in_max_upd_callback ) , & g_di ) ; gtk_widget_show ( hbox ) ; hbox = gtk_box_new ( GTK_ORIENTATION_HORIZONTAL , 4 ) ; gtk_box_set_homogeneous ( GTK_BOX ( hbox ) , TRUE ) ; gtk_grid_attach ( GTK_GRID ( grid ) , hbox , 3 , ty , 2 , 1 ) ; label = gtk_label_new ( _ ( "Output levels:" ) ) ; gtk_box_pack_start ( GTK_BOX ( hbox ) , label , FALSE , FALSE , 0 ) ; gtk_widget_show ( label ) ; data = gtk_adjustment_new ( ( gfloat ) g_values . lvl_out_min , 0.0 , 254.0 , 1 , 10 , 0 ) ; g_di . adj_lvl_out_min = data ; spinbutton = gimp_spin_button_new ( g_di . adj_lvl_out_min , 0.5 , 0 ) ; gtk_spin_button_set_numeric ( GTK_SPIN_BUTTON ( spinbutton ) , TRUE ) ; gtk_box_pack_start ( GTK_BOX ( hbox ) , spinbutton , FALSE , FALSE , 0 ) ; gtk_widget_show ( spinbutton ) ; g_signal_connect ( g_di . adj_lvl_out_min , "value-changed" , G_CALLBACK ( smp_adj_lvl_out_min_upd_callback ) , & g_di ) ; data = gtk_adjustment_new ( ( gfloat ) g_values . lvl_out_max , 0.0 , 255.0 , 1 , 10 , 0 ) ; g_di . adj_lvl_out_max = data ; spinbutton = gimp_spin_button_new ( g_di . adj_lvl_out_max , 0.5 , 0 ) ; gtk_spin_button_set_numeric ( GTK_SPIN_BUTTON ( spinbutton ) , TRUE ) ; gtk_box_pack_start ( GTK_BOX ( hbox ) , spinbutton , FALSE , FALSE , 0 ) ; gtk_widget_show ( spinbutton ) ; g_signal_connect ( g_di . adj_lvl_out_max , "value-changed" , G_CALLBACK ( smp_adj_lvl_out_max_upd_callback ) , & g_di ) ; gtk_widget_show ( hbox ) ; ty ++ ; hbox = gtk_box_new ( GTK_ORIENTATION_HORIZONTAL , 6 ) ; gtk_grid_attach ( GTK_GRID ( grid ) , hbox , 0 , ty , 2 , 1 ) ; gtk_widget_show ( hbox ) ; check_button = gtk_check_button_new_with_mnemonic ( _ ( "Hold _intensity" ) ) ; gtk_box_pack_start ( GTK_BOX ( hbox ) , check_button , FALSE , FALSE , 0 ) ; gtk_widget_show ( check_button ) ; g_signal_connect ( check_button , "toggled" , G_CALLBACK ( smp_toggle_callback ) , & g_values . hold_inten ) ; gtk_toggle_button_set_active ( GTK_TOGGLE_BUTTON ( check_button ) , g_values . hold_inten ) ; check_button = gtk_check_button_new_with_mnemonic ( _ ( "Original i_ntensity" ) ) ; g_di . orig_inten_button = check_button ; gtk_box_pack_start ( GTK_BOX ( hbox ) , check_button , FALSE , FALSE , 0 ) ; gtk_widget_set_sensitive ( g_di . orig_inten_button , g_values . hold_inten ) ; gtk_widget_show ( check_button ) ; g_signal_connect ( check_button , "toggled" , G_CALLBACK ( smp_toggle_callback ) , & g_values . orig_inten ) ; gtk_toggle_button_set_active ( GTK_TOGGLE_BUTTON ( check_button ) , g_values . orig_inten ) ; hbox = gtk_box_new ( GTK_ORIENTATION_HORIZONTAL , 4 ) ; gtk_grid_attach ( GTK_GRID ( grid ) , hbox , 3 , ty , 2 , 1 ) ; gtk_widget_show ( hbox ) ; check_button = gtk_check_button_new_with_mnemonic ( _ ( "Us_e subcolors" ) ) ; gtk_box_pack_start ( GTK_BOX ( hbox ) , check_button , FALSE , FALSE , 0 ) ; gtk_widget_show ( check_button ) ; g_signal_connect ( check_button , "toggled" , G_CALLBACK ( smp_toggle_callback ) , & g_values . rnd_subcolors ) ; gtk_toggle_button_set_active ( GTK_TOGGLE_BUTTON ( check_button ) , g_values . rnd_subcolors ) ; check_button = gtk_check_button_new_with_mnemonic ( _ ( "S_mooth samples" ) ) ; gtk_box_pack_start ( GTK_BOX ( hbox ) , check_button , FALSE , FALSE , 0 ) ; gtk_widget_show ( check_button ) ; g_signal_connect ( check_button , "toggled" , G_CALLBACK ( smp_toggle_callback ) , & g_values . guess_missing ) ; gtk_toggle_button_set_active ( GTK_TOGGLE_BUTTON ( check_button ) , g_values . guess_missing ) ; ty ++ ; gtk_widget_show ( grid ) ; gtk_widget_show ( frame ) ; gtk_widget_show ( dialog ) ; g_di . enable_preview_update = TRUE ; smp_get_colors ( NULL ) ; update_preview ( g_values . dst ) ; levels_update ( INPUT_SLIDERS | INPUT_LEVELS | DRAW ) ; gtk_main ( ) ; } 