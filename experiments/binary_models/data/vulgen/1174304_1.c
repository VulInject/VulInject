void xfs_ilock ( xfs_inode_t * ip , uint lock_flags ) { trace_xfs_ilock ( ip , lock_flags , _RET_IP_ ) ; ASSERT ( ( lock_flags & ( XFS_IOLOCK_SHARED | XFS_IOLOCK_EXCL ) ) != ( XFS_IOLOCK_SHARED | XFS_IOLOCK_EXCL ) ) ; ASSERT ( ( lock_flags & ( XFS_MMAPLOCK_SHARED | XFS_MMAPLOCK_EXCL ) ) != ( XFS_MMAPLOCK_SHARED | XFS_MMAPLOCK_EXCL ) ) ; ASSERT ( ( lock_flags & ( XFS_ILOCK_SHARED | XFS_ILOCK_EXCL ) ) != ( XFS_ILOCK_SHARED | XFS_ILOCK_EXCL ) ) ; ASSERT ( ( lock_flags & ~ ( XFS_LOCK_MASK | XFS_LOCK_SUBCLASS_MASK ) ) == 0 ) ; if ( lock_flags & XFS_IOLOCK_EXCL ) { down_write_nested ( & VFS_I ( ip ) -> i_rwsem , XFS_IOLOCK_DEP ( lock_flags ) ) ; } if ( lock_flags & XFS_IOLOCK_SHARED ) { down_read_nested ( & VFS_I ( ip ) -> i_rwsem , XFS_IOLOCK_DEP ( lock_flags ) ) ; } if ( lock_flags & XFS_MMAPLOCK_EXCL ) { mrupdate_nested ( & ip -> i_mmaplock , XFS_MMAPLOCK_DEP ( lock_flags ) ) ; } if ( lock_flags & XFS_MMAPLOCK_SHARED ) { mraccess_nested ( & ip -> i_mmaplock , XFS_MMAPLOCK_DEP ( lock_flags ) ) ; } if ( lock_flags & XFS_ILOCK_EXCL ) { mrupdate_nested ( & ip -> i_lock , XFS_ILOCK_DEP ( lock_flags ) ) ; } } 