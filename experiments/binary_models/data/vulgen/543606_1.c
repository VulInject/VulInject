static int bfin_atapi_resume ( struct platform_device * pdev ) { struct ata_host * host = platform_get_drvdata ( pdev ) ; int ret ; if ( host ) { ret = bfin_reset_controller ( host ) ; ata_host_resume ( host ) ; } return 0 ; } static struct platform_driver bfin_atapi_driver = { . probe = bfin_atapi_probe . remove = bfin_atapi_remove . suspend = bfin_atapi_suspend . resume = bfin_atapi_resume . driver = { . name = DRV_NAME } } ; static char bfin_atapi_mode [ ATAPI_MODE_SIZE ] ; static int __init bfin_atapi_init ( void ) { pr_info ( "register bfin atapi driver\n" ) ; switch ( bfin_atapi_mode [ 0 ] ) { case 'p' : case 'P' : break ; case 'm' : case 'M' : bfin_port_info [ 0 ] . mwdma_mask = ATA_MWDMA2 ; break ; default : bfin_port_info [ 0 ] . udma_mask = ATA_UDMA5 ; } return platform_driver_register ( & bfin_atapi_driver ) ; } 