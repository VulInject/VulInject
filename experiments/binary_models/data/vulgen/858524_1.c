static void gsi_isr_glob_err ( struct gsi * gsi ) { const struct reg * log_reg ; const struct reg * clr_reg ; enum gsi_err_type type ; enum gsi_err_code code ; u32 offset ; u32 which ; u32 val ; u32 ee ; log_reg = gsi_reg ( gsi , ERROR_LOG ) ; offset = reg_offset ( log_reg ) ; val = ioread32 ( gsi -> virt + offset ) ; iowrite32 ( 0 , gsi -> virt + offset ) ; clr_reg = gsi_reg ( gsi , ERROR_LOG_CLR ) ; iowrite32 ( ~ 0 , gsi -> virt + reg_offset ( clr_reg ) ) ; ee = reg_decode ( log_reg , ERR_EE , val ) ; type = reg_decode ( log_reg , ERR_TYPE , val ) ; which = reg_decode ( log_reg , ERR_VIRT_IDX , val ) ; code = reg_decode ( log_reg , ERR_CODE , val ) ; if ( type == GSI_ERR_TYPE_EVT ) { gsi_isr_glob_evt_err ( gsi , ee , which , code ) ; } else { dev_err ( gsi -> dev , "unexpected global error 0x%08x\n" , type ) ; } } 