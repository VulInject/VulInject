static int probe_drbd_84 ( blkid_probe pr ) { struct md_on_disk_08 * md ; off_t off ; off = pr -> size - DRBD_MD_OFFSET ; md = ( md_on_disk_08 * ) blkid_probe_get_buffer ( pr , off , sizeof ( md_on_disk_08 ) ) ; if ( ! md ) { return errno ?- errno : 1 ; } if ( be32_to_cpu ( md -> magic ) != DRBD_MD_MAGIC_08 && be32_to_cpu ( md -> magic ) != DRBD_MD_MAGIC_84_UNCLEAN ) { return 1 ; } blkid_probe_sprintf_uuid ( pr , ( unsigned char * ) & md -> device_uuid , sizeof ( md -> device_uuid ) , "%" PRIx64 , be64_to_cpu ( md -> device_uuid ) ) ; blkid_probe_set_version ( pr , "v08" ) ; if ( blkid_probe_set_magic ( pr , off + offsetof ( md_on_disk_08 , magic ) , sizeof ( md -> magic ) , ( unsigned char * ) & md -> magic ) ) { return 1 ; } return 0 ; } 