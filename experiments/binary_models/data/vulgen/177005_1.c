static int ssm2518_i2c_probe ( struct i2c_client * i2c ) { struct ssm2518 * ssm2518 ; int ret ; ssm2518 = devm_kzalloc ( & i2c -> dev , sizeof ( * ssm2518 ) , GFP_KERNEL ) ; if ( ssm2518 == NULL ) { return - ENOMEM ; } ssm2518 -> enable_gpio = devm_gpiod_get_optional ( & i2c -> dev , NULL , GPIOD_OUT_HIGH ) ; ret = PTR_ERR_OR_ZERO ( ssm2518 -> enable_gpio ) ; if ( ret ) { return ret ; } gpiod_set_consumer_name ( ssm2518 -> enable_gpio , "SSM2518 nSD" ) ; i2c_set_clientdata ( i2c , ssm2518 ) ; if ( IS_ERR ( ssm2518 -> regmap ) ) { return PTR_ERR ( ssm2518 -> regmap ) ; } regcache_cache_bypass ( ssm2518 -> regmap , true ) ; ret = regmap_write ( ssm2518 -> regmap , SSM2518_REG_POWER1 , SSM2518_POWER1_RESET ) ; regcache_cache_bypass ( ssm2518 -> regmap , false ) ; if ( ret ) { return ret ; } ret = regmap_update_bits ( ssm2518 -> regmap , SSM2518_REG_POWER2 , SSM2518_POWER2_APWDN , 0x00 ) ; if ( ret ) { return ret ; } ret = ssm2518_set_power ( ssm2518 , false ) ; if ( ret ) { return ret ; } return devm_snd_soc_register_component ( & i2c -> dev , & ssm2518_component_driver , & ssm2518_dai , 1 ) ; } 