static int idtcm_extts_check_channel ( struct idtcm * idtcm , u8 todn ) { struct idtcm_channel * ptp_channel , * extts_channel ; struct ptp_clock_event event ; struct timespec64 ts ; u32 dco_delay ; int err ; extts_channel = & idtcm -> channel [ todn ] ; ptp_channel = idtcm -> event_channel [ todn ] ; if ( extts_channel == ptp_channel ) { dco_delay = ptp_channel -> dco_delay ; } err = _idtcm_gettime_triggered ( extts_channel , & ts ) ; if ( err ) { return err ; } event . type = PTP_CLOCK_EXTTS ; event . index = todn ; event . timestamp = timespec64_to_ns ( & ts ) - dco_delay ; ptp_clock_event ( ptp_channel -> ptp_clock , & event ) ; return err ; } 