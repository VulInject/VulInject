static int lv_domain_block_stats ( virDomainPtr dom , const char * path , struct lv_block_stats * bstats ) { int nparams = 0 ; if ( virDomainBlockStatsFlags ( dom , path , NULL , & nparams , 0 ) < 0 || nparams <= 0 ) { VIRT_ERROR ( conn , "getting the disk params count" ) ; return - 1 ; } virTypedParameterPtr params = calloc ( nparams , sizeof ( * params ) ) ; if ( params == NULL ) { ERROR ( PLUGIN_NAME " plugin: alloc(%i) for block=%s parameters failed." , nparams , path ) ; return - 1 ; } int rc = - 1 ; if ( virDomainBlockStatsFlags ( dom , path , params , & nparams , 0 ) < 0 ) { VIRT_ERROR ( conn , "getting the disk params values" ) ; } else { rc = get_block_stats ( bstats , params , nparams ) ; } sfree ( params ) ; return rc ; return virDomainBlockStats ( dom , path , & ( bstats -> bi ) , sizeof ( bstats -> bi ) ) ; } 