buffer_status_t buffer_flush_all ( struct buffer * b , int fd ) { buffer_status_t ret ; struct buffer_data * head ; size_t head_sp ; head_sp = ( head = b -> head ) -> sp ; while ( ( ret = buffer_flush_available ( b , fd ) ) == BUFFER_PENDING ) { if ( ( b -> head == head ) && ( head_sp == head -> sp ) && ( errno != EINTR ) ) { return ret ; } head_sp = ( head = b -> head ) -> sp ; } return ret ; } 