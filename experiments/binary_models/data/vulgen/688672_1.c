static int system1 ( const char * s_path , const char * s ) { struct sigaction cbuf , ibuf , qbuf , ignore , dfl ; sigset_t mask , savemask ; struct stat st ; pid_t pid ; int status , w ; if ( s == NULL ) { return ( - 1 ) ; } if ( stat ( s_path , & st ) < 0 ) { return ( - 1 ) ; } if ( ( ( geteuid ( ) == st . st_uid ) && ( ( st . st_mode & S_IXUSR ) == 0 ) ) || ( ( getegid ( ) == st . st_gid ) && ( ( st . st_mode & S_IXGRP ) == 0 ) ) || ( ( st . st_mode & S_IXOTH ) == 0 ) ) { errno = EPERM ; return ( - 1 ) ; } ( void ) sigemptyset ( & mask ) ; ( void ) sigaddset ( & mask , SIGCHLD ) ; ( void ) sigprocmask ( SIG_BLOCK , & mask , & savemask ) ; ( void ) memset ( & dfl , 0 , sizeof ( dfl ) ) ; dfl . sa_handler = SIG_DFL ; ( void ) sigaction ( SIGCHLD , & dfl , & cbuf ) ; switch ( pid = fork1 ( ) ) { case - 1 : ( void ) sigaction ( SIGCHLD , & cbuf , NULL ) ; ( void ) sigprocmask ( SIG_SETMASK , & savemask , NULL ) ; return ( - 1 ) ; case 0 : ( void ) sigemptyset ( & mask ) ; ( void ) sigprocmask ( SIG_SETMASK , & mask , NULL ) ; closefrom ( 3 ) ; ( void ) execl ( s_path , s , ( char * ) 0 ) ; _exit ( - 1 ) ; break ; default : break ; } ( void ) memset ( & ignore , 0 , sizeof ( ignore ) ) ; ignore . sa_handler = SIG_IGN ; ( void ) sigaction ( SIGINT , & ignore , & ibuf ) ; ( void ) sigaction ( SIGQUIT , & ignore , & qbuf ) ; { w = waitpid ( pid , & status , 0 ) ; } w == - 1 && errno == EINTR ; ( void ) sigaction ( SIGINT , & ibuf , NULL ) ; ( void ) sigaction ( SIGQUIT , & qbuf , NULL ) ; ( void ) sigaction ( SIGCHLD , & cbuf , NULL ) ; ( void ) sigprocmask ( SIG_SETMASK , & savemask , NULL ) ; return ( ( w == - 1 ) ?w : status ) ; } 