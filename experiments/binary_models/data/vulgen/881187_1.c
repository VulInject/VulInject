static int _is_path_realizable ( Topology_t * topop , Node_t * src , Node_t * dst , DorDirection dir ) { DorTopology_t * dorTop = ( DorTopology_t * ) topop -> routingModule -> data ; DorNode_t * srcDnp = ( DorNode_t * ) src -> routingData ; DorNode_t * dstDnp = ( DorNode_t * ) dst -> routingData ; int i , si = - 1 , di = - 1 ; int goRight = 0 ; int goLeft = 0 ; int ij = DorBitMapsIndex ( src -> swIdx , dst -> swIdx ) ; if ( sm_config . smDorRouting . debug && sm_config . sm_debug_routing ) { IB_LOG_INFINI_INFO_FMT ( __func__ , "Entry [%s] to [%s]dir %s" , sm_nodeDescString ( src ) , sm_nodeDescString ( dst ) , dir == DorAny ?"Any" : ( dir == DorRight ?"Right" : "Left" ) ) ; } if ( src == dst ) { return 1 ; } if ( ijTest ( dorTop -> dorLeft , ij ) || ijTest ( dorTop -> dorRight , ij ) ) { return 1 ; } if ( ijTest ( dorTop -> dorBroken , ij ) ) { return 0 ; } for ( i = 0 ; i < dorTop -> numDimensions ; ++ i ) { si = srcDnp -> coords [ i ] ; di = dstDnp -> coords [ i ] ; if ( si == di ) { continue ; } if ( dir == DorAny ) { if ( si < di ) { if ( dorTop -> toroidal [ i ] && ( si + dorTop -> dimensionLength [ i ] - di <= di - si ) ) { goLeft = 1 ; if ( si + dorTop -> dimensionLength [ i ] - di == di - si ) { goRight = 1 ; } } else { goRight = 1 ; } } else { if ( dorTop -> toroidal [ i ] && ( di - si + dorTop -> dimensionLength [ i ] <= si - di ) ) { goRight = 1 ; if ( di - si + dorTop -> dimensionLength [ i ] == si - di ) { goLeft = 1 ; } } else { goLeft = 1 ; } } } if ( dir == DorRight ) { goRight = 1 ; } else { goLeft = 1 ; } if ( goRight ) { if ( srcDnp -> right [ i ] && ( srcDnp -> right [ i ] == dstDnp || _is_path_realizable ( topop , srcDnp -> right [ i ] -> node , dst , srcDnp -> right [ i ] -> coords [ i ] == di ?DorAny : DorRight ) ) ) { ijSet ( dorTop -> dorRight , ij ) ; } if ( dir == DorAny && ! goLeft && srcDnp -> left [ i ] ) { if ( _is_path_realizable ( topop , srcDnp -> left [ i ] -> node , dst , DorLeft ) ) { ijSet ( dorTop -> dorLeft , ij ) ; } break ; } } if ( goLeft ) { if ( srcDnp -> left [ i ] && ( srcDnp -> left [ i ] == dstDnp || _is_path_realizable ( topop , srcDnp -> left [ i ] -> node , dst , srcDnp -> left [ i ] -> coords [ i ] == di ?DorAny : DorLeft ) ) ) { ijSet ( dorTop -> dorLeft , ij ) ; } if ( dir == DorAny && ! goRight && srcDnp -> right [ i ] ) { if ( _is_path_realizable ( topop , srcDnp -> right [ i ] -> node , dst , DorRight ) ) { ijSet ( dorTop -> dorRight , ij ) ; } } } break ; } if ( ijTest ( dorTop -> dorLeft , ij ) || ijTest ( dorTop -> dorRight , ij ) ) { return 1 ; } else { ijSet ( dorTop -> dorBroken , ij ) ; } return 0 ; } 