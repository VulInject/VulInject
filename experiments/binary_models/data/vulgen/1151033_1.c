php_stream * php_stream_zip_open ( struct zip * arch , struct zip_stat * sb , const char * mode , zip_flags_t flags STREAMS_DC ) { struct zip_file * zf = NULL ; php_stream * stream = NULL ; struct php_zip_stream_data_t * self ; if ( strncmp ( mode , "r" , strlen ( "r" ) ) != 0 ) { return NULL ; } if ( arch ) { zf = zip_fopen_index ( arch , sb -> index , flags ) ; if ( zf ) { self = emalloc ( sizeof ( * self ) ) ; self -> za = NULL ; self -> zf = zf ; self -> stream = NULL ; self -> cursor = 0 ; if ( zip_file_is_seekable ( zf ) > 0 ) { stream = php_stream_alloc ( & php_stream_zipio_seek_ops , self , NULL , mode ) ; } else { stream = php_stream_alloc ( & php_stream_zipio_ops , self , NULL , mode ) ; } } } return stream ; } 