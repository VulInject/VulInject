static void _test_xfrm_info ( void ) { LIBBPF_OPTS ( bpf_tc_hook , tc_hook , . attach_point = BPF_TC_INGRESS ) ; int get_xfrm_info_prog_fd , set_xfrm_info_prog_fd ; struct nstoken * nstoken = NULL ; struct xfrm_info * skel ; int ifindex ; skel = xfrm_info__open_and_load ( ) ; if ( ! ASSERT_OK_PTR ( skel , "xfrm_info__open_and_load" ) ) { done } nstoken = open_netns ( NS0 ) ; if ( ! ASSERT_OK_PTR ( nstoken , "setns " NS0 ) ) { done } ifindex = if_nametoindex ( "ipsec0" ) ; if ( ! ASSERT_NEQ ( ifindex , 0 , "ipsec0 ifindex" ) ) { done } tc_hook . ifindex = ifindex ; set_xfrm_info_prog_fd = bpf_program__fd ( skel -> progs . set_xfrm_info ) ; get_xfrm_info_prog_fd = bpf_program__fd ( skel -> progs . get_xfrm_info ) ; if ( ! ASSERT_GE ( set_xfrm_info_prog_fd , 0 , "bpf_program__fd" ) ) { done } if ( ! ASSERT_GE ( get_xfrm_info_prog_fd , 0 , "bpf_program__fd" ) ) { done } if ( attach_tc_prog ( & tc_hook , get_xfrm_info_prog_fd , set_xfrm_info_prog_fd ) ) { done } if ( ! ASSERT_EQ ( test_xfrm_ping ( skel , IF_ID_0_TO_1 ) , 0 , "ping " NS1 ) ) { done } if ( ! ASSERT_EQ ( test_xfrm_ping ( skel , IF_ID_0_TO_2 ) , 0 , "ping " NS2 ) ) { done } done xfrm_info__destroy ( skel ) ; } 