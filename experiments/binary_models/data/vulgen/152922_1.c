static int mbigen_device_probe ( struct platform_device * pdev ) { struct mbigen_device * mgn_chip ; struct resource * res ; int err ; mgn_chip = devm_kzalloc ( & pdev -> dev , sizeof ( * mgn_chip ) , GFP_KERNEL ) ; if ( ! mgn_chip ) { return - ENOMEM ; } mgn_chip -> pdev = pdev ; res = platform_get_resource ( pdev , IORESOURCE_MEM , 0 ) ; mgn_chip -> base = devm_ioremap ( & pdev -> dev , res -> start , resource_size ( res ) ) ; if ( ! mgn_chip -> base ) { dev_err ( & pdev -> dev , "failed to ioremap %pR\n" , res ) ; return - ENOMEM ; } if ( IS_ENABLED ( CONFIG_OF ) && pdev -> dev . of_node ) { err = mbigen_of_create_domain ( pdev , mgn_chip ) ; } if ( ACPI_COMPANION ( & pdev -> dev ) ) { err = mbigen_acpi_create_domain ( pdev , mgn_chip ) ; } else { err = - EINVAL ; } if ( err ) { dev_err ( & pdev -> dev , "Failed to create mbi-gen irqdomain\n" ) ; return err ; } platform_set_drvdata ( pdev , mgn_chip ) ; return 0 ; } 