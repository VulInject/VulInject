void * mempool_alloc ( struct mempool * pool , size_t size ) { void * p = NULL ; get_pool ( pool ) ; p = raw_malloc ( 0 , 0 , size , pool -> mctx ) ; if ( p ) { raw_malloc_get_stats ( pool -> mctx , & stats ) ; if ( stats . max_allocated > pool -> max_allocated ) { pool -> max_allocated = stats . max_allocated ; DMSG ( "Max memory usage increased to %zu" , pool -> max_allocated ) ; } return p ; } EMSG ( "Failed to allocate %zu bytes, please tune the pool size" , size ) ; put_pool ( pool ) ; return NULL ; } 