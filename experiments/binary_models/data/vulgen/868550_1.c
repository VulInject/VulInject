static void iv_rehash ( mrb_state * mrb , iv_tbl * t ) { int old_alloc = t -> alloc ; int new_alloc = old_alloc + 4 ; mrb_value * old_ptr = t -> ptr ; if ( old_alloc == new_alloc ) { return ; } t -> ptr = ( mrb_value * ) mrb_calloc ( mrb , sizeof ( mrb_value ) + sizeof ( mrb_sym ) , new_alloc ) ; t -> size = 0 ; t -> alloc = new_alloc ; if ( old_alloc == 0 ) { return ; } mrb_sym * keys = ( mrb_sym * ) & old_ptr [ old_alloc ] ; mrb_value * vals = old_ptr ; for ( int i = 0 ; i < old_alloc ; i ++ ) { if ( IV_KEY_P ( keys [ i ] ) ) { iv_put ( mrb , t , keys [ i ] , vals [ i ] ) ; } } mrb_free ( mrb , old_ptr ) ; } 