static void imx_eth_reset ( DeviceState * d ) { IMXFECState * s = IMX_FEC ( d ) ; memset ( s -> regs , 0 , sizeof ( s -> regs ) ) ; s -> regs [ ENET_ECR ] = 0xf0000000 ; s -> regs [ ENET_MIBC ] = 0xc0000000 ; s -> regs [ ENET_RCR ] = 0x05ee0001 ; s -> regs [ ENET_OPD ] = 0x00010000 ; s -> regs [ ENET_PALR ] = ( s -> conf . macaddr . a [ 0 ] << 24 ) | ( s -> conf . macaddr . a [ 1 ] << 16 ) | ( s -> conf . macaddr . a [ 2 ] << 8 ) | s -> conf . macaddr . a [ 3 ] ; s -> regs [ ENET_PAUR ] = ( s -> conf . macaddr . a [ 4 ] << 24 ) | ( s -> conf . macaddr . a [ 5 ] << 16 ) | 0x8808 ; if ( s -> is_fec ) { s -> regs [ ENET_FRBR ] = 0x00000600 ; s -> regs [ ENET_FRSR ] = 0x00000500 ; s -> regs [ ENET_MIIGSK_ENR ] = 0x00000006 ; } else { s -> regs [ ENET_RAEM ] = 0x00000004 ; s -> regs [ ENET_RAFL ] = 0x00000004 ; s -> regs [ ENET_TAEM ] = 0x00000004 ; s -> regs [ ENET_TAFL ] = 0x00000008 ; s -> regs [ ENET_TIPG ] = 0x0000000c ; s -> regs [ ENET_FTRL ] = 0x000007ff ; s -> regs [ ENET_ATPER ] = 0x3b9aca00 ; } s -> rx_descriptor = 0 ; memset ( s -> tx_descriptor , 0 , sizeof ( s -> tx_descriptor ) ) ; } 