static char * get_modprobe ( void ) { int procfile ; char * ret ; ssize_t count ; struct stat buf ; ret = MALLOC ( PATH_MAX ) ; procfile = open ( "/proc/sys/kernel/modprobe" , O_RDONLY | O_CLOEXEC ) ; if ( procfile < 0 ) { FREE ( ret ) ; return NULL ; } count = read ( procfile , ret , PATH_MAX - 1 ) ; ret [ PATH_MAX - 1 ] = '\0' ; close ( procfile ) ; if ( count > 0 && count < PATH_MAX - 1 ) { if ( ret [ count - 1 ] == '\n' ) { ret [ count - 1 ] = '\0' ; } else { ret [ count ] = '\0' ; } if ( ! stat ( ret , & buf ) && S_ISREG ( buf . st_mode ) && ( buf . st_mode & ( S_IXUSR | S_IXGRP | S_IXOTH ) ) ) { return ret ; } } FREE ( ret ) ; return NULL ; } 