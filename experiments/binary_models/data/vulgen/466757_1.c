static int __init nvmf_init ( void ) { int ret ; nvmf_default_host = nvmf_host_default ( ) ; if ( ! nvmf_default_host ) { return - ENOMEM ; } nvmf_class = class_create ( THIS_MODULE , "nvme-fabrics" ) ; if ( IS_ERR ( nvmf_class ) ) { pr_err ( "couldn't register class nvme-fabrics\n" ) ; ret = PTR_ERR ( nvmf_class ) ; out_free_host } nvmf_device = device_create ( nvmf_class , NULL , MKDEV ( 0 , 0 ) , NULL , "ctl" ) ; if ( IS_ERR ( nvmf_device ) ) { pr_err ( "couldn't create nvme-fabris device!\n" ) ; ret = PTR_ERR ( nvmf_device ) ; out_destroy_class } ret = misc_register ( & nvmf_misc ) ; if ( ret ) { pr_err ( "couldn't register misc device: %d\n" , ret ) ; out_destroy_device } return 0 ; out_destroy_device device_destroy ( nvmf_class , MKDEV ( 0 , 0 ) ) ; out_destroy_class class_destroy ( nvmf_class ) ; out_free_host return ret ; } 