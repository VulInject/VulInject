static __INLINE void spi_master_send_recv_irq ( spi_master_instance_t * const p_spi_instance ) { uint8_t rx_byte ; APP_ERROR_CHECK_BOOL ( p_spi_instance != NULL ) ; APP_ERROR_CHECK_BOOL ( p_spi_instance -> state == SPI_MASTER_STATE_BUSY ) ; p_spi_instance -> bytes_count ++ ; rx_byte = p_spi_instance -> p_nrf_spi -> RXD ; if ( p_spi_instance -> start_flag ) { p_spi_instance -> start_flag = false ; spi_master_signal_evt ( p_spi_instance , SPI_MASTER_EVT_FIRST_BYTE_RECEIVED , ( uint16_t ) rx_byte ) ; } if ( p_spi_instance -> abort_flag ) { p_spi_instance -> abort_flag = false ; p_spi_instance -> state = SPI_MASTER_STATE_ABORTED ; spi_master_signal_evt ( p_spi_instance , SPI_MASTER_EVT_TRANSFER_ABORTED , 0 ) ; return ; } if ( ( p_spi_instance -> p_rx_buffer != NULL ) && ( p_spi_instance -> rx_index < p_spi_instance -> rx_length ) ) { p_spi_instance -> p_rx_buffer [ p_spi_instance -> rx_index ++ ] = rx_byte ; } if ( ( p_spi_instance -> tx_index < p_spi_instance -> max_length ) && ( ! ( p_spi_instance -> abort_flag ) ) ) { p_spi_instance -> p_nrf_spi -> TXD = ( ( p_spi_instance -> p_tx_buffer != NULL ) && ( p_spi_instance -> tx_index < p_spi_instance -> tx_length ) ) ?p_spi_instance -> p_tx_buffer [ p_spi_instance -> tx_index ] : SPI_DEFAULT_TX_BYTE ; ( p_spi_instance -> tx_index ) ++ ; } if ( p_spi_instance -> bytes_count >= p_spi_instance -> max_length ) { APP_ERROR_CHECK_BOOL ( p_spi_instance -> bytes_count == p_spi_instance -> max_length ) ; nrf_gpio_pin_set ( p_spi_instance -> pin_slave_select ) ; p_spi_instance -> state = SPI_MASTER_STATE_IDLE ; spi_master_signal_evt ( p_spi_instance , SPI_MASTER_EVT_TRANSFER_COMPLETED , p_spi_instance -> tx_index ) ; } return ; } 