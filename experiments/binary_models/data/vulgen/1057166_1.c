peer_uptime ( , , ) { time_t uptime1 ; struct tm * tm ; if ( len < BGP_UPTIME_LEN ) { zlog_warn ( "peer_uptime (): buffer shortage %lu" , ( u_long ) len ) ; snprintf ( buf , len , "<error>" ) ; return buf ; } if ( uptime2 == 0 ) { snprintf ( buf , len , "never   " ) ; return buf ; } uptime1 = bgp_clock ( ) ; uptime1 -= uptime2 ; tm = gmtime ( & uptime1 ) ; if ( uptime1 < ONE_DAY_SECOND ) { snprintf ( buf , len , "%02dy%02dw%dd" , tm -> tm_year - 70 , tm -> tm_yday / 7 , 0 ) ; } if ( uptime1 < ONE_WEEK_SECOND ) { snprintf ( buf , len , "%dd%02dh%02dm" , tm -> tm_yday , tm -> tm_hour , tm -> tm_min ) ; } if ( uptime1 < ONE_YEAR_SECOND ) { snprintf ( buf , len , "%02dw%dd%02dh" , tm -> tm_yday / 7 , tm -> tm_yday - ( ( tm -> tm_yday / 7 ) * 7 ) , tm -> tm_hour ) ; } else { snprintf ( buf , len , "%02dy%02dw%dd" , tm -> tm_year - 70 , tm -> tm_yday / 7 , tm -> tm_yday - ( ( tm -> tm_yday / 7 ) * 7 ) ) ; } return buf ; } 