static void close_pooled_connection ( CPOOLENT * ptr ) { SQLRETURN ret ; DMHDBC conn = & ptr -> connection ; if ( ! CHECK_SQLDISCONNECT ( conn ) ) { return ; } ret = SQLDISCONNECT ( conn , conn -> driver_dbc ) ; if ( SQL_SUCCEEDED ( ret ) ) { if ( conn -> driver_version >= SQL_OV_ODBC3 ) { if ( CHECK_SQLFREEHANDLE ( conn ) ) { SQLFREEHANDLE ( conn , SQL_HANDLE_DBC , conn -> driver_dbc ) ; } if ( CHECK_SQLFREECONNECT ( conn ) ) { SQLFREECONNECT ( conn , conn -> driver_dbc ) ; } } else { if ( CHECK_SQLFREECONNECT ( conn ) ) { SQLFREECONNECT ( conn , conn -> driver_dbc ) ; } if ( CHECK_SQLFREEHANDLE ( conn ) ) { SQLFREEHANDLE ( conn , SQL_HANDLE_DBC , conn -> driver_dbc ) ; } } conn -> driver_dbc = ( DRV_SQLHANDLE ) NULL ; release_env ( conn ) ; conn -> driver_env = ( DRV_SQLHANDLE ) NULL ; if ( conn -> cl_handle ) { odbc_dlclose ( conn -> cl_handle ) ; conn -> cl_handle = NULL ; } if ( conn -> dl_handle ) { if ( ! conn -> dont_dlclose ) { if ( conn -> fini_func . func ) { conn -> fini_func . func ( ) ; } odbc_dlclose ( ptr -> connection . dl_handle ) ; } conn -> dl_handle = NULL ; } if ( conn -> functions ) { conn -> functions = NULL ; } } else { conn -> driver_dbc = ( DRV_SQLHANDLE ) NULL ; conn -> driver_env = ( DRV_SQLHANDLE ) NULL ; if ( conn -> cl_handle ) { odbc_dlclose ( conn -> cl_handle ) ; conn -> cl_handle = NULL ; } if ( conn -> dl_handle ) { if ( ! conn -> dont_dlclose ) { if ( conn -> fini_func . func ) { conn -> fini_func . func ( ) ; } odbc_dlclose ( conn -> dl_handle ) ; } conn -> dl_handle = NULL ; } if ( conn -> functions ) { free ( conn -> functions ) ; conn -> functions = NULL ; } } __clean_stmt_from_dbc ( conn ) ; __clean_desc_from_dbc ( conn ) ; if ( ptr -> connection . iconv_cd_ascii_to_uc != ( iconv_t ) ( - 1 ) ) { iconv_close ( ptr -> connection . iconv_cd_ascii_to_uc ) ; ptr -> connection . iconv_cd_ascii_to_uc = ( iconv_t ) ( - 1 ) ; } if ( ptr -> connection . iconv_cd_uc_to_ascii != ( iconv_t ) ( - 1 ) ) { iconv_close ( ptr -> connection . iconv_cd_uc_to_ascii ) ; ptr -> connection . iconv_cd_uc_to_ascii = ( iconv_t ) ( - 1 ) ; } } 