void viafb_load_FIFO_reg ( int set_iga , int hor_active , int ver_active ) { int reg_value ; int viafb_load_reg_num ; struct io_register * reg = NULL ; int iga1_fifo_max_depth = 0 , iga1_fifo_threshold = 0 , iga1_fifo_high_threshold = 0 , iga1_display_queue_expire_num = 0 ; int iga2_fifo_max_depth = 0 , iga2_fifo_threshold = 0 , iga2_fifo_high_threshold = 0 , iga2_display_queue_expire_num = 0 ; if ( set_iga == IGA1 ) { if ( viaparinfo -> chip_info -> gfx_chip_name == UNICHROME_K800 ) { iga1_fifo_max_depth = K800_IGA1_FIFO_MAX_DEPTH ; iga1_fifo_threshold = K800_IGA1_FIFO_THRESHOLD ; iga1_fifo_high_threshold = K800_IGA1_FIFO_HIGH_THRESHOLD ; if ( ( hor_active > 1280 ) && ( ver_active > 1024 ) ) { iga1_display_queue_expire_num = 16 ; } else { iga1_display_queue_expire_num = K800_IGA1_DISPLAY_QUEUE_EXPIRE_NUM ; } } if ( viaparinfo -> chip_info -> gfx_chip_name == UNICHROME_PM800 ) { iga1_fifo_max_depth = P880_IGA1_FIFO_MAX_DEPTH ; iga1_fifo_threshold = P880_IGA1_FIFO_THRESHOLD ; iga1_fifo_high_threshold = P880_IGA1_FIFO_HIGH_THRESHOLD ; iga1_display_queue_expire_num = P880_IGA1_DISPLAY_QUEUE_EXPIRE_NUM ; if ( ( hor_active > 1280 ) && ( ver_active > 1024 ) ) { iga1_display_queue_expire_num = 16 ; } else { iga1_display_queue_expire_num = P880_IGA1_DISPLAY_QUEUE_EXPIRE_NUM ; } } if ( viaparinfo -> chip_info -> gfx_chip_name == UNICHROME_CN700 ) { iga1_fifo_max_depth = CN700_IGA1_FIFO_MAX_DEPTH ; iga1_fifo_threshold = CN700_IGA1_FIFO_THRESHOLD ; iga1_fifo_high_threshold = CN700_IGA1_FIFO_HIGH_THRESHOLD ; if ( ( hor_active > 1280 ) && ( ver_active > 1024 ) ) { iga1_display_queue_expire_num = 16 ; } else { iga1_display_queue_expire_num = CN700_IGA1_DISPLAY_QUEUE_EXPIRE_NUM ; } } if ( viaparinfo -> chip_info -> gfx_chip_name == UNICHROME_CX700 ) { iga1_fifo_max_depth = CX700_IGA1_FIFO_MAX_DEPTH ; iga1_fifo_threshold = CX700_IGA1_FIFO_THRESHOLD ; iga1_fifo_high_threshold = CX700_IGA1_FIFO_HIGH_THRESHOLD ; iga1_display_queue_expire_num = CX700_IGA1_DISPLAY_QUEUE_EXPIRE_NUM ; } if ( viaparinfo -> chip_info -> gfx_chip_name == UNICHROME_K8M890 ) { iga1_fifo_max_depth = K8M890_IGA1_FIFO_MAX_DEPTH ; iga1_fifo_threshold = K8M890_IGA1_FIFO_THRESHOLD ; iga1_fifo_high_threshold = K8M890_IGA1_FIFO_HIGH_THRESHOLD ; iga1_display_queue_expire_num = K8M890_IGA1_DISPLAY_QUEUE_EXPIRE_NUM ; } if ( viaparinfo -> chip_info -> gfx_chip_name == UNICHROME_P4M890 ) { iga1_fifo_max_depth = P4M890_IGA1_FIFO_MAX_DEPTH ; iga1_fifo_threshold = P4M890_IGA1_FIFO_THRESHOLD ; iga1_fifo_high_threshold = P4M890_IGA1_FIFO_HIGH_THRESHOLD ; iga1_display_queue_expire_num = P4M890_IGA1_DISPLAY_QUEUE_EXPIRE_NUM ; } if ( viaparinfo -> chip_info -> gfx_chip_name == UNICHROME_P4M900 ) { iga1_fifo_max_depth = P4M900_IGA1_FIFO_MAX_DEPTH ; iga1_fifo_threshold = P4M900_IGA1_FIFO_THRESHOLD ; iga1_fifo_high_threshold = P4M900_IGA1_FIFO_HIGH_THRESHOLD ; iga1_display_queue_expire_num = P4M900_IGA1_DISPLAY_QUEUE_EXPIRE_NUM ; } if ( viaparinfo -> chip_info -> gfx_chip_name == UNICHROME_VX800 ) { iga1_fifo_max_depth = VX800_IGA1_FIFO_MAX_DEPTH ; iga1_fifo_threshold = VX800_IGA1_FIFO_THRESHOLD ; iga1_fifo_high_threshold = VX800_IGA1_FIFO_HIGH_THRESHOLD ; iga1_display_queue_expire_num = VX800_IGA1_DISPLAY_QUEUE_EXPIRE_NUM ; } if ( viaparinfo -> chip_info -> gfx_chip_name == UNICHROME_VX855 ) { iga1_fifo_max_depth = VX855_IGA1_FIFO_MAX_DEPTH ; iga1_fifo_threshold = VX855_IGA1_FIFO_THRESHOLD ; iga1_fifo_high_threshold = VX855_IGA1_FIFO_HIGH_THRESHOLD ; iga1_display_queue_expire_num = VX855_IGA1_DISPLAY_QUEUE_EXPIRE_NUM ; } if ( viaparinfo -> chip_info -> gfx_chip_name == UNICHROME_VX900 ) { iga1_fifo_max_depth = VX900_IGA1_FIFO_MAX_DEPTH ; iga1_fifo_threshold = VX900_IGA1_FIFO_THRESHOLD ; iga1_fifo_high_threshold = VX900_IGA1_FIFO_HIGH_THRESHOLD ; iga1_display_queue_expire_num = VX900_IGA1_DISPLAY_QUEUE_EXPIRE_NUM ; } reg_value = IGA1_FIFO_DEPTH_SELECT_FORMULA ( iga1_fifo_max_depth ) ; viafb_load_reg_num = display_fifo_depth_reg . iga1_fifo_depth_select_reg . reg_num ; reg = display_fifo_depth_reg . iga1_fifo_depth_select_reg . reg ; viafb_load_reg ( reg_value , viafb_load_reg_num , reg , VIASR ) ; reg_value = IGA1_FIFO_THRESHOLD_FORMULA ( iga1_fifo_threshold ) ; viafb_load_reg_num = fifo_threshold_select_reg . iga1_fifo_threshold_select_reg . reg_num ; reg = fifo_threshold_select_reg . iga1_fifo_threshold_select_reg . reg ; viafb_load_reg ( reg_value , viafb_load_reg_num , reg , VIASR ) ; reg_value = IGA1_FIFO_HIGH_THRESHOLD_FORMULA ( iga1_fifo_high_threshold ) ; viafb_load_reg_num = fifo_high_threshold_select_reg . iga1_fifo_high_threshold_select_reg . reg_num ; reg = fifo_high_threshold_select_reg . iga1_fifo_high_threshold_select_reg . reg ; viafb_load_reg ( reg_value , viafb_load_reg_num , reg , VIASR ) ; reg_value = IGA1_DISPLAY_QUEUE_EXPIRE_NUM_FORMULA ( iga1_display_queue_expire_num ) ; viafb_load_reg_num = display_queue_expire_num_reg . iga1_display_queue_expire_num_reg . reg_num ; reg = display_queue_expire_num_reg . iga1_display_queue_expire_num_reg . reg ; viafb_load_reg ( reg_value , viafb_load_reg_num , reg , VIASR ) ; } else { if ( viaparinfo -> chip_info -> gfx_chip_name == UNICHROME_K800 ) { iga2_fifo_max_depth = K800_IGA2_FIFO_MAX_DEPTH ; iga2_fifo_threshold = K800_IGA2_FIFO_THRESHOLD ; iga2_fifo_high_threshold = K800_IGA2_FIFO_HIGH_THRESHOLD ; if ( ( hor_active > 1280 ) && ( ver_active > 1024 ) ) { iga2_display_queue_expire_num = 16 ; } else { iga2_display_queue_expire_num = K800_IGA2_DISPLAY_QUEUE_EXPIRE_NUM ; } } if ( viaparinfo -> chip_info -> gfx_chip_name == UNICHROME_PM800 ) { iga2_fifo_max_depth = P880_IGA2_FIFO_MAX_DEPTH ; iga2_fifo_threshold = P880_IGA2_FIFO_THRESHOLD ; iga2_fifo_high_threshold = P880_IGA2_FIFO_HIGH_THRESHOLD ; if ( ( hor_active > 1280 ) && ( ver_active > 1024 ) ) { iga2_display_queue_expire_num = 16 ; } else { iga2_display_queue_expire_num = P880_IGA2_DISPLAY_QUEUE_EXPIRE_NUM ; } } if ( viaparinfo -> chip_info -> gfx_chip_name == UNICHROME_CN700 ) { iga2_fifo_max_depth = CN700_IGA2_FIFO_MAX_DEPTH ; iga2_fifo_threshold = CN700_IGA2_FIFO_THRESHOLD ; iga2_fifo_high_threshold = CN700_IGA2_FIFO_HIGH_THRESHOLD ; if ( ( hor_active > 1280 ) && ( ver_active > 1024 ) ) { iga2_display_queue_expire_num = 16 ; } else { iga2_display_queue_expire_num = CN700_IGA2_DISPLAY_QUEUE_EXPIRE_NUM ; } } if ( viaparinfo -> chip_info -> gfx_chip_name == UNICHROME_CX700 ) { iga2_fifo_max_depth = CX700_IGA2_FIFO_MAX_DEPTH ; iga2_fifo_threshold = CX700_IGA2_FIFO_THRESHOLD ; iga2_fifo_high_threshold = CX700_IGA2_FIFO_HIGH_THRESHOLD ; iga2_display_queue_expire_num = CX700_IGA2_DISPLAY_QUEUE_EXPIRE_NUM ; } if ( viaparinfo -> chip_info -> gfx_chip_name == UNICHROME_K8M890 ) { iga2_fifo_max_depth = K8M890_IGA2_FIFO_MAX_DEPTH ; iga2_fifo_threshold = K8M890_IGA2_FIFO_THRESHOLD ; iga2_fifo_high_threshold = K8M890_IGA2_FIFO_HIGH_THRESHOLD ; iga2_display_queue_expire_num = K8M890_IGA2_DISPLAY_QUEUE_EXPIRE_NUM ; } if ( viaparinfo -> chip_info -> gfx_chip_name == UNICHROME_P4M890 ) { iga2_fifo_max_depth = P4M890_IGA2_FIFO_MAX_DEPTH ; iga2_fifo_threshold = P4M890_IGA2_FIFO_THRESHOLD ; iga2_fifo_high_threshold = P4M890_IGA2_FIFO_HIGH_THRESHOLD ; iga2_display_queue_expire_num = P4M890_IGA2_DISPLAY_QUEUE_EXPIRE_NUM ; } if ( viaparinfo -> chip_info -> gfx_chip_name == UNICHROME_P4M900 ) { iga2_fifo_max_depth = P4M900_IGA2_FIFO_MAX_DEPTH ; iga2_fifo_threshold = P4M900_IGA2_FIFO_THRESHOLD ; iga2_fifo_high_threshold = P4M900_IGA2_FIFO_HIGH_THRESHOLD ; iga2_display_queue_expire_num = P4M900_IGA2_DISPLAY_QUEUE_EXPIRE_NUM ; } if ( viaparinfo -> chip_info -> gfx_chip_name == UNICHROME_VX800 ) { iga2_fifo_max_depth = VX800_IGA2_FIFO_MAX_DEPTH ; iga2_fifo_threshold = VX800_IGA2_FIFO_THRESHOLD ; iga2_fifo_high_threshold = VX800_IGA2_FIFO_HIGH_THRESHOLD ; iga2_display_queue_expire_num = VX800_IGA2_DISPLAY_QUEUE_EXPIRE_NUM ; } if ( viaparinfo -> chip_info -> gfx_chip_name == UNICHROME_VX855 ) { iga2_fifo_max_depth = VX855_IGA2_FIFO_MAX_DEPTH ; iga2_fifo_threshold = VX855_IGA2_FIFO_THRESHOLD ; iga2_fifo_high_threshold = VX855_IGA2_FIFO_HIGH_THRESHOLD ; iga2_display_queue_expire_num = VX855_IGA2_DISPLAY_QUEUE_EXPIRE_NUM ; } if ( viaparinfo -> chip_info -> gfx_chip_name == UNICHROME_K800 ) { reg_value = IGA2_FIFO_DEPTH_SELECT_FORMULA ( iga2_fifo_max_depth ) - 1 ; viafb_load_reg_num = display_fifo_depth_reg . iga2_fifo_depth_select_reg . reg_num ; reg = display_fifo_depth_reg . iga2_fifo_depth_select_reg . reg ; viafb_load_reg ( reg_value , viafb_load_reg_num , reg , VIACR ) ; } else { reg_value = IGA2_FIFO_DEPTH_SELECT_FORMULA ( iga2_fifo_max_depth ) ; viafb_load_reg_num = display_fifo_depth_reg . iga2_fifo_depth_select_reg . reg_num ; reg = display_fifo_depth_reg . iga2_fifo_depth_select_reg . reg ; viafb_load_reg ( reg_value , viafb_load_reg_num , reg , VIACR ) ; } reg_value = IGA2_FIFO_THRESHOLD_FORMULA ( iga2_fifo_threshold ) ; viafb_load_reg_num = fifo_threshold_select_reg . iga2_fifo_threshold_select_reg . reg_num ; reg = fifo_threshold_select_reg . iga2_fifo_threshold_select_reg . reg ; viafb_load_reg ( reg_value , viafb_load_reg_num , reg , VIACR ) ; reg_value = IGA2_FIFO_HIGH_THRESHOLD_FORMULA ( iga2_fifo_high_threshold ) ; viafb_load_reg_num = fifo_high_threshold_select_reg . iga2_fifo_high_threshold_select_reg . reg_num ; reg = fifo_high_threshold_select_reg . iga2_fifo_high_threshold_select_reg . reg ; viafb_load_reg ( reg_value , viafb_load_reg_num , reg , VIACR ) ; reg_value = IGA2_DISPLAY_QUEUE_EXPIRE_NUM_FORMULA ( iga2_display_queue_expire_num ) ; viafb_load_reg_num = display_queue_expire_num_reg . iga2_display_queue_expire_num_reg . reg_num ; reg = display_queue_expire_num_reg . iga2_display_queue_expire_num_reg . reg ; viafb_load_reg ( reg_value , viafb_load_reg_num , reg , VIACR ) ; } } 