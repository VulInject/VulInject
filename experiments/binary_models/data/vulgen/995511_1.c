FIELD_PREP ( CDNS_XSPI_CMD_INSTR_TYPE , ( data_phase ) ?CDNS_XSPI_STIG_INSTR_TYPE_1 : CDNS_XSPI_STIG_INSTR_TYPE_0 ) | FIELD_PREP ( CDNS_XSPI_CMD_P1_R1_ADDR0 , ( op ) -> addr . val & 0xff ) ; FIELD_PREP ( CDNS_XSPI_CMD_P1_R2_ADDR1 , ( ( op ) -> addr . val >> 8 ) & 0xFF ) | FIELD_PREP ( CDNS_XSPI_CMD_P1_R2_ADDR2 , ( ( op ) -> addr . val >> 16 ) & 0xFF ) | FIELD_PREP ( CDNS_XSPI_CMD_P1_R2_ADDR3 , ( ( op ) -> addr . val >> 24 ) & 0xFF ) | FIELD_PREP ( CDNS_XSPI_CMD_P1_R2_ADDR4 , ( ( op ) -> addr . val >> 32 ) & 0xFF ) ; FIELD_PREP ( CDNS_XSPI_CMD_P1_R3_ADDR5 , ( ( op ) -> addr . val >> 40 ) & 0xFF ) | FIELD_PREP ( CDNS_XSPI_CMD_P1_R3_CMD , ( op ) -> cmd . opcode ) | FIELD_PREP ( CDNS_XSPI_CMD_P1_R3_NUM_ADDR_BYTES , ( op ) -> addr . nbytes ) ; FIELD_PREP ( CDNS_XSPI_CMD_P1_R4_ADDR_IOS , ilog2 ( ( op ) -> addr . buswidth ) ) | FIELD_PREP ( CDNS_XSPI_CMD_P1_R4_CMD_IOS , ilog2 ( ( op ) -> cmd . buswidth ) ) | FIELD_PREP ( CDNS_XSPI_CMD_P1_R4_BANK , chipsel ) ; FIELD_PREP ( , ) FIELD_PREP ( , 0xFFFF ) FIELD_PREP ( CDNS_XSPI_CMD_DSEQ_R3_DCNT_H , ( ( op ) -> data . nbytes >> 16 ) & 0xffff ) | FIELD_PREP ( CDNS_XSPI_CMD_DSEQ_R3_NUM_OF_DUMMY , ( op ) -> dummy . buswidth != 0 ?( ( ( op ) -> dummy . nbytes * 8 ) / ( op ) -> dummy . buswidth ) : 0 ) ; cdns_xspi_stig_instr_type { CDNS_XSPI_STIG_INSTR_TYPE_0 , CDNS_XSPI_STIG_INSTR_TYPE_1 , CDNS_XSPI_STIG_INSTR_TYPE_DATA_SEQ = 127 } cdns_xspi_sdma_dir { CDNS_XSPI_SDMA_DIR_READ , CDNS_XSPI_SDMA_DIR_WRITE } cdns_xspi_stig_cmd_dir { CDNS_XSPI_STIG_CMD_DIR_READ , CDNS_XSPI_STIG_CMD_DIR_WRITE } cdns_xspi_dev { struct platform_device * pdev ; struct device * dev ; void __iomem * iobase ; void __iomem * auxbase ; void __iomem * sdmabase ; int irq ; int cur_cs ; unsigned int sdmasize ; struct completion cmd_complete ; struct completion auto_cmd_complete ; struct completion sdma_complete ; bool sdma_error ; void * in_buffer ; const void * out_buffer ; u8 hw_num_banks ; } 