USB_OTG_Status OTGD_FS_FlushTxFifo ( uint32_t num ) { USB_OTG_Status status = USB_OTG_OK ; __IO USB_OTG_GRSTCTL_TypeDef greset ; uint32_t timeout = 0 ; greset . d32 = 0 ; greset . b . txfflsh = 1 ; greset . b . txfnum = num ; USB_OTG_WRITE_REG32 ( & USB_OTG_FS_regs . GREGS -> GRSTCTL , greset . d32 ) ; { greset . d32 = USB_OTG_READ_REG32 ( & USB_OTG_FS_regs . GREGS -> GRSTCTL ) ; } greset . b . txfflsh == 1 ; uDELAY ( 5 ) ; return status ; } 