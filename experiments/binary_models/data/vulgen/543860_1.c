static int intel_pcie_get_resources ( struct platform_device * pdev ) { struct intel_pcie * pcie = platform_get_drvdata ( pdev ) ; struct dw_pcie * pci = & pcie -> pci ; struct device * dev = pci -> dev ; int ret ; pcie -> core_clk = devm_clk_get ( dev , NULL ) ; if ( IS_ERR ( pcie -> core_clk ) ) { ret = PTR_ERR ( pcie -> core_clk ) ; if ( ret != - EPROBE_DEFER ) { dev_err ( dev , "Failed to get clks: %d\n" , ret ) ; } return ret ; } pcie -> core_rst = devm_reset_control_get ( dev , NULL ) ; if ( IS_ERR ( pcie -> core_rst ) ) { ret = PTR_ERR ( pcie -> core_rst ) ; if ( ret != - EPROBE_DEFER ) { dev_err ( dev , "Failed to get resets: %d\n" , ret ) ; } return ret ; } ret = device_property_read_u32 ( dev , "reset-assert-ms" , & pcie -> rst_intrvl ) ; if ( ret ) { pcie -> rst_intrvl = RESET_INTERVAL_MS ; } pcie -> app_base = devm_platform_ioremap_resource_byname ( pdev , "app" ) ; if ( IS_ERR ( pcie -> app_base ) ) { return PTR_ERR ( pcie -> app_base ) ; } if ( IS_ERR ( pcie -> phy ) ) { ret = PTR_ERR ( pcie -> phy ) ; if ( ret != - EPROBE_DEFER ) { dev_err ( dev , "Couldn't get pcie-phy: %d\n" , ret ) ; } return ret ; } return 0 ; } 