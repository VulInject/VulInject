SYSCALL_DEFINE3 ( , , , , , , ) { struct pci_controller * hose ; struct pci_bus * tmp_bus , * bus = NULL ; struct device_node * hose_node ; if ( in_bus == 0 && of_machine_is_compatible ( "MacRISC4" ) ) { struct device_node * agp ; agp = of_find_compatible_node ( NULL , NULL , "u3-agp" ) ; if ( agp ) { in_bus = 0xf0 ; } } list_for_each_entry ( , , ) { if ( in_bus >= tmp_bus -> number && in_bus <= tmp_bus -> busn_res . end ) { bus = tmp_bus ; break ; } } if ( bus == NULL || bus -> dev . of_node == NULL ) { return - ENODEV ; } hose_node = bus -> dev . of_node ; hose = PCI_DN ( hose_node ) -> phb ; switch ( which ) { case IOBASE_BRIDGE_NUMBER : return ( long ) hose -> first_busno ; case IOBASE_MEMORY : return ( long ) hose -> mem_offset [ 0 ] ; case IOBASE_IO : return ( long ) hose -> io_base_phys ; case IOBASE_ISA_IO : return ( long ) isa_io_base ; case IOBASE_ISA_MEM : return - EINVAL ; } return - EOPNOTSUPP ; } 