void ath_scan_complete ( struct ath_softc * sc , bool abort ) { struct ath_common * common = ath9k_hw_common ( sc -> sc_ah ) ; struct cfg80211_scan_info info = { . aborted = abort } ; if ( abort ) { ath_dbg ( common , CHAN_CTX , "HW scan aborted\n" ) ; } else { ath_dbg ( common , CHAN_CTX , "HW scan complete\n" ) ; } sc -> offchannel . scan_req = NULL ; sc -> offchannel . scan_vif = NULL ; sc -> offchannel . state = ATH_OFFCHANNEL_IDLE ; ieee80211_scan_completed ( sc -> hw , & info ) ; clear_bit ( ATH_OP_SCANNING , & common -> op_flags ) ; spin_lock_bh ( & sc -> chan_lock ) ; spin_unlock_bh ( & sc -> chan_lock ) ; ath_offchannel_next ( sc ) ; ath9k_ps_restore ( sc ) ; } 