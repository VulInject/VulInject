void _rtl92cu_phy_lc_calibrate ( struct ieee80211_hw * hw , bool is2t ) { u8 tmpreg ; u32 rf_a_mode = 0 , rf_b_mode = 0 , lc_cal ; struct rtl_priv * rtlpriv = rtl_priv ( hw ) ; tmpreg = rtl_read_byte ( rtlpriv , 0xd03 ) ; if ( ( tmpreg & 0x70 ) != 0 ) { rtl_write_byte ( rtlpriv , 0xd03 , tmpreg & 0x8F ) ; } else { rtl_write_byte ( rtlpriv , REG_TXPAUSE , 0 ) ; } if ( ( tmpreg & 0x70 ) != 0 ) { rf_a_mode = rtl_get_rfreg ( hw , RF90_PATH_A , 0x00 , MASK12BITS ) ; if ( is2t ) { rf_b_mode = rtl_get_rfreg ( hw , RF90_PATH_B , 0x00 , MASK12BITS ) ; } rtl_set_rfreg ( hw , RF90_PATH_A , 0x00 , MASK12BITS , ( rf_a_mode & 0x8FFFF ) | 0x10000 ) ; if ( is2t ) { rtl_set_rfreg ( hw , RF90_PATH_B , 0x00 , MASK12BITS , ( rf_b_mode & 0x8FFFF ) | 0x10000 ) ; } } lc_cal = rtl_get_rfreg ( hw , RF90_PATH_A , 0x18 , MASK12BITS ) ; rtl_set_rfreg ( hw , RF90_PATH_A , 0x18 , MASK12BITS , lc_cal | 0x08000 ) ; mdelay ( 100 ) ; if ( ( tmpreg & 0x70 ) != 0 ) { rtl_write_byte ( rtlpriv , 0xd03 , tmpreg ) ; rtl_set_rfreg ( hw , RF90_PATH_A , 0x00 , MASK12BITS , rf_a_mode ) ; if ( is2t ) { rtl_set_rfreg ( hw , RF90_PATH_B , 0x00 , MASK12BITS , rf_b_mode ) ; } } else { rtl_write_byte ( rtlpriv , REG_TXPAUSE , 0x00 ) ; } } 