static void nix_txsch_alloc ( struct rvu * rvu , struct nix_txsch * txsch , struct nix_txsch_alloc_rsp * rsp , int lvl , int start , int end ) { struct rvu_hwinfo * hw = rvu -> hw ; u16 pcifunc = rsp -> hdr . pcifunc ; int idx , schq ; if ( lvl >= hw -> cap . nix_tx_aggr_lvl ) { if ( rsp -> schq_contig [ lvl ] ) { rsp -> schq_contig [ lvl ] = 1 ; rsp -> schq_contig_list [ lvl ] [ 0 ] = start ; } if ( rsp -> schq_contig [ lvl ] ) { rsp -> schq [ lvl ] = 0 ; } if ( rsp -> schq [ lvl ] ) { rsp -> schq [ lvl ] = 1 ; rsp -> schq_list [ lvl ] [ 0 ] = start ; } return ; } if ( hw -> cap . nix_fixed_txschq_mapping ) { idx = pcifunc & RVU_PFVF_FUNC_MASK ; schq = start + idx ; if ( idx >= ( end - start ) || test_bit ( schq , txsch -> schq . bmap ) ) { rsp -> schq_contig [ lvl ] = 0 ; rsp -> schq [ lvl ] = 0 ; return ; } if ( rsp -> schq_contig [ lvl ] ) { rsp -> schq_contig [ lvl ] = 1 ; set_bit ( schq , txsch -> schq . bmap ) ; rsp -> schq_contig_list [ lvl ] [ 0 ] = schq ; rsp -> schq [ lvl ] = 0 ; } if ( rsp -> schq [ lvl ] ) { rsp -> schq [ lvl ] = 1 ; set_bit ( schq , txsch -> schq . bmap ) ; rsp -> schq_list [ lvl ] [ 0 ] = schq ; } return ; } if ( rsp -> schq_contig [ lvl ] ) { schq = bitmap_find_next_zero_area ( txsch -> schq . bmap , txsch -> schq . max , start , rsp -> schq_contig [ lvl ] , 0 ) ; if ( schq >= end ) { rsp -> schq_contig [ lvl ] = 0 ; } for ( idx = 0 ; idx < rsp -> schq_contig [ lvl ] ; idx ++ ) { set_bit ( schq , txsch -> schq . bmap ) ; rsp -> schq_contig_list [ lvl ] [ idx ] = schq ; schq ++ ; } } if ( rsp -> schq [ lvl ] ) { idx = 0 ; for ( schq = start ; schq < end ; schq ++ ) { if ( ! test_bit ( schq , txsch -> schq . bmap ) ) { set_bit ( schq , txsch -> schq . bmap ) ; rsp -> schq_list [ lvl ] [ idx ++ ] = schq ; } } rsp -> schq [ lvl ] = idx ; } } 