static void fill_sec_cpl_for_aead ( struct cpl_tx_sec_pdu * sec_cpl , unsigned int dst_size , struct aead_request * req , unsigned short op_type , struct chcr_context * chcrctx ) { struct crypto_aead * tfm = crypto_aead_reqtfm ( req ) ; struct chcr_aead_ctx * aeadctx = AEAD_CTX ( crypto_aead_ctx ( tfm ) ) ; unsigned int ivsize = AES_BLOCK_SIZE ; unsigned int cipher_mode = CHCR_SCMD_CIPHER_MODE_AES_CCM ; unsigned int mac_mode = CHCR_SCMD_AUTH_MODE_CBCMAC ; unsigned int c_id = chcrctx -> dev -> rx_channel_id ; unsigned int ccm_xtra ; unsigned char tag_offset = 0 , auth_offset = 0 ; unsigned int assoclen ; if ( get_aead_subtype ( tfm ) == CRYPTO_ALG_SUB_TYPE_AEAD_RFC4309 ) { assoclen = req -> assoclen - 8 ; } else { assoclen = req -> assoclen ; } ccm_xtra = CCM_B0_SIZE + ( ( assoclen ) ?CCM_AAD_FIELD_SIZE : 0 ) ; auth_offset = req -> cryptlen ?( assoclen + ivsize + 1 + ccm_xtra ) : 0 ; sec_cpl -> op_ivinsrtofst = FILL_SEC_CPL_OP_IVINSR ( c_id , 2 , ( ivsize ?( assoclen + 1 ) : 0 ) + ccm_xtra ) ; sec_cpl -> pldlen = htonl ( assoclen + ivsize + req -> cryptlen + ccm_xtra ) ; sec_cpl -> aadstart_cipherstop_hi = FILL_SEC_CPL_CIPHERSTOP_HI ( 1 , assoclen + ccm_xtra , assoclen + ivsize + 1 + ccm_xtra , 0 ) ; sec_cpl -> cipherstop_lo_authinsert = FILL_SEC_CPL_AUTHINSERT ( 0 , auth_offset , tag_offset , ( op_type == CHCR_ENCRYPT_OP ) ?0 : crypto_aead_authsize ( tfm ) ) ; sec_cpl -> seqno_numivs = FILL_SEC_CPL_SCMD0_SEQNO ( op_type , ( op_type == CHCR_ENCRYPT_OP ) ?0 : 1 , cipher_mode , mac_mode , aeadctx -> hmac_ctrl , ivsize >> 1 ) ; sec_cpl -> ivgen_hdrlen = FILL_SEC_CPL_IVGEN_HDRLEN ( 0 , 0 , 1 , 0 , 1 , dst_size ) ; } 