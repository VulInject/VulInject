static void fd_close ( int fd , void * d ) { struct fd_chan * data = d ; int err ; if ( ! data -> raw || ! isatty ( fd ) ) { return ; } if ( err ) { printk ( UM_KERN_ERR "Failed to restore terminal state - " "errno = %d\n" , - err ) ; } data -> raw = 0 ; } const struct chan_ops fd_ops = { . type = "fd" . init = fd_init . open = fd_open . close = fd_close . read = generic_read . write = generic_write . console_write = generic_console_write . window_size = generic_window_size . free = generic_free . winch = 1 } ; 