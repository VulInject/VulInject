static void lm_tcp_indicate_fin_received ( struct _lm_device_t * pdev , lm_tcp_state_t * tcp ) { lm_tcp_con_t * rx_con ; u8_t ip_version ; MM_INIT_TCP_LOCK_HANDLE ( ) ; DbgMessage ( pdev , INFORMl4rx , "##lm_tcp_indicate_fin_received cid=%d\n" , tcp -> cid ) ; DbgBreakIf ( ! ( pdev && tcp ) ) ; ip_version = ( tcp -> path -> path_const . ip_version == IP_VERSION_IPV4 ) ?STATS_IP_4_IDX : STATS_IP_6_IDX ; LM_COMMON_DRV_STATS_ATOMIC_INC_TOE ( pdev , ipv [ ip_version ] . in_fin ) ; rx_con = tcp -> rx_con ; mm_acquire_tcp_lock ( pdev , rx_con ) ; rx_con -> u . rx . flags &= ~ TCP_CON_FIN_IND_PENDING ; DbgBreakIf ( rx_con -> flags & TCP_REMOTE_FIN_RECEIVED_ALL_RX_INDICATED ) ; rx_con -> flags |= TCP_REMOTE_FIN_RECEIVED_ALL_RX_INDICATED ; mm_release_tcp_lock ( pdev , rx_con ) ; mm_tcp_indicate_fin_received ( pdev , tcp ) ; } 