krb5_error_code krb5_ldap_parse_principal_name ( char * i_princ_name , char * * o_princ_name ) { const char * at_rlm_name , * p ; struct k5buf buf ; at_rlm_name = strrchr ( i_princ_name , '@' ) ; if ( ! at_rlm_name ) { * o_princ_name = strdup ( i_princ_name ) ; } else { k5_buf_init_dynamic ( & buf ) ; for ( p = i_princ_name ; p < at_rlm_name ; p ++ ) { if ( * p == '@' ) { k5_buf_add ( & buf , "\\" ) ; } k5_buf_add_len ( & buf , p , 1 ) ; } k5_buf_add ( & buf , at_rlm_name ) ; if ( k5_buf_status ( & buf ) != 0 ) { return ENOMEM ; } * o_princ_name = buf . data ; } return 0 ; } 