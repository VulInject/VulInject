static char * RecursiveReplace ( char * format , printmap_t * printmap ) { int i = 0 ; while ( printmap [ i ] . printmode ) { char * s , * r ; s = strstr ( format , printmap [ i ] . printmode ) ; if ( s && printmap [ i ] . Format && s != format ) { int len = strlen ( printmap [ i ] . printmode ) ; if ( ! isalpha ( ( int ) s [ len ] ) ) { s -- ; if ( s [ 0 ] == '%' ) { int newlen = strlen ( format ) + strlen ( printmap [ i ] . Format ) ; r = malloc ( newlen ) ; if ( ! r ) { LogError ( "malloc() error in %s line %d: %s\n" , __FILE__ , __LINE__ , strerror ( errno ) ) ; exit ( 255 ) ; } s [ 0 ] = '\0' ; snprintf ( r , newlen , "%s%s%s" , format , printmap [ i ] . Format , & ( s [ len + 1 ] ) ) ; r [ newlen - 1 ] = '\0' ; format = r ; } } } i ++ ; } return format ; } 