static int adm1031_open ( dev_t * devp , int flags , int otyp , cred_t * credp ) { int instance ; adm1031_unit_t * admp ; int err = EBUSY ; if ( otyp != OTYP_CHR ) { return ( EINVAL ) ; } instance = ADM1031_MINOR_TO_INST ( getminor ( * devp ) ) ; admp = ( adm1031_unit_t * ) ddi_get_soft_state ( adm1031_soft_statep , instance ) ; if ( admp == NULL ) { return ( ENXIO ) ; } mutex_enter ( & admp -> adm1031_mutex ) ; if ( flags & FEXCL ) { if ( admp -> adm1031_oflag == 0 ) { admp -> adm1031_oflag = FEXCL ; err = 0 ; } } if ( admp -> adm1031_oflag != FEXCL ) { admp -> adm1031_oflag = FOPEN ; err = 0 ; } mutex_exit ( & admp -> adm1031_mutex ) ; return ( err ) ; } 