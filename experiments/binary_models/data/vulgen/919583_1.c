static int bpf__obj_config_map ( struct bpf_object * obj , struct parse_events_term * term , struct perf_evlist * evlist , int * key_scan_pos ) { char * map_name = strdup ( term -> config + sizeof ( "map:" ) - 1 ) ; struct bpf_map * map ; int err = - BPF_LOADER_ERRNO__OBJCONF_OPT ; char * map_opt ; size_t i ; if ( ! map_name ) { return - ENOMEM ; } map_opt = strchr ( map_name , '.' ) ; if ( ! map_opt ) { pr_debug ( "ERROR: Invalid map config: %s\n" , map_name ) ; out } * map_opt ++ = '\0' ; if ( * map_opt == '\0' ) { pr_debug ( "ERROR: Invalid map option: %s\n" , term -> config ) ; out } map = bpf_object__find_map_by_name ( obj , map_name ) ; if ( ! map ) { pr_debug ( "ERROR: Map %s doesn't exist\n" , map_name ) ; err = - BPF_LOADER_ERRNO__OBJCONF_MAP_NOTEXIST ; out } * key_scan_pos += strlen ( map_opt ) ; err = config_map_indices_range_check ( term , map , map_name ) ; if ( err ) { out } * key_scan_pos -= strlen ( map_opt ) ; for ( i = 0 ; i < ARRAY_SIZE ( bpf_obj_config__map_funcs ) ; i ++ ) { struct bpf_obj_config__map_func * func = & bpf_obj_config__map_funcs [ i ] ; if ( strcmp ( map_opt , func -> config_opt ) == 0 ) { err = func -> config_func ( map , term , evlist ) ; out } } pr_debug ( "ERROR: Invalid map config option '%s'\n" , map_opt ) ; err = - BPF_LOADER_ERRNO__OBJCONF_MAP_OPT ; out if ( ! err ) { key_scan_pos += strlen ( map_opt ) ; } return err ; } 