static int dissect_ap1394 ( tvbuff_t * tvb , packet_info * pinfo , proto_tree * tree , void * data _U_ ) { proto_item * ti ; proto_tree * fh_tree = NULL ; guint16 etype ; tvbuff_t * next_tvb ; col_set_str ( pinfo -> cinfo , COL_PROTOCOL , "IP/IEEE1394" ) ; col_clear ( pinfo -> cinfo , COL_INFO ) ; set_address_tvb ( & pinfo -> dl_src , AT_EUI64 , 8 , tvb , 8 ) ; copy_address_shallow ( & pinfo -> src , & pinfo -> dl_src ) ; set_address_tvb ( & pinfo -> dl_dst , AT_EUI64 , 8 , tvb , 0 ) ; copy_address_shallow ( & pinfo -> dst , & pinfo -> dl_dst ) ; if ( tree ) { ti = proto_tree_add_protocol_format ( tree , proto_ap1394 , tvb , 0 , 18 , "Apple IP-over-IEEE 1394, Src: %s, Dst: %s" , address_to_str ( pinfo -> pool , & pinfo -> src ) , address_to_str ( pinfo -> pool , & pinfo -> dst ) ) ; fh_tree = proto_item_add_subtree ( ti , ett_ap1394 ) ; proto_tree_add_item ( fh_tree , hf_ap1394_dst , tvb , 0 , 8 , ENC_NA ) ; proto_tree_add_item ( fh_tree , hf_ap1394_src , tvb , 8 , 8 , ENC_NA ) ; } etype = tvb_get_ntohs ( tvb , 16 ) ; proto_tree_add_uint ( fh_tree , hf_ap1394_type , tvb , 16 , 2 , etype ) ; next_tvb = tvb_new_subset_remaining ( tvb , 18 ) ; return tvb_captured_length ( tvb ) ; } 