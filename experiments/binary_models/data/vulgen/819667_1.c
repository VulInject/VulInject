static krb5_error_code pkinit_init_kdc_profile ( krb5_context context , pkinit_kdc_context plgctx ) { krb5_error_code retval ; char * eku_string = NULL ; pkiDebug ( "%s: entered for realm %s\n" , __FUNCTION__ , plgctx -> realmname ) ; retval = pkinit_kdcdefault_string ( context , plgctx -> realmname , "pkinit_identity" , & plgctx -> idopts -> identity ) ; if ( retval != 0 || NULL == plgctx -> idopts -> identity ) { retval = EINVAL ; krb5_set_error_message ( context , retval , "No pkinit_identity supplied for realm %s" , plgctx -> realmname ) ; errout } retval = pkinit_kdcdefault_strings ( context , plgctx -> realmname , "pkinit_anchors" , & plgctx -> idopts -> anchors ) ; if ( retval != 0 || NULL == plgctx -> idopts -> anchors ) { retval = EINVAL ; krb5_set_error_message ( context , retval , "No pkinit_anchors supplied for realm %s" , plgctx -> realmname ) ; errout } ( void ) pkinit_kdcdefault_strings ( context , plgctx -> realmname , "pkinit_pool" , & plgctx -> idopts -> intermediates ) ; ( void ) pkinit_kdcdefault_strings ( context , plgctx -> realmname , "pkinit_revoke" , & plgctx -> idopts -> crls ) ; ( void ) pkinit_kdcdefault_string ( context , plgctx -> realmname , "pkinit_kdc_ocsp" , & plgctx -> idopts -> ocsp ) ; ( void ) pkinit_kdcdefault_string ( context , plgctx -> realmname , "pkinit_mappings_file" , & plgctx -> idopts -> dn_mapping_file ) ; ( void ) pkinit_kdcdefault_integer ( context , plgctx -> realmname , "pkinit_dh_min_bits" , PKINIT_DEFAULT_DH_MIN_BITS , & plgctx -> opts -> dh_min_bits ) ; if ( plgctx -> opts -> dh_min_bits < 1024 ) { pkiDebug ( "%s: invalid value (%d) for pkinit_dh_min_bits, " "using default value (%d) instead\n" , __FUNCTION__ , plgctx -> opts -> dh_min_bits , PKINIT_DEFAULT_DH_MIN_BITS ) ; plgctx -> opts -> dh_min_bits = PKINIT_DEFAULT_DH_MIN_BITS ; } ( void ) pkinit_kdcdefault_boolean ( context , plgctx -> realmname , "pkinit_allow_upn" , 0 , & plgctx -> opts -> allow_upn ) ; ( void ) pkinit_kdcdefault_boolean ( context , plgctx -> realmname , "pkinit_require_crl_checking" , 0 , & plgctx -> opts -> require_crl_checking ) ; ( void ) pkinit_kdcdefault_string ( context , plgctx -> realmname , "pkinit_eku_checking" , & eku_string ) ; return 0 ; errout pkinit_fini_kdc_profile ( context , plgctx ) ; return retval ; } 