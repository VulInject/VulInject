static void gen7_init_oa_buffer ( struct i915_perf_stream * stream ) { struct intel_uncore * uncore = stream -> uncore ; u32 gtt_offset = i915_ggtt_offset ( stream -> oa_buffer . vma ) ; unsigned long flags ; spin_lock_irqsave ( & stream -> oa_buffer . ptr_lock , flags ) ; intel_uncore_write ( uncore , GEN7_OASTATUS2 , gtt_offset | GEN7_OASTATUS2_MEM_SELECT_GGTT ) ; stream -> oa_buffer . head = gtt_offset ; intel_uncore_write ( uncore , GEN7_OABUFFER , gtt_offset ) ; intel_uncore_write ( uncore , GEN7_OASTATUS1 , gtt_offset | OABUFFER_SIZE_16M ) ; stream -> oa_buffer . aging_tail = INVALID_TAIL_PTR ; stream -> oa_buffer . tail = gtt_offset ; spin_unlock_irqrestore ( & stream -> oa_buffer . ptr_lock , flags ) ; stream -> perf -> gen7_latched_oastatus1 = 0 ; } 