struct inode * adfs_iget ( struct super_block * sb , struct object_info * obj ) { struct inode * inode ; inode = new_inode ( sb ) ; if ( ! inode ) { out } inode -> i_uid = ADFS_SB ( sb ) -> s_uid ; inode -> i_gid = ADFS_SB ( sb ) -> s_gid ; inode -> i_ino = obj -> indaddr ; inode -> i_size = obj -> size ; set_nlink ( inode , 2 ) ; inode -> i_blocks = ( inode -> i_size + sb -> s_blocksize - 1 ) >> sb -> s_blocksize_bits ; ADFS_I ( inode ) -> parent_id = obj -> parent_id ; ADFS_I ( inode ) -> indaddr = obj -> indaddr ; ADFS_I ( inode ) -> loadaddr = obj -> loadaddr ; ADFS_I ( inode ) -> execaddr = obj -> execaddr ; ADFS_I ( inode ) -> attr = obj -> attr ; inode -> i_mode = adfs_atts2mode ( sb , inode ) ; adfs_adfs2unix_time ( & inode -> i_mtime , inode ) ; inode -> i_atime = inode -> i_mtime ; inode -> i_ctime = inode -> i_mtime ; if ( S_ISDIR ( inode -> i_mode ) ) { inode -> i_op = & adfs_dir_inode_operations ; inode -> i_fop = & adfs_dir_operations ; } if ( S_ISREG ( inode -> i_mode ) ) { inode -> i_op = & adfs_file_inode_operations ; inode -> i_fop = & adfs_file_operations ; ADFS_I ( inode ) -> mmu_private = inode -> i_size ; } inode_fake_hash ( inode ) ; out return inode ; } 