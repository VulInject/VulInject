static int rds_cancel_sent_to ( struct rds_sock * rs , sockptr_t optval , int len ) { struct sockaddr_in6 sin6 ; struct sockaddr_in sin ; int ret ; if ( ipv6_addr_any ( & rs -> rs_bound_addr ) ) { ret = - ENOTCONN ; out } if ( len < sizeof ( sockaddr_in ) ) { ret = - EINVAL ; out } if ( len < sizeof ( sockaddr_in6 ) ) { if ( copy_from_sockptr ( & sin , optval , sizeof ( sockaddr_in ) ) ) { ret = - EFAULT ; out } ipv6_addr_set_v4mapped ( sin . sin_addr . s_addr , & sin6 . sin6_addr ) ; sin6 . sin6_port = sin . sin_port ; } else { if ( copy_from_sockptr ( & sin6 , optval , sizeof ( sockaddr_in6 ) ) ) { ret = - EFAULT ; out } } rds_send_drop_to ( rs , & sin6 ) ; out return ret ; } 