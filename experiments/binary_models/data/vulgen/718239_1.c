mpq_set_str ( , , ) { const char * slash ; char * num ; size_t numlen ; int ret ; slash = strchr ( str , '/' ) ; if ( slash == NULL ) { SIZ ( DEN ( q ) ) = 1 ; MPZ_NEWALLOC ( DEN ( q ) , 1 ) [ 0 ] = 1 ; return mpz_set_str ( mpq_numref ( q ) , str , base ) ; } numlen = slash - str ; num = __GMP_ALLOCATE_FUNC_TYPE ( numlen + 1 , char ) ; memcpy ( num , str , numlen ) ; num [ numlen ] = '\0' ; ret = mpz_set_str ( mpq_numref ( q ) , num , base ) ; __GMP_FREE_FUNC_TYPE ( num , numlen + 1 , char ) ; return mpz_set_str ( mpq_denref ( q ) , slash + 1 , base ) ; } 