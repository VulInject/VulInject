bool iommufd_object_destroy_user ( struct iommufd_ctx * ictx , struct iommufd_object * obj ) { down_write ( & obj -> destroy_rwsem ) ; xa_lock ( & ictx -> objects ) ; refcount_dec ( & obj -> users ) ; if ( ! refcount_dec_if_one ( & obj -> users ) ) { xa_unlock ( & ictx -> objects ) ; up_write ( & obj -> destroy_rwsem ) ; return false ; } __xa_erase ( & ictx -> objects , obj -> id ) ; xa_unlock ( & ictx -> objects ) ; up_write ( & obj -> destroy_rwsem ) ; iommufd_object_ops [ obj -> type ] . destroy ( obj ) ; kfree ( obj ) ; return true ; } 