md_t * mdesc_devinit ( void ) { int fd ; md_t * mdp ; size_t size ; if ( md_bufp != NULL ) { return ( NULL ) ; } { if ( ( fd = open ( MDESC_PATH , O_RDONLY , 0 ) ) < 0 ) { break ; } if ( ioctl ( fd , MDESCIOCGSZ , & size ) < 0 ) { break ; } if ( ( md_bufp = ( uint64_t * ) malloc ( size ) ) == NULL ) { ( void ) close ( fd ) ; break ; } if ( read ( fd , md_bufp , size ) != size ) { free ( md_bufp ) ; md_bufp = NULL ; } ( void ) close ( fd ) ; } 0 ; if ( md_bufp ) { if ( mdp == NULL ) { free ( md_bufp ) ; md_bufp = NULL ; } } else { mdp = NULL ; } return ( mdp ) ; } 