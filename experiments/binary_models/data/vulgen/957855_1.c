static ssize_t rnbd_clt_unmap_dev_store ( struct kobject * kobj , struct kobj_attribute * attr , const char * buf , size_t count ) { struct rnbd_clt_dev * dev ; char * opt , * options ; bool force ; int err ; opt = kstrdup ( buf , GFP_KERNEL ) ; options = strstrip ( opt ) ; dev = container_of ( kobj , rnbd_clt_dev , kobj ) ; if ( sysfs_streq ( options , "normal" ) ) { force = false ; } if ( sysfs_streq ( options , "force" ) ) { force = true ; } else { rnbd_clt_err ( dev , "unmap_device: Invalid value: %s\n" , options ) ; err = - EINVAL ; out } rnbd_clt_info ( dev , "Unmapping device, option: %s.\n" , force ?"force" : "normal" ) ; if ( ! try_module_get ( THIS_MODULE ) ) { err = - ENODEV ; out } err = rnbd_clt_unmap_device ( dev , force , & attr -> attr ) ; if ( err ) { if ( err != - EALREADY ) { rnbd_clt_err ( dev , "unmap_device: %d\n" , err ) ; } module_put } err = count ; module_put module_put ( THIS_MODULE ) ; out kfree ( opt ) ; return err ; } 