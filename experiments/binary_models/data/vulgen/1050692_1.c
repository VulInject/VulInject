static void test_softdirty ( void ) { char * addr ; int ret ; ksft_print_msg ( "[RUN] %s\n" , __func__ ) ; addr = mmap ( 0 , SIZE , PROT_READ | PROT_WRITE , MAP_ANONYMOUS | MAP_PRIVATE , 0 , 0 ) ; clear_softdirty ( ) ; ksft_test_result ( range_is_not_softdirty ( addr , SIZE ) , "range is not softdirty\n" ) ; ret = madvise ( addr , SIZE , MADV_POPULATE_READ ) ; ksft_test_result ( ! ret , "MADV_POPULATE_READ\n" ) ; ksft_test_result ( range_is_not_softdirty ( addr , SIZE ) , "range is not softdirty\n" ) ; ret = madvise ( addr , SIZE , MADV_POPULATE_WRITE ) ; ksft_test_result ( ! ret , "MADV_POPULATE_WRITE\n" ) ; ksft_test_result ( range_is_softdirty ( addr , SIZE ) , "range is softdirty\n" ) ; munmap ( addr , SIZE ) ; } 