static void neo_tasklet ( unsigned long data ) { struct dgnc_board * bd = ( dgnc_board * ) data ; struct channel_t * ch ; unsigned long flags ; int i ; int state = 0 ; int ports = 0 ; if ( ! bd ) { return ; } spin_lock_irqsave ( & bd -> bd_lock , flags ) ; state = bd -> state ; ports = bd -> nasync ; spin_unlock_irqrestore ( & bd -> bd_lock , flags ) ; spin_lock_irqsave ( & bd -> bd_intr_lock , flags ) ; if ( ( state == BOARD_READY ) && ( ports > 0 ) ) { for ( i = 0 ; i < ports ; i ++ ) { ch = bd -> channels [ i ] ; dgnc_input ( ch ) ; neo_copy_data_from_queue_to_uart ( ch ) ; dgnc_wakeup_writes ( ch ) ; dgnc_carrier ( ch ) ; if ( ch -> ch_stop_sending_break ) { neo_clear_break ( ch , 0 ) ; } } } spin_unlock_irqrestore ( & bd -> bd_intr_lock , flags ) ; } 