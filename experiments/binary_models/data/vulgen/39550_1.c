void si_dma_vm_write_pages ( struct radeon_device * rdev , struct radeon_ib * ib , uint64_t pe , uint64_t addr , unsigned count , uint32_t incr , uint32_t flags ) { uint64_t value ; unsigned ndw ; while ( count ) { ndw = count * 2 ; ib -> ptr [ ib -> length_dw ++ ] = DMA_PACKET ( DMA_PACKET_WRITE , 0 , 0 , 0 , ndw ) ; ib -> ptr [ ib -> length_dw ++ ] = pe ; ib -> ptr [ ib -> length_dw ++ ] = upper_32_bits ( pe ) & 0xff ; for ( ; ndw > 0 ; ndw -= 2 , -- count , pe += 8 ) { if ( flags & R600_PTE_SYSTEM ) { value = radeon_vm_map_gart ( rdev , addr ) ; } if ( flags & R600_PTE_VALID ) { value = addr ; } else { value = 0 ; } addr += incr ; value |= flags ; ib -> ptr [ ib -> length_dw ++ ] = value ; ib -> ptr [ ib -> length_dw ++ ] = upper_32_bits ( value ) ; } } } 