extern List gres_sched_create_sock_gres_list ( List job_gres_list , List node_gres_list , bool use_total_gres , bitstr_t * core_bitmap , uint16_t sockets , uint16_t cores_per_sock , uint32_t job_id , char * node_name , bool enforce_binding , uint32_t s_p_n , bitstr_t * * req_sock_map , uint32_t user_id , const uint32_t node_inx ) { List sock_gres_list = NULL ; ListIterator job_gres_iter ; gres_state_t * gres_state_job , * gres_state_node ; gres_job_state_t * gres_js ; gres_node_state_t * gres_ns ; uint32_t local_s_p_n ; if ( ! node_gres_list ) { return sock_gres_list ; } ( void ) gres_init ( ) ; sock_gres_list = list_create ( gres_sock_delete ) ; job_gres_iter = list_iterator_create ( job_gres_list ) ; while ( ( gres_state_job = ( gres_state_t * ) list_next ( job_gres_iter ) ) ) { sock_gres_t * sock_gres = NULL ; gres_state_node = list_find_first ( node_gres_list , gres_find_id , & gres_state_job -> plugin_id ) ; if ( gres_state_node == NULL ) { FREE_NULL_LIST ( sock_gres_list ) ; break ; } gres_js = ( gres_job_state_t * ) gres_state_job -> gres_data ; gres_ns = ( gres_node_state_t * ) gres_state_node -> gres_data ; if ( gres_js -> gres_per_job && ! gres_js -> gres_per_socket ) { local_s_p_n = s_p_n ; } else { local_s_p_n = NO_VAL ; } if ( core_bitmap && ( bit_ffs ( core_bitmap ) == - 1 ) ) { sock_gres = NULL ; } if ( gres_ns -> topo_cnt ) { sock_gres = _build_sock_gres_by_topo ( gres_state_job , gres_state_node , use_total_gres , core_bitmap , sockets , cores_per_sock , job_id , node_name , enforce_binding , local_s_p_n , req_sock_map , user_id , node_inx ) ; } if ( gres_ns -> type_cnt ) { sock_gres = _build_sock_gres_by_type ( gres_js , gres_ns , use_total_gres , core_bitmap , sockets , cores_per_sock , job_id , node_name ) ; } else { sock_gres = _build_sock_gres_basic ( gres_js , gres_ns , use_total_gres , core_bitmap , sockets , cores_per_sock , job_id , node_name ) ; } if ( ! sock_gres ) { bit_clear_all ( core_bitmap ) ; FREE_NULL_LIST ( sock_gres_list ) ; break ; } sock_gres -> gres_state_job = gres_state_job ; sock_gres -> gres_state_node = gres_state_node ; list_append ( sock_gres_list , sock_gres ) ; } list_iterator_destroy ( job_gres_iter ) ; if ( slurm_conf . debug_flags & DEBUG_FLAG_GRES ) { _sock_gres_log ( sock_gres_list , node_name ) ; } return sock_gres_list ; } 