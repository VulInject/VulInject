START_TEST ( ) { register unsigned int i ; char c = 'A' , src [ 1024 ] , dst [ 1024 ] , * res ; res = sstrcat ( dst , src , 0 ) ; ck_assert_msg ( res == NULL , "Non-null result for zero-length strcat" ) ; src [ 0 ] = 'f' ; src [ 1 ] = '\0' ; dst [ 0 ] = 'e' ; dst [ 1 ] = '\0' ; res = sstrcat ( dst , src , 1 ) ; ck_assert_msg ( res == dst , "Returned wrong destination buffer" ) ; ck_assert_msg ( dst [ 0 ] == 0 , "Failed to terminate destination buffer" ) ; src [ 0 ] = 'f' ; src [ 1 ] = '\0' ; dst [ 0 ] = 'e' ; dst [ 1 ] = '\0' ; res = sstrcat ( dst , src , 2 ) ; ck_assert_msg ( res == dst , "Returned wrong destination buffer" ) ; ck_assert_msg ( dst [ 0 ] == 'e' , "Failed to preserve destination buffer (expected '%c' at index 0, " "got '%c')" , 'e' , dst [ 0 ] ) ; ck_assert_msg ( dst [ 1 ] == 0 , "Failed to terminate destination buffer" ) ; mark_point ( ) ; src [ 0 ] = 'f' ; src [ 1 ] = '\0' ; dst [ 0 ] = 'e' ; dst [ 1 ] = '\0' ; res = sstrcat ( dst , src , 3 ) ; ck_assert_msg ( res == dst , "Returned wrong destination buffer" ) ; mark_point ( ) ; ck_assert_msg ( dst [ 0 ] == 'e' , "Failed to preserve destination buffer (expected '%c' at index 0, " "got '%c')" , 'e' , dst [ 0 ] ) ; mark_point ( ) ; ck_assert_msg ( dst [ 1 ] == 'f' , "Failed to copy source buffer (expected '%c' at index 1, got '%c')" , 'f' , dst [ 1 ] ) ; mark_point ( ) ; ck_assert_msg ( dst [ 2 ] == 0 , "Failed to terminate destination buffer" ) ; mark_point ( ) ; memset ( src , c , sizeof ( src ) - 1 ) ; src [ sizeof ( src ) - 1 ] = '\0' ; dst [ 0 ] = '\0' ; mark_point ( ) ; res = sstrcat ( dst , src , sizeof ( dst ) ) ; mark_point ( ) ; ck_assert_msg ( res == dst , "Returned wrong destination buffer" ) ; mark_point ( ) ; ck_assert_msg ( dst [ sizeof ( dst ) - 1 ] == 0 , "Failed to terminate destination buffer" ) ; mark_point ( ) ; ck_assert_msg ( strlen ( dst ) == ( sizeof ( dst ) - 1 ) , "Failed to copy all the data (expected len %lu, got len %lu)" , ( unsigned long ) sizeof ( dst ) - 1 , ( unsigned long ) strlen ( dst ) ) ; mark_point ( ) ; for ( i = 0 ; i < sizeof ( dst ) - 1 ; i ++ ) { } } 