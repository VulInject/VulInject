void cfg80211_michael_mic_failure ( struct net_device * dev , const u8 * addr , enum nl80211_key_type key_type , int key_id , const u8 * tsc , gfp_t gfp ) { struct wiphy * wiphy = dev -> ieee80211_ptr -> wiphy ; struct cfg80211_registered_device * rdev = wiphy_to_rdev ( wiphy ) ; union iwreq_data wrqu ; char * buf = kmalloc ( 128 , gfp ) ; if ( buf ) { sprintf ( buf , "MLME-MICHAELMICFAILURE.indication(" "keyid=%d %scast addr=%pM)" , key_id , key_type == NL80211_KEYTYPE_GROUP ?"broad" : "uni" , addr ) ; memset ( & wrqu , 0 , sizeof ( wrqu ) ) ; wrqu . data . length = strlen ( buf ) ; wireless_send_event ( dev , IWEVCUSTOM , & wrqu , buf ) ; } trace_cfg80211_michael_mic_failure ( dev , addr , key_type , key_id , tsc ) ; nl80211_michael_mic_failure ( rdev , dev , addr , key_type , key_id , tsc , gfp ) ; } 