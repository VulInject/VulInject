static void mtk_mipi_tx_get_calibration_datal ( struct mtk_mipi_tx * mipi_tx ) { struct nvmem_cell * cell ; size_t len ; u32 * buf ; cell = nvmem_cell_get ( mipi_tx -> dev , "calibration-data" ) ; if ( IS_ERR ( cell ) ) { dev_info ( mipi_tx -> dev , "can't get nvmem_cell_get, ignore it\n" ) ; return ; } buf = ( u32 * ) nvmem_cell_read ( cell , & len ) ; nvmem_cell_put ( cell ) ; if ( IS_ERR ( buf ) ) { dev_info ( mipi_tx -> dev , "can't get data, ignore it\n" ) ; return ; } if ( len < 3 * sizeof ( u32 ) ) { dev_info ( mipi_tx -> dev , "invalid calibration data\n" ) ; return ; } mipi_tx -> rt_code [ 0 ] = ( ( buf [ 0 ] >> 6 & 0x1f ) << 5 ) | ( buf [ 0 ] >> 11 & 0x1f ) ; mipi_tx -> rt_code [ 1 ] = ( ( buf [ 1 ] >> 27 & 0x1f ) << 5 ) | ( buf [ 0 ] >> 1 & 0x1f ) ; mipi_tx -> rt_code [ 2 ] = ( ( buf [ 1 ] >> 17 & 0x1f ) << 5 ) | ( buf [ 1 ] >> 22 & 0x1f ) ; mipi_tx -> rt_code [ 3 ] = ( ( buf [ 1 ] >> 7 & 0x1f ) << 5 ) | ( buf [ 1 ] >> 12 & 0x1f ) ; mipi_tx -> rt_code [ 4 ] = ( ( buf [ 2 ] >> 27 & 0x1f ) << 5 ) | ( buf [ 1 ] >> 2 & 0x1f ) ; kfree ( buf ) ; } 