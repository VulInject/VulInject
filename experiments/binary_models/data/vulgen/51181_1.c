static int nat_t120 ( struct sk_buff * skb , struct nf_conn * ct , enum ip_conntrack_info ctinfo , unsigned int protoff , unsigned char * * data , int dataoff , H245_TransportAddress * taddr , __be16 port , struct nf_conntrack_expect * exp ) { int dir = CTINFO2DIR ( ctinfo ) ; u_int16_t nated_port = ntohs ( port ) ; exp -> saved_proto . tcp . port = exp -> tuple . dst . u . tcp . port ; exp -> expectfn = nf_nat_follow_master ; exp -> dir = ! dir ; for ( ; nated_port != 0 ; nated_port ++ ) { int ret ; exp -> tuple . dst . u . tcp . port = htons ( nated_port ) ; ret = nf_ct_expect_related ( exp ) ; if ( ret == 0 ) { break ; } if ( ret != - EBUSY ) { nated_port = 0 ; break ; } } if ( nated_port == 0 ) { net_notice_ratelimited ( "nf_nat_h323: out of TCP ports\n" ) ; return 0 ; } if ( set_h245_addr ( skb , protoff , data , dataoff , taddr , & ct -> tuplehash [ ! dir ] . tuple . dst . u3 , htons ( nated_port ) ) < 0 ) { return - 1 ; } pr_debug ( "nf_nat_h323: expect T.120 %pI4:%hu->%pI4:%hu\n" , & exp -> tuple . src . u3 . ip , ntohs ( exp -> tuple . src . u . tcp . port ) , & exp -> tuple . dst . u3 . ip , ntohs ( exp -> tuple . dst . u . tcp . port ) ) ; return 0 ; } 