static int init_event_waiter ( struct kfd_process * p , struct kfd_event_waiter * waiter , uint32_t event_id ) { struct kfd_event * ev = lookup_event_by_id ( p , event_id ) ; spin_lock ( & ev -> lock ) ; waiter -> event = ev ; waiter -> activated = ev -> signaled ; ev -> signaled = ev -> signaled && ! ev -> auto_reset ; if ( ! waiter -> activated ) { add_wait_queue ( & ev -> wq , & waiter -> wait ) ; } spin_unlock ( & ev -> lock ) ; return 0 ; } 