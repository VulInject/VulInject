static int emu8k_pcm_copy ( struct snd_pcm_substream * subs , int voice , snd_pcm_uframes_t pos , void * src , snd_pcm_uframes_t count ) { struct snd_emu8k_pcm * rec = subs -> runtime -> private_data ; struct snd_emu8000 * emu = rec -> emu ; snd_emu8000_write_wait ( emu , 1 ) ; if ( voice == - 1 ) { unsigned short * buf = src ; int i , err ; count /= rec -> voices ; for ( i = 0 ; i < rec -> voices ; i ++ ) { err = emu8k_transfer_block ( emu , pos + rec -> loop_start [ i ] , buf , count ) ; buf += count ; } return 0 ; } else { return emu8k_transfer_block ( emu , pos + rec -> loop_start [ voice ] , src , count ) ; } } 