static ssize_t memcpy_count_show ( struct device * dev , struct device_attribute * attr , char * buf ) { struct dma_chan * chan ; unsigned long count ; int i ; int err ; mutex_lock ( & dma_list_mutex ) ; chan = dev_to_dma_chan ( dev ) ; if ( chan ) { for_each_possible_cpu ( ) count += per_cpu_ptr ( chan -> local , i ) -> memcpy_count ; err = sprintf ( buf , "%lu\n" , count ) ; } else { err = - ENODEV ; } mutex_unlock ( & dma_list_mutex ) ; return err ; } 