static int compare_manifests ( FILE * rulesfile , char * control , char * test , boolean_t prog_fmt , uint_t flags ) { FILE * control_fd , * test_fd ; char * control_line , * test_line , control_buf [ BUF_SIZE ] , test_buf [ BUF_SIZE ] , control_fname [ PATH_MAX ] , control_type [ TYPE_SIZE ] , test_fname [ PATH_MAX ] , test_type [ TYPE_SIZE ] ; int control_pos , test_pos , ret , fname_cmp , return_status ; return_status = EXIT ; control_fd = fopen ( control , "r" ) ; if ( control_fd == NULL ) { perror ( control ) ; return ( FATAL_EXIT ) ; } test_fd = fopen ( test , "r" ) ; if ( test_fd == NULL ) { perror ( test ) ; return ( FATAL_EXIT ) ; } control_pos = read_manifest_line ( control_fd , control_buf , BUF_SIZE , 0 , & control_line , control ) ; test_pos = read_manifest_line ( test_fd , test_buf , BUF_SIZE , 0 , & test_line , test ) ; while ( ( control_pos != - 1 ) && ( test_pos != - 1 ) ) { ret = strcmp ( control_line , test_line ) ; if ( ret == 0 ) { control_pos = read_manifest_line ( control_fd , control_buf , BUF_SIZE , control_pos , & control_line , control ) ; test_pos = read_manifest_line ( test_fd , test_buf , BUF_SIZE , test_pos , & test_line , test ) ; continue ; } extract_fname_ftype ( control_line , control_fname , control_type ) ; extract_fname_ftype ( test_line , test_fname , test_type ) ; fname_cmp = strcmp ( control_fname , test_fname ) ; if ( fname_cmp == 0 ) { if ( evaluate_differences ( control_line , test_line , prog_fmt , flags ) != 0 ) { return_status = WARNING_EXIT ; } control_pos = read_manifest_line ( control_fd , control_buf , BUF_SIZE , control_pos , & control_line , control ) ; test_pos = read_manifest_line ( test_fd , test_buf , BUF_SIZE , test_pos , & test_line , test ) ; } if ( fname_cmp > 0 ) { if ( report_add ( test_fname , test_type ) ) { report_error ( test_fname , ADD_KEYWORD , NULL , NULL , prog_fmt ) ; return_status = WARNING_EXIT ; } test_pos = read_manifest_line ( test_fd , test_buf , BUF_SIZE , test_pos , & test_line , test ) ; } if ( fname_cmp < 0 ) { if ( report_delete ( control_fname , control_type ) ) { report_error ( control_fname , DELETE_KEYWORD , NULL , NULL , prog_fmt ) ; return_status = WARNING_EXIT ; } control_pos = read_manifest_line ( control_fd , control_buf , BUF_SIZE , control_pos , & control_line , control ) ; } } while ( control_pos != - 1 ) { ( void ) sscanf ( control_line , "%1023s" , control_fname ) ; if ( report_delete ( control_fname , control_type ) ) { report_error ( control_fname , DELETE_KEYWORD , NULL , NULL , prog_fmt ) ; return_status = WARNING_EXIT ; } control_pos = read_manifest_line ( control_fd , control_buf , BUF_SIZE , control_pos , & control_line , control ) ; } while ( test_pos != - 1 ) { ( void ) sscanf ( test_line , "%1023s" , test_fname ) ; if ( report_add ( test_fname , test_type ) ) { report_error ( test_fname , ADD_KEYWORD , NULL , NULL , prog_fmt ) ; return_status = WARNING_EXIT ; } test_pos = read_manifest_line ( test_fd , test_buf , BUF_SIZE , test_pos , & test_line , test ) ; } ( void ) fclose ( control_fd ) ; ( void ) fclose ( test_fd ) ; if ( prog_fmt && ( return_status != 0 ) ) { ( void ) printf ( "\n" ) ; } return ( return_status ) ; } 