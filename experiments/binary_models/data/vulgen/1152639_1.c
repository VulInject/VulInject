int user_allowed_by_security_group ( Client * client , SecurityGroup * s ) { static int recursion_security_group = 0 ; if ( ! s ) { return 0 ; } if ( recursion_security_group > 8 ) { unreal_log ( ULOG_WARNING , "main" , "SECURITY_GROUP_LOOP_DETECTED" , client , "Loop detected while processing security-group '$security_group' -- " "are you perhaps referencing a security-group from a security-group?" , log_data_string ( "security_group" , s -> name ) ) ; return 0 ; } recursion_security_group ++ ; if ( s -> exclude_identified && IsLoggedIn ( client ) ) { user_not_allowed } if ( s -> exclude_webirc && moddata_client_get ( client , "webirc" ) ) { user_not_allowed } if ( ( s -> exclude_reputation_score > 0 ) && ( GetReputation ( client ) >= s -> exclude_reputation_score ) ) { user_not_allowed } if ( ( s -> exclude_reputation_score < 0 ) && ( GetReputation ( client ) < 0 - s -> exclude_reputation_score ) ) { user_not_allowed } if ( s -> exclude_connect_time != 0 ) { long connect_time = get_connected_time ( client ) ; if ( ( s -> exclude_connect_time > 0 ) && ( connect_time >= s -> exclude_connect_time ) ) { user_not_allowed } if ( ( s -> exclude_connect_time < 0 ) && ( connect_time < 0 - s -> exclude_connect_time ) ) { user_not_allowed } } if ( s -> exclude_tls && ( IsSecureConnect ( client ) || ( MyConnect ( client ) && IsSecure ( client ) ) ) ) { user_not_allowed } if ( s -> exclude_mask && unreal_mask_match ( client , s -> exclude_mask ) ) { user_not_allowed } if ( s -> exclude_ip && unreal_match_iplist ( client , s -> exclude_ip ) ) { user_not_allowed } if ( s -> exclude_security_group && user_allowed_by_security_group_list ( client , s -> exclude_security_group ) ) { user_not_allowed } if ( s -> exclude_extended && user_matches_extended_list ( client , s -> exclude_extended ) ) { user_not_allowed } if ( s -> identified && IsLoggedIn ( client ) ) { user_allowed } if ( s -> webirc && moddata_client_get ( client , "webirc" ) ) { user_allowed } if ( ( s -> reputation_score > 0 ) && ( GetReputation ( client ) >= s -> reputation_score ) ) { user_allowed } if ( ( s -> reputation_score < 0 ) && ( GetReputation ( client ) < 0 - s -> reputation_score ) ) { user_allowed } if ( s -> connect_time != 0 ) { long connect_time = get_connected_time ( client ) ; if ( ( s -> connect_time > 0 ) && ( connect_time >= s -> connect_time ) ) { user_allowed } if ( ( s -> connect_time < 0 ) && ( connect_time < 0 - s -> connect_time ) ) { user_allowed } } if ( s -> tls && ( IsSecureConnect ( client ) || ( MyConnect ( client ) && IsSecure ( client ) ) ) ) { user_allowed } if ( s -> mask && unreal_mask_match ( client , s -> mask ) ) { user_allowed } if ( s -> ip && unreal_match_iplist ( client , s -> ip ) ) { user_allowed } if ( s -> security_group && user_allowed_by_security_group_list ( client , s -> security_group ) ) { user_allowed } user_not_allowed recursion_security_group -- ; return 0 ; user_allowed recursion_security_group -- ; return 1 ; } 