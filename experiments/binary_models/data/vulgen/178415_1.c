int handle_get ( struct handle_db * db , void * ptr ) { size_t n ; void * p ; size_t new_max_ptrs ; if ( ! db || ! ptr ) { return - 1 ; } for ( n = 0 ; n < db -> max_ptrs ; n ++ ) { if ( ! db -> ptrs [ n ] ) { db -> ptrs [ n ] = ptr ; return n ; } } if ( db -> max_ptrs ) { new_max_ptrs = db -> max_ptrs * 2 ; } else { new_max_ptrs = HANDLE_DB_INITIAL_MAX_PTRS ; } if ( ! p ) { return - 1 ; } db -> ptrs = p ; memset ( db -> ptrs + db -> max_ptrs , 0 , ( new_max_ptrs - db -> max_ptrs ) * sizeof ( void * ) ) ; db -> max_ptrs = new_max_ptrs ; db -> ptrs [ n ] = ptr ; return n ; } 