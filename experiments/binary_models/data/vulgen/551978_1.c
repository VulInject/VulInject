static int getKey2 ( char * * str ) { char * s = * str ; int c , esc = 0 , ctrl = 0 ; if ( strcasecmp ( s , "UP" ) == 0 ) { * str = s + 2 ; return K_ESCB | 'A' ; } if ( strcasecmp ( s , "DOWN" ) == 0 ) { * str = s + 4 ; return K_ESCB | 'B' ; } if ( strcasecmp ( s , "RIGHT" ) == 0 ) { * str = s + 5 ; return K_ESCB | 'C' ; } if ( strcasecmp ( s , "LEFT" ) == 0 ) { * str = s + 4 ; return K_ESCB | 'D' ; } if ( strncasecmp ( s , "ESC-" , 4 ) == 0 || strncasecmp ( s , "ESC " , 4 ) == 0 ) { s += 4 ; esc = K_ESC ; } if ( strncasecmp ( s , "M-" , 2 ) == 0 || strncasecmp ( s , "\\E" , 2 ) == 0 ) { s += 2 ; esc = K_ESC ; } if ( * s == ESC_CODE ) { s ++ ; esc = K_ESC ; } if ( strncasecmp ( s , "C-" , 2 ) == 0 ) { s += 2 ; ctrl = 1 ; } if ( * s == '^' && * ( s + 1 ) ) { s ++ ; ctrl = 1 ; } if ( ! esc && ctrl && * s == '[' ) { s ++ ; ctrl = 0 ; esc = K_ESC ; } if ( esc && ! ctrl ) { if ( * s == '[' || * s == 'O' ) { s ++ ; esc = K_ESCB ; } if ( strncasecmp ( s , "C-" , 2 ) == 0 ) { s += 2 ; ctrl = 1 ; } if ( * s == '^' && * ( s + 1 ) ) { s ++ ; ctrl = 1 ; } } if ( ctrl ) { * str = s + 1 ; if ( * s >= '@' && * s <= '_' ) { return esc | ( * s - '@' ) ; } if ( * s >= 'a' && * s <= 'z' ) { return esc | ( * s - 'a' + 1 ) ; } if ( * s == '?' ) { return esc | DEL_CODE ; } else { return - 1 ; } } if ( esc == K_ESCB && IS_DIGIT ( * s ) ) { c = ( int ) ( * s - '0' ) ; s ++ ; if ( IS_DIGIT ( * s ) ) { c = c * 10 + ( int ) ( * s - '0' ) ; s ++ ; } * str = s + 1 ; if ( * s == '~' ) { return K_ESCD | c ; } else { return - 1 ; } } if ( strncasecmp ( s , "SPC" , 3 ) == 0 ) { * str = s + 3 ; return esc | ' ' ; } if ( strncasecmp ( s , "TAB" , 3 ) == 0 ) { * str = s + 3 ; return esc | '\t' ; } if ( strncasecmp ( s , "DEL" , 3 ) == 0 ) { * str = s + 3 ; return esc | DEL_CODE ; } if ( * s == '\\' && * ( s + 1 ) != '\0' ) { s ++ ; * str = s + 1 ; switch ( * s ) { case 'a' : return esc | CTRL_G ; case 'b' : return esc | CTRL_H ; case 't' : return esc | CTRL_I ; case 'n' : return esc | CTRL_J ; case 'r' : return esc | CTRL_M ; case 'e' : return esc | ESC_CODE ; case '^' : return esc | '^' ; case '\\' : return esc | '\\' ; default : return - 1 ; } } * str = s + 1 ; if ( IS_ASCII ( * s ) ) { return esc | * s ; } else { return - 1 ; } } 