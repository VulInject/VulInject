static enum fw_upload_err m10bmc_sec_poll_complete ( struct fw_upload * fwl ) { struct m10bmc_sec * sec = fwl -> dd_handle ; unsigned long poll_timeout ; u32 doorbell , result ; int ret ; result = rsu_send_data ( sec ) ; if ( result != FW_UPLOAD_ERR_NONE ) { return result ; } poll_timeout = jiffies + msecs_to_jiffies ( RSU_COMPLETE_TIMEOUT_MS ) ; { msleep ( RSU_COMPLETE_INTERVAL_MS ) ; ret = rsu_check_complete ( sec , & doorbell ) ; } ret == - EAGAIN && ! time_after ( jiffies , poll_timeout ) ; if ( ret == - EAGAIN ) { log_error_regs ( sec , doorbell ) ; return FW_UPLOAD_ERR_TIMEOUT ; } if ( ret == - EIO ) { return FW_UPLOAD_ERR_RW_ERROR ; } if ( ret ) { log_error_regs ( sec , doorbell ) ; return FW_UPLOAD_ERR_HW_ERROR ; } return FW_UPLOAD_ERR_NONE ; } 