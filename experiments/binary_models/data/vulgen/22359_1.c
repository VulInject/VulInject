void flush_word ( WavpackStream * wps ) { if ( wps -> w . zeros_acc ) { int cbits = count_bits ( wps -> w . zeros_acc ) ; while ( cbits -- ) { putbit_1 ( & wps -> wvbits ) ; } putbit_0 ( & wps -> wvbits ) ; while ( wps -> w . zeros_acc > 1 ) { putbit ( wps -> w . zeros_acc & 1 , & wps -> wvbits ) ; wps -> w . zeros_acc >>= 1 ; } wps -> w . zeros_acc = 0 ; } if ( wps -> w . holding_one ) { if ( wps -> w . holding_one >= LIMIT_ONES ) { int cbits ; wps -> w . holding_one -= LIMIT_ONES ; cbits = count_bits ( wps -> w . holding_one ) ; while ( cbits -- ) { putbit_1 ( & wps -> wvbits ) ; } putbit_0 ( & wps -> wvbits ) ; while ( wps -> w . holding_one > 1 ) { putbit ( wps -> w . holding_one & 1 , & wps -> wvbits ) ; wps -> w . holding_one >>= 1 ; } wps -> w . holding_zero = 0 ; } else { putbits ( bitmask [ wps -> w . holding_one ] , wps -> w . holding_one , & wps -> wvbits ) ; } wps -> w . holding_one = 0 ; { putbit_1 ( & wps -> wvbits ) ; } -- wps -> w . holding_one ; } if ( wps -> w . holding_zero ) { putbit_0 ( & wps -> wvbits ) ; wps -> w . holding_zero = 0 ; } if ( wps -> w . pend_count ) { putbits ( wps -> w . pend_data , wps -> w . pend_count , & wps -> wvbits ) ; wps -> w . pend_data = wps -> w . pend_count = 0 ; } } 