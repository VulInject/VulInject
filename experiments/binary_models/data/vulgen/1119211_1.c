static void arn_beacon_setup ( struct arn_softc * sc , struct ath_buf * bf ) { ( ( ( _ic ) -> ic_flags & ( IEEE80211_F_SHPREAMBLE | IEEE80211_F_USEBARKER ) ) == IEEE80211_F_SHPREAMBLE ) mblk_t * mp = bf -> bf_m ; struct ath_hal * ah = sc -> sc_ah ; struct ath_desc * ds ; int flags , antenna = 0 ; struct ath_rate_table * rt ; uint8_t rix , rate ; struct ath9k_11n_rate_series series [ 4 ] ; int ctsrate = 0 ; int ctsduration = 0 ; ds = bf -> bf_desc ; flags = ATH9K_TXDESC_NOACK ; if ( sc -> sc_ah -> ah_opmode == ATH9K_M_IBSS && ( ah -> ah_caps . hw_caps & ATH9K_HW_CAP_VEOL ) ) { ds -> ds_link = bf -> bf_daddr ; flags |= ATH9K_TXDESC_VEOL ; antenna = 0 ; } else { ds -> ds_link = 0 ; antenna = ( ( sc -> ast_be_xmit / sc -> sc_nbcnvaps ) & 1 ?2 : 1 ) ; } ds -> ds_data = bf -> bf_dma . cookie . dmac_address ; rix = 0 ; rt = sc -> hw_rate_table [ sc -> sc_curmode ] ; rate = rt -> info [ rix ] . ratecode ; ath9k_hw_set11n_txdesc ( ah , ds , MBLKL ( mp ) + IEEE80211_CRC_LEN , ATH9K_PKT_TYPE_BEACON , MAX_RATE_POWER , ATH9K_TXKEYIX_INVALID , ATH9K_KEY_TYPE_CLEAR , flags ) ; ( void ) ath9k_hw_filltxdesc ( ah , ds , roundup ( MBLKL ( mp ) , 4 ) , B_TRUE , B_TRUE , ds ) ; ( void ) memset ( series , 0 , sizeof ( ath9k_11n_rate_series ) * 4 ) ; series [ 0 ] . Tries = 1 ; series [ 0 ] . Rate = rate ; series [ 0 ] . ChSel = sc -> sc_tx_chainmask ; series [ 0 ] . RateFlags = ( ctsrate ) ?ATH9K_RATESERIES_RTS_CTS : 0 ; ath9k_hw_set11n_ratescenario ( ah , ds , ds , 0 , ctsrate , ctsduration , series , 4 , 0 ) ; } 