COMPAT_SYSCALL_DEFINE5 ( , , , , , , , , , , ) { long err ; unsigned long __user * nm = NULL ; unsigned long nr_bits , alloc_size ; DECLARE_BITMAP ( bm , MAX_NUMNODES ) ; nr_bits = min_t ( , 1 , ) ; alloc_size = ALIGN ( nr_bits , BITS_PER_LONG ) / 8 ; if ( nmask ) { nm = compat_alloc_user_space ( alloc_size ) ; } err = sys_get_mempolicy ( policy , nm , nr_bits + 1 , addr , flags ) ; if ( ! err && nmask ) { unsigned long copy_size ; copy_size = min_t ( , , ) ; err = copy_from_user ( bm , nm , copy_size ) ; err |= clear_user ( nmask , ALIGN ( maxnode - 1 , 8 ) / 8 ) ; } return err ; } 