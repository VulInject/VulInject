static void adi_gpio_ack_irq ( struct irq_data * d ) { unsigned long flags ; struct gpio_port * port = irq_data_get_irq_chip_data ( d ) ; struct gpio_pint_regs * regs = port -> pint -> regs ; spin_lock_irqsave ( & port -> lock , flags ) ; spin_lock ( & port -> pint -> lock ) ; if ( irqd_get_trigger_type ( d ) == IRQ_TYPE_EDGE_BOTH ) { if ( readl ( & regs -> invert_set ) & pintbit ) { writel ( pintbit , & regs -> invert_clear ) ; } else { writel ( pintbit , & regs -> invert_set ) ; } } writel ( pintbit , & regs -> request ) ; spin_unlock ( & port -> pint -> lock ) ; spin_unlock_irqrestore ( & port -> lock , flags ) ; } 