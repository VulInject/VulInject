void check_deltatime ( void ) { char what [ 1000 ] ; static const test_str_deltatime { intmax_t ms ; const char * str ; } , test_str_deltatime [ ] { { 1000 "1" } { - 1000 "-1" } { - 100 "-0.1" } } ; for ( unsigned i = 0 ; i < elemsof ( test_str_deltatime ) ; i ++ ) { const struct test_str_deltatime * t = & test_str_deltatime [ i ] ; deltatime_t d = deltatime_ms ( t -> ms ) ; deltatime_buf buf ; const char * str = str_deltatime ( d , & buf ) ; snprintf ( what , sizeof ( what ) , "str_deltatime(%jdms) == %s" , t -> ms , t -> str ) ; if ( strcmp ( str , t -> str ) != 0 ) { fprintf ( stderr , "FAIL: %s vs %s\n" , what , str ) ; fails ++ ; } else { printf ( "%s\n" , what ) ; } } static const struct test_op test_deltatime_max [ ] { { 1000 100 "1" } { - 1000 0 "0" } { - 100 - 200 "-0.1" } } ; ; CHECK_DELTATIME_OP ( max ) ; static const struct test_op test_deltatime_add [ ] { { 1000 100 "1.1" } { - 1000 0 "-1" } { - 100 - 200 "-0.3" } } ; ; CHECK_DELTATIME_OP ( add ) ; static const struct test_op test_deltatime_sub [ ] { { 1000 100 "0.9" } { - 1000 0 "-1" } { - 100 - 200 "0.1" } } ; ; CHECK_DELTATIME_OP ( sub ) ; CHECK_TIME_CMP ( delta ) ; } 