static void save_lrs ( struct kvm_vcpu * vcpu , void __iomem * base ) { struct vgic_v2_cpu_if * cpu_if = & vcpu -> arch . vgic_cpu . vgic_v2 ; u64 used_lrs = cpu_if -> used_lrs ; u64 elrsr ; int i ; elrsr = readl_relaxed ( base + GICH_ELRSR0 ) ; for ( i = 0 ; i < used_lrs ; i ++ ) { if ( elrsr & ( 1UL << i ) ) { cpu_if -> vgic_lr [ i ] &= ~ GICH_LR_STATE ; } else { cpu_if -> vgic_lr [ i ] = readl_relaxed ( base + GICH_LR0 + ( i * 4 ) ) ; } writel_relaxed ( 0 , base + GICH_LR0 + ( i * 4 ) ) ; } } 