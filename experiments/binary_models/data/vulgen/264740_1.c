static void watch_journald ( abrt_journal_t * journal , const char * dump_location , int flags ) { GList * koops_strings = abrt_koops_suspicious_strings_list ( ) ; g_autofree char * oops_string_filter_regex = abrt_oops_string_filter_regex ( ) ; if ( oops_string_filter_regex ) { regex_t filter_re ; if ( regcomp ( & filter_re , oops_string_filter_regex , REG_NOSUB ) != 0 ) { perror_msg_and_die ( _ ( "Failed to compile regex" ) ) ; } GList * iter = koops_strings ; while ( iter != NULL ) { GList * next = g_list_next ( iter ) ; const int reti = regexec ( & filter_re , ( const char * ) iter -> data , 0 , NULL , 0 ) ; if ( reti == 0 ) { koops_strings = g_list_delete_link ( koops_strings , iter ) ; } iter = next ; } regfree ( & filter_re ) ; } GList * koops_strings_blacklist = abrt_koops_suspicious_strings_blacklist ( ) ; struct watch_journald_settings watch_conf = { . dump_location = dump_location . oops_utils_flags = flags } ; struct abrt_journal_watch_notify_strings notify_strings_conf = { . decorated_cb = abrt_journal_watch_extract_kernel_oops . decorated_cb_data = & watch_conf . strings = koops_strings . blacklisted_strings = koops_strings_blacklist } ; abrt_journal_watch_t * watch = NULL ; if ( abrt_journal_watch_new ( & watch , journal , abrt_journal_watch_notify_strings , & notify_strings_conf ) < 0 ) { error_msg_and_die ( _ ( "Failed to initialize systemd-journal watch" ) ) ; } abrt_journal_watch_run_sync ( watch ) ; abrt_journal_watch_free ( watch ) ; g_list_free ( koops_strings ) ; } 