static mrb_value mrb_basicsocket_recvfrom ( mrb_state * mrb , mrb_value self ) { mrb_int maxlen , flags = 0 ; mrb_value ary , buf , sa ; socklen_t socklen ; mrb_get_args ( mrb , "i|i" , & maxlen , & flags ) ; buf = mrb_str_new_capa ( mrb , maxlen ) ; socklen = sizeof ( sockaddr_storage ) ; sa = mrb_str_new_capa ( mrb , socklen ) ; n = recvfrom ( socket_fd ( mrb , self ) , RSTRING_PTR ( buf ) , ( fsize_t ) maxlen , ( int ) flags , ( sockaddr * ) RSTRING_PTR ( sa ) , & socklen ) ; if ( n == - 1 ) { mrb_sys_fail ( mrb , "recvfrom" ) ; } mrb_str_resize ( mrb , buf , ( mrb_int ) n ) ; mrb_str_resize ( mrb , sa , ( mrb_int ) socklen ) ; ary = mrb_ary_new_capa ( mrb , 2 ) ; mrb_ary_push ( mrb , ary , buf ) ; mrb_ary_push ( mrb , ary , sa ) ; return ary ; } 