static struct sk_buff * eem_wrap ( struct gether * port , struct sk_buff * skb ) { struct sk_buff * skb2 = NULL ; struct usb_ep * in = port -> in_ep ; int headroom , tailroom , padlen = 0 ; u16 len ; if ( ! skb ) { return NULL ; } len = skb -> len ; headroom = skb_headroom ( skb ) ; tailroom = skb_tailroom ( skb ) ; if ( ( tailroom >= ( ETH_FCS_LEN + padlen ) ) && ( headroom >= EEM_HLEN ) && ! skb_cloned ( skb ) ) { done } skb2 = skb_copy_expand ( skb , EEM_HLEN , ETH_FCS_LEN + padlen , GFP_ATOMIC ) ; dev_kfree_skb_any ( skb ) ; skb = skb2 ; if ( ! skb ) { return skb ; } done put_unaligned_be32 ( 0xdeadbeef , skb_put ( skb , 4 ) ) ; len = skb -> len ; put_unaligned_le16 ( len & 0x3FFF , skb_push ( skb , 2 ) ) ; if ( padlen ) { put_unaligned_le16 ( 0 , skb_put ( skb , 2 ) ) ; } return skb ; } 