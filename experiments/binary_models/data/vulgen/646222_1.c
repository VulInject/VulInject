static void a6xx_bus_clear_pending_transactions ( struct adreno_gpu * adreno_gpu , bool gx_off ) { struct msm_gpu * gpu = & adreno_gpu -> base ; if ( ! a6xx_has_gbif ( adreno_gpu ) ) { gpu_write ( gpu , REG_A6XX_VBIF_XIN_HALT_CTRL0 , 0xf ) ; spin_until ( ( gpu_read ( gpu , REG_A6XX_VBIF_XIN_HALT_CTRL1 ) & 0xf ) == 0xf ) ; gpu_write ( gpu , REG_A6XX_VBIF_XIN_HALT_CTRL0 , 0 ) ; return ; } if ( gx_off ) { gpu_write ( gpu , REG_A6XX_RBBM_GBIF_HALT , 1 ) ; spin_until ( gpu_read ( gpu , REG_A6XX_RBBM_GBIF_HALT_ACK ) & 1 ) ; } gpu_write ( gpu , REG_A6XX_GBIF_HALT , GBIF_CLIENT_HALT_MASK ) ; spin_until ( ( gpu_read ( gpu , REG_A6XX_GBIF_HALT_ACK ) & ( GBIF_CLIENT_HALT_MASK ) ) == GBIF_CLIENT_HALT_MASK ) ; gpu_write ( gpu , REG_A6XX_GBIF_HALT , GBIF_ARB_HALT_MASK ) ; spin_until ( ( gpu_read ( gpu , REG_A6XX_GBIF_HALT_ACK ) & ( GBIF_ARB_HALT_MASK ) ) == GBIF_ARB_HALT_MASK ) ; } 