static enum send_status nge_send_copy ( nge_t * ngep , mblk_t * mp , send_ring_t * srp ) { size_t totlen ; size_t mblen ; uint32_t flags ; uint32_t bds ; uint32_t start_index ; char * txb ; mblk_t * bp ; void * hw_sbd_p ; sw_tx_sbd_t * ssbdp ; boolean_t tfint ; mac_hcksum_get ( mp , NULL , NULL , NULL , NULL , & flags ) ; bds = 0x1 ; ASSERT ( start_index < srp -> desc . nslots ) ; tfint = ( ( start_index % ngep -> tfint_threshold ) == 0 ) ; bp = mp ; totlen = 0 ; ssbdp = & srp -> sw_sbds [ start_index ] ; ASSERT ( ssbdp -> flags == HOST_OWN ) ; txb = DMA_VPTR ( ssbdp -> pbuf ) ; totlen = 0 ; for ( ; bp != NULL ; bp = bp -> b_cont ) { if ( ( mblen = MBLKL ( bp ) ) == 0 ) { continue ; } if ( ( totlen += mblen ) <= ngep -> max_sdu ) { bcopy ( bp -> b_rptr , txb , mblen ) ; txb += mblen ; } } DMA_SYNC ( ssbdp -> pbuf , DDI_DMA_SYNC_FORDEV ) ; hw_sbd_p = DMA_VPTR ( ssbdp -> desc ) ; ngep -> desc_attr . txd_fill ( hw_sbd_p , & ssbdp -> pbuf . cookie , totlen , flags , B_TRUE , tfint ) ; nge_tx_desc_sync ( ngep , start_index , bds , DDI_DMA_SYNC_FORDEV ) ; ssbdp -> flags = CONTROLER_OWN ; nge_tx_start ( ngep , bds ) ; freemsg ( mp ) ; return ( SEND_COPY_SUCESS ) ; } 