static void ocrdma_update_wc ( struct ocrdma_qp * qp , struct ib_wc * ibwc , u32 wqe_idx ) { struct ocrdma_hdr_wqe * hdr ; struct ocrdma_sge * rw ; int opcode ; hdr = ocrdma_hwq_head_from_idx ( & qp -> sq , wqe_idx ) ; ibwc -> wr_id = qp -> wqe_wr_id_tbl [ wqe_idx ] . wrid ; opcode = le32_to_cpu ( hdr -> cw ) & OCRDMA_WQE_OPCODE_MASK ; switch ( opcode ) { case OCRDMA_WRITE : ibwc -> opcode = IB_WC_RDMA_WRITE ; break ; case OCRDMA_READ : rw = ( ocrdma_sge * ) ( hdr + 1 ) ; ibwc -> opcode = IB_WC_RDMA_READ ; ibwc -> byte_len = rw -> len ; break ; case OCRDMA_SEND : ibwc -> opcode = IB_WC_SEND ; break ; case OCRDMA_FR_MR : ibwc -> opcode = IB_WC_REG_MR ; break ; case OCRDMA_LKEY_INV : ibwc -> opcode = IB_WC_LOCAL_INV ; break ; default : pr_err ( "%s() invalid opcode received = 0x%x\n" , __func__ , hdr -> cw & OCRDMA_WQE_OPCODE_MASK ) ; break ; } } 