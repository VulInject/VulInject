static void eth_pio_write ( const unsigned char * src , unsigned int dst , unsigned int cnt ) { unsigned int x ; outb ( dst & 0xff , eth_asic_base + WD_GP2 ) ; outb ( dst >> 8 , eth_asic_base + WD_GP2 ) ; outb ( D8390_COMMAND_RD2 | D8390_COMMAND_STA , eth_nic_base + D8390_P0_COMMAND ) ; outb ( D8390_ISR_RDC , eth_nic_base + D8390_P0_ISR ) ; outb ( cnt , eth_nic_base + D8390_P0_RBCR0 ) ; outb ( cnt >> 8 , eth_nic_base + D8390_P0_RBCR1 ) ; outb ( dst , eth_nic_base + D8390_P0_RSAR0 ) ; outb ( dst >> 8 , eth_nic_base + D8390_P0_RSAR1 ) ; outb ( D8390_COMMAND_RD1 | D8390_COMMAND_STA , eth_nic_base + D8390_P0_COMMAND ) ; outb ( dst & 0xff , eth_asic_base + _3COM_DALSB ) ; outb ( dst >> 8 , eth_asic_base + _3COM_DAMSB ) ; outb ( t503_output | _3COM_CR_DDIR | _3COM_CR_START , eth_asic_base + _3COM_CR ) ; if ( eth_flags & FLAG_16BIT ) { cnt = ( cnt + 1 ) >> 1 ; } while ( cnt -- ) { while ( ( inb ( eth_asic_base + _3COM_STREG ) & _3COM_STREG_DPRDY ) == 0 ) { } if ( eth_flags & FLAG_16BIT ) { src += 2 ; } else { outb ( * ( src ++ ) , eth_asic_base + ASIC_PIO ) ; } } outb ( t503_output , eth_asic_base + _3COM_CR ) ; for ( x = 0 ; x < COMPEX_RL2000_TRIES && ( inb ( eth_nic_base + D8390_P0_ISR ) & D8390_ISR_RDC ) != D8390_ISR_RDC ; ++ x ) { } if ( x >= COMPEX_RL2000_TRIES ) { printf ( "Warning: Compex RL2000 aborted wait!\n" ) ; } while ( ( inb ( eth_nic_base + D8390_P0_ISR ) & D8390_ISR_RDC ) != D8390_ISR_RDC ) { } } 