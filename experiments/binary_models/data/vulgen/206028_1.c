static int64_t blockerupter_scanhash ( struct thr_info * thr ) { struct cgpu_info * blockerupter = thr -> cgpu ; struct blockerupter_info * info = blockerupter -> device_data ; char ask ; uint8_t answer ; int i ; int64_t hashes = 0 ; if ( unlikely ( blockerupter -> usbinfo . nodev ) ) { applog ( LOG_ERR , "%s%d: Device disappeared, shutting down thread" , blockerupter -> drv -> name , blockerupter -> device_id ) ; return - 1 ; } for ( i = 0 ; i < BET_MAXBOARDS ; i ++ ) { ask = C_ASK | ( uint8_t ) i ; blockerupter_send ( blockerupter , & ask , 1 ) ; cgsleep_ms ( 1 ) ; answer = 0 ; blockerupter_read ( blockerupter , ( char * ) & answer , 1 ) ; switch ( answer ) { case A_WAL : blockerupter_sendjob ( blockerupter , i ) ; break ; case A_YES : hashes += blockerupter_getresp ( blockerupter , i ) ; break ; case A_NO : break ; default : applog ( LOG_ERR , "%s%d: Unexpected value %02x received" , blockerupter -> drv -> name , blockerupter -> device_id , answer ) ; break ; } } return hashes ; } 