void ipp_initialize_operational_attributes ( service_t * svc , papi_attribute_t * * * op , char * printer , int job_id ) { char * charset = "utf-8" ; char * user = "nobody" ; struct passwd * pw = NULL ; papiAttributeListAddString ( op , PAPI_ATTR_EXCL , "attributes-charset" , charset ) ; papiAttributeListAddString ( op , PAPI_ATTR_EXCL , "attributes-natural-language" , language ) ; if ( printer != NULL ) { ipp_add_printer_uri ( svc , printer , op ) ; } if ( ( printer != NULL ) && ( job_id >= 0 ) ) { papiAttributeListAddInteger ( op , PAPI_ATTR_EXCL , "job-id" , job_id ) ; } if ( ( pw = getpwuid ( getuid ( ) ) ) != NULL ) { user = pw -> pw_name ; } if ( geteuid ( ) == 0 ) { if ( svc -> user != NULL ) { user = svc -> user ; } } papiAttributeListAddString ( op , PAPI_ATTR_REPLACE , "requesting-user-name" , user ) ; } 