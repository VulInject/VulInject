static int ixgbe_dcbnl_ieee_delapp ( struct net_device * dev , struct dcb_app * app ) { struct ixgbe_adapter * adapter = netdev_priv ( dev ) ; int err ; err = dcb_ieee_delapp ( dev , app ) ; if ( ! err && app -> selector == IEEE_8021QAZ_APP_SEL_ETHERTYPE && app -> protocol == ETH_P_FCOE ) { u8 app_mask = dcb_ieee_getapp_mask ( dev , app ) ; if ( app_mask & BIT ( adapter -> fcoe . up ) ) { return 0 ; } adapter -> fcoe . up = app_mask ?ffs ( app_mask ) - 1 : IXGBE_FCOE_DEFTC ; ixgbe_dcbnl_devreset ( dev ) ; } if ( app -> selector == IEEE_8021QAZ_APP_SEL_ETHERTYPE && app -> protocol == 0 && adapter -> default_up == app -> priority ) { int vf ; long unsigned int app_mask = dcb_ieee_getapp_mask ( dev , app ) ; int qos = app_mask ?find_first_bit ( & app_mask , 8 ) : 0 ; adapter -> default_up = qos ; for ( vf = 0 ; vf < adapter -> num_vfs ; vf ++ ) { struct vf_data_storage * vfinfo = & adapter -> vfinfo [ vf ] ; if ( ! vfinfo -> pf_qos ) { ixgbe_set_vmvir ( adapter , vfinfo -> pf_vlan , qos , vf ) ; } } } return err ; } 