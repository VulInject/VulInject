static void ath6kl_htc_mbox_activity_changed ( struct htc_target * target , enum htc_endpoint_id eid , bool active ) { struct htc_endpoint * endpoint = & target -> endpoint [ eid ] ; bool dist = false ; if ( endpoint -> svc_id == 0 ) { return ; } spin_lock_bh ( & target -> tx_lock ) ; if ( active ) { if ( ! ( endpoint -> cred_dist . dist_flags & HTC_EP_ACTIVE ) ) { endpoint -> cred_dist . dist_flags |= HTC_EP_ACTIVE ; dist = true ; } } else { if ( endpoint -> cred_dist . dist_flags & HTC_EP_ACTIVE ) { endpoint -> cred_dist . dist_flags &= ~ HTC_EP_ACTIVE ; dist = true ; } } if ( dist ) { endpoint -> cred_dist . txq_depth = get_queue_depth ( & endpoint -> txq ) ; ath6kl_dbg ( ATH6KL_DBG_HTC , "htc tx activity ctxt 0x%p dist 0x%p\n" , target -> credit_info , & target -> cred_dist_list ) ; ath6kl_credit_distribute ( target -> credit_info , & target -> cred_dist_list , HTC_CREDIT_DIST_ACTIVITY_CHANGE ) ; } spin_unlock_bh ( & target -> tx_lock ) ; if ( dist && ! active ) { htc_chk_ep_txq ( target ) ; } } 