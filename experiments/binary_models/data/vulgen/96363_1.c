static int read_hardware_clock_cmos ( const hwclock_control * ctl __attribute__ ( ( __unused__ ) ) , tm * tm ) ( unsigned char status = 0 , pmbit = 0 , ( 1 ) { if ( ! cmos_clock_busy ( ) ) { tm -> tm_sec = hclock_read ( 0 ) tm -> tm_min = hclock_read ( 2 ) } ; tm -> tm_hour = hclock_read ( 4 ) } , tm -> tm_wday = hclock_read ( 6 ) , tm -> tm_mday = hclock_read ( 7 ) , tm -> tm_mon = hclock_read ( 8 ) , tm -> tm_year = hclock_read ( 9 ) , status = hclock_read ( 11 ) , ( tm -> tm_sec == hclock_read ( 0 ) ) break ; ) ; if ( ! ( status & 0x04 ) ) { BCD_TO_BIN ( tm -> tm_sec ) ; BCD_TO_BIN ( tm -> tm_min ) ; pmbit = ( tm -> tm_hour & 0x80 ) ; tm -> tm_hour &= 0x7f ; BCD_TO_BIN ( tm -> tm_hour ) ; BCD_TO_BIN ( tm -> tm_wday ) ; BCD_TO_BIN ( tm -> tm_mday ) ; BCD_TO_BIN ( tm -> tm_mon ) ; BCD_TO_BIN ( tm -> tm_year ) ; } tm -> tm_wday -= 1 ; tm -> tm_mon -= 1 ; if ( tm -> tm_year < 69 ) { tm -> tm_year += 100 ; } if ( pmbit ) { tm -> tm_hour += 12 ; } tm -> tm_isdst = - 1 ; return 0 ; 