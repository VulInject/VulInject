hook_process_timer_cb ( , , ) { struct t_hook * hook_process ; int status , rc ; ( void ) data ; ( void ) remaining_calls ; hook_process = ( t_hook * ) pointer ; if ( hook_process -> deleted ) { return WEECHAT_RC_OK ; } if ( remaining_calls == 0 ) { hook_process_send_buffers ( hook_process , WEECHAT_HOOK_PROCESS_ERROR ) ; kill ( HOOK_PROCESS ( hook_process , child_pid ) , SIGKILL ) ; usleep ( 1000 ) ; unhook ( hook_process ) ; } else { if ( waitpid ( HOOK_PROCESS ( hook_process , child_pid ) , & status , WNOHANG ) > 0 ) { if ( WIFEXITED ( status ) ) { rc = WEXITSTATUS ( status ) ; hook_process_child_read_until_eof ( hook_process ) ; hook_process_send_buffers ( hook_process , rc ) ; unhook ( hook_process ) ; } if ( WIFSIGNALED ( status ) ) { hook_process_child_read_until_eof ( hook_process ) ; hook_process_send_buffers ( hook_process , WEECHAT_HOOK_PROCESS_ERROR ) ; unhook ( hook_process ) ; } } } return WEECHAT_RC_OK ; } 