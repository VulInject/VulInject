static void hdpvr_device_release ( struct video_device * vdev ) { struct hdpvr_device * dev = video_get_drvdata ( vdev ) ; hdpvr_delete ( dev ) ; flush_work ( & dev -> worker ) ; v4l2_device_unregister ( & dev -> v4l2_dev ) ; v4l2_ctrl_handler_free ( & dev -> hdl ) ; mutex_lock ( & dev -> i2c_mutex ) ; i2c_del_adapter ( & dev -> i2c_adapter ) ; mutex_unlock ( & dev -> i2c_mutex ) ; kfree ( dev ) ; } 