static void local_storage_tasks_trace_setup ( void ) { int i , err , forkret , runner_pid ; runner_pid = getpid ( ) ; for ( i = 0 ; i < args . nr_procs ; i ++ ) { forkret = fork ( ) ; if ( forkret < 0 ) { fprintf ( stderr , "Error forking sleeper proc %u of %u, exiting\n" , i , args . nr_procs ) ; err_out } if ( ! forkret ) { err = prctl ( PR_SET_PDEATHSIG , SIGKILL ) ; if ( getppid ( ) != runner_pid ) { fprintf ( stderr , "Runner died while spinning up procs, exiting\n" ) ; err_out } sleep_and_loop ( ) ; } } printf ( "Spun up %u procs (our pid %d)\n" , args . nr_procs , runner_pid ) ; setup_libbpf ( ) ; ctx . skel = local_storage_rcu_tasks_trace_bench__open_and_load ( ) ; if ( ! ctx . skel ) { fprintf ( stderr , "Error doing open_and_load, exiting\n" ) ; err_out } ctx . prev_kthread_stime = kthread_pid_ticks ( ) ; if ( ! bpf_program__attach ( ctx . skel -> progs . get_local ) ) { fprintf ( stderr , "Error attaching bpf program\n" ) ; err_out } if ( ! bpf_program__attach ( ctx . skel -> progs . pregp_step ) ) { fprintf ( stderr , "Error attaching bpf program\n" ) ; err_out } if ( ! bpf_program__attach ( ctx . skel -> progs . postgp ) ) { fprintf ( stderr , "Error attaching bpf program\n" ) ; err_out } return ; err_out exit ( 1 ) ; } 