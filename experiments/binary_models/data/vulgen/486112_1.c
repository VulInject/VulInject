static int ef4_ethtool_set_coalesce ( struct net_device * net_dev , struct ethtool_coalesce * coalesce , struct kernel_ethtool_coalesce * kernel_coal , struct netlink_ext_ack * extack ) { struct ef4_nic * efx = netdev_priv ( net_dev ) ; struct ef4_channel * channel ; unsigned int tx_usecs , rx_usecs ; bool adaptive , rx_may_override_tx ; int rc ; ef4_get_irq_moderation ( efx , & tx_usecs , & rx_usecs , & adaptive ) ; if ( coalesce -> rx_coalesce_usecs != rx_usecs ) { rx_usecs = coalesce -> rx_coalesce_usecs ; } else { rx_usecs = coalesce -> rx_coalesce_usecs_irq ; } adaptive = coalesce -> use_adaptive_rx_coalesce ; rx_may_override_tx = ( coalesce -> tx_coalesce_usecs == tx_usecs && coalesce -> tx_coalesce_usecs_irq == tx_usecs ) ; if ( coalesce -> tx_coalesce_usecs != tx_usecs ) { tx_usecs = coalesce -> tx_coalesce_usecs ; } else { tx_usecs = coalesce -> tx_coalesce_usecs_irq ; } rc = ef4_init_irq_moderation ( efx , tx_usecs , rx_usecs , adaptive , rx_may_override_tx ) ; if ( rc != 0 ) { return rc ; } ef4_for_each_channel ( , ) return 0 ; } 