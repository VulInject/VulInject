static void ath9k_wmi_ctrl_rx ( void * priv , struct sk_buff * skb , enum htc_endpoint_id epid ) { struct wmi * wmi = priv ; struct wmi_cmd_hdr * hdr ; unsigned long flags ; u16 cmd_id ; if ( unlikely ( wmi -> stopped ) ) { free_skb } hdr = ( wmi_cmd_hdr * ) skb -> data ; cmd_id = be16_to_cpu ( hdr -> command_id ) ; spin_lock_irqsave ( & wmi -> wmi_lock , flags ) ; if ( be16_to_cpu ( hdr -> seq_no ) != wmi -> last_seq_id ) { spin_unlock_irqrestore ( & wmi -> wmi_lock , flags ) ; free_skb } spin_unlock_irqrestore ( & wmi -> wmi_lock , flags ) ; ath9k_wmi_rsp_callback ( wmi , skb ) ; free_skb kfree_skb ( skb ) ; } 