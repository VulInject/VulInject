int dram_init ( void ) { sdram_t * sdram = ( sdram_t * ) ( MMAP_SDRAM ) ; u32 dramsize , i ; for ( i = 0x13 ; i < 0x20 ; i ++ ) { if ( dramsize == ( 1 << i ) ) { break ; } } i -- ; out_be32 ( & sdram -> cs0 , CFG_SYS_SDRAM_BASE | i ) ; out_be32 ( & sdram -> cs1 , CFG_SYS_SDRAM_BASE | i ) ; out_be32 ( & sdram -> cfg1 , CFG_SYS_SDRAM_CFG1 ) ; out_be32 ( & sdram -> cfg2 , CFG_SYS_SDRAM_CFG2 ) ; udelay ( 500 ) ; out_be32 ( & sdram -> ctrl , CFG_SYS_SDRAM_CTRL | 2 ) ; out_be32 ( & sdram -> ctrl , CFG_SYS_SDRAM_CTRL | 4 ) ; out_be32 ( & sdram -> ctrl , CFG_SYS_SDRAM_CTRL | 4 ) ; out_be32 ( & sdram -> mode , CFG_SYS_SDRAM_MODE ) ; out_be32 ( & sdram -> mode , CFG_SYS_SDRAM_EMOD ) ; out_be32 ( & sdram -> ctrl , CFG_SYS_SDRAM_CTRL | 2 ) ; out_be32 ( & sdram -> ctrl , ( CFG_SYS_SDRAM_CTRL & ~ 0x80000000 ) | 0x10000F00 ) ; udelay ( 100 ) ; gd -> ram_size = dramsize ; return 0 ; } 