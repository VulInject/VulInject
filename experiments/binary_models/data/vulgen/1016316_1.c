static int init_table ( dbiIndex dbi , rpmTagVal tag ) { int rc = 0 ; if ( dbiExists ( dbi ) ) { return 0 ; } else { const char * keytype = ( rpmTagGetClass ( tag ) == RPM_STRING_CLASS ) ?"TEXT" : "BLOB" ; rc = sqlexec ( dbi -> dbi_db , "CREATE TABLE IF NOT EXISTS '%q' (" "key '%q' NOT NULL, " "hnum INTEGER NOT NULL, " "idx INTEGER NOT NULL, " "FOREIGN KEY (hnum) REFERENCES 'Packages'(hnum)" ")" , dbi -> dbi_file , keytype ) ; } if ( ! rc ) { dbi -> dbi_flags |= DBI_CREATED ; } return rc ; } 