static void prepare_flatten ( struct st_h2o_qpack_flatten_context_t * ctx , h2o_qpack_encoder_t * qpack , h2o_mem_pool_t * pool , int64_t stream_id , h2o_byte_vector_t * encoder_buf ) { ctx -> qpack = qpack ; ctx -> pool = pool ; ctx -> stream_id = stream_id ; ctx -> encoder_buf = qpack != NULL && qpack -> num_blocked < qpack -> max_blocked ?encoder_buf : NULL ; ctx -> headers_buf = ( h2o_byte_vector_t ) { NULL } ; ctx -> base_index = qpack != NULL ?qpack_table_total_inserts ( & qpack -> table ) - 1 : 0 ; ctx -> largest_ref = 0 ; ctx -> headers_buf . size = PREFIX_CAPACITY ; } 