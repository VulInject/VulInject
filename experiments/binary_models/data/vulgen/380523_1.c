( mt76x2_phy_tssi_compensate ) ; static void mt76x2_phy_set_gain_val ( struct mt76x02_dev * dev ) { u32 val ; u8 gain_val [ 2 ] ; gain_val [ 0 ] = dev -> cal . agc_gain_cur [ 0 ] - dev -> cal . agc_gain_adjust ; gain_val [ 1 ] = dev -> cal . agc_gain_cur [ 1 ] - dev -> cal . agc_gain_adjust ; val = 0x1836 << 16 ; if ( ! mt76x2_has_ext_lna ( dev ) && dev -> mphy . chandef . width >= NL80211_CHAN_WIDTH_40 ) { val = 0x1e42 << 16 ; } if ( mt76x2_has_ext_lna ( dev ) && dev -> mphy . chandef . chan -> band == NL80211_BAND_2GHZ && dev -> mphy . chandef . width < NL80211_CHAN_WIDTH_40 ) { val = 0x0f36 << 16 ; } val |= 0xf8 ; mt76_wr ( dev , MT_BBP ( AGC , 8 ) , val | FIELD_PREP ( MT_BBP_AGC_GAIN , gain_val [ 0 ] ) ) ; mt76_wr ( dev , MT_BBP ( AGC , 9 ) , val | FIELD_PREP ( MT_BBP_AGC_GAIN , gain_val [ 1 ] ) ) ; if ( dev -> mphy . chandef . chan -> flags & IEEE80211_CHAN_RADAR ) { mt76x02_phy_dfs_adjust_agc ( 0 ) ; } } 