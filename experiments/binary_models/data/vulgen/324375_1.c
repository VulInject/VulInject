static pals_pe_t * _setup_pals_pes ( int ntasks , int nnodes , uint16_t * task_cnts , uint32_t * * tids , uint32_t * tid_offsets ) { pals_pe_t * pes = NULL ; int nodeidx , localidx , taskid ; for ( nodeidx = 0 ; nodeidx < nnodes ; nodeidx ++ ) { for ( localidx = 0 ; localidx < task_cnts [ nodeidx ] ; localidx ++ ) { taskid = tids [ nodeidx ] [ localidx ] ; if ( taskid >= ntasks ) { error ( "%s: task %d node %d>= ntasks %d; skipping" , plugin_type , taskid , nodeidx , ntasks ) ; continue ; } pes [ taskid ] . nodeidx = nodeidx ; pes [ taskid ] . localidx = localidx ; if ( ! tid_offsets ) { pes [ taskid ] . cmdidx = 0 ; } else { pes [ taskid ] . cmdidx = tid_offsets [ taskid ] ; } } } return pes ; } 