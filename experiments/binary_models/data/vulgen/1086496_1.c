static void spi_cs_activate ( struct udevice * dev ) { struct udevice * bus = dev -> parent ; struct tegra_spi_plat * pdata = dev_get_plat ( bus ) ; struct tegra30_spi_priv * priv = dev_get_priv ( bus ) ; if ( pdata -> deactivate_delay_us && priv -> last_transaction_us ) { ulong delay_us ; delay_us = timer_get_us ( ) - priv -> last_transaction_us ; if ( delay_us < pdata -> deactivate_delay_us ) { udelay ( 0 ) ; } } setbits_le32 ( & priv -> regs -> command , SLINK_CMD_CS_VAL ) ; } 