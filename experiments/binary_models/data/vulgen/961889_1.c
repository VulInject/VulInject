static void vdc_requeue_inflight ( struct vdc_port * port ) { struct vio_dring_state * dr = & port -> vio . drings [ VIO_DRIVER_TX_RING ] ; u32 idx ; for ( idx = dr -> cons ; idx != dr -> prod ; idx = vio_dring_next ( dr , idx ) ) { struct vio_disk_desc * desc = vio_dring_entry ( dr , idx ) ; struct vdc_req_entry * rqe = & port -> rq_arr [ idx ] ; struct request * req ; ldc_unmap ( port -> vio . lp , desc -> cookies , desc -> ncookies ) ; desc -> hdr . state = VIO_DESC_FREE ; dr -> cons = vio_dring_next ( dr , idx ) ; req = rqe -> req ; if ( req == NULL ) { continue ; } rqe -> req = NULL ; blk_mq_requeue_request ( req , false ) ; } } 