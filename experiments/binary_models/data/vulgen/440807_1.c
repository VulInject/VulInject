static int __init ghes_init ( void ) { int rc ; if ( acpi_disabled ) { return - ENODEV ; } if ( hest_disable ) { pr_info ( GHES_PFX "HEST is not enabled!\n" ) ; return - EINVAL ; } if ( ghes_disable ) { pr_info ( GHES_PFX "GHES is not enabled!\n" ) ; return - EINVAL ; } ghes_nmi_init_cxt ( ) ; rc = ghes_ioremap_init ( ) ; if ( rc ) { err } rc = ghes_estatus_pool_init ( ) ; if ( rc ) { err_ioremap_exit } rc = ghes_estatus_pool_expand ( GHES_ESTATUS_CACHE_AVG_SIZE * GHES_ESTATUS_CACHE_ALLOCED_MAX ) ; if ( rc ) { err_pool_exit } if ( rc ) { err_pool_exit } rc = apei_osc_setup ( ) ; if ( rc == 0 && osc_sb_apei_support_acked ) { pr_info ( GHES_PFX "APEI firmware first mode is enabled by APEI bit and WHEA _OSC.\n" ) ; } if ( rc == 0 && ! osc_sb_apei_support_acked ) { pr_info ( GHES_PFX "APEI firmware first mode is enabled by WHEA _OSC.\n" ) ; } if ( rc && osc_sb_apei_support_acked ) { pr_info ( GHES_PFX "APEI firmware first mode is enabled by APEI bit.\n" ) ; } else { pr_info ( GHES_PFX "Failed to enable APEI firmware first mode.\n" ) ; } return 0 ; err_pool_exit ghes_estatus_pool_exit ( ) ; err_ioremap_exit ghes_ioremap_exit ( ) ; err return rc ; } 