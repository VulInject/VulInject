Void_t * vmmvalue ( vm , key , val , oper ) Vmalloc_t * vm ; int key ; Void_t * val ; int oper ; { Mmuser_t * u ; Mmdisc_t * mmdc = ( Mmdisc_t * ) vm -> disc ; Mmvm_t * mmvm = mmdc -> mmvm ; if ( oper != VM_MMGET && oper != VM_MMSET && oper != VM_MMADD ) { return NIL ( Void_t * ) ; } SETLOCK ( vm , 0 ) ; for ( u = mmvm -> user ; u ; u = u -> next ) { } if ( ! u && ( oper == VM_MMSET || oper == VM_MMADD ) ) { if ( ( u = KPVALLOC ( vm , sizeof ( Mmuser_t ) , vm -> meth . allocf ) ) ) { u -> val = NIL ( Void_t * ) ; u -> key = key ; u -> next = mmvm -> user ; mmvm -> user = u ; } } if ( u ) { if ( oper == VM_MMSET ) { u -> val = val ; } if ( oper == VM_MMADD ) { u -> val = ( Void_t * ) ( ( long ) ( u -> val ) + ( long ) ( val ) ) ; } val = u -> val ; } else { val = NIL ( Void_t * ) ; } CLRLOCK ( vm , 0 ) ; return val ; } 