bool rtl8723be_rx_query_desc ( struct ieee80211_hw * hw , struct rtl_stats * status , struct ieee80211_rx_status * rx_status , u8 * pdesc , struct sk_buff * skb ) { struct rtl_priv * rtlpriv = rtl_priv ( hw ) ; struct rx_fwinfo_8723be * p_drvinfo ; struct ieee80211_hdr * hdr ; u32 phystatus = GET_RX_DESC_PHYST ( pdesc ) ; status -> length = ( u16 ) GET_RX_DESC_PKT_LEN ( pdesc ) ; status -> rx_drvinfo_size = ( u8 ) GET_RX_DESC_DRV_INFO_SIZE ( pdesc ) * RX_DRV_INFO_SIZE_UNIT ; status -> rx_bufshift = ( u8 ) ( GET_RX_DESC_SHIFT ( pdesc ) & 0x03 ) ; status -> icv = ( u16 ) GET_RX_DESC_ICV ( pdesc ) ; status -> crc = ( u16 ) GET_RX_DESC_CRC32 ( pdesc ) ; status -> hwerror = ( status -> crc | status -> icv ) ; status -> decrypted = ! GET_RX_DESC_SWDEC ( pdesc ) ; status -> rate = ( u8 ) GET_RX_DESC_RXMCS ( pdesc ) ; status -> shortpreamble = ( u16 ) GET_RX_DESC_SPLCP ( pdesc ) ; status -> isampdu = ( bool ) ( GET_RX_DESC_PAGGR ( pdesc ) == 1 ) ; status -> isfirst_ampdu = ( bool ) ( GET_RX_DESC_PAGGR ( pdesc ) == 1 ) ; status -> timestamp_low = GET_RX_DESC_TSFL ( pdesc ) ; status -> rx_is40Mhzpacket = ( bool ) GET_RX_DESC_BW ( pdesc ) ; status -> bandwidth = ( u8 ) GET_RX_DESC_BW ( pdesc ) ; status -> macid = GET_RX_DESC_MACID ( pdesc ) ; status -> is_ht = ( bool ) GET_RX_DESC_RXHT ( pdesc ) ; status -> is_cck = RX_HAL_IS_CCK_RATE ( status -> rate ) ; if ( GET_RX_STATUS_DESC_RPT_SEL ( pdesc ) ) { status -> packet_report_type = C2H_PACKET ; } else { status -> packet_report_type = NORMAL_RX ; } if ( GET_RX_STATUS_DESC_MAGIC_MATCH ( pdesc ) ) { status -> wake_match = BIT ( 2 ) ; } if ( GET_RX_STATUS_DESC_MAGIC_MATCH ( pdesc ) ) { status -> wake_match = BIT ( 1 ) ; } if ( GET_RX_STATUS_DESC_UNICAST_MATCH ( pdesc ) ) { status -> wake_match = BIT ( 0 ) ; } else { status -> wake_match = 0 ; } if ( status -> wake_match ) { RT_TRACE ( rtlpriv , COMP_RXDESC , DBG_LOUD , "GGGGGGGGGGGGGet Wakeup Packet!! WakeMatch=%d\n" , status -> wake_match ) ; } rx_status -> freq = hw -> conf . chandef . chan -> center_freq ; rx_status -> band = hw -> conf . chandef . chan -> band ; hdr = ( ieee80211_hdr * ) ( skb -> data + status -> rx_drvinfo_size + status -> rx_bufshift ) ; if ( status -> crc ) { rx_status -> flag |= RX_FLAG_FAILED_FCS_CRC ; } if ( status -> rx_is40Mhzpacket ) { rx_status -> bw = RATE_INFO_BW_40 ; } if ( status -> is_ht ) { rx_status -> encoding = RX_ENC_HT ; } rx_status -> flag |= RX_FLAG_MACTIME_START ; if ( status -> decrypted ) { if ( ( ! _ieee80211_is_robust_mgmt_frame ( hdr ) ) && ( ieee80211_has_protected ( hdr -> frame_control ) ) ) { rx_status -> flag |= RX_FLAG_DECRYPTED ; } else { rx_status -> flag &= ~ RX_FLAG_DECRYPTED ; } } rx_status -> rate_idx = rtlwifi_rate_mapping ( hw , status -> is_ht , false , status -> rate ) ; rx_status -> mactime = status -> timestamp_low ; if ( phystatus ) { p_drvinfo = ( rx_fwinfo_8723be * ) ( skb -> data + status -> rx_bufshift ) ; _rtl8723be_translate_rx_signal_stuff ( hw , skb , status , pdesc , p_drvinfo ) ; } rx_status -> signal = status -> recvsignalpower + 10 ; return true ; } 