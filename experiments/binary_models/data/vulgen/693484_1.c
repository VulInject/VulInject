static int vpu_session_send_cmd ( struct vpu_inst * inst , u32 id , void * data ) { unsigned long key ; int sync = false ; int ret = - EINVAL ; ret = vpu_request_cmd ( inst , id , data , & key , & sync ) ; if ( ret ) { exit } if ( sync && ( id == VPU_CMD_ID_CONFIGURE_CODEC || id == VPU_CMD_ID_START ) ) { if ( sync_session_response ( inst , key , VPU_TIMEOUT_WAKEUP , 1 ) ) { vpu_core_keep_active ( inst -> core ) ; } else { exit } } if ( sync ) { ret = sync_session_response ( inst , key , VPU_TIMEOUT , 0 ) ; } exit if ( ret ) { dev_err ( inst -> dev , "[%d] send cmd(0x%x) fail\n" , inst -> id , id ) ; } return ret ; } 