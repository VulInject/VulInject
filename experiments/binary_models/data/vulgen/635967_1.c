static void load_db ( RSCameraDb * camera_db ) { xmlDocPtr doc ; xmlNodePtr cur ; xmlNodePtr entry = NULL ; xmlChar * val ; RSProfileFactory * profile_factory = rs_profile_factory_new_default ( ) ; doc = xmlParseFile ( camera_db -> path ) ; if ( ! doc ) { return ; } cur = xmlDocGetRootElement ( doc ) ; if ( cur && ( xmlStrcmp ( cur -> name , BAD_CAST "rawstudio-camera-database" ) == 0 ) ) { cur = cur -> xmlChildrenNode ; while ( cur ) { if ( ( ! xmlStrcmp ( cur -> name , BAD_CAST "camera" ) ) ) { GtkTreeIter iter ; gtk_list_store_append ( camera_db -> cameras , & iter ) ; entry = cur -> xmlChildrenNode ; while ( entry ) { val = xmlNodeListGetString ( doc , entry -> xmlChildrenNode , 1 ) ; if ( ( ! xmlStrcmp ( entry -> name , BAD_CAST "make" ) ) ) { gtk_list_store_set ( camera_db -> cameras , & iter , COLUMN_MAKE , val , - 1 ) ; } if ( ( ! xmlStrcmp ( entry -> name , BAD_CAST "model" ) ) ) { gtk_list_store_set ( camera_db -> cameras , & iter , COLUMN_MODEL , val , - 1 ) ; } if ( ( ! xmlStrcmp ( entry -> name , BAD_CAST "dcp-profile" ) ) ) { gtk_list_store_set ( camera_db -> cameras , & iter , COLUMN_PROFILE , rs_profile_factory_find_from_id ( profile_factory , ( gchar * ) val ) , - 1 ) ; } if ( ( ! xmlStrcmp ( entry -> name , BAD_CAST "settings" ) ) ) { val = xmlGetProp ( entry , BAD_CAST "id" ) ; gint id = ( val ) ?atoi ( ( gchar * ) val ) : 0 ; xmlFree ( val ) ; id = CLAMP ( id , 0 , 2 ) ; RSSettings * settings = rs_settings_new ( ) ; rs_cache_load_setting ( settings , doc , entry -> xmlChildrenNode , 100 ) ; gtk_list_store_set ( camera_db -> cameras , & iter , COLUMN_SETTINGS0 + id , settings , - 1 ) ; g_object_unref ( settings ) ; } entry = entry -> next ; } } cur = cur -> next ; } } else { g_warning ( PACKAGE " did not understand the format in %s" , camera_db -> path ) ; } xmlFreeDoc ( doc ) ; } 