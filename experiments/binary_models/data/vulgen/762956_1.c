void sbr_envelope ( bitfile * ld , sbr_info * sbr , uint8_t ch ) { uint8_t env , band ; int8_t delta = 0 ; sbr_huff_tab t_huff , f_huff ; if ( ( sbr -> L_E [ ch ] == 1 ) && ( sbr -> bs_frame_class [ ch ] == FIXFIX ) ) { sbr -> amp_res [ ch ] = 0 ; } else { sbr -> amp_res [ ch ] = sbr -> bs_amp_res ; } if ( ( sbr -> bs_coupling ) && ( ch == 1 ) ) { delta = 1 ; if ( sbr -> amp_res [ ch ] ) { t_huff = t_huffman_env_bal_3_0dB ; f_huff = f_huffman_env_bal_3_0dB ; } else { t_huff = t_huffman_env_bal_1_5dB ; f_huff = f_huffman_env_bal_1_5dB ; } } else { delta = 0 ; if ( sbr -> amp_res [ ch ] ) { t_huff = t_huffman_env_3_0dB ; f_huff = f_huffman_env_3_0dB ; } else { t_huff = t_huffman_env_1_5dB ; f_huff = f_huffman_env_1_5dB ; } } for ( env = 0 ; env < sbr -> L_E [ ch ] ; env ++ ) { if ( sbr -> bs_df_env [ ch ] [ env ] == 0 ) { if ( ( sbr -> bs_coupling == 1 ) && ( ch == 1 ) ) { if ( sbr -> amp_res [ ch ] ) { sbr -> E [ ch ] [ 0 ] [ env ] = ( uint16_t ) ( faad_getbits ( ld , 5 DEBUGVAR ( 1 , 272 , "sbr_envelope(): bs_data_env" ) ) << delta ) ; } else { sbr -> E [ ch ] [ 0 ] [ env ] = ( uint16_t ) ( faad_getbits ( ld , 6 DEBUGVAR ( 1 , 273 , "sbr_envelope(): bs_data_env" ) ) << delta ) ; } } else { if ( sbr -> amp_res [ ch ] ) { sbr -> E [ ch ] [ 0 ] [ env ] = ( uint16_t ) ( faad_getbits ( ld , 6 DEBUGVAR ( 1 , 274 , "sbr_envelope(): bs_data_env" ) ) << delta ) ; } else { sbr -> E [ ch ] [ 0 ] [ env ] = ( uint16_t ) ( faad_getbits ( ld , 7 DEBUGVAR ( 1 , 275 , "sbr_envelope(): bs_data_env" ) ) << delta ) ; } } for ( band = 1 ; band < sbr -> n [ sbr -> f [ ch ] [ env ] ] ; band ++ ) { sbr -> E [ ch ] [ band ] [ env ] = ( sbr_huff_dec ( ld , f_huff ) << delta ) ; } } else { for ( band = 0 ; band < sbr -> n [ sbr -> f [ ch ] [ env ] ] ; band ++ ) { sbr -> E [ ch ] [ band ] [ env ] = ( sbr_huff_dec ( ld , t_huff ) << delta ) ; } } } } 