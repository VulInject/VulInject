static struct ovsdb_error * OVS_WARN_UNUSED_RESULT ovsdb_jsonrpc_parse_monitor_request ( struct ovsdb_monitor * dbmon , const struct ovsdb_table * table , struct ovsdb_monitor_session_condition * cond , const struct json * monitor_request ) { const struct ovsdb_table_schema * ts = table -> schema ; enum ovsdb_monitor_selection select ; const struct json * columns , * select_json , * where = NULL ; struct ovsdb_parser parser ; struct ovsdb_error * error ; ovsdb_parser_init ( & parser , monitor_request , "table %s" , ts -> name ) ; if ( cond ) { where = ovsdb_parser_member ( & parser , "where" , OP_ARRAY | OP_OPTIONAL ) ; } columns = ovsdb_parser_member ( & parser , "columns" , OP_ARRAY | OP_OPTIONAL ) ; select_json = ovsdb_parser_member ( & parser , "select" , OP_OBJECT | OP_OPTIONAL ) ; error = ovsdb_parser_finish ( & parser ) ; if ( error ) { return error ; } if ( select_json ) { select = 0 ; ovsdb_parser_init ( & parser , select_json , "table %s select" , ts -> name ) ; if ( parse_bool ( & parser , "initial" , true ) ) { select |= OJMS_INITIAL ; } if ( parse_bool ( & parser , "insert" , true ) ) { select |= OJMS_INSERT ; } if ( parse_bool ( & parser , "delete" , true ) ) { select |= OJMS_DELETE ; } if ( parse_bool ( & parser , "modify" , true ) ) { select |= OJMS_MODIFY ; } error = ovsdb_parser_finish ( & parser ) ; if ( error ) { return error ; } } else { select = OJMS_INITIAL | OJMS_INSERT | OJMS_DELETE | OJMS_MODIFY ; } ovsdb_monitor_table_add_select ( dbmon , table , select ) ; if ( columns ) { size_t i ; if ( columns -> type != JSON_ARRAY ) { return ovsdb_syntax_error ( columns , NULL , "array of column names expected" ) ; } for ( i = 0 ; i < columns -> array . n ; i ++ ) { const struct ovsdb_column * column ; const char * s ; if ( columns -> array . elems [ i ] -> type != JSON_STRING ) { return ovsdb_syntax_error ( columns , NULL , "array of column names expected" ) ; } s = columns -> array . elems [ i ] -> string ; column = shash_find_data ( & table -> schema -> columns , s ) ; if ( ! column ) { return ovsdb_syntax_error ( columns , NULL , "%s is not a valid " "column name" , s ) ; } if ( ovsdb_monitor_add_column ( dbmon , table , column , select , true ) ) { return ovsdb_syntax_error ( columns , NULL , "column %s " "mentioned more than once" , column -> name ) ; } } } else { struct shash_node * node ; SHASH_FOR_EACH ( , ) { const struct ovsdb_column * column = node -> data ; } } if ( cond ) { error = ovsdb_monitor_table_condition_create ( cond , table , where ) ; if ( error ) { return error ; } } return NULL ; } 