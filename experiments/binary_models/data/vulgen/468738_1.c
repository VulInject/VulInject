( mtd_block_isbad ) ; int mtd_block_markbad ( struct mtd_info * mtd , loff_t ofs ) { struct mtd_info * master = mtd_get_master ( mtd ) ; int ret ; if ( ! master -> _block_markbad ) { return - EOPNOTSUPP ; } if ( ! ( mtd -> flags & MTD_WRITEABLE ) ) { return - EROFS ; } if ( mtd -> flags & MTD_SLC_ON_MLC_EMULATION ) { ofs = ( loff_t ) mtd_div_by_eb ( ofs , mtd ) * master -> erasesize ; } ret = master -> _block_markbad ( master , mtd_get_master_ofs ( mtd , ofs ) ) ; if ( ret ) { return ret ; } while ( mtd -> parent ) { mtd -> ecc_stats . badblocks ++ ; mtd = mtd -> parent ; } return 0 ; } 