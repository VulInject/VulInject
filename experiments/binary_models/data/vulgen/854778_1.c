static int damap_addrset_flush_locked ( damap_t * damapp ) { dam_t * mapp = ( dam_t * ) damapp ; int idx ; ASSERT ( mapp ) ; ASSERT ( mutex_owned ( & mapp -> dam_lock ) ) ; if ( mapp -> dam_rptmode != DAMAP_REPORT_FULLSET ) { return ( DAM_EINVAL ) ; } DTRACE_PROBE2 ( damap__addrset__flush__locked__enter , char * , mapp -> dam_name , dam_t * , mapp ) ; if ( mapp -> dam_flags & DAM_SETADD ) { DTRACE_PROBE2 ( damap__addrset__flush__locked__reset , char * , mapp -> dam_name , dam_t * , mapp ) ; dam_sched_timeout ( NULL , mapp , 0 ) ; DAM_INCR_STAT ( mapp , dam_jitter ) ; for ( idx = 1 ; idx < mapp -> dam_high ; idx ++ ) { if ( DAM_IN_REPORT ( mapp , idx ) ) { dam_addr_report_release ( mapp , idx ) ; } } mapp -> dam_flags &= ~ DAM_SETADD ; cv_signal ( & mapp -> dam_sync_cv ) ; } return ( DAM_SUCCESS ) ; } 