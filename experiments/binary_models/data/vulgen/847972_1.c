get_char ( , , , ) { int c , i ; long r = EOF ; unsigned char buf [ 4 ] ; for ( i = 0 ; i < encoding_bytes ; i ++ ) { if ( * magiccount ) { ( * magiccount ) -- ; c = * ( * magic ) ++ ; } else { c = getc_unlocked ( stream ) ; c = getc ( stream ) ; if ( c == EOF ) { return EOF ; } } ( * address ) ++ ; buf [ i ] = c ; } switch ( encoding ) { case 'S' : case 's' : r = buf [ 0 ] ; break ; case 'b' : r = ( buf [ 0 ] << 8 ) | buf [ 1 ] ; break ; case 'l' : r = buf [ 0 ] | ( buf [ 1 ] << 8 ) ; break ; case 'B' : r = ( ( long ) buf [ 0 ] << 24 ) | ( ( long ) buf [ 1 ] << 16 ) | ( ( long ) buf [ 2 ] << 8 ) | buf [ 3 ] ; break ; case 'L' : r = buf [ 0 ] | ( ( long ) buf [ 1 ] << 8 ) | ( ( long ) buf [ 2 ] << 16 ) | ( ( long ) buf [ 3 ] << 24 ) ; break ; } if ( r == EOF ) { return 0 ; } return r ; } 