int dso__load_vmlinux ( struct dso * dso , struct map * map , const char * vmlinux , bool vmlinux_allocated ) { int err = - 1 ; struct symsrc ss ; char symfs_vmlinux [ PATH_MAX ] ; enum dso_binary_type symtab_type ; if ( vmlinux [ 0 ] == '/' ) { snprintf ( symfs_vmlinux , sizeof ( symfs_vmlinux ) , "%s" , vmlinux ) ; } else { symbol__join_symfs ( symfs_vmlinux , vmlinux ) ; } if ( dso -> kernel == DSO_SPACE__KERNEL_GUEST ) { symtab_type = DSO_BINARY_TYPE__GUEST_VMLINUX ; } else { symtab_type = DSO_BINARY_TYPE__VMLINUX ; } if ( symsrc__init ( & ss , dso , symfs_vmlinux , symtab_type ) ) { return - 1 ; } err = dso__load_sym ( dso , map , & ss , & ss , 0 ) ; symsrc__destroy ( & ss ) ; if ( err > 0 ) { if ( dso -> kernel == DSO_SPACE__KERNEL_GUEST ) { dso -> binary_type = DSO_BINARY_TYPE__GUEST_VMLINUX ; } else { dso -> binary_type = DSO_BINARY_TYPE__VMLINUX ; } dso__set_long_name ( dso , vmlinux , vmlinux_allocated ) ; pr_debug ( "Using %s for symbols\n" , symfs_vmlinux ) ; } return err ; } 