START_TEST ( ) { job_array pa ; pa . ai_qs . slot_limit = 2 ; pa . ai_qs . jobs_running = 2 ; fail_unless ( pa . need_to_update_slot_limits ( ) == false ) ; pa . ai_qs . jobs_running = 3 ; fail_unless ( pa . need_to_update_slot_limits ( ) == false ) ; pa . ai_qs . jobs_running = 1 ; fail_unless ( pa . need_to_update_slot_limits ( ) == true ) ; pa . ai_qs . jobs_running = 0 ; fail_unless ( pa . need_to_update_slot_limits ( ) == true ) ; } END_TEST START_TEST ( update_array_values_test ) { job_array * pa = new job_array ( ) ; const char * job_id = "1[0].napali" ; pa -> ai_qs . num_jobs = 10 ; pa -> update_array_values ( JOB_STATE_TRANSIT , aeQueue , job_id , - 1 ) ; pa -> update_array_values ( JOB_STATE_QUEUED , aeRun , job_id , - 1 ) ; fail_unless ( pa -> ai_qs . jobs_running == 1 , "Expected 1 running job, got %d" , pa -> ai_qs . jobs_running ) ; fail_unless ( pa -> ai_qs . num_started == 1 , "Expected 1 job started, got %d" , pa -> ai_qs . num_started ) ; pa -> update_array_values ( JOB_STATE_RUNNING , aeRerun , job_id , - 1 ) ; fail_unless ( pa -> ai_qs . jobs_running == 0 , "Expected 0 running jobs, got %d" , pa -> ai_qs . jobs_running ) ; fail_unless ( pa -> ai_qs . num_started == 0 , "Expected 0 started jobs, got %d" , pa -> ai_qs . num_started ) ; } END_TEST Suite * job_array_suite ( void ) { Suite * s = suite_create ( "job_array_suite methods" ) ; TCase * tc_core = tcase_create ( "need_to_update_slot_limits_test" ) ; tcase_add_test ( tc_core , need_to_update_slot_limits_test ) ; tcase_add_test ( tc_core , test_constructors ) ; tcase_add_test ( tc_core , test_parse_array_request ) ; suite_add_tcase ( s , tc_core ) ; tc_core = tcase_create ( "update_array_values_test" ) ; tcase_add_test ( tc_core , update_array_values_test ) ; tcase_add_test ( tc_core , test_set_slot_limit ) ; tcase_add_test ( tc_core , test_initialize_uncreated_ids ) ; suite_add_tcase ( s , tc_core ) ; return s ; } void rundebug ( ) { } int main ( void ) { int number_failed = 0 ; SRunner * sr = NULL ; rundebug ( ) ; sr = srunner_create ( job_array_suite ( ) ) ; srunner_set_log ( sr , "job_array_suite.log" ) ; srunner_run_all ( sr , CK_NORMAL ) ; number_failed = srunner_ntests_failed ( sr ) ; return number_failed ; } 