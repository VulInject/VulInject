ATF_TC_BODY ( , ) { gid_t gidset [ NGROUPS_MAX ] ; int i , n , rv , sta ; pid_t pid ; n = getgroups ( NGROUPS_MAX , gidset ) ; ATF_REQUIRE ( n >= 0 ) ; for ( i = 0 ; i < n ; i ++ ) { pid = fork ( ) ; ATF_REQUIRE ( pid >= 0 ) ; if ( pid == 0 ) { rv = setgid ( gidset [ i ] ) ; _exit ( EXIT_SUCCESS ) ; } ( void ) wait ( & sta ) ; if ( WIFEXITED ( sta ) == 0 || WEXITSTATUS ( sta ) != EXIT_SUCCESS ) { atf_tc_fail ( "getgroups(2) is inconsistent" ) ; } } } 