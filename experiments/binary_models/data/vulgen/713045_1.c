static irqreturn_t ps2_txint ( int irq , void * dev_id ) { struct ps2if * ps2if = dev_id ; unsigned int status ; spin_lock ( & ps2if -> lock ) ; status = readl_relaxed ( ps2if -> base + PS2STAT ) ; if ( ps2if -> head == ps2if -> tail ) { disable_irq_nosync ( irq ) ; } if ( status & PS2STAT_TXE ) { writel_relaxed ( ps2if -> buf [ ps2if -> tail ] , ps2if -> base + PS2DATA ) ; ps2if -> tail = ( ps2if -> tail + 1 ) & ( sizeof ( ps2if -> buf ) - 1 ) ; } return IRQ_HANDLED ; } 