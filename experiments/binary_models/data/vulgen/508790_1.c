static MagickBooleanType WriteFPXImage ( const ImageInfo * image_info , Image * image ) { FPXBackground background_color ; FPXColorspace colorspace = { TRUE 4 { { NIFRGB_R DATA_TYPE_UNSIGNED_BYTE } { NIFRGB_G DATA_TYPE_UNSIGNED_BYTE } { NIFRGB_B DATA_TYPE_UNSIGNED_BYTE } { ALPHA DATA_TYPE_UNSIGNED_BYTE } } } ; const char * comment , * label , * option ; FPXCompressionOption compression ; FPXImageDesc fpx_info ; FPXImageHandle * flashpix ; FPXStatus fpx_status ; FPXSummaryInformation summary_info ; MagickBooleanType status ; QuantumInfo * quantum_info ; QuantumType quantum_type ; const PixelPacket * p ; ssize_t i ; size_t memory_limit ; ssize_t y ; unsigned char * pixels ; unsigned int tile_height , tile_width ; assert ( image_info != ( const ImageInfo * ) NULL ) ; assert ( image_info -> signature == MagickCoreSignature ) ; assert ( image != ( Image * ) NULL ) ; assert ( image -> signature == MagickCoreSignature ) ; if ( IsEventLogging ( ) != MagickFalse ) { ( void ) LogMagickEvent ( TraceEvent , GetMagickModule ( ) , "%s" , image -> filename ) ; } status = OpenBlob ( image_info , image , WriteBinaryBlobMode , & image -> exception ) ; if ( status == MagickFalse ) { return ( status ) ; } if ( IssRGBCompatibleColorspace ( image -> colorspace ) == MagickFalse ) { ( void ) TransformImageColorspace ( image , sRGBColorspace ) ; } ( void ) CloseBlob ( image ) ; image -> depth = 8 ; memory_limit = 20000000 ; fpx_status = FPX_SetToolkitMemoryLimit ( & memory_limit ) ; if ( fpx_status != FPX_OK ) { ThrowWriterException ( DelegateError , "UnableToInitializeFPXLibrary" ) ; } tile_width = 64 ; tile_height = 64 ; colorspace . numberOfComponents = 3 ; if ( image -> matte != MagickFalse ) { colorspace . numberOfComponents = 4 ; } if ( ( image_info -> type != TrueColorType ) && SetImageGray ( image , & image -> exception ) ) { colorspace . numberOfComponents = 1 ; colorspace . theComponents [ 0 ] . myColor = MONOCHROME ; } background_color . color1_value = 0 ; background_color . color2_value = 0 ; background_color . color3_value = 0 ; background_color . color4_value = 0 ; compression = NONE ; if ( image -> compression == JPEGCompression ) { compression = JPEG_UNSPECIFIED ; } { FSSpec fsspec ; FilenameToFSSpec ( filename , & fsspec ) ; fpx_status = FPX_CreateImageByFilename ( , , 75 "UnableToSetJPEGLevel" "label" 1 "UnableToSetImageTitle" "comment" "UnableToSetSummaryInfo" "MemoryAllocationFailed" 0 1 1 0 1 1 2 3 1 0 0 1 "fpx:view" , , , , , 1.0 1.0 0.0 0.0 0.0 0.0 1.0 0.0 0.0 0.0 0.0 1.0 0.0 0.0 0.0 0.0 1.0 0.0 0.1 0.2 0.1 0.8 1.0 0.0 0.0 0.0 0.0 1.0 0.0 0.0 0.0 0.0 1.0 0.0 0.0 0.0 0.0 1.0 0 0.5 0.5 0.5 1.0 1.0 "UnableToSetAffineMatrix" "UnableToSetAspectRatio" "UnableToSetColorTwist" "UnableToSetContrast" "UnableToSetFilteringValue" "UnableToSetRegionOfInterest" ) ; } } 