void set_rect_dimens ( PDF pdf , halfword p , halfword parent_box , scaledpos cur , scaled_whd alt_rule ) { scaledpos ll , ur , pos_ll , pos_ur ; posstructure localpos ; localpos . dir = pdf -> posstruct -> dir ; halfword lcrap = 0 ; halfword rcrap = 0 ; halfword lskip = 0 ; halfword rskip = 0 ; if ( pdf_linking ) { if ( subtype ( p ) == pdf_link_data_node ) { alt_rule . wd = calculate_width_to_endlink ( list_ptr ( parent_box ) , parent_box , & lskip , & rskip ) ; if ( pdf -> link_stack [ pdf -> link_stack_ptr ] . direction == dir_TRT ) { alt_rule . wd = - alt_rule . wd ; localpos . dir = dir_TRT ; lcrap = lskip ; } else { lcrap = - lskip ; } } } ll . h = - lcrap - rcrap ; if ( is_running ( alt_rule . wd ) ) { ur . h = width ( parent_box ) - cur . h ; } else { ur . h = alt_rule . wd - lcrap - rcrap ; } if ( is_running ( alt_rule . dp ) ) { ll . v = depth ( parent_box ) - cur . v ; } else { ll . v = alt_rule . dp ; } if ( is_running ( alt_rule . ht ) ) { ur . v = - height ( parent_box ) - cur . v ; } else { ur . v = - alt_rule . ht ; } synch_pos_with_cur ( & localpos , pdf -> posstruct , ll ) ; pos_ll = localpos . pos ; synch_pos_with_cur ( & localpos , pdf -> posstruct , ur ) ; pos_ur = localpos . pos ; if ( global_shipping_mode == SHIPPING_PAGE && matrixused ( ) ) { matrixtransformrect ( pos_ll . h , pos_ll . v , pos_ur . h , pos_ur . v ) ; pos_ll . h = getllx ( ) ; pos_ll . v = getlly ( ) ; pos_ur . h = geturx ( ) ; pos_ur . v = getury ( ) ; } pdf_ann_left ( p ) = pos_ll . h ; pdf_ann_bottom ( p ) = pos_ll . v ; pdf_ann_right ( p ) = pos_ur . h ; pdf_ann_top ( p ) = pos_ur . v ; } 