static int __bencode_str_dump ( char * out , bencode_item_t * item ) { char * orig = out ; bencode_item_t * child ; assert ( item -> iov [ 0 ] . iov_base != NULL ) ; out += __bencode_str_cpy ( out , & item -> iov [ 0 ] , 1 ) ; child = item -> child ; while ( child ) { out += __bencode_str_dump ( out , child ) ; child = child -> sibling ; } if ( item -> type == BENCODE_IOVEC ) { out += __bencode_str_cpy ( out , item -> iov [ 1 ] . iov_base , item -> iov [ 1 ] . iov_len ) ; } assert ( ( out - orig ) == item -> str_len ) ; * out = '\0' ; return item -> str_len ; } 