tui_command_loop ( ) { int length ; char * a_prompt ; char * gdb_prompt = get_prompt ( ) ; if ( async_command_editing_p ) { length = strlen ( PREFIX ( 0 ) ) + strlen ( gdb_prompt ) + strlen ( SUFFIX ( 0 ) ) + 1 ; a_prompt = ( char * ) xmalloc ( length ) ; strcpy ( a_prompt , PREFIX ( 0 ) ) ; strcat ( a_prompt , gdb_prompt ) ; strcat ( a_prompt , SUFFIX ( 0 ) ) ; rl_callback_handler_install ( a_prompt , input_handler ) ; } else { display_gdb_prompt ( 0 ) ; } while ( 1 ) { int result = catch_errors ( gdb_do_one_event , 0 , "" , RETURN_MASK_ALL ) ; if ( result < 0 ) { break ; } if ( tui_active ) { uiout = tui_out ; } else { uiout = tui_old_uiout ; } } return ; } 