int psp_ras_invoke ( struct psp_context * psp , uint32_t ta_cmd_id ) { struct ta_ras_shared_memory * ras_cmd ; int ret ; ras_cmd = ( ta_ras_shared_memory * ) psp -> ras_context . context . mem_context . shared_buf ; if ( amdgpu_sriov_vf ( psp -> adev ) ) { return 0 ; } ret = psp_ta_invoke ( psp , ta_cmd_id , & psp -> ras_context . context ) ; if ( ras_cmd -> if_version > RAS_TA_HOST_IF_VER ) { DRM_WARN ( "RAS: Unsupported Interface" ) ; return - EINVAL ; } if ( ! ret ) { if ( ras_cmd -> ras_out_message . flags . err_inject_switch_disable_flag ) { dev_warn ( psp -> adev -> dev , "ECC switch disabled\n" ) ; ras_cmd -> ras_status = TA_RAS_STATUS__ERROR_RAS_NOT_AVAILABLE ; } if ( ras_cmd -> ras_out_message . flags . reg_access_failure_flag ) { dev_warn ( psp -> adev -> dev , "RAS internal register access blocked\n" ) ; } psp_ras_ta_check_status ( psp ) ; } return ret ; } 