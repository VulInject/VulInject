MODULE_AUTHOR ( "Thomas Renninger<trenn@suse.de>" ) ; MODULE_DESCRIPTION ( "ACPI EC sysfs access driver" ) ; MODULE_LICENSE ( "GPL" ) ; static bool write_support ; module_param ( write_support , bool , 0644 ) ; MODULE_PARM_DESC ( write_support , "Dangerous, reboot and removal of battery may " "be needed." ) ; static struct dentry * acpi_ec_debugfs_dir ; static ssize_t acpi_ec_read_io ( struct file * f , char __user * buf , size_t count , loff_t * off ) { unsigned int size = EC_SPACE_SIZE ; loff_t init_off = * off ; int err = 0 ; if ( * off + count >= size ) { size -= * off ; count = size ; } else { size = count ; } while ( size ) { u8 byte_read ; err = ec_read ( * off , & byte_read ) ; if ( err ) { return err ; } if ( put_user ( byte_read , buf + * off - init_off ) ) { if ( * off - init_off ) { return * off - init_off ; } return - EFAULT ; } * off += 1 ; size -- ; } return count ; } 