static int setup_listener ( unsigned short port ) { struct sockaddr_in addr ; int fd ; int ret ; fd = socket ( AF_INET , SOCK_STREAM , 0 ) ; if ( fd == - 1 ) { fprintf ( stderr , "socket: %s\n" , strerror ( errno ) ) ; return - 1 ; } memset ( & addr , 0x0 , sizeof ( addr ) ) ; addr . sin_family = AF_INET ; addr . sin_port = ntohs ( port ) ; ret = bind ( fd , ( sockaddr * ) & addr , sizeof ( addr ) ) ; if ( ret == - 1 ) { fprintf ( stderr , "bind: %s\n" , strerror ( errno ) ) ; close ( fd ) ; return - 1 ; } ret = listen ( fd , 5 ) ; return fd ; } 