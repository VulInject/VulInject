static int shutdown_thread_fn ( void * data ) { int ret ; struct mcu * mcu = glob_mcu ; while ( ! kthread_should_stop ( ) ) { ret = i2c_smbus_read_byte_data ( mcu -> client , MCU_REG_CTRL ) ; if ( ret < 0 ) { pr_err ( "MCU status reg read failed.\n" ) ; } mcu -> reg_ctrl = ret ; if ( mcu -> reg_ctrl & MCU_CTRL_BTN ) { i2c_smbus_write_byte_data ( mcu -> client , MCU_REG_CTRL , mcu -> reg_ctrl & ~ MCU_CTRL_BTN ) ; ctrl_alt_del ( ) ; } schedule_timeout ( HZ ) ; } return 0 ; } 