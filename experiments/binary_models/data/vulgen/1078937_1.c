static int bmp280_write_raw ( struct iio_dev * indio_dev , struct iio_chan_spec const * chan , int val , int val2 , long mask ) { struct bmp280_data * data = iio_priv ( indio_dev ) ; int ret = 0 ; switch ( mask ) { case IIO_CHAN_INFO_OVERSAMPLING_RATIO : pm_runtime_get_sync ( data -> dev ) ; mutex_lock ( & data -> lock ) ; switch ( chan -> type ) { case IIO_HUMIDITYRELATIVE : ret = bmp280_write_oversampling_ratio_humid ( data , val ) ; break ; case IIO_PRESSURE : ret = bmp280_write_oversampling_ratio_press ( data , val ) ; break ; case IIO_TEMP : ret = bmp280_write_oversampling_ratio_temp ( data , val ) ; break ; default : ret = - EINVAL ; break ; } mutex_unlock ( & data -> lock ) ; pm_runtime_mark_last_busy ( data -> dev ) ; pm_runtime_put_autosuspend ( data -> dev ) ; break ; case IIO_CHAN_INFO_SAMP_FREQ : pm_runtime_get_sync ( data -> dev ) ; mutex_lock ( & data -> lock ) ; ret = bmp280_write_sampling_frequency ( data , val , val2 ) ; mutex_unlock ( & data -> lock ) ; pm_runtime_mark_last_busy ( data -> dev ) ; pm_runtime_put_autosuspend ( data -> dev ) ; break ; case IIO_CHAN_INFO_LOW_PASS_FILTER_3DB_FREQUENCY : pm_runtime_get_sync ( data -> dev ) ; mutex_lock ( & data -> lock ) ; mutex_unlock ( & data -> lock ) ; pm_runtime_mark_last_busy ( data -> dev ) ; pm_runtime_put_autosuspend ( data -> dev ) ; break ; default : return - EINVAL ; } return ret ; } 