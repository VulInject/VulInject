static int chv_pinctrl_resume_noirq ( struct device * dev ) { struct intel_pinctrl * pctrl = dev_get_drvdata ( dev ) ; struct intel_community_context * cctx = & pctrl -> context . communities [ 0 ] ; unsigned long flags ; int i ; raw_spin_lock_irqsave ( & chv_lock , flags ) ; chv_pctrl_writel ( pctrl , CHV_INTMASK , 0x0000 ) ; for ( i = 0 ; i < pctrl -> soc -> npins ; i ++ ) { const struct pinctrl_pin_desc * desc ; struct intel_pad_context * ctx = & pctrl -> context . pads [ i ] ; u32 val ; desc = & pctrl -> soc -> pins [ i ] ; val = chv_readl ( pctrl , desc -> number , CHV_PADCTRL0 ) ; val &= ~ CHV_PADCTRL0_GPIORXSTATE ; if ( ctx -> padctrl0 != val ) { chv_writel ( pctrl , desc -> number , CHV_PADCTRL0 , ctx -> padctrl0 ) ; dev_dbg ( dev , "restored pin %2u ctrl0 0x%08x\n" , desc -> number , chv_readl ( pctrl , desc -> number , CHV_PADCTRL0 ) ) ; } val = chv_readl ( pctrl , desc -> number , CHV_PADCTRL1 ) ; if ( ctx -> padctrl1 != val ) { chv_writel ( pctrl , desc -> number , CHV_PADCTRL1 , ctx -> padctrl1 ) ; dev_dbg ( dev , "restored pin %2u ctrl1 0x%08x\n" , desc -> number , chv_readl ( pctrl , desc -> number , CHV_PADCTRL1 ) ) ; } } chv_pctrl_writel ( pctrl , CHV_INTSTAT , 0xffff ) ; chv_pctrl_writel ( pctrl , CHV_INTMASK , cctx -> saved_intmask ) ; raw_spin_unlock_irqrestore ( & chv_lock , flags ) ; return 0 ; } 