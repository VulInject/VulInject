int loaddirect_ldap ( char * nsmap , char * localmap , char * opts , char * * stack , char * * * stkptr ) { char searchfilter [ LDAP_FILT_MAXSIZ ] ; int res ; ns_ldap_result_t * result = NULL ; ns_ldap_error_t * errp = NULL ; struct loaddirect_cbdata direct_cbdata ; if ( trace > 1 ) { trace_prt ( 1 , "loaddirect_ldap called\n" ) ; } direct_cbdata . ptr1 = opts ; direct_cbdata . ptr2 = localmap ; direct_cbdata . ptr3 = stack ; direct_cbdata . ptr4 = stkptr ; ( void ) sprintf ( searchfilter , defaultFilter , "*" ) ; if ( trace > 1 ) { trace_prt ( 1 , "loaddirect_ldap: Requesting list for %s in %s\n" , searchfilter , nsmap ) ; } res = __ns_ldap_list ( nsmap , searchfilter , NULL , NULL , NULL , 0 , & result , & errp , directmap_callback , ( void * ) & direct_cbdata ) ; if ( res != NS_LDAP_SUCCESS ) { if ( errp ) { char errstr [ MAXERROR ] ; if ( verbose ) { ( void ) sprintf ( errstr , gettext ( "ldap server can't list map," " '%s': '%s' - '%d'." ) , nsmap , errp -> message , errp -> status ) ; syslog ( LOG_ERR , errstr ) ; } __ns_ldap_freeError ( & errp ) ; } else { if ( verbose ) { char * errmsg ; __ns_ldap_err2str ( res , & errmsg ) ; syslog ( LOG_ERR , errmsg ) ; } } if ( result ) { __ns_ldap_freeResult ( 0 ) ; } return ( ldap_err ( res ) ) ; } __ns_ldap_freeResult ( & result ) ; return ( __NSW_SUCCESS ) ; } 