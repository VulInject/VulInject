static int __init add_huge_page_size ( unsigned long long size ) { int shift = __ffs ( size ) ; int mmu_psize ; if ( ! is_power_of_4 ( size ) ) { return - EINVAL ; } if ( ! is_power_of_2 ( size ) || ( shift > SLICE_HIGH_SHIFT ) ) { return - EINVAL ; } if ( ( mmu_psize = shift_to_mmu_psize ( shift ) ) < 0 ) { return - EINVAL ; } if ( radix_enabled ( ) ) { if ( mmu_psize != MMU_PAGE_2M ) { return - EINVAL ; } } else { if ( mmu_psize != MMU_PAGE_16M && mmu_psize != MMU_PAGE_16G ) { return - EINVAL ; } } BUG_ON ( mmu_psize_defs [ mmu_psize ] . shift != shift ) ; if ( size_to_hstate ( size ) ) { return 0 ; } hugetlb_add_hstate ( shift - PAGE_SHIFT ) ; return 0 ; } 