static int iter_cb ( void * cbdata , const char * p ) { struct iter_cb_data * d = cbdata ; krb5_error_code ret = 0 ; size_t n = d -> n ; if ( d -> rsp == NULL && ( d -> rsp = krb5_storage_emem ( ) ) == NULL ) { return krb5_enomem ( d -> context ) ; } if ( d -> i == 0 ) { ret = krb5_store_int32 ( d -> rsp , d -> ret ) ; if ( ret ) { return ret ; } if ( d -> ret ) { return ret ; } } if ( d -> initial ) { d -> initial = 0 ; ret = krb5_store_int32 ( d -> rsp , - ( int ) n ) ; if ( ret == 0 ) { ret = iter_cb_send_now ( d ) ; } if ( ret ) { return ret ; } ret = krb5_store_int32 ( d -> rsp , d -> ret ) ; if ( ret ) { return ret ; } if ( d -> ret ) { return ret ; } } if ( p ) { ret = krb5_store_string ( d -> rsp , p ) ; d -> i ++ ; } else { d -> i = n ; } if ( ret == 0 && d -> i == n ) { ret = iter_cb_send_now ( d ) ; } if ( d -> stop ) { return EINTR ; } return ret ; } 