tsd_t * tsd_fetch_slow ( tsd_t * tsd , bool minimal ) { if ( tsd_state_get ( tsd ) == tsd_state_nominal_slow ) { } if ( tsd_state_get ( tsd ) == tsd_state_nominal_recompute ) { tsd_slow_update ( tsd ) ; } if ( tsd_state_get ( tsd ) == tsd_state_uninitialized ) { if ( ! minimal ) { if ( tsd_booted ) { tsd_state_set ( tsd , tsd_state_nominal ) ; tsd_slow_update ( tsd ) ; tsd_set ( tsd ) ; tsd_data_init ( tsd ) ; } } else { tsd_state_set ( tsd , tsd_state_minimal_initialized ) ; tsd_set ( tsd ) ; tsd_data_init_nocleanup ( tsd ) ; } } if ( tsd_state_get ( tsd ) == tsd_state_minimal_initialized ) { if ( ! minimal ) { tsd_state_set ( tsd , tsd_state_nominal ) ; assert ( * tsd_reentrancy_levelp_get ( tsd ) >= 1 ) ; ( * tsd_reentrancy_levelp_get ( tsd ) ) -- ; tsd_slow_update ( tsd ) ; tsd_data_init ( tsd ) ; } else { assert_tsd_data_cleanup_done ( tsd ) ; } } if ( tsd_state_get ( tsd ) == tsd_state_purgatory ) { tsd_state_set ( tsd , tsd_state_reincarnated ) ; tsd_set ( tsd ) ; tsd_data_init_nocleanup ( tsd ) ; } else { assert ( tsd_state_get ( tsd ) == tsd_state_reincarnated ) ; } return tsd ; } 