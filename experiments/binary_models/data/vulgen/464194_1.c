void wsmouse_motion_sync ( struct wsmouseinput * input , struct evq_access * evq ) { struct motion_state * motion = & input -> motion ; struct axis_filter * h = & input -> filter . h ; struct axis_filter * v = & input -> filter . v ; int x , y , dx , dy , dz , dw ; if ( motion -> sync & SYNC_DELTAS ) { dx = h -> inv ?- motion -> dx : motion -> dx ; dy = v -> inv ?- motion -> dy : motion -> dy ; if ( h -> scale ) { dx = scale ( dx , h -> scale , & h -> rmdr ) ; } if ( v -> scale ) { dy = scale ( dy , v -> scale , & v -> rmdr ) ; } if ( dy ) { wsmouse_evq_put ( evq , DELTA_Y_EV ( input ) , dy ) ; } if ( motion -> dz ) { dz = ( input -> flags & REVERSE_SCROLLING ) ?- motion -> dz : motion -> dz ; if ( IS_TOUCHPAD ( input ) ) { wsmouse_evq_put ( evq , VSCROLL_EV , dz ) ; } else { wsmouse_evq_put ( evq , DELTA_Z_EV , dz ) ; } } if ( motion -> dw ) { dw = ( input -> flags & REVERSE_SCROLLING ) ?- motion -> dw : motion -> dw ; if ( IS_TOUCHPAD ( input ) ) { wsmouse_evq_put ( evq , HSCROLL_EV , dw ) ; } else { wsmouse_evq_put ( evq , DELTA_W_EV , dw ) ; } } } if ( motion -> sync & SYNC_POSITION ) { if ( motion -> sync & SYNC_X ) { x = ( h -> inv ?h -> inv - motion -> pos . x : motion -> pos . x ) ; wsmouse_evq_put ( evq , ABS_X_EV ( input ) , x ) ; } if ( motion -> sync & SYNC_Y ) { y = ( v -> inv ?v -> inv - motion -> pos . y : motion -> pos . y ) ; wsmouse_evq_put ( evq , ABS_Y_EV ( input ) , y ) ; } if ( motion -> pos . dx == 0 && motion -> pos . dy == 0 && ( input -> flags & TPAD_NATIVE_MODE ) ) { wsmouse_evq_put ( evq , WSCONS_EVENT_TOUCH_RESET , 0 ) ; } } } 