static void tavor_check_iommu_bypass ( tavor_state_t * state , tavor_cfg_profile_t * cp ) { ddi_dma_handle_t dmahdl ; ddi_dma_attr_t dma_attr ; int status ; dma_attr . dma_attr_flags = DDI_DMA_FORCE_PHYSICAL ; status = ddi_dma_alloc_handle ( state -> ts_dip , & dma_attr , DDI_DMA_SLEEP , NULL , & dmahdl ) ; if ( status == DDI_DMA_BADATTR ) { cp -> cp_iommu_bypass = TAVOR_BINDMEM_NORMAL ; cp -> cp_disable_streaming_on_bypass = 0 ; } else { cp -> cp_iommu_bypass = TAVOR_BINDMEM_BYPASS ; cp -> cp_disable_streaming_on_bypass = tavor_disable_streaming_on_bypass ; if ( status == DDI_SUCCESS ) { ddi_dma_free_handle ( & dmahdl ) ; } } } 