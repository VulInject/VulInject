DEFUN ( , , "delay (0-16777215) [min (0-16777215) max (0-16777215)]" , "Unidirectional Average Link Delay\n" "Average delay in micro-second as decimal (0...16777215)\n" "Minimum delay\n" "Minimum delay in micro-second as decimal (0...16777215)\n" "Maximum delay\n" "Maximum delay in micro-second as decimal (0...16777215)\n" ) { uint32_t delay = 0 , low = 0 , high = 0 ; delay = strtoul ( argv [ 1 ] -> arg , NULL , 10 ) ; if ( argc == 6 ) { low = strtoul ( argv [ 3 ] -> arg , NULL , 10 ) ; high = strtoul ( argv [ 5 ] -> arg , NULL , 10 ) ; } struct if_link_params * iflp = if_link_params_get ( ifp ) ; uint8_t update = 0 ; if ( argc == 2 ) { if ( iflp && IS_PARAM_SET ( iflp , LP_MM_DELAY ) && ( delay ( iflp -> min_delay || delay ) iflp -> max_delay ) ) { vty_out ( vty , "Average delay should be in range Min (%d) - Max (%d) delay\n" , iflp -> min_delay , iflp -> max_delay ) ; return CMD_WARNING_CONFIG_FAILED ; } if ( ! iflp ) { iflp = if_link_params_enable ( ifp ) ; } if ( IS_PARAM_UNSET ( iflp , LP_DELAY ) || iflp -> av_delay != delay ) { iflp -> av_delay = delay ; SET_PARAM ( iflp , LP_DELAY ) ; update = 1 ; } if ( IS_PARAM_SET ( iflp , LP_MM_DELAY ) ) { iflp -> min_delay = 0 ; iflp -> max_delay = 0 ; UNSET_PARAM ( iflp , LP_MM_DELAY ) ; update = 1 ; } } else { if ( delay ( low || delay ) high ) { vty_out ( vty , "Average delay should be in range Min (%d) - Max (%d) delay\n" , low , high ) ; return CMD_WARNING_CONFIG_FAILED ; } if ( ! iflp ) { iflp = if_link_params_enable ( ifp ) ; } if ( IS_PARAM_UNSET ( iflp , LP_DELAY ) || IS_PARAM_UNSET ( iflp , LP_MM_DELAY ) || iflp -> av_delay != delay || iflp -> min_delay != low || iflp -> max_delay != high ) { iflp -> av_delay = delay ; SET_PARAM ( iflp , LP_DELAY ) ; iflp -> min_delay = low ; iflp -> max_delay = high ; SET_PARAM ( iflp , LP_MM_DELAY ) ; update = 1 ; } } if ( update == 1 && if_is_operative ( ifp ) ) { zebra_interface_parameters_update ( ifp ) ; } return CMD_SUCCESS ; } 