static void wait_running ( const struct varnish * v ) { char * r = NULL ; enum VCLI_status_e st ; while ( 1 ) { vtc_log ( v -> vl , 3 , "wait-running" ) ; st = varnish_ask_cli ( v , "status" , & r ) ; if ( st != CLIS_OK ) { vtc_fatal ( v -> vl , "CLI status command failed: %u %s" , st , r ) ; } if ( ! strcmp ( r , "Child in state stopped" ) ) { vtc_fatal ( v -> vl , "Child stopped before running: %u %s" , st , r ) ; } if ( ! strcmp ( r , "Child in state running" ) ) { r = NULL ; st = varnish_ask_cli ( v , "debug.listen_address" , & r ) ; if ( st != CLIS_OK ) { vtc_fatal ( v -> vl , "CLI status command failed: %u %s" , st , r ) ; } free ( r ) ; break ; } free ( r ) ; r = NULL ; ( void ) usleep ( 200000 ) ; } } 