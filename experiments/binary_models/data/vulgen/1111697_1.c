static __init void map_gru_high ( int max_pnode ) { union uvh_rh_gam_gru_overlay_config_u gru ; unsigned long mask , base ; int shift ; if ( UVH_RH_GAM_GRU_OVERLAY_CONFIG ) { gru . v = uv_read_local_mmr ( UVH_RH_GAM_GRU_OVERLAY_CONFIG ) ; shift = UVH_RH_GAM_GRU_OVERLAY_CONFIG_BASE_SHFT ; mask = UVH_RH_GAM_GRU_OVERLAY_CONFIG_BASE_MASK ; } if ( UVH_RH10_GAM_GRU_OVERLAY_CONFIG ) { gru . v = uv_read_local_mmr ( UVH_RH10_GAM_GRU_OVERLAY_CONFIG ) ; shift = UVH_RH10_GAM_GRU_OVERLAY_CONFIG_BASE_SHFT ; mask = UVH_RH10_GAM_GRU_OVERLAY_CONFIG_BASE_MASK ; } else { pr_err ( "UV: GRU unavailable (no MMR)\n" ) ; return ; } base = ( gru . v & mask ) >> shift ; map_high ( "GRU" , base , shift , shift , max_pnode , map_wb ) ; gru_start_paddr = ( ( u64 ) base << shift ) ; gru_end_paddr = gru_start_paddr + ( 1UL << shift ) * ( max_pnode + 1 ) ; } 