static struct tty_driver * get_tty_driver ( dev_t device , int * index ) { struct tty_driver * p ; list_for_each_entry ( , , ) { dev_t base = MKDEV ( p -> major , p -> minor_start ) ; * index = device - base ; return tty_driver_kref_get ( p ) ; } return NULL ; } 