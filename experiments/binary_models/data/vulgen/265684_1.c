server_selection_error_dns ( , , , ) { mongoc_uri_t * uri ; mongoc_client_pool_t * pool = NULL ; mongoc_client_t * client ; mongoc_collection_t * collection ; bson_error_t error ; bson_t * command ; bson_t reply ; bool success ; uri = mongoc_uri_new ( uri_str ) ; ASSERT ( uri ) ; if ( pooled ) { mongoc_uri_set_option_as_int32 ( uri , "serverSelectionTimeoutMS" , 100 ) ; pool = test_framework_client_pool_new_from_uri ( uri , NULL ) ; test_framework_set_pool_ssl_opts ( pool ) ; _mongoc_client_pool_set_stream_initiator ( pool , cannot_resolve , NULL ) ; client = mongoc_client_pool_pop ( pool ) ; } else { client = test_framework_client_new_from_uri ( uri , NULL ) ; test_framework_set_ssl_opts ( client ) ; if ( ! expect_success ) { mongoc_client_set_stream_initiator ( client , cannot_resolve , NULL ) ; } } collection = mongoc_client_get_collection ( client , "test" , "test" ) ; command = tmp_bson ( "{'ping': 1}" ) ; success = mongoc_collection_command_simple ( collection , command , NULL , & reply , & error ) ; ASSERT_OR_PRINT ( success == expect_success , error ) ; if ( ! success && errmsg ) { ASSERT_CMPSTR ( error . message , errmsg ) ; } bson_destroy ( & reply ) ; mongoc_collection_destroy ( collection ) ; if ( pooled ) { mongoc_client_pool_push ( pool , client ) ; mongoc_client_pool_destroy ( pool ) ; } else { mongoc_client_destroy ( client ) ; } mongoc_uri_destroy ( uri ) ; } 