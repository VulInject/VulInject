static int gf2m_Mxy ( const mp_int * x , const mp_int * y , mp_int * x1 , mp_int * z1 , mp_int * x2 , mp_int * z2 , const ECGroup * group ) { mp_err res = MP_OKAY ; int ret = 0 ; mp_int t3 , t4 , t5 ; MP_DIGITS ( & t3 ) = 0 ; MP_DIGITS ( & t4 ) = 0 ; MP_DIGITS ( & t5 ) = 0 ; MP_CHECKOK ( mp_init ( & t3 , FLAG ( x2 ) ) ) ; MP_CHECKOK ( mp_init ( & t4 , FLAG ( x2 ) ) ) ; MP_CHECKOK ( mp_init ( & t5 , FLAG ( x2 ) ) ) ; if ( mp_cmp_z ( z1 ) == 0 ) { mp_zero ( x2 ) ; mp_zero ( z2 ) ; ret = 1 ; CLEANUP } if ( mp_cmp_z ( z2 ) == 0 ) { MP_CHECKOK ( mp_copy ( x , x2 ) ) ; MP_CHECKOK ( group -> meth -> field_add ( x , y , z2 , group -> meth ) ) ; ret = 2 ; CLEANUP } MP_CHECKOK ( mp_set_int ( & t5 , 1 ) ) ; MP_CHECKOK ( group -> meth -> field_mul ( z1 , z2 , & t3 , group -> meth ) ) ; MP_CHECKOK ( group -> meth -> field_mul ( z1 , x , z1 , group -> meth ) ) ; MP_CHECKOK ( group -> meth -> field_add ( z1 , x1 , z1 , group -> meth ) ) ; MP_CHECKOK ( group -> meth -> field_mul ( z2 , x , z2 , group -> meth ) ) ; MP_CHECKOK ( group -> meth -> field_mul ( z2 , x1 , x1 , group -> meth ) ) ; MP_CHECKOK ( group -> meth -> field_add ( z2 , x2 , z2 , group -> meth ) ) ; MP_CHECKOK ( group -> meth -> field_mul ( z2 , z1 , z2 , group -> meth ) ) ; MP_CHECKOK ( group -> meth -> field_sqr ( x , & t4 , group -> meth ) ) ; MP_CHECKOK ( group -> meth -> field_add ( & t4 , y , & t4 , group -> meth ) ) ; MP_CHECKOK ( group -> meth -> field_mul ( & t4 , & t3 , & t4 , group -> meth ) ) ; MP_CHECKOK ( group -> meth -> field_add ( & t4 , z2 , & t4 , group -> meth ) ) ; MP_CHECKOK ( group -> meth -> field_mul ( & t3 , x , & t3 , group -> meth ) ) ; MP_CHECKOK ( group -> meth -> field_div ( & t5 , & t3 , & t3 , group -> meth ) ) ; MP_CHECKOK ( group -> meth -> field_mul ( & t3 , & t4 , & t4 , group -> meth ) ) ; MP_CHECKOK ( group -> meth -> field_mul ( x1 , & t3 , x2 , group -> meth ) ) ; MP_CHECKOK ( group -> meth -> field_add ( x2 , x , z2 , group -> meth ) ) ; MP_CHECKOK ( group -> meth -> field_mul ( z2 , & t4 , z2 , group -> meth ) ) ; MP_CHECKOK ( group -> meth -> field_add ( z2 , y , z2 , group -> meth ) ) ; ret = 2 ; CLEANUP mp_clear ( & t3 ) ; mp_clear ( & t4 ) ; mp_clear ( & t5 ) ; if ( res == MP_OKAY ) { return ret ; } else { return 0 ; } } 