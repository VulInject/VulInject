void seekdir64 ( DIR * dirp , off64_t loc ) { private_DIR * pdirp = ( private_DIR * ) ( uintptr_t ) dirp ; dirent64_t * dp64 ; off64_t off = 0 ; lmutex_lock ( & pdirp -> dd_lock ) ; if ( lseek64 ( dirp -> dd_fd , 0 , SEEK_CUR ) != 0 ) { dp64 = ( dirent64_t * ) ( uintptr_t ) & dirp -> dd_buf [ dirp -> dd_loc ] ; if ( dp64 -> d_ino == ( ino64_t ) - 1 ) { dirent_t * dp32 ; dp32 = ( dirent_t * ) ( ( uintptr_t ) dp64 + sizeof ( ino64_t ) ) ; dp64 -> d_ino = ( ino64_t ) dp32 -> d_ino ; dp64 -> d_off = ( off64_t ) dp32 -> d_off ; } off = dp64 -> d_off ; } if ( off != loc ) { dirp -> dd_loc = 0 ; ( void ) lseek64 ( dirp -> dd_fd , loc , SEEK_SET ) ; dirp -> dd_size = 0 ; ( ( dirent64_t * ) ( uintptr_t ) & dirp -> dd_buf [ 0 ] ) -> d_off = loc ; } lmutex_unlock ( & pdirp -> dd_lock ) ; } 