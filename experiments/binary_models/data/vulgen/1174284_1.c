static void rdpsnd_winmm_close ( rdpsndDevicePlugin * device ) { MMRESULT mmResult ; rdpsndWinmmPlugin * winmm = ( rdpsndWinmmPlugin * ) device ; if ( winmm -> hWaveOut ) { EnterCriticalSection ( & winmm -> cs ) ; mmResult = waveOutReset ( winmm -> hWaveOut ) ; if ( mmResult != MMSYSERR_NOERROR ) { WLog_Print ( winmm -> log , WLOG_ERROR , "waveOutReset failure: %" PRIu32 "" , mmResult ) ; } mmResult = waveOutClose ( winmm -> hWaveOut ) ; LeaveCriticalSection ( & winmm -> cs ) ; winmm -> hWaveOut = NULL ; } if ( winmm -> hThread ) { WaitForSingleObject ( winmm -> hThread , INFINITE ) ; CloseHandle ( winmm -> hThread ) ; winmm -> hThread = NULL ; } } 