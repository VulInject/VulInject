static void ppp_sync_input ( struct syncppp * ap , const unsigned char * buf , const char * flags , int count ) { struct sk_buff * skb ; unsigned char * p ; if ( count == 0 ) { return ; } if ( ap -> flags & SC_LOG_INPKT ) { ppp_print_buffer ( "receive buffer" , buf , count ) ; } skb = dev_alloc_skb ( ap -> mru + PPP_HDRLEN + 2 ) ; if ( ! skb ) { printk ( KERN_ERR "PPPsync: no memory (input pkt)\n" ) ; err } if ( buf [ 0 ] != PPP_ALLSTATIONS ) { skb_reserve ( skb , 2 + ( buf [ 0 ] & 1 ) ) ; } if ( flags && * flags ) { err } if ( count > skb_tailroom ( skb ) ) { err } skb_put_data ( skb , buf , count ) ; p = skb -> data ; if ( p [ 0 ] == PPP_ALLSTATIONS && p [ 1 ] == PPP_UI ) { if ( skb -> len < 3 ) { err } p = skb_pull ( skb , 2 ) ; } if ( ! ( p [ 0 ] & 0x01 ) && skb -> len < 2 ) { err } skb_queue_tail ( & ap -> rqueue , skb ) ; return ; err if ( skb || ( skb = dev_alloc_skb ( 0 ) ) ) { skb_queue_tail ( & ap -> rqueue , skb ) ; } } 