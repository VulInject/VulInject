gimp_scrolled_preview_init ( ) { GimpScrolledPreviewPrivate * priv = GET_PRIVATE ( preview ) ; GtkWidget * image ; GtkWidget * grid ; GtkWidget * area ; GtkGesture * gesture ; GtkAdjustment * adj ; gint width ; gint height ; priv -> nav_popup = NULL ; priv -> hscr_policy = GTK_POLICY_AUTOMATIC ; priv -> vscr_policy = GTK_POLICY_AUTOMATIC ; priv -> in_drag = FALSE ; priv -> frozen = 1 ; grid = gimp_preview_get_grid ( GIMP_PREVIEW ( preview ) ) ; gimp_preview_get_size ( GIMP_PREVIEW ( preview ) , & width , & height ) ; adj = gtk_adjustment_new ( 0 , 0 , width - 1 , 1.0 , width , width ) ; g_signal_connect ( adj , "value-changed" , G_CALLBACK ( gimp_scrolled_preview_h_scroll ) , preview ) ; priv -> hscr = gtk_scrollbar_new ( GTK_ORIENTATION_HORIZONTAL , adj ) ; gtk_widget_set_hexpand ( priv -> hscr , TRUE ) ; gtk_grid_attach ( GTK_GRID ( grid ) , priv -> hscr , 0 , 1 , 1 , 1 ) ; adj = gtk_adjustment_new ( 0 , 0 , height - 1 , 1.0 , height , height ) ; g_signal_connect ( adj , "value-changed" , G_CALLBACK ( gimp_scrolled_preview_v_scroll ) , preview ) ; priv -> vscr = gtk_scrollbar_new ( GTK_ORIENTATION_VERTICAL , adj ) ; gtk_widget_set_vexpand ( priv -> vscr , TRUE ) ; gtk_grid_attach ( GTK_GRID ( grid ) , priv -> vscr , 1 , 0 , 1 , 1 ) ; area = gimp_preview_get_area ( GIMP_PREVIEW ( preview ) ) ; g_signal_connect_after ( area , "event" , G_CALLBACK ( gimp_scrolled_preview_area_event ) , preview ) ; gesture = gtk_gesture_drag_new ( GTK_WIDGET ( preview ) ) ; g_signal_connect ( gesture , "drag-begin" , G_CALLBACK ( gimp_scrolled_preview_drag_begin ) , preview ) ; g_signal_connect ( gesture , "drag-update" , G_CALLBACK ( gimp_scrolled_preview_drag_update ) , preview ) ; g_signal_connect ( gesture , "drag-end" , G_CALLBACK ( gimp_scrolled_preview_drag_end ) , preview ) ; g_signal_connect ( gesture , "cancel" , G_CALLBACK ( gimp_scrolled_preview_drag_cancel ) , preview ) ; g_signal_connect ( area , "realize" , G_CALLBACK ( gimp_scrolled_preview_area_realize ) , preview ) ; g_signal_connect ( area , "unrealize" , G_CALLBACK ( gimp_scrolled_preview_area_unrealize ) , preview ) ; g_signal_connect ( area , "size-allocate" , G_CALLBACK ( gimp_scrolled_preview_area_size_allocate ) , preview ) ; priv -> nav_icon = gtk_event_box_new ( ) ; gtk_grid_attach ( GTK_GRID ( grid ) , priv -> nav_icon , 1 , 1 , 1 , 1 ) ; image = gtk_image_new_from_icon_name ( GIMP_ICON_DIALOG_NAVIGATION , GTK_ICON_SIZE_MENU ) ; gtk_container_add ( GTK_CONTAINER ( priv -> nav_icon ) , image ) ; gtk_widget_show ( image ) ; priv -> frozen = 0 ; } 