if_ioctl ( , ) { int sock ; int ret ; int err = 0 ; if ( zserv_privs . change ( ZPRIVS_RAISE ) ) { zlog ( NULL , LOG_ERR , "Can't raise privileges" ) ; } if ( sock < 0 ) { int save_errno = errno ; if ( zserv_privs . change ( ZPRIVS_LOWER ) ) { zlog ( NULL , LOG_ERR , "Can't lower privileges" ) ; } zlog_err ( "Cannot create UDP socket: %s" , safe_strerror ( save_errno ) ) ; exit ( 1 ) ; } if ( ( ret = ioctl ( sock , request , buffer ) ) < 0 ) { err = errno ; } if ( zserv_privs . change ( ZPRIVS_LOWER ) ) { zlog ( NULL , LOG_ERR , "Can't lower privileges" ) ; } close ( sock ) ; if ( ret < 0 ) { errno = err ; return ret ; } return 0 ; } 