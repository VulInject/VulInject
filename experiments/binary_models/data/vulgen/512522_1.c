void show_distance_from_ruler ( XEvent * event , Boolean to_stdout ) { int loc_x , loc_y ; int precision = 2 ; double factor ; loc_x = event -> xbutton . x ; loc_y = event -> xbutton . y ; if ( event -> xbutton . window != mane . win ) { Window ww ; ( void ) XTranslateCoordinates ( DISP , RootWindowOfScreen ( SCRN ) , mane . win , event -> xbutton . x_root , event -> xbutton . y_root , & loc_x , & loc_y , & ww ) ; } if ( loc_x < 0 ) { loc_x = 0 ; } if ( loc_y < 0 ) { loc_y = 0 ; } if ( strcmp ( resource . tick_units , "pt" ) == 0 ) { factor = 72.27 * currwin . shrinkfactor / ( double ) resource . pixels_per_inch ; } if ( strcmp ( resource . tick_units , "bp" ) == 0 ) { factor = 72.0 * currwin . shrinkfactor / ( double ) resource . pixels_per_inch ; } if ( strcmp ( resource . tick_units , "in" ) == 0 ) { factor = currwin . shrinkfactor / ( double ) resource . pixels_per_inch ; } if ( strcmp ( resource . tick_units , "cm" ) == 0 ) { factor = 2.54 * currwin . shrinkfactor / ( double ) resource . pixels_per_inch ; precision = 3 ; } if ( strcmp ( resource . tick_units , "mm" ) == 0 ) { factor = 25.4 * currwin . shrinkfactor / ( double ) resource . pixels_per_inch ; } if ( strcmp ( resource . tick_units , "dd" ) == 0 ) { factor = 72.27 / ( 1238.0 / 1157.0 ) * currwin . shrinkfactor / ( double ) resource . pixels_per_inch ; } if ( strcmp ( resource . tick_units , "cc" ) == 0 ) { factor = 72.27 / ( 12.0 * ( 1238.0 / 1157.0 ) ) * currwin . shrinkfactor / ( double ) resource . pixels_per_inch ; } if ( strcmp ( resource . tick_units , "pc" ) == 0 ) { factor = 72.27 / 12.0 * currwin . shrinkfactor / ( double ) resource . pixels_per_inch ; } if ( strcmp ( resource . tick_units , "sp" ) == 0 ) { factor = 65536.0 * 72.27 * currwin . shrinkfactor / ( double ) resource . pixels_per_inch ; precision = 1 ; } if ( strcmp ( resource . tick_units , "px" ) == 0 ) { factor = 1 ; } else { XDVI_WARNING ( ( stderr , "Unrecognized tickUnits [%s]: defaulting to TeX points [pt]" , resource . tick_units ) ) ; resource . tick_units = "pt" ; factor = 72.27 * currwin . shrinkfactor / ( double ) resource . pixels_per_inch ; } if ( mouse_release != null_mouse ) { if ( to_stdout ) { XDVI_INFO ( ( stdout , "Ruler/Point: %d,%d, dx: %.*f %s, dy: %.*f %s, dr: %.*f %s" , loc_x , loc_y , precision , 0.000 , resource . tick_units , precision , 0.000 , resource . tick_units , precision , 0.000 , resource . tick_units ) ) ; } else { statusline_info ( STATUS_FOREVER , "Ruler/Point: %d,%d, dx: %.*f %s, dy: %.*f %s, dt: %.*f %s" , loc_x , loc_y , precision , 0.000 , resource . tick_units , precision , 0.000 , resource . tick_units , precision , 0.000 , resource . tick_units ) ; } } else { int d_x = loc_x - g_ruler_pos_x ; int d_y = loc_y - g_ruler_pos_y ; double d_z = sqrt ( ( double ) d_x * d_x + ( double ) d_y * d_y ) ; double unit_x = ( double ) d_x * factor ; double unit_y = ( double ) d_y * factor ; double unit_z = d_z * factor ; if ( to_stdout ) { XDVI_INFO ( ( stdout , "Ruler: %d,%d, Point: %d,%d, dx: %.*f %s, dy: %.*f %s, dr: %.*f %s" , g_ruler_pos_x , g_ruler_pos_y , loc_x , loc_y , precision , unit_x , resource . tick_units , precision , unit_y , resource . tick_units , precision , unit_z , resource . tick_units ) ) ; } else { statusline_info ( STATUS_FOREVER , "Ruler: %d,%d, Point: %d,%d, dx: %.*f %s, dy: %.*f %s, dr: %.*f %s" , g_ruler_pos_x , g_ruler_pos_y , loc_x , loc_y , precision , unit_x , resource . tick_units , precision , unit_y , resource . tick_units , precision , unit_z , resource . tick_units ) ; } } } 