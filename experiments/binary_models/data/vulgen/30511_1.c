static void paint_mouse_pointer ( AVFormatContext * s1 , struct gdigrab * gdigrab ) { CURSORINFO ci = { 0 } ; if ( ! gdigrab -> cursor_error_printed ) { WIN32_API_ERROR ( str ) ; gdigrab -> cursor_error_printed = 1 ; } ci . cbSize = sizeof ( ci ) ; if ( GetCursorInfo ( & ci ) ) { HCURSOR icon = CopyCursor ( ci . hCursor ) ; ICONINFO info ; POINT pos ; RECT clip_rect = gdigrab -> clip_rect ; HWND hwnd = gdigrab -> hwnd ; int horzres = GetDeviceCaps ( gdigrab -> source_hdc , HORZRES ) ; int vertres = GetDeviceCaps ( gdigrab -> source_hdc , VERTRES ) ; int desktophorzres = GetDeviceCaps ( gdigrab -> source_hdc , DESKTOPHORZRES ) ; int desktopvertres = GetDeviceCaps ( gdigrab -> source_hdc , DESKTOPVERTRES ) ; info . hbmMask = NULL ; info . hbmColor = NULL ; if ( ! icon ) { icon = CopyCursor ( LoadCursor ( NULL , IDC_ARROW ) ) ; } if ( ! GetIconInfo ( icon , & info ) ) { CURSOR_ERROR ( "Could not get icon info" ) ; icon_error } if ( hwnd ) { RECT rect ; if ( GetWindowRect ( hwnd , & rect ) ) { pos . x = ci . ptScreenPos . x - clip_rect . left - info . xHotspot - rect . left ; pos . y = ci . ptScreenPos . y - clip_rect . top - info . yHotspot - rect . top ; pos . x = pos . x * desktophorzres / horzres ; pos . y = pos . y * desktopvertres / vertres ; } else { CURSOR_ERROR ( "Couldn't get window rectangle" ) ; icon_error } } else { pos . x = ci . ptScreenPos . x * desktophorzres / horzres - clip_rect . left - info . xHotspot ; pos . y = ci . ptScreenPos . y * desktopvertres / vertres - clip_rect . top - info . yHotspot ; } av_log ( s1 , AV_LOG_DEBUG , "Cursor pos (%li,%li) ->(%li,%li)\n" , ci . ptScreenPos . x , ci . ptScreenPos . y , pos . x , pos . y ) ; if ( pos . x >= 0 && pos . x <= clip_rect . right - clip_rect . left && pos . y >= 0 && pos . y <= clip_rect . bottom - clip_rect . top ) { if ( ! DrawIcon ( gdigrab -> dest_hdc , pos . x , pos . y , icon ) ) { CURSOR_ERROR ( "Couldn't draw icon" ) ; } } icon_error if ( info . hbmMask ) { DeleteObject ( info . hbmMask ) ; } if ( info . hbmColor ) { DeleteObject ( info . hbmColor ) ; } if ( icon ) { DestroyCursor ( icon ) ; } } else { CURSOR_ERROR ( "Couldn't get cursor info" ) ; } } 