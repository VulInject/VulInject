( false ) ; = mm -> apple ?mm -> normal : mm -> instances [ 0 ] ; if ( ! mm -> apple && PSDictHasEntry ( sf -> private , "ForceBold" ) != NULL && PSDictHasEntry ( mm -> normal -> private , "ForceBoldThreshold" ) == NULL ) { if ( complain ) { ff_post_error ( _ ( "Bad Multiple Master Font" ) , _ ( "There is no ForceBoldThreshold entry in the weighted font, but there is a ForceBold entry in font %30s" ) , sf -> fontname ) ; } return ( false ) ; } for ( j = mm -> apple ?0 : 1 ; j < mm -> instance_count ; ++ j ) { if ( sf -> glyphcnt != mm -> instances [ j ] -> glyphcnt ) { if ( complain ) { ff_post_error ( _ ( "Bad Multiple Master Font" ) , _ ( "The fonts %1$.30s and %2$.30s have a different number of glyphs or different encodings" ) , sf -> fontname , mm -> instances [ j ] -> fontname ) ; } return ( false ) ; } if ( sf -> layers [ ly_fore ] . order2 != mm -> instances [ j ] -> layers [ ly_fore ] . order2 ) { if ( complain ) { ff_post_error ( _ ( "Bad Multiple Master Font" ) , _ ( "The fonts %1$.30s and %2$.30s use different types of splines (one quadratic, one cubic)" ) , sf -> fontname , mm -> instances [ j ] -> fontname ) ; } return ( false ) ; } if ( ! mm -> apple ) { if ( PSDictHasEntry ( mm -> instances [ j ] -> private , "ForceBold" ) != NULL && PSDictHasEntry ( mm -> normal -> private , "ForceBoldThreshold" ) == NULL ) { if ( complain ) { ff_post_error ( _ ( "Bad Multiple Master Font" ) , _ ( "There is no ForceBoldThreshold entry in the weighted font, but there is a ForceBold entry in font %30s" ) , mm -> instances [ j ] -> fontname ) ; } return ( false ) ; } for ( i = 0 ; arrnames [ i ] != NULL ; ++ i ) { if ( ArrayCount ( PSDictHasEntry ( mm -> instances [ j ] -> private , arrnames [ i ] ) ) != ArrayCount ( PSDictHasEntry ( sf -> private , arrnames [ i ] ) ) ) { if ( complain ) { ff_post_error ( _ ( "Bad Multiple Master Font" ) , _ ( "The entry \"%1$.20s\" is not present in the private dictionary of both %2$.30s and %3$.30s" ) , arrnames [ i ] , sf -> fontname , mm -> instances [ j ] -> fontname ) ; } return ( false ) ; } } } } for ( i = 0 ; i < sf -> glyphcnt ; ++ i ) { for ( j = mm -> apple ?0 : 1 ; j < mm -> instance_count ; ++ j ) { if ( SCWorthOutputting ( sf -> glyphs [ i ] ) != SCWorthOutputting ( mm -> instances [ j ] -> glyphs [ i ] ) ) { if ( complain ) { FVChangeGID ( sf -> fv , i ) ; if ( SCWorthOutputting ( sf -> glyphs [ i ] ) ) { ff_post_error ( _ ( "Bad Multiple Master Font" ) , _ ( "The glyph %1$.30s is defined in font %2$.30s but not in %3$.30s" ) , sf -> glyphs [ i ] -> name , sf -> fontname , mm -> instances [ j ] -> fontname ) ; } else { ff_post_error ( _ ( "Bad Multiple Master Font" ) , _ ( "The glyph %1$.30s is defined in font %2$.30s but not in %3$.30s" ) , mm -> instances [ j ] -> glyphs [ i ] -> name , mm -> instances [ j ] -> fontname , sf -> fontname ) ; } } return ( false ) ; } } if ( SCWorthOutputting ( sf -> glyphs [ i ] ) ) { if ( mm -> apple && sf -> glyphs [ i ] -> layers [ ly_fore ] . refs != NULL && sf -> glyphs [ i ] -> layers [ ly_fore ] . splines != NULL ) { if ( complain ) { FVChangeGID ( sf -> fv , i ) ; ff_post_error ( _ ( "Bad Multiple Master Font" ) , _ ( "The glyph %1$.30s in %2$.30s has both references and contours. This is not supported in a font with variations" ) , sf -> glyphs [ i ] -> name , sf -> fontname ) ; } return ( false ) ; } for ( j = mm -> apple ?0 : 1 ; j < mm -> instance_count ; ++ j ) { if ( mm -> apple && mm -> instances [ j ] -> glyphs [ i ] -> layers [ ly_fore ] . refs != NULL && mm -> instances [ j ] -> glyphs [ i ] -> layers [ ly_fore ] . splines != NULL ) { if ( complain ) { FVChangeGID ( sf -> fv , i ) ; ff_post_error ( _ ( "Bad Multiple Master Font" ) , _ ( "The glyph %1$.30s in %2$.30s has both references and contours. This is not supported in a font with variations" ) , sf -> glyphs [ i ] -> name , mm -> instances [ j ] -> fontname ) ; } return ( false ) ; } if ( ContourCount ( sf -> glyphs [ i ] ) != ContourCount ( mm -> instances [ j ] -> glyphs [ i ] ) ) { if ( complain ) { FVChangeGID ( sf -> fv , i ) ; ff_post_error ( _ ( "Bad Multiple Master Font" ) , _ ( "The glyph %1$.30s has a different number of contours in font %2$.30s than in %3$.30s" ) , sf -> glyphs [ i ] -> name , sf -> fontname , mm -> instances [ j ] -> fontname ) ; } return ( false ) ; } if ( ! mm -> apple && ! ContourPtMatch ( sf -> glyphs [ i ] , mm -> instances [ j ] -> glyphs [ i ] ) ) { if ( complain ) { FVChangeGID ( sf -> fv , i ) ; ff_post_error ( _ ( "Bad Multiple Master Font" ) , _ ( "The glyph %1$.30s in font %2$.30s has a different number of points (or control points) on its contours than in %3$.30s" ) , sf -> glyphs [ i ] -> name , sf -> fontname , mm -> instances [ j ] -> fontname ) ; } return ( false ) ; } if ( ! ContourDirMatch ( sf -> glyphs [ i ] , mm -> instances [ j ] -> glyphs [ i ] ) ) { if ( complain ) { FVChangeGID ( sf -> fv , i ) ; ff_post_error ( _ ( "Bad Multiple Master Font" ) , _ ( "The glyph %1$.30s in font %2$.30s has contours running in a different direction than in %3$.30s" ) , sf -> glyphs [ i ] -> name , sf -> fontname , mm -> instances [ j ] -> fontname ) ; } return ( false ) ; } if ( ! RefMatch ( sf -> glyphs [ i ] , mm -> instances [ j ] -> glyphs [ i ] ) ) { if ( complain ) { FVChangeGID ( sf -> fv , i ) ; ff_post_error ( _ ( "Bad Multiple Master Font" ) , _ ( "The glyph %1$.30s in font %2$.30s has a different number of references than in %3$.30s" ) , sf -> glyphs [ i ] -> name , sf -> fontname , mm -> instances [ j ] -> fontname ) ; } return ( false ) ; } if ( mm -> apple && ! RefTransformsMatch ( sf -> glyphs [ i ] , mm -> instances [ j ] -> glyphs [ i ] ) ) { if ( complain ) { FVChangeGID ( sf -> fv , i ) ; ff_post_error ( _ ( "Bad Multiple Master Font" ) , _ ( "The glyph %1$.30s in font %2$.30s has references with different scaling or rotation (etc.) than in %3$.30s" ) , sf -> glyphs [ i ] -> name , sf -> fontname , mm -> instances [ j ] -> fontname ) ; } return ( false ) ; } if ( ! mm -> apple && ! KernsMatch ( sf -> glyphs [ i ] , mm -> instances [ j ] -> glyphs [ i ] ) ) { if ( complain ) { FVChangeGID ( sf -> fv , i ) ; ff_post_error ( _ ( "Bad Multiple Master Font" ) , _ ( "The glyph %1$.30s in font %2$.30s has a different set of kern pairs than in %3$.30s" ) , "vertical" , sf -> glyphs [ i ] -> name , sf -> fontname , mm -> instances [ j ] -> fontname ) ; } return ( false ) ; } } if ( mm -> apple && ! ContourPtNumMatch ( mm , i ) ) { if ( complain ) { FVChangeGID ( sf -> fv , i ) ; ff_post_error ( _ ( "Bad Multiple Master Font" ) , _ ( "The glyph %1$.30s has a different numbering of points (and control points) on its contours than in the various instances of the font" ) , sf -> glyphs [ i ] -> name ) ; } return ( false ) ; } if ( ! mm -> apple ) { for ( j = 1 ; j < mm -> instance_count ; ++ j ) { if ( ! HintsMatch ( sf -> glyphs [ i ] -> hstem , mm -> instances [ j ] -> glyphs [ i ] -> hstem ) ) { if ( complain ) { FVChangeGID ( sf -> fv , i ) ; ff_post_error ( _ ( "Bad Multiple Master Font" ) , _ ( "The %1$s hints in glyph \"%2$.30s\" in font %3$.30s do not match those in %4$.30s (different number or different overlap criteria)" ) , "horizontal" , sf -> glyphs [ i ] -> name , sf -> fontname , mm -> instances [ j ] -> fontname ) ; } return ( false ) ; } if ( ! HintsMatch ( sf -> glyphs [ i ] -> vstem , mm -> instances [ j ] -> glyphs [ i ] -> vstem ) ) { if ( complain ) { FVChangeGID ( sf -> fv , i ) ; ff_post_error ( _ ( "Bad Multiple Master Font" ) , _ ( "The %1$s hints in glyph \"%2$.30s\" in font %3$.30s do not match those in %4$.30s (different number or different overlap criteria)" ) , "vertical" , sf -> glyphs [ i ] -> name , sf -> fontname , mm -> instances [ j ] -> fontname ) ; } return ( false ) ; } } for ( j = 1 ; j < mm -> instance_count ; ++ j ) { if ( ! ContourHintMaskMatch ( sf -> glyphs [ i ] , mm -> instances [ j ] -> glyphs [ i ] ) ) { if ( complain ) { FVChangeGID ( sf -> fv , i ) ; ff_post_error ( _ ( "Bad Multiple Master Font" ) , _ ( "The glyph %1$.30s in font %2$.30s has a different hint mask on its contours than in %3$.30s" ) , sf -> glyphs [ i ] -> name , sf -> fontname , mm -> instances [ j ] -> fontname ) ; } return ( false ) ; } } } } } if ( mm -> apple ) { struct ttf_table * cvt ; for ( cvt = mm -> normal -> ttf_tables ; cvt != NULL && cvt -> tag != CHR ( 'c' , 'v' , 't' , ' ' ) ; cvt = cvt -> next ) { } else { for ( j = 0 ; j < mm -> instance_count ; ++ j ) { if ( mm -> instances [ j ] -> ttf_tables != NULL && ( mm -> instances [ j ] -> ttf_tables -> next != NULL || mm -> instances [ j ] -> ttf_tables -> tag != CHR ( 'c' , 'v' , 't' , ' ' ) ) ) { if ( complain ) { ff_post_error ( _ ( "Bad Multiple Master Font" ) , _ ( "Instance fonts may only contain a 'cvt ' table, but %.30s has some other truetype table as well" ) , mm -> instances [ j ] -> fontname ) ; } return ( false ) ; } if ( mm -> instances [ j ] -> ttf_tables != NULL && mm -> instances [ j ] -> ttf_tables -> len != cvt -> len ) { if ( complain ) { ff_post_error ( _ ( "Bad Multiple Master Font" ) , _ ( "The 'cvt ' table in instance %.30s is a different size from that in the default font" ) , mm -> instances [ j ] -> fontname ) ; } return ( false ) ; } } } } if ( complain ) { ff_post_notice ( _ ( "OK" ) , _ ( "No problems detected" ) ) ; } return ( true ) ; 