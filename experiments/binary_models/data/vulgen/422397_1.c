static int mwifiex_process_rx ( struct mwifiex_adapter * adapter ) { struct sk_buff * skb ; struct mwifiex_rxinfo * rx_info ; spin_lock_bh ( & adapter -> rx_proc_lock ) ; if ( adapter -> rx_processing || adapter -> rx_locked ) { spin_unlock_bh ( & adapter -> rx_proc_lock ) ; exit_rx_proc } else { adapter -> rx_processing = true ; spin_unlock_bh ( & adapter -> rx_proc_lock ) ; } while ( ( skb = skb_dequeue ( & adapter -> rx_data_q ) ) ) { atomic_dec ( & adapter -> rx_pending ) ; if ( ( adapter -> delay_main_work || adapter -> iface_type == MWIFIEX_USB ) && ( atomic_read ( & adapter -> rx_pending ) < LOW_RX_PENDING ) ) { if ( adapter -> if_ops . submit_rem_rx_urbs ) { adapter -> if_ops . submit_rem_rx_urbs ( adapter ) ; } adapter -> delay_main_work = false ; mwifiex_queue_main_work ( adapter ) ; } rx_info = MWIFIEX_SKB_RXCB ( skb ) ; if ( rx_info -> buf_type == MWIFIEX_TYPE_AGGR_DATA ) { if ( adapter -> if_ops . deaggr_pkt ) { adapter -> if_ops . deaggr_pkt ( adapter , skb ) ; } } else { mwifiex_handle_rx_packet ( adapter , skb ) ; } } spin_lock_bh ( & adapter -> rx_proc_lock ) ; adapter -> rx_processing = false ; spin_unlock_bh ( & adapter -> rx_proc_lock ) ; exit_rx_proc return 0 ; } 