static int first_nibble_is_4 ( RArch * anal , RAnalOp * op , ut16 code ) { RArchValue * dst = NULL ; switch ( code & 0xF0FF ) { case 0x4020 : op -> type = R_ANAL_OP_TYPE_SAL ; r_strbuf_setf ( & op -> esil , "0xFFFFFFFE,sr,&=,r%d,0x80000000,&,?{,0x1,sr,|=,},1,r%d,<<=" , GET_TARGET_REG ( code ) , GET_TARGET_REG ( code ) ) ; break ; case 0x4021 : op -> type = R_ANAL_OP_TYPE_SAR ; r_strbuf_setf ( & op -> esil , "0xFFFFFFFE,sr,&=,r%d,0x1,&,?{,0x1,sr,|=,},0,r%d,0x80000000,&,?{,0x80000000,+,},1,r%d,>>=,r%d,|=" , GET_TARGET_REG ( code ) , GET_TARGET_REG ( code ) , GET_TARGET_REG ( code ) , GET_TARGET_REG ( code ) ) ; break ; case 0x4000 : op -> type = R_ANAL_OP_TYPE_SHL ; r_strbuf_setf ( & op -> esil , "0xFFFFFFFE,sr,&=,r%d,0x80000000,&,?{,0x1,sr,|=,},1,r%d,<<=" , GET_TARGET_REG ( code ) , GET_TARGET_REG ( code ) ) ; break ; case 0x4008 : op -> type = R_ANAL_OP_TYPE_SHL ; r_strbuf_setf ( & op -> esil , "2,r%d,<<=" , GET_TARGET_REG ( code ) ) ; break ; case 0x4018 : op -> type = R_ANAL_OP_TYPE_SHL ; r_strbuf_setf ( & op -> esil , "8,r%d,<<=" , GET_TARGET_REG ( code ) ) ; break ; case 0x4028 : op -> type = R_ANAL_OP_TYPE_SHL ; r_strbuf_setf ( & op -> esil , "16,r%d,<<=" , GET_TARGET_REG ( code ) ) ; break ; case 0x4001 : r_strbuf_setf ( & op -> esil , "0xFFFFFFFE,sr,&=,r%d,0x1,&,?{,0x1,sr,|=,},1,r%d,>>=" , GET_TARGET_REG ( code ) , GET_TARGET_REG ( code ) ) ; op -> type = R_ANAL_OP_TYPE_SHR ; break ; case 0x4009 : r_strbuf_setf ( & op -> esil , "2,r%d,>>=" , GET_TARGET_REG ( code ) ) ; op -> type = R_ANAL_OP_TYPE_SHR ; break ; case 0x4019 : r_strbuf_setf ( & op -> esil , "8,r%d,>>=" , GET_TARGET_REG ( code ) ) ; op -> type = R_ANAL_OP_TYPE_SHR ; break ; case 0x4029 : r_strbuf_setf ( & op -> esil , "16,r%d,>>=" , GET_TARGET_REG ( code ) ) ; op -> type = R_ANAL_OP_TYPE_SHR ; break ; default : break ; } if ( IS_JSR ( code ) ) { op -> type = R_ANAL_OP_TYPE_RCALL ; op -> delay = 1 ; dst = anal_fill_ai_rg ( anal , GET_TARGET_REG ( code ) ) ; r_strbuf_setf ( & op -> esil , "1,SETD,pc,2,+,pr,=,r%d,pc,=" , GET_TARGET_REG ( code ) ) ; } if ( IS_JMP ( code ) ) { op -> type = R_ANAL_OP_TYPE_UJMP ; dst = anal_fill_ai_rg ( anal , GET_TARGET_REG ( code ) ) ; op -> delay = 1 ; op -> eob = true ; r_strbuf_setf ( & op -> esil , "1,SETD,r%d,pc,=" , GET_TARGET_REG ( code ) ) ; } if ( IS_CMPPL ( code ) ) { op -> type = R_ANAL_OP_TYPE_CMP ; r_strbuf_setf ( & op -> esil , "0xFFFFFFFE,sr,&=,0,r%d,>,?{,0x1,sr,|=,}" , GET_TARGET_REG ( code ) ) ; } if ( IS_CMPPZ ( code ) ) { op -> type = R_ANAL_OP_TYPE_CMP ; r_strbuf_setf ( & op -> esil , "0xFFFFFFFE,sr,&=,0,r%d,>=,?{,0x1,sr,|=,}" , GET_TARGET_REG ( code ) ) ; } if ( IS_LDCLSR ( code ) ) { op -> type = R_ANAL_OP_TYPE_POP ; r_strbuf_setf ( & op -> esil , "r%d,[4],0x0FFF0FFF,&,sr,=,4,r%d,+=" , GET_TARGET_REG ( code ) , GET_TARGET_REG ( code ) ) ; } if ( IS_LDCLSRGBR ( code ) ) { op -> type = R_ANAL_OP_TYPE_POP ; r_strbuf_setf ( & op -> esil , "r%d,[4],gbr,=,4,r%d,+=" , GET_TARGET_REG ( code ) , GET_TARGET_REG ( code ) ) ; } if ( IS_LDCLSRVBR ( code ) ) { op -> type = R_ANAL_OP_TYPE_POP ; r_strbuf_setf ( & op -> esil , "r%d,[4],vbr,=,4,r%d,+=" , GET_TARGET_REG ( code ) , GET_TARGET_REG ( code ) ) ; } if ( IS_LDSLMACH ( code ) ) { op -> type = R_ANAL_OP_TYPE_POP ; r_strbuf_setf ( & op -> esil , "r%d,[4],mach,=,4,r%d,+=" , GET_TARGET_REG ( code ) , GET_TARGET_REG ( code ) ) ; } if ( IS_LDSLMACL ( code ) ) { op -> type = R_ANAL_OP_TYPE_POP ; r_strbuf_setf ( & op -> esil , "r%d,[4],macl,=,4,r%d,+=" , GET_TARGET_REG ( code ) , GET_TARGET_REG ( code ) ) ; } if ( IS_LDSLPR ( code ) ) { op -> type = R_ANAL_OP_TYPE_POP ; r_strbuf_setf ( & op -> esil , "r%d,[4],pr,=,4,r%d,+=" , GET_TARGET_REG ( code ) , GET_TARGET_REG ( code ) ) ; } if ( IS_LDCSR ( code ) ) { r_strbuf_setf ( & op -> esil , "r%d,0x0FFF0FFF,&,sr,=" , GET_TARGET_REG ( code ) ) ; op -> type = R_ANAL_OP_TYPE_MOV ; } if ( IS_LDCGBR ( code ) ) { r_strbuf_setf ( & op -> esil , "r%d,gbr,=" , GET_TARGET_REG ( code ) ) ; op -> type = R_ANAL_OP_TYPE_MOV ; } if ( IS_LDCVBR ( code ) ) { r_strbuf_setf ( & op -> esil , "r%d,vbr,=" , GET_TARGET_REG ( code ) ) ; op -> type = R_ANAL_OP_TYPE_MOV ; } if ( IS_LDSMACH ( code ) ) { r_strbuf_setf ( & op -> esil , "r%d,mach,=" , GET_TARGET_REG ( code ) ) ; op -> type = R_ANAL_OP_TYPE_MOV ; } if ( IS_LDSMACL ( code ) ) { r_strbuf_setf ( & op -> esil , "r%d,macl,=" , GET_TARGET_REG ( code ) ) ; op -> type = R_ANAL_OP_TYPE_MOV ; } if ( IS_LDSPR ( code ) ) { r_strbuf_setf ( & op -> esil , "r%d,pr,=" , GET_TARGET_REG ( code ) ) ; op -> type = R_ANAL_OP_TYPE_MOV ; } if ( IS_ROTR ( code ) ) { r_strbuf_setf ( & op -> esil , "0xFFFFFFFE,sr,&=,r%d,0x1,&,sr,|=,0x1,r%d,>>>,r%d,=" , GET_TARGET_REG ( code ) , GET_TARGET_REG ( code ) , GET_TARGET_REG ( code ) ) ; op -> type = ( code & 1 ) ?R_ANAL_OP_TYPE_ROR : R_ANAL_OP_TYPE_ROL ; } if ( IS_ROTL ( code ) ) { r_strbuf_setf ( & op -> esil , "0xFFFFFFFE,sr,&=,0x1,r%d,<<<,r%d,=,r%d,0x1,&,sr,|=" , GET_TARGET_REG ( code ) , GET_TARGET_REG ( code ) , GET_TARGET_REG ( code ) ) ; op -> type = ( code & 1 ) ?R_ANAL_OP_TYPE_ROR : R_ANAL_OP_TYPE_ROL ; } if ( IS_ROTCR ( code ) ) { r_strbuf_setf ( & op -> esil , "0,sr,0x1,&,?{,0x80000000,},0xFFFFFFFE,sr,&=,r%d,1,&,sr,|=,1,r%d,>>=,r%d,|=" , GET_TARGET_REG ( code ) , GET_TARGET_REG ( code ) , GET_TARGET_REG ( code ) ) ; op -> type = ( code & 1 ) ?R_ANAL_OP_TYPE_ROR : R_ANAL_OP_TYPE_ROL ; } if ( IS_ROTCL ( code ) ) { r_strbuf_setf ( & op -> esil , "sr,0x1,&,0xFFFFFFFE,sr,&=,r%d,0x80000000,&,?{,1,sr,|=,},1,r%d,<<=,r%d,|=" , GET_TARGET_REG ( code ) , GET_TARGET_REG ( code ) , GET_TARGET_REG ( code ) ) ; op -> type = ( code & 1 ) ?R_ANAL_OP_TYPE_ROR : R_ANAL_OP_TYPE_ROL ; } if ( IS_STCLSR ( code ) ) { r_strbuf_setf ( & op -> esil , "4,r%d,-=,sr,r%d,=[4]" , GET_TARGET_REG ( code ) , GET_TARGET_REG ( code ) ) ; op -> type = R_ANAL_OP_TYPE_PUSH ; } if ( IS_STCLGBR ( code ) ) { r_strbuf_setf ( & op -> esil , "4,r%d,-=,gbr,r%d,=[4]" , GET_TARGET_REG ( code ) , GET_TARGET_REG ( code ) ) ; op -> type = R_ANAL_OP_TYPE_PUSH ; } if ( IS_STCLVBR ( code ) ) { r_strbuf_setf ( & op -> esil , "4,r%d,-=,vbr,r%d,=[4]" , GET_TARGET_REG ( code ) , GET_TARGET_REG ( code ) ) ; op -> type = R_ANAL_OP_TYPE_PUSH ; } if ( IS_STSLMACL ( code ) ) { r_strbuf_setf ( & op -> esil , "4,r%d,-=,macl,r%d,=[4]" , GET_TARGET_REG ( code ) , GET_TARGET_REG ( code ) ) ; op -> type = R_ANAL_OP_TYPE_PUSH ; } if ( IS_STSLMACH ( code ) ) { r_strbuf_setf ( & op -> esil , "4,r%d,-=,mach,r%d,=[4]" , GET_TARGET_REG ( code ) , GET_TARGET_REG ( code ) ) ; op -> type = R_ANAL_OP_TYPE_PUSH ; } if ( IS_STSLPR ( code ) ) { op -> type = R_ANAL_OP_TYPE_PUSH ; r_strbuf_setf ( & op -> esil , "4,r%d,-=,pr,r%d,=[4]" , GET_TARGET_REG ( code ) , GET_TARGET_REG ( code ) ) ; } if ( IS_TASB ( code ) ) { r_strbuf_setf ( & op -> esil , "0xFFFFFFFE,sr,&=,r%d,[1],!,?{,0x80,r%d,=[1],1,sr,|=,}" , GET_TARGET_REG ( code ) , GET_TARGET_REG ( code ) ) ; op -> type = R_ANAL_OP_TYPE_UNK ; } if ( IS_DT ( code ) ) { r_strbuf_setf ( & op -> esil , "0xFFFFFFFE,sr,&=,1,r%d,-=,$z,sr,|,sr,:=" , GET_TARGET_REG ( code ) ) ; op -> type = R_ANAL_OP_TYPE_UNK ; } if ( IS_MACW ( code ) ) { r_strbuf_setf ( & op -> esil , "0x2,sr,&,!,?{," S16_EXT ( "r%d,[2]" ) "," S16_EXT ( "r%d,[2]" ) "," "*," "macl,32,mach,<<,|," "+," "32," S16_EXT ( "r%d,[2]" ) "," S16_EXT ( "r%d,[2]" ) "," "*," "0xffffffff00000000,&,>>,mach,=," "0xffffffff,&,macl,=," "}{," S16_EXT ( "r%d,[2]" ) "," S16_EXT ( "r%d,[2]" ) "," "*" "macl,+=," "31,$o,?{," "macl,0x80000000,&,?{," "0x7fffffff,macl,=," "}{," "0x80000000,macl,=," "}," "}," "}," "2,r%d,+=," "2,r%d,+=," , GET_TARGET_REG ( code ) , GET_SOURCE_REG ( code ) , GET_TARGET_REG ( code ) , GET_SOURCE_REG ( code ) , GET_TARGET_REG ( code ) , GET_SOURCE_REG ( code ) , GET_TARGET_REG ( code ) , GET_SOURCE_REG ( code ) ) ; op -> type = R_ANAL_OP_TYPE_MUL ; } free ( dst ) ; return op -> size ; } 