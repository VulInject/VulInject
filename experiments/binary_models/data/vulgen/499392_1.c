static int parse_linkprops ( char * buf , dlmgmt_link_t * linkp ) { boolean_t found_type = B_FALSE ; dladm_datatype_t type = DLADM_TYPE_STR ; int i , len ; char * curr ; char attr_name [ MAXLINKATTRLEN ] ; size_t attr_buf_len ; void * attr_buf = NULL ; curr = buf ; len = strlen ( buf ) ; attr_name [ 0 ] = '\0' ; for ( i = 0 ; i < len ; i ++ ) { char c = buf [ i ] ; boolean_t match = ( c == '=' || ( c == ',' && ! found_type ) || c == ';' ) ; if ( ! match && i != len - 1 ) { continue ; } if ( match ) { buf [ i ] = '\0' ; if ( * curr == '\0' ) { parse_fail } } if ( attr_name [ 0 ] != '\0' && found_type ) { if ( c == '=' ) { parse_fail } if ( strcmp ( attr_name , "linkid" ) == 0 ) { if ( read_int64 ( curr , & attr_buf ) == 0 ) { parse_fail } linkp -> ll_linkid = ( datalink_class_t ) * ( int64_t * ) attr_buf ; } if ( strcmp ( attr_name , "name" ) == 0 ) { if ( read_str ( curr , & attr_buf ) == 0 ) { parse_fail } ( void ) snprintf ( linkp -> ll_link , MAXLINKNAMELEN , "%s" , attr_buf ) ; } if ( strcmp ( attr_name , "class" ) == 0 ) { if ( read_int64 ( curr , & attr_buf ) == 0 ) { parse_fail } linkp -> ll_class = ( datalink_class_t ) * ( int64_t * ) attr_buf ; } if ( strcmp ( attr_name , "media" ) == 0 ) { if ( read_int64 ( curr , & attr_buf ) == 0 ) { parse_fail } linkp -> ll_media = ( uint32_t ) * ( int64_t * ) attr_buf ; } else { attr_buf_len = translators [ type ] . read_func ( curr , & attr_buf ) ; if ( attr_buf_len == 0 ) { parse_fail } if ( linkattr_set ( & ( linkp -> ll_head ) , attr_name , attr_buf , attr_buf_len , type ) != 0 ) { free ( attr_buf ) ; parse_fail } } free ( attr_buf ) ; attr_name [ 0 ] = '\0' ; found_type = B_FALSE ; } if ( attr_name [ 0 ] != '\0' ) { for ( type = 0 ; type < ntranslators ; type ++ ) { if ( strcmp ( curr , translators [ type ] . type_name ) == 0 ) { found_type = B_TRUE ; break ; } } if ( ! found_type ) { parse_fail } } else { if ( c != '=' ) { parse_fail } ( void ) snprintf ( attr_name , MAXLINKATTRLEN , "%s" , curr ) ; } curr = buf + i + 1 ; } if ( linkp -> ll_class == 0x60 ) { linkp -> ll_class = DATALINK_CLASS_IPTUN ; rewrite_needed = B_TRUE ; } return ( 0 ) ; parse_fail linkattr_destroy ( linkp ) ; return ( - 1 ) ; } 