static void ixgbe_set_interrupt_capability ( struct ixgbe_adapter * adapter ) { int err ; if ( adapter -> hw_tcs > 1 ) { e_dev_warn ( "Number of DCB TCs exceeds number of available queues. Disabling DCB support.\n" ) ; netdev_reset_tc ( adapter -> netdev ) ; if ( adapter -> hw . mac . type == ixgbe_mac_82598EB ) { adapter -> hw . fc . requested_mode = adapter -> last_lfc_mode ; } adapter -> flags &= ~ IXGBE_FLAG_DCB_ENABLED ; adapter -> temp_dcb_cfg . pfc_mode_enable = false ; adapter -> dcb_cfg . pfc_mode_enable = false ; } adapter -> hw_tcs = 0 ; adapter -> dcb_cfg . num_tcs . pg_tcs = 1 ; adapter -> dcb_cfg . num_tcs . pfc_tcs = 1 ; e_dev_warn ( "Disabling SR-IOV support\n" ) ; ixgbe_disable_sriov ( adapter ) ; e_dev_warn ( "Disabling RSS support\n" ) ; adapter -> ring_feature [ RING_F_RSS ] . limit = 1 ; ixgbe_set_num_queues ( adapter ) ; adapter -> num_q_vectors = 1 ; err = pci_enable_msi ( adapter -> pdev ) ; if ( err ) { e_dev_warn ( "Failed to allocate MSI interrupt, falling back to legacy. Error: %d\n" , err ) ; } else { adapter -> flags |= IXGBE_FLAG_MSI_ENABLED ; } } 