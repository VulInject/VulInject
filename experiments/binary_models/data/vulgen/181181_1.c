static int kernfs_get_target_path ( struct kernfs_node * parent , struct kernfs_node * target , char * path ) { struct kernfs_node * base , * kn ; char * s = path ; int len = 0 ; base = parent ; while ( base -> parent ) { kn = target -> parent ; while ( kn -> parent && base != kn ) { kn = kn -> parent ; } if ( base == kn ) { break ; } strcpy ( s , "../" ) ; s += 3 ; base = base -> parent ; } kn = target ; while ( kn -> parent && kn != base ) { len += strlen ( kn -> name ) + 1 ; kn = kn -> parent ; } if ( len < 2 ) { return - EINVAL ; } len -- ; if ( ( s - path ) + len >= PATH_MAX ) { return - ENAMETOOLONG ; } kn = target ; while ( kn -> parent && kn != base ) { int slen = strlen ( kn -> name ) ; len -= slen ; memcpy ( s + len , kn -> name , slen ) ; if ( len ) { s [ -- len ] = '/' ; } kn = kn -> parent ; } return 0 ; } 