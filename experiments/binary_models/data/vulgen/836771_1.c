ffedata_eval_offset_ ( , ) { ffetargetIntegerDefault offset = 0 ; ffetargetIntegerDefault width = 1 ; ffetargetIntegerDefault value ; ffetargetIntegerDefault lowbound ; ffetargetIntegerDefault highbound ; ffetargetOffset final ; ffebld subscript ; ffebld dim ; ffebld low ; ffebld high ; int rank = 0 ; bool ok ; while ( subscripts != NULL ) { ffeinfoKindtype sub_kind , low_kind , hi_kind ; ffebld sub1 , low1 , hi1 ; ++ rank ; assert ( dims != NULL ) ; subscript = ffebld_head ( subscripts ) ; dim = ffebld_head ( dims ) ; assert ( ffeinfo_basictype ( ffebld_info ( subscript ) ) == FFEINFO_basictypeINTEGER ) ; if ( ffebld_op ( subscript ) == FFEBLD_opCONTER ) { sub_kind = ffeinfo_kindtype ( ffebld_info ( subscript ) ) ; sub1 = ffebld_new_conter_with_orig ( ffebld_constant_new_integer1_val ( sub_kind == FFEINFO_kindtypeINTEGER2 ?subscript -> u . conter . expr -> u . integer2 : sub_kind == FFEINFO_kindtypeINTEGER3 ?subscript -> u . conter . expr -> u . integer3 : sub_kind == FFEINFO_kindtypeINTEGER4 ?subscript -> u . conter . expr -> u . integer4 : subscript -> u . conter . expr -> u . integer1 ) , NULL ) ; value = ffedata_eval_integer1_ ( sub1 ) ; } else { value = ffedata_eval_integer1_ ( subscript ) ; } assert ( ffebld_op ( dim ) == FFEBLD_opBOUNDS ) ; low = ffebld_left ( dim ) ; high = ffebld_right ( dim ) ; else { assert ( ffeinfo_basictype ( ffebld_info ( low ) ) == FFEINFO_basictypeINTEGER ) ; if ( ffebld_op ( low ) == FFEBLD_opCONTER ) { low_kind = ffeinfo_kindtype ( ffebld_info ( low ) ) ; low1 = ffebld_new_conter_with_orig ( ffebld_constant_new_integer1_val ( low_kind == FFEINFO_kindtypeINTEGER2 ?low -> u . conter . expr -> u . integer2 : low_kind == FFEINFO_kindtypeINTEGER3 ?low -> u . conter . expr -> u . integer3 : low_kind == FFEINFO_kindtypeINTEGER4 ?low -> u . conter . expr -> u . integer4 : low -> u . conter . expr -> u . integer1 ) , NULL ) ; lowbound = ffedata_eval_integer1_ ( low1 ) ; } else { lowbound = ffedata_eval_integer1_ ( low ) ; } } assert ( ffeinfo_basictype ( ffebld_info ( high ) ) == FFEINFO_basictypeINTEGER ) ; if ( ffebld_op ( high ) == FFEBLD_opCONTER ) { hi_kind = ffeinfo_kindtype ( ffebld_info ( high ) ) ; hi1 = ffebld_new_conter_with_orig ( ffebld_constant_new_integer1_val ( hi_kind == FFEINFO_kindtypeINTEGER2 ?high -> u . conter . expr -> u . integer2 : hi_kind == FFEINFO_kindtypeINTEGER3 ?high -> u . conter . expr -> u . integer3 : hi_kind == FFEINFO_kindtypeINTEGER4 ?high -> u . conter . expr -> u . integer4 : high -> u . conter . expr -> u . integer1 ) , NULL ) ; highbound = ffedata_eval_integer1_ ( hi1 ) ; } else { highbound = ffedata_eval_integer1_ ( high ) ; } if ( ( value < lowbound ) || ( value > highbound ) ) { char rankstr [ 10 ] ; sprintf ( rankstr , "%d" , rank ) ; value = lowbound ; ffebad_start ( FFEBAD_DATA_SUBSCRIPT ) ; ffebad_string ( ffesymbol_text ( ffedata_symbol_ ) ) ; ffebad_string ( rankstr ) ; ffebad_finish ( ) ; } subscripts = ffebld_trail ( subscripts ) ; dims = ffebld_trail ( dims ) ; offset += width * ( value - lowbound ) ; if ( subscripts != NULL ) { width *= highbound - lowbound + 1 ; } } assert ( dims == NULL ) ; ok = ffetarget_offset ( & final , offset ) ; assert ( ok ) ; return final ; } 