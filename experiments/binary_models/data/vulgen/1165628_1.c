DetectThresholdData * DetectThresholdDataCopy ( DetectThresholdData * de ) { DetectThresholdData * new_de = SCCalloc ( 1 , sizeof ( DetectThresholdData ) ) ; if ( unlikely ( new_de == NULL ) ) { return NULL ; } * new_de = * de ; new_de -> addrs . ipv4_head = NULL ; new_de -> addrs . ipv6_head = NULL ; for ( DetectAddress * last = NULL , * tmp_ad = de -> addrs . ipv4_head ; tmp_ad ; tmp_ad = tmp_ad -> next ) { DetectAddress * n_addr = DetectAddressCopy ( tmp_ad ) ; if ( n_addr == NULL ) { error } if ( last == NULL ) { new_de -> addrs . ipv4_head = n_addr ; } else { last -> next = n_addr ; n_addr -> prev = last ; } last = n_addr ; } for ( DetectAddress * last = NULL , * tmp_ad = de -> addrs . ipv6_head ; tmp_ad ; tmp_ad = tmp_ad -> next ) { DetectAddress * n_addr = DetectAddressCopy ( tmp_ad ) ; if ( n_addr == NULL ) { error } if ( last == NULL ) { new_de -> addrs . ipv6_head = n_addr ; } else { last -> next = n_addr ; n_addr -> prev = last ; } last = n_addr ; } return new_de ; error return NULL ; } 