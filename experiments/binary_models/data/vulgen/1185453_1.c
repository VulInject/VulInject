static void spl2sw_mii_link_change ( struct net_device * ndev ) { struct spl2sw_mac * mac = netdev_priv ( ndev ) ; struct phy_device * phydev = ndev -> phydev ; struct spl2sw_common * comm = mac -> comm ; u32 reg ; reg = readl ( comm -> l2sw_reg_base + L2SW_MAC_FORCE_MODE ) ; if ( phydev -> link ) { reg |= FIELD_PREP ( MAC_FORCE_RMII_LINK , mac -> lan_port ) ; if ( phydev -> speed == 100 ) { reg |= FIELD_PREP ( MAC_FORCE_RMII_SPD , mac -> lan_port ) ; } else { reg &= FIELD_PREP ( MAC_FORCE_RMII_SPD , ~ mac -> lan_port ) | ~ MAC_FORCE_RMII_SPD ; } if ( phydev -> duplex ) { reg |= FIELD_PREP ( MAC_FORCE_RMII_DPX , mac -> lan_port ) ; } else { reg &= FIELD_PREP ( MAC_FORCE_RMII_DPX , ~ mac -> lan_port ) | ~ MAC_FORCE_RMII_DPX ; } if ( phydev -> pause ) { reg |= FIELD_PREP ( MAC_FORCE_RMII_FC , mac -> lan_port ) ; } else { reg &= FIELD_PREP ( MAC_FORCE_RMII_FC , ~ mac -> lan_port ) | ~ MAC_FORCE_RMII_FC ; } } else { reg &= FIELD_PREP ( MAC_FORCE_RMII_LINK , ~ mac -> lan_port ) | ~ MAC_FORCE_RMII_LINK ; } writel ( reg , comm -> l2sw_reg_base + L2SW_MAC_FORCE_MODE ) ; } 