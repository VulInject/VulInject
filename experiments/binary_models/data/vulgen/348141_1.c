static int __adfs_dir_put ( struct adfs_dir * dir , int pos , struct object_info * obj ) { struct super_block * sb = dir -> sb ; struct adfs_direntry de ; int thissize , buffer , offset ; buffer = pos >> sb -> s_blocksize_bits ; offset = pos & ( sb -> s_blocksize - 1 ) ; thissize = sb -> s_blocksize - offset ; if ( thissize > 26 ) { thissize = 26 ; } memcpy ( & de , dir -> bh [ buffer ] -> b_data + offset , thissize ) ; if ( thissize != 26 ) { memcpy ( ( ( char * ) & de ) + thissize , dir -> bh [ buffer + 1 ] -> b_data , 26 - thissize ) ; } adfs_obj2dir ( & de , obj ) ; memcpy ( dir -> bh [ buffer ] -> b_data + offset , & de , thissize ) ; if ( thissize != 26 ) { memcpy ( dir -> bh [ buffer + 1 ] -> b_data , ( ( char * ) & de ) + thissize , 26 - thissize ) ; } return 0 ; } 