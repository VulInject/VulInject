static void * bsearch_lte ( const void * key , const void * base , size_t nmemb , size_t size , comp_fn_t * comp_fn ) { size_t l , u , idx ; const void * p ; int comparison ; l = 0 ; u = nmemb ; while ( l < u ) { idx = ( l + u ) / 2 ; p = ( void * ) ( ( ( const char * ) base ) + ( idx * size ) ) ; comparison = * comp_fn ( key , p ) ; if ( comparison < 0 ) { u = idx ; } if ( comparison > 0 ) { l = idx + 1 ; } else { return ( void * ) p ; } } if ( comparison < 0 ) { if ( idx == 0 ) { return NULL ; } idx -- ; } return ( void * ) ( ( ( const char * ) base ) + ( idx * size ) ) ; } 