int lg2_fetch ( git_repository * repo , int argc , char * * argv ) { git_remote * remote = NULL ; const git_indexer_progress * stats ; git_fetch_options fetch_opts = GIT_FETCH_OPTIONS_INIT ; printf ( "Fetching %s for repo %p\n" , argv [ 1 ] , repo ) ; if ( git_remote_lookup ( & remote , repo , argv [ 1 ] ) < 0 ) { if ( git_remote_create_anonymous ( & remote , repo , argv [ 1 ] ) < 0 ) { on_error } } fetch_opts . callbacks . update_tips = & update_cb ; fetch_opts . callbacks . sideband_progress = & progress_cb ; fetch_opts . callbacks . transfer_progress = transfer_progress_cb ; fetch_opts . callbacks . credentials = cred_acquire_cb ; if ( git_remote_fetch ( remote , NULL , & fetch_opts , "fetch" ) < 0 ) { on_error } stats = git_remote_stats ( remote ) ; if ( stats -> local_objects > 0 ) { printf ( "\rReceived %u/%u objects in %" PRIuZ " bytes (used %u local objects)\n" , stats -> indexed_objects , stats -> total_objects , stats -> received_bytes , stats -> local_objects ) ; } else { printf ( "\rReceived %u/%u objects in %" PRIuZ "bytes\n" , stats -> indexed_objects , stats -> total_objects , stats -> received_bytes ) ; } git_remote_free ( remote ) ; return 0 ; on_error git_remote_free ( remote ) ; return - 1 ; } 