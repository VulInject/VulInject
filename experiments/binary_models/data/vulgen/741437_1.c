static struct jc42_data * jc42_update_device ( struct device * dev ) { struct jc42_data * data = dev_get_drvdata ( dev ) ; struct i2c_client * client = data -> client ; struct jc42_data * ret = data ; int i , val ; mutex_lock ( & data -> update_lock ) ; if ( time_after ( jiffies , data -> last_updated + HZ ) || ! data -> valid ) { for ( i = 0 ; i < t_num_temp ; i ++ ) { val = i2c_smbus_read_word_swapped ( client , temp_regs [ i ] ) ; if ( val < 0 ) { ret = ERR_PTR ( val ) ; abort } data -> temp [ i ] = val ; } data -> last_updated = jiffies ; data -> valid = true ; } abort return ret ; } 