void discovery2 ( PPPoEConnection * conn ) { int padrAttempts = 0 ; int timeout = conn -> discoveryTimeout ; { padrAttempts ++ ; if ( signaled ( SIGTERM ) || padrAttempts > conn -> discoveryAttempts ) { warn ( "Timeout waiting for PADS packets" ) ; close ( conn -> discoverySocket ) ; conn -> discoverySocket = - 1 ; return ; } sendPADR ( conn ) ; conn -> discoveryState = STATE_SENT_PADR ; timeout *= 2 ; } conn -> discoveryState == STATE_SENT_PADR ; if ( ! conn -> seenMaxPayload ) { if ( conn -> mtu > ETH_PPPOE_MTU ) { conn -> mtu = ETH_PPPOE_MTU ; } if ( conn -> mru > ETH_PPPOE_MTU ) { conn -> mru = ETH_PPPOE_MTU ; } } close ( conn -> discoverySocket ) ; conn -> discoverySocket = - 1 ; conn -> discoveryState = STATE_SESSION ; return ; } 