static void mdp4_crtc_vblank_irq ( struct mdp_irq * irq , uint32_t irqstatus ) { struct mdp4_crtc * mdp4_crtc = container_of ( irq , mdp4_crtc , vblank ) ; struct drm_crtc * crtc = & mdp4_crtc -> base ; struct msm_drm_private * priv = crtc -> dev -> dev_private ; unsigned pending ; mdp_irq_unregister ( & get_kms ( crtc ) -> base , & mdp4_crtc -> vblank ) ; pending = atomic_xchg ( & mdp4_crtc -> pending , 0 ) ; if ( pending & PENDING_FLIP ) { complete_flip ( crtc , NULL ) ; } } 