static int __init pxa_timer_common_init ( int irq , unsigned long clock_tick_rate ) { int ret ; timer_writel ( 0 , OIER ) ; timer_writel ( OSSR_M0 | OSSR_M1 | OSSR_M2 | OSSR_M3 , OSSR ) ; sched_clock_register ( pxa_read_sched_clock , 32 , clock_tick_rate ) ; ckevt_pxa_osmr0 . cpumask = cpumask_of ( 0 ) ; ret = request_irq ( irq , pxa_ost0_interrupt , IRQF_TIMER | IRQF_IRQPOLL , "ost0" , & ckevt_pxa_osmr0 ) ; if ( ret ) { pr_err ( "Failed to setup irq\n" ) ; return ret ; } ret = clocksource_mmio_init ( timer_base + OSCR , "oscr0" , clock_tick_rate , 200 , 32 , clocksource_mmio_readl_up ) ; if ( ret ) { pr_err ( "Failed to init clocksource\n" ) ; return ret ; } return 0 ; } 