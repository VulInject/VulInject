static void test_create_policy ( ) { void * handle ; kadm5_policy_ent_rec ent ; memset ( & ent , 0 , sizeof ( ent ) ) ; ent . policy = "create-policy-test" ; cpol_test_fail ( "admin" , & ent , 0x10000000 , KADM5_BAD_MASK ) ; handle = get_handle ( "admin" ) ; check_fail ( kadm5_create_policy ( handle , & ent , 0 ) , KADM5_BAD_MASK ) ; cpol_test_compare ( "admin" , & ent , KADM5_PW_MIN_LIFE ) ; ent . pw_min_life = 32 ; cpol_test_compare ( "admin" , & ent , KADM5_PW_MIN_LIFE ) ; cpol_test_compare ( "admin" , & ent , KADM5_PW_MAX_LIFE ) ; ent . pw_max_life = 32 ; cpol_test_compare ( "admin" , & ent , KADM5_PW_MAX_LIFE ) ; cpol_test_fail ( "admin" , & ent , KADM5_PW_MIN_LENGTH , KADM5_BAD_LENGTH ) ; ent . pw_min_length = 32 ; cpol_test_compare ( "admin" , & ent , KADM5_PW_MIN_LENGTH ) ; cpol_test_fail ( "admin" , & ent , KADM5_PW_MIN_CLASSES , KADM5_BAD_CLASS ) ; ent . pw_min_classes = 1 ; cpol_test_compare ( "admin" , & ent , KADM5_PW_MIN_CLASSES ) ; ent . pw_min_classes = 5 ; cpol_test_compare ( "admin" , & ent , KADM5_PW_MIN_CLASSES ) ; ent . pw_min_classes = 6 ; cpol_test_fail ( "admin" , & ent , KADM5_PW_MIN_CLASSES , KADM5_BAD_CLASS ) ; cpol_test_fail ( "admin" , & ent , KADM5_PW_HISTORY_NUM , KADM5_BAD_HISTORY ) ; ent . pw_history_num = 1 ; cpol_test_compare ( "admin" , & ent , KADM5_PW_HISTORY_NUM ) ; ent . pw_history_num = 10 ; cpol_test_compare ( "admin" , & ent , KADM5_PW_HISTORY_NUM ) ; if ( api >= KADM5_API_VERSION_3 ) { ent . pw_max_fail = 2 ; cpol_test_compare ( "admin" , & ent , KADM5_PW_MAX_FAILURE ) ; ent . pw_failcnt_interval = 90 ; cpol_test_compare ( "admin" , & ent , KADM5_PW_FAILURE_COUNT_INTERVAL ) ; ent . pw_lockout_duration = 180 ; cpol_test_compare ( "admin" , & ent , KADM5_PW_LOCKOUT_DURATION ) ; } if ( rpc ) { cpol_test_fail ( "$admin" , & ent , 0 , KADM5_AUTH_ADD ) ; cpol_test_fail ( "admin/none" , & ent , 0 , KADM5_AUTH_ADD ) ; cpol_test_fail ( "admin/get" , & ent , 0 , KADM5_AUTH_ADD ) ; cpol_test_fail ( "admin/modify" , & ent , 0 , KADM5_AUTH_ADD ) ; cpol_test_fail ( "admin/delete" , & ent , 0 , KADM5_AUTH_ADD ) ; cpol_test_compare ( "admin/add" , & ent , 0 ) ; } ent . policy = "test-pol" ; cpol_test_fail ( "admin" , & ent , 0 , KADM5_DUP ) ; ent . policy = NULL ; cpol_test_fail ( "admin" , & ent , 0 , EINVAL ) ; ent . policy = "" ; cpol_test_fail ( "admin" , & ent , 0 , KADM5_BAD_POLICY ) ; ent . policy = "pol\7" ; cpol_test_fail ( "admin" , & ent , 0 , KADM5_BAD_POLICY ) ; cpol_test_fail ( NULL , & ent , 0 , KADM5_BAD_SERVER_HANDLE ) ; cpol_test_fail ( "admin" , NULL , 0 , EINVAL ) ; } 