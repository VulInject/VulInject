void fill_default_server_options ( ServerOptions * options ) { u_int i ; if ( options -> use_pam == - 1 ) { options -> use_pam = 0 ; } if ( options -> num_host_key_files == 0 ) { servconf_add_hostkey ( "[default]" , 0 , options , _PATH_HOST_RSA_KEY_FILE , 0 ) ; servconf_add_hostkey ( "[default]" , 0 , options , _PATH_HOST_ECDSA_KEY_FILE , 0 ) ; servconf_add_hostkey ( "[default]" , 0 , options , _PATH_HOST_ED25519_KEY_FILE , 0 ) ; servconf_add_hostkey ( "[default]" , 0 , options , _PATH_HOST_XMSS_KEY_FILE , 0 ) ; } if ( options -> num_ports == 0 ) { options -> ports [ options -> num_ports ++ ] = SSH_DEFAULT_PORT ; } if ( options -> address_family == - 1 ) { options -> address_family = AF_UNSPEC ; } if ( options -> listen_addrs == NULL ) { add_listen_addr ( options , NULL , NULL , 0 ) ; } if ( options -> pid_file == NULL ) { options -> pid_file = xstrdup ( _PATH_SSH_DAEMON_PID_FILE ) ; } if ( options -> moduli_file == NULL ) { options -> moduli_file = xstrdup ( _PATH_DH_MODULI ) ; } if ( options -> login_grace_time == - 1 ) { options -> login_grace_time = 120 ; } if ( options -> permit_root_login == PERMIT_NOT_SET ) { options -> permit_root_login = PERMIT_NO_PASSWD ; } if ( options -> ignore_rhosts == - 1 ) { options -> ignore_rhosts = 1 ; } if ( options -> ignore_user_known_hosts == - 1 ) { options -> ignore_user_known_hosts = 0 ; } if ( options -> print_motd == - 1 ) { options -> print_motd = 1 ; } if ( options -> print_lastlog == - 1 ) { options -> print_lastlog = 1 ; } if ( options -> x11_display_offset == - 1 ) { options -> x11_display_offset = 10 ; } if ( options -> x11_use_localhost == - 1 ) { options -> x11_use_localhost = 1 ; } if ( options -> xauth_location == NULL ) { options -> xauth_location = xstrdup ( _PATH_XAUTH ) ; } if ( options -> permit_tty == - 1 ) { options -> permit_tty = 1 ; } if ( options -> permit_user_rc == - 1 ) { options -> permit_user_rc = 1 ; } if ( options -> strict_modes == - 1 ) { options -> strict_modes = 1 ; } if ( options -> tcp_keep_alive == - 1 ) { options -> tcp_keep_alive = 1 ; } if ( options -> log_facility == SYSLOG_FACILITY_NOT_SET ) { options -> log_facility = SYSLOG_FACILITY_AUTH ; } if ( options -> log_level == SYSLOG_LEVEL_NOT_SET ) { options -> log_level = SYSLOG_LEVEL_INFO ; } if ( options -> hostbased_authentication == - 1 ) { options -> hostbased_authentication = 0 ; } if ( options -> hostbased_uses_name_from_packet_only == - 1 ) { options -> hostbased_uses_name_from_packet_only = 0 ; } if ( options -> pubkey_authentication == - 1 ) { options -> pubkey_authentication = 1 ; } if ( options -> pubkey_auth_options == - 1 ) { options -> pubkey_auth_options = 0 ; } if ( options -> kerberos_authentication == - 1 ) { options -> kerberos_authentication = 0 ; } if ( options -> kerberos_or_local_passwd == - 1 ) { options -> kerberos_or_local_passwd = 1 ; } if ( options -> kerberos_ticket_cleanup == - 1 ) { options -> kerberos_ticket_cleanup = 1 ; } if ( options -> kerberos_get_afs_token == - 1 ) { options -> kerberos_get_afs_token = 0 ; } if ( options -> gss_authentication == - 1 ) { options -> gss_authentication = 0 ; } if ( options -> gss_cleanup_creds == - 1 ) { options -> gss_cleanup_creds = 1 ; } if ( options -> gss_strict_acceptor == - 1 ) { options -> gss_strict_acceptor = 1 ; } if ( options -> password_authentication == - 1 ) { options -> password_authentication = 1 ; } if ( options -> kbd_interactive_authentication == - 1 ) { options -> kbd_interactive_authentication = 1 ; } if ( options -> permit_empty_passwd == - 1 ) { options -> permit_empty_passwd = 0 ; } if ( options -> permit_user_env == - 1 ) { options -> permit_user_env = 0 ; options -> permit_user_env_allowlist = NULL ; } if ( options -> compression == - 1 ) { options -> compression = COMP_DELAYED ; } options -> compression = COMP_NONE ; if ( options -> rekey_limit == - 1 ) { options -> rekey_limit = 0 ; } if ( options -> rekey_interval == - 1 ) { options -> rekey_interval = 0 ; } if ( options -> allow_tcp_forwarding == - 1 ) { options -> allow_tcp_forwarding = FORWARD_ALLOW ; } if ( options -> allow_streamlocal_forwarding == - 1 ) { options -> allow_streamlocal_forwarding = FORWARD_ALLOW ; } if ( options -> allow_agent_forwarding == - 1 ) { options -> allow_agent_forwarding = 1 ; } if ( options -> fwd_opts . gateway_ports == - 1 ) { options -> fwd_opts . gateway_ports = 0 ; } if ( options -> max_startups == - 1 ) { options -> max_startups = 100 ; } if ( options -> max_startups_rate == - 1 ) { options -> max_startups_rate = 30 ; } if ( options -> max_startups_begin == - 1 ) { options -> max_startups_begin = 10 ; } if ( options -> per_source_max_startups == - 1 ) { options -> per_source_max_startups = INT_MAX ; } if ( options -> per_source_masklen_ipv4 == - 1 ) { options -> per_source_masklen_ipv4 = 32 ; } if ( options -> per_source_masklen_ipv6 == - 1 ) { options -> per_source_masklen_ipv6 = 128 ; } if ( options -> max_authtries == - 1 ) { options -> max_authtries = DEFAULT_AUTH_FAIL_MAX ; } if ( options -> max_sessions == - 1 ) { options -> max_sessions = DEFAULT_SESSIONS_MAX ; } if ( options -> use_dns == - 1 ) { options -> use_dns = 0 ; } if ( options -> client_alive_interval == - 1 ) { options -> client_alive_interval = 0 ; } if ( options -> client_alive_count_max == - 1 ) { options -> client_alive_count_max = 3 ; } if ( options -> num_authkeys_files == 0 ) { opt_array_append ( "[default]" , 0 , "AuthorizedKeysFiles" , & options -> authorized_keys_files , & options -> num_authkeys_files , _PATH_SSH_USER_PERMITTED_KEYS ) ; opt_array_append ( "[default]" , 0 , "AuthorizedKeysFiles" , & options -> authorized_keys_files , & options -> num_authkeys_files , _PATH_SSH_USER_PERMITTED_KEYS2 ) ; } if ( options -> permit_tun == - 1 ) { options -> permit_tun = SSH_TUNMODE_NO ; } if ( options -> ip_qos_interactive == - 1 ) { options -> ip_qos_interactive = IPTOS_DSCP_AF21 ; } if ( options -> ip_qos_bulk == - 1 ) { options -> ip_qos_bulk = IPTOS_DSCP_CS1 ; } if ( options -> version_addendum == NULL ) { options -> version_addendum = xstrdup ( "" ) ; } if ( options -> fwd_opts . streamlocal_bind_mask == ( mode_t ) - 1 ) { options -> fwd_opts . streamlocal_bind_mask = 0177 ; } if ( options -> fwd_opts . streamlocal_bind_unlink == - 1 ) { options -> fwd_opts . streamlocal_bind_unlink = 0 ; } if ( options -> fingerprint_hash == - 1 ) { options -> fingerprint_hash = SSH_FP_HASH_DEFAULT ; } if ( options -> disable_forwarding == - 1 ) { options -> disable_forwarding = 0 ; } if ( options -> expose_userauth_info == - 1 ) { options -> expose_userauth_info = 0 ; } if ( options -> sk_provider == NULL ) { options -> sk_provider = xstrdup ( "internal" ) ; } if ( options -> required_rsa_size == - 1 ) { options -> required_rsa_size = SSH_RSA_MINIMUM_MODULUS_SIZE ; } if ( options -> unused_connection_timeout == - 1 ) { options -> unused_connection_timeout = 0 ; } assemble_algorithms ( options ) ; if ( use_privsep == - 1 ) { use_privsep = PRIVSEP_ON ; } { if ( option_clear_or_none ( v ) ) { free ( v ) ; v = NULL ; } } 0 ; { if ( options -> nv == 1 && strcasecmp ( options -> v [ 0 ] , none ) == 0 ) { free ( options -> v [ 0 ] ) ; free ( options -> v ) ; options -> v = NULL ; options -> nv = 0 ; } } while ( 0 ) { CLEAR_ON_NONE ( options -> pid_file ) ; } CLEAR_ON_NONE ( options -> xauth_location ) ; CLEAR_ON_NONE ( options -> banner ) ; CLEAR_ON_NONE ( options -> trusted_user_ca_keys ) ; CLEAR_ON_NONE ( options -> revoked_keys_file ) ; CLEAR_ON_NONE ( options -> sk_provider ) ; CLEAR_ON_NONE ( options -> authorized_principals_file ) ; CLEAR_ON_NONE ( options -> adm_forced_command ) ; CLEAR_ON_NONE ( options -> chroot_directory ) ; CLEAR_ON_NONE ( options -> routing_domain ) ; CLEAR_ON_NONE ( options -> host_key_agent ) ; for ( i = 0 ; i < options -> num_host_key_files ; i ++ ) { CLEAR_ON_NONE ( options -> host_key_files [ i ] ) ; } for ( i = 0 ; i < options -> num_host_cert_files ; i ++ ) { CLEAR_ON_NONE ( options -> host_cert_files [ i ] ) ; } CLEAR_ON_NONE_ARRAY ( channel_timeouts , num_channel_timeouts , "none" ) ; CLEAR_ON_NONE_ARRAY ( auth_methods , num_auth_methods , "any" ) ; } { sBadOption , sUsePAM , sPort , sHostKeyFile , sLoginGraceTime , sPermitRootLogin , sLogFacility , sLogLevel , sLogVerbose , sKerberosAuthentication , sKerberosOrLocalPasswd , sKerberosTicketCleanup , sKerberosGetAFSToken , sPasswordAuthentication , sKbdInteractiveAuthentication , sListenAddress , sAddressFamily , sPrintMotd , sPrintLastLog , sIgnoreRhosts , sX11Forwarding , sX11DisplayOffset , sX11UseLocalhost , sPermitTTY , sStrictModes , sEmptyPasswd , sTCPKeepAlive , sPermitUserEnvironment , sAllowTcpForwarding , sCompression , sRekeyLimit , sAllowUsers , sDenyUsers , sAllowGroups , sDenyGroups , sIgnoreUserKnownHosts , sCiphers , sMacs , sPidFile , sModuliFile , sGatewayPorts , sPubkeyAuthentication , sPubkeyAcceptedAlgorithms , sXAuthLocation , sSubsystem , sMaxStartups , sMaxAuthTries , sMaxSessions , sBanner , sUseDNS , sHostbasedAuthentication , sHostbasedUsesNameFromPacketOnly , sHostbasedAcceptedAlgorithms , sHostKeyAlgorithms , sPerSourceMaxStartups , sPerSourceNetBlockSize , sClientAliveInterval , sClientAliveCountMax , sAuthorizedKeysFile , sGssAuthentication , sGssCleanupCreds , sGssStrictAcceptor , sAcceptEnv , sSetEnv , sPermitTunnel , sMatch , sPermitOpen , sPermitListen , sForceCommand , sChrootDirectory , sUsePrivilegeSeparation , sAllowAgentForwarding , sHostCertificate , sInclude , sRevokedKeys , sTrustedUserCAKeys , sAuthorizedPrincipalsFile , sAuthorizedPrincipalsCommand , sAuthorizedPrincipalsCommandUser , sKexAlgorithms , sCASignatureAlgorithms , sIPQoS , sVersionAddendum , sAuthorizedKeysCommand , sAuthorizedKeysCommandUser , sAuthenticationMethods , sHostKeyAgent , sPermitUserRC , sStreamLocalBindMask , sStreamLocalBindUnlink , sAllowStreamLocalForwarding , sFingerprintHash , sDisableForwarding , sExposeAuthInfo , sRDomain , sPubkeyAuthOptions , sSecurityKeyProvider , sRequiredRSASize , sChannelTimeout , sUnusedConnectionTimeout , sDeprecated , sIgnore , sUnsupported } ServerOpCodes static { const char * name ; ServerOpCodes opcode ; u_int flags ; } , keywords [ ] { { "usepam" sUsePAM SSHCFG_GLOBAL } { "usepam" sUnsupported SSHCFG_GLOBAL } { "pamauthenticationviakbdint" sDeprecated SSHCFG_GLOBAL } { "port" sPort SSHCFG_GLOBAL } { "hostkey" sHostKeyFile SSHCFG_GLOBAL } { "hostdsakey" sHostKeyFile SSHCFG_GLOBAL } { "hostkeyagent" sHostKeyAgent SSHCFG_GLOBAL } { "pidfile" sPidFile SSHCFG_GLOBAL } { "modulifile" sModuliFile SSHCFG_GLOBAL } { "serverkeybits" sDeprecated SSHCFG_GLOBAL } { "logingracetime" sLoginGraceTime SSHCFG_GLOBAL } { "keyregenerationinterval" sDeprecated SSHCFG_GLOBAL } { "permitrootlogin" sPermitRootLogin SSHCFG_ALL } { "syslogfacility" sLogFacility SSHCFG_GLOBAL } { "loglevel" sLogLevel SSHCFG_ALL } { "logverbose" sLogVerbose SSHCFG_ALL } { "rhostsauthentication" sDeprecated SSHCFG_GLOBAL } { "rhostsrsaauthentication" sDeprecated SSHCFG_ALL } { "hostbasedauthentication" sHostbasedAuthentication SSHCFG_ALL } { "hostbasedusesnamefrompacketonly" sHostbasedUsesNameFromPacketOnly SSHCFG_ALL } { "hostbasedacceptedalgorithms" sHostbasedAcceptedAlgorithms SSHCFG_ALL } { "hostbasedacceptedkeytypes" sHostbasedAcceptedAlgorithms SSHCFG_ALL } { "hostkeyalgorithms" sHostKeyAlgorithms SSHCFG_GLOBAL } { "rsaauthentication" sDeprecated SSHCFG_ALL } { "pubkeyauthentication" sPubkeyAuthentication SSHCFG_ALL } { "pubkeyacceptedalgorithms" sPubkeyAcceptedAlgorithms SSHCFG_ALL } { "pubkeyacceptedkeytypes" sPubkeyAcceptedAlgorithms SSHCFG_ALL } { "pubkeyauthoptions" sPubkeyAuthOptions SSHCFG_ALL } { "dsaauthentication" sPubkeyAuthentication SSHCFG_GLOBAL } { "kerberosauthentication" sKerberosAuthentication SSHCFG_ALL } { "kerberosorlocalpasswd" sKerberosOrLocalPasswd SSHCFG_GLOBAL } { "kerberosticketcleanup" sKerberosTicketCleanup SSHCFG_GLOBAL } { "kerberosgetafstoken" sKerberosGetAFSToken SSHCFG_GLOBAL } { "kerberosgetafstoken" sUnsupported SSHCFG_GLOBAL } { "kerberosauthentication" sUnsupported SSHCFG_ALL } { "kerberosorlocalpasswd" sUnsupported SSHCFG_GLOBAL } { "kerberosticketcleanup" sUnsupported SSHCFG_GLOBAL } { "kerberosgetafstoken" sUnsupported SSHCFG_GLOBAL } { "kerberostgtpassing" sUnsupported SSHCFG_GLOBAL } { "afstokenpassing" sUnsupported SSHCFG_GLOBAL } { "gssapiauthentication" sGssAuthentication SSHCFG_ALL } { "gssapicleanupcredentials" sGssCleanupCreds SSHCFG_GLOBAL } { "gssapistrictacceptorcheck" sGssStrictAcceptor SSHCFG_GLOBAL } { "gssapiauthentication" sUnsupported SSHCFG_ALL } { "gssapicleanupcredentials" sUnsupported SSHCFG_GLOBAL } { "gssapistrictacceptorcheck" sUnsupported SSHCFG_GLOBAL } { "passwordauthentication" sPasswordAuthentication SSHCFG_ALL } { "kbdinteractiveauthentication" sKbdInteractiveAuthentication SSHCFG_ALL } { "challengeresponseauthentication" sKbdInteractiveAuthentication SSHCFG_ALL } { "skeyauthentication" sKbdInteractiveAuthentication SSHCFG_ALL } { "checkmail" sDeprecated SSHCFG_GLOBAL } { "listenaddress" sListenAddress SSHCFG_GLOBAL } { "addressfamily" sAddressFamily SSHCFG_GLOBAL } { "printmotd" sPrintMotd SSHCFG_GLOBAL } { "printlastlog" sUnsupported SSHCFG_GLOBAL } { "printlastlog" sPrintLastLog SSHCFG_GLOBAL } { "ignorerhosts" sIgnoreRhosts SSHCFG_ALL } { "ignoreuserknownhosts" sIgnoreUserKnownHosts SSHCFG_GLOBAL } { "x11forwarding" sX11Forwarding SSHCFG_ALL } { "x11displayoffset" sX11DisplayOffset SSHCFG_ALL } { "x11uselocalhost" sX11UseLocalhost SSHCFG_ALL } { "xauthlocation" sXAuthLocation SSHCFG_GLOBAL } { "strictmodes" sStrictModes SSHCFG_GLOBAL } { "permitemptypasswords" sEmptyPasswd SSHCFG_ALL } { "permituserenvironment" sPermitUserEnvironment SSHCFG_GLOBAL } { "uselogin" sDeprecated SSHCFG_GLOBAL } { "compression" sCompression SSHCFG_GLOBAL } { "rekeylimit" sRekeyLimit SSHCFG_ALL } { "tcpkeepalive" sTCPKeepAlive SSHCFG_GLOBAL } { "keepalive" sTCPKeepAlive SSHCFG_GLOBAL } { "allowtcpforwarding" sAllowTcpForwarding SSHCFG_ALL } { "allowagentforwarding" sAllowAgentForwarding SSHCFG_ALL } { "allowusers" sAllowUsers SSHCFG_ALL } { "denyusers" sDenyUsers SSHCFG_ALL } { "allowgroups" sAllowGroups SSHCFG_ALL } { "denygroups" sDenyGroups SSHCFG_ALL } { "ciphers" sCiphers SSHCFG_GLOBAL } { "macs" sMacs SSHCFG_GLOBAL } { "protocol" sIgnore SSHCFG_GLOBAL } { "gatewayports" sGatewayPorts SSHCFG_ALL } { "subsystem" sSubsystem SSHCFG_GLOBAL } { "maxstartups" sMaxStartups SSHCFG_GLOBAL } { "persourcemaxstartups" sPerSourceMaxStartups SSHCFG_GLOBAL } { "persourcenetblocksize" sPerSourceNetBlockSize SSHCFG_GLOBAL } { "maxauthtries" sMaxAuthTries SSHCFG_ALL } { "maxsessions" sMaxSessions SSHCFG_ALL } { "banner" sBanner SSHCFG_ALL } { "usedns" sUseDNS SSHCFG_GLOBAL } { "verifyreversemapping" sDeprecated SSHCFG_GLOBAL } { "reversemappingcheck" sDeprecated SSHCFG_GLOBAL } { "clientaliveinterval" sClientAliveInterval SSHCFG_ALL } { "clientalivecountmax" sClientAliveCountMax SSHCFG_ALL } { "authorizedkeysfile" sAuthorizedKeysFile SSHCFG_ALL } { "authorizedkeysfile2" sDeprecated SSHCFG_ALL } { "useprivilegeseparation" sDeprecated SSHCFG_GLOBAL } { "acceptenv" sAcceptEnv SSHCFG_ALL } { "setenv" sSetEnv SSHCFG_ALL } { "permittunnel" sPermitTunnel SSHCFG_ALL } { "permittty" sPermitTTY SSHCFG_ALL } { "permituserrc" sPermitUserRC SSHCFG_ALL } { "match" sMatch SSHCFG_ALL } { "permitopen" sPermitOpen SSHCFG_ALL } { "permitlisten" sPermitListen SSHCFG_ALL } { "forcecommand" sForceCommand SSHCFG_ALL } { "chrootdirectory" sChrootDirectory SSHCFG_ALL } { "hostcertificate" sHostCertificate SSHCFG_GLOBAL } { "revokedkeys" sRevokedKeys SSHCFG_ALL } { "trustedusercakeys" sTrustedUserCAKeys SSHCFG_ALL } { "authorizedprincipalsfile" sAuthorizedPrincipalsFile SSHCFG_ALL } { "kexalgorithms" sKexAlgorithms SSHCFG_GLOBAL } { "include" sInclude SSHCFG_ALL } { "ipqos" sIPQoS SSHCFG_ALL } { "authorizedkeyscommand" sAuthorizedKeysCommand SSHCFG_ALL } { "authorizedkeyscommanduser" sAuthorizedKeysCommandUser SSHCFG_ALL } { "authorizedprincipalscommand" sAuthorizedPrincipalsCommand SSHCFG_ALL } { "authorizedprincipalscommanduser" sAuthorizedPrincipalsCommandUser SSHCFG_ALL } { "versionaddendum" sVersionAddendum SSHCFG_GLOBAL } { "authenticationmethods" sAuthenticationMethods SSHCFG_ALL } { "streamlocalbindmask" sStreamLocalBindMask SSHCFG_ALL } { "streamlocalbindunlink" sStreamLocalBindUnlink SSHCFG_ALL } { "allowstreamlocalforwarding" sAllowStreamLocalForwarding SSHCFG_ALL } { "fingerprinthash" sFingerprintHash SSHCFG_GLOBAL } { "disableforwarding" sDisableForwarding SSHCFG_ALL } { "exposeauthinfo" sExposeAuthInfo SSHCFG_ALL } { "rdomain" sRDomain SSHCFG_ALL } { "casignaturealgorithms" sCASignatureAlgorithms SSHCFG_ALL } { "securitykeyprovider" sSecurityKeyProvider SSHCFG_GLOBAL } { "requiredrsasize" sRequiredRSASize SSHCFG_ALL } { "channeltimeout" sChannelTimeout SSHCFG_ALL } { "unusedconnectiontimeout" sUnusedConnectionTimeout SSHCFG_ALL } { NULL sBadOption 0 } } ; static { int val ; char * text ; } , tunmode_desc [ ] { } ; 