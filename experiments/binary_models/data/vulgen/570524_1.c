* shutdownx = 0 ; shutdownx_lock = lock_alloc ( ) ; if ( ! shutdownx_lock ) { LOG_NO_MEM ( "shm" , sizeof ( gen_lock_t ) ) ; error } shutdownx_lock = lock_init ( shutdownx_lock ) ; handlers_lock = lock_alloc ( ) ; if ( ! handlers_lock ) { LOG_NO_MEM ( "shm" , sizeof ( gen_lock_t ) ) ; error } handlers_lock = lock_init ( handlers_lock ) ; handlers = shm_malloc ( sizeof ( handler_list ) ) ; if ( ! handlers ) { LOG_NO_MEM ( "shm" , sizeof ( handler_list ) ) ; error } handlers -> head = 0 ; handlers -> tail = 0 ; pid_list = shm_malloc ( sizeof ( pid_list_head_t ) ) ; if ( ! pid_list ) { LOG_NO_MEM ( "shm" , sizeof ( pid_list_head_t ) ) ; error } bzero ( pid_list , sizeof ( pid_list_head_t ) ) ; pid_list_lock = lock_alloc ( ) ; pid_list_lock = lock_init ( pid_list_lock ) ; timer_cdp_init ( ) ; worker_init ( ) ; peer_manager_init ( config ) ; cdp_trans_init ( ) ; if ( ! cdp_sessions_init ( config -> sessions_hash_size ) ) { error } cb_add ( api_callback , 0 ) ; return 1 ; error if ( shutdownx ) { shm_free ( shutdownx ) ; } i = pid_list -> head ; while ( i ) { j = i -> next ; shm_free ( i ) ; i = j ; } shm_free ( pid_list ) ; lock_get ( pid_list_lock ) ; lock_destroy ( pid_list_lock ) ; lock_dealloc ( ( void * ) pid_list_lock ) ; return 0 ; 