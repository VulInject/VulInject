void zerror ( zlog_t * zlogp , boolean_t use_strerror , const char * fmt , ... ) { va_list alist ; char buf [ MAXPATHLEN * 2 ] ; char * bp ; int saved_errno = errno ; if ( zlogp == NULL ) { return ; } if ( zlogp == & logsys ) { ( void ) snprintf ( buf , sizeof ( buf ) , "[zone '%s'] " , zone_name ) ; } else { buf [ 0 ] = '\0' ; } assert ( zlogp -> locale != NULL ) ; fmt = localize_msg ( zlogp -> locale , fmt ) ; va_start ( alist , fmt ) ; ( void ) vsnprintf ( bp , sizeof ( buf ) - ( bp - buf ) , fmt , alist ) ; va_end ( alist ) ; bp = & ( buf [ strlen ( buf ) ] ) ; if ( use_strerror ) { ( void ) snprintf ( bp , sizeof ( buf ) - ( bp - buf ) , ": %s" , strerror ( saved_errno ) ) ; } if ( zlogp == & logsys ) { ( void ) syslog ( LOG_ERR , "%s" , buf ) ; } if ( zlogp -> logfile != NULL ) { ( void ) fprintf ( zlogp -> logfile , "%s\n" , buf ) ; } else { size_t buflen ; size_t copylen ; buflen = snprintf ( zlogp -> log , zlogp -> loglen , "%s\n" , buf ) ; copylen = MIN ( buflen , zlogp -> loglen ) ; zlogp -> log += copylen ; zlogp -> loglen -= copylen ; } } 