static bool __init efi_virtmap_init ( void ) { efi_memory_desc_t * md ; efi_mm . pgd = pgd_alloc ( & efi_mm ) ; mm_init_cpumask ( & efi_mm ) ; init_new_context ( NULL , & efi_mm ) ; for_each_efi_memory_desc ( ) { phys_addr_t phys = md -> phys_addr ; int ret ; if ( ! ( md -> attribute & EFI_MEMORY_RUNTIME ) ) { continue ; } ret = efi_create_mapping ( & efi_mm , md ) ; if ( ret ) { pr_warn ( "  EFI remap %pa: failed to create mapping (%d)\n" , & phys , ret ) ; return false ; } } if ( efi_memattr_apply_permissions ( & efi_mm , efi_set_mapping_permissions ) ) { return false ; } return true ; } 