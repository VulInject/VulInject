static void _validate_switches ( void ) { slurm_conf_switches_t * ptr , * * ptr_array ; int i , j ; switch_data * switch_ptr , * prior_ptr ; hostlist_t invalid_hl = NULL ; _free_switch_data_table ( ) ; switch_data_cnt = _read_topo_file ( & ptr_array ) ; if ( switch_data_cnt == 0 ) { error ( "No switches configured" ) ; return ; } switch_data_table = xmalloc ( sizeof ( switch_data ) * switch_data_cnt ) ; switch_ptr = switch_data_table ; for ( i = 0 ; i < switch_data_cnt ; i ++ , switch_ptr ++ ) { switch_data_table [ i ] . index = i ; ptr = ptr_array [ i ] ; switch_ptr -> name = xstrdup ( ptr -> switch_name ) ; prior_ptr = switch_data_table ; for ( j = 0 ; j < i ; j ++ , prior_ptr ++ ) { if ( xstrcmp ( switch_ptr -> name , prior_ptr -> name ) == 0 ) { fatal ( "Switch (%s) has already been defined" , prior_ptr -> name ) ; } } switch_ptr -> link_speed = ptr -> link_speed ; if ( ptr -> nodes ) { switch_ptr -> nodes = xstrdup ( ptr -> nodes ) ; if ( _node_name2bitmap ( ptr -> nodes , & switch_ptr -> node_bitmap , & invalid_hl ) ) { fatal ( "Invalid node name (%s) in switch config (%s)" , ptr -> nodes , ptr -> switch_name ) ; } switch_ptr -> node_conn_cnt = _parse_connected_nodes ( switch_ptr ) ; if ( switch_ptr -> node_conn_cnt < 1 ) { error ( "Switch %s does not have any nodes " "connected to it" , switch_ptr -> name ) ; } } if ( ptr -> switches ) { switch_ptr -> switches = xstrdup ( ptr -> switches ) ; } if ( ! ptr -> nodes ) { fatal ( "Switch configuration (%s) lacks children" , ptr -> switch_name ) ; } _update_location_info ( switch_ptr ) ; } _update_switch_connections ( ) ; s_p_hashtbl_destroy ( conf_hashtbl ) ; } 