int get_tfm_chars ( DviParams * params , DviFont * font , TFMInfo * info , int loaded ) { Int32 z , alpha , beta ; int n ; DviFontChar * ch ; TFMChar * ptr ; n = info -> hic - info -> loc + 1 ; if ( n != FONT_GLYPH_COUNT ( font ) ) { font -> chars = mdvi_realloc ( font -> chars , n * sizeof ( DviFontChar ) ) ; } font -> loc = info -> loc ; font -> hic = info -> hic ; ch = font -> chars ; ptr = info -> chars ; TFMPREPARE ( font -> scale , z , alpha , beta ) ; for ( n = info -> loc ; n <= info -> hic ; ch ++ , ptr ++ , n ++ ) { int a , b , c , d ; ch -> offset = ptr -> present ; if ( ch -> offset == 0 ) { continue ; } a = TFMSCALE ( z , ptr -> left , alpha , beta ) ; b = TFMSCALE ( z , ptr -> right , alpha , beta ) ; c = TFMSCALE ( z , ptr -> height , alpha , beta ) ; d = TFMSCALE ( z , ptr -> depth , alpha , beta ) ; ch -> width = XCONV ( b - a ) ; ch -> height = YCONV ( c - d ) ; if ( ch -> height < 0 ) { ch -> height = - ch -> height ; } ch -> x = XCONV ( a ) ; ch -> y = YCONV ( c ) ; ch -> flags = 0 ; ch -> code = n ; ch -> glyph . data = NULL ; ch -> grey . data = NULL ; ch -> shrunk . data = NULL ; ch -> loaded = loaded ; } return 0 ; } 