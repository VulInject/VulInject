static int __init fw_core_init ( void ) { int ret ; fw_workqueue = alloc_workqueue ( "firewire" , WQ_MEM_RECLAIM , 0 ) ; ret = bus_register ( & fw_bus_type ) ; if ( ret < 0 ) { destroy_workqueue ( fw_workqueue ) ; return ret ; } fw_cdev_major = register_chrdev ( 0 , "firewire" , & fw_device_ops ) ; if ( fw_cdev_major < 0 ) { bus_unregister ( & fw_bus_type ) ; destroy_workqueue ( fw_workqueue ) ; return fw_cdev_major ; } fw_core_add_address_handler ( & topology_map , & topology_map_region ) ; fw_core_add_address_handler ( & registers , & registers_region ) ; fw_core_add_address_handler ( & low_memory , & low_memory_region ) ; fw_core_add_descriptor ( & vendor_id_descriptor ) ; fw_core_add_descriptor ( & model_id_descriptor ) ; return 0 ; } 