static int __maybe_unused sundance_suspend ( struct device * dev_d ) { struct net_device * dev = dev_get_drvdata ( dev_d ) ; struct netdev_private * np = netdev_priv ( dev ) ; void __iomem * ioaddr = np -> base ; netdev_close ( dev ) ; netif_device_detach ( dev ) ; if ( np -> wol_enabled ) { iowrite8 ( AcceptBroadcast | AcceptMyPhys , ioaddr + RxMode ) ; iowrite16 ( RxEnable , ioaddr + MACCtrl1 ) ; } device_set_wakeup_enable ( dev_d , np -> wol_enabled ) ; return 0 ; } 