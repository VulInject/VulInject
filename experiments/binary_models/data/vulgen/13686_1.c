static VALUE kdf_pbkdf2_hmac ( int argc , VALUE * argv , VALUE self ) { VALUE pass , salt , opts , kwargs [ 4 ] , str ; static ID kwargs_ids [ 4 ] ; int iters , len ; const EVP_MD * md ; if ( ! kwargs_ids [ 0 ] ) { kwargs_ids [ 0 ] = rb_intern_const ( "salt" ) ; kwargs_ids [ 1 ] = rb_intern_const ( "iterations" ) ; kwargs_ids [ 2 ] = rb_intern_const ( "length" ) ; kwargs_ids [ 3 ] = rb_intern_const ( "hash" ) ; } rb_scan_args ( argc , argv , "1:" , & pass , & opts ) ; rb_get_kwargs ( opts , kwargs_ids , 4 , 0 , kwargs ) ; StringValue ( pass ) ; salt = StringValue ( kwargs [ 0 ] ) ; iters = NUM2INT ( kwargs [ 1 ] ) ; len = NUM2INT ( kwargs [ 2 ] ) ; md = ossl_evp_get_digestbyname ( kwargs [ 3 ] ) ; if ( ! PKCS5_PBKDF2_HMAC ( RSTRING_PTR ( pass ) , RSTRING_LENINT ( pass ) , ( unsigned char * ) RSTRING_PTR ( salt ) , RSTRING_LENINT ( salt ) , iters , md , len , ( unsigned char * ) RSTRING_PTR ( str ) ) ) { ossl_raise ( eKDF , "PKCS5_PBKDF2_HMAC" ) ; } return str ; } 