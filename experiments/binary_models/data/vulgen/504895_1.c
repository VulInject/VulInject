bool SetVariable ( VariableSpace space , const char * name , const char * value ) { struct _variable * current , * previous ; if ( ! space || ! name ) { return false ; } if ( ! valid_variable_name ( name ) ) { pg_log_error ( "invalid variable name: \"%s\"" , name ) ; return false ; } for ( previous = space , current = space -> next ; current ; previous = current , current = current -> next ) { int cmp = strcmp ( current -> name , name ) ; if ( cmp == 0 ) { char * new_value = value ?pg_strdup ( value ) : NULL ; bool confirmed ; if ( current -> substitute_hook ) { new_value = current -> substitute_hook ( new_value ) ; } if ( current -> assign_hook ) { confirmed = current -> assign_hook ( new_value ) ; } else { confirmed = true ; } if ( confirmed ) { pg_free ( current -> value ) ; current -> value = new_value ; if ( new_value == NULL && current -> substitute_hook == NULL && current -> assign_hook == NULL ) { previous -> next = current -> next ; free ( current -> name ) ; free ( current ) ; } } else { pg_free ( new_value ) ; } return confirmed ; } if ( cmp > 0 ) { break ; } } if ( value ) { current = pg_malloc ( sizeof current ) ; current -> name = pg_strdup ( name ) ; current -> value = pg_strdup ( value ) ; current -> substitute_hook = NULL ; current -> assign_hook = NULL ; current -> next = previous -> next ; previous -> next = current ; } return true ; } 