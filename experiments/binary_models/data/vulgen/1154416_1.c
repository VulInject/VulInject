void virtio_gpu_dequeue_cursor_func ( struct work_struct * work ) { struct virtio_gpu_device * vgdev = container_of ( work , virtio_gpu_device , cursorq . dequeue_work ) ; struct list_head reclaim_list ; struct virtio_gpu_vbuffer * entry , * tmp ; INIT_LIST_HEAD ( & reclaim_list ) ; spin_lock ( & vgdev -> cursorq . qlock ) ; { virtqueue_disable_cb ( vgdev -> cursorq . vq ) ; reclaim_vbufs ( vgdev -> cursorq . vq , & reclaim_list ) ; } ! virtqueue_enable_cb ( vgdev -> cursorq . vq ) ; spin_unlock ( & vgdev -> cursorq . qlock ) ; list_for_each_entry_safe ( , , , ) { list_del ( & entry -> list ) ; } wake_up ( & vgdev -> cursorq . ack_queue ) ; } 