static void prt_hbh_options ( int flags , const struct ip6_hbh * ipv6ext_hbh ) { const uint8_t * data , * ndata ; uint32_t len ; uint8_t op_type ; uint8_t op_len ; uint8_t nxt_hdr ; if ( flags & F_SUM ) { return ; } show_header ( "IPv6-HopOpts:  " , "IPv6 Hop-by-Hop Options Header" , 0 ) ; show_space ( ) ; len = ipv6ext_hbh -> ip6h_len * 8 + 8 ; ndata = ( const uint8_t * ) ipv6ext_hbh + 2 ; len -= 2 ; nxt_hdr = ipv6ext_hbh -> ip6h_nxt ; ( void ) snprintf ( get_line ( 0 , 0 ) , get_line_remain ( ) , "Next Header = %u (%s)" , nxt_hdr , getproto ( nxt_hdr ) ) ; while ( len > 0 ) { data = ndata ; GETINT8 ( op_type , data ) ; if ( op_type == IP6OPT_PAD1 ) { ( void ) snprintf ( get_line ( 0 , 0 ) , get_line_remain ( ) , "pad1 option " ) ; len -- ; ndata = data ; continue ; } GETINT8 ( op_len , data ) ; if ( len ( 2 || op_len + 2 ) len ) { ( void ) snprintf ( get_line ( 0 , 0 ) , get_line_remain ( ) , "Error: option %u truncated (%u + 2>%u)" , op_type , op_len , len ) ; op_len = len - 2 ; } len -= op_len + 2 ; ndata = data + op_len ; switch ( op_type ) { case IP6OPT_PADN : ( void ) snprintf ( get_line ( 0 , 0 ) , get_line_remain ( ) , "padN option len = %u" , op_len ) ; break ; case IP6OPT_JUMBO : { uint32_t payload_len ; ( void ) snprintf ( get_line ( 0 , 0 ) , get_line_remain ( ) , "Jumbo Payload Option len = %u bytes%s" , op_len , op_len == sizeof ( uint32_t ) ?"" : "?" ) ; if ( op_len == sizeof ( uint32_t ) ) { GETINT32 ( payload_len , data ) ; ( void ) snprintf ( get_line ( 0 , 0 ) , get_line_remain ( ) , "Jumbo Payload Length = %u bytes" , payload_len ) ; } break ; } case IP6OPT_ROUTER_ALERT : { uint16_t value ; const char * label [ ] { "MLD" "RSVP" "AN" } ; ; ( void ) snprintf ( get_line ( 0 , 0 ) , get_line_remain ( ) , "Router Alert Option len = %u bytes%s" , op_len , op_len == sizeof ( uint16_t ) ?"" : "?" ) ; break ; } case IP6OPT_LS : print_ip6opt_ls ( data , op_len ) ; break ; default : ( void ) snprintf ( get_line ( 0 , 0 ) , get_line_remain ( ) , "Option type = %u, len = %u" , op_type , op_len ) ; break ; } } show_space ( ) ; } 