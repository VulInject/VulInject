static bool __ttm_read_trylock ( struct ttm_lock * lock , bool * locked ) { bool block = true ; * locked = false ; spin_lock ( & lock -> lock ) ; if ( unlikely ( lock -> kill_takers ) ) { spin_unlock ( & lock -> lock ) ; return false ; } if ( lock -> rw >= 0 && lock -> flags == 0 ) { ++ lock -> rw ; block = false ; * locked = true ; } if ( lock -> flags == 0 ) { block = false ; } spin_unlock ( & lock -> lock ) ; return ! block ; } 