void read_file ( const char * fname , void * buf , unsigned long * len ) { ssize_t br ; FILE * io = fopen ( fname , "rb" ) ; if ( ! io ) { fail ( "Can't open '%s' for reading: %s" , fname , strerror ( errno ) ) ; } if ( ferror ( io ) ) { fail ( "Couldn't read '%s': %s" , fname , strerror ( errno ) ) ; } if ( ! feof ( io ) ) { fail ( "Buffer too small to read '%s'" , fname ) ; } fclose ( io ) ; * len = ( unsigned long ) br ; } 