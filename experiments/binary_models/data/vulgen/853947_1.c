static uint32_t __init vmware_platform ( void ) { if ( boot_cpu_has ( X86_FEATURE_HYPERVISOR ) ) { unsigned int eax ; unsigned int hyper_vendor_id [ 3 ] ; cpuid ( CPUID_VMWARE_INFO_LEAF , & eax , & hyper_vendor_id [ 0 ] , & hyper_vendor_id [ 1 ] , & hyper_vendor_id [ 2 ] ) ; if ( ! memcmp ( hyper_vendor_id , "VMwareVMware" , 12 ) ) { return CPUID_VMWARE_INFO_LEAF ; } } return 0 ; } 