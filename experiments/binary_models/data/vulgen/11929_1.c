static unsigned int sun4m_build_device_irq ( struct platform_device * op , unsigned int real_irq ) { struct sun4m_handler_data * handler_data ; unsigned int irq ; unsigned int pil ; if ( real_irq >= OBP_INT_LEVEL_VME ) { prom_printf ( "Bogus sun4m IRQ %u\n" , real_irq ) ; prom_halt ( ) ; } pil = ( real_irq & 0xf ) ; irq = irq_alloc ( real_irq , pil ) ; if ( irq == 0 ) { out } handler_data = irq_get_handler_data ( irq ) ; if ( unlikely ( handler_data ) ) { out } handler_data = kzalloc ( sizeof ( sun4m_handler_data ) , GFP_ATOMIC ) ; if ( unlikely ( ! handler_data ) ) { prom_printf ( "IRQ: kzalloc(sun4m_handler_data) failed.\n" ) ; prom_halt ( ) ; } handler_data -> mask = sun4m_imask [ real_irq ] ; handler_data -> percpu = real_irq < OBP_INT_LEVEL_ONBOARD ; irq_set_chip_and_handler_name ( irq , & sun4m_irq , handle_level_irq , "level" ) ; irq_set_handler_data ( irq , handler_data ) ; out return irq ; } sun4m_timer_percpu { u32 l14_limit ; u32 l14_count ; u32 l14_limit_noclear ; u32 user_timer_start_stop ; } sun4m_timer_global { u32 l10_limit ; u32 l10_count ; u32 l10_limit_noclear ; u32 reserved ; u32 timer_config ; } 