static void inf_chat_session_log_message ( InfChatSession * session , const InfChatBufferMessage * message ) { InfChatSessionPrivate * priv ; struct tm * tm ; gchar * time_str ; const gchar * name ; const gchar * text ; priv = INF_CHAT_SESSION_PRIVATE ( session ) ; if ( priv -> log_file != NULL ) { tm = localtime ( & message -> time ) ; time_str = inf_chat_session_strdup_strftime ( "%c" , tm , NULL ) ; name = inf_user_get_name ( message -> user ) ; text = message -> text ; switch ( message -> type ) { case INF_CHAT_BUFFER_MESSAGE_NORMAL : fprintf ( priv -> log_file , "%s<%s>%s\n" , time_str , name , message -> text ) ; break ; case INF_CHAT_BUFFER_MESSAGE_EMOTE : fprintf ( priv -> log_file , "%s * %s %s\n" , time_str , name , message -> text ) ; break ; case INF_CHAT_BUFFER_MESSAGE_USERJOIN : fprintf ( priv -> log_file , _ ( "%s --- %s has joined\n" ) , time_str , name ) ; break ; case INF_CHAT_BUFFER_MESSAGE_USERPART : fprintf ( priv -> log_file , _ ( "%s --- %s has left\n" ) , time_str , name ) ; break ; default : g_assert_not_reached ( ) ; break ; } fflush ( priv -> log_file ) ; } } 