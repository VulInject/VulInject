static snd_pcm_uframes_t snd_ensoniq_capture_pointer ( struct snd_pcm_substream * substream ) { struct ensoniq * ensoniq = snd_pcm_substream_chip ( substream ) ; spin_lock ( & ensoniq -> reg_lock ) ; if ( inl ( ES_REG ( ensoniq , CONTROL ) ) & ES_ADC_EN ) { outl ( ES_MEM_PAGEO ( ES_PAGE_ADC ) , ES_REG ( ensoniq , MEM_PAGE ) ) ; ptr = ES_REG_FCURR_COUNTI ( inl ( ES_REG ( ensoniq , ADC_SIZE ) ) ) ; ptr = bytes_to_frames ( substream -> runtime , ptr ) ; } else { ptr = 0 ; } spin_unlock ( & ensoniq -> reg_lock ) ; return ptr ; } 