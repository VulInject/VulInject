static int dissect_wsmp_psid ( tvbuff_t * tvb , packet_info * pinfo _U_ , proto_tree * tree , int offset , guint32 * psid ) { guint8 oct ; guint32 psidLen = 0 ; oct = tvb_get_guint8 ( tvb , offset ) ; * psid = 0 ; if ( ( oct & 0xF0 ) == 0xF0 ) { return offset + 1 ; } if ( ( oct & 0xF0 ) == 0xE0 ) { psidLen = 4 ; } if ( ( oct & 0xE0 ) == 0xC0 ) { psidLen = 3 ; } if ( ( oct & 0xC0 ) == 0x80 ) { psidLen = 2 ; } if ( ( oct & 0x80 ) == 0x00 ) { psidLen = 1 ; } if ( psidLen == 1 ) { * psid = oct ; } if ( psidLen == 2 ) { * psid = ( tvb_get_ntohs ( tvb , offset ) & ~ 0x8000 ) + 0x80 ; } if ( psidLen == 3 ) { * psid = ( tvb_get_ntoh24 ( tvb , offset ) & ~ 0xc00000 ) + 0x4080 ; } if ( psidLen == 4 ) { * psid = ( tvb_get_ntohl ( tvb , offset ) & ~ 0xe0000000 ) + 0x204080 ; } proto_tree_add_bits_item ( tree , hf_wsmp_var_len_det , tvb , offset << 3 , psidLen , ENC_NA ) ; proto_tree_add_uint_bits_format_value ( tree , hf_wsmp_psid , tvb , ( offset << 3 ) + psidLen , ( psidLen << 3 ) - psidLen , * psid , ENC_BIG_ENDIAN , "%s(%u)" , val64_to_str_const ( * psid , ieee1609dot2_Psid_vals , "Unknown" ) , * psid ) ; offset += psidLen ; return offset ; } 