void br_port_carrier_check ( struct net_bridge_port * p ) { struct net_device * dev = p -> dev ; struct net_bridge * br = p -> br ; if ( ! ( p -> flags & BR_ADMIN_COST ) && netif_running ( dev ) && netif_oper_up ( dev ) ) { p -> path_cost = port_cost ( dev ) ; } spin_lock_bh ( & br -> lock ) ; if ( netif_running ( dev ) && netif_oper_up ( dev ) ) { if ( p -> state == BR_STATE_DISABLED ) { br_stp_enable_port ( p ) ; } } else { if ( p -> state != BR_STATE_DISABLED ) { br_stp_disable_port ( p ) ; } } spin_unlock_bh ( & br -> lock ) ; } 