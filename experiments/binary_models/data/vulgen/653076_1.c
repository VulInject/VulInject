static gboolean fd_chr_read ( QIOChannel * chan , GIOCondition cond , void * opaque ) { Chardev * chr = CHARDEV ( opaque ) ; FDChardev * s = FD_CHARDEV ( opaque ) ; int len ; uint8_t buf [ CHR_READ_BUF_LEN ] ; ssize_t ret ; len = sizeof ( buf ) ; if ( len > s -> max_size ) { len = s -> max_size ; } if ( len == 0 ) { return TRUE ; } ret = qio_channel_read ( chan , ( gchar * ) buf , len , NULL ) ; if ( ret == 0 ) { remove_fd_in_watch ( chr ) ; qemu_chr_be_event ( chr , CHR_EVENT_CLOSED ) ; return FALSE ; } return TRUE ; } 