static struct ndis_80211_pmkid * get_device_pmkids ( struct usbnet * usbdev ) { struct rndis_wlan_private * priv = get_rndis_wlan_priv ( usbdev ) ; struct ndis_80211_pmkid * pmkids ; int len , ret , max_pmkids ; max_pmkids = priv -> wdev . wiphy -> max_num_pmkids ; len = struct_size ( pmkids , bssid_info , max_pmkids ) ; pmkids = kzalloc ( len , GFP_KERNEL ) ; if ( ! pmkids ) { return ERR_PTR ( - ENOMEM ) ; } pmkids -> length = cpu_to_le32 ( len ) ; pmkids -> bssid_info_count = cpu_to_le32 ( max_pmkids ) ; ret = rndis_query_oid ( usbdev , RNDIS_OID_802_11_PMKID , pmkids , & len ) ; if ( ret < 0 ) { netdev_dbg ( usbdev -> net , "%s(): RNDIS_OID_802_11_PMKID(%d, %d)" " ->%d\n" , __func__ , len , max_pmkids , ret ) ; return ERR_PTR ( ret ) ; } if ( le32_to_cpu ( pmkids -> bssid_info_count ) > max_pmkids ) { pmkids -> bssid_info_count = cpu_to_le32 ( max_pmkids ) ; } debug_print_pmkids ( usbdev , pmkids , __func__ ) ; return pmkids ; } 