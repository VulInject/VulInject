doit ( ) { int i ; int infile = 0 ; struct coff_ofile * head = ( coff_ofile * ) xmalloc ( sizeof ( coff_ofile ) ) ; ofile = head ; head -> source_head = 0 ; head -> source_tail = 0 ; head -> nsources = 0 ; head -> symbol_list_head = 0 ; do_sections_p1 ( head ) ; push_scope ( 1 ) ; for ( i = 0 ; i < rawcount ; ) { struct internal_syment * sym = & rawsyms [ i ] . u . syment ; switch ( sym -> n_sclass ) { case C_FILE : { struct coff_sfile * n = ( coff_sfile * ) xmalloc ( sizeof ( coff_sfile ) ) ; n -> section = ( coff_isection * ) xcalloc ( sizeof ( coff_isection ) , abfd -> section_count + 1 ) ; cur_sfile = n ; n -> name = sym -> _n . _n_nptr [ 1 ] ; n -> next = 0 ; if ( infile ) { pop_scope ( ) ; } infile = 1 ; push_scope ( 1 ) ; file_scope = n -> scope = top_scope ; if ( head -> source_tail ) { head -> source_tail -> next = n ; } else { head -> source_head = n ; } head -> source_tail = n ; head -> nsources ++ ; i += sym -> n_numaux + 1 ; } break ; case C_FCN : { char * name = sym -> _n . _n_nptr [ 1 ] ; if ( name [ 1 ] == 'b' ) { push_scope ( 0 ) ; last_function_type -> u . function . code = top_scope ; top_scope -> sec = ofile -> sections + sym -> n_scnum ; top_scope -> offset = sym -> n_value ; } else { top_scope -> size = sym -> n_value - top_scope -> offset + 1 ; pop_scope ( ) ; } i += sym -> n_numaux + 1 ; } break ; case C_BLOCK : { char * name = sym -> _n . _n_nptr [ 1 ] ; if ( name [ 1 ] == 'b' ) { push_scope ( 1 ) ; top_scope -> sec = ofile -> sections + sym -> n_scnum ; top_scope -> offset = sym -> n_value ; } else { top_scope -> size = sym -> n_value - top_scope -> offset + 1 ; pop_scope ( ) ; } i += sym -> n_numaux + 1 ; } break ; case C_REGPARM : case C_ARG : i = do_define ( i , last_function_symbol -> type -> u . function . parameters ) ; break ; case C_MOS : case C_MOU : case C_FIELD : i = do_define ( i , last_struct -> u . astructdef . elements ) ; break ; case C_MOE : i = do_define ( i , last_enum -> u . aenumdef . elements ) ; break ; case C_STRTAG : case C_ENTAG : case C_UNTAG : i = do_define ( i , top_scope ) ; break ; case C_EXT : case C_LABEL : i = do_define ( i , file_scope ) ; break ; case C_STAT : case C_TPDEF : case C_AUTO : case C_REG : i = do_define ( i , top_scope ) ; break ; default : abort ( ) ; case C_EOS : i += sym -> n_numaux + 1 ; break ; } } do_sections_p2 ( head ) ; return head ; } 