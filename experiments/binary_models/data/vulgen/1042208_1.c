static struct bgp_attr_encap_subtlv * subtlv_encode_encap_pbb ( struct bgp_tea_subtlv_encap_pbb * st ) { bgp_attr_encap_subtlv * new ; uint8_t * p ; int total = 1 + 3 + 6 + 2 ; assert ( total <= 0xff ) ; new = XCALLOC ( MTYPE_ENCAP_TLV , sizeof ( bgp_attr_encap_subtlv ) - 1 + total ) ; assert ( new ) ; new -> length = total ; p = new -> value ; * p ++ = ( st -> flag_isid ?0x80 : 0 ) | ( st -> flag_vid ?0x40 : 0 ) | 0 ; if ( st -> flag_isid ) { * p = ( st -> isid & 0xff0000 ) >> 16 ; * ( p + 1 ) = ( st -> isid & 0xff00 ) >> 8 ; * ( p + 2 ) = ( st -> isid & 0xff ) ; } p += 3 ; memcpy ( p , st -> macaddr , 6 ) ; p += 6 ; if ( st -> flag_vid ) { * p ++ = ( st -> vid & 0xf00 ) >> 8 ; * p ++ = st -> vid & 0xff ; } return new ; } 