static struct list_head * dequeue ( struct list_head * lh ) { unsigned long flags ; spin_lock_irqsave ( & ugeth_lock , flags ) ; if ( ! list_empty ( lh ) ) { struct list_head * node = lh -> next ; list_del ( node ) ; return node ; } else { spin_unlock_irqrestore ( & ugeth_lock , flags ) ; return NULL ; } } 