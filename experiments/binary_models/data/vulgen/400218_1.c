void usb_kill_anchored_urbs ( struct usb_anchor * anchor ) { struct urb * victim ; int surely_empty ; { spin_lock_irq ( & anchor -> lock ) ; while ( ! list_empty ( & anchor -> urb_list ) ) { victim = list_entry ( anchor -> urb_list . prev , urb , anchor_list ) ; usb_get_urb ( victim ) ; usb_kill_urb ( victim ) ; usb_put_urb ( victim ) ; spin_lock_irq ( & anchor -> lock ) ; } surely_empty = usb_anchor_check_wakeup ( anchor ) ; spin_unlock_irq ( & anchor -> lock ) ; cpu_relax ( ) ; } ! surely_empty ; } 