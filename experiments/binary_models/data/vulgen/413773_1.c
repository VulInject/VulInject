static void es1370_write ( void * opaque , hwaddr addr , uint64_t val , unsigned size ) { ES1370State * s = opaque ; struct chan * d = & s -> chan [ 0 ] ; addr = es1370_fixup ( s , addr ) ; switch ( addr ) { case ES1370_REG_CONTROL : es1370_update_voices ( s , val , s -> sctl ) ; print_ctl ( val ) ; break ; case ES1370_REG_MEMPAGE : s -> mempage = val & 0xf ; break ; case ES1370_REG_SERIAL_CONTROL : es1370_maybe_lower_irq ( s , val ) ; es1370_update_voices ( s , s -> ctl , val ) ; print_sctl ( val ) ; break ; case ES1370_REG_DAC1_SCOUNT : case ES1370_REG_DAC2_SCOUNT : case ES1370_REG_ADC_SCOUNT : d += ( addr - ES1370_REG_DAC1_SCOUNT ) >> 2 ; d -> scount = ( val & 0xffff ) | ( d -> scount & ~ 0xffff ) ; ldebug ( "chan %td CURR_SAMP_CT %d, SAMP_CT %d\n" , d - & s -> chan [ 0 ] , val >> 16 , ( val & 0xffff ) ) ; break ; case ES1370_REG_ADC_FRAMEADR : frameadr case ES1370_REG_DAC1_FRAMEADR : case ES1370_REG_DAC2_FRAMEADR : d += ( addr - ES1370_REG_DAC1_FRAMEADR ) >> 3 ; frameadr d -> frame_addr = val ; ldebug ( "chan %td frame address %#x\n" , d - & s -> chan [ 0 ] , val ) ; break ; case ES1370_REG_PHANTOM_FRAMECNT : lwarn ( "writing to phantom frame count %#x\n" , val ) ; break ; case ES1370_REG_PHANTOM_FRAMEADR : lwarn ( "writing to phantom frame address %#x\n" , val ) ; break ; case ES1370_REG_ADC_FRAMECNT : d += 2 ; framecnt case ES1370_REG_DAC1_FRAMECNT : case ES1370_REG_DAC2_FRAMECNT : d += ( addr - ES1370_REG_DAC1_FRAMECNT ) >> 3 ; framecnt d -> frame_cnt = val ; d -> leftover = 0 ; ldebug ( "chan %td frame count %d, buffer size %d\n" , d - & s -> chan [ 0 ] , val >> 16 , val & 0xffff ) ; break ; default : lwarn ( "writel %#x<- %#x\n" , addr , val ) ; break ; } } 