gimp_bucket_fill_tool_start ( , , ) { GimpBucketFillOptions * options = GIMP_BUCKET_FILL_TOOL_GET_OPTIONS ( tool ) ; GimpContext * context = GIMP_CONTEXT ( options ) ; GimpImage * image = gimp_display_get_image ( display ) ; GList * drawables = gimp_image_get_selected_drawables ( image ) ; g_return_if_fail ( ! tool -> priv -> filter ) ; g_return_if_fail ( g_list_length ( drawables ) == 1 ) ; gimp_line_art_freeze ( tool -> priv -> line_art ) ; GIMP_TOOL ( tool ) -> display = display ; g_list_free ( GIMP_TOOL ( tool ) -> drawables ) ; GIMP_TOOL ( tool ) -> drawables = drawables ; gimp_bucket_fill_tool_create_graph ( tool ) ; tool -> priv -> filter = gimp_drawable_filter_new ( drawables -> data , _ ( "Bucket fill" ) , tool -> priv -> graph , GIMP_ICON_TOOL_BUCKET_FILL ) ; gimp_drawable_filter_set_region ( tool -> priv -> filter , GIMP_FILTER_REGION_DRAWABLE ) ; gimp_drawable_filter_set_mode ( tool -> priv -> filter , gimp_context_get_paint_mode ( context ) , GIMP_LAYER_COLOR_SPACE_AUTO , GIMP_LAYER_COLOR_SPACE_AUTO , gimp_layer_mode_get_paint_composite_mode ( gimp_context_get_paint_mode ( context ) ) ) ; gimp_drawable_filter_set_opacity ( tool -> priv -> filter , gimp_context_get_opacity ( context ) ) ; } 