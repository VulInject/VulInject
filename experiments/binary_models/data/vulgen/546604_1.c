static void bfa_rport_sm_online ( struct bfa_rport_s * rp , enum bfa_rport_event event ) { struct bfi_rport_qos_scn_s * qos_scn ; bfa_trc ( rp -> bfa , rp -> rport_tag ) ; bfa_trc ( rp -> bfa , event ) ; switch ( event ) { case BFA_RPORT_SM_OFFLINE : bfa_stats ( rp , sm_on_off ) ; if ( bfa_rport_send_fwdelete ( rp ) ) { bfa_sm_set_state ( rp , bfa_rport_sm_fwdelete ) ; } else { bfa_sm_set_state ( rp , bfa_rport_sm_fwdelete_qfull ) ; } break ; case BFA_RPORT_SM_DELETE : bfa_stats ( rp , sm_on_del ) ; if ( bfa_rport_send_fwdelete ( rp ) ) { bfa_sm_set_state ( rp , bfa_rport_sm_deleting ) ; } else { bfa_sm_set_state ( rp , bfa_rport_sm_deleting_qfull ) ; } break ; case BFA_RPORT_SM_HWFAIL : bfa_stats ( rp , sm_on_hwf ) ; break ; case BFA_RPORT_SM_SET_SPEED : bfa_rport_send_fwspeed ( rp ) ; break ; case BFA_RPORT_SM_QOS_SCN : qos_scn = ( bfi_rport_qos_scn_s * ) rp -> event_arg . fw_msg ; rp -> qos_attr = qos_scn -> new_qos_attr ; bfa_trc ( rp -> bfa , qos_scn -> old_qos_attr . qos_flow_id ) ; bfa_trc ( rp -> bfa , qos_scn -> new_qos_attr . qos_flow_id ) ; bfa_trc ( rp -> bfa , qos_scn -> old_qos_attr . qos_priority ) ; bfa_trc ( rp -> bfa , qos_scn -> new_qos_attr . qos_priority ) ; qos_scn -> old_qos_attr . qos_flow_id = be32_to_cpu ( qos_scn -> old_qos_attr . qos_flow_id ) ; qos_scn -> new_qos_attr . qos_flow_id = be32_to_cpu ( qos_scn -> new_qos_attr . qos_flow_id ) ; if ( qos_scn -> old_qos_attr . qos_flow_id != qos_scn -> new_qos_attr . qos_flow_id ) { bfa_cb_rport_qos_scn_flowid ( rp -> rport_drv , qos_scn -> old_qos_attr , qos_scn -> new_qos_attr ) ; } if ( qos_scn -> old_qos_attr . qos_priority != qos_scn -> new_qos_attr . qos_priority ) { bfa_cb_rport_qos_scn_prio ( rp -> rport_drv , qos_scn -> old_qos_attr , qos_scn -> new_qos_attr ) ; } break ; default : bfa_stats ( rp , sm_on_unexp ) ; bfa_sm_fault ( rp -> bfa , event ) ; } } 