gimp_image_scale_check ( , , , , ) { GList * all_layers ; GList * list ; gint64 current_size ; gint64 undo_size ; gint64 redo_size ; gint64 new_size ; g_return_val_if_fail ( GIMP_IS_IMAGE ( image ) , GIMP_IMAGE_SCALE_TOO_SMALL ) ; g_return_val_if_fail ( new_memsize != NULL , GIMP_IMAGE_SCALE_TOO_SMALL ) ; current_size = gimp_object_get_memsize ( GIMP_OBJECT ( image ) , NULL ) ; new_size = gimp_image_estimate_memsize ( image , gimp_image_get_component_type ( image ) , new_width , new_height ) ; undo_size = gimp_object_get_memsize ( GIMP_OBJECT ( gimp_image_get_undo_stack ( image ) ) , NULL ) ; redo_size = gimp_object_get_memsize ( GIMP_OBJECT ( gimp_image_get_redo_stack ( image ) ) , NULL ) ; current_size -= undo_size + redo_size ; new_size -= undo_size + redo_size ; GIMP_LOG ( IMAGE_SCALE , "old_size = %" G_GINT64_FORMAT "  new_size = %" G_GINT64_FORMAT , current_size , new_size ) ; * new_memsize = new_size ; all_layers = gimp_image_get_layer_list ( image ) ; for ( list = all_layers ; list ; list = g_list_next ( list ) ) { GimpItem * item = list -> data ; if ( gimp_viewable_get_children ( GIMP_VIEWABLE ( item ) ) ) { continue ; } if ( ! gimp_item_check_scaling ( item , new_width , new_height ) ) { g_list_free ( all_layers ) ; return GIMP_IMAGE_SCALE_TOO_SMALL ; } } g_list_free ( all_layers ) ; return GIMP_IMAGE_SCALE_OK ; } 