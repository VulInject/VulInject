void RB_CalcDiffuseColor_altivec ( unsigned char * colors ) { int i ; trRefEntity_t * ent ; vec3_t lightDir ; int numVertexes ; vector unsigned char vSel = VECCONST_UINT8 ( 0x00 , 0x00 , 0x00 , 0xff , 0x00 , 0x00 , 0x00 , 0xff , 0x00 , 0x00 , 0x00 , 0xff , 0x00 , 0x00 , 0x00 , 0xff ) ; vector float ambientLightVec ; vector float directedLightVec ; vector float lightDirVec ; vector float normalVec0 , normalVec1 ; vector float incomingVec0 , incomingVec1 , incomingVec2 ; vector float zero , jVec ; vector signed int jVecInt ; vector signed short jVecShort ; vector unsigned char jVecChar , normalPerm ; ent = backEnd . currentEntity ; jVecChar = vec_lvsl ( 0 , ent -> ambientLight ) ; ambientLightVec = vec_ld ( 0 , ( vector float * ) ent -> ambientLight ) ; jVec = vec_ld ( 11 , ( vector float * ) ent -> ambientLight ) ; ambientLightVec = vec_perm ( ambientLightVec , jVec , jVecChar ) ; jVecChar = vec_lvsl ( 0 , ent -> directedLight ) ; directedLightVec = vec_ld ( 0 , ( vector float * ) ent -> directedLight ) ; jVec = vec_ld ( 11 , ( vector float * ) ent -> directedLight ) ; directedLightVec = vec_perm ( directedLightVec , jVec , jVecChar ) ; jVecChar = vec_lvsl ( 0 , ent -> lightDir ) ; lightDirVec = vec_ld ( 0 , ( vector float * ) ent -> lightDir ) ; jVec = vec_ld ( 11 , ( vector float * ) ent -> lightDir ) ; lightDirVec = vec_perm ( lightDirVec , jVec , jVecChar ) ; zero = ( vector float ) vec_splat_s8 ( 0 ) ; VectorCopy ( ent -> lightDir , lightDir ) ; v = tess . xyz [ 0 ] ; normal = tess . normal [ 0 ] ; normalPerm = vec_lvsl ( 0 , normal ) ; numVertexes = tess . numVertexes ; for ( i = 0 ; i < numVertexes ; i ++ , v += 4 , normal += 4 ) { normalVec0 = vec_ld ( 0 , ( vector float * ) normal ) ; normalVec1 = vec_ld ( 11 , ( vector float * ) normal ) ; normalVec0 = vec_perm ( normalVec0 , normalVec1 , normalPerm ) ; incomingVec0 = vec_madd ( normalVec0 , lightDirVec , zero ) ; incomingVec1 = vec_sld ( incomingVec0 , incomingVec0 , 4 ) ; incomingVec2 = vec_add ( incomingVec0 , incomingVec1 ) ; incomingVec1 = vec_sld ( incomingVec1 , incomingVec1 , 4 ) ; incomingVec2 = vec_add ( incomingVec2 , incomingVec1 ) ; incomingVec0 = vec_splat ( incomingVec2 , 0 ) ; incomingVec0 = vec_max ( incomingVec0 , zero ) ; normalPerm = vec_lvsl ( 12 , normal ) ; jVec = vec_madd ( incomingVec0 , directedLightVec , ambientLightVec ) ; jVecInt = vec_cts ( jVec , 0 ) ; jVecShort = vec_pack ( jVecInt , jVecInt ) ; jVecChar = vec_packsu ( jVecShort , jVecShort ) ; jVecChar = vec_sel ( jVecChar , vSel , vSel ) ; vec_ste ( ( vector unsigned int ) jVecChar , 0 , ( unsigned int * ) & colors [ i * 4 ] ) ; } } 