xge_hal_status_e xge_hal_aux_stats_hal_read ( xge_hal_device_h devh , int bufsize , char * retbuf , int * retsize ) { xge_list_t * item ; xge_hal_channel_t * channel ; xge_hal_device_t * hldev = ( xge_hal_device_t * ) devh ; xge_hal_status_e status ; xge_hal_mgmt_device_stats_t devstat ; xge_hal_mgmt_channel_stats_t chstat ; __HAL_AUX_ENTRY_DECLARE ( bufsize , retbuf ) ; int dest_size ; char * dest_addr ; char key [ XGE_OS_SPRINTF_STRLEN ] ; status = xge_hal_mgmt_device_stats ( hldev , & devstat , sizeof ( xge_hal_mgmt_device_stats_t ) ) ; if ( status != XGE_HAL_OK ) { return status ; } if ( ! hldev -> config . bimodal_interrupts ) { __HAL_AUX_ENTRY ( "rx_traffic_intr_cnt" , devstat . rx_traffic_intr_cnt , "%u" ) ; } __HAL_AUX_ENTRY ( "tx_traffic_intr_cnt" , devstat . tx_traffic_intr_cnt , "%u" ) ; __HAL_AUX_ENTRY ( "txpic_intr_cnt" , devstat . txpic_intr_cnt , "%u" ) ; __HAL_AUX_ENTRY ( "txdma_intr_cnt" , devstat . txdma_intr_cnt , "%u" ) ; __HAL_AUX_ENTRY ( "txmac_intr_cnt" , devstat . txmac_intr_cnt , "%u" ) ; __HAL_AUX_ENTRY ( "txxgxs_intr_cnt" , devstat . txxgxs_intr_cnt , "%u" ) ; __HAL_AUX_ENTRY ( "rxpic_intr_cnt" , devstat . rxpic_intr_cnt , "%u" ) ; __HAL_AUX_ENTRY ( "rxdma_intr_cnt" , devstat . rxdma_intr_cnt , "%u" ) ; __HAL_AUX_ENTRY ( "rxmac_intr_cnt" , devstat . rxmac_intr_cnt , "%u" ) ; __HAL_AUX_ENTRY ( "rxxgxs_intr_cnt" , devstat . rxxgxs_intr_cnt , "%u" ) ; __HAL_AUX_ENTRY ( "mc_intr_cnt" , devstat . mc_intr_cnt , "%u" ) ; __HAL_AUX_ENTRY ( "not_xge_intr_cnt" , devstat . not_xge_intr_cnt , "%u" ) ; __HAL_AUX_ENTRY ( "not_traffic_intr_cnt" , devstat . not_traffic_intr_cnt , "%u" ) ; __HAL_AUX_ENTRY ( "traffic_intr_cnt" , devstat . traffic_intr_cnt , "%u" ) ; __HAL_AUX_ENTRY ( "total_intr_cnt" , devstat . total_intr_cnt , "%u" ) ; __HAL_AUX_ENTRY ( "soft_reset_cnt" , devstat . soft_reset_cnt , "%u" ) ; if ( hldev -> config . rxufca_hi_lim != hldev -> config . rxufca_lo_lim && hldev -> config . rxufca_lo_lim != 0 ) { __HAL_AUX_ENTRY ( "rxufca_lo_adjust_cnt" , devstat . rxufca_lo_adjust_cnt , "%u" ) ; __HAL_AUX_ENTRY ( "rxufca_hi_adjust_cnt" , devstat . rxufca_hi_adjust_cnt , "%u" ) ; } if ( hldev -> config . bimodal_interrupts ) { __HAL_AUX_ENTRY ( "bimodal_lo_adjust_cnt" , devstat . bimodal_lo_adjust_cnt , "%u" ) ; __HAL_AUX_ENTRY ( "bimodal_hi_adjust_cnt" , devstat . bimodal_hi_adjust_cnt , "%u" ) ; } __HAL_AUX_ENTRY ( "tot_frms_lroised" , devstat . tot_frms_lroised , "%u" ) ; __HAL_AUX_ENTRY ( "tot_lro_sessions" , devstat . tot_lro_sessions , "%u" ) ; __HAL_AUX_ENTRY ( "lro_frm_len_exceed_cnt" , devstat . lro_frm_len_exceed_cnt , "%u" ) ; __HAL_AUX_ENTRY ( "lro_sg_exceed_cnt" , devstat . lro_sg_exceed_cnt , "%u" ) ; __HAL_AUX_ENTRY ( "lro_out_of_seq_pkt_cnt" , devstat . lro_out_of_seq_pkt_cnt , "%u" ) ; __HAL_AUX_ENTRY ( "lro_dup_pkt_cnt" , devstat . lro_dup_pkt_cnt , "%u" ) ; xge_list_for_each ( , ) { channel = xge_container_of ( item , xge_hal_channel_t , item ) ; status = xge_hal_mgmt_channel_stats ( channel , & chstat , sizeof ( xge_hal_mgmt_channel_stats_t ) ) ; if ( status != XGE_HAL_OK ) { return status ; } ( void ) xge_os_snprintf ( key , sizeof ( key ) , "ring%d_" , channel -> post_qid ) ; dest_addr = key + strlen ( key ) ; dest_size = sizeof ( key ) - strlen ( key ) ; xge_os_strlcpy ( dest_addr , "full_cnt" , dest_size ) ; __HAL_AUX_ENTRY ( key , chstat . full_cnt , "%u" ) ; xge_os_strlcpy ( dest_addr , "usage_max" , dest_size ) ; __HAL_AUX_ENTRY ( key , chstat . usage_max , "%u" ) ; xge_os_strlcpy ( dest_addr , "usage_cnt" , dest_size ) ; __HAL_AUX_ENTRY ( key , channel -> usage_cnt , "%u" ) ; xge_os_strlcpy ( dest_addr , "reserve_free_swaps_cnt" , dest_size ) ; __HAL_AUX_ENTRY ( key , chstat . reserve_free_swaps_cnt , "%u" ) ; if ( ! hldev -> config . bimodal_interrupts ) { xge_os_strlcpy ( dest_addr , "avg_compl_per_intr_cnt" , dest_size ) ; __HAL_AUX_ENTRY ( key , chstat . avg_compl_per_intr_cnt , "%u" ) ; } xge_os_strlcpy ( dest_addr , "total_compl_cnt" , dest_size ) ; __HAL_AUX_ENTRY ( key , chstat . total_compl_cnt , "%u" ) ; xge_os_strlcpy ( dest_addr , "bump_cnt" , dest_size ) ; __HAL_AUX_ENTRY ( key , chstat . ring_bump_cnt , "%u" ) ; } xge_list_for_each ( , ) { channel = xge_container_of ( item , xge_hal_channel_t , item ) ; status = xge_hal_mgmt_channel_stats ( channel , & chstat , sizeof ( xge_hal_mgmt_channel_stats_t ) ) ; ( void ) xge_os_snprintf ( key , sizeof ( key ) , "fifo%d_" , channel -> post_qid ) ; dest_addr = key + strlen ( key ) ; dest_size = sizeof ( key ) - strlen ( key ) ; xge_os_strlcpy ( dest_addr , "full_cnt" , dest_size ) ; __HAL_AUX_ENTRY ( key , chstat . full_cnt , "%u" ) ; xge_os_strlcpy ( dest_addr , "usage_max" , dest_size ) ; __HAL_AUX_ENTRY ( key , chstat . usage_max , "%u" ) ; xge_os_strlcpy ( dest_addr , "usage_cnt" , dest_size ) ; __HAL_AUX_ENTRY ( key , channel -> usage_cnt , "%u" ) ; xge_os_strlcpy ( dest_addr , "reserve_free_swaps_cnt" , dest_size ) ; __HAL_AUX_ENTRY ( key , chstat . reserve_free_swaps_cnt , "%u" ) ; xge_os_strlcpy ( dest_addr , "avg_compl_per_intr_cnt" , dest_size ) ; __HAL_AUX_ENTRY ( key , chstat . avg_compl_per_intr_cnt , "%u" ) ; xge_os_strlcpy ( dest_addr , "total_compl_cnt" , dest_size ) ; __HAL_AUX_ENTRY ( key , chstat . total_compl_cnt , "%u" ) ; xge_os_strlcpy ( dest_addr , "total_posts" , dest_size ) ; __HAL_AUX_ENTRY ( key , chstat . total_posts , "%u" ) ; xge_os_strlcpy ( dest_addr , "total_posts_many" , dest_size ) ; __HAL_AUX_ENTRY ( key , chstat . total_posts_many , "%u" ) ; xge_os_strlcpy ( dest_addr , "copied_frags" , dest_size ) ; __HAL_AUX_ENTRY ( key , chstat . copied_frags , "%u" ) ; xge_os_strlcpy ( dest_addr , "copied_buffers" , dest_size ) ; __HAL_AUX_ENTRY ( key , chstat . copied_buffers , "%u" ) ; xge_os_strlcpy ( dest_addr , "total_buffers" , dest_size ) ; __HAL_AUX_ENTRY ( key , chstat . total_buffers , "%u" ) ; xge_os_strlcpy ( dest_addr , "avg_buffers_per_post" , dest_size ) ; __HAL_AUX_ENTRY ( key , chstat . avg_buffers_per_post , "%u" ) ; xge_os_strlcpy ( dest_addr , "avg_buffer_size" , dest_size ) ; __HAL_AUX_ENTRY ( key , chstat . avg_buffer_size , "%u" ) ; xge_os_strlcpy ( dest_addr , "avg_post_size" , dest_size ) ; __HAL_AUX_ENTRY ( key , chstat . avg_post_size , "%u" ) ; xge_os_strlcpy ( dest_addr , "total_posts_dtrs_many" , dest_size ) ; __HAL_AUX_ENTRY ( key , chstat . total_posts_dtrs_many , "%u" ) ; xge_os_strlcpy ( dest_addr , "total_posts_frags_many" , dest_size ) ; __HAL_AUX_ENTRY ( key , chstat . total_posts_frags_many , "%u" ) ; xge_os_strlcpy ( dest_addr , "total_posts_dang_dtrs" , dest_size ) ; __HAL_AUX_ENTRY ( key , chstat . total_posts_dang_dtrs , "%u" ) ; xge_os_strlcpy ( dest_addr , "total_posts_dang_frags" , dest_size ) ; __HAL_AUX_ENTRY ( key , chstat . total_posts_dang_frags , "%u" ) ; } __HAL_AUX_ENTRY_END ( bufsize , retsize ) ; return XGE_HAL_OK ; } 