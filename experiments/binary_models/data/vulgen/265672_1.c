static u32 get_allowed_dc_mask ( const struct drm_i915_private * dev_priv , int enable_dc ) { u32 mask ; int requested_dc ; int max_dc ; if ( IS_DG2 ( dev_priv ) ) { max_dc = 1 ; } if ( IS_DG1 ( dev_priv ) ) { max_dc = 3 ; } if ( DISPLAY_VER ( dev_priv ) >= 12 ) { max_dc = 4 ; } if ( IS_GEMINILAKE ( dev_priv ) || IS_BROXTON ( dev_priv ) ) { max_dc = 1 ; } if ( DISPLAY_VER ( dev_priv ) >= 9 ) { max_dc = 2 ; } else { max_dc = 0 ; } mask = IS_GEMINILAKE ( dev_priv ) || IS_BROXTON ( dev_priv ) || DISPLAY_VER ( dev_priv ) >= 11 ?DC_STATE_EN_DC9 : 0 ; if ( ! dev_priv -> params . disable_power_well ) { max_dc = 0 ; } if ( enable_dc >= 0 && enable_dc <= max_dc ) { requested_dc = enable_dc ; } if ( enable_dc == - 1 ) { requested_dc = max_dc ; } if ( enable_dc > max_dc && enable_dc <= 4 ) { drm_dbg_kms ( & dev_priv -> drm , "Adjusting requested max DC state (%d->%d)\n" , enable_dc , max_dc ) ; requested_dc = max_dc ; } else { drm_err ( & dev_priv -> drm , "Unexpected value for enable_dc (%d)\n" , enable_dc ) ; requested_dc = max_dc ; } switch ( requested_dc ) { case 4 : mask |= DC_STATE_EN_DC3CO | DC_STATE_EN_UPTO_DC6 ; break ; case 3 : mask |= DC_STATE_EN_DC3CO | DC_STATE_EN_UPTO_DC5 ; break ; case 2 : mask |= DC_STATE_EN_UPTO_DC6 ; break ; case 1 : mask |= DC_STATE_EN_UPTO_DC5 ; break ; } drm_dbg_kms ( & dev_priv -> drm , "Allowed DC state mask %02x\n" , mask ) ; return mask ; } 