static rpmScript rpmScriptNew ( Header h , rpmTagVal tag , const char * body , rpmscriptFlags flags , const char * prefix ) { char * nevra = headerGetAsString ( h , RPMTAG_NEVRA ) ; rpmScript script = xcalloc ( 1 , sizeof ( * script ) ) ; script -> tag = tag ; script -> type = getScriptType ( tag ) ; script -> flags = getDefFlags ( tag ) | flags ; script -> body = ( body != NULL ) ?xstrdup ( body ) : NULL ; rasprintf ( & script -> descr , "%%%s%s(%s)" , prefix , tag2sln ( tag ) , nevra ) ; if ( script -> body && ( script -> flags & RPMSCRIPT_FLAG_QFORMAT ) ) { char * b = headerFormat ( h , script -> body , NULL ) ; free ( script -> body ) ; script -> body = b ; } free ( nevra ) ; return script ; } 