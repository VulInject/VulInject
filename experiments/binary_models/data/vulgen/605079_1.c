static void bcm_sf2_identify_ports ( struct bcm_sf2_priv * priv , struct device_node * dn ) { struct device * dev = priv -> dev -> ds -> dev ; struct bcm_sf2_port_status * port_st ; struct device_node * port ; unsigned int port_num ; struct property * prop ; int err ; priv -> moca_port = - 1 ; for_each_available_child_of_node ( , ) { if ( port_num >= DSA_MAX_PORTS ) { dev_err ( dev , "Invalid port number %d\n" , port_num ) ; continue ; } port_st = & priv -> port_sts [ port_num ] ; err = of_get_phy_mode ( port , & port_st -> mode ) ; if ( err ) { continue ; } if ( port_st -> mode == PHY_INTERFACE_MODE_INTERNAL ) { priv -> int_phy_mask |= 1 << port_num ; } if ( port_st -> mode == PHY_INTERFACE_MODE_MOCA ) { priv -> moca_port = port_num ; } if ( of_property_read_bool ( port , "brcm,use-bcm-hdr" ) ) { priv -> brcm_tag_mask |= 1 << port_num ; } if ( port_num == 5 && priv -> type == BCM7278_DEVICE_ID ) { prop = of_find_property ( port , "ethernet" , NULL ) ; if ( prop ) { of_remove_property ( port , prop ) ; } } } } 