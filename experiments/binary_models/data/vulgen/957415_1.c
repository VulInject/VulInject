int tomoyo_path_number_perm ( const u8 type , const struct path * path , unsigned long number ) { struct tomoyo_request_info r ; struct tomoyo_obj_info obj = { . path1 = { . mnt = path -> mnt . dentry = path -> dentry } } ; int error = - ENOMEM ; struct tomoyo_path_info buf ; int idx ; if ( tomoyo_init_request_info ( & r , NULL , tomoyo_pn2mac [ type ] ) == TOMOYO_CONFIG_DISABLED ) { return 0 ; } idx = tomoyo_read_lock ( ) ; if ( ! tomoyo_get_realpath ( & buf , path ) ) { out } r . obj = & obj ; if ( type == TOMOYO_TYPE_MKDIR ) { tomoyo_add_slash ( & buf ) ; } r . param_type = TOMOYO_TYPE_PATH_NUMBER_ACL ; r . param . path_number . operation = type ; r . param . path_number . filename = & buf ; r . param . path_number . number = number ; { tomoyo_check_acl ( & r , tomoyo_check_path_number_acl ) ; error = tomoyo_audit_path_number_log ( & r ) ; } error == TOMOYO_RETRY_REQUEST ; kfree ( buf . name ) ; out tomoyo_read_unlock ( idx ) ; return error ; } 