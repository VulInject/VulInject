static void frame_synthesis ( AudioRNNContext * s , DenoiseState * st , float * out , const AVComplexFloat * y ) { LOCAL_ALIGNED_32 ( float , x , [ WINDOW_SIZE ] ) ; const float * src = st -> history ; const float mix = s -> mix ; inverse_transform ( st , x , y ) ; s -> fdsp -> vector_fmul ( x , x , s -> window , WINDOW_SIZE ) ; s -> fdsp -> vector_fmac_scalar ( x , st -> synthesis_mem , 1.f , FRAME_SIZE ) ; RNN_COPY ( out , x , FRAME_SIZE ) ; RNN_COPY ( st -> synthesis_mem , & x [ FRAME_SIZE ] , FRAME_SIZE ) ; for ( int n = 0 ; n < FRAME_SIZE ; n ++ ) { out [ n ] = out [ n ] * mix + src [ n ] * imix ; } } 