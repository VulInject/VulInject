static UINT android_cliprdr_server_format_list ( CliprdrClientContext * cliprdr , const CLIPRDR_FORMAT_LIST * formatList ) { UINT rc ; UINT32 index ; CLIPRDR_FORMAT * format ; androidContext * afc ; if ( ! cliprdr || ! formatList ) { return ERROR_INVALID_PARAMETER ; } afc = ( androidContext * ) cliprdr -> custom ; if ( ! afc ) { return ERROR_INVALID_PARAMETER ; } if ( afc -> serverFormats ) { for ( index = 0 ; index < afc -> numServerFormats ; index ++ ) { free ( afc -> serverFormats [ index ] . formatName ) ; } free ( afc -> serverFormats ) ; afc -> serverFormats = NULL ; afc -> numServerFormats = 0 ; } afc -> numServerFormats = formatList -> numFormats ; afc -> serverFormats = ( CLIPRDR_FORMAT * ) calloc ( afc -> numServerFormats , sizeof ( CLIPRDR_FORMAT ) ) ; if ( ! afc -> serverFormats ) { return CHANNEL_RC_NO_MEMORY ; } for ( index = 0 ; index < afc -> numServerFormats ; index ++ ) { afc -> serverFormats [ index ] . formatId = formatList -> formats [ index ] . formatId ; afc -> serverFormats [ index ] . formatName = NULL ; if ( formatList -> formats [ index ] . formatName ) { afc -> serverFormats [ index ] . formatName = _strdup ( formatList -> formats [ index ] . formatName ) ; if ( ! afc -> serverFormats [ index ] . formatName ) { return CHANNEL_RC_NO_MEMORY ; } } } for ( index = 0 ; index < afc -> numServerFormats ; index ++ ) { format = & ( afc -> serverFormats [ index ] ) ; if ( format -> formatId == CF_UNICODETEXT ) { if ( ( rc = android_cliprdr_send_client_format_data_request ( cliprdr , CF_UNICODETEXT ) ) != CHANNEL_RC_OK ) { return rc ; } break ; } if ( format -> formatId == CF_TEXT ) { if ( ( rc = android_cliprdr_send_client_format_data_request ( cliprdr , CF_TEXT ) ) != CHANNEL_RC_OK ) { return rc ; } break ; } } return CHANNEL_RC_OK ; } 