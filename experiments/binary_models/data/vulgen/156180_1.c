( mantis_dma_exit ) ; static inline int mantis_alloc_buffers ( struct mantis_pci * mantis ) { if ( ! mantis -> buf_cpu ) { mantis -> buf_cpu = pci_alloc_consistent ( mantis -> pdev , MANTIS_BUF_SIZE , & mantis -> buf_dma ) ; if ( ! mantis -> buf_cpu ) { dprintk ( MANTIS_ERROR , 1 , "DMA buffer allocation failed" ) ; err } dprintk ( MANTIS_ERROR , 1 , "DMA=0x%lx cpu=0x%p size=%d" , ( unsigned long ) mantis -> buf_dma , mantis -> buf_cpu , MANTIS_BUF_SIZE ) ; } if ( ! mantis -> risc_cpu ) { mantis -> risc_cpu = pci_alloc_consistent ( mantis -> pdev , MANTIS_RISC_SIZE , & mantis -> risc_dma ) ; if ( ! mantis -> risc_cpu ) { dprintk ( MANTIS_ERROR , 1 , "RISC program allocation failed" ) ; err } dprintk ( MANTIS_ERROR , 1 , "RISC=0x%lx cpu=0x%p size=%lx" , ( unsigned long ) mantis -> risc_dma , mantis -> risc_cpu , MANTIS_RISC_SIZE ) ; } return 0 ; err dprintk ( MANTIS_ERROR , 1 , "Out of memory (?) ....." ) ; return - ENOMEM ; } 