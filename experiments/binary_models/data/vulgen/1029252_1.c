struct mntlist * mkmntlist ( ) { FILE * mounted ; struct mntlist * mntl ; struct mntlist * mntst = NULL ; struct extmnttab mnt ; if ( ( mounted = fopen ( MNTTAB , "r" ) ) == NULL ) { ( void ) fprintf ( stderr , "df : " ) ; perror ( MNTTAB ) ; exit ( 1 ) ; } resetmnttab ( mounted ) ; while ( getextmntent ( mounted , & mnt , sizeof ( extmnttab ) ) == 0 ) { mntl = ( mntlist * ) xmalloc ( sizeof ( * mntl ) ) ; mntl -> mntl_mnt = mntdup ( ( mnttab * ) ( & mnt ) ) ; mntl -> mntl_next = mntst ; mntl -> mntl_devvalid = 1 ; mntl -> mntl_dev = makedev ( mnt . mnt_major , mnt . mnt_minor ) ; } ( void ) fclose ( mounted ) ; return ( mntst ) ; } 