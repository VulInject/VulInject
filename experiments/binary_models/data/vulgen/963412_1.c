PHP_FUNCTION ( ) { zval * imap_conn_obj ; zend_long msgno , flags = 0 ; php_imap_object * imap_conn_struct ; char * body ; unsigned long body_len ; if ( zend_parse_parameters ( ZEND_NUM_ARGS ( ) , "Ol|l" , & imap_conn_obj , php_imap_ce , & msgno , & flags ) == FAILURE ) { RETURN_THROWS ( ) ; } GET_IMAP_STREAM ( imap_conn_struct , imap_conn_obj ) ; PHP_IMAP_CHECK_MSGNO_MAYBE_UID_PRE_FLAG_CHECKS ( msgno , 2 ) ; if ( flags && ( ( flags & ~ ( FT_UID | FT_PEEK | FT_INTERNAL ) ) != 0 ) ) { zend_argument_value_error ( 3 , "must be a bitmask of FT_UID, FT_PEEK, and FT_INTERNAL" ) ; RETURN_THROWS ( ) ; } PHP_IMAP_CHECK_MSGNO_MAYBE_UID_POST_FLAG_CHECKS ( msgno , 2 , flags , FT_UID ) ; body = mail_fetchtext_full ( imap_conn_struct -> imap_stream , msgno , & body_len , flags ) ; if ( body_len == 0 ) { RETVAL_EMPTY_STRING ( ) ; } else { RETVAL_STRINGL ( body , body_len ) ; } } 