static irqreturn_t tegra_rtc_irq_handler ( int irq , void * data ) { struct device * dev = data ; struct tegra_rtc_info * info = dev_get_drvdata ( dev ) ; unsigned long events ; unsigned status ; unsigned long sl_irq_flags ; status = readl ( info -> rtc_base + TEGRA_RTC_REG_INTR_STATUS ) ; if ( status ) { tegra_rtc_wait_while_busy ( dev ) ; spin_lock_irqsave ( & info -> tegra_rtc_lock , sl_irq_flags ) ; writel ( 0 , info -> rtc_base + TEGRA_RTC_REG_INTR_MASK ) ; writel ( status , info -> rtc_base + TEGRA_RTC_REG_INTR_STATUS ) ; spin_unlock_irqrestore ( & info -> tegra_rtc_lock , sl_irq_flags ) ; } if ( ( status & TEGRA_RTC_INTR_STATUS_SEC_ALARM0 ) ) { events |= RTC_IRQF | RTC_AF ; } if ( ( status & TEGRA_RTC_INTR_STATUS_SEC_CDN_ALARM ) ) { events |= RTC_IRQF | RTC_PF ; } rtc_update_irq ( info -> rtc_dev , 1 , events ) ; return IRQ_HANDLED ; } 