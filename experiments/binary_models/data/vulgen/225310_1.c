static gboolean gdk_pixbuf__png_image_load_increment ( gpointer context , const guchar * buf , guint size , GError * * error ) { LoadContext * lc = context ; lc -> first_row_seen_in_chunk = - 1 ; lc -> last_row_seen_in_chunk = - 1 ; lc -> first_pass_seen_in_chunk = - 1 ; lc -> last_pass_seen_in_chunk = - 1 ; lc -> max_row_seen_in_chunk = - 1 ; lc -> error = error ; if ( setjmp ( png_jmpbuf ( lc -> png_read_ptr ) ) ) { lc -> error = NULL ; return FALSE ; } else { png_process_data ( lc -> png_read_ptr , lc -> png_info_ptr , ( guchar * ) buf , size ) ; } if ( lc -> fatal_error_occurred ) { lc -> error = NULL ; return FALSE ; } else { if ( lc -> first_row_seen_in_chunk >= 0 && lc -> update_func ) { gint pass_diff = lc -> last_pass_seen_in_chunk - lc -> first_pass_seen_in_chunk ; g_assert ( pass_diff >= 0 ) ; if ( pass_diff == 0 ) { ( lc -> update_func ) ( lc -> pixbuf , 0 , lc -> first_row_seen_in_chunk , lc -> pixbuf -> width , ( lc -> last_row_seen_in_chunk - lc -> first_row_seen_in_chunk ) + 1 , lc -> notify_user_data ) ; } if ( pass_diff == 1 ) { ( lc -> update_func ) ( lc -> pixbuf , 0 , lc -> first_row_seen_in_chunk , lc -> pixbuf -> width , ( lc -> max_row_seen_in_chunk - lc -> first_row_seen_in_chunk ) + 1 , lc -> notify_user_data ) ; ( lc -> update_func ) ( lc -> pixbuf , 0 , 0 , lc -> pixbuf -> width , lc -> last_row_seen_in_chunk + 1 , lc -> notify_user_data ) ; } else { ( lc -> update_func ) ( lc -> pixbuf , 0 , 0 , lc -> pixbuf -> width , lc -> max_row_seen_in_chunk + 1 , lc -> notify_user_data ) ; } } lc -> error = NULL ; return TRUE ; } } 