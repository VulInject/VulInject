static int wcnss_stop ( struct rproc * rproc ) { struct qcom_wcnss * wcnss = ( qcom_wcnss * ) rproc -> priv ; int ret ; if ( wcnss -> state ) { qcom_smem_state_update_bits ( wcnss -> state , BIT ( wcnss -> stop_bit ) , BIT ( wcnss -> stop_bit ) ) ; if ( ret == 0 ) { dev_err ( wcnss -> dev , "timed out on wait\n" ) ; } qcom_smem_state_update_bits ( wcnss -> state , BIT ( wcnss -> stop_bit ) , 0 ) ; } ret = qcom_scm_pas_shutdown ( WCNSS_PAS_ID ) ; if ( ret ) { dev_err ( wcnss -> dev , "failed to shutdown: %d\n" , ret ) ; } return ret ; } 