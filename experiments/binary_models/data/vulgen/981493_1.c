static void vce_v4_0_mc_resume ( struct amdgpu_device * adev ) { uint32_t offset , size ; uint64_t tmr_mc_addr ; WREG32_P ( SOC15_REG_OFFSET ( VCE , 0 , mmVCE_CLOCK_GATING_A ) , 0 , ~ ( 1 << 16 ) ) ; WREG32_P ( SOC15_REG_OFFSET ( VCE , 0 , mmVCE_UENC_CLOCK_GATING ) , 0x1FF000 , ~ 0xFF9FF000 ) ; WREG32_P ( SOC15_REG_OFFSET ( VCE , 0 , mmVCE_UENC_REG_CLOCK_GATING ) , 0x3F , ~ 0x3F ) ; WREG32 ( SOC15_REG_OFFSET ( VCE , 0 , mmVCE_CLOCK_GATING_B ) , 0x1FF ) ; WREG32 ( SOC15_REG_OFFSET ( VCE , 0 , mmVCE_LMI_CTRL ) , 0x00398000 ) ; WREG32_P ( SOC15_REG_OFFSET ( VCE , 0 , mmVCE_LMI_CACHE_CTRL ) , 0x0 , ~ 0x1 ) ; WREG32 ( SOC15_REG_OFFSET ( VCE , 0 , mmVCE_LMI_SWAP_CNTL ) , 0 ) ; WREG32 ( SOC15_REG_OFFSET ( VCE , 0 , mmVCE_LMI_SWAP_CNTL1 ) , 0 ) ; WREG32 ( SOC15_REG_OFFSET ( VCE , 0 , mmVCE_LMI_VM_CTRL ) , 0 ) ; offset = AMDGPU_VCE_FIRMWARE_OFFSET ; else { WREG32 ( SOC15_REG_OFFSET ( VCE , 0 , mmVCE_LMI_VCPU_CACHE_40BIT_BAR0 ) , ( adev -> vce . gpu_addr >> 8 ) ) ; WREG32 ( SOC15_REG_OFFSET ( VCE , 0 , mmVCE_LMI_VCPU_CACHE_64BIT_BAR0 ) , ( adev -> vce . gpu_addr >> 40 ) & 0xff ) ; WREG32 ( SOC15_REG_OFFSET ( VCE , 0 , mmVCE_VCPU_CACHE_OFFSET0 ) , offset & ~ 0x0f000000 ) ; } size = VCE_V4_0_FW_SIZE ; WREG32 ( SOC15_REG_OFFSET ( VCE , 0 , mmVCE_VCPU_CACHE_SIZE0 ) , size ) ; WREG32 ( SOC15_REG_OFFSET ( VCE , 0 , mmVCE_LMI_VCPU_CACHE_40BIT_BAR1 ) , ( adev -> vce . gpu_addr >> 8 ) ) ; WREG32 ( SOC15_REG_OFFSET ( VCE , 0 , mmVCE_LMI_VCPU_CACHE_64BIT_BAR1 ) , ( adev -> vce . gpu_addr >> 40 ) & 0xff ) ; offset = ( adev -> firmware . load_type != AMDGPU_FW_LOAD_PSP ) ?offset + size : 0 ; size = VCE_V4_0_STACK_SIZE ; WREG32 ( SOC15_REG_OFFSET ( VCE , 0 , mmVCE_VCPU_CACHE_OFFSET1 ) , ( offset & ~ 0x0f000000 ) | ( 1 << 24 ) ) ; WREG32 ( SOC15_REG_OFFSET ( VCE , 0 , mmVCE_VCPU_CACHE_SIZE1 ) , size ) ; WREG32 ( SOC15_REG_OFFSET ( VCE , 0 , mmVCE_LMI_VCPU_CACHE_40BIT_BAR2 ) , ( adev -> vce . gpu_addr >> 8 ) ) ; WREG32 ( SOC15_REG_OFFSET ( VCE , 0 , mmVCE_LMI_VCPU_CACHE_64BIT_BAR2 ) , ( adev -> vce . gpu_addr >> 40 ) & 0xff ) ; offset += size ; size = VCE_V4_0_DATA_SIZE ; WREG32 ( SOC15_REG_OFFSET ( VCE , 0 , mmVCE_VCPU_CACHE_OFFSET2 ) , ( offset & ~ 0x0f000000 ) | ( 2 << 24 ) ) ; WREG32 ( SOC15_REG_OFFSET ( VCE , 0 , mmVCE_VCPU_CACHE_SIZE2 ) , size ) ; WREG32_P ( SOC15_REG_OFFSET ( VCE , 0 , mmVCE_LMI_CTRL2 ) , 0x0 , ~ 0x100 ) ; WREG32_P ( SOC15_REG_OFFSET ( VCE , 0 , mmVCE_SYS_INT_EN ) , VCE_SYS_INT_EN__VCE_SYS_INT_TRAP_INTERRUPT_EN_MASK , ~ VCE_SYS_INT_EN__VCE_SYS_INT_TRAP_INTERRUPT_EN_MASK ) ; } 