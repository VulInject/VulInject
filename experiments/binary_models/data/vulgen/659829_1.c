extern MAILBOXQ * emlxs_mb_get ( emlxs_hba_t * hba ) { MAILBOXQ * p_first = NULL ; mutex_enter ( & EMLXS_MBOX_LOCK ) ; if ( hba -> mbox_queue . q_first ) { p_first = ( MAILBOXQ * ) hba -> mbox_queue . q_first ; hba -> mbox_queue . q_first = ( uint8_t * ) p_first -> next ; if ( hba -> mbox_queue . q_first == NULL ) { hba -> mbox_queue . q_last = NULL ; hba -> mbox_queue . q_cnt = 0 ; } else { hba -> mbox_queue . q_cnt -- ; } } mutex_exit ( & EMLXS_MBOX_LOCK ) ; return ( p_first ) ; } 