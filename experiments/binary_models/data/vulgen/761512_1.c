static PyObject * python_process_brstack ( struct perf_sample * sample , struct thread * thread ) { struct branch_stack * br = sample -> branch_stack ; struct branch_entry * entries = perf_sample__branch_entries ( sample ) ; PyObject * pylist ; u64 i ; pylist = PyList_New ( 0 ) ; if ( ! pylist ) { Py_FatalError ( "couldn't create Python list" ) ; } if ( ! ( br && br -> nr ) ) { exit } for ( i = 0 ; i < br -> nr ; i ++ ) { PyObject * pyelem ; struct addr_location al ; const char * dsoname ; pyelem = PyDict_New ( ) ; pydict_set_item_string_decref ( pyelem , "from" , PyLong_FromUnsignedLongLong ( entries [ i ] . from ) ) ; pydict_set_item_string_decref ( pyelem , "to" , PyLong_FromUnsignedLongLong ( entries [ i ] . to ) ) ; pydict_set_item_string_decref ( pyelem , "mispred" , PyBool_FromLong ( entries [ i ] . flags . mispred ) ) ; pydict_set_item_string_decref ( pyelem , "predicted" , PyBool_FromLong ( entries [ i ] . flags . predicted ) ) ; pydict_set_item_string_decref ( pyelem , "in_tx" , PyBool_FromLong ( entries [ i ] . flags . in_tx ) ) ; pydict_set_item_string_decref ( pyelem , "abort" , PyBool_FromLong ( entries [ i ] . flags . abort ) ) ; pydict_set_item_string_decref ( pyelem , "cycles" , PyLong_FromUnsignedLongLong ( entries [ i ] . flags . cycles ) ) ; thread__find_map_fb ( thread , sample -> cpumode , entries [ i ] . from , & al ) ; dsoname = get_dsoname ( al . map ) ; pydict_set_item_string_decref ( pyelem , "from_dsoname" , _PyUnicode_FromString ( dsoname ) ) ; thread__find_map_fb ( thread , sample -> cpumode , entries [ i ] . to , & al ) ; dsoname = get_dsoname ( al . map ) ; pydict_set_item_string_decref ( pyelem , "to_dsoname" , _PyUnicode_FromString ( dsoname ) ) ; PyList_Append ( pylist , pyelem ) ; Py_DECREF ( pyelem ) ; } exit return pylist ; } 