for ( int i = 0 ; ; i ++ ) { uschar buffer [ 1024 ] ; uschar * p , * ss ; char * readline_line = NULL ; if ( fn_readline ) { if ( ! ( readline_line = fn_readline ( ( i > 0 ) ?"" : ">" ) ) ) { break ; } if ( * readline_line && fn_addhist ) { fn_addhist ( readline_line ) ; } p = US readline_line ; } else { if ( Ufgets ( buffer , sizeof ( buffer ) , stdin ) == NULL ) { break ; } p = buffer ; } had_input = TRUE ; ss = p + Ustrlen ( p ) ; while ( ss > p && isspace ( ss [ - 1 ] ) ) { ss -- ; } if ( i > 0 ) { while ( p < ss && isspace ( * p ) ) { p ++ ; } } g = string_catn ( g , p , ss - p ) ; if ( fn_readline ) { free ( 0 ) ; } if ( ss == p || gstring_last_char ( g ) != '\\' ) { break ; } gstring_trim ( g , 1 ) ; } if ( had_input ) { return g ?string_from_gstring ( g ) : US "" ; } printf ( "\n" ) ; return NULL ; 