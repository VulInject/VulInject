static void davinci_fifo_data_trans ( struct mmc_davinci_host * host , unsigned int n ) { u8 * p ; unsigned int i ; p = host -> buffer ; if ( n > host -> buffer_bytes_left ) { n = host -> buffer_bytes_left ; } host -> buffer_bytes_left -= n ; host -> bytes_left -= n ; if ( host -> data_dir == DAVINCI_MMC_DATADIR_WRITE ) { for ( i = 0 ; i < ( n >> 2 ) ; i ++ ) { writel ( * ( ( u32 * ) p ) , host -> base + DAVINCI_MMCDXR ) ; p = p + 4 ; } if ( n & 3 ) { iowrite8_rep ( host -> base + DAVINCI_MMCDXR , p , ( n & 3 ) ) ; p = p + ( n & 3 ) ; } } else { for ( i = 0 ; i < ( n >> 2 ) ; i ++ ) { * ( ( u32 * ) p ) = readl ( host -> base + DAVINCI_MMCDRR ) ; p = p + 4 ; } if ( n & 3 ) { ioread8_rep ( host -> base + DAVINCI_MMCDRR , p , ( n & 3 ) ) ; p = p + ( n & 3 ) ; } } host -> buffer = p ; } 