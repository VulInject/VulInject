static void update_db_entry ( void ) { TDB_DATA key , dbuf ; int vlen , i ; char * p , * q , * vbuf ; vlen = 0 ; for ( i = 0 ; ( p = script_env [ i ] ) != 0 ; ++ i ) { vlen += strlen ( p ) + 1 ; } vbuf = malloc ( vlen + 1 ) ; if ( vbuf == 0 ) { novm ( "database entry" ) ; } q = vbuf ; for ( i = 0 ; ( p = script_env [ i ] ) != 0 ; ++ i ) { q += slprintf ( q , vbuf + vlen - q , "%s;" , p ) ; } key . dptr = db_key ; key . dsize = strlen ( db_key ) ; dbuf . dptr = vbuf ; dbuf . dsize = vlen ; if ( tdb_store ( pppdb , key , dbuf , TDB_REPLACE ) ) { error ( "tdb_store failed: %s" , tdb_errorstr ( pppdb ) ) ; } if ( vbuf ) { free ( vbuf ) ; } } 