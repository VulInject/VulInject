static s32 bmc150_magn_compensate_z ( struct bmc150_magn_trim_regs * tregs , s16 z , u16 rhall ) { s32 val ; u16 xyz1 = le16_to_cpu ( tregs -> xyz1 ) ; u16 z1 = le16_to_cpu ( tregs -> z1 ) ; s16 z2 = le16_to_cpu ( tregs -> z2 ) ; s16 z3 = le16_to_cpu ( tregs -> z3 ) ; s16 z4 = le16_to_cpu ( tregs -> z4 ) ; val = ( ( ( ( ( s32 ) ( z - z4 ) ) << 15 ) - ( ( ( ( s32 ) z3 ) * ( ( s32 ) ( ( ( s16 ) rhall ) - ( ( s16 ) xyz1 ) ) ) ) >> 2 ) ) / ( z2 + ( ( s16 ) ( ( ( ( ( s32 ) z1 ) * ( ( ( ( s16 ) rhall ) << 1 ) ) ) + ( 1 << 15 ) ) >> 16 ) ) ) ) ; return val ; } 