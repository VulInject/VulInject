void emuxki_voice_delete ( struct emuxki_voice * voice ) { struct emuxki_softc * sc = voice -> sc ; struct emuxki_voice * lvoice ; if ( voice -> state & EMU_VOICE_STATE_STARTED ) { emuxki_voice_halt ( voice ) ; } mtx_enter ( & audio_lock ) ; LIST_REMOVE ( voice , next ) ; lvoice = sc -> lvoice ; sc -> lvoice = voice ; mtx_leave ( & audio_lock ) ; if ( lvoice ) { emuxki_voice_dataloc_destroy ( lvoice ) ; } } 