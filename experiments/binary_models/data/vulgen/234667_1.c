static int sockparams_prt ( uintptr_t addr , uint_t flags , int argc , const mdb_arg_t * argv ) { struct sockparams sp ; char strdev [ MAXPATHLEN ] ; char sockmod [ MODMAXNAMELEN ] ; if ( ( flags & DCMD_ADDRSPEC ) == 0 ) { uint_t opt_e = 0 ; uint_t opt_E = 0 ; if ( mdb_getopts ( argc , argv , 'e' , MDB_OPT_SETBITS , 1 , & opt_e , 'E' , MDB_OPT_SETBITS , 1 , & opt_E , NULL ) != argc ) { return ( DCMD_USAGE ) ; } if ( ! opt_E ) { if ( ! sockparams_walk_list ( "sphead" , argc , argv ) ) { return ( DCMD_ERR ) ; } } if ( opt_e || opt_E ) { if ( ! sockparams_walk_list ( "sp_ephem_list" , argc , argv ) ) { return ( DCMD_ERR ) ; } } return ( DCMD_OK ) ; } if ( ( flags & DCMD_PIPE_OUT ) != 0 ) { mdb_printf ( "%#lr\n" , addr ) ; return ( DCMD_OK ) ; } if ( DCMD_HDRSPEC ( flags ) ) { mdb_printf ( "%-?s %3s %3s %3s %15s %15s %6s %6s\n" , "ADDR" , "FAM" , "TYP" , "PRO" , "STRDEV" , "SOCKMOD" , "REFS" , "FLGS" ) ; } if ( mdb_vread ( & sp , sizeof ( sp ) , addr ) == - 1 ) { mdb_warn ( "failed to read sockparams at %0?p" , addr ) ; return ( DCMD_ERR ) ; } if ( ( sp . sp_sdev_info . sd_devpath == NULL ) || ( mdb_readstr ( strdev , sizeof ( strdev ) , ( uintptr_t ) sp . sp_sdev_info . sd_devpath ) <= 0 ) ) { strcpy ( sockmod , 0 ) ; } if ( mdb_readstr ( sockmod , sizeof ( sockmod ) , ( uintptr_t ) sp . sp_smod_name ) <= 0 ) { strcpy ( sockmod , "" ) ; } mdb_printf ( "%0?p %3u %3u %3u %15s %15s %6u %#6x\n" , addr , sp . sp_family , sp . sp_type , sp . sp_protocol , strdev , sockmod , sp . sp_refcnt , sp . sp_flags ) ; return ( DCMD_OK ) ; } 