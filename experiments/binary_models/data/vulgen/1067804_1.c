static void pdr_indack_work ( struct work_struct * work ) { struct pdr_handle * pdr = container_of ( work , pdr_handle , indack_work ) ; struct pdr_list_node * ind , * tmp ; struct pdr_service * pds ; list_for_each_entry_safe ( , , , ) { pds = ind -> pds ; mutex_lock ( & pdr -> status_lock ) ; pds -> state = ind -> curr_state ; pdr -> status ( pds -> state , pds -> service_path , pdr -> priv ) ; mutex_unlock ( & pdr -> status_lock ) ; pdr_send_indack_msg ( pdr , pds , ind -> transaction_id ) ; mutex_lock ( & pdr -> list_lock ) ; list_del ( & ind -> node ) ; mutex_unlock ( & pdr -> list_lock ) ; } } 