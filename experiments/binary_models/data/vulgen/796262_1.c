zpl_revalidate ( , ) { zfsvfs_t * zfsvfs = dentry -> d_sb -> s_fs_info ; int error ; if ( zfsvfs -> z_issnap ) { if ( time_after ( jiffies , zfsvfs -> z_snap_defer_time + MAX ( zfs_expire_snapshot * HZ / 2 , HZ ) ) ) { zfsvfs -> z_snap_defer_time = jiffies ; zfsctl_snapshot_unmount_delay ( zfsvfs -> z_os -> os_spa , dmu_objset_id ( zfsvfs -> z_os ) , zfs_expire_snapshot ) ; } } if ( dentry -> d_inode == NULL ) { spin_lock ( & dentry -> d_lock ) ; error = time_before ( dentry -> d_time , zfsvfs -> z_rollback_time ) ; spin_unlock ( & dentry -> d_lock ) ; if ( error ) { return ( 0 ) ; } } if ( dentry -> d_inode && ITOZ ( dentry -> d_inode ) -> z_is_stale ) { return ( 0 ) ; } return ( 1 ) ; } const struct inode_operations zpl_inode_operations = { . setattr = zpl_setattr . getattr = zpl_getattr . setxattr = generic_setxattr . getxattr = generic_getxattr . removexattr = generic_removexattr . listxattr = zpl_xattr_list . truncate_range = zpl_truncate_range . fallocate = zpl_fallocate . set_acl = zpl_set_acl . get_acl = zpl_get_acl . check_acl = zpl_check_acl . permission = zpl_permission } ; 