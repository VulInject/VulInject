void pch_gbe_phy_init_setting ( struct pch_gbe_hw * hw ) { struct pch_gbe_adapter * adapter = pch_gbe_hw_to_adapter ( hw ) ; struct ethtool_cmd cmd = { . cmd = ETHTOOL_GSET } ; int ret ; u16 mii_reg ; mii_ethtool_gset ( & adapter -> mii , & cmd ) ; ethtool_cmd_speed_set ( & cmd , hw -> mac . link_speed ) ; cmd . duplex = hw -> mac . link_duplex ; cmd . advertising = hw -> phy . autoneg_advertised ; cmd . autoneg = hw -> mac . autoneg ; pch_gbe_phy_write_reg_miic ( hw , MII_BMCR , BMCR_RESET ) ; ret = mii_ethtool_sset ( & adapter -> mii , & cmd ) ; if ( ret ) { netdev_err ( adapter -> netdev , "Error: mii_ethtool_sset\n" ) ; } pch_gbe_phy_sw_reset ( hw ) ; pch_gbe_phy_read_reg_miic ( hw , PHY_PHYSP_CONTROL , & mii_reg ) ; mii_reg |= PHYSP_CTRL_ASSERT_CRS_TX ; pch_gbe_phy_write_reg_miic ( hw , PHY_PHYSP_CONTROL , mii_reg ) ; } 