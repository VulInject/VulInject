void __init setup_per_cpu_areas ( void ) { struct pcpu_alloc_info * ai ; struct pcpu_group_info * gi ; unsigned int cpu ; ssize_t static_size , reserved_size , dyn_size ; int rc ; ai = pcpu_alloc_alloc_info ( 1 , num_possible_cpus ( ) ) ; if ( ! ai ) { panic ( "failed to allocate pcpu_alloc_info" ) ; } gi = & ai -> groups [ 0 ] ; for_each_possible_cpu ( ) gi -> cpu_map [ gi -> nr_units ++ ] = cpu ; static_size = __per_cpu_end - __per_cpu_start ; reserved_size = PERCPU_MODULE_RESERVE ; dyn_size = PERCPU_PAGE_SIZE - static_size - reserved_size ; ai -> static_size = static_size ; ai -> reserved_size = reserved_size ; ai -> dyn_size = dyn_size ; ai -> unit_size = PERCPU_PAGE_SIZE ; ai -> atom_size = PAGE_SIZE ; ai -> alloc_size = PERCPU_PAGE_SIZE ; rc = pcpu_setup_first_chunk ( ai , __per_cpu_start + __per_cpu_offset [ 0 ] ) ; if ( rc ) { panic ( "failed to setup percpu area (err=%d)" , rc ) ; } pcpu_free_alloc_info ( ai ) ; } 