static int __init mvebu_mbus_common_init ( struct mvebu_mbus_state * mbus , phys_addr_t mbuswins_phys_base , size_t mbuswins_size , phys_addr_t sdramwins_phys_base , size_t sdramwins_size , phys_addr_t mbusbridge_phys_base , size_t mbusbridge_size , bool is_coherent ) { int win ; mbus -> mbuswins_base = ioremap ( mbuswins_phys_base , mbuswins_size ) ; if ( ! mbus -> mbuswins_base ) { return - ENOMEM ; } mbus -> sdramwins_base = ioremap ( sdramwins_phys_base , sdramwins_size ) ; if ( ! mbus -> sdramwins_base ) { iounmap ( mbus_state . mbuswins_base ) ; return - ENOMEM ; } mbus -> sdramwins_phys_base = sdramwins_phys_base ; if ( mbusbridge_phys_base ) { mbus -> mbusbridge_base = ioremap ( mbusbridge_phys_base , mbusbridge_size ) ; if ( ! mbus -> mbusbridge_base ) { iounmap ( mbus -> sdramwins_base ) ; iounmap ( mbus -> mbuswins_base ) ; return - ENOMEM ; } } else { mbus -> mbusbridge_base = NULL ; } for ( win = 0 ; win < mbus -> soc -> num_wins ; win ++ ) { mvebu_mbus_disable_window ( mbus , win ) ; } mbus -> soc -> setup_cpu_target ( mbus ) ; if ( is_coherent ) { writel ( UNIT_SYNC_BARRIER_ALL , mbus -> mbuswins_base + UNIT_SYNC_BARRIER_OFF ) ; } register_syscore_ops ( & mvebu_mbus_syscore_ops ) ; return 0 ; } 