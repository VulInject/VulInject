static void tegra_xudc_plc_reset_work ( struct work_struct * work ) { struct delayed_work * dwork = to_delayed_work ( work ) ; struct tegra_xudc * xudc = container_of ( dwork , tegra_xudc , plc_reset_work ) ; unsigned long flags ; spin_lock_irqsave ( & xudc -> lock , flags ) ; if ( xudc -> wait_csc ) { if ( pls == PORTSC_PLS_INACTIVE ) { dev_info ( xudc -> dev , "PLS = Inactive. Toggle VBUS\n" ) ; phy_set_mode_ext ( xudc -> curr_utmi_phy , PHY_MODE_USB_OTG , USB_ROLE_NONE ) ; phy_set_mode_ext ( xudc -> curr_utmi_phy , PHY_MODE_USB_OTG , USB_ROLE_DEVICE ) ; xudc -> wait_csc = false ; } } spin_unlock_irqrestore ( & xudc -> lock , flags ) ; } 