void mtk_vcodec_enc_set_default_params ( struct mtk_vcodec_ctx * ctx ) { struct mtk_q_data * q_data ; ctx -> m2m_ctx -> q_lock = & ctx -> q_mutex ; ctx -> fh . m2m_ctx = ctx -> m2m_ctx ; ctx -> fh . ctrl_handler = & ctx -> ctrl_hdl ; INIT_WORK ( & ctx -> encode_work , mtk_venc_worker ) ; ctx -> colorspace = V4L2_COLORSPACE_REC709 ; ctx -> ycbcr_enc = V4L2_YCBCR_ENC_DEFAULT ; ctx -> quantization = V4L2_QUANTIZATION_DEFAULT ; ctx -> xfer_func = V4L2_XFER_FUNC_DEFAULT ; q_data = & ctx -> q_data [ MTK_Q_DATA_SRC ] ; memset ( q_data , 0 , sizeof ( mtk_q_data ) ) ; q_data -> visible_width = DFT_CFG_WIDTH ; q_data -> visible_height = DFT_CFG_HEIGHT ; q_data -> coded_width = DFT_CFG_WIDTH ; q_data -> coded_height = DFT_CFG_HEIGHT ; q_data -> field = V4L2_FIELD_NONE ; q_data -> fmt = & ctx -> dev -> venc_pdata -> output_formats [ 0 ] ; v4l_bound_align_image ( & q_data -> coded_width , MTK_VENC_MIN_W , MTK_VENC_HD_MAX_W , 4 , & q_data -> coded_height , MTK_VENC_MIN_H , MTK_VENC_HD_MAX_H , 5 , 6 ) ; if ( q_data -> coded_height < DFT_CFG_HEIGHT && ( q_data -> coded_height + 32 ) <= MTK_VENC_HD_MAX_H ) { q_data -> coded_height += 32 ; } q_data -> sizeimage [ 0 ] = q_data -> coded_width * q_data -> coded_height + ( ( ALIGN ( q_data -> coded_width , 16 ) * 2 ) * 16 ) ; q_data -> bytesperline [ 0 ] = q_data -> coded_width ; q_data -> sizeimage [ 1 ] = ( q_data -> coded_width * q_data -> coded_height ) / 2 + ( ALIGN ( q_data -> coded_width , 16 ) * 16 ) ; q_data -> bytesperline [ 1 ] = q_data -> coded_width ; q_data = & ctx -> q_data [ MTK_Q_DATA_DST ] ; memset ( q_data , 0 , sizeof ( mtk_q_data ) ) ; q_data -> coded_width = DFT_CFG_WIDTH ; q_data -> coded_height = DFT_CFG_HEIGHT ; q_data -> fmt = & ctx -> dev -> venc_pdata -> capture_formats [ 0 ] ; q_data -> field = V4L2_FIELD_NONE ; ctx -> q_data [ MTK_Q_DATA_DST ] . sizeimage [ 0 ] = DFT_CFG_WIDTH * DFT_CFG_HEIGHT ; ctx -> q_data [ MTK_Q_DATA_DST ] . bytesperline [ 0 ] = 0 ; ctx -> enc_params . framerate_num = MTK_DEFAULT_FRAMERATE_NUM ; ctx -> enc_params . framerate_denom = MTK_DEFAULT_FRAMERATE_DENOM ; } 