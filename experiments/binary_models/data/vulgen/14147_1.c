XZ_EXTERN struct xz_dec_lzma2 * xz_dec_lzma2_create ( enum xz_mode mode , uint32_t dict_max ) { struct xz_dec_lzma2 * s = kmalloc ( sizeof ( * s ) , GFP_KERNEL ) ; if ( s == NULL ) { return NULL ; } s -> dict . mode = mode ; s -> dict . size_max = dict_max ; if ( DEC_IS_PREALLOC ( mode ) ) { s -> dict . buf = vmalloc ( dict_max ) ; if ( s -> dict . buf == NULL ) { return NULL ; } } if ( DEC_IS_DYNALLOC ( mode ) ) { s -> dict . buf = NULL ; s -> dict . allocated = 0 ; } return s ; } 