static void protocolinfo_init ( const char * opt_arg , void * userdata _U_ ) { pci_t * rs ; const char * field = NULL ; const char * filter = NULL ; header_field_info * hfi ; GString * error_string ; if ( ! field ) { cmdarg_err ( "invalid \"-z proto,colinfo,<filter>,<field>\" argument" ) ; exit ( 1 ) ; } hfi = proto_registrar_get_byname ( field ) ; if ( ! hfi ) { cmdarg_err ( "Field \"%s\" doesn't exist." , field ) ; exit ( 1 ) ; } rs = g_new ( pci_t , 1 ) ; rs -> hf_index = hfi -> id ; if ( ( field - filter ) > 1 ) { rs -> filter = ( char * ) g_malloc ( field - filter ) ; ( void ) g_strlcpy ( rs -> filter , filter , ( field - filter ) ) ; } else { rs -> filter = NULL ; } error_string = register_tap_listener ( "frame" , rs , rs -> filter , TL_REQUIRES_PROTO_TREE , NULL , protocolinfo_packet , NULL , NULL ) ; if ( error_string ) { cmdarg_err ( "Couldn't register proto,colinfo tap: %s" , error_string -> str ) ; g_string_free ( error_string , TRUE ) ; g_free ( rs -> filter ) ; g_free ( rs ) ; exit ( 1 ) ; } } 