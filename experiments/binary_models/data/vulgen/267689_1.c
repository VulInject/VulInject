static void dissect_q2931_bband_low_layer_info_ie ( tvbuff_t * tvb , int offset , int len , proto_tree * tree ) { guint8 octet ; guint8 uil2_protocol ; guint8 uil3_protocol ; guint8 add_l3_info ; guint32 organization_code ; if ( len == 0 ) { return ; } octet = tvb_get_guint8 ( tvb , offset ) ; if ( ( octet & 0x60 ) == 0x20 ) { proto_tree_add_item ( tree , hf_q2931_bband_low_layer_info_user_info_l1_proto , tvb , offset , 1 , ENC_BIG_ENDIAN ) ; offset += 1 ; len -= 1 ; } if ( len == 0 ) { return ; } octet = tvb_get_guint8 ( tvb , offset ) ; if ( ( octet & 0x60 ) == 0x40 ) { uil2_protocol = octet & 0x1F ; proto_tree_add_item ( tree , hf_q2931_bband_low_layer_info_user_info_l2_proto , tvb , offset , 1 , ENC_BIG_ENDIAN ) ; offset += 1 ; len -= 1 ; if ( octet & Q2931_IE_EXTENSION ) { l2_done } if ( len == 0 ) { return ; } octet = tvb_get_guint8 ( tvb , offset ) ; if ( uil2_protocol == Q2931_UIL2_USER_SPEC ) { proto_tree_add_item ( tree , hf_q2931_bband_low_layer_info_user_specified_l2_proto , tvb , offset , 1 , ENC_BIG_ENDIAN ) ; } else { proto_tree_add_item ( tree , hf_q2931_bband_low_layer_info_mode , tvb , offset , 1 , ENC_BIG_ENDIAN ) ; } offset += 1 ; len -= 1 ; if ( octet & Q2931_IE_EXTENSION ) { l2_done } if ( len == 0 ) { return ; } octet = tvb_get_guint8 ( tvb , offset ) ; proto_tree_add_uint_format_value ( tree , hf_q2931_bband_low_layer_info_window_size , tvb , offset , 1 , octet & 0x7F , "%u k" , octet & 0x7F ) ; offset += 1 ; len -= 1 ; } l2_done if ( len == 0 ) { return ; } octet = tvb_get_guint8 ( tvb , offset ) ; if ( ( octet & 0x60 ) == 0x60 ) { uil3_protocol = octet & 0x1F ; proto_tree_add_item ( tree , hf_q2931_bband_low_layer_info_user_info_l3_proto , tvb , offset , 1 , ENC_BIG_ENDIAN ) ; offset += 1 ; len -= 1 ; if ( octet & Q2931_IE_EXTENSION ) { l3_done } if ( len == 0 ) { return ; } octet = tvb_get_guint8 ( tvb , offset ) ; switch ( uil3_protocol ) { case Q2931_UIL3_X25_PL : case Q2931_UIL3_ISO_8208 : case Q2931_UIL3_X223 : proto_tree_add_item ( tree , hf_q2931_bband_low_layer_info_mode , tvb , offset , 1 , ENC_BIG_ENDIAN ) ; offset += 1 ; len -= 1 ; if ( octet & Q2931_IE_EXTENSION ) { l3_done } if ( len == 0 ) { return ; } octet = tvb_get_guint8 ( tvb , offset ) ; proto_tree_add_item ( tree , hf_q2931_bband_low_layer_info_default_packet_size , tvb , offset , 1 , ENC_BIG_ENDIAN ) ; offset += 1 ; len -= 1 ; if ( octet & Q2931_IE_EXTENSION ) { l3_done } if ( len == 0 ) { return ; } proto_tree_add_item ( tree , hf_q2931_bband_low_layer_info_packet_window_size , tvb , offset , 1 , ENC_BIG_ENDIAN ) ; break ; case Q2931_UIL3_USER_SPEC : proto_tree_add_uint ( tree , hf_q2931_bband_low_layer_info_default_packet_size , tvb , offset , 1 , 1 << ( octet & 0x0F ) ) ; break ; case Q2931_UIL3_TR_9577 : add_l3_info = ( octet & 0x7F ) << 1 ; if ( octet & Q2931_IE_EXTENSION ) { l3_done } if ( len < 2 ) { return ; } add_l3_info |= ( tvb_get_guint8 ( tvb , offset + 1 ) & 0x40 ) >> 6 ; proto_tree_add_uint ( tree , hf_q2931_bband_low_layer_info_additional_l3_proto , tvb , offset , 2 , add_l3_info ) ; offset += 2 ; len -= 2 ; if ( add_l3_info == NLPID_SNAP ) { offset += 1 ; organization_code = tvb_get_ntoh24 ( tvb , offset ) ; proto_tree_add_item ( tree , hf_q2931_organization_code , tvb , offset , 3 , ENC_BIG_ENDIAN ) ; offset += 3 ; switch ( organization_code ) { case OUI_ENCAP_ETHER : proto_tree_add_item ( tree , hf_q2931_ethernet_type , tvb , offset , 2 , ENC_BIG_ENDIAN ) ; break ; case OUI_ATM_FORUM : proto_tree_add_item ( tree , hf_q2931_lane_protocol_id , tvb , offset , 2 , ENC_BIG_ENDIAN ) ; break ; default : proto_tree_add_item ( tree , hf_q2931_protocol_id , tvb , offset , 2 , ENC_BIG_ENDIAN ) ; break ; } } break ; } } l3_done } 