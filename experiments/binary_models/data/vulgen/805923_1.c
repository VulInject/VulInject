void test_tcpbpf_user ( void ) { struct test_tcpbpf_kern * skel ; int cg_fd = - 1 ; skel = test_tcpbpf_kern__open_and_load ( ) ; if ( ! ASSERT_OK_PTR ( skel , "open and load skel" ) ) { return ; } cg_fd = test__join_cgroup ( CG_NAME ) ; if ( ! ASSERT_GE ( cg_fd , 0 , "test__join_cgroup(" CG_NAME ")" ) ) { err } skel -> links . bpf_testcb = bpf_program__attach_cgroup ( skel -> progs . bpf_testcb , cg_fd ) ; if ( ! ASSERT_OK_PTR ( skel -> links . bpf_testcb , "attach_cgroup(bpf_testcb)" ) ) { err } run_test ( & skel -> bss -> global ) ; err if ( cg_fd != - 1 ) { close ( cg_fd ) ; } } 