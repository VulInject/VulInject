u32 sd_read32 ( struct intf_hdl * pintfhdl , u32 addr , s32 * err ) { struct adapter * padapter ; struct dvobj_priv * psdiodev ; struct sdio_data * psdio ; u32 v = 0 ; struct sdio_func * func ; bool claim_needed ; padapter = pintfhdl -> padapter ; psdiodev = pintfhdl -> pintf_dev ; psdio = & psdiodev -> intf_data ; if ( padapter -> bSurpriseRemoved ) { return v ; } func = psdio -> func ; claim_needed = rtw_sdio_claim_host_needed ( func ) ; if ( claim_needed ) { sdio_claim_host ( func ) ; } v = sdio_readl ( func , addr , err ) ; if ( claim_needed ) { sdio_release_host ( func ) ; } if ( err && * err ) { int i ; * err = 0 ; for ( i = 0 ; i < SD_IO_TRY_CNT ; i ++ ) { if ( claim_needed ) { sdio_claim_host ( func ) ; } v = sdio_readl ( func , addr , err ) ; if ( claim_needed ) { sdio_release_host ( func ) ; } if ( * err == 0 ) { rtw_reset_continual_io_error ( psdiodev ) ; break ; } else { if ( rtw_inc_and_chk_continual_io_error ( psdiodev ) == true ) { padapter -> bSurpriseRemoved = true ; break ; } } } } return v ; } 