void get_redis_version ( redisContext * c , int * majorptr , int * minorptr ) { redisReply * reply ; char * eptr , * s , * e ; int major , minor ; reply = redisCommand ( c , "INFO" ) ; if ( reply == NULL || c -> err || reply -> type != REDIS_REPLY_STRING ) { abort } if ( ( s = strstr ( reply -> str , REDIS_VERSION_FIELD ) ) == NULL ) { abort } s += strlen ( REDIS_VERSION_FIELD ) ; if ( ( e = strstr ( s , "\r\n" ) ) == NULL || ( e - s ) < 5 ) { abort } major = strtol ( s , & eptr , 10 ) ; if ( * eptr != '.' ) { abort } minor = strtol ( eptr + 1 , NULL , 10 ) ; if ( majorptr ) { * majorptr = major ; } if ( minorptr ) { * minorptr = minor ; } return ; abort freeReplyObject ( reply ) ; fprintf ( stderr , "Error:  Cannot determine Redis version, aborting\n" ) ; exit ( 1 ) ; } 