static GHashTable * make_args ( const char * agent , const char * action , const char * target , uint32_t target_nodeid , GHashTable * device_args , GHashTable * port_map , const char * host_arg ) { GHashTable * arg_list = NULL ; const char * value = NULL ; CRM_CHECK ( , ) arg_list = pcmk__strkey_table ( free , free ) ; if ( device_args ) { char buffer [ 512 ] ; snprintf ( buffer , sizeof ( buffer ) , "pcmk_%s_action" , action ) ; value = g_hash_table_lookup ( device_args , buffer ) ; if ( value ) { crm_debug ( "Substituting '%s' for fence action %s targeting %s" , value , action , pcmk__s ( target , "no node" ) ) ; action = value ; } } g_hash_table_insert ( arg_list , strdup ( STONITH_ATTR_ACTION_OP ) , strdup ( action ) ) ; if ( ( target != NULL ) && ( device_args != NULL ) ) { const char * param = NULL ; if ( target_nodeid != 0 ) { char * nodeid = crm_strdup_printf ( "%" PRIu32 , target_nodeid ) ; crm_info ( "Passing '%s' as nodeid with fence action '%s' targeting %s" , nodeid , action , pcmk__s ( target , "no node" ) ) ; g_hash_table_insert ( arg_list , strdup ( "nodeid" ) , nodeid ) ; } param = g_hash_table_lookup ( device_args , PCMK_STONITH_HOST_ARGUMENT ) ; if ( ! pcmk__str_eq ( agent , "fence_legacy" , pcmk__str_none ) && ! pcmk__str_eq ( param , PCMK__VALUE_NONE , pcmk__str_casei ) ) { if ( param == NULL ) { param = ( host_arg == NULL ) ?"port" : host_arg ; } value = g_hash_table_lookup ( device_args , param ) ; if ( pcmk__str_eq ( value , "dynamic" , pcmk__str_casei | pcmk__str_null_matches ) ) { const char * alias = NULL ; if ( port_map ) { alias = g_hash_table_lookup ( port_map , target ) ; } if ( alias == NULL ) { alias = target ; } crm_debug ( "Passing %s='%s' with fence action %s targeting %s" , param , alias , action , pcmk__s ( target , "no node" ) ) ; g_hash_table_insert ( arg_list , strdup ( param ) , strdup ( alias ) ) ; } } } if ( device_args ) { g_hash_table_foreach ( device_args , append_config_arg , arg_list ) ; } return arg_list ; } 