static int __init dmi_present ( const u8 * buf ) { u32 smbios_ver ; if ( memcmp ( buf , "_SM_" , 4 ) == 0 && buf [ 5 ] < 32 && dmi_checksum ( buf , buf [ 5 ] ) ) { smbios_ver = get_unaligned_be16 ( buf + 6 ) ; smbios_entry_point_size = buf [ 5 ] ; memcpy ( smbios_entry_point , buf , smbios_entry_point_size ) ; switch ( smbios_ver ) { case 0x021F : case 0x0221 : pr_debug ( "SMBIOS version fixup (2.%d->2.%d)\n" , smbios_ver & 0xFF , 3 ) ; smbios_ver = 0x0203 ; break ; case 0x0233 : pr_debug ( "SMBIOS version fixup (2.%d->2.%d)\n" , 51 , 6 ) ; smbios_ver = 0x0206 ; break ; } } else { smbios_ver = 0 ; } buf += 16 ; if ( memcmp ( buf , "_DMI_" , 5 ) == 0 && dmi_checksum ( buf , 15 ) ) { if ( smbios_ver ) { dmi_ver = smbios_ver ; } else { dmi_ver = ( buf [ 14 ] & 0xF0 ) << 4 | ( buf [ 14 ] & 0x0F ) ; } dmi_ver <<= 8 ; dmi_num = get_unaligned_le16 ( buf + 12 ) ; dmi_len = get_unaligned_le16 ( buf + 6 ) ; if ( dmi_walk_early ( dmi_decode ) == 0 ) { if ( smbios_ver ) { pr_info ( "SMBIOS %d.%d present.\n" , dmi_ver >> 16 , ( dmi_ver >> 8 ) & 0xFF ) ; } else { smbios_entry_point_size = 15 ; memcpy ( smbios_entry_point , buf , smbios_entry_point_size ) ; pr_info ( "Legacy DMI %d.%d present.\n" , dmi_ver >> 16 , ( dmi_ver >> 8 ) & 0xFF ) ; } dmi_format_ids ( dmi_ids_string , sizeof ( dmi_ids_string ) ) ; pr_info ( "DMI: %s\n" , dmi_ids_string ) ; return 0 ; } } return 1 ; } 