static void MPOA_trigger_rcvd ( struct k_message * msg , struct mpoa_client * mpc ) { __be32 dst_ip = msg -> content . in_info . in_dst_ip ; in_cache_entry * entry ; entry = mpc -> in_ops -> get ( dst_ip , mpc ) ; if ( entry == NULL ) { entry = mpc -> in_ops -> add_entry ( dst_ip , mpc ) ; entry -> entry_state = INGRESS_RESOLVING ; msg -> type = SND_MPOA_RES_RQST ; msg -> content . in_info = entry -> ctrl_info ; msg_to_mpoad ( msg , mpc ) ; do_gettimeofday ( & ( entry -> reply_wait ) ) ; return ; } if ( entry -> entry_state == INGRESS_INVALID ) { entry -> entry_state = INGRESS_RESOLVING ; msg -> type = SND_MPOA_RES_RQST ; msg -> content . in_info = entry -> ctrl_info ; msg_to_mpoad ( msg , mpc ) ; do_gettimeofday ( & ( entry -> reply_wait ) ) ; mpc -> in_ops -> put ( entry ) ; return ; } pr_info ( "(%s) entry already in resolving state\n" , ( mpc -> dev ) ?mpc -> dev -> name : "<unknown>" ) ; mpc -> in_ops -> put ( entry ) ; } 