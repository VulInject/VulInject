jinit_c_main_controller ( , ) { my_main_ptr main_ptr ; int ci ; jpeg_component_info * compptr ; main_ptr = ( my_main_ptr ) * cinfo -> mem -> alloc_small ( ( j_common_ptr ) cinfo , JPOOL_IMAGE , SIZEOF ( my_main_controller ) ) ; cinfo -> main = ( jpeg_c_main_controller * ) main_ptr ; main_ptr -> pub . start_pass = start_pass_main ; if ( cinfo -> raw_data_in ) { return ; } if ( need_full_buffer ) { for ( ci = 0 , compptr = cinfo -> comp_info ; ci < cinfo -> num_components ; ci ++ , compptr ++ ) { main_ptr -> whole_image [ ci ] = * cinfo -> mem -> request_virt_sarray ( ( j_common_ptr ) cinfo , JPOOL_IMAGE , FALSE , compptr -> width_in_blocks * compptr -> DCT_h_scaled_size , ( JDIMENSION ) jround_up ( ( long ) compptr -> height_in_blocks , ( long ) compptr -> v_samp_factor ) * DCTSIZE , ( JDIMENSION ) ( compptr -> v_samp_factor * compptr -> DCT_v_scaled_size ) ) ; } } else { main_ptr -> whole_image [ 0 ] = NULL ; for ( ci = 0 , compptr = cinfo -> comp_info ; ci < cinfo -> num_components ; ci ++ , compptr ++ ) { main_ptr -> buffer [ ci ] = * cinfo -> mem -> alloc_sarray ( ( j_common_ptr ) cinfo , JPOOL_IMAGE , compptr -> width_in_blocks * compptr -> DCT_h_scaled_size , ( JDIMENSION ) ( compptr -> v_samp_factor * compptr -> DCT_v_scaled_size ) ) ; } } } 