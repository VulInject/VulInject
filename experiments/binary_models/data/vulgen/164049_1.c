static int saa711x_g_sliced_fmt ( struct v4l2_subdev * sd , struct v4l2_sliced_vbi_format * sliced ) { static u16 lcr2vbi [ ] { 0 V4L2_SLICED_TELETEXT_B 0 0 V4L2_SLICED_CAPTION_525 V4L2_SLICED_WSS_625 0 V4L2_SLICED_VPS 0 0 0 0 0 0 0 0 } ; ; int i ; sliced -> service_set = 0 ; if ( saa711x_read ( sd , R_80_GLOBAL_CNTL_1 ) & 0x10 ) { return 0 ; } for ( i = 2 ; i <= 23 ; i ++ ) { u8 v = saa711x_read ( sd , i - 2 + R_41_LCR_BASE ) ; sliced -> service_lines [ 0 ] [ i ] = lcr2vbi [ v >> 4 ] ; sliced -> service_lines [ 1 ] [ i ] = lcr2vbi [ v & 0xf ] ; sliced -> service_set |= sliced -> service_lines [ 0 ] [ i ] | sliced -> service_lines [ 1 ] [ i ] ; } return 0 ; } 