VipsPel * vips__vector_to_pels ( const char * domain , int bands , VipsBandFormat format , VipsCoding coding , double * real , double * imag , int n ) { VipsImage * context = vips_image_new ( ) ; VipsImage * * t = ( VipsImage * * ) vips_object_local_array ( VIPS_OBJECT ( context ) , 8 ) ; VipsImage * in ; double * ones ; VipsPel * result ; int i ; printf ( "vips__vector_to_pels: starting\n" ) ; ones = VIPS_ARRAY ( context , n , double ) ; for ( i = 0 ; i < n ; i ++ ) { ones [ i ] = 1.0 ; } if ( vips_black ( & t [ 0 ] , 1 , 1 , "bands" , bands , NULL ) || vips_linear ( t [ 0 ] , & t [ 1 ] , ones , real , n , NULL ) ) { g_object_unref ( context ) ; return ( NULL ) ; } in = t [ 1 ] ; if ( imag ) { in = t [ 4 ] ; } if ( vips_cast ( in , & t [ 5 ] , format , NULL ) || vips_image_encode ( t [ 5 ] , & t [ 6 ] , coding ) ) { g_object_unref ( context ) ; return ( NULL ) ; } in = t [ 6 ] ; if ( ! ( t [ 7 ] = vips_image_new_memory ( ) ) || vips_image_write ( in , t [ 7 ] ) ) { g_object_unref ( context ) ; return ( NULL ) ; } in = t [ 7 ] ; if ( ! ( result = VIPS_ARRAY ( NULL , VIPS_IMAGE_SIZEOF_PEL ( in ) , VipsPel ) ) ) { g_object_unref ( context ) ; return ( NULL ) ; } memcpy ( result , in -> data , VIPS_IMAGE_SIZEOF_PEL ( in ) ) ; { int i ; printf ( "vips__vector_to_ink:\n" ) ; printf ( "\t(real, imag) = " ) ; for ( i = 0 ; i < n ; i ++ ) { printf ( "(%g, %g) " , real [ i ] , imag ?imag [ i ] : 0 ) ; } printf ( "\n" ) ; printf ( "\tink = " ) ; for ( i = 0 ; i < VIPS_IMAGE_SIZEOF_PEL ( in ) ; i ++ ) { printf ( "%d " , result [ i ] ) ; } printf ( "\n" ) ; } } 