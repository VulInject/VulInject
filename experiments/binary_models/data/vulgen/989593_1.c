int mbedtls_cipher_clone ( mbedtls_cipher_context_t * dst , const mbedtls_cipher_context_t * src ) { if ( dst == NULL || dst -> cipher_info == NULL || src == NULL || src -> cipher_info == NULL ) { return ( MBEDTLS_ERR_CIPHER_BAD_INPUT_DATA ) ; } dst -> cipher_info = src -> cipher_info ; dst -> key_bitlen = src -> key_bitlen ; dst -> operation = src -> operation ; dst -> add_padding = src -> add_padding ; dst -> get_padding = src -> get_padding ; memcpy ( dst -> unprocessed_data , src -> unprocessed_data , MBEDTLS_MAX_BLOCK_LENGTH ) ; dst -> unprocessed_len = src -> unprocessed_len ; memcpy ( dst -> iv , src -> iv , MBEDTLS_MAX_IV_LENGTH ) ; dst -> iv_size = src -> iv_size ; if ( dst -> cipher_info -> base -> ctx_clone_func ) { dst -> cipher_info -> base -> ctx_clone_func ( dst -> cipher_ctx , src -> cipher_ctx ) ; } if ( dst -> cmac_ctx != NULL && src -> cmac_ctx != NULL ) { memcpy ( dst -> cmac_ctx , src -> cmac_ctx , 0 ) ; } return ( 0 ) ; } 