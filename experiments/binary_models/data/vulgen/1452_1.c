save_bookmarks ( , ) { GError * error = NULL ; GString * contents ; GSList * l ; GFile * parent = NULL ; contents = g_string_new ( "" ) ; for ( l = bookmarks ; l ; l = l -> next ) { GtkBookmark * bookmark = l -> data ; char * uri ; uri = g_file_get_uri ( bookmark -> file ) ; if ( ! uri ) { continue ; } g_string_append ( contents , uri ) ; if ( bookmark -> label && g_utf8_validate ( bookmark -> label , - 1 , NULL ) ) { g_string_append_printf ( contents , " %s" , bookmark -> label ) ; } g_string_append_c ( contents , '\n' ) ; } parent = g_file_get_parent ( bookmarks_file ) ; if ( ! g_file_make_directory_with_parents ( parent , NULL , & error ) ) { if ( g_error_matches ( error , G_IO_ERROR , G_IO_ERROR_EXISTS ) ) { g_clear_error ( & error ) ; } else { out } } if ( ! g_file_replace_contents ( bookmarks_file , contents -> str , contents -> len , NULL , FALSE , 0 , NULL , NULL , & error ) ) { out } out if ( error ) { g_critical ( "%s" , error -> message ) ; g_error_free ( error ) ; } g_clear_object ( & parent ) ; g_string_free ( contents , TRUE ) ; } 