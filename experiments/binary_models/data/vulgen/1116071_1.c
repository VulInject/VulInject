GF_Scene * gf_scene_new ( GF_Compositor * compositor , GF_Scene * parentScene ) { GF_Scene * tmp ; if ( ! compositor && ! parentScene ) { return NULL ; } GF_SAFEALLOC ( tmp , GF_Scene ) ; if ( ! tmp ) { return NULL ; } tmp -> resources = gf_list_new ( ) ; tmp -> scene_objects = gf_list_new ( ) ; tmp -> extra_scenes = gf_list_new ( ) ; tmp -> declared_addons = gf_list_new ( ) ; if ( parentScene ) { tmp -> graph = gf_sg_new_subscene ( parentScene -> graph ) ; assert ( ! compositor || ( compositor == parentScene -> compositor ) ) ; tmp -> compositor = parentScene -> compositor ; } else { tmp -> graph = gf_sg_new ( ) ; tmp -> compositor = compositor ; tmp -> namespaces = gf_list_new ( ) ; } gf_sg_set_private ( tmp -> graph , tmp ) ; gf_sg_set_node_callback ( tmp -> graph , gf_scene_node_callback ) ; gf_sg_set_scene_time_callback ( tmp -> graph , gf_scene_get_time ) ; if ( tmp -> compositor && ! tmp -> compositor -> nojs ) { gf_sg_set_script_action ( tmp -> graph , gf_scene_script_action , tmp ) ; } if ( parentScene ) { tmp -> first_frame_pause_type = parentScene -> first_frame_pause_type ; } tmp -> extern_protos = gf_list_new ( ) ; gf_sg_set_proto_loader ( tmp -> graph , gf_inline_get_proto_lib ) ; tmp -> storages = gf_list_new ( ) ; tmp -> keynavigators = gf_list_new ( ) ; tmp -> on_media_event = inline_on_media_event ; return tmp ; } 