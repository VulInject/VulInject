static void zone_free ( zone_t * zone ) { ASSERT ( zone != global_zone ) ; ASSERT ( zone -> zone_ntasks == 0 ) ; ASSERT ( zone -> zone_nlwps == 0 ) ; ASSERT ( zone -> zone_nprocs == 0 ) ; ASSERT ( zone -> zone_cred_ref == 0 ) ; ASSERT ( zone -> zone_kcred == NULL ) ; ASSERT ( zone_status_get ( zone ) == ZONE_IS_DEAD || zone_status_get ( zone ) == ZONE_IS_UNINITIALIZED ) ; ASSERT ( list_is_empty ( & zone -> zone_ref_list ) ) ; cpucaps_zone_remove ( zone ) ; ASSERT ( zone -> zone_cpucap == NULL ) ; if ( zone_status_get ( zone ) == ZONE_IS_DEAD ) { ASSERT ( zone -> zone_ref == 0 ) ; mutex_enter ( & zone_deathrow_lock ) ; list_remove ( & zone_deathrow , zone ) ; mutex_exit ( & zone_deathrow_lock ) ; } list_destroy ( & zone -> zone_ref_list ) ; zone_free_zsd ( zone ) ; zone_free_datasets ( zone ) ; list_destroy ( & zone -> zone_dl_list ) ; cpu_uarray_free ( zone -> zone_ustate ) ; if ( zone -> zone_rootvp != NULL ) { VN_RELE ( zone -> zone_rootvp ) ; } if ( zone -> zone_rootpath ) { kmem_free ( zone -> zone_rootpath , zone -> zone_rootpathlen ) ; } if ( zone -> zone_name != NULL ) { kmem_free ( zone -> zone_name , ZONENAME_MAX ) ; } if ( zone -> zone_nodename != NULL ) { kmem_free ( zone -> zone_nodename , _SYS_NMLN ) ; } if ( zone -> zone_domain != NULL ) { kmem_free ( zone -> zone_domain , _SYS_NMLN ) ; } if ( zone -> zone_privset != NULL ) { kmem_free ( zone -> zone_privset , sizeof ( priv_set_t ) ) ; } if ( zone -> zone_rctls != NULL ) { rctl_set_free ( zone -> zone_rctls ) ; } if ( zone -> zone_bootargs != NULL ) { strfree ( zone -> zone_bootargs ) ; } if ( zone -> zone_initname != NULL ) { strfree ( zone -> zone_initname ) ; } if ( zone -> zone_fs_allowed != NULL ) { strfree ( zone -> zone_fs_allowed ) ; } if ( zone -> zone_pfexecd != NULL ) { klpd_freelist ( & zone -> zone_pfexecd ) ; } id_free ( zoneid_space , zone -> zone_id ) ; mutex_destroy ( & zone -> zone_lock ) ; cv_destroy ( & zone -> zone_cv ) ; rw_destroy ( & zone -> zone_mlps . mlpl_rwlock ) ; rw_destroy ( & zone -> zone_mntfs_db_lock ) ; kmem_free ( zone , sizeof ( zone_t ) ) ; } 