R_API int r_cons_win_vhprintf ( DWORD hdl , bool vmode , const char * fmt , va_list ap ) { va_list ap2 ; int ret = - 1 ; FILE * con = hdl == STD_OUTPUT_HANDLE ?stdout : stderr ; if ( ! strchr ( fmt , '%' ) ) { size_t len = strlen ( fmt ) ; if ( I -> vtmode ) { return fwrite ( fmt , 1 , len , con ) ; } return r_cons_w32_hprint ( hdl , fmt , len , vmode ) ; } va_copy ( ap2 , ap ) ; int num_chars = vsnprintf ( NULL , 0 , fmt , ap2 ) ; num_chars ++ ; if ( buf ) { ( void ) vsnprintf ( buf , num_chars , fmt , ap ) ; if ( I -> vtmode ) { ret = fwrite ( buf , 1 , num_chars - 1 , con ) ; } else { ret = r_cons_w32_hprint ( hdl , buf , num_chars - 1 , vmode ) ; } free ( buf ) ; } va_end ( ap2 ) ; return ret ; } 