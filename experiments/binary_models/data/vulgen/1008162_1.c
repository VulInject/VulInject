static void mtk_image_set_gen_header ( void * ptr , off_t filesize , uint32_t loadaddr ) { struct gen_device_header * hdr = ( gen_device_header * ) ptr ; struct gfh_header * gfh ; const char * bootname = NULL ; if ( hdr_media == BRLYT_TYPE_NOR ) { bootname = SF_BOOT_NAME ; } if ( hdr_media == BRLYT_TYPE_EMMC ) { bootname = EMMC_BOOT_NAME ; } snprintf ( hdr -> boot . name , sizeof ( hdr -> boot . name ) , "%s" , bootname ) ; hdr -> boot . version = cpu_to_le32 ( 1 ) ; hdr -> boot . size = cpu_to_le32 ( sizeof ( hdr -> boot ) ) ; put_brom_layout_header ( & hdr -> brlyt , hdr_media ) ; hdr -> brlyt . header_size = cpu_to_le32 ( hdr_offset + sizeof ( * hdr ) ) ; hdr -> brlyt . total_size = cpu_to_le32 ( hdr_offset + filesize ) ; hdr -> brlyt . header_size_2 = hdr -> brlyt . header_size ; hdr -> brlyt . total_size_2 = hdr -> brlyt . total_size ; gfh = ( gfh_header * ) ( ptr + sizeof ( gen_device_header ) ) ; put_ghf_header ( gfh , filesize , sizeof ( gen_device_header ) , loadaddr , GFH_FLASH_TYPE_GEN ) ; put_hash ( ( uint8_t * ) gfh , filesize - sizeof ( gen_device_header ) - SHA256_SUM_LEN ) ; } 