static p4d_t * pti_user_pagetable_walk_p4d ( unsigned long address ) { pgd_t * pgd = kernel_to_user_pgdp ( pgd_offset_k ( address ) ) ; gfp_t gfp = ( GFP_KERNEL | __GFP_NOTRACK | __GFP_ZERO ) ; if ( address < PAGE_OFFSET ) { WARN_ONCE ( 1 , "attempt to walk user address\n" ) ; return NULL ; } if ( pgd_none ( * pgd ) ) { unsigned long new_p4d_page = __get_free_page ( gfp ) ; if ( WARN_ON_ONCE ( ! new_p4d_page ) ) { return NULL ; } set_pgd ( pgd , __pgd ( _KERNPG_TABLE | __pa ( new_p4d_page ) ) ) ; } return p4d_offset ( pgd , address ) ; } 