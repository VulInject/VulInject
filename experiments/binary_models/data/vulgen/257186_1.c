static void scan_res ( image_dict * idict , uint64_t epos_s ) { hdr_struct hdr ; uint64_t spos , epos ; epos = xftell ( img_file ( idict ) , img_filepath ( idict ) ) ; while ( 1 ) { spos = epos ; hdr = read_boxhdr ( idict ) ; epos = spos + hdr . lbox ; switch ( hdr . tbox ) { case ( BOX_RESC ) : if ( img_xres ( idict ) == 0 && img_yres ( idict ) == 0 ) { scan_resc_resd ( idict ) ; if ( xftell ( img_file ( idict ) , img_filepath ( idict ) ) != ( long ) epos ) { normal_error ( "readjp2" , "resc box size inconsistent" ) ; } } break ; case ( BOX_RESD ) : scan_resc_resd ( idict ) ; if ( xftell ( img_file ( idict ) , img_filepath ( idict ) ) != ( long ) epos ) { normal_error ( "readjp2" , "resd box size inconsistent" ) ; } break ; default : } if ( epos > epos_s ) { normal_error ( "readjp2" , "res box size inconsistent" ) ; } xfseek ( img_file ( idict ) , ( long ) epos , SEEK_SET , img_filepath ( idict ) ) ; } } 