vect_create_addr_base_for_vector_ref ( , , ) { stmt_vec_info stmt_info = vinfo_for_stmt ( stmt ) ; struct data_reference * dr = STMT_VINFO_DATA_REF ( stmt_info ) ; tree data_ref_base = unshare_expr ( DR_BASE_ADDRESS ( dr ) ) ; tree base_name = build_fold_indirect_ref ( data_ref_base ) ; tree ref = DR_REF ( dr ) ; tree scalar_type = TREE_TYPE ( ref ) ; tree scalar_ptr_type = build_pointer_type ( scalar_type ) ; tree vec_stmt ; tree new_temp ; tree addr_base , addr_expr ; tree dest , new_stmt ; tree base_offset = unshare_expr ( DR_OFFSET ( dr ) ) ; tree init = unshare_expr ( DR_INIT ( dr ) ) ; base_offset = size_binop ( PLUS_EXPR , base_offset , init ) ; dest = create_tmp_var ( TREE_TYPE ( base_offset ) , "base_off" ) ; add_referenced_var ( dest ) ; base_offset = force_gimple_operand ( base_offset , & new_stmt , false , dest ) ; append_to_statement_list_force ( new_stmt , new_stmt_list ) ; if ( offset ) { tree tmp = create_tmp_var ( TREE_TYPE ( base_offset ) , "offset" ) ; add_referenced_var ( tmp ) ; offset = fold_build2 ( MULT_EXPR , TREE_TYPE ( offset ) , offset , DR_STEP ( dr ) ) ; base_offset = fold_build2 ( PLUS_EXPR , TREE_TYPE ( base_offset ) , base_offset , offset ) ; base_offset = force_gimple_operand ( base_offset , & new_stmt , false , tmp ) ; append_to_statement_list_force ( new_stmt , new_stmt_list ) ; } addr_base = fold_build2 ( PLUS_EXPR , TREE_TYPE ( data_ref_base ) , data_ref_base , base_offset ) ; addr_expr = vect_get_new_vect_var ( scalar_ptr_type , vect_pointer_var , get_name ( base_name ) ) ; add_referenced_var ( addr_expr ) ; vec_stmt = build2 ( MODIFY_EXPR , void_type_node , addr_expr , addr_base ) ; new_temp = make_ssa_name ( addr_expr , vec_stmt ) ; TREE_OPERAND ( vec_stmt , 0 ) = new_temp ; append_to_statement_list_force ( vec_stmt , new_stmt_list ) ; return new_temp ; } 