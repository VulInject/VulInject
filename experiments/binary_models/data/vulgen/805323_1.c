static struct cxl_port * __devm_cxl_add_port ( struct device * host , struct device * uport , resource_size_t component_reg_phys , struct cxl_dport * parent_dport ) { struct cxl_port * port ; struct device * dev ; int rc ; port = cxl_port_alloc ( uport , component_reg_phys , parent_dport ) ; if ( IS_ERR ( port ) ) { return port ; } dev = & port -> dev ; if ( is_cxl_memdev ( uport ) ) { rc = dev_set_name ( dev , "endpoint%d" , port -> id ) ; } if ( parent_dport ) { rc = dev_set_name ( dev , "port%d" , port -> id ) ; } else { rc = dev_set_name ( dev , "root%d" , port -> id ) ; } if ( rc ) { err } rc = device_add ( dev ) ; if ( rc ) { err } rc = devm_add_action_or_reset ( host , unregister_port , port ) ; if ( rc ) { return ERR_PTR ( rc ) ; } rc = devm_cxl_link_uport ( host , port ) ; if ( rc ) { return ERR_PTR ( rc ) ; } rc = devm_cxl_link_parent_dport ( host , port , parent_dport ) ; if ( rc ) { return ERR_PTR ( rc ) ; } return port ; err return ERR_PTR ( rc ) ; } 