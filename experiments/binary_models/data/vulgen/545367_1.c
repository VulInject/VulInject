static ssize_t ds1682_show ( struct device * dev , struct device_attribute * attr , char * buf ) { struct sensor_device_attribute_2 * sattr = to_sensor_dev_attr_2 ( attr ) ; struct i2c_client * client = to_i2c_client ( dev ) ; __le32 val ; int rc ; dev_dbg ( dev , "ds1682_show() called on %s\n" , attr -> attr . name ) ; rc = i2c_smbus_read_i2c_block_data ( client , sattr -> index , sattr -> nr , ( u8 * ) & val ) ; if ( rc < 0 ) { return - EIO ; } if ( sattr -> nr == 4 ) { return sprintf ( buf , "%llu\n" , ( ( unsigned long long ) le32_to_cpu ( val ) ) * 250 ) ; } return sprintf ( buf , "%li\n" , ( long ) le32_to_cpu ( val ) ) ; } 