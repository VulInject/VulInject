int ff_dca_core_parse_exss ( DCACoreDecoder * s , const uint8_t * data , DCAExssAsset * asset ) { AVCodecContext * avctx = s -> avctx ; DCAContext * dca = avctx -> priv_data ; int exss_mask = asset ?asset -> extension_mask : 0 ; int ret = 0 , ext ; if ( ! dca -> request_channel_layout ) { if ( exss_mask & DCA_EXSS_XXCH ) { if ( ( ret = init_get_bits8 ( & s -> gb , data + asset -> xxch_offset , asset -> xxch_size ) ) < 0 ) { return ret ; } ret = parse_xxch_frame ( s ) ; ext = DCA_EXSS_XXCH ; } if ( s -> xxch_pos ) { s -> gb = s -> gb_in ; skip_bits_long ( & s -> gb , s -> xxch_pos ) ; ret = parse_xxch_frame ( s ) ; ext = DCA_CSS_XXCH ; } if ( s -> xch_pos ) { s -> gb = s -> gb_in ; skip_bits_long ( & s -> gb , s -> xch_pos ) ; ret = parse_xch_frame ( s ) ; ext = DCA_CSS_XCH ; } if ( ret < 0 ) { if ( avctx -> err_recognition & AV_EF_EXPLODE ) { return ret ; } s -> nchannels = ff_dca_channels [ s -> audio_mode ] ; s -> ch_mask = audio_mode_ch_mask [ s -> audio_mode ] ; if ( s -> lfe_present ) { s -> ch_mask |= DCA_SPEAKER_MASK_LFE1 ; } } else { s -> ext_audio_mask |= ext ; } } if ( exss_mask & DCA_EXSS_XBR ) { if ( ( ret = init_get_bits8 ( & s -> gb , data + asset -> xbr_offset , asset -> xbr_size ) ) < 0 ) { return ret ; } if ( ( ret = parse_xbr_frame ( s ) ) < 0 ) { if ( avctx -> err_recognition & AV_EF_EXPLODE ) { return ret ; } } else { s -> ext_audio_mask |= DCA_EXSS_XBR ; } } if ( ! ( dca -> packet & DCA_PACKET_XLL ) ) { if ( exss_mask & DCA_EXSS_X96 ) { if ( ( ret = init_get_bits8 ( & s -> gb , data + asset -> x96_offset , asset -> x96_size ) ) < 0 ) { return ret ; } if ( ( ret = parse_x96_frame_exss ( s ) ) < 0 ) { if ( ret == AVERROR ( ENOMEM ) || ( avctx -> err_recognition & AV_EF_EXPLODE ) ) { return ret ; } } else { s -> ext_audio_mask |= DCA_EXSS_X96 ; } } if ( s -> x96_pos ) { s -> gb = s -> gb_in ; skip_bits_long ( & s -> gb , s -> x96_pos ) ; if ( ( ret = parse_x96_frame ( s ) ) < 0 ) { if ( ret == AVERROR ( ENOMEM ) || ( avctx -> err_recognition & AV_EF_EXPLODE ) ) { return ret ; } } else { s -> ext_audio_mask |= DCA_CSS_X96 ; } } } return 0 ; } 