bool mgos_i2c_write ( struct mgos_i2c * conn , uint16_t addr , const void * data , size_t len , bool stop ) { conn -> addr = ( addr << 1 ) ; reset_io_state ( conn ) ; HAL_StatusTypeDef status = HAL_I2C_Master_Sequential_Transmit_IT ( conn -> hi2c , conn -> addr , ( void * ) data , len , stop ?I2C_FIRST_AND_LAST_FRAME : I2C_FIRST_AND_NEXT_FRAME ) ; if ( wait_for_io_completion ( conn ) != 1 ) { return false ; } ( void ) stop ; return true ; } 