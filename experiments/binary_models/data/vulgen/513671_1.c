static void sepgsql_object_access ( ObjectAccessType access , Oid classId , Oid objectId , int subId , void * arg ) { if ( next_object_access_hook ) { * next_object_access_hook ( access , classId , objectId , subId , arg ) ; } switch ( access ) { case OAT_POST_CREATE : { ObjectAccessPostCreate * pc_arg = arg ; bool is_internal ; is_internal = pc_arg ?pc_arg -> is_internal : false ; switch ( classId ) { case DatabaseRelationId : Assert ( ! is_internal ) ; sepgsql_database_post_create ( objectId , sepgsql_context_info . createdb_dtemplate ) ; break ; case NamespaceRelationId : Assert ( ! is_internal ) ; sepgsql_schema_post_create ( objectId ) ; break ; case RelationRelationId : if ( subId == 0 ) { if ( is_internal ) { break ; } sepgsql_relation_post_create ( objectId ) ; } else { sepgsql_attribute_post_create ( objectId , subId ) ; } break ; case ProcedureRelationId : Assert ( ! is_internal ) ; sepgsql_proc_post_create ( objectId ) ; break ; default : break ; } } break ; case OAT_DROP : { ObjectAccessDrop * drop_arg = ( ObjectAccessDrop * ) arg ; if ( ( drop_arg -> dropflags & PERFORM_DELETION_INTERNAL ) != 0 ) { break ; } switch ( classId ) { case DatabaseRelationId : sepgsql_database_drop ( objectId ) ; break ; case NamespaceRelationId : sepgsql_schema_drop ( objectId ) ; break ; case RelationRelationId : if ( subId == 0 ) { sepgsql_relation_drop ( objectId ) ; } else { sepgsql_attribute_drop ( objectId , subId ) ; } break ; case ProcedureRelationId : sepgsql_proc_drop ( objectId ) ; break ; default : break ; } } break ; case OAT_TRUNCATE : { switch ( classId ) { case RelationRelationId : sepgsql_relation_truncate ( objectId ) ; break ; default : break ; } } break ; case OAT_POST_ALTER : { ObjectAccessPostAlter * pa_arg = arg ; bool is_internal = pa_arg -> is_internal ; switch ( classId ) { case DatabaseRelationId : Assert ( ! is_internal ) ; sepgsql_database_setattr ( objectId ) ; break ; case NamespaceRelationId : Assert ( ! is_internal ) ; sepgsql_schema_setattr ( objectId ) ; break ; case RelationRelationId : if ( subId == 0 ) { sepgsql_relation_setattr ( objectId ) ; } else { sepgsql_attribute_setattr ( objectId , subId ) ; } break ; case ProcedureRelationId : Assert ( ! is_internal ) ; sepgsql_proc_setattr ( objectId ) ; break ; default : break ; } } break ; case OAT_NAMESPACE_SEARCH : { ObjectAccessNamespaceSearch * ns_arg = arg ; if ( ! ns_arg -> result ) { break ; } Assert ( classId == NamespaceRelationId ) ; Assert ( ns_arg -> result ) ; ns_arg -> result = sepgsql_schema_search ( objectId , ns_arg -> ereport_on_violation ) ; } break ; case OAT_FUNCTION_EXECUTE : { Assert ( classId == ProcedureRelationId ) ; sepgsql_proc_execute ( objectId ) ; } break ; default : elog ( ERROR , "unexpected object access type: %d" , ( int ) access ) ; break ; } } 