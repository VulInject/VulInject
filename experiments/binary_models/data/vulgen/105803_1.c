static int qla4_82xx_load_fw ( struct scsi_qla_host * ha , uint32_t image_start ) { u32 rst ; qla4_82xx_wr_32 ( ha , CRB_CMDPEG_STATE , 0 ) ; if ( qla4_82xx_pinit_from_rom ( ha , 0 ) != QLA_SUCCESS ) { printk ( KERN_WARNING "%s: Error during CRB Initialization\n" , __func__ ) ; return QLA_ERROR ; } udelay ( 500 ) ; rst &= ~ ( 1 << 28 ) ; qla4_82xx_wr_32 ( ha , QLA82XX_ROMUSB_GLB_SW_RESET , rst ) ; if ( qla4_82xx_load_from_flash ( ha , image_start ) ) { printk ( "%s: Error trying to load fw from flash!\n" , __func__ ) ; return QLA_ERROR ; } return QLA_SUCCESS ; } 