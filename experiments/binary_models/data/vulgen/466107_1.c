int gfs_readdir_init ( gfs_readdir_state_t * st , int name_max , int ureclen , uio_t * uiop , ino64_t parent , ino64_t self , int flags ) { size_t dirent_size ; st -> grd_ureclen = ureclen ; st -> grd_oresid = uiop -> uio_resid ; st -> grd_namlen = name_max ; if ( flags & V_RDDIR_ENTFLAGS ) { dirent_size = EDIRENT_RECLEN ( st -> grd_namlen ) ; } else { dirent_size = DIRENT64_RECLEN ( st -> grd_namlen ) ; } st -> grd_dirent = kmem_zalloc ( dirent_size , KM_SLEEP ) ; st -> grd_parent = parent ; st -> grd_self = self ; st -> grd_flags = flags ; return ( 0 ) ; } 