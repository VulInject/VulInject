static void __init fsg_init ( void ) { uint8_t __iomem * f ; ixp4xx_sys_init ( ) ; fsg_flash_resource . start = IXP4XX_EXP_BUS_BASE ( 0 ) ; fsg_flash_resource . end = IXP4XX_EXP_BUS_BASE ( 0 ) + ixp4xx_exp_bus_size - 1 ; * IXP4XX_EXP_CS0 |= IXP4XX_FLASH_WRITABLE ; * IXP4XX_EXP_CS1 = * IXP4XX_EXP_CS0 ; * IXP4XX_EXP_CS2 = 0xbfff0002 ; i2c_register_board_info ( 0 , fsg_i2c_board_info , ARRAY_SIZE ( fsg_i2c_board_info ) ) ; ( void ) platform_device_register ( & fsg_uart ) ; platform_add_devices ( fsg_devices , ARRAY_SIZE ( fsg_devices ) ) ; if ( request_irq ( gpio_to_irq ( FSG_RB_GPIO ) , & fsg_reset_handler , IRQF_TRIGGER_LOW , "FSG reset button" , NULL ) < 0 ) { printk ( KERN_DEBUG "Reset Button IRQ %d not available\n" , gpio_to_irq ( FSG_RB_GPIO ) ) ; } if ( request_irq ( gpio_to_irq ( FSG_SB_GPIO ) , & fsg_power_handler , IRQF_TRIGGER_LOW , "FSG power button" , NULL ) < 0 ) { printk ( KERN_DEBUG "Power Button IRQ %d not available\n" , gpio_to_irq ( FSG_SB_GPIO ) ) ; } if ( f ) { int i ; for ( i = 0 ; i < 6 ; i ++ ) { fsg_plat_eth [ 0 ] . hwaddr [ i ] = readb ( f + 0x3C0422 + i ) ; fsg_plat_eth [ 1 ] . hwaddr [ i ] = readb ( f + 0x3C043B + i ) ; } fsg_plat_eth [ 0 ] . hwaddr [ 0 ] = readb ( f + 0x3C0421 ) ; fsg_plat_eth [ 0 ] . hwaddr [ 1 ] = readb ( f + 0x3C0420 ) ; fsg_plat_eth [ 0 ] . hwaddr [ 2 ] = readb ( f + 0x3C0427 ) ; fsg_plat_eth [ 0 ] . hwaddr [ 3 ] = readb ( f + 0x3C0426 ) ; fsg_plat_eth [ 0 ] . hwaddr [ 4 ] = readb ( f + 0x3C0425 ) ; fsg_plat_eth [ 0 ] . hwaddr [ 5 ] = readb ( f + 0x3C0424 ) ; fsg_plat_eth [ 1 ] . hwaddr [ 0 ] = readb ( f + 0x3C0439 ) ; fsg_plat_eth [ 1 ] . hwaddr [ 1 ] = readb ( f + 0x3C043F ) ; fsg_plat_eth [ 1 ] . hwaddr [ 2 ] = readb ( f + 0x3C043E ) ; fsg_plat_eth [ 1 ] . hwaddr [ 3 ] = readb ( f + 0x3C043D ) ; fsg_plat_eth [ 1 ] . hwaddr [ 4 ] = readb ( f + 0x3C043C ) ; fsg_plat_eth [ 1 ] . hwaddr [ 5 ] = readb ( f + 0x3C0443 ) ; iounmap ( f ) ; } printk ( KERN_INFO "FSG: Using MAC address %pM for port 0\n" , fsg_plat_eth [ 0 ] . hwaddr ) ; printk ( KERN_INFO "FSG: Using MAC address %pM for port 1\n" , fsg_plat_eth [ 1 ] . hwaddr ) ; } 