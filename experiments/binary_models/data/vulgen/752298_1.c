static ssize_t dfs_file_read ( struct file * file , char __user * user_buf , size_t count , loff_t * ppos ) { unsigned long ubi_num = ( unsigned long ) file -> private_data ; struct dentry * dent = file -> f_path . dentry ; struct ubi_device * ubi ; struct ubi_debug_info * d ; char buf [ 8 ] ; int val ; ubi = ubi_get_device ( ubi_num ) ; d = & ubi -> dbg ; if ( dent == d -> dfs_chk_gen ) { val = d -> chk_gen ; } if ( dent == d -> dfs_chk_io ) { val = d -> chk_io ; } if ( dent == d -> dfs_chk_fastmap ) { val = d -> chk_fastmap ; } if ( dent == d -> dfs_disable_bgt ) { val = d -> disable_bgt ; } if ( dent == d -> dfs_emulate_bitflips ) { val = d -> emulate_bitflips ; } if ( dent == d -> dfs_emulate_io_failures ) { val = d -> emulate_io_failures ; } if ( dent == d -> dfs_emulate_power_cut ) { snprintf ( buf , sizeof ( buf ) , "%u\n" , d -> emulate_power_cut ) ; count = simple_read_from_buffer ( user_buf , count , ppos , buf , strlen ( buf ) ) ; out } if ( dent == d -> dfs_power_cut_min ) { snprintf ( buf , sizeof ( buf ) , "%u\n" , d -> power_cut_min ) ; count = simple_read_from_buffer ( user_buf , count , ppos , buf , strlen ( buf ) ) ; out } if ( dent == d -> dfs_power_cut_max ) { snprintf ( buf , sizeof ( buf ) , "%u\n" , d -> power_cut_max ) ; count = simple_read_from_buffer ( user_buf , count , ppos , buf , strlen ( buf ) ) ; out } else { count = - EINVAL ; out } if ( val ) { buf [ 0 ] = '1' ; } else { buf [ 0 ] = '0' ; } buf [ 1 ] = '\n' ; buf [ 2 ] = 0x00 ; count = simple_read_from_buffer ( user_buf , count , ppos , buf , 2 ) ; out ubi_put_device ( ubi ) ; return count ; } 