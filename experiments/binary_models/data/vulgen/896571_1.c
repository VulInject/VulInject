static void falcon_push_irq_moderation ( struct ef4_channel * channel ) { ef4_dword_t timer_cmd ; struct ef4_nic * efx = channel -> efx ; if ( channel -> irq_moderation_us ) { unsigned int ticks ; ticks = ef4_usecs_to_ticks ( efx , channel -> irq_moderation_us ) ; EF4_POPULATE_DWORD_2 ( timer_cmd , FRF_AB_TC_TIMER_MODE , FFE_BB_TIMER_MODE_INT_HLDOFF , FRF_AB_TC_TIMER_VAL , ticks - 1 ) ; } else { EF4_POPULATE_DWORD_2 ( timer_cmd , FRF_AB_TC_TIMER_MODE , FFE_BB_TIMER_MODE_DIS , FRF_AB_TC_TIMER_VAL , 0 ) ; } ef4_writed_page_locked ( efx , & timer_cmd , FR_BZ_TIMER_COMMAND_P0 , channel -> channel ) ; } 