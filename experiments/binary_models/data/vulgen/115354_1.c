static int fat_ioctl_fitrim ( struct inode * inode , unsigned long arg ) { struct super_block * sb = inode -> i_sb ; struct fstrim_range __user * user_range ; struct fstrim_range range ; int err ; if ( ! capable ( CAP_SYS_ADMIN ) ) { return - EPERM ; } user_range = ( fstrim_range __user * ) arg ; if ( copy_from_user ( & range , user_range , sizeof ( range ) ) ) { return - EFAULT ; } range . minlen = max_t ( , , ) ; err = fat_trim_fs ( inode , & range ) ; if ( err < 0 ) { return err ; } if ( copy_to_user ( user_range , & range , sizeof ( range ) ) ) { return - EFAULT ; } return 0 ; } 