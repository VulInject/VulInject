static void print ( struct secret_stuff * pks , int count , struct id * id , bool disclose ) { id_buf idbuf = { "n/a" } ; const char * idb = idbuf . buf ; if ( count ) { printf ( "%d(%d): " , pks -> line , count ) ; } else { printf ( "<%2d>" , pks -> line ) ; } switch ( pks -> kind ) { case SECRET_PSK : print_secret ( "PSK" , "psk" , idb , pks -> u . preshared_secret , disclose ) ; break ; case SECRET_XAUTH : print_secret ( "XAUTH" , "xauth" , idb , pks -> u . preshared_secret , disclose ) ; break ; case SECRET_RSA : case SECRET_ECDSA : { printf ( "%s" , pks -> u . pubkey . content . type -> name ) ; keyid_t keyid = pks -> u . pubkey . content . keyid ; printf ( " keyid: %s" , str_keyid ( keyid ) [ 0 ] ?str_keyid ( keyid ) : "<missing-pubkey>" ) ; if ( id ) { printf ( " id: %s" , idb ) ; } ckaid_buf cb ; const ckaid_t * ckaid = & pks -> u . pubkey . content . ckaid ; printf ( " ckaid: %s\n" , str_ckaid ( ckaid , & cb ) ) ; break ; } case SECRET_PPK : break ; case SECRET_NULL : printf ( "NULL authentication -- cannot happen: %s\n" , idb ) ; abort ( ) ; case SECRET_INVALID : printf ( "Invalid or unknown key: %s\n" , idb ) ; exit ( 1 ) ; } } 