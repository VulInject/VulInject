if ( ( num_fields = describe_define ( cda , def , desc ) ) == - 1 ) { * errmsg = oracle_error ( oracle_handle , cda -> rc , "describe_define failed" ) ; * defer_break = FALSE ; ORACLE_EXIT } if ( oexec ( cda ) != 0 ) { * errmsg = oracle_error ( oracle_handle , cda -> rc , "oexec failed" ) ; * defer_break = FALSE ; ORACLE_EXIT } while ( cda -> rc != NO_DATA_FOUND ) { ofetch ( cda ) ; if ( cda -> rc == NO_DATA_FOUND ) { break ; } if ( result ) { result = string_catn ( result , "\n" , 1 ) ; } if ( num_fields == 1 ) { result = string_catn ( result , def [ 0 ] . buf , def [ 0 ] . col_retlen ) ; } else { for ( int i = 0 ; i < num_fields ; i ++ ) { int slen ; uschar * s = US desc [ i ] . buf ; while ( * s != 0 && isspace ( * s ) ) { s ++ ; } slen = Ustrlen ( s ) ; while ( slen > 0 && isspace ( s [ slen - 1 ] ) ) { slen -- ; } result = string_catn ( result , s , slen ) ; if ( desc [ i ] . dbtype != INT_TYPE && desc [ i ] . dbtype != FLOAT_TYPE && ( def [ i ] . buf [ 0 ] == 0 || strchr ( def [ i ] . buf , ' ' ) != NULL ) ) { result = string_catn ( result , "\"" , 1 ) ; for ( int j = 0 ; j < def [ i ] . col_retlen ; j ++ ) { if ( def [ i ] . buf [ j ] == '\"' || def [ i ] . buf [ j ] == '\\' ) { result = string_catn ( result , "\\" , 1 ) ; } result = string_catn ( result , def [ i ] . buf + j , 1 ) ; } result = string_catn ( result , "\"" , 1 ) ; } else { switch ( desc [ i ] . dbtype ) { case INT_TYPE : result = string_cat ( result , string_sprintf ( "%d" , def [ i ] . int_buf ) ) ; break ; case FLOAT_TYPE : result = string_cat ( result , string_sprintf ( "%f" , def [ i ] . flt_buf ) ) ; break ; case STRING_TYPE : result = string_catn ( result , def [ i ] . buf , def [ i ] . col_retlen ) ; break ; default : * errmsg = string_sprintf ( "ORACLE: unknown field type %d" , desc [ i ] . dbtype ) ; * defer_break = FALSE ; result = NULL ; ORACLE_EXIT } } result = string_catn ( result , " " , 1 ) ; } } } if ( ! result ) { yield = FAIL ; * errmsg = "ORACLE: no data found" ; } else { gstring_release_unused ( result ) ; } ORACLE_EXIT oclose ( cda ) ; ORACLE_EXIT_NO_VALS if ( result ) { * resultptr = string_from_gstring ( result ) ; return OK ; } else { DEBUG ( ) debug_printf_indent ( "%s\n" , * errmsg ) ; return yield ; } 