void gma_crtc_save ( struct drm_crtc * crtc ) { struct drm_device * dev = crtc -> dev ; struct drm_psb_private * dev_priv = to_drm_psb_private ( dev ) ; struct gma_crtc * gma_crtc = to_gma_crtc ( crtc ) ; struct psb_intel_crtc_state * crtc_state = gma_crtc -> crtc_state ; const struct psb_offset * map = & dev_priv -> regmap [ gma_crtc -> pipe ] ; uint32_t palette_reg ; int i ; crtc_state -> saveDSPCNTR = REG_READ ( map -> cntr ) ; crtc_state -> savePIPECONF = REG_READ ( map -> conf ) ; crtc_state -> savePIPESRC = REG_READ ( map -> src ) ; crtc_state -> saveFP0 = REG_READ ( map -> fp0 ) ; crtc_state -> saveFP1 = REG_READ ( map -> fp1 ) ; crtc_state -> saveDPLL = REG_READ ( map -> dpll ) ; crtc_state -> saveHTOTAL = REG_READ ( map -> htotal ) ; crtc_state -> saveHBLANK = REG_READ ( map -> hblank ) ; crtc_state -> saveHSYNC = REG_READ ( map -> hsync ) ; crtc_state -> saveVTOTAL = REG_READ ( map -> vtotal ) ; crtc_state -> saveVBLANK = REG_READ ( map -> vblank ) ; crtc_state -> saveVSYNC = REG_READ ( map -> vsync ) ; crtc_state -> saveDSPSTRIDE = REG_READ ( map -> stride ) ; crtc_state -> saveDSPSIZE = REG_READ ( map -> size ) ; crtc_state -> saveDSPPOS = REG_READ ( map -> pos ) ; crtc_state -> saveDSPBASE = REG_READ ( map -> base ) ; palette_reg = map -> palette ; for ( i = 0 ; i < 256 ; ++ i ) { crtc_state -> savePalette [ i ] = REG_READ ( palette_reg + ( i << 2 ) ) ; } } 