static int ad7877_process_data ( struct ad7877 * ts ) { struct input_dev * input_dev = ts -> input ; unsigned Rt ; u16 x , y , z1 , z2 ; x = ts -> conversion_data [ AD7877_SEQ_XPOS ] & MAX_12BIT ; y = ts -> conversion_data [ AD7877_SEQ_YPOS ] & MAX_12BIT ; z1 = ts -> conversion_data [ AD7877_SEQ_Z1 ] & MAX_12BIT ; z2 = ts -> conversion_data [ AD7877_SEQ_Z2 ] & MAX_12BIT ; if ( likely ( x && z1 ) ) { Rt = ( z2 - z1 ) * x * ts -> x_plate_ohms ; Rt /= z1 ; Rt = ( Rt + 2047 ) >> 12 ; if ( ! timer_pending ( & ts -> timer ) ) { input_report_key ( input_dev , BTN_TOUCH , 1 ) ; } input_report_abs ( input_dev , ABS_X , x ) ; input_report_abs ( input_dev , ABS_Y , y ) ; input_report_abs ( input_dev , ABS_PRESSURE , Rt ) ; input_sync ( input_dev ) ; return 0 ; } return - EINVAL ; } 