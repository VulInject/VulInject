static int sahara_aes_ecb_encrypt ( struct ablkcipher_request * req ) { struct sahara_ctx * ctx = crypto_ablkcipher_ctx ( crypto_ablkcipher_reqtfm ( req ) ) ; int err ; if ( unlikely ( ctx -> keylen != AES_KEYSIZE_128 ) ) { SKCIPHER_REQUEST_ON_STACK ( subreq , ctx -> fallback ) ; skcipher_request_set_tfm ( subreq , ctx -> fallback ) ; skcipher_request_set_callback ( subreq , req -> base . flags , NULL , NULL ) ; skcipher_request_set_crypt ( subreq , req -> src , req -> dst , req -> nbytes , req -> info ) ; err = crypto_skcipher_encrypt ( subreq ) ; return err ; } return sahara_aes_crypt ( req , FLAGS_ENCRYPT ) ; } 