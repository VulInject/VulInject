static GF_Err RAW_LockBackBuffer ( GF_VideoOutput * dr , GF_VideoSurface * vi , Bool do_lock ) { RAWCTX ; void * pixels ; GF_LOG ( GF_LOG_DEBUG , GF_LOG_CORE , ( "Android vout RAW_LockBackBuffer: %d\n" , do_lock ) ) ; if ( do_lock ) { if ( ! vi ) { return GF_BAD_PARAM ; } GF_LOG ( GF_LOG_DEBUG , GF_LOG_CORE , ( "Android vout locked_data: %d\n" , rc -> locked_data ) ) ; if ( ! rc -> locked_data ) { int ret ; if ( ( ret = AndroidBitmap_lockPixels ( rc -> env , * ( rc -> bitmap ) , & pixels ) ) < 0 ) { GF_LOG ( GF_LOG_DEBUG , GF_LOG_CORE , ( "Android vout lock failed (%d)\n" , ret ) ) ; } rc -> locked_data = pixels ; } GF_LOG ( GF_LOG_DEBUG , GF_LOG_CORE , ( "Android vout rc dims: %d:%d\n" , rc -> height , rc -> width ) ) ; vi -> height = rc -> height ; vi -> width = rc -> width ; vi -> video_buffer = rc -> locked_data ; vi -> is_hardware_memory = 0 ; vi -> pitch_x = NBPP ; vi -> pitch_y = NBPP * vi -> width ; vi -> pixel_format = RAW_OUT_PIXEL_FORMAT ; } else { if ( rc -> locked_data ) { AndroidBitmap_unlockPixels ( rc -> env , * ( rc -> bitmap ) ) ; rc -> locked_data = NULL ; } } return GF_OK ; } 