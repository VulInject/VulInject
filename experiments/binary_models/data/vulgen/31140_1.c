void framebuffer_update_memory_section ( MemoryRegionSection * mem_section , MemoryRegion * root , hwaddr base , unsigned rows , unsigned src_width ) { if ( mem_section -> mr ) { memory_region_set_log ( mem_section -> mr , false , DIRTY_MEMORY_VGA ) ; memory_region_unref ( mem_section -> mr ) ; mem_section -> mr = NULL ; } * mem_section = memory_region_find ( root , base , src_len ) ; if ( ! mem_section -> mr ) { return ; } if ( int128_get64 ( mem_section -> size ) < src_len || ! memory_region_is_ram ( mem_section -> mr ) ) { memory_region_unref ( mem_section -> mr ) ; mem_section -> mr = NULL ; return ; } memory_region_set_log ( mem_section -> mr , true , DIRTY_MEMORY_VGA ) ; } 