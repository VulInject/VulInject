static int hsw_hw_config ( struct perf_event * event ) { int ret = intel_pmu_hw_config ( event ) ; if ( ret ) { return ret ; } event -> hw . config |= event -> attr . config & ( HSW_IN_TX | HSW_IN_TX_CHECKPOINTED ) ; if ( ( event -> hw . config & ( HSW_IN_TX | HSW_IN_TX_CHECKPOINTED ) ) && ( ( event -> hw . config & ARCH_PERFMON_EVENTSEL_ANY ) || event -> attr . precise_ip > 0 ) ) { return - EOPNOTSUPP ; } if ( event_is_checkpointed ( event ) ) { if ( event -> attr . sample_period > 0 && event -> attr . sample_period < 0x7fffffff ) { return - EOPNOTSUPP ; } } return 0 ; } static struct event_constraint counter0_constraint = INTEL_ALL_EVENT_CONSTRAINT ( 0 , 0x1 ) ; static struct event_constraint counter1_constraint = INTEL_ALL_EVENT_CONSTRAINT ( 0 , 0x2 ) ; static struct event_constraint counter0_1_constraint = INTEL_ALL_EVENT_CONSTRAINT ( 0 , 0x3 ) ; static struct event_constraint counter2_constraint = EVENT_CONSTRAINT ( 0 , 0x4 , 0 ) ; static struct event_constraint fixed0_constraint = FIXED_EVENT_CONSTRAINT ( 0x00c0 , 0 ) ; static struct event_constraint fixed0_counter0_constraint = INTEL_ALL_EVENT_CONSTRAINT ( 0 , 0x100000001ULL ) ; static struct event_constraint fixed0_counter0_1_constraint = INTEL_ALL_EVENT_CONSTRAINT ( 0 , 0x100000003ULL ) ; static struct event_constraint counters_1_7_constraint = INTEL_ALL_EVENT_CONSTRAINT ( 0 , 0xfeULL ) ; static struct event_constraint * hsw_get_event_constraints ( struct cpu_hw_events * cpuc , int idx , struct perf_event * event ) { struct event_constraint * c ; c = intel_get_event_constraints ( cpuc , idx , event ) ; if ( event -> hw . config & HSW_IN_TX_CHECKPOINTED ) { if ( c -> idxmsk64 & ( 1U << 2 ) ) { return & counter2_constraint ; } return & emptyconstraint ; } return c ; } 