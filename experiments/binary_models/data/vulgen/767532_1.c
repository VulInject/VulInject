static void winpr_unref_named_pipe ( WINPR_NAMED_PIPE * pNamedPipe ) { size_t index ; NamedPipeServerSocketEntry * baseSocket ; WINPR_ASSERT ( pNamedPipe -> name ) ; WINPR_ASSERT ( g_NamedPipeServerSockets ) ; ArrayList_Lock ( g_NamedPipeServerSockets ) ; for ( index = 0 ; index < ArrayList_Count ( g_NamedPipeServerSockets ) ; index ++ ) { baseSocket = ( NamedPipeServerSocketEntry * ) ArrayList_GetItem ( g_NamedPipeServerSockets , index ) ; WINPR_ASSERT ( baseSocket -> name ) ; if ( ! strcmp ( baseSocket -> name , pNamedPipe -> name ) ) { WINPR_ASSERT ( baseSocket -> references > 0 ) ; WINPR_ASSERT ( baseSocket -> serverfd != - 1 ) ; if ( -- baseSocket -> references == 0 ) { ArrayList_Remove ( g_NamedPipeServerSockets , baseSocket ) ; close ( baseSocket -> serverfd ) ; free ( baseSocket -> name ) ; free ( baseSocket ) ; } break ; } } ArrayList_Unlock ( g_NamedPipeServerSockets ) ; } 