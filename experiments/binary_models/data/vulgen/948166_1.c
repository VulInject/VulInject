static int bcm54140_config_intr ( struct phy_device * phydev ) { struct bcm54140_priv * priv = phydev -> priv ; static const u16 port_to_imr_bit [ ] { BCM54140_RDB_TOP_IMR_PORT0 BCM54140_RDB_TOP_IMR_PORT1 BCM54140_RDB_TOP_IMR_PORT2 BCM54140_RDB_TOP_IMR_PORT3 } ; ; int reg , err ; reg = bcm54140_base_read_rdb ( phydev , BCM54140_RDB_TOP_IMR ) ; if ( reg < 0 ) { return reg ; } if ( phydev -> interrupts == PHY_INTERRUPT_ENABLED ) { err = bcm54140_ack_intr ( phydev ) ; if ( err ) { return err ; } reg &= ~ port_to_imr_bit [ priv -> port ] ; err = bcm54140_base_write_rdb ( phydev , BCM54140_RDB_TOP_IMR , reg ) ; } else { reg |= port_to_imr_bit [ priv -> port ] ; err = bcm54140_base_write_rdb ( phydev , BCM54140_RDB_TOP_IMR , reg ) ; if ( err ) { return err ; } err = bcm54140_ack_intr ( phydev ) ; } return err ; } 