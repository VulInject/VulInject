static int lp_sub ( lua_State * L ) { Charset st1 , st2 ; int s1 , s2 ; TTree * t1 = getpatt ( L , 1 , & s1 ) ; TTree * t2 = getpatt ( L , 2 , & s2 ) ; if ( tocharset ( t1 , & st1 ) && tocharset ( t2 , & st2 ) ) { TTree * t = newcharset ( L ) ; loopset ( i , treebuffer ( t ) [ i ] = st1 . cs [ i ] & ~ st2 . cs [ i ] ) ; } else { TTree * tree = newtree ( L , 2 + s1 + s2 ) ; tree -> tag = TSeq ; tree -> u . ps = 2 + s2 ; sib1 ( tree ) -> tag = TNot ; memcpy ( sib1 ( sib1 ( tree ) ) , t2 , s2 * sizeof ( TTree ) ) ; memcpy ( sib2 ( tree ) , t1 , s1 * sizeof ( TTree ) ) ; } return 1 ; } 