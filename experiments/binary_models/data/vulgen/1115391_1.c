krb5_error_code KRB5_CALLCONV krb5_get_init_creds_opt_set_pa ( krb5_context context , krb5_get_init_creds_opt * opt , const char * attr , const char * value ) { struct extended_options * opte = ( extended_options * ) opt ; krb5_gic_opt_pa_data * t , * pa ; if ( opt == NULL || ! ( opt -> flags & GIC_OPT_EXTENDED ) ) { return EINVAL ; } assert ( ! ( opt -> flags & GIC_OPT_SHALLOW_COPY ) ) ; t = realloc ( opte -> preauth_data , ( opte -> num_preauth_data + 1 ) * sizeof ( * t ) ) ; if ( t == NULL ) { return ENOMEM ; } opte -> preauth_data = t ; pa = & opte -> preauth_data [ opte -> num_preauth_data ] ; pa -> attr = strdup ( attr ) ; if ( pa -> attr == NULL ) { return ENOMEM ; } pa -> value = strdup ( value ) ; if ( pa -> value == NULL ) { return ENOMEM ; } opte -> num_preauth_data ++ ; return krb5_preauth_supply_preauth_data ( context , opt , attr , value ) ; } 