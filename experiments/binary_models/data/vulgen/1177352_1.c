static void list_commands_in_dir ( struct cmdnames * cmds , const char * path , const char * prefix ) { int prefix_len ; DIR * dir = opendir ( path ) ; struct dirent * de ; char * buf = NULL ; if ( ! prefix ) { prefix = "perf-" ; } prefix_len = strlen ( prefix ) ; astrcatf ( & buf , "%s/" , path ) ; while ( ( de = readdir ( dir ) ) != NULL ) { int entlen ; if ( ! strstarts ( de -> d_name , prefix ) ) { continue ; } astrcat ( & buf , de -> d_name ) ; if ( ! is_executable ( buf ) ) { continue ; } entlen = strlen ( de -> d_name ) - prefix_len ; if ( has_extension ( de -> d_name , ".exe" ) ) { entlen -= 4 ; } add_cmdname ( cmds , de -> d_name + prefix_len , entlen ) ; } closedir ( dir ) ; free ( buf ) ; } 