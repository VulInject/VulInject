static void okm_cleanup ( okms_t * okmsp ) { ASSERT ( okmsp != NULL ) ; if ( okmsp -> km_clean & OKM_CLEAN_NODE ) { ddi_remove_minor_node ( okmsp -> km_dip , NULL ) ; } if ( okmsp -> km_clean & OKM_CLEAN_LOCK ) { mutex_destroy ( & okmsp -> km_lock ) ; } if ( okmsp -> km_clean & OKM_CLEAN_CV ) { cv_destroy ( & okmsp -> km_wait ) ; } if ( okmsp -> km_reqp != NULL ) { kmem_free ( okmsp -> km_reqp , okmsp -> km_reqlen ) ; okmsp -> km_reqlen = 0 ; } ddi_set_driver_private ( okmsp -> km_dip , NULL ) ; } 