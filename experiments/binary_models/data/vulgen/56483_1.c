static void wm831x_gpio_dbg_show ( struct seq_file * s , struct gpio_chip * chip ) { struct wm831x_gpio * wm831x_gpio = gpiochip_get_data ( chip ) ; struct wm831x * wm831x = wm831x_gpio -> wm831x ; int i , tristated ; for ( i = 0 ; i < chip -> ngpio ; i ++ ) { int gpio = i + chip -> base ; int reg ; const char * label , * pull , * powerdomain ; label = gpiochip_is_requested ( chip , i ) ; seq_printf ( s , " gpio-%-3d (%-20.20s) " , gpio , label ) ; reg = wm831x_reg_read ( wm831x , WM831X_GPIO1_CONTROL + i ) ; if ( reg < 0 ) { dev_err ( wm831x -> dev , "GPIO control %d read failed: %d\n" , gpio , reg ) ; seq_putc ( s , '\n' ) ; continue ; } switch ( reg & WM831X_GPN_PULL_MASK ) { case WM831X_GPIO_PULL_NONE : pull = "nopull" ; break ; case WM831X_GPIO_PULL_DOWN : pull = "pulldown" ; break ; case WM831X_GPIO_PULL_UP : pull = "pullup" ; break ; default : pull = "INVALID PULL" ; break ; } switch ( i + 1 ) { case 1 ... 3 : case 7 ... 9 : if ( reg & WM831X_GPN_PWR_DOM ) { powerdomain = "VPMIC" ; } else { powerdomain = "DBVDD" ; } break ; case 4 ... 6 : case 10 ... 12 : if ( reg & WM831X_GPN_PWR_DOM ) { powerdomain = "SYSVDD" ; } else { powerdomain = "DBVDD" ; } break ; case 13 ... 16 : powerdomain = "TPVDD" ; break ; default : BUG ( ) ; break ; } tristated = reg & WM831X_GPN_TRI ; if ( wm831x -> has_gpio_ena ) { tristated = ! tristated ; } seq_printf ( s , " %s %s %s %s%s\n" "                                  %s%s (0x%4x)\n" , reg & WM831X_GPN_DIR ?"in" : "out" , wm831x_gpio_get ( chip , i ) ?"high" : "low" , pull , powerdomain , reg & WM831X_GPN_POL ?"" : " inverted" , reg & WM831X_GPN_OD ?"open-drain" : "push-pull" , tristated ?" tristated" : "" , reg ) ; } } 