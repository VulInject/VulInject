int of_write_trailer ( OutputFile * of ) { Muxer * mux = mux_from_of ( of ) ; AVFormatContext * fc = mux -> fc ; int ret ; if ( ! mux -> tq ) { av_log ( mux , AV_LOG_ERROR , "Nothing was written into output file, because " "at least one of its streams received no packets.\n" ) ; return AVERROR ( EINVAL ) ; } ret = thread_stop ( mux ) ; if ( ret < 0 ) { main_return_code = ret ; } ret = av_write_trailer ( fc ) ; if ( ret < 0 ) { av_log ( mux , AV_LOG_ERROR , "Error writing trailer: %s\n" , av_err2str ( ret ) ) ; return ret ; } if ( ! ( of -> format -> flags & AVFMT_NOFILE ) ) { ret = avio_closep ( & fc -> pb ) ; if ( ret < 0 ) { av_log ( mux , AV_LOG_ERROR , "Error closing file: %s\n" , av_err2str ( ret ) ) ; return ret ; } } return 0 ; } 