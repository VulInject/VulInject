static int emulate_pci_command_write ( struct intel_vgpu * vgpu , unsigned int offset , void * p_data , unsigned int bytes ) { u8 old = vgpu_cfg_space ( vgpu ) [ offset ] ; u8 new = * ( u8 * ) p_data ; vgpu_pci_cfg_mem_write ( vgpu , offset , p_data , bytes ) ; if ( ! ( changed & PCI_COMMAND_MEMORY ) ) { return 0 ; } if ( old & PCI_COMMAND_MEMORY ) { trap_gttmmio ( vgpu , false ) ; map_aperture ( vgpu , false ) ; } else { trap_gttmmio ( vgpu , true ) ; map_aperture ( vgpu , true ) ; } return 0 ; } 