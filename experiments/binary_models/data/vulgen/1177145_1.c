BOOLEAN VIOSockRxCbInit ( IN PDEVICE_CONTEXT pContext ) { ULONG i ; BOOLEAN bRes = TRUE ; WDF_OBJECT_ATTRIBUTES lockAttributes , memAttributes ; NTSTATUS status ; PAGED_CODE ( ) ; TraceEvents ( TRACE_LEVEL_VERBOSE , DBG_READ , "-->%s\n" , __FUNCTION__ ) ; pContext -> RxCbBuffersNum = VIOSOCK_CB_ENTRIES ( pContext -> RxPktNum ) ; if ( pContext -> RxCbBuffersNum < pContext -> RxPktNum ) { pContext -> RxCbBuffersNum = pContext -> RxPktNum ; } WDF_OBJECT_ATTRIBUTES_INIT ( & memAttributes ) ; memAttributes . ParentObject = pContext -> ThisDevice ; status = WdfLookasideListCreate ( & memAttributes , sizeof ( VIOSOCK_RX_CB ) , NonPagedPoolNx , & memAttributes , VIOSOCK_DRIVER_MEMORY_TAG , & pContext -> RxCbBufferMemoryList ) ; if ( ! NT_SUCCESS ( status ) ) { TraceEvents ( TRACE_LEVEL_ERROR , DBG_READ , "WdfLookasideListCreate failed: 0x%x\n" , status ) ; return FALSE ; } TraceEvents ( TRACE_LEVEL_INFORMATION , DBG_READ , "Initialize chained buffer with %u entries\n" , pContext -> RxCbBuffersNum ) ; pContext -> RxCbBuffers . Next = NULL ; for ( i = 0 ; i < pContext -> RxCbBuffersNum ; ++ i ) { if ( ! VIOSockRxCbAdd ( pContext ) ) { TraceEvents ( TRACE_LEVEL_ERROR , DBG_READ , "VIOSockRxCbAdd failed, cleanup chained buffer\n" ) ; bRes = FALSE ; break ; } } return bRes ; } 