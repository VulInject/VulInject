struct aq_nic_s * aq_nic_alloc_hot ( struct net_device * ndev ) { struct aq_nic_s * self = NULL ; int err = 0 ; if ( ! ndev ) { err = - EINVAL ; err_exit } self = netdev_priv ( ndev ) ; if ( ! self ) { err = - EINVAL ; err_exit } if ( netif_running ( ndev ) ) { unsigned int i ; for ( i = AQ_CFG_VECS_MAX ; i -- ; ) { netif_stop_subqueue ( ndev , i ) ; } } for ( self -> aq_vecs = 0 ; self -> aq_vecs < self -> aq_nic_cfg . vecs ; self -> aq_vecs ++ ) { self -> aq_vec [ self -> aq_vecs ] = aq_vec_alloc ( self , self -> aq_vecs , & self -> aq_nic_cfg ) ; if ( ! self -> aq_vec [ self -> aq_vecs ] ) { err = - ENOMEM ; err_exit } } err_exit if ( err < 0 ) { self = NULL ; } return self ; } 