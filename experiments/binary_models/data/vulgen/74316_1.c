static int virtcrypto_update_status ( struct virtio_crypto * vcrypto ) { u32 status ; int err ; virtio_cread_le ( vcrypto -> vdev , virtio_crypto_config , status , & status ) ; if ( status & ( ~ VIRTIO_CRYPTO_S_HW_READY ) ) { dev_warn ( & vcrypto -> vdev -> dev , "Unknown status bits: 0x%x\n" , status ) ; virtio_break_device ( vcrypto -> vdev ) ; return - EPERM ; } vcrypto -> status = status ; if ( vcrypto -> status & VIRTIO_CRYPTO_S_HW_READY ) { err = virtcrypto_dev_start ( vcrypto ) ; if ( err ) { dev_err ( & vcrypto -> vdev -> dev , "Failed to start virtio crypto device.\n" ) ; return - EPERM ; } dev_info ( & vcrypto -> vdev -> dev , "Accelerator device is ready\n" ) ; } else { virtcrypto_dev_stop ( vcrypto ) ; dev_info ( & vcrypto -> vdev -> dev , "Accelerator is not ready\n" ) ; } return 0 ; } 