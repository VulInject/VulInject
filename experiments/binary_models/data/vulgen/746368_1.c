void wil_p2p_stop_radio_operations ( struct wil6210_priv * wil ) { struct wil6210_vif * vif = ndev_to_vif ( wil -> main_ndev ) ; struct wil_p2p_info * p2p = & vif -> p2p ; struct cfg80211_scan_info info = { . aborted = true } ; lockdep_assert_held ( & wil -> mutex ) ; lockdep_assert_held ( & wil -> vif_mutex ) ; if ( wil -> radio_wdev != wil -> p2p_wdev ) { out } if ( ! p2p -> discovery_started ) { if ( vif -> scan_request && vif -> scan_request -> wdev == wil -> p2p_wdev ) { wil_abort_scan ( vif , true ) ; } out } mutex_unlock ( & wil -> vif_mutex ) ; wil_p2p_stop_discovery ( vif ) ; mutex_lock ( & wil -> vif_mutex ) ; if ( vif -> scan_request ) { vif -> scan_request = NULL ; } else { cfg80211_remain_on_channel_expired ( wil -> radio_wdev , p2p -> cookie , & p2p -> listen_chan , GFP_KERNEL ) ; } out wil -> radio_wdev = wil -> main_ndev -> ieee80211_ptr ; } 