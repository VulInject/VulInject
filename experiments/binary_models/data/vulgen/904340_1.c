static int ad7124_write_config ( struct ad7124_state * st , struct ad7124_channel_config * cfg , unsigned int cfg_slot ) { unsigned int tmp ; unsigned int val ; int ret ; cfg -> cfg_slot = cfg_slot ; val = AD7124_CONFIG_BIPOLAR ( cfg -> bipolar ) | AD7124_CONFIG_REF_SEL ( cfg -> refsel ) | AD7124_CONFIG_IN_BUFF ( tmp ) ; ret = ad_sd_write_reg ( & st -> sd , AD7124_CONFIG ( cfg -> cfg_slot ) , 2 , val ) ; if ( ret < 0 ) { return ret ; } tmp = AD7124_FILTER_TYPE_SEL ( cfg -> filter_type ) ; ret = ad7124_spi_write_mask ( st , AD7124_FILTER ( cfg -> cfg_slot ) , AD7124_FILTER_TYPE_MSK , tmp , 3 ) ; if ( ret < 0 ) { return ret ; } ret = ad7124_spi_write_mask ( st , AD7124_FILTER ( cfg -> cfg_slot ) , AD7124_FILTER_FS_MSK , AD7124_FILTER_FS ( cfg -> odr_sel_bits ) , 3 ) ; if ( ret < 0 ) { return ret ; } return ad7124_spi_write_mask ( st , AD7124_CONFIG ( cfg -> cfg_slot ) , AD7124_CONFIG_PGA_MSK , AD7124_CONFIG_PGA ( cfg -> pga_bits ) , 2 ) ; } 