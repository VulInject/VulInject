* - inserts code . * - sets any registers , * - enables FIQ . * 3. Owner B claims FIQ : * - ; if , * - enables FIQ . * 5. Owner B releases FIQ : * - Owner A is asked to reacquire FIQ : * - inserts code . * - restores saved registers . * - enables FIQ . * 6. Goto 3 * / extern void * vector_fiq_offset ; ( unsigned ) & vector_fiq_offset ; static unsigned long dfl_fiq_insn ; static struct pt_regs dfl_fiq_regs ; static int fiq_def_op ( void * ref , int relinquish ) { if ( ! relinquish ) { set_fiq_regs ( & dfl_fiq_regs ) ; set_fiq_handler ( & dfl_fiq_insn , sizeof ( dfl_fiq_insn ) ) ; local_fiq_enable ( ) ; } return 0 ; } 