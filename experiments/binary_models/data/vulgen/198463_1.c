textdomain ( ) const char * domainname ; { nl_catd new_catalog ; char * new_name ; size_t new_name_len ; char * lang ; && defined HAVE_LOCALE_NULL lang = setlocale ( LC_MESSAGES , NULL ) ; lang = getenv ( "LC_ALL" ) ; if ( lang == NULL || lang [ 0 ] == '\0' ) { lang = getenv ( "LC_MESSAGES" ) ; if ( lang == NULL || lang [ 0 ] == '\0' ) { lang = getenv ( "LANG" ) ; } } if ( lang == NULL || lang [ 0 ] == '\0' ) { lang = "C" ; } if ( domainname == NULL ) { return ( char * ) catalog_name ; } if ( domainname [ 0 ] == '\0' ) { domainname = default_catalog_name ; } new_name = ( char * ) malloc ( new_name_len ) ; if ( new_name == NULL ) { return NULL ; } strcpy ( new_name , PACKAGE ) ; new_catalog = catopen ( new_name , 0 ) ; if ( new_catalog == ( nl_catd ) - 1 ) { sprintf ( new_name , "%s/%s/LC_MESSAGES/%s.cat" , LOCALEDIR , lang , PACKAGE ) ; new_catalog = catopen ( new_name , 0 ) ; if ( new_catalog == ( nl_catd ) - 1 ) { free ( new_name ) ; return ( char * ) catalog_name ; } } if ( catalog != ( nl_catd ) - 1 ) { catclose ( catalog ) ; } if ( catalog_name != default_catalog_name ) { free ( ( char * ) catalog_name ) ; } catalog = new_catalog ; catalog_name = new_name ; return ( char * ) catalog_name ; } 