static int ufs_qcom_check_hibern8 ( struct ufs_hba * hba ) { int err ; u32 tx_fsm_val = 0 ; { err = ufshcd_dme_get ( hba , UIC_ARG_MIB_SEL ( MPHY_TX_FSM_STATE , UIC_ARG_MPHY_TX_GEN_SEL_INDEX ( 0 ) ) , & tx_fsm_val ) ; if ( err || tx_fsm_val == TX_FSM_HIBERN8 ) { break ; } usleep_range ( 100 , 200 ) ; } time_before ( jiffies , timeout ) ; if ( time_after ( jiffies , timeout ) ) { err = ufshcd_dme_get ( hba , UIC_ARG_MIB_SEL ( MPHY_TX_FSM_STATE , UIC_ARG_MPHY_TX_GEN_SEL_INDEX ( 0 ) ) , & tx_fsm_val ) ; } if ( err ) { dev_err ( hba -> dev , "%s: unable to get TX_FSM_STATE, err %d\n" , __func__ , err ) ; } if ( tx_fsm_val != TX_FSM_HIBERN8 ) { err = tx_fsm_val ; dev_err ( hba -> dev , "%s: invalid TX_FSM_STATE = %d\n" , __func__ , err ) ; } return err ; } 