prescan_quantize ( , , , ) { my_cquantize_ptr cquantize = ( my_cquantize_ptr ) cinfo -> cquantize ; register JSAMPROW ptr ; register histptr histp ; register hist3d histogram = cquantize -> histogram ; int row ; JDIMENSION col ; JDIMENSION width = cinfo -> output_width ; for ( row = 0 ; row < num_rows ; row ++ ) { ptr = input_buf [ row ] ; for ( col = width ; col > 0 ; col -- ) { histp = & histogram [ GETJSAMPLE ( ptr [ 0 ] ) >> C0_SHIFT ] [ GETJSAMPLE ( ptr [ 1 ] ) >> C1_SHIFT ] [ GETJSAMPLE ( ptr [ 2 ] ) >> C2_SHIFT ] ; ptr += 3 ; } } } { int c0min c0max ; int c1min c1max ; int c2min c2max ; INT32 volume ; long colorcount ; } box box * boxptr LOCAL ( ) find_biggest_color_pop ( , ) { register boxptr boxp ; register int i ; register long maxc = 0 ; boxptr which = NULL ; for ( i = 0 , boxp = boxlist ; i < numboxes ; i ++ , boxp ++ ) { if ( boxp -> colorcount > maxc && boxp -> volume > 0 ) { which = boxp ; maxc = boxp -> colorcount ; } } return which ; } 