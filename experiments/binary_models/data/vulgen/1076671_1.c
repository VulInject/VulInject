struct wsgi_request * uwsgi_greenlet_current_wsgi_req ( void ) { struct wsgi_request * wsgi_req = NULL ; PyObject * current_greenlet = ( PyObject * ) PyGreenlet_GetCurrent ( ) ; PyObject * py_wsgi_req = PyObject_GetAttrString ( current_greenlet , "uwsgi_wsgi_req" ) ; wsgi_req = ( wsgi_request * ) PyLong_AsLong ( py_wsgi_req ) ; Py_DECREF ( py_wsgi_req ) ; end Py_DECREF ( current_greenlet ) ; return wsgi_req ; } 