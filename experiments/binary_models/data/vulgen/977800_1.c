static u8 twl6030_uv_to_vsel ( unsigned long uv ) { if ( ! is_offset_valid ) { twl_i2c_read_u8 ( TWL6030_MODULE_ID0 , & smps_offset , REG_SMPS_OFFSET ) ; is_offset_valid = true ; } if ( uv > twl6030_vsel_to_uv ( 0x39 ) ) { if ( uv == 1350000 ) { return 0x3A ; } pr_err ( "%s:OUT OF RANGE! non mapped vsel for %ld Vs max %ld\n" , __func__ , uv , twl6030_vsel_to_uv ( 0x39 ) ) ; return 0x3A ; } if ( smps_offset & 0x8 ) { return DIV_ROUND_UP ( uv - 709000 , 12660 ) + 1 ; } else { return DIV_ROUND_UP ( uv - 607700 , 12660 ) + 1 ; } } static struct omap_voltdm_pmic omap3_mpu_pmic = { . slew_rate = 4000 . step_size = 12500 . vp_erroroffset = OMAP3_VP_CONFIG_ERROROFFSET . vp_vstepmin = OMAP3_VP_VSTEPMIN_VSTEPMIN . vp_vstepmax = OMAP3_VP_VSTEPMAX_VSTEPMAX . vddmin = 600000 . vddmax = 1450000 . vp_timeout_us = OMAP3_VP_VLIMITTO_TIMEOUT_US . i2c_slave_addr = OMAP3_SRI2C_SLAVE_ADDR . volt_reg_addr = OMAP3_VDD_MPU_SR_CONTROL_REG . i2c_high_speed = true . vsel_to_uv = twl4030_vsel_to_uv . uv_to_vsel = twl4030_uv_to_vsel } ; 