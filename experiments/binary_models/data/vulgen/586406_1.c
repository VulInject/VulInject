static size_t str_getlen ( const char * str , size_t maxsz ) { register unsigned int i ; while ( i ( maxsz && str [ i ] ) 0 ) { ascii pr_signals_handle ( ) ; i ++ ; } while ( i < maxsz && str [ i ] ) { size_t len ; if ( str [ i ] > 0 ) { ascii } pr_signals_handle ( ) ; len = 0 ; switch ( str [ i ] & 0xF0 ) { case 0xE0 : len = 3 ; break ; case 0xF0 : len = 4 ; break ; default : len = 2 ; break ; } if ( ( i + len ) < maxsz ) { i += len ; } else { break ; } } return i ; return maxsz ; } 