struct hisi_clock_data * hisi_clk_alloc ( struct platform_device * pdev , int nr_clks ) { struct hisi_clock_data * clk_data ; struct resource * res ; struct clk * * clk_table ; clk_data = devm_kmalloc ( & pdev -> dev , sizeof ( * clk_data ) , GFP_KERNEL ) ; if ( ! clk_data ) { return NULL ; } res = platform_get_resource ( pdev , IORESOURCE_MEM , 0 ) ; clk_data -> base = devm_ioremap ( & pdev -> dev , res -> start , resource_size ( res ) ) ; if ( ! clk_data -> base ) { return NULL ; } if ( ! clk_table ) { return NULL ; } clk_data -> clk_data . clks = clk_table ; clk_data -> clk_data . clk_num = nr_clks ; return clk_data ; } 