static void panel_detach ( struct parport * port ) { if ( port -> number != parport ) { return ; } if ( ! pprt ) { pr_err ( "%s: port->number=%d parport=%d, nothing to unregister.\n" , __func__ , port -> number , parport ) ; return ; } if ( scan_timer . function ) { charlcd_unregister ( 0 ) ; lcd . initialized = false ; kfree ( lcd . charlcd -> drvdata ) ; kfree ( lcd . charlcd ) ; lcd . charlcd = NULL ; } if ( keypad . enabled ) { misc_deregister ( & keypad_dev ) ; keypad_initialized = 0 ; } if ( lcd . enabled ) { charlcd_unregister ( lcd . charlcd ) ; lcd . initialized = false ; kfree ( lcd . charlcd -> drvdata ) ; kfree ( lcd . charlcd ) ; lcd . charlcd = NULL ; } parport_release ( pprt ) ; parport_unregister_device ( pprt ) ; pprt = NULL ; } 