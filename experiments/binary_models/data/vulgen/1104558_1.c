MODULE_DESCRIPTION ( "helper module to manage video4linux dma sg buffers" ) ; MODULE_AUTHOR ( "Mauro Carvalho Chehab<mchehab@infradead.org>" ) ; MODULE_LICENSE ( "GPL" ) ; if ( debug >= level ) { printk ( "vbuf-sg: " , ) static struct scatterlist * videobuf_vmalloc_to_sg ( unsigned char * virt , int nr_pages ) { struct scatterlist * sglist ; struct page * pg ; int i ; sglist = vzalloc ( nr_pages * sizeof ( * sglist ) ) ; sg_init_table ( sglist , nr_pages ) ; for ( i = 0 ; i < nr_pages ; i ++ , virt += PAGE_SIZE ) { pg = vmalloc_to_page ( virt ) ; if ( NULL == pg ) { err } BUG_ON ( PageHighMem ( pg ) ) ; sg_set_page ( & sglist [ i ] , pg , PAGE_SIZE , 0 ) ; } return sglist ; err vfree ( sglist ) ; return NULL ; } } 