static int get_serial_info ( struct tty_struct * tty , struct serial_state * state , struct serial_struct __user * retinfo ) { struct serial_struct tmp ; tty_lock ( tty ) ; tmp . line = tty -> index ; tmp . port = state -> port ; tmp . flags = state -> tport . flags ; tmp . xmit_fifo_size = state -> xmit_fifo_size ; tmp . baud_base = state -> baud_base ; tmp . close_delay = state -> tport . close_delay ; tmp . closing_wait = state -> tport . closing_wait ; tmp . custom_divisor = state -> custom_divisor ; tty_unlock ( tty ) ; if ( copy_to_user ( retinfo , & tmp , sizeof ( * retinfo ) ) ) { return - EFAULT ; } return 0 ; } 