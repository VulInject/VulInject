time_stamp_server ( , , ) char * file ; Vers_TS * vers_ts ; Entnode * entdata ; { struct stat sb ; char * cp ; if ( CVS_LSTAT ( file , & sb ) < 0 ) { if ( ! existence_error ( errno ) ) { error ( 1 , errno , "cannot stat temp file" ) ; } if ( entdata == NULL ) { mark_lost ( vers_ts ) ; } if ( entdata -> timestamp && entdata -> timestamp [ 0 ] == '=' ) { memcpy ( & local_tm , tm_p , 0 ) ; cp = asctime ( & local_tm ) ; } if ( entdata -> timestamp != NULL && ( entdata -> timestamp [ 0 ] == 'M' || entdata -> timestamp [ 0 ] == 'D' ) && entdata -> timestamp [ 1 ] == '\0' ) { vers_ts -> ts_user = xstrdup ( "Is-modified" ) ; } else { mark_lost ( vers_ts ) ; } } if ( sb . st_mtime == 0 ) { abort ( ) ; } else { struct tm * tm_p ; struct tm local_tm ; vers_ts -> ts_user = xmalloc ( 25 ) ; tm_p = gmtime ( & sb . st_mtime ) ; if ( tm_p ) { memcpy ( & local_tm , tm_p , sizeof ( local_tm ) ) ; cp = asctime ( & local_tm ) ; } else { cp = ctime ( & sb . st_mtime ) ; } cp [ 24 ] = 0 ; if ( cp [ 8 ] == '0' ) { cp [ 8 ] = ' ' ; } ( void ) strcpy ( vers_ts -> ts_user , cp ) ; } } 