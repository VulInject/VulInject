unsigned char utf8_to_iso_8859_1 ( const char * utf8 , size_t * len ) { unsigned char c = * utf8 ; uint32_t wc ; if ( c < 0x80 ) { * len = 1 ; return c ; } if ( c < 0xe0 ) { * len = 2 ; if ( wc <= 0xff ) { return ( unsigned char ) wc ; } else { return '?' ; } } if ( c < 0xf0 ) { * len = 3 ; return '?' ; } if ( c < 0xf8 ) { * len = 4 ; return '?' ; } if ( c < 0xfc ) { * len = 5 ; return '?' ; } if ( c < 0xfe ) { * len = 6 ; return '?' ; } else { return '?' ; } } 