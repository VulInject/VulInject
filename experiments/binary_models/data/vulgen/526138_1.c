tool_manager_init ( ) { GimpToolManager * tool_manager ; GimpContext * user_context ; g_return_if_fail ( GIMP_IS_GIMP ( gimp ) ) ; g_return_if_fail ( tool_manager_quark == 0 ) ; tool_manager = g_slice_new0 ( GimpToolManager ) ; tool_manager -> gimp = gimp ; g_object_set_qdata ( G_OBJECT ( gimp ) , tool_manager_quark , tool_manager ) ; tool_manager -> image_clean_handler_id = gimp_container_add_handler ( gimp -> images , "clean" , G_CALLBACK ( tool_manager_image_clean_dirty ) , tool_manager ) ; tool_manager -> image_dirty_handler_id = gimp_container_add_handler ( gimp -> images , "dirty" , G_CALLBACK ( tool_manager_image_clean_dirty ) , tool_manager ) ; tool_manager -> image_saving_handler_id = gimp_container_add_handler ( gimp -> images , "saving" , G_CALLBACK ( tool_manager_image_saving ) , tool_manager ) ; user_context = gimp_get_user_context ( gimp ) ; g_signal_connect ( user_context , "tool-changed" , G_CALLBACK ( tool_manager_tool_changed ) , tool_manager ) ; g_signal_connect ( user_context , "tool-preset-changed" , G_CALLBACK ( tool_manager_preset_changed ) , tool_manager ) ; g_signal_connect ( user_context , "image-changed" , G_CALLBACK ( tool_manager_image_changed ) , tool_manager ) ; tool_manager_image_changed ( user_context , gimp_context_get_image ( user_context ) , tool_manager ) ; tool_manager_selected_layers_changed ( gimp_context_get_image ( user_context ) , tool_manager ) ; tool_manager_tool_changed ( user_context , gimp_context_get_tool ( user_context ) , tool_manager ) ; } 