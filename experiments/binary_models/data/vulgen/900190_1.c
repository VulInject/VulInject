static void check_header ( struct sd * s ) { int method ; int flags ; unsigned int len ; int c ; for ( len = 0 ; len < 2 ; len ++ ) { c = get_byte ( s ) ; if ( c != gz_magic [ len ] ) { if ( len != 0 ) { s -> stream . avail_in ++ ; s -> stream . next_in -- ; } if ( c != EOF ) { s -> stream . avail_in ++ ; s -> stream . next_in -- ; } s -> z_err = s -> stream . avail_in != 0 ?Z_OK : Z_STREAM_END ; return ; } } method = get_byte ( s ) ; flags = get_byte ( s ) ; if ( method != Z_DEFLATED || ( flags & RESERVED ) != 0 ) { s -> z_err = Z_DATA_ERROR ; return ; } for ( len = 0 ; len < 6 ; len ++ ) { ( void ) get_byte ( s ) ; } if ( ( flags & EXTRA_FIELD ) != 0 ) { len = ( unsigned int ) get_byte ( s ) ; len += ( ( unsigned int ) get_byte ( s ) ) << 8 ; while ( len -- != 0 && get_byte ( s ) != EOF ) { } } if ( ( flags & ORIG_NAME ) != 0 ) { while ( ( c = get_byte ( s ) ) != 0 && c != EOF ) { } } if ( ( flags & COMMENT ) != 0 ) { while ( ( c = get_byte ( s ) ) != 0 && c != EOF ) { } } if ( ( flags & HEAD_CRC ) != 0 ) { for ( len = 0 ; len < 2 ; len ++ ) { ( void ) get_byte ( s ) ; } } s -> z_err = s -> z_eof ?Z_DATA_ERROR : Z_OK ; } 