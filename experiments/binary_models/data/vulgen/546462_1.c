reginfo_event_t * pop_reginfo_event ( ) { reginfo_event_t * ev ; lock_get ( reginfo_event_list -> lock ) ; while ( reginfo_event_list -> head == 0 ) { lock_release ( reginfo_event_list -> lock ) ; sem_get ( reginfo_event_list -> empty ) ; lock_get ( reginfo_event_list -> lock ) ; } ev = reginfo_event_list -> head ; reginfo_event_list -> head = ev -> next ; if ( ev == reginfo_event_list -> tail ) { reginfo_event_list -> tail = 0 ; } ev -> next = 0 ; reginfo_event_list -> size -- ; lock_release ( reginfo_event_list -> lock ) ; return ev ; } 