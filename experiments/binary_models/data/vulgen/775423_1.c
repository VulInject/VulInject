static void udf_copy_fi_to_bufs ( char * buf1 , int len1 , char * buf2 , int len2 , int off , struct fileIdentDesc * fi , uint8_t * impuse , uint8_t * name ) { uint16_t crc ; int fioff = off ; int crcoff = off + sizeof ( tag ) ; unsigned int crclen = udf_dir_entry_len ( fi ) - sizeof ( tag ) ; char zeros [ UDF_NAME_PAD ] { } ; ; int endoff = off + udf_dir_entry_len ( fi ) ; udf_copy_to_bufs ( buf1 , len1 , buf2 , len2 , off , fi , sizeof ( fileIdentDesc ) ) ; off += sizeof ( fileIdentDesc ) ; off += le16_to_cpu ( fi -> lengthOfImpUse ) ; if ( name ) { udf_copy_to_bufs ( buf1 , len1 , buf2 , len2 , off , name , fi -> lengthFileIdent ) ; off += fi -> lengthFileIdent ; udf_copy_to_bufs ( buf1 , len1 , buf2 , len2 , off , zeros , endoff - off ) ; } crc = udf_crc_fi_bufs ( buf1 , len1 , buf2 , len2 , crcoff , crclen ) ; fi -> descTag . descCRC = cpu_to_le16 ( crc ) ; fi -> descTag . descCRCLength = cpu_to_le16 ( crclen ) ; fi -> descTag . tagChecksum = udf_tag_checksum ( & fi -> descTag ) ; udf_copy_to_bufs ( buf1 , len1 , buf2 , len2 , fioff , fi , sizeof ( tag ) ) ; } 