static uint64_t aspeed_lpc_read ( void * opaque , hwaddr offset , unsigned size ) { AspeedLPCState * s = ASPEED_LPC ( opaque ) ; int reg = TO_REG ( offset ) ; if ( reg >= ARRAY_SIZE ( s -> regs ) ) { qemu_log_mask ( LOG_GUEST_ERROR , "%s: Out-of-bounds read at offset 0x%" HWADDR_PRIx "\n" , __func__ , offset ) ; return 0 ; } switch ( reg ) { case IDR1 : case IDR2 : case IDR3 : case IDR4 : { const struct aspeed_kcs_channel * channel ; channel = aspeed_kcs_get_channel_by_register ( reg ) ; if ( s -> regs [ channel -> str ] & STR_IBF ) { enum aspeed_lpc_subdevice subdev ; subdev = aspeed_kcs_subdevice_map [ channel -> id ] ; } s -> regs [ channel -> str ] &= ~ STR_IBF ; break ; } default : break ; } return s -> regs [ reg ] ; } 