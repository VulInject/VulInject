static rsRetVal queueBatchOnRetryRuleset ( wrkrInstanceData_t * const pWrkrData , instanceData * const pData ) { uchar * msgData ; smsg_t * pMsg ; DEFiRet ; for ( size_t i = 0 ; i < pWrkrData -> batch . nmemb ; i ++ ) { msgData = pWrkrData -> batch . data [ i ] ; DBGPRINTF ( "omhttp: queueBatchOnRetryRuleset putting message '%s' into retry ruleset '%s'\n" , msgData , pData -> retryRulesetName ) ; CHKiRet ( msgConstruct ( & pMsg ) ) ; CHKiRet ( MsgSetFlowControlType ( pMsg , eFLOWCTL_FULL_DELAY ) ) ; MsgSetInputName ( pMsg , pInputName ) ; MsgSetRawMsg ( pMsg , ( const char * ) msgData , ustrlen ( msgData ) ) ; MsgSetMSGoffs ( pMsg , 0 ) ; MsgSetTAG ( pMsg , ( const uchar * ) "omhttp-retry" , 12 ) ; MsgSetRuleset ( pMsg , pData -> retryRuleset ) ; ratelimitAddMsg ( pData -> ratelimiter , NULL , pMsg ) ; STATSCOUNTER_INC ( ctrMessagesRetry , mutCtrMessagesRetry ) ; } finalize_it RETiRet ; } 