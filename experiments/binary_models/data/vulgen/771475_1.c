int zfs_iter_snapshots ( zfs_handle_t * zhp , boolean_t simple , zfs_iter_f func , void * data ) { zfs_cmd_t zc = { "\0" } ; zfs_handle_t * nzhp ; int ret ; if ( zhp -> zfs_type == ZFS_TYPE_SNAPSHOT || zhp -> zfs_type == ZFS_TYPE_BOOKMARK ) { return ( 0 ) ; } zc . zc_simple = simple ; if ( zcmd_alloc_dst_nvlist ( zhp -> zfs_hdl , & zc , 0 ) != 0 ) { return ( - 1 ) ; } while ( ( ret = zfs_do_list_ioctl ( zhp , ZFS_IOC_SNAPSHOT_LIST_NEXT , & zc ) ) == 0 ) { if ( simple ) { nzhp = make_dataset_simple_handle_zc ( zhp , & zc ) ; } else { nzhp = make_dataset_handle_zc ( zhp -> zfs_hdl , & zc ) ; } if ( nzhp == NULL ) { continue ; } if ( ( ret = func ( nzhp , data ) ) != 0 ) { return ( ret ) ; } } zcmd_free_nvlists ( & zc ) ; return ( ( ret < 0 ) ?ret : 0 ) ; } 