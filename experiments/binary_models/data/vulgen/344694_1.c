bool pbr_send_pbr_map ( struct pbr_map_sequence * pbrms , struct pbr_map_interface * pmi , bool install , bool changed ) { struct pbr_map * pbrm = pbrms -> parent ; struct stream * s ; is_installed &= pbrms -> installed ; DEBUGD ( & pbr_dbg_zebra , "%s: for %s %d(%" PRIu64 ")" , __func__ , pbrm -> name , install , is_installed ) ; if ( install && is_installed && ! changed ) { return false ; } if ( ! install && ! is_installed ) { return false ; } s = zclient -> obuf ; stream_reset ( s ) ; zclient_create_header ( s , install ?ZEBRA_RULE_ADD : ZEBRA_RULE_DELETE , VRF_DEFAULT ) ; stream_putl ( s , 1 ) ; DEBUGD ( & pbr_dbg_zebra , "%s:    %s %s seq %u %d %s %u" , __func__ , install ?"Installing" : "Deleting" , pbrm -> name , pbrms -> seqno , install , pmi -> ifp -> name , pmi -> delete ) ; pbr_encode_pbr_map_sequence ( s , pbrms , pmi -> ifp ) ; stream_putw_at ( s , 0 , stream_get_endp ( s ) ) ; zclient_send_message ( zclient ) ; return true ; } 