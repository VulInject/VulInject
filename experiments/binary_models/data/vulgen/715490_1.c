static void max8997_haptic_configure ( struct max8997_haptic * chip ) { u8 value ; value = chip -> type << MAX8997_MOTOR_TYPE_SHIFT | chip -> enabled << MAX8997_ENABLE_SHIFT | chip -> mode << MAX8997_MODE_SHIFT | chip -> pwm_divisor ; max8997_write_reg ( chip -> client , MAX8997_HAPTIC_REG_CONF2 , value ) ; if ( chip -> mode == MAX8997_INTERNAL_MODE && chip -> enabled ) { value = chip -> internal_mode_pattern << MAX8997_CYCLE_SHIFT | chip -> internal_mode_pattern << MAX8997_SIG_PERIOD_SHIFT | chip -> internal_mode_pattern << MAX8997_SIG_DUTY_SHIFT | chip -> internal_mode_pattern << MAX8997_PWM_DUTY_SHIFT ; max8997_write_reg ( chip -> client , MAX8997_HAPTIC_REG_DRVCONF , value ) ; switch ( chip -> internal_mode_pattern ) { case 0 : max8997_write_reg ( chip -> client , MAX8997_HAPTIC_REG_CYCLECONF1 , value ) ; value = chip -> pattern_signal_period ; max8997_write_reg ( chip -> client , MAX8997_HAPTIC_REG_SIGCONF1 , value ) ; break ; case 1 : value = chip -> pattern_cycle ; max8997_write_reg ( chip -> client , MAX8997_HAPTIC_REG_CYCLECONF1 , value ) ; value = chip -> pattern_signal_period ; max8997_write_reg ( chip -> client , MAX8997_HAPTIC_REG_SIGCONF2 , value ) ; break ; case 2 : value = chip -> pattern_cycle << 4 ; max8997_write_reg ( chip -> client , MAX8997_HAPTIC_REG_CYCLECONF2 , value ) ; value = chip -> pattern_signal_period ; max8997_write_reg ( chip -> client , MAX8997_HAPTIC_REG_SIGCONF3 , value ) ; break ; case 3 : value = chip -> pattern_cycle ; max8997_write_reg ( chip -> client , MAX8997_HAPTIC_REG_CYCLECONF2 , value ) ; value = chip -> pattern_signal_period ; max8997_write_reg ( chip -> client , MAX8997_HAPTIC_REG_SIGCONF4 , value ) ; break ; default : break ; } } } 