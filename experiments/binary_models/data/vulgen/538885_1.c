static void smc_tx_err ( struct net_device * dev ) { struct smc_private * smc = netdev_priv ( dev ) ; unsigned int ioaddr = dev -> base_addr ; int saved_packet = inw ( ioaddr + PNR_ARR ) & 0xff ; int packet_no = inw ( ioaddr + FIFO_PORTS ) & 0x7f ; int tx_status ; outw ( packet_no , ioaddr + PNR_ARR ) ; outw ( PTR_AUTOINC | PTR_READ | 0 , ioaddr + POINTER ) ; tx_status = inw ( ioaddr + DATA_1 ) ; dev -> stats . tx_errors ++ ; if ( tx_status & TS_LOSTCAR ) { dev -> stats . tx_carrier_errors ++ ; } if ( tx_status & TS_LATCOL ) { dev -> stats . tx_window_errors ++ ; } if ( tx_status & TS_16COL ) { dev -> stats . tx_aborted_errors ++ ; smc -> tx_err ++ ; } if ( tx_status & TS_SUCCESS ) { netdev_notice ( dev , "Successful packet caused error interrupt?\n" ) ; } SMC_SELECT_BANK ( 0 ) ; outw ( inw ( ioaddr + TCR ) | TCR_ENABLE | smc -> duplex , ioaddr + TCR ) ; SMC_SELECT_BANK ( 2 ) ; smc -> packets_waiting -- ; outw ( saved_packet , ioaddr + PNR_ARR ) ; } 