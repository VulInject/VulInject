int i40e_update_adq_vsi_queues ( struct i40e_vsi * vsi , int vsi_offset ) { struct i40e_vsi_context ctxt = { } ; struct i40e_pf * pf ; struct i40e_hw * hw ; int ret ; if ( ! vsi ) { return I40E_ERR_PARAM ; } pf = vsi -> back ; hw = & pf -> hw ; ctxt . seid = vsi -> seid ; ctxt . pf_num = hw -> pf_id ; ctxt . vf_num = vsi -> vf_id + hw -> func_caps . vf_base_id + vsi_offset ; ctxt . uplink_seid = vsi -> uplink_seid ; ctxt . connection_type = I40E_AQ_VSI_CONN_TYPE_NORMAL ; ctxt . flags = I40E_AQ_VSI_TYPE_VF ; ctxt . info = vsi -> info ; i40e_vsi_setup_queue_map ( vsi , & ctxt , vsi -> tc_config . enabled_tc , false ) ; if ( vsi -> reconfig_rss ) { vsi -> rss_size = min_t ( int , pf -> alloc_rss_size , vsi -> num_queue_pairs ) ; ret = i40e_vsi_config_rss ( vsi ) ; vsi -> reconfig_rss = false ; } ret = i40e_aq_update_vsi_params ( hw , & ctxt , NULL ) ; if ( ret ) { dev_info ( & pf -> pdev -> dev , "Update vsi config failed, err %pe aq_err %s\n" , ERR_PTR ( ret ) , i40e_aq_str ( hw , hw -> aq . asq_last_status ) ) ; return ret ; } i40e_vsi_update_queue_map ( vsi , & ctxt ) ; vsi -> info . valid_sections = 0 ; return ret ; } 