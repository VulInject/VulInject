static int dhcp_finish_expire ( dhcp_smach_t * dsmp , void * arg ) { dhcp_lif_t * lif = arg ; dhcp_lease_t * dlp ; dhcpmsg ( MSG_DEBUG , "lease expired on %s; removing" , lif -> lif_name ) ; dlp = lif -> lif_lease ; unplumb_lif ( lif ) ; if ( dlp -> dl_nlifs == 0 ) { remove_lease ( dlp ) ; } release_lif ( lif ) ; if ( dsmp -> dsm_leases != NULL ) { dhcpmsg ( MSG_DEBUG , "dhcp_finish_expire: some leases remain on %s" , dsmp -> dsm_name ) ; return ( 1 ) ; } ( void ) remove_hostconf ( dsmp -> dsm_name , dsmp -> dsm_isv6 ) ; dhcpmsg ( MSG_INFO , "last lease expired on %s -- restarting DHCP" , dsmp -> dsm_name ) ; if ( dsmp -> dsm_state == BOUND ) { dsmp -> dsm_bad_offers = 0 ; dsmp -> dsm_sent = 0 ; dsmp -> dsm_received = 0 ; } deprecate_leases ( dsmp ) ; return ( 1 ) ; } 