merge_constrained ( , , , ) { idx_t i = 0 , j = 0 ; if ( m -> alloc - s1 -> nelem < s2 -> nelem ) { free ( m -> elems ) ; m -> alloc = s1 -> nelem ; m -> elems = xpalloc ( NULL , & m -> alloc , s2 -> nelem , - 1 , sizeof m -> elems ) ; } m -> nelem = 0 ; while ( i < s1 -> nelem || j < s2 -> nelem ) { if ( ! ( j < s2 -> nelem ) || ( i < s1 -> nelem && s1 -> elems [ i ] . index <= s2 -> elems [ j ] . index ) ) { unsigned int c = ( ( i < s1 -> nelem && j < s2 -> nelem && s1 -> elems [ i ] . index == s2 -> elems [ j ] . index ) ?s2 -> elems [ j ++ ] . constraint & c2 : 0 ) ; m -> elems [ m -> nelem ] . index = s1 -> elems [ i ] . index ; m -> elems [ m -> nelem ++ ] . constraint = s1 -> elems [ i ++ ] . constraint | c ; } else { j ++ ; } } } 