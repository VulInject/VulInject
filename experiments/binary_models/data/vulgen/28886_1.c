static bool makeDependencyGraphWalker ( Node * node , CteState * cstate ) { if ( IsA ( node , RangeVar ) ) { RangeVar * rv = ( RangeVar * ) node ; if ( ! rv -> schemaname ) { ListCell * lc ; int i ; ( lc cstate -> innerwiths ; ) { List * withlist = ( List * ) lfirst ( lc ) ; ListCell * lc2 ; ( lc2 withlist ; ) { CommonTableExpr * cte = ( CommonTableExpr * ) lfirst ( lc2 ) ; if ( strcmp ( rv -> relname , cte -> ctename ) == 0 ) { return false ; } } } for ( i = 0 ; i < cstate -> numitems ; i ++ ) { CommonTableExpr * cte = cstate -> items [ i ] . cte ; if ( strcmp ( rv -> relname , cte -> ctename ) == 0 ) { int myindex = cstate -> curitem ; if ( i != myindex ) { cstate -> items [ myindex ] . depends_on = bms_add_member ( cstate -> items [ myindex ] . depends_on , cstate -> items [ i ] . id ) ; } else { cte -> cterecursive = true ; } break ; } } } return false ; } if ( IsA ( node , SelectStmt ) ) { SelectStmt * stmt = ( SelectStmt * ) node ; ListCell * lc ; if ( stmt -> withClause ) { if ( stmt -> withClause -> recursive ) { cstate -> innerwiths = lcons ( stmt -> withClause -> ctes , cstate -> innerwiths ) ; ( lc stmt -> withClause -> ctes ; ) { CommonTableExpr * cte = ( CommonTableExpr * ) lfirst ( lc ) ; ( void ) makeDependencyGraphWalker ( cte -> ctequery , cstate ) ; } ( void ) raw_expression_tree_walker ( node , makeDependencyGraphWalker , ( void * ) cstate ) ; cstate -> innerwiths = list_delete_first ( cstate -> innerwiths ) ; } else { cstate -> innerwiths = lcons ( NIL , cstate -> innerwiths ) ; ( lc stmt -> withClause -> ctes ; ) { CommonTableExpr * cte = ( CommonTableExpr * ) lfirst ( lc ) ; ListCell * cell1 ; ( void ) makeDependencyGraphWalker ( cte -> ctequery , cstate ) ; cell1 = list_head ( cstate -> innerwiths ) ; lfirst ( cell1 ) = lappend ( ( List * ) lfirst ( cell1 ) , cte ) ; } ( void ) raw_expression_tree_walker ( node , makeDependencyGraphWalker , ( void * ) cstate ) ; cstate -> innerwiths = list_delete_first ( cstate -> innerwiths ) ; } return false ; } } if ( IsA ( node , WithClause ) ) { return false ; } return raw_expression_tree_walker ( node , makeDependencyGraphWalker , ( void * ) cstate ) ; } 