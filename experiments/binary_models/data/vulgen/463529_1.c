machopic_select_section ( , , ) { section * base_section ; bool weak_p = ( DECL_P ( exp ) && DECL_WEAK ( exp ) && ( lookup_attribute ( "weak" , DECL_ATTRIBUTES ( exp ) ) || ! lookup_attribute ( "weak_import" , DECL_ATTRIBUTES ( exp ) ) ) ) ; if ( TREE_CODE ( exp ) == FUNCTION_DECL ) { if ( reloc == 1 ) { base_section = ( weak_p ?darwin_sections [ text_unlikely_coal_section ] : unlikely_text_section ( ) ) ; } else { base_section = weak_p ?darwin_sections [ text_coal_section ] : text_section ; } } if ( decl_readonly_section ( exp , reloc ) ) { base_section = weak_p ?darwin_sections [ const_coal_section ] : darwin_sections [ const_section ] ; } if ( TREE_READONLY ( exp ) || TREE_CONSTANT ( exp ) ) { base_section = weak_p ?darwin_sections [ const_data_coal_section ] : darwin_sections [ const_data_section ] ; } else { base_section = weak_p ?darwin_sections [ data_coal_section ] : data_section ; } if ( TREE_CODE ( exp ) == STRING_CST && ( ( size_t ) TREE_STRING_LENGTH ( exp ) == strlen ( TREE_STRING_POINTER ( exp ) ) + 1 ) ) { return darwin_sections [ cstring_section ] ; } if ( ( TREE_CODE ( exp ) == INTEGER_CST || TREE_CODE ( exp ) == REAL_CST ) && flag_merge_constants ) { tree size = TYPE_SIZE_UNIT ( TREE_TYPE ( exp ) ) ; if ( TREE_CODE ( size ) == INTEGER_CST && TREE_INT_CST_LOW ( size ) == 4 && TREE_INT_CST_HIGH ( size ) == 0 ) { return darwin_sections [ literal4_section ] ; } if ( TREE_CODE ( size ) == INTEGER_CST && TREE_INT_CST_LOW ( size ) == 8 && TREE_INT_CST_HIGH ( size ) == 0 ) { return darwin_sections [ literal8_section ] ; } if ( TARGET_64BIT && TREE_CODE ( size ) == INTEGER_CST && TREE_INT_CST_LOW ( size ) == 16 && TREE_INT_CST_HIGH ( size ) == 0 ) { return darwin_sections [ literal16_section ] ; } else { return base_section ; } } if ( TREE_CODE ( exp ) == CONSTRUCTOR && TREE_TYPE ( exp ) && TREE_CODE ( TREE_TYPE ( exp ) ) == RECORD_TYPE && TYPE_NAME ( TREE_TYPE ( exp ) ) ) { tree name = TYPE_NAME ( TREE_TYPE ( exp ) ) ; if ( ! strcmp ( IDENTIFIER_POINTER ( name ) , "__builtin_ObjCString" ) ) { if ( flag_next_runtime ) { return darwin_sections [ objc_constant_string_object_section ] ; } else { return darwin_sections [ objc_string_object_section ] ; } } else { return base_section ; } } if ( TREE_CODE ( exp ) == VAR_DECL && DECL_NAME ( exp ) && TREE_CODE ( DECL_NAME ( exp ) ) == IDENTIFIER_NODE && IDENTIFIER_POINTER ( DECL_NAME ( exp ) ) && ! strncmp ( IDENTIFIER_POINTER ( DECL_NAME ( exp ) ) , "_OBJC_" , 6 ) ) { const char * name = IDENTIFIER_POINTER ( DECL_NAME ( exp ) ) ; if ( ! strncmp ( name , "_OBJC_CLASS_METHODS_" , 20 ) ) { return darwin_sections [ objc_cls_meth_section ] ; } if ( ! strncmp ( name , "_OBJC_INSTANCE_METHODS_" , 23 ) ) { return darwin_sections [ objc_inst_meth_section ] ; } if ( ! strncmp ( name , "_OBJC_CATEGORY_CLASS_METHODS_" , 20 ) ) { return darwin_sections [ objc_cat_cls_meth_section ] ; } if ( ! strncmp ( name , "_OBJC_CATEGORY_INSTANCE_METHODS_" , 23 ) ) { return darwin_sections [ objc_cat_inst_meth_section ] ; } if ( ! strncmp ( name , "_OBJC_CLASS_VARIABLES_" , 22 ) ) { return darwin_sections [ objc_class_vars_section ] ; } if ( ! strncmp ( name , "_OBJC_INSTANCE_VARIABLES_" , 25 ) ) { return darwin_sections [ objc_instance_vars_section ] ; } if ( ! strncmp ( name , "_OBJC_CLASS_PROTOCOLS_" , 22 ) ) { return darwin_sections [ objc_cat_cls_meth_section ] ; } if ( ! strncmp ( name , "_OBJC_CLASS_NAME_" , 17 ) ) { return darwin_sections [ objc_class_names_section ] ; } if ( ! strncmp ( name , "_OBJC_METH_VAR_NAME_" , 20 ) ) { return darwin_sections [ objc_meth_var_names_section ] ; } if ( ! strncmp ( name , "_OBJC_METH_VAR_TYPE_" , 20 ) ) { return darwin_sections [ objc_meth_var_types_section ] ; } if ( ! strncmp ( name , "_OBJC_CLASS_REFERENCES" , 22 ) ) { return darwin_sections [ objc_cls_refs_section ] ; } if ( ! strncmp ( name , "_OBJC_CLASS_" , 12 ) ) { return darwin_sections [ objc_class_section ] ; } if ( ! strncmp ( name , "_OBJC_METACLASS_" , 16 ) ) { return darwin_sections [ objc_meta_class_section ] ; } if ( ! strncmp ( name , "_OBJC_CATEGORY_" , 15 ) ) { return darwin_sections [ objc_category_section ] ; } if ( ! strncmp ( name , "_OBJC_SELECTOR_REFERENCES" , 25 ) ) { return darwin_sections [ objc_selector_refs_section ] ; } if ( ! strncmp ( name , "_OBJC_SELECTOR_FIXUP" , 20 ) ) { return darwin_sections [ objc_selector_fixup_section ] ; } if ( ! strncmp ( name , "_OBJC_SYMBOLS" , 13 ) ) { return darwin_sections [ objc_symbols_section ] ; } if ( ! strncmp ( name , "_OBJC_MODULES" , 13 ) ) { return darwin_sections [ objc_module_info_section ] ; } if ( ! strncmp ( name , "_OBJC_IMAGE_INFO" , 16 ) ) { return darwin_sections [ objc_image_info_section ] ; } if ( ! strncmp ( name , "_OBJC_PROTOCOL_INSTANCE_METHODS_" , 32 ) ) { return darwin_sections [ objc_cat_inst_meth_section ] ; } if ( ! strncmp ( name , "_OBJC_PROTOCOL_CLASS_METHODS_" , 29 ) ) { return darwin_sections [ objc_cat_cls_meth_section ] ; } if ( ! strncmp ( name , "_OBJC_PROTOCOL_REFS_" , 20 ) ) { return darwin_sections [ objc_cat_cls_meth_section ] ; } if ( ! strncmp ( name , "_OBJC_PROTOCOL_" , 15 ) ) { return darwin_sections [ objc_protocol_section ] ; } else { return base_section ; } } else { return base_section ; } } 