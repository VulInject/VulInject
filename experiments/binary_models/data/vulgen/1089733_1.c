int dplane_ctx_intf_init ( struct zebra_dplane_ctx * ctx , enum dplane_op_e op , const struct interface * ifp ) { struct zebra_ns * zns ; struct zebra_if * zif ; int ret = EINVAL ; bool set_pdown , unset_pdown ; if ( ! ctx || ! ifp ) { return ret ; } ctx -> zd_op = op ; ctx -> zd_status = ZEBRA_DPLANE_REQUEST_SUCCESS ; ctx -> zd_vrf_id = ifp -> vrf -> vrf_id ; strlcpy ( ctx -> zd_ifname , ifp -> name , sizeof ( ctx -> zd_ifname ) ) ; ctx -> zd_ifindex = ifp -> ifindex ; zns = zebra_ns_lookup ( ifp -> vrf -> vrf_id ) ; dplane_ctx_ns_init ( ctx , zns , false ) ; ctx -> u . intf . metric = ifp -> metric ; ctx -> u . intf . flags = ifp -> flags ; zif = ( zebra_if * ) ifp -> info ; if ( zif ) { set_pdown = ! ! ( zif -> flags & ZIF_FLAG_SET_PROTODOWN ) ; unset_pdown = ! ! ( zif -> flags & ZIF_FLAG_UNSET_PROTODOWN ) ; if ( zif -> protodown_rc && ZEBRA_IF_IS_PROTODOWN_ONLY_EXTERNAL ( zif ) == false ) { ctx -> u . intf . pd_reason_val = true ; } if ( set_pdown ) { ctx -> u . intf . protodown = true ; } if ( unset_pdown ) { ctx -> u . intf . protodown = false ; } else { ctx -> u . intf . protodown = ! ! ZEBRA_IF_IS_PROTODOWN ( zif ) ; } } dplane_ctx_ns_init ( ctx , zns , ( op == DPLANE_OP_INTF_UPDATE ) ) ; ret = AOK ; return ret ; } 