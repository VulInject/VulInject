static void _command_list_set_undo_level ( CommandList_t * list , gint level ) { gint diff = g_list_length ( list -> list ) - level ; if ( diff > 0 ) { GList * p , * q ; for ( p = list -> list ; diff && p != list -> undo ; p = q , diff -- ) { Command_t * curr = ( Command_t * ) p -> data ; q = p -> next ; command_destruct ( curr ) ; list -> list = g_list_remove_link ( list -> list , p ) ; } for ( p = g_list_last ( list -> list ) ; diff && p != list -> undo ; p = q , diff -- ) { Command_t * curr = ( Command_t * ) p -> data ; q = p -> prev ; command_destruct ( curr ) ; list -> list = g_list_remove_link ( list -> list , p ) ; } } list -> undo_levels = level ; } 