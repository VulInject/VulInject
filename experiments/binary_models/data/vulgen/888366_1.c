static inline struct rb_entry * rbe_remove ( const struct rb_type * t , struct rbt_tree * rbt , struct rb_entry * rbe ) { struct rb_entry * child , * parent , * old = rbe ; unsigned int color ; if ( RBE_LEFT ( rbe ) == NULL ) { child = RBE_RIGHT ( rbe ) ; } if ( RBE_RIGHT ( rbe ) == NULL ) { child = RBE_LEFT ( rbe ) ; } else { struct rb_entry * tmp ; rbe = RBE_RIGHT ( rbe ) ; while ( ( tmp = RBE_LEFT ( rbe ) ) != NULL ) { rbe = tmp ; } child = RBE_RIGHT ( rbe ) ; parent = RBE_PARENT ( rbe ) ; color = RBE_COLOR ( rbe ) ; if ( child != NULL ) { RBE_PARENT ( child ) = parent ; } if ( parent != NULL ) { if ( RBE_LEFT ( parent ) == rbe ) { RBE_LEFT ( parent ) = child ; } else { RBE_RIGHT ( parent ) = child ; } rbe_if_augment ( t , parent ) ; } else { RBH_ROOT ( rbt ) = child ; } if ( RBE_PARENT ( rbe ) == old ) { parent = rbe ; } * rbe = * old ; tmp = RBE_PARENT ( old ) ; if ( tmp != NULL ) { if ( RBE_LEFT ( tmp ) == old ) { RBE_LEFT ( tmp ) = rbe ; } else { RBE_RIGHT ( tmp ) = rbe ; } rbe_if_augment ( t , tmp ) ; } else { RBH_ROOT ( rbt ) = rbe ; } RBE_PARENT ( RBE_LEFT ( old ) ) = rbe ; if ( t -> t_augment != NULL && parent != NULL ) { tmp = parent ; { rbe_augment ( t , tmp ) ; tmp = RBE_PARENT ( tmp ) ; } tmp != NULL ; } color } parent = RBE_PARENT ( rbe ) ; color = RBE_COLOR ( rbe ) ; if ( child != NULL ) { RBE_PARENT ( child ) = parent ; } if ( parent != NULL ) { if ( RBE_LEFT ( parent ) == rbe ) { RBE_LEFT ( parent ) = child ; } else { RBE_RIGHT ( parent ) = child ; } rbe_if_augment ( t , parent ) ; } else { RBH_ROOT ( rbt ) = child ; } color if ( color == RB_BLACK ) { rbe_remove_color ( t , rbt , parent , child ) ; } return ( old ) ; } 