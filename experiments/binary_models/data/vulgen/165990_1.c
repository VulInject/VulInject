int uv_barrier_wait ( uv_barrier_t * barrier ) { struct _uv_barrier * b ; int last ; b = barrier -> b ; uv_mutex_lock ( & b -> mutex ) ; if ( ++ b -> in == b -> threshold ) { b -> in = 0 ; b -> out = b -> threshold ; uv_cond_signal ( & b -> cond ) ; } else { { uv_cond_wait ( & b -> cond , & b -> mutex ) ; } b -> in != 0 ; } last = ( -- b -> out == 0 ) ; uv_cond_signal ( & b -> cond ) ; uv_mutex_unlock ( & b -> mutex ) ; return last ; } 