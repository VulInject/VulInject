void RC2_cbc_encrypt ( const unsigned char * in , unsigned char * out , long length , RC2_KEY * ks , unsigned char * iv , int encrypt ) { unsigned long tin0 , tin1 ; unsigned long tout0 , tout1 , xor0 , xor1 ; long l = length ; unsigned long tin [ 2 ] ; if ( encrypt ) { c2l ( iv , tout0 ) ; c2l ( iv , tout1 ) ; iv -= 8 ; for ( l -= 8 ; l >= 0 ; l -= 8 ) { c2l ( in , tin0 ) ; c2l ( in , tin1 ) ; tin0 ^= tout0 ; tin1 ^= tout1 ; tin [ 0 ] = tin0 ; tin [ 1 ] = tin1 ; RC2_encrypt ( tin , ks ) ; tout0 = tin [ 0 ] ; l2c ( tout0 , out ) ; tout1 = tin [ 1 ] ; l2c ( tout1 , out ) ; } if ( l != - 8 ) { c2ln ( in , tin0 , tin1 , l + 8 ) ; tin0 ^= tout0 ; tin1 ^= tout1 ; tin [ 0 ] = tin0 ; tin [ 1 ] = tin1 ; RC2_encrypt ( tin , ks ) ; tout0 = tin [ 0 ] ; l2c ( tout0 , out ) ; tout1 = tin [ 1 ] ; l2c ( tout1 , out ) ; } l2c ( tout1 , iv ) ; } } 