OM_uint32 kgsscred_name_to_unix_cred ( intName , mechType , uidOut , gidOut , gids , gidsLen , uid ) const gss_name_t intName ; const gss_OID mechType ; uid_t * uidOut ; gid_t * gidOut ; gid_t * gids [ ] ; int * gidsLen ; uid_t uid ; { gsscred_name_to_unix_cred_arg args ; gsscred_name_to_unix_cred_res res ; OM_uint32 major , minor ; gss_OID nameOid ; gss_buffer_desc flatName = GSS_C_EMPTY_BUFFER ; if ( intName == NULL || mechType == NULL ) { return ( GSS_S_CALL_INACCESSIBLE_READ ) ; } if ( uidOut == NULL ) { return ( GSS_S_CALL_INACCESSIBLE_WRITE ) ; } * uidOut = 0 ; if ( gids ) { * gids = NULL ; } if ( gidsLen ) { * gidsLen = 0 ; } if ( ( clnt = getgssd_handle ( ) ) == NULL ) { clnt_pcreateerror ( server ) ; return ( GSS_S_FAILURE ) ; } if ( ( major = gss_display_name ( & minor , intName , & flatName , & nameOid ) ) != GSS_S_COMPLETE ) { return ( major ) ; } args . uid = uid ; args . pname . GSS_BUFFER_T_len = flatName . length ; args . pname . GSS_BUFFER_T_val = flatName . value ; args . name_type . GSS_OID_len = nameOid -> length ; args . name_type . GSS_OID_val = nameOid -> elements ; args . mech_type . GSS_OID_len = mechType -> length ; args . mech_type . GSS_OID_val = mechType -> elements ; if ( gsscred_name_to_unix_cred_1 ( & args , & res , clnt ) != RPC_SUCCESS ) { gss_release_buffer ( & minor , & flatName ) ; return ( GSS_S_FAILURE ) ; } gss_release_buffer ( & minor , & flatName ) ; if ( res . major == GSS_S_COMPLETE ) { * uidOut = res . uid ; if ( gidOut ) { * gidOut = res . gid ; } if ( gids && gidsLen ) { * gids = res . gids . GSSCRED_GIDS_val ; * gidsLen = res . gids . GSSCRED_GIDS_len ; res . gids . GSSCRED_GIDS_val = NULL ; res . gids . GSSCRED_GIDS_len = 0 ; } } clnt_freeres ( clnt , xdr_gsscred_name_to_unix_cred_res , ( caddr_t ) & res ) ; return ( res . major ) ; } 