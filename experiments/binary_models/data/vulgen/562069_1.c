busy_dialog ( , , , ) { Context context ; GtkWidget * window ; GtkWidget * content_area ; GtkWidget * vbox ; GtkWidget * label ; GtkWidget * box ; context . read_channel = g_io_channel_win32_new_fd ( read_fd ) ; context . write_channel = g_io_channel_win32_new_fd ( write_fd ) ; context . read_channel = g_io_channel_unix_new ( read_fd ) ; context . write_channel = g_io_channel_unix_new ( write_fd ) ; g_io_channel_set_close_on_unref ( context . read_channel , TRUE ) ; g_io_channel_set_close_on_unref ( context . write_channel , TRUE ) ; g_io_add_watch ( context . read_channel , G_IO_IN | G_IO_ERR | G_IO_HUP , ( GIOFunc ) busy_dialog_read_channel_notify , & context ) ; gtk_init ( NULL , NULL ) ; gimp_ui_init ( PLUG_IN_BINARY ) ; if ( ! cancelable ) { window = g_object_new ( GTK_TYPE_WINDOW , "title" , _ ( "Please Wait" ) , "skip-taskbar-hint" , TRUE , "deletable" , FALSE , "resizable" , FALSE , "role" , "gimp-busy-dialog" , "type-hint" , GDK_WINDOW_TYPE_HINT_DIALOG , "window-position" , GTK_WIN_POS_CENTER , NULL ) ; g_signal_connect ( window , "delete-event" , G_CALLBACK ( gtk_true ) , NULL ) ; content_area = window ; } else { window = g_object_new ( GTK_TYPE_DIALOG , "title" , _ ( "Please Wait" ) , "skip-taskbar-hint" , TRUE , "resizable" , FALSE , "role" , "gimp-busy-dialog" , "window-position" , GTK_WIN_POS_CENTER , NULL ) ; gtk_dialog_add_button ( GTK_DIALOG ( window ) , _ ( "_Cancel" ) , GTK_RESPONSE_CANCEL ) ; g_signal_connect ( window , "delete-event" , G_CALLBACK ( busy_dialog_delete_event ) , & context ) ; g_signal_connect ( window , "response" , G_CALLBACK ( busy_dialog_response ) , & context ) ; content_area = gtk_dialog_get_content_area ( GTK_DIALOG ( window ) ) ; } vbox = gtk_box_new ( GTK_ORIENTATION_VERTICAL , 8 ) ; gtk_container_set_border_width ( GTK_CONTAINER ( vbox ) , 16 ) ; gtk_container_add ( GTK_CONTAINER ( content_area ) , vbox ) ; gtk_widget_show ( vbox ) ; label = gtk_label_new ( _ ( "Please wait for the operation to complete" ) ) ; gimp_label_set_attributes ( GTK_LABEL ( label ) , PANGO_ATTR_WEIGHT , PANGO_WEIGHT_BOLD , - 1 ) ; gtk_box_pack_start ( GTK_BOX ( vbox ) , label , FALSE , FALSE , 0 ) ; gtk_widget_show ( label ) ; box = gimp_busy_box_new ( message ) ; gtk_container_set_border_width ( GTK_CONTAINER ( box ) , 8 ) ; gtk_box_pack_start ( GTK_BOX ( vbox ) , box , TRUE , TRUE , 0 ) ; gtk_widget_show ( box ) ; gtk_window_present ( GTK_WINDOW ( window ) ) ; gtk_main ( ) ; gtk_widget_destroy ( window ) ; g_clear_pointer ( & context . read_channel , g_io_channel_unref ) ; return GIMP_PDB_SUCCESS ; } 