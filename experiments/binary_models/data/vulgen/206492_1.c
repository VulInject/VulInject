static int mod_init ( void ) { bind_usrloc_t bind_usrloc ; bind_pua_t bind_pua ; bind_ipsec_pcscf_t bind_ipsec_pcscf ; if ( ! fix_parameters ( ) ) { error } if ( sl_load_api ( & slb ) != 0 ) { LM_ERR ( "cannot bind to SL API\n" ) ; return - 1 ; } LM_DBG ( "Successfully bound to SL module\n" ) ; if ( load_tm_api ( & tmb ) != 0 ) { LM_ERR ( "can't load TM API\n" ) ; return - 1 ; } LM_DBG ( "Successfully bound to TM module\n" ) ; bind_usrloc = ( bind_usrloc_t ) find_export ( "ul_bind_ims_usrloc_pcscf" , 1 , 0 ) ; if ( ! bind_usrloc ) { LM_ERR ( "can't bind ims_usrloc_pcscf\n" ) ; return - 1 ; } if ( bind_usrloc ( & ul ) < 0 ) { return - 1 ; } LM_DBG ( "Successfully bound to PCSCF Usrloc module\n" ) ; bind_ipsec_pcscf = ( bind_ipsec_pcscf_t ) find_export ( "bind_ims_ipsec_pcscf" , 1 , 0 ) ; if ( ! bind_ipsec_pcscf ) { LM_ERR ( "can't bind ims_ipsec_pcscf\n" ) ; return - 1 ; } if ( bind_ipsec_pcscf ( & ipsec_pcscf ) < 0 ) { return - 1 ; } LM_INFO ( "Successfully bound to PCSCF IPSEC module\n" ) ; if ( subscribe_to_reginfo == 1 ) { bind_pua = ( bind_pua_t ) find_export ( "bind_pua" , 1 , 0 ) ; if ( ! bind_pua ) { LM_ERR ( "Can't bind pua\n" ) ; return - 1 ; } if ( bind_pua ( & pua ) < 0 ) { LM_ERR ( "Can't bind pua\n" ) ; return - 1 ; } if ( pua . send_publish == NULL ) { LM_ERR ( "Could not import send_publish\n" ) ; return - 1 ; } if ( pua . send_subscribe == NULL ) { LM_ERR ( "Could not import send_subscribe\n" ) ; return - 1 ; } if ( pua . get_subs_list == NULL ) { LM_ERR ( "Could not import get_subs_list\n" ) ; return - 1 ; } LM_DBG ( "Successfully bound to PUA module\n" ) ; if ( ! init_reginfo_event_list ( ) ) { LM_ERR ( "unable to initialise reginfo_event_list\n" ) ; return - 1 ; } LM_DBG ( "Successfully initialised reginfo_event_list\n" ) ; } return 0 ; error return - 1 ; } 