static av_cold int qsv_decode_init ( AVCodecContext * avctx ) { QSVDecContext * s = avctx -> priv_data ; int ret ; const char * uid = NULL ; if ( avctx -> codec_id == AV_CODEC_ID_VP8 ) { uid = "f622394d8d87452f878c51f2fc9b4131" ; } if ( avctx -> codec_id == AV_CODEC_ID_VP9 ) { uid = "a922394d8d87452f878c51f2fc9b4131" ; } if ( avctx -> codec_id == AV_CODEC_ID_HEVC && s -> load_plugin != LOAD_PLUGIN_NONE ) { static const char * const uid_hevcdec_sw = "15dd936825ad475ea34e35f3f54217a6" ; static const char * const uid_hevcdec_hw = "33a61c0b4c27454ca8d85dde757c6f8e" ; if ( s -> qsv . load_plugins [ 0 ] ) { av_log ( avctx , AV_LOG_WARNING , "load_plugins is not empty, but load_plugin is not set to 'none'." "The load_plugin value will be ignored.\n" ) ; } else { if ( s -> load_plugin == LOAD_PLUGIN_HEVC_SW ) { uid = uid_hevcdec_sw ; } else { uid = uid_hevcdec_hw ; } } } if ( uid ) { av_freep ( & s -> qsv . load_plugins ) ; s -> qsv . load_plugins = av_strdup ( uid ) ; if ( ! s -> qsv . load_plugins ) { return AVERROR ( ENOMEM ) ; } } s -> qsv . orig_pix_fmt = AV_PIX_FMT_NV12 ; if ( ! s -> packet_fifo ) { ret = AVERROR ( ENOMEM ) ; fail } if ( ! avctx -> pkt_timebase . num ) { av_log ( avctx , AV_LOG_WARNING , "Invalid pkt_timebase, passing timestamps as-is.\n" ) ; } return 0 ; fail qsv_decode_close ( avctx ) ; return ret ; } 