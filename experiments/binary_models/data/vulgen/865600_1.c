module_param_named ( rdb_per_qp , hca_profile . rdb_per_qp , int , 0444 ) ; MODULE_PARM_DESC ( rdb_per_qp , "number of RDB buffers per QP" ) ; module_param_named ( num_cq , hca_profile . num_cq , int , 0444 ) ; MODULE_PARM_DESC ( num_cq , "maximum number of CQs per HCA" ) ; module_param_named ( num_mcg , hca_profile . num_mcg , int , 0444 ) ; MODULE_PARM_DESC ( num_mcg , "maximum number of multicast groups per HCA" ) ; module_param_named ( num_mpt , hca_profile . num_mpt , int , 0444 ) ; MODULE_PARM_DESC ( num_mpt , "maximum number of memory protection table entries per HCA" ) ; module_param_named ( num_mtt , hca_profile . num_mtt , int , 0444 ) ; MODULE_PARM_DESC ( num_mtt , "maximum number of memory translation table segments per HCA" ) ; module_param_named ( num_udav , hca_profile . num_udav , int , 0444 ) ; MODULE_PARM_DESC ( num_udav , "maximum number of UD address vectors per HCA" ) ; module_param_named ( fmr_reserved_mtts , hca_profile . fmr_reserved_mtts , int , 0444 ) ; MODULE_PARM_DESC ( fmr_reserved_mtts , "number of memory translation table segments reserved for FMR" ) ; module_param_named ( log_mtts_per_seg , log_mtts_per_seg , int , 0444 ) ; MODULE_PARM_DESC ( log_mtts_per_seg , "Log2 number of MTT entries per segment (1-5)" ) ; static char mthca_version [ ] DRV_NAME ": Mellanox InfiniBand HCA driver v" DRV_VERSION " (" DRV_RELDATE ")\n" ; ; static int mthca_tune_pci ( struct mthca_dev * mdev ) { if ( ! tune_pci ) { return 0 ; } if ( pci_find_capability ( mdev -> pdev , PCI_CAP_ID_PCIX ) ) { if ( pcix_set_mmrbc ( mdev -> pdev , pcix_get_max_mmrbc ( mdev -> pdev ) ) ) { mthca_err ( mdev , "Couldn't set PCI-X max read count, " "aborting.\n" ) ; return - ENODEV ; } } if ( ! ( mdev -> mthca_flags & MTHCA_FLAG_PCIE ) ) { mthca_info ( mdev , "No PCI-X capability, not setting RBC.\n" ) ; } if ( pci_is_pcie ( mdev -> pdev ) ) { if ( pcie_set_readrq ( mdev -> pdev , 4096 ) ) { mthca_err ( mdev , "Couldn't write PCI Express read request, " "aborting.\n" ) ; return - ENODEV ; } } if ( mdev -> mthca_flags & MTHCA_FLAG_PCIE ) { mthca_info ( mdev , "No PCI Express capability, " "not setting Max Read Request Size.\n" ) ; } return 0 ; } 