flatpak_complete_run ( ) { g_autoptr ( ) context = NULL ; g_autoptr ( ) user_dir = NULL ; g_autoptr ( ) system_dirs = NULL ; g_autoptr ( GError ) error = NULL ; int i ; g_autoptr ( ) arg_context = NULL ; context = g_option_context_new ( "" ) ; arg_context = flatpak_context_new ( ) ; g_option_context_add_group ( context , flatpak_context_get_options ( arg_context ) ) ; if ( ! flatpak_option_context_parse ( context , options , & completion -> argc , & completion -> argv , FLATPAK_BUILTIN_FLAG_ALL_DIRS | FLATPAK_BUILTIN_FLAG_OPTIONAL_REPO , NULL , NULL , NULL ) ) { return FALSE ; } switch ( completion -> argc ) { case 0 : case 1 : flatpak_complete_options ( completion , global_entries ) ; flatpak_complete_options ( completion , user_entries ) ; flatpak_complete_options ( completion , options ) ; flatpak_complete_context ( completion ) ; user_dir = flatpak_dir_get_user ( ) ; { g_autoptr ( ) refs = flatpak_dir_find_installed_refs ( user_dir , NULL , NULL , opt_arch , FLATPAK_KINDS_APP , FIND_MATCHING_REFS_FLAGS_NONE , & error ) ; if ( refs == NULL ) { flatpak_completion_debug ( "find local refs error: %s" , error -> message ) ; } flatpak_complete_ref_id ( completion , refs ) ; } system_dirs = flatpak_dir_get_system_list ( NULL , & error ) ; if ( system_dirs == NULL ) { flatpak_completion_debug ( "find system installations error: %s" , error -> message ) ; break ; } for ( i = 0 ; i < system_dirs -> len ; i ++ ) { FlatpakDir * dir = g_ptr_array_index ( system_dirs , i ) ; g_autoptr ( ) refs = flatpak_dir_find_installed_refs ( dir , NULL , NULL , opt_arch , FLATPAK_KINDS_APP , FIND_MATCHING_REFS_FLAGS_NONE , & error ) ; flatpak_complete_ref_id ( completion , refs ) ; } break ; } return TRUE ; } 