struct clk_hw * __init at91sam9x5_clk_register_smd ( struct regmap * regmap , const char * name , const char * * parent_names , u8 num_parents ) { struct at91sam9x5_clk_smd * smd ; struct clk_hw * hw ; struct clk_init_data init ; int ret ; smd = kzalloc ( sizeof ( * smd ) , GFP_KERNEL ) ; if ( ! smd ) { return ERR_PTR ( - ENOMEM ) ; } init . name = name ; init . ops = & at91sam9x5_smd_ops ; init . parent_names = parent_names ; init . num_parents = num_parents ; init . flags = CLK_SET_RATE_GATE | CLK_SET_PARENT_GATE ; smd -> hw . init = & init ; smd -> regmap = regmap ; hw = & smd -> hw ; ret = clk_hw_register ( NULL , & smd -> hw ) ; if ( ret ) { hw = ERR_PTR ( ret ) ; } return hw ; } 