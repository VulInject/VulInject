void otr_finish ( SERVER_REC * server , const char * nick ) { ConnContext * ctx ; g_return_if_fail ( server != NULL ) ; ctx = otr_find_context ( server , nick , FALSE ) ; if ( ctx == NULL ) { printformat ( server , nick , MSGLEVEL_CRAP , TXT_OTR_SESSION_ALREADY_FINISHED ) ; return ; } otrl_message_disconnect ( user_state_global -> otr_state , & otr_ops , server , ctx -> accountname , OTR_PROTOCOL_ID , nick , ctx -> their_instance ) ; otr_status_change ( server , nick , OTR_STATUS_FINISHED ) ; printformat ( server , nick , MSGLEVEL_CRAP , TXT_OTR_SESSION_FINISHING , nick ) ; } 