int rs_pretty_print_rate ( char * buf , int bufsz , const u32 rate ) { char * type ; u8 mcs = 0 , nss = 0 ; u8 ant = ( rate & RATE_MCS_ANT_AB_MSK ) >> RATE_MCS_ANT_POS ; u32 bw = ( rate & RATE_MCS_CHAN_WIDTH_MSK ) >> RATE_MCS_CHAN_WIDTH_POS ; u32 format = rate & RATE_MCS_MOD_TYPE_MSK ; bool sgi ; if ( format == RATE_MCS_CCK_MSK || format == RATE_MCS_LEGACY_OFDM_MSK ) { int legacy_rate = rate & RATE_LEGACY_RATE_MSK ; int index = format == RATE_MCS_CCK_MSK ?legacy_rate : legacy_rate + IWL_FIRST_OFDM_RATE ; return scnprintf ( buf , bufsz , "Legacy | ANT: %s Rate: %s Mbps" , iwl_rs_pretty_ant ( ant ) , index == IWL_RATE_INVALID ?"BAD" : iwl_rate_mcs ( index ) -> mbps ) ; } if ( format == RATE_MCS_VHT_MSK ) { type = "VHT" ; } if ( format == RATE_MCS_HT_MSK ) { type = "HT" ; } if ( format == RATE_MCS_HE_MSK ) { type = "HE" ; } else { type = "Unknown" ; } mcs = format == RATE_MCS_HT_MSK ?RATE_HT_MCS_INDEX ( rate ) : rate & RATE_MCS_CODE_MSK ; nss = ( ( rate & RATE_MCS_NSS_MSK ) >> RATE_MCS_NSS_POS ) + 1 ; sgi = format == RATE_MCS_HE_MSK ?iwl_he_is_sgi ( rate ) : rate & RATE_MCS_SGI_MSK ; return scnprintf ( buf , bufsz , "0x%x: %s | ANT: %s BW: %s MCS: %d NSS: %d %s%s%s%s%s" , rate , type , iwl_rs_pretty_ant ( ant ) , iwl_rs_pretty_bw ( bw ) , mcs , nss , ( sgi ) ?"SGI " : "NGI " , ( rate & RATE_MCS_STBC_MSK ) ?"STBC " : "" , ( rate & RATE_MCS_LDPC_MSK ) ?"LDPC " : "" , ( rate & RATE_HE_DUAL_CARRIER_MODE_MSK ) ?"DCM " : "" , ( rate & RATE_MCS_BF_MSK ) ?"BF " : "" ) ; } 