if ( strlen ( name ) < i || strncmp ( name , uri_STREAMS "|stream" , i ) != 0 || ( name [ i ] != '\0' && name [ i ] != '|' ) ) { _sx_gen_error ( sxe , SX_ERR_STREAM , "Stream error" , "Expected stream open" ) ; _sx_event ( s , event_ERROR , ( void * ) & sxe ) ; _sx_error ( s , stream_err_BAD_FORMAT , NULL ) ; s -> fail = 1 ; return ; } attr = atts ; while ( attr [ 0 ] != NULL ) { if ( ! tflag && strcmp ( attr [ 0 ] , "to" ) == 0 ) { s -> res_to = strdup ( attr [ 1 ] ) ; tflag = 1 ; } if ( ! fflag && strcmp ( attr [ 0 ] , "from" ) == 0 ) { s -> res_from = strdup ( attr [ 1 ] ) ; fflag = 1 ; } if ( ! vflag && strcmp ( attr [ 0 ] , "version" ) == 0 ) { s -> res_version = strdup ( attr [ 1 ] ) ; vflag = 1 ; } if ( ! iflag && strcmp ( attr [ 0 ] , "id" ) == 0 ) { s -> id = strdup ( attr [ 1 ] ) ; iflag = 1 ; } attr += 2 ; } s -> depth ++ ; _sx_debug ( ZONE , "stream response: to %s from %s version %s id %s" , s -> res_to , s -> res_from , s -> res_version , s -> id ) ; XML_SetElementHandler ( s -> expat , ( void * ) _sx_element_start , ( void * ) _sx_element_end ) ; XML_SetCharacterDataHandler ( s -> expat , ( void * ) _sx_cdata ) ; if ( s -> env != NULL ) { for ( i = 0 ; i < s -> env -> nplugins ; i ++ ) { if ( s -> env -> plugins [ i ] -> stream != NULL ) { ( s -> env -> plugins [ i ] -> stream ) ( s , s -> env -> plugins [ i ] ) ; } } } if ( s -> state < state_STREAM ) { _sx_state ( s , state_STREAM ) ; _sx_event ( s , event_STREAM , NULL ) ; } 