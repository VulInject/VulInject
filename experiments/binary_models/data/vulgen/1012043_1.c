static int ethoc_tx ( struct net_device * dev , int limit ) { struct ethoc * priv = netdev_priv ( dev ) ; int count ; struct ethoc_bd bd ; for ( count = 0 ; count < limit ; ++ count ) { unsigned int entry ; entry = priv -> dty_tx & ( priv -> num_tx - 1 ) ; ethoc_read_bd ( priv , entry , & bd ) ; if ( bd . stat & TX_BD_READY || ( priv -> dty_tx == priv -> cur_tx ) ) { ethoc_ack_irq ( priv , INT_MASK_TX ) ; ethoc_read_bd ( priv , entry , & bd ) ; if ( bd . stat & TX_BD_READY || ( priv -> dty_tx == priv -> cur_tx ) ) { break ; } } ethoc_update_tx_stats ( priv , & bd ) ; priv -> dty_tx ++ ; } return count ; } 