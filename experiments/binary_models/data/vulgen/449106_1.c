static void raid_resume ( struct dm_target * ti ) { struct raid_set * rs = ti -> private ; struct mddev * mddev = & rs -> md ; if ( test_and_set_bit ( RT_FLAG_RS_RESUMED , & rs -> runtime_flags ) ) { attempt_restore_of_faulty_devices ( rs ) ; } if ( test_and_clear_bit ( RT_FLAG_RS_SUSPENDED , & rs -> runtime_flags ) ) { mddev_lock_nointr ( mddev ) ; clear_bit ( MD_RECOVERY_FROZEN , & mddev -> recovery ) ; mddev -> ro = 0 ; mddev -> in_sync = 0 ; mddev_resume ( mddev ) ; mddev_unlock ( mddev ) ; } } 