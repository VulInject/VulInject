int extract_media_attr ( str * body , str * mediamedia , str * mediaport , str * mediatransport , str * mediapayload , int * is_rtp ) { char * cp , * cp1 ; int len , i ; cp1 = NULL ; for ( cp = body -> s ; ( len = body -> s + body -> len - cp ) > 0 ; ) { cp1 = ( char * ) ser_memmem ( cp , "m=" , len , 2 ) ; if ( cp1 == NULL || cp1 [ - 1 ] == '\n' || cp1 [ - 1 ] == '\r' ) { break ; } cp = cp1 + 2 ; } if ( cp1 == NULL ) { LM_ERR ( "no `m=' in SDP\n" ) ; return - 1 ; } mediaport -> s = cp1 + 2 ; mediaport -> len = eat_line ( mediaport -> s , body -> s + body -> len - mediaport -> s ) - mediaport -> s ; mediapayload -> len = mediaport -> len ; mediamedia -> s = mediaport -> s ; cp = eat_token_end ( mediaport -> s , mediaport -> s + mediaport -> len ) ; mediaport -> len -= cp - mediaport -> s ; mediamedia -> len = mediapayload -> len - mediaport -> len ; if ( mediaport -> len <= 0 || cp == mediaport -> s ) { LM_ERR ( "no port in `m='\n" ) ; return - 1 ; } mediaport -> s = cp ; cp = eat_space_end ( mediaport -> s , mediaport -> s + mediaport -> len ) ; mediaport -> len -= cp - mediaport -> s ; if ( mediaport -> len <= 0 || cp == mediaport -> s ) { LM_ERR ( "no port in `m='\n" ) ; return - 1 ; } mediaport -> s = cp ; cp = eat_token_end ( mediaport -> s , mediaport -> s + mediaport -> len ) ; mediatransport -> len = mediaport -> len - ( cp - mediaport -> s ) ; if ( mediatransport -> len <= 0 || cp == mediaport -> s ) { LM_ERR ( "no port in `m='\n" ) ; return - 1 ; } mediatransport -> s = cp ; mediaport -> len = cp - mediaport -> s ; cp = eat_space_end ( mediatransport -> s , mediatransport -> s + mediatransport -> len ) ; mediatransport -> len -= cp - mediatransport -> s ; if ( mediatransport -> len <= 0 || cp == mediatransport -> s ) { LM_ERR ( "no protocol type in `m='\n" ) ; return - 1 ; } mediatransport -> s = cp ; cp = eat_token_end ( mediatransport -> s , mediatransport -> s + mediatransport -> len ) ; if ( cp == mediatransport -> s ) { LM_ERR ( "no protocol type in `m='\n" ) ; return - 1 ; } mediatransport -> len = cp - mediatransport -> s ; mediapayload -> s = mediatransport -> s + mediatransport -> len ; mediapayload -> len -= mediapayload -> s - mediamedia -> s ; cp = eat_space_end ( mediapayload -> s , mediapayload -> s + mediapayload -> len ) ; mediapayload -> len -= cp - mediapayload -> s ; mediapayload -> s = cp ; for ( i = 0 ; sup_ptypes [ i ] . s != NULL ; i ++ ) { if ( mediatransport -> len == sup_ptypes [ i ] . len && strncasecmp ( mediatransport -> s , sup_ptypes [ i ] . s , mediatransport -> len ) == 0 ) { * is_rtp = sup_ptypes [ i ] . is_rtp ; return 0 ; } } return 0 ; } 