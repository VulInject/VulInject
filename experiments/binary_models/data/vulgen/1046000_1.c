static ssize_t lbs_wrmac_write ( struct file * file , const char __user * userbuf , size_t count , loff_t * ppos ) { struct lbs_private * priv = file -> private_data ; ssize_t res ; u32 offset , value ; char * buf ; if ( IS_ERR ( buf ) ) { return PTR_ERR ( buf ) ; } res = sscanf ( buf , "%x %x" , & offset , & value ) ; if ( res != 2 ) { res = - EFAULT ; out_unlock } res = lbs_set_reg ( priv , CMD_MAC_REG_ACCESS , offset , value ) ; mdelay ( 10 ) ; if ( ! res ) { res = count ; } out_unlock kfree ( buf ) ; return res ; } 