static int __maybe_unused trace_test_buffer ( struct array_buffer * buf , unsigned long * count ) { int cpu , ret ; int cpu , ret = 0 ; local_irq_save ( flags ) ; arch_spin_lock ( & buf -> tr -> max_lock ) ; cnt = ring_buffer_entries ( buf -> buffer ) ; tracing_off ( ) ; for_each_possible_cpu ( ) { ret = trace_test_buffer_cpu ( buf , cpu ) ; if ( ret ) { break ; } } tracing_on ( ) ; arch_spin_unlock ( & buf -> tr -> max_lock ) ; local_irq_restore ( flags ) ; if ( count ) { * count = cnt ; } return ret ; } 