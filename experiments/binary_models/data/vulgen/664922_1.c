static void testnan ( const char * nan_format ) { char nan_str [ 128 ] ; char * end ; long double ald [ 4 ] ; double ad [ 4 ] ; float af [ 4 ] ; int i ; snprintf ( nan_str , sizeof ( nan_str ) , "nan(%s)" , nan_format ) ; for ( i = 0 ; i < nitems ( ad ) ; i ++ ) { bzero ( & af [ i ] , sizeof ( float ) ) ; bzero ( & ad [ i ] , sizeof ( double ) ) ; bzero ( & ald [ i ] , ( long double ) ) ; } af [ 0 ] = nanf ( nan_format ) ; ATF_REQUIRE ( isnan ( af [ 0 ] ) ) ; af [ 1 ] = strtof ( nan_str , & end ) ; ATF_REQUIRE ( end == nan_str + strlen ( nan_str ) ) ; ATF_REQUIRE ( sscanf ( nan_str , "%e" , & af [ 2 ] ) == 1 ) ; ATF_REQUIRE ( memcmp ( & af [ 0 ] , & af [ 1 ] , sizeof ( float ) ) == 0 ) ; ATF_REQUIRE ( memcmp ( & af [ 1 ] , & af [ 2 ] , sizeof ( float ) ) == 0 ) ; if ( * nan_format == '\0' ) { af [ 3 ] = strtof ( "nan" , NULL ) ; ATF_REQUIRE ( memcmp ( & af [ 2 ] , & af [ 3 ] , sizeof ( float ) ) == 0 ) ; } ad [ 0 ] = nan ( nan_format ) ; ATF_REQUIRE ( isnan ( ad [ 0 ] ) ) ; ad [ 1 ] = strtod ( nan_str , & end ) ; ATF_REQUIRE ( end == nan_str + strlen ( nan_str ) ) ; ATF_REQUIRE ( sscanf ( nan_str , "%le" , & ad [ 2 ] ) == 1 ) ; ATF_REQUIRE ( memcmp ( & ad [ 0 ] , & ad [ 1 ] , sizeof ( double ) ) == 0 ) ; ATF_REQUIRE ( memcmp ( & ad [ 1 ] , & ad [ 2 ] , sizeof ( double ) ) == 0 ) ; if ( * nan_format == '\0' ) { ad [ 3 ] = strtod ( "nan" , NULL ) ; ATF_REQUIRE ( memcmp ( & ad [ 2 ] , & ad [ 3 ] , sizeof ( double ) ) == 0 ) ; } ald [ 0 ] = nanl ( nan_format ) ; ATF_REQUIRE ( isnan ( ald [ 0 ] ) ) ; ald [ 1 ] = strtold ( nan_str , & end ) ; ATF_REQUIRE ( end == nan_str + strlen ( nan_str ) ) ; ATF_REQUIRE ( sscanf ( nan_str , "%Le" , & ald [ 2 ] ) == 1 ) ; ATF_REQUIRE ( memcmp ( & ald [ 0 ] , & ald [ 1 ] , ( long double ) ) == 0 ) ; ATF_REQUIRE ( memcmp ( & ald [ 1 ] , & ald [ 2 ] , ( long double ) ) == 0 ) ; if ( * nan_format == '\0' ) { ald [ 3 ] = strtold ( "nan" , NULL ) ; ATF_REQUIRE ( memcmp ( & ald [ 2 ] , & ald [ 3 ] , ( long double ) ) == 0 ) ; } } 