static int mp2629_probe ( struct i2c_client * client ) { struct mp2629_data * ddata ; int ret ; ddata = devm_kzalloc ( & client -> dev , sizeof ( * ddata ) , GFP_KERNEL ) ; if ( ! ddata ) { return - ENOMEM ; } ddata -> dev = & client -> dev ; i2c_set_clientdata ( client , ddata ) ; if ( IS_ERR ( ddata -> regmap ) ) { dev_err ( ddata -> dev , "Failed to allocate regmap\n" ) ; return PTR_ERR ( ddata -> regmap ) ; } ret = devm_mfd_add_devices ( ddata -> dev , PLATFORM_DEVID_AUTO , mp2629_cell , ARRAY_SIZE ( mp2629_cell ) , NULL , 0 , NULL ) ; if ( ret ) { dev_err ( ddata -> dev , "Failed to register sub-devices %d\n" , ret ) ; } return ret ; } static const struct of_device_id mp2629_of_match [ ] { { . compatible = "mps,mp2629" } { } } ; ; 