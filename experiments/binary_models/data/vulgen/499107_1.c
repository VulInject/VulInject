static void test_exec_ambientcapabilities ( Manager * m ) { int r ; if ( r < 0 && IN_SET ( errno , EINVAL , EOPNOTSUPP , ENOSYS ) ) { log_notice ( "Skipping %s, the kernel does not support ambient capabilities" , __func__ ) ; return ; } if ( have_effective_cap ( CAP_CHOWN ) <= 0 || have_effective_cap ( CAP_NET_RAW ) <= 0 ) { log_notice ( "Skipping %s, this process does not have enough capabilities" , __func__ ) ; return ; } test ( m , "exec-ambientcapabilities.service" , 0 , CLD_EXITED ) ; test ( m , "exec-ambientcapabilities-merge.service" , 0 , CLD_EXITED ) ; if ( ! check_nobody_user_and_group ( ) ) { log_notice ( "nobody user/group is not synthesized or may conflict to other entries, skipping remaining tests in %s" , __func__ ) ; return ; } if ( ! STR_IN_SET ( NOBODY_USER_NAME , "nobody" , "nfsnobody" ) ) { log_notice ( "Unsupported nobody user name '%s', skipping remaining tests in %s" , NOBODY_USER_NAME , __func__ ) ; return ; } test ( m , "exec-ambientcapabilities-" NOBODY_USER_NAME ".service" , 0 , CLD_EXITED ) ; test ( m , "exec-ambientcapabilities-merge-" NOBODY_USER_NAME ".service" , 0 , CLD_EXITED ) ; } 