static int vimc_probe ( struct platform_device * pdev ) { struct vimc_device * vimc ; int ret ; vimc = kzalloc ( sizeof ( * vimc ) , GFP_KERNEL ) ; if ( ! vimc ) { return - ENOMEM ; } vimc -> pipe_cfg = & pipe_cfg ; strlcpy ( vimc -> mdev . model , VIMC_MDEV_MODEL_NAME , sizeof ( vimc -> mdev . model ) ) ; vimc -> mdev . dev = & pdev -> dev ; media_device_init ( & vimc -> mdev ) ; ret = vimc_device_register ( vimc ) ; if ( ret ) { dev_err ( vimc -> mdev . dev , "vimc device registration failed (err=%d)\n" , ret ) ; return ret ; } platform_set_drvdata ( pdev , vimc ) ; return 0 ; } 