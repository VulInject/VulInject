TEST ( ) { _cleanup_ ( ) sd_device * dev ; int ifindex ; assert_se ( sd_device_enumerator_new ( & e ) >= 0 ) ; assert_se ( sd_device_enumerator_allow_uninitialized ( e ) >= 0 ) ; assert_se ( sd_device_enumerator_add_match_subsystem ( e , "net" , true ) >= 0 ) ; assert_se ( sd_device_enumerator_add_match_sysattr ( e , "ifindex" , "1" , true ) >= 0 ) ; assert_se ( sd_device_enumerator_add_match_sysattr ( e , "ifindex" , "hoge" , true ) >= 0 ) ; assert_se ( sd_device_enumerator_add_match_sysattr ( e , "ifindex" , "foo" , true ) >= 0 ) ; assert_se ( sd_device_enumerator_add_match_sysattr ( e , "ifindex" , "bar" , false ) >= 0 ) ; assert_se ( sd_device_enumerator_add_match_sysattr ( e , "ifindex" , "baz" , false ) >= 0 ) ; dev = sd_device_enumerator_get_device_first ( e ) ; assert_se ( dev ) ; assert_se ( sd_device_get_ifindex ( dev , & ifindex ) >= 0 ) ; assert_se ( ifindex == 1 ) ; assert_se ( ! sd_device_enumerator_get_device_next ( e ) ) ; } 