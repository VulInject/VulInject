char * lmprintf ( uint32_t msg_id , ... ) { static int buf_id = 0 ; static char buf [ LOC_MESSAGE_NB ] [ LOC_MESSAGE_SIZE ] ; char * format = NULL ; size_t pos ; va_list args ; BOOL is_rtf = ( msg_id & MSG_RTF ) ; buf_id %= LOC_MESSAGE_NB ; buf [ buf_id ] [ 0 ] = 0 ; msg_id &= MSG_MASK ; if ( ( msg_id >= MSG_000 ) && ( msg_id < MSG_MAX ) ) { format = msg_table [ msg_id - MSG_000 ] ; } if ( format == NULL ) { safe_sprintf ( buf [ buf_id ] , LOC_MESSAGE_SIZE - 1 , "MSG_%03u UNTRANSLATED" , msg_id - MSG_000 ) ; } else { if ( right_to_left_mode && ( msg_table != default_msg_table ) ) { if ( is_rtf ) { safe_strcpy ( & buf [ buf_id ] [ pos ] , LOC_MESSAGE_SIZE - 1 , "\\rtlch" ) ; pos += 6 ; } safe_strcpy ( & buf [ buf_id ] [ pos ] , LOC_MESSAGE_SIZE - 1 , RIGHT_TO_LEFT_EMBEDDING ) ; pos += sizeof ( RIGHT_TO_LEFT_EMBEDDING ) - 1 ; } va_start ( args , msg_id ) ; safe_vsnprintf ( & buf [ buf_id ] [ pos ] , LOC_MESSAGE_SIZE - 1 - 2 * pos , format , args ) ; va_end ( args ) ; if ( right_to_left_mode && ( msg_table != default_msg_table ) ) { safe_strcat ( buf [ buf_id ] , LOC_MESSAGE_SIZE - 1 , POP_DIRECTIONAL_FORMATTING ) ; if ( is_rtf ) { safe_strcat ( buf [ buf_id ] , LOC_MESSAGE_SIZE - 1 , "\\ltrch" ) ; } } buf [ buf_id ] [ LOC_MESSAGE_SIZE - 1 ] = '\0' ; } return buf [ buf_id ++ ] ; } char szMessage [ 2 ] [ 2 ] [ MSG_LEN ] { { "" "" } { "" "" } } ; ; char * szStatusMessage = szMessage [ MSG_STATUS ] [ MSG_HIGH_PRI ] ; static BOOL bStatusTimerArmed = FALSE , bOutputTimerArmed [ 2 ] { FALSE FALSE } ; ; static char * output_msg [ 2 ] ; static uint64_t last_msg_time [ 2 ] { 0 0 } ; ; static void PrintInfoMessage ( char * msg ) { SetWindowTextU ( hProgress , msg ) ; InvalidateRect ( hProgress , NULL , TRUE ) ; } 