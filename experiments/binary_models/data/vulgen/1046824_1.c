static void xlog_cil_build_trans_hdr ( struct xfs_cil_ctx * ctx , struct xlog_cil_trans_hdr * hdr , struct xfs_log_vec * lvhdr , int num_iovecs ) { struct xlog_ticket * tic = ctx -> ticket ; __be32 tid = cpu_to_be32 ( tic -> t_tid ) ; hdr -> oph [ 0 ] . oh_tid = tid ; hdr -> oph [ 0 ] . oh_clientid = XFS_TRANSACTION ; hdr -> oph [ 0 ] . oh_flags = XLOG_START_TRANS ; hdr -> lhdr [ 0 ] . i_addr = & hdr -> oph [ 0 ] ; hdr -> lhdr [ 0 ] . i_len = sizeof ( xlog_op_header ) ; hdr -> lhdr [ 0 ] . i_type = XLOG_REG_TYPE_LRHEADER ; hdr -> oph [ 1 ] . oh_tid = tid ; hdr -> oph [ 1 ] . oh_clientid = XFS_TRANSACTION ; hdr -> oph [ 1 ] . oh_len = cpu_to_be32 ( sizeof ( xfs_trans_header ) ) ; hdr -> thdr . th_magic = XFS_TRANS_HEADER_MAGIC ; hdr -> thdr . th_type = XFS_TRANS_CHECKPOINT ; hdr -> thdr . th_tid = tic -> t_tid ; hdr -> thdr . th_num_items = num_iovecs ; hdr -> lhdr [ 1 ] . i_addr = & hdr -> oph [ 1 ] ; hdr -> lhdr [ 1 ] . i_len = sizeof ( xlog_op_header ) + sizeof ( xfs_trans_header ) ; hdr -> lhdr [ 1 ] . i_type = XLOG_REG_TYPE_TRANSHDR ; lvhdr -> lv_niovecs = 2 ; lvhdr -> lv_iovecp = & hdr -> lhdr [ 0 ] ; lvhdr -> lv_bytes = hdr -> lhdr [ 0 ] . i_len + hdr -> lhdr [ 1 ] . i_len ; tic -> t_curr_res -= lvhdr -> lv_bytes ; } 