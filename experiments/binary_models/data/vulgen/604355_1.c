struct isa_attach_args * isapnp_bestconfig ( struct device * isa , struct isapnp_softc * sc , struct isa_attach_args * * ipa ) { struct isa_attach_args * c , * best , * f = * ipa ; int error ; for ( ; ; ) { if ( f == NULL ) { return NULL ; } for ( best = c = f ; c != NULL ; c = c -> ipa_sibling ) { if ( ! SAMEDEV ( c , f ) ) { continue ; } if ( c -> ipa_pref < best -> ipa_pref ) { best = c ; } } best -> ia_isa = isa ; error = isapnp_testconfig ( sc -> sc_iot , sc -> sc_memt , best , 0 ) ; if ( best == f ) { f = f -> ipa_sibling ; } else { for ( c = f ; c -> ipa_sibling != best ; c = c -> ipa_sibling ) { continue ; } c -> ipa_sibling = best -> ipa_sibling ; } if ( error ) { best -> ipa_pref = ISAPNP_DEP_CONFLICTING ; for ( c = f ; c != NULL ; c = c -> ipa_sibling ) { if ( c != best && SAMEDEV ( c , best ) ) { break ; } } if ( c == NULL ) { * ipa = f ; return best ; } continue ; } else { struct isa_attach_args * l = NULL , * n = NULL , * d ; for ( c = f ; c ; ) { if ( c == best ) { continue ; } d = c -> ipa_sibling ; if ( SAMEDEV ( c , best ) ) { free ( c , M_DEVBUF , 0 ) ; } else { if ( n ) { n -> ipa_sibling = c ; } else { l = c ; } n = c ; c -> ipa_sibling = NULL ; } c = d ; } f = l ; } * ipa = f ; return best ; } } 