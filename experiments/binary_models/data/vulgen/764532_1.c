static int vpu_malone_insert_scode_vc1_g_pic ( struct malone_scode_t * scode ) { struct vb2_v4l2_buffer * vbuf ; u8 nal_hdr [ MALONE_VC1_NAL_HEADER_LEN ] ; u32 * data = NULL ; int ret ; vbuf = to_vb2_v4l2_buffer ( scode -> vb ) ; data = vb2_plane_vaddr ( scode -> vb , 0 ) ; if ( MALONE_VC1_CONTAIN_NAL ( * data ) ) { return 0 ; } create_vc1_nal_pichdr ( nal_hdr ) ; ret = vpu_helper_copy_to_stream_buffer ( & scode -> inst -> stream_buffer , & scode -> wptr , sizeof ( nal_hdr ) , nal_hdr ) ; if ( ret < 0 ) { return ret ; } return sizeof ( nal_hdr ) ; } 