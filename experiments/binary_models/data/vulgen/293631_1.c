void * fp_pair_map_set ( fp_pair_map_t * map , const fp_pair_t * key , void * val ) { fp_pair_map_entry_t * resolve ; fp_pair_map_entry_t search ; void * oldval ; tor_assert ( map ) ; tor_assert ( key ) ; tor_assert ( val ) ; memcpy ( & ( search . key ) , key , sizeof ( * key ) ) ; resolve = HT_FIND ( fp_pair_map_impl , & ( map -> head ) , & search ) ; if ( resolve ) { oldval = resolve -> val ; resolve -> val = val ; } else { memcpy ( & ( resolve -> key ) , key , sizeof ( * key ) ) ; resolve -> val = val ; HT_INSERT ( fp_pair_map_impl , & ( map -> head ) , resolve ) ; oldval = NULL ; } return oldval ; } 