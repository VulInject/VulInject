static int wanxl_close ( struct net_device * dev ) { struct port * port = dev_to_port ( dev ) ; unsigned long timeout ; int i ; hdlc_close ( dev ) ; timeout = jiffies + HZ ; { if ( ! get_status ( port ) -> open ) { break ; } } time_after ( timeout , jiffies ) ; if ( get_status ( port ) -> open ) { netdev_err ( dev , "unable to close port\n" ) ; } netif_stop_queue ( dev ) ; for ( i = 0 ; i < TX_BUFFERS ; i ++ ) { desc_t * desc = & get_status ( port ) -> tx_descs [ i ] ; if ( desc -> stat != PACKET_EMPTY ) { desc -> stat = PACKET_EMPTY ; pci_unmap_single ( port -> card -> pdev , desc -> address , port -> tx_skbs [ i ] -> len , PCI_DMA_TODEVICE ) ; dev_kfree_skb ( port -> tx_skbs [ i ] ) ; } } return 0 ; } 