static __init int virtio_net_driver_init ( void ) { int ret ; ret = cpuhp_setup_state_multi ( CPUHP_AP_ONLINE_DYN , "virtio/net:online" , virtnet_cpu_online , virtnet_cpu_down_prep ) ; virtionet_online = ret ; ret = cpuhp_setup_state_multi ( CPUHP_VIRT_NET_DEAD , "virtio/net:dead" , NULL , virtnet_cpu_dead ) ; if ( ret ) { err_dead } ret = register_virtio_driver ( & virtio_net_driver ) ; if ( ret ) { err_virtio } return 0 ; err_virtio cpuhp_remove_multi_state ( CPUHP_VIRT_NET_DEAD ) ; err_dead cpuhp_remove_multi_state ( virtionet_online ) ; out return ret ; } 