extern unsigned int strlen ( ) extern int strcmp ( ) extern int isvar_sysv ( ) extern char * strncpy ( ) extern int yp_getkey ( ) int yplist_maps ( domain , list ) char * domain ; struct ypmaplist * * list ; { DIR * dirp ; struct dirent * dp ; char domdir [ MAXNAMLEN + 1 ] ; char path [ MAXNAMLEN + 1 ] ; char map_key [ YPMAXMAP + 1 ] ; int error ; char * ext ; struct ypmaplist * map ; int namesz ; char * mapname ; * list = ( ypmaplist * ) NULL ; if ( ! ypcheck_domain ( domain ) ) { return ( YP_NODOM ) ; } ( void ) strcpy ( domdir , ypdbpath ) ; ( void ) strcat ( domdir , "/" ) ; ( void ) strcat ( domdir , domain ) ; if ( ( dirp = opendir ( domdir ) ) == NULL ) { return ( YP_YPERR ) ; } error = YP_TRUE ; for ( dp = readdir ( dirp ) ; error == YP_TRUE && dp != NULL ; dp = readdir ( dirp ) ) { namesz = ( int ) strlen ( dp -> d_name ) ; if ( namesz < sizeof ( dbm_pag ) - 1 ) { continue ; } ext = & ( dp -> d_name [ namesz - ( sizeof ( dbm_pag ) - 1 ) ] ) ; if ( strcmp ( ext , dbm_pag ) != 0 ) { continue ; } * ext = '\0' ; if ( yptol_mode ) { if ( 0 != strncmp ( dp -> d_name , NTOL_PREFIX , strlen ( NTOL_PREFIX ) ) ) { continue ; } mapname = dp -> d_name + strlen ( NTOL_PREFIX ) ; } else { if ( 0 == strncmp ( dp -> d_name , NTOL_PREFIX , strlen ( NTOL_PREFIX ) ) ) { continue ; } mapname = dp -> d_name ; } ypmkfilename ( domain , mapname , path ) ; if ( ypcheck_map_existence ( path ) && ! onmaplist ( mapname , * list ) ) { if ( ( map = ( ypmaplist * ) malloc ( sizeof ( ypmaplist ) ) ) == NULL ) { error = YP_YPERR ; break ; } map -> ypml_next = * list ; * list = map ; namesz = ( int ) strlen ( mapname ) ; else { if ( yp_getkey ( mapname , map_key , MAXALIASLEN ) < 0 ) { fprintf ( stderr , "yplist_maps: getkey failed for %s\n" , mapname ) ; error = YP_YPERR ; break ; } if ( strcmp ( mapname , map_key ) == 0 ) { ( void ) strncpy ( map -> ypml_name , mapname , ( unsigned int ) namesz ) ; map -> ypml_name [ YPMAXMAP ] = '\0' ; } else { ( void ) strcpy ( map -> ypml_name , map_key ) ; } } } } closedir ( dirp ) ; return ( error ) ; } 