static int r8a66597_bus_suspend ( struct usb_hcd * hcd ) { struct r8a66597 * r8a66597 = hcd_to_r8a66597 ( hcd ) ; int port ; dev_dbg ( & r8a66597 -> device0 . udev -> dev , "%s\n" , __func__ ) ; for ( port = 0 ; port < r8a66597 -> max_root_hub ; port ++ ) { struct r8a66597_root_hub * rh = & r8a66597 -> root_hub [ port ] ; if ( ! ( rh -> port & USB_PORT_STAT_ENABLE ) ) { continue ; } dev_dbg ( & rh -> dev -> udev -> dev , "suspend port = %d\n" , port ) ; r8a66597_bclr ( r8a66597 , UACT , dvstctr_reg ) ; rh -> port |= USB_PORT_STAT_SUSPEND ; if ( rh -> dev -> udev -> do_remote_wakeup ) { msleep ( 3 ) ; r8a66597_bset ( r8a66597 , RWUPE , dvstctr_reg ) ; r8a66597_write ( r8a66597 , ~ BCHG , get_intsts_reg ( port ) ) ; r8a66597_bset ( r8a66597 , BCHGE , get_intenb_reg ( port ) ) ; } } r8a66597 -> bus_suspended = 1 ; return 0 ; } 