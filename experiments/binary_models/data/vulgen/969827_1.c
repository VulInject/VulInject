som_object_setup ( , , , ) bfd * abfd ; struct header * file_hdrp ; struct som_exec_auxhdr * aux_hdrp ; unsigned long current_offset ; { asection * section ; int found ; abfd -> flags = BFD_NO_FLAGS ; if ( file_hdrp -> symbol_total ) { abfd -> flags |= HAS_LINENO | HAS_DEBUG | HAS_SYMS | HAS_LOCALS ; } switch ( file_hdrp -> a_magic ) { case DEMAND_MAGIC : abfd -> flags |= ( D_PAGED | WP_TEXT | EXEC_P ) ; break ; case SHARE_MAGIC : abfd -> flags |= ( WP_TEXT | EXEC_P ) ; break ; case EXEC_MAGIC : abfd -> flags |= ( EXEC_P ) ; break ; case RELOC_MAGIC : abfd -> flags |= HAS_RELOC ; break ; case SHL_MAGIC : case DL_MAGIC : abfd -> flags |= DYNAMIC ; break ; default : break ; } obj_som_exec_data ( abfd ) = ( som_exec_data * ) bfd_zalloc ( abfd , ( bfd_size_type ) sizeof ( som_exec_data ) ) ; if ( obj_som_exec_data ( abfd ) == NULL ) { return NULL ; } found = 0 ; for ( section = abfd -> sections ; section ; section = section -> next ) { if ( ( section -> flags & SEC_CODE ) == 0 ) { continue ; } if ( aux_hdrp -> exec_entry >= section -> vma && aux_hdrp -> exec_entry < section -> vma + section -> _cooked_size ) { found = 1 ; } } if ( aux_hdrp -> exec_entry == 0 || ( aux_hdrp -> exec_entry & 0x3 ) != 0 || ! found ) { bfd_get_start_address ( abfd ) = aux_hdrp -> exec_flags ; obj_som_exec_data ( abfd ) -> exec_flags = aux_hdrp -> exec_entry ; } else { bfd_get_start_address ( abfd ) = aux_hdrp -> exec_entry + current_offset ; obj_som_exec_data ( abfd ) -> exec_flags = aux_hdrp -> exec_flags ; } obj_som_exec_data ( abfd ) -> version_id = file_hdrp -> version_id ; bfd_default_set_arch_mach ( abfd , bfd_arch_hppa , pa10 ) ; bfd_get_symcount ( abfd ) = file_hdrp -> symbol_total ; obj_som_stringtab ( abfd ) = ( char * ) NULL ; obj_som_symtab ( abfd ) = ( som_symbol_type * ) NULL ; obj_som_sorted_syms ( abfd ) = NULL ; obj_som_stringtab_size ( abfd ) = file_hdrp -> symbol_strings_size ; obj_som_sym_filepos ( abfd ) = file_hdrp -> symbol_location + current_offset ; obj_som_str_filepos ( abfd ) = ( file_hdrp -> symbol_strings_location + current_offset ) ; obj_som_reloc_filepos ( abfd ) = ( file_hdrp -> fixup_request_location + current_offset ) ; obj_som_exec_data ( abfd ) -> system_id = file_hdrp -> system_id ; return abfd -> xvec ; } 