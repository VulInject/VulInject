static int __initdata tbl_size ; int __init efi_memattr_init ( void ) { efi_memory_attributes_table_t * tbl ; if ( efi_mem_attr_table == EFI_INVALID_TABLE_ADDR ) { return 0 ; } tbl = early_memremap ( efi_mem_attr_table , sizeof ( * tbl ) ) ; if ( ! tbl ) { pr_err ( "Failed to map EFI Memory Attributes table @ 0x%lx\n" , efi_mem_attr_table ) ; return - ENOMEM ; } if ( tbl -> version > 2 ) { pr_warn ( "Unexpected EFI Memory Attributes table version %d\n" , tbl -> version ) ; unmap } tbl_size = sizeof ( * tbl ) + tbl -> num_entries * tbl -> desc_size ; memblock_reserve ( efi_mem_attr_table , tbl_size ) ; set_bit ( EFI_MEM_ATTR , & efi . flags ) ; unmap early_memunmap ( tbl , sizeof ( * tbl ) ) ; return 0 ; } 