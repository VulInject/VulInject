int cifs_set_file_info ( struct inode * inode , struct iattr * attrs , unsigned int xid , char * full_path , __u32 dosattr ) { bool set_time = false ; struct cifs_sb_info * cifs_sb = CIFS_SB ( inode -> i_sb ) ; struct TCP_Server_Info * server ; FILE_BASIC_INFO info_buf ; server = cifs_sb_master_tcon ( cifs_sb ) -> ses -> server ; if ( ! server -> ops -> set_file_info ) { return - ENOSYS ; } if ( attrs -> ia_valid & ATTR_ATIME ) { set_time = true ; info_buf . LastAccessTime = cpu_to_le64 ( cifs_UnixTimeToNT ( attrs -> ia_atime ) ) ; } else { info_buf . LastAccessTime = 0 ; } if ( attrs -> ia_valid & ATTR_MTIME ) { set_time = true ; info_buf . LastWriteTime = cpu_to_le64 ( cifs_UnixTimeToNT ( attrs -> ia_mtime ) ) ; } else { info_buf . LastWriteTime = 0 ; } if ( set_time && ( attrs -> ia_valid & ATTR_CTIME ) ) { cifs_dbg ( FYI , "CIFS - CTIME changed\n" ) ; info_buf . ChangeTime = cpu_to_le64 ( cifs_UnixTimeToNT ( attrs -> ia_ctime ) ) ; } else { info_buf . ChangeTime = 0 ; } info_buf . CreationTime = 0 ; info_buf . Attributes = cpu_to_le32 ( dosattr ) ; return server -> ops -> set_file_info ( inode , full_path , & info_buf , xid ) ; } 