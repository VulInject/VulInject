static void start_command ( struct command * cmd ) { if ( cmd -> tty_fd < 0 ) { perror_msg_and_die ( "Can't open '%s'" , "/dev/tty" ) ; } cmd -> bck_tcgrp = tcgetpgrp ( cmd -> tty_fd ) ; if ( cmd -> bck_tcgrp < 0 ) { perror_msg_and_die ( "tcgetpgrp" ) ; } if ( tcgetattr ( cmd -> tty_fd , & cmd -> bck_tmodes ) < 0 ) { perror_msg_and_die ( "tcsetattr" ) ; } fflush ( NULL ) ; cmd -> pid = fork ( ) ; if ( cmd -> pid < 0 ) { perror_msg_and_die ( "fork" ) ; } if ( cmd -> pid == 0 ) { libreport_xmove_fd ( cmd -> tty_fd , 0 ) ; libreport_xdup2 ( 0 , 1 ) ; libreport_xdup2 ( 0 , 2 ) ; signal ( SIGTTOU , SIG_IGN ) ; pid_t pgrp = getpgrp ( ) ; if ( pgrp < 0 ) { perror_msg ( "getpgrp" ) ; _exit ( 127 ) ; } if ( tcsetpgrp ( 0 , pgrp ) < 0 ) { perror_msg ( "tcsetpgrp" ) ; _exit ( 127 ) ; } signal ( SIGTTOU , SIG_DFL ) ; execvp ( cmd -> argv [ 0 ] , cmd -> argv ) ; _exit ( 127 ) ; } } 