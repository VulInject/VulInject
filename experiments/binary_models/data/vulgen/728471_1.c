static int _set_cond ( int * start , int argc , char * * argv , slurmdb_cluster_cond_t * cluster_cond , List format_list ) { int i = 0 ; int cond_set = 0 ; int end = 0 ; int command_len = 0 ; with_deleted = 0 ; without_limits = 0 ; for ( i = ( * start ) ; i < argc ; i ++ ) { end = parse_option_end ( argv [ i ] ) ; if ( ! end ) { command_len = strlen ( argv [ i ] ) ; } else { command_len = end - 1 ; if ( argv [ i ] [ end ] == '=' ) { end ++ ; } } if ( ! xstrncasecmp ( argv [ i ] , "Set" , MAX ( command_len , 3 ) ) ) { i -- ; break ; } if ( ! end && ! xstrncasecmp ( argv [ i ] , "where" , MAX ( command_len , 5 ) ) ) { continue ; } if ( ! end && ! xstrncasecmp ( argv [ i ] , "WithDeleted" , MAX ( command_len , 5 ) ) ) { with_deleted = 1 ; } if ( ! end && ! xstrncasecmp ( argv [ i ] , "WithFed" , MAX ( command_len , 5 ) ) ) { with_fed = 1 ; } if ( ! end && ! xstrncasecmp ( argv [ i ] , "WOLimits" , MAX ( command_len , 3 ) ) ) { without_limits = 1 ; } if ( ! end || ! xstrncasecmp ( argv [ i ] , "Names" , MAX ( command_len , 1 ) ) || ! xstrncasecmp ( argv [ i ] , "Clusters" , MAX ( command_len , 3 ) ) ) { if ( slurm_addto_char_list ( cluster_cond -> cluster_list , argv [ i ] + end ) ) { cond_set |= SA_SET_ASSOC ; } } if ( ! end || ! xstrncasecmp ( argv [ i ] , "Federations" , MAX ( command_len , 3 ) ) ) { if ( ! cluster_cond -> federation_list ) { cluster_cond -> federation_list = list_create ( xfree_ptr ) ; } if ( slurm_addto_char_list ( cluster_cond -> federation_list , argv [ i ] + end ) ) { cond_set |= SA_SET_ASSOC ; } } if ( ! xstrncasecmp ( argv [ i ] , "Classification" , MAX ( command_len , 3 ) ) ) { cluster_cond -> classification = str_2_classification ( argv [ i ] + end ) ; if ( cluster_cond -> classification ) { cond_set |= SA_SET_CLUST ; } } if ( ! xstrncasecmp ( argv [ i ] , "flags" , MAX ( command_len , 2 ) ) ) { cluster_cond -> flags = slurmdb_str_2_cluster_flags ( argv [ i ] + end ) ; cond_set |= SA_SET_CLUST ; } if ( ! xstrncasecmp ( argv [ i ] , "Format" , MAX ( command_len , 2 ) ) ) { if ( format_list ) { slurm_addto_char_list ( format_list , argv [ i ] + end ) ; } } if ( ! end || ! xstrncasecmp ( argv [ i ] , "PluginIDSelect" , MAX ( command_len , 1 ) ) ) { if ( ! cluster_cond -> plugin_id_select_list ) { cluster_cond -> plugin_id_select_list = list_create ( xfree_ptr ) ; } if ( slurm_addto_char_list ( cluster_cond -> plugin_id_select_list , argv [ i ] + end ) ) { cond_set |= SA_SET_CLUST ; } } if ( ! end || ! xstrncasecmp ( argv [ i ] , "RPCVersions" , MAX ( command_len , 1 ) ) ) { if ( ! cluster_cond -> rpc_version_list ) { cluster_cond -> rpc_version_list = list_create ( xfree_ptr ) ; } if ( slurm_addto_char_list ( cluster_cond -> rpc_version_list , argv [ i ] + end ) ) { cond_set |= SA_SET_CLUST ; } } else { exit_code = 1 ; fprintf ( stderr , " Unknown condition: %s\n" " Use keyword 'set' to modify value\n" , argv [ i ] ) ; break ; } } ( * start ) = i ; return cond_set ; } 