static int ccu_clk_enable ( struct clk * c , int enable ) { struct ccu_clock * ccu_clk = to_ccu_clk ( c ) ; void * base = ( void * ) c -> ccu_clk_mgr_base ; int ret = 0 ; u32 reg ; debug ( "%s: %s\n" , __func__ , c -> name ) ; if ( ! enable ) { return - EINVAL ; } writel ( CLK_WR_ACCESS_PASSWORD , base + WR_ACCESS_OFFSET ) ; writel ( 1 , base + ccu_clk -> lvm_en_offset ) ; ret = wait_bit ( base , ccu_clk -> lvm_en_offset , 0 , 0 ) ; if ( ret ) { return ret ; } if ( ! ccu_clk -> freq_bit_shift ) { ccu_clk -> freq_bit_shift = 8 ; } writel ( reg , base + ccu_clk -> policy_freq_offset ) ; writel ( 0x7fffffff , base + ccu_clk -> policy0_mask_offset ) ; writel ( 0x7fffffff , base + ccu_clk -> policy1_mask_offset ) ; writel ( 0x7fffffff , base + ccu_clk -> policy2_mask_offset ) ; writel ( 0x7fffffff , base + ccu_clk -> policy3_mask_offset ) ; if ( ccu_clk -> num_policy_masks == 2 ) { writel ( 0x7fffffff , base + ccu_clk -> policy0_mask2_offset ) ; writel ( 0x7fffffff , base + ccu_clk -> policy1_mask2_offset ) ; writel ( 0x7fffffff , base + ccu_clk -> policy2_mask2_offset ) ; writel ( 0x7fffffff , base + ccu_clk -> policy3_mask2_offset ) ; } reg = readl ( base + ccu_clk -> policy_ctl_offset ) ; reg |= ( POLICY_CTL_GO + POLICY_CTL_GO_ATL ) ; writel ( reg , base + ccu_clk -> policy_ctl_offset ) ; ret = wait_bit ( base , ccu_clk -> policy_ctl_offset , 0 , 0 ) ; if ( ret ) { return ret ; } writel ( 0 , base + WR_ACCESS_OFFSET ) ; return ret ; } 