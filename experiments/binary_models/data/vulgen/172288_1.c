static ilb_status_t ilbd_destroy_one_rule ( ilbd_rule_t * irl ) { ilb_status_t rc ; ilb_name_cmd_t kcmd ; if ( ( irl -> irl_flags & ILB_FLAGS_RULE_ALLRULES ) == 0 ) { kcmd . cmd = ILB_DESTROY_RULE ; ( void ) strlcpy ( kcmd . name , irl -> irl_name , sizeof ( kcmd . name ) ) ; kcmd . flags = 0 ; rc = do_ioctl ( & kcmd , 0 ) ; if ( rc != ILB_STATUS_OK ) { return ( rc ) ; } } list_remove ( & irl -> irl_sg -> isg_rulelist , irl ) ; list_remove ( & ilbd_rule_hlist , irl ) ; if ( RULE_HAS_HC ( irl ) && ( rc = ilbd_hc_dissociate_rule ( irl ) ) != ILB_STATUS_OK ) { logerr ( "ilbd_destroy_one_rule: cannot " "dissociate %s from hc object %s: %d" , irl -> irl_name , irl -> irl_hcname , rc ) ; } rc = i_ilbd_save_rule ( irl , ILBD_SCF_DESTROY ) ; if ( rc != ILB_STATUS_OK ) { logdebug ( "ilbd_destroy_rule: save rule failed" ) ; } return ( rc ) ; } 