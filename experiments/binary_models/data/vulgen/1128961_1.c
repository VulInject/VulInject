static int __maybe_unused smsc9420_suspend ( struct device * dev_d ) { struct net_device * dev = dev_get_drvdata ( dev_d ) ; struct smsc9420_pdata * pd = netdev_priv ( dev ) ; u32 int_cfg ; ulong flags ; spin_lock_irqsave ( & pd -> int_lock , flags ) ; int_cfg = smsc9420_reg_read ( pd , INT_CFG ) & ( ~ INT_CFG_IRQ_EN_ ) ; smsc9420_reg_write ( pd , INT_CFG , int_cfg ) ; spin_unlock_irqrestore ( & pd -> int_lock , flags ) ; if ( netif_running ( dev ) ) { netif_tx_disable ( dev ) ; smsc9420_stop_tx ( pd ) ; smsc9420_free_tx_ring ( pd ) ; napi_disable ( & pd -> napi ) ; smsc9420_stop_rx ( pd ) ; smsc9420_free_rx_ring ( pd ) ; netif_device_detach ( dev ) ; } device_wakeup_disable ( dev_d ) ; return 0 ; } 