ret_code_t nrf_drv_saadc_buffer_convert ( nrf_saadc_value_t * p_buffer , uint16_t size ) { ASSERT ( m_cb . state != NRF_DRV_STATE_UNINITIALIZED ) ; ASSERT ( ( size % m_cb . active_channels ) == 0 ) ; ret_code_t err_code ; nrf_saadc_int_disable ( NRF_SAADC_INT_END | NRF_SAADC_INT_CALIBRATEDONE ) ; if ( m_cb . adc_state == NRF_SAADC_STATE_CALIBRATION ) { nrf_saadc_int_enable ( NRF_SAADC_INT_END | NRF_SAADC_INT_CALIBRATEDONE ) ; err_code = NRF_ERROR_BUSY ; NRF_LOG_WARNING ( "Function: %s, error code: %s.\r\n" , ( uint32_t ) __func__ , ( uint32_t ) ERR_TO_STR ( err_code ) ) ; return err_code ; } nrf_saadc_int_enable ( NRF_SAADC_INT_END ) ; m_cb . adc_state = NRF_SAADC_STATE_BUSY ; m_cb . p_buffer = p_buffer ; m_cb . buffer_size = size ; m_cb . p_secondary_buffer = NULL ; NRF_LOG_INFO ( "Function: %d, buffer length: %d, active channels: %d.\r\n" , ( uint32_t ) __func__ , size , m_cb . active_channels ) ; if ( m_cb . low_power_mode ) { m_cb . buffer_size_left = size ; nrf_saadc_buffer_init ( p_buffer , m_cb . active_channels ) ; } else { nrf_saadc_buffer_init ( p_buffer , size ) ; nrf_saadc_event_clear ( NRF_SAADC_EVENT_STARTED ) ; nrf_saadc_task_trigger ( NRF_SAADC_TASK_START ) ; } err_code = NRF_SUCCESS ; NRF_LOG_INFO ( "Function: %s, error code: %s.\r\n" , ( uint32_t ) __func__ , ( uint32_t ) ERR_TO_STR ( err_code ) ) ; return err_code ; } 