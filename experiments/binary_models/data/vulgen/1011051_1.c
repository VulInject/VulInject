gimp_templates_load ( ) { GFile * file ; GError * error = NULL ; g_return_if_fail ( GIMP_IS_GIMP ( gimp ) ) ; g_return_if_fail ( GIMP_IS_LIST ( gimp -> templates ) ) ; file = gimp_directory_file ( "templaterc" , NULL ) ; if ( gimp -> be_verbose ) { g_print ( "Parsing '%s'\n" , gimp_file_get_utf8_name ( file ) ) ; } if ( ! gimp_config_deserialize_file ( GIMP_CONFIG ( gimp -> templates ) , file , NULL , & error ) ) { if ( error -> code == GIMP_CONFIG_ERROR_OPEN_ENOENT ) { g_clear_error ( & error ) ; g_object_unref ( file ) ; if ( g_getenv ( "GIMP_TESTING_ABS_TOP_SRCDIR" ) ) { gchar * path ; path = g_build_filename ( g_getenv ( "GIMP_TESTING_ABS_TOP_SRCDIR" ) , "etc" , "templaterc" , NULL ) ; file = g_file_new_for_path ( path ) ; } else { file = gimp_sysconf_directory_file ( "templaterc" , NULL ) ; } if ( ! gimp_config_deserialize_file ( GIMP_CONFIG ( gimp -> templates ) , file , NULL , & error ) ) { gimp_message_literal ( gimp , NULL , GIMP_MESSAGE_ERROR , error -> message ) ; } } else { gimp_message_literal ( gimp , NULL , GIMP_MESSAGE_ERROR , error -> message ) ; } g_clear_error ( & error ) ; } gimp_list_reverse ( GIMP_LIST ( gimp -> templates ) ) ; g_object_unref ( file ) ; } 