static void Hal_EfuseReadEFuse88E ( struct adapter * Adapter , u16 _offset , u16 _size_byte , u8 * pbuf ) { u8 * efuseTbl = NULL ; u8 rtemp8 [ 1 ] ; u16 eFuse_Addr = 0 ; u8 offset , wren ; u16 i , j ; u16 * * eFuseWord = NULL ; u16 efuse_utilized = 0 ; u8 u1temp = 0 ; if ( ( _offset + _size_byte ) > EFUSE_MAP_LEN_88E ) { exit } efuseTbl = kzalloc ( EFUSE_MAP_LEN_88E , GFP_KERNEL ) ; if ( ! efuseTbl ) { exit } eFuseWord = rtw_malloc2d ( EFUSE_MAX_SECTION_88E , EFUSE_MAX_WORD_UNIT , sizeof ( u16 ) ) ; if ( ! eFuseWord ) { exit } for ( i = 0 ; i < EFUSE_MAX_SECTION_88E ; i ++ ) { for ( j = 0 ; j < EFUSE_MAX_WORD_UNIT ; j ++ ) { eFuseWord [ i ] [ j ] = 0xFFFF ; } } ReadEFuseByte ( Adapter , eFuse_Addr , rtemp8 ) ; if ( * rtemp8 != 0xFF ) { efuse_utilized ++ ; eFuse_Addr ++ ; } else { exit } while ( ( * rtemp8 != 0xFF ) && ( eFuse_Addr < EFUSE_REAL_CONTENT_LEN_88E ) ) { if ( ( * rtemp8 & 0x1F ) == 0x0F ) { u1temp = ( ( * rtemp8 & 0xE0 ) >> 5 ) ; ReadEFuseByte ( Adapter , eFuse_Addr , rtemp8 ) ; if ( ( * rtemp8 & 0x0F ) == 0x0F ) { eFuse_Addr ++ ; ReadEFuseByte ( Adapter , eFuse_Addr , rtemp8 ) ; if ( * rtemp8 != 0xFF && ( eFuse_Addr < EFUSE_REAL_CONTENT_LEN_88E ) ) { eFuse_Addr ++ ; } continue ; } else { offset = ( ( * rtemp8 & 0xF0 ) >> 1 ) | u1temp ; wren = ( * rtemp8 & 0x0F ) ; eFuse_Addr ++ ; } } else { offset = ( ( * rtemp8 >> 4 ) & 0x0f ) ; wren = ( * rtemp8 & 0x0f ) ; } if ( offset < EFUSE_MAX_SECTION_88E ) { for ( i = 0 ; i < EFUSE_MAX_WORD_UNIT ; i ++ ) { if ( ! ( wren & 0x01 ) ) { ReadEFuseByte ( Adapter , eFuse_Addr , rtemp8 ) ; eFuse_Addr ++ ; efuse_utilized ++ ; eFuseWord [ offset ] [ i ] = ( * rtemp8 & 0xff ) ; if ( eFuse_Addr >= EFUSE_REAL_CONTENT_LEN_88E ) { break ; } ReadEFuseByte ( Adapter , eFuse_Addr , rtemp8 ) ; eFuse_Addr ++ ; efuse_utilized ++ ; eFuseWord [ offset ] [ i ] |= ( ( ( u16 ) * rtemp8 << 8 ) & 0xff00 ) ; } wren >>= 1 ; } } ReadEFuseByte ( Adapter , eFuse_Addr , rtemp8 ) ; if ( * rtemp8 != 0xFF && ( eFuse_Addr < EFUSE_REAL_CONTENT_LEN_88E ) ) { efuse_utilized ++ ; eFuse_Addr ++ ; } } for ( i = 0 ; i < EFUSE_MAX_SECTION_88E ; i ++ ) { for ( j = 0 ; j < EFUSE_MAX_WORD_UNIT ; j ++ ) { efuseTbl [ ( i * 8 ) + ( j * 2 ) ] = ( eFuseWord [ i ] [ j ] & 0xff ) ; efuseTbl [ ( i * 8 ) + ( ( j * 2 ) + 1 ) ] = ( ( eFuseWord [ i ] [ j ] >> 8 ) & 0xff ) ; } } for ( i = 0 ; i < _size_byte ; i ++ ) { pbuf [ i ] = efuseTbl [ _offset + i ] ; } exit kfree ( efuseTbl ) ; kfree ( eFuseWord ) ; } 