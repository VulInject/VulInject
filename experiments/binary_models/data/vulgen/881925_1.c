int smu_v12_0_gfx_off_control ( struct smu_context * smu , bool enable ) { int ret = 0 , timeout = 500 ; if ( enable ) { ret = smu_cmn_send_smc_msg ( smu , SMU_MSG_AllowGfxOff , NULL ) ; } else { ret = smu_cmn_send_smc_msg ( smu , SMU_MSG_DisallowGfxOff , NULL ) ; while ( ! ( smu_v12_0_get_gfxoff_status ( smu ) == 2 ) ) { timeout -- ; if ( timeout == 0 ) { DRM_ERROR ( "disable gfxoff timeout and failed!\n" ) ; break ; } } } return ret ; } 