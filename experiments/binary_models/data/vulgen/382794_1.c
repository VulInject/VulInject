static DEFINE_MUTEX ( fscrypt_mode_key_setup_mutex ) ; static struct fscrypt_mode * select_encryption_mode ( const union fscrypt_policy * policy , const struct inode * inode ) { if ( S_ISREG ( inode -> i_mode ) ) { return & fscrypt_modes [ fscrypt_policy_contents_mode ( policy ) ] ; } if ( S_ISDIR ( inode -> i_mode ) || S_ISLNK ( inode -> i_mode ) ) { return & fscrypt_modes [ fscrypt_policy_fnames_mode ( policy ) ] ; } WARN_ONCE ( 1 , "fscrypt: filesystem tried to load encryption info for inode %lu, which is not encryptable (file type %d)\n" , inode -> i_ino , ( inode -> i_mode & S_IFMT ) ) ; return ERR_PTR ( - EINVAL ) ; } 