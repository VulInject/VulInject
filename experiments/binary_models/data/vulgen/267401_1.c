draw = qfalse ; prev = & r_activeFlares ; while ( ( f = * prev ) != NULL ) { if ( f -> addedFrame < backEnd . viewParms . frameCount - 1 ) { * prev = f -> next ; f -> next = r_inactiveFlares ; r_inactiveFlares = f ; continue ; } f -> drawIntensity = 0 ; if ( f -> frameSceneNum == backEnd . viewParms . frameSceneNum && f -> inPortal == backEnd . viewParms . isPortal ) { RB_TestFlare ( f ) ; if ( f -> drawIntensity ) { draw = qtrue ; } else { * prev = f -> next ; f -> next = r_inactiveFlares ; r_inactiveFlares = f ; continue ; } } prev = & f -> next ; } Mat4Copy ( glState . projection , oldprojection ) ; Mat4Copy ( glState . modelview , oldmodelview ) ; Mat4Identity ( matrix ) ; GL_SetModelviewMatrix ( matrix ) ; Mat4Ortho ( backEnd . viewParms . viewportX , backEnd . viewParms . viewportX + backEnd . viewParms . viewportWidth , backEnd . viewParms . viewportY , backEnd . viewParms . viewportY + backEnd . viewParms . viewportHeight , - 99999 , 99999 , matrix ) ; GL_SetProjectionMatrix ( matrix ) ; for ( f = r_activeFlares ; f ; f = f -> next ) { if ( f -> frameSceneNum == backEnd . viewParms . frameSceneNum && f -> inPortal == backEnd . viewParms . isPortal && f -> drawIntensity ) { RB_RenderFlare ( f ) ; } } GL_SetProjectionMatrix ( oldprojection ) ; GL_SetModelviewMatrix ( oldmodelview ) ; 