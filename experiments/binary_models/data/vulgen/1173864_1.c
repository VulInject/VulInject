static int repquota ( char * fsdev , char * fsfile , char * qffile ) { FILE * qf ; uid_t uid ; struct dqblk dqbuf ; struct stat64 statb ; if ( vflag || aflag ) { ( void ) printf ( "%s (%s):\n" , fsdev , fsfile ) ; } qf = fopen64 ( qffile , "r" ) ; if ( qf == NULL ) { perror ( qffile ) ; return ( 1 ) ; } if ( fstat64 ( fileno ( qf ) , & statb ) < 0 ) { perror ( qffile ) ; ( void ) fclose ( qf ) ; return ( 1 ) ; } if ( ioctl ( fileno ( qf ) , _FIOFFS , NULL ) == - 1 ) { perror ( qffile ) ; ( void ) fprintf ( stderr , "%s: cannot flush file system.\n" , qffile ) ; ( void ) fclose ( qf ) ; return ( 1 ) ; } header ( ) ; for ( uid = 0 ; uid <= MAXUID && uid >= 0 ; uid ++ ) { ( void ) fread ( & dqbuf , sizeof ( dqblk ) , 1 , qf ) ; if ( ! vflag && dqbuf . dqb_curfiles == 0 && dqbuf . dqb_curblocks == 0 ) { continue ; } prquota ( uid , & dqbuf ) ; } ( void ) fclose ( qf ) ; return ( 0 ) ; } 