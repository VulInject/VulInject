static void ef4_farch_handle_rx_flush_done ( struct ef4_nic * efx , ef4_qword_t * event ) { struct ef4_channel * channel ; struct ef4_rx_queue * rx_queue ; int qid ; bool failed ; qid = EF4_QWORD_FIELD ( * event , FSF_AZ_DRIVER_EV_RX_DESCQ_ID ) ; failed = EF4_QWORD_FIELD ( * event , FSF_AZ_DRIVER_EV_RX_FLUSH_FAIL ) ; channel = ef4_get_channel ( efx , qid ) ; if ( ! ef4_channel_has_rx_queue ( channel ) ) { return ; } rx_queue = ef4_channel_get_rx_queue ( channel ) ; if ( failed ) { netif_info ( efx , hw , efx -> net_dev , "RXQ %d flush retry\n" , qid ) ; rx_queue -> flush_pending = true ; atomic_inc ( & efx -> rxq_flush_pending ) ; } else { ef4_farch_magic_event ( ef4_rx_queue_channel ( rx_queue ) , EF4_CHANNEL_MAGIC_RX_DRAIN ( rx_queue ) ) ; } atomic_dec ( & efx -> rxq_flush_outstanding ) ; if ( ef4_farch_flush_wake ( efx ) ) { wake_up ( & efx -> flush_wq ) ; } } 