static BOOL update_recv_primary_order ( rdpUpdate * update , wStream * s , BYTE flags ) { BYTE field ; BOOL rc = FALSE ; rdp_update_internal * up = update_cast ( update ) ; rdpContext * context = update -> context ; rdp_primary_update_internal * primary = primary_update_cast ( update -> primary ) ; ORDER_INFO * orderInfo ; rdpSettings * settings ; const char * orderName ; BOOL defaultReturn ; WINPR_ASSERT ( s ) ; orderInfo = & ( primary -> order_info ) ; WINPR_ASSERT ( orderInfo ) ; WINPR_ASSERT ( context ) ; settings = context -> settings ; WINPR_ASSERT ( settings ) ; defaultReturn = freerdp_settings_get_bool ( settings , FreeRDP_DeactivateClientDecoding ) ; if ( flags & ORDER_TYPE_CHANGE ) { Stream_Read_UINT8 ( s , orderInfo -> orderType ) ; } orderName = primary_order_string ( orderInfo -> orderType ) ; WLog_Print ( up -> log , WLOG_DEBUG , "Primary Drawing Order %s" , orderName ) ; if ( ! check_primary_order_supported ( up -> log , settings , orderInfo -> orderType , orderName ) ) { return FALSE ; } field = get_primary_drawing_order_field_bytes ( orderInfo -> orderType , & rc ) ; if ( ! rc ) { return FALSE ; } if ( ! update_read_field_flags ( s , & ( orderInfo -> fieldFlags ) , flags , field ) ) { WLog_Print ( up -> log , WLOG_ERROR , "update_read_field_flags() failed" ) ; return FALSE ; } if ( flags & ORDER_BOUNDS ) { if ( ! ( flags & ORDER_ZERO_BOUNDS_DELTAS ) ) { if ( ! update_read_bounds ( s , & orderInfo -> bounds ) ) { WLog_Print ( up -> log , WLOG_ERROR , "update_read_bounds() failed" ) ; return FALSE ; } } rc = IFCALLRESULT ( defaultReturn , update -> SetBounds , context , & orderInfo -> bounds ) ; if ( ! rc ) { return FALSE ; } } orderInfo -> deltaCoordinates = ( flags & ORDER_DELTA_COORDINATES ) ?TRUE : FALSE ; if ( ! read_primary_order ( up -> log , orderName , s , orderInfo , & primary -> common ) ) { return FALSE ; } rc = IFCALLRESULT ( TRUE , primary -> common . OrderInfo , context , orderInfo , orderName ) ; if ( ! rc ) { return FALSE ; } switch ( orderInfo -> orderType ) { case ORDER_TYPE_DSTBLT : { WLog_Print ( up -> log , WLOG_DEBUG , "Primary Drawing Order %s rop=%s [0x%08" PRIx32 "]" , orderName , gdi_rop3_code_string ( primary -> dstblt . bRop ) , gdi_rop3_code ( primary -> dstblt . bRop ) ) ; rc = IFCALLRESULT ( defaultReturn , primary -> common . DstBlt , context , & primary -> dstblt ) ; } break ; case ORDER_TYPE_PATBLT : { WLog_Print ( up -> log , WLOG_DEBUG , "Primary Drawing Order %s rop=%s [0x%08" PRIx32 "]" , orderName , gdi_rop3_code_string ( primary -> patblt . bRop ) , gdi_rop3_code ( primary -> patblt . bRop ) ) ; rc = IFCALLRESULT ( defaultReturn , primary -> common . PatBlt , context , & primary -> patblt ) ; } break ; case ORDER_TYPE_SCRBLT : { WLog_Print ( up -> log , WLOG_DEBUG , "Primary Drawing Order %s rop=%s [0x%08" PRIx32 "]" , orderName , gdi_rop3_code_string ( primary -> scrblt . bRop ) , gdi_rop3_code ( primary -> scrblt . bRop ) ) ; rc = IFCALLRESULT ( defaultReturn , primary -> common . ScrBlt , context , & primary -> scrblt ) ; } break ; case ORDER_TYPE_OPAQUE_RECT : { WLog_Print ( up -> log , WLOG_DEBUG , "Primary Drawing Order %s" , orderName ) ; rc = IFCALLRESULT ( defaultReturn , primary -> common . OpaqueRect , context , & primary -> opaque_rect ) ; } break ; case ORDER_TYPE_DRAW_NINE_GRID : { WLog_Print ( up -> log , WLOG_DEBUG , "Primary Drawing Order %s" , orderName ) ; rc = IFCALLRESULT ( defaultReturn , primary -> common . DrawNineGrid , context , & primary -> draw_nine_grid ) ; } break ; case ORDER_TYPE_MULTI_DSTBLT : { WLog_Print ( up -> log , WLOG_DEBUG , "Primary Drawing Order %s rop=%s [0x%08" PRIx32 "]" , orderName , gdi_rop3_code_string ( primary -> multi_dstblt . bRop ) , gdi_rop3_code ( primary -> multi_dstblt . bRop ) ) ; rc = IFCALLRESULT ( defaultReturn , primary -> common . MultiDstBlt , context , & primary -> multi_dstblt ) ; } break ; case ORDER_TYPE_MULTI_PATBLT : { WLog_Print ( up -> log , WLOG_DEBUG , "Primary Drawing Order %s rop=%s [0x%08" PRIx32 "]" , orderName , gdi_rop3_code_string ( primary -> multi_patblt . bRop ) , gdi_rop3_code ( primary -> multi_patblt . bRop ) ) ; rc = IFCALLRESULT ( defaultReturn , primary -> common . MultiPatBlt , context , & primary -> multi_patblt ) ; } break ; case ORDER_TYPE_MULTI_SCRBLT : { WLog_Print ( up -> log , WLOG_DEBUG , "Primary Drawing Order %s rop=%s [0x%08" PRIx32 "]" , orderName , gdi_rop3_code_string ( primary -> multi_scrblt . bRop ) , gdi_rop3_code ( primary -> multi_scrblt . bRop ) ) ; rc = IFCALLRESULT ( defaultReturn , primary -> common . MultiScrBlt , context , & primary -> multi_scrblt ) ; } break ; case ORDER_TYPE_MULTI_OPAQUE_RECT : { WLog_Print ( up -> log , WLOG_DEBUG , "Primary Drawing Order %s" , orderName ) ; rc = IFCALLRESULT ( defaultReturn , primary -> common . MultiOpaqueRect , context , & primary -> multi_opaque_rect ) ; } break ; case ORDER_TYPE_MULTI_DRAW_NINE_GRID : { WLog_Print ( up -> log , WLOG_DEBUG , "Primary Drawing Order %s" , orderName ) ; rc = IFCALLRESULT ( defaultReturn , primary -> common . MultiDrawNineGrid , context , & primary -> multi_draw_nine_grid ) ; } break ; case ORDER_TYPE_LINE_TO : { WLog_Print ( up -> log , WLOG_DEBUG , "Primary Drawing Order %s" , orderName ) ; rc = IFCALLRESULT ( defaultReturn , primary -> common . LineTo , context , & primary -> line_to ) ; } break ; case ORDER_TYPE_POLYLINE : { WLog_Print ( up -> log , WLOG_DEBUG , "Primary Drawing Order %s" , orderName ) ; rc = IFCALLRESULT ( defaultReturn , primary -> common . Polyline , context , & primary -> polyline ) ; } break ; case ORDER_TYPE_MEMBLT : { WLog_Print ( up -> log , WLOG_DEBUG , "Primary Drawing Order %s rop=%s [0x%08" PRIx32 "]" , orderName , gdi_rop3_code_string ( primary -> memblt . bRop ) , gdi_rop3_code ( primary -> memblt . bRop ) ) ; rc = IFCALLRESULT ( defaultReturn , primary -> common . MemBlt , context , & primary -> memblt ) ; } break ; case ORDER_TYPE_MEM3BLT : { WLog_Print ( up -> log , WLOG_DEBUG , "Primary Drawing Order %s rop=%s [0x%08" PRIx32 "]" , orderName , gdi_rop3_code_string ( primary -> mem3blt . bRop ) , gdi_rop3_code ( primary -> mem3blt . bRop ) ) ; rc = IFCALLRESULT ( defaultReturn , primary -> common . Mem3Blt , context , & primary -> mem3blt ) ; } break ; case ORDER_TYPE_SAVE_BITMAP : { WLog_Print ( up -> log , WLOG_DEBUG , "Primary Drawing Order %s" , orderName ) ; rc = IFCALLRESULT ( defaultReturn , primary -> common . SaveBitmap , context , & primary -> save_bitmap ) ; } break ; case ORDER_TYPE_GLYPH_INDEX : { WLog_Print ( up -> log , WLOG_DEBUG , "Primary Drawing Order %s" , orderName ) ; rc = IFCALLRESULT ( defaultReturn , primary -> common . GlyphIndex , context , & primary -> glyph_index ) ; } break ; case ORDER_TYPE_FAST_INDEX : { WLog_Print ( up -> log , WLOG_DEBUG , "Primary Drawing Order %s" , orderName ) ; rc = IFCALLRESULT ( defaultReturn , primary -> common . FastIndex , context , & primary -> fast_index ) ; } break ; case ORDER_TYPE_FAST_GLYPH : { WLog_Print ( up -> log , WLOG_DEBUG , "Primary Drawing Order %s" , orderName ) ; rc = IFCALLRESULT ( defaultReturn , primary -> common . FastGlyph , context , & primary -> fast_glyph ) ; } break ; case ORDER_TYPE_POLYGON_SC : { WLog_Print ( up -> log , WLOG_DEBUG , "Primary Drawing Order %s" , orderName ) ; rc = IFCALLRESULT ( defaultReturn , primary -> common . PolygonSC , context , & primary -> polygon_sc ) ; } break ; case ORDER_TYPE_POLYGON_CB : { WLog_Print ( up -> log , WLOG_DEBUG , "Primary Drawing Order %s" , orderName ) ; rc = IFCALLRESULT ( defaultReturn , primary -> common . PolygonCB , context , & primary -> polygon_cb ) ; } break ; case ORDER_TYPE_ELLIPSE_SC : { WLog_Print ( up -> log , WLOG_DEBUG , "Primary Drawing Order %s" , orderName ) ; rc = IFCALLRESULT ( defaultReturn , primary -> common . EllipseSC , context , & primary -> ellipse_sc ) ; } break ; case ORDER_TYPE_ELLIPSE_CB : { WLog_Print ( up -> log , WLOG_DEBUG , "Primary Drawing Order %s" , orderName ) ; rc = IFCALLRESULT ( defaultReturn , primary -> common . EllipseCB , context , & primary -> ellipse_cb ) ; } break ; default : WLog_Print ( up -> log , WLOG_WARN , "Primary Drawing Order %s not supported" , orderName ) ; break ; } if ( ! rc ) { WLog_Print ( up -> log , WLOG_WARN , "Primary Drawing Order %s failed" , orderName ) ; return FALSE ; } if ( flags & ORDER_BOUNDS ) { rc = IFCALLRESULT ( defaultReturn , update -> SetBounds , context , NULL ) ; } return rc ; } 