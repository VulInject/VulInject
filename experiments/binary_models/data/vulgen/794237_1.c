static void _rtl92de_process_ui_link_quality ( struct ieee80211_hw * hw , struct rtl_stats * pstats ) { struct rtl_priv * rtlpriv = rtl_priv ( hw ) ; u32 last_evm , tmpval ; if ( pstats -> packet_toself || pstats -> packet_beacon ) { if ( rtlpriv -> stats . ui_link_quality . total_num ++ >= PHY_LINKQUALITY_SLID_WIN_MAX ) { rtlpriv -> stats . ui_link_quality . total_num = PHY_LINKQUALITY_SLID_WIN_MAX ; last_evm = rtlpriv -> stats . ui_link_quality . elements [ rtlpriv -> stats . ui_link_quality . index ] ; rtlpriv -> stats . ui_link_quality . total_val -= last_evm ; } rtlpriv -> stats . ui_link_quality . total_val += pstats -> signalquality ; rtlpriv -> stats . ui_link_quality . elements [ rtlpriv -> stats . ui_link_quality . index ++ ] = pstats -> signalquality ; if ( rtlpriv -> stats . ui_link_quality . index >= PHY_LINKQUALITY_SLID_WIN_MAX ) { rtlpriv -> stats . ui_link_quality . index = 0 ; } tmpval = rtlpriv -> stats . ui_link_quality . total_val / rtlpriv -> stats . ui_link_quality . total_num ; rtlpriv -> stats . signal_quality = tmpval ; rtlpriv -> stats . last_sigstrength_inpercent = tmpval ; rtl92d_loop_over_streams ( hw , pstats ) ; } } 