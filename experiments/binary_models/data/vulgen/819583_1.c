optimize_stmt ( , , ) { stmt_ann_t ann ; tree stmt , old_stmt ; bool may_optimize_p ; bool may_have_exposed_new_symbols = false ; old_stmt = stmt = bsi_stmt ( si ) ; if ( TREE_CODE ( stmt ) == COND_EXPR ) { canonicalize_comparison ( stmt ) ; } update_stmt_if_modified ( stmt ) ; ann = stmt_ann ( stmt ) ; opt_stats . num_stmts ++ ; may_have_exposed_new_symbols = false ; if ( dump_file && ( dump_flags & TDF_DETAILS ) ) { fprintf ( dump_file , "Optimizing statement " ) ; print_generic_stmt ( dump_file , stmt , TDF_SLIM ) ; } may_have_exposed_new_symbols = cprop_into_stmt ( stmt ) ; if ( ann -> modified ) { tree rhs ; if ( fold_stmt ( bsi_stmt_ptr ( si ) ) ) { stmt = bsi_stmt ( si ) ; ann = stmt_ann ( stmt ) ; if ( dump_file && ( dump_flags & TDF_DETAILS ) ) { fprintf ( dump_file , "  Folded to: " ) ; print_generic_stmt ( dump_file , stmt , TDF_SLIM ) ; } } rhs = get_rhs ( stmt ) ; if ( rhs && TREE_CODE ( rhs ) == ADDR_EXPR ) { recompute_tree_invariant_for_addr_expr ( rhs ) ; } may_have_exposed_new_symbols = true ; } may_optimize_p = ( ! ann -> has_volatile_ops && ( ( TREE_CODE ( stmt ) == RETURN_EXPR && TREE_OPERAND ( stmt , 0 ) && TREE_CODE ( TREE_OPERAND ( stmt , 0 ) ) == MODIFY_EXPR && ! ( TREE_SIDE_EFFECTS ( TREE_OPERAND ( TREE_OPERAND ( stmt , 0 ) , 1 ) ) ) ) || ( TREE_CODE ( stmt ) == MODIFY_EXPR && ! TREE_SIDE_EFFECTS ( TREE_OPERAND ( stmt , 1 ) ) ) || TREE_CODE ( stmt ) == COND_EXPR || TREE_CODE ( stmt ) == SWITCH_EXPR ) ) ; if ( may_optimize_p ) { may_have_exposed_new_symbols |= eliminate_redundant_computations ( stmt ) ; } if ( TREE_CODE ( stmt ) == MODIFY_EXPR ) { record_equivalences_from_stmt ( stmt , may_optimize_p , ann ) ; } if ( ann -> modified ) { tree val = NULL ; if ( TREE_CODE ( stmt ) == COND_EXPR ) { val = COND_EXPR_COND ( stmt ) ; } if ( val && TREE_CODE ( val ) == INTEGER_CST && find_taken_edge ( bb , val ) ) { cfg_altered = true ; } if ( maybe_clean_or_replace_eh_stmt ( old_stmt , stmt ) ) { bitmap_set_bit ( need_eh_cleanup , bb -> index ) ; if ( dump_file && ( dump_flags & TDF_DETAILS ) ) { fprintf ( dump_file , "  Flagged to clear EH edges.\n" ) ; } } } if ( may_have_exposed_new_symbols ) { VEC_safe_push ( tree , heap , stmts_to_rescan , bsi_stmt ( si ) ) ; } } 