emit_move_sequence ( , , ) { register rtx operand0 = operands [ 0 ] ; register rtx operand1 = operands [ 1 ] ; register rtx tem ; if ( GET_CODE ( operand0 ) == MEM && IS_INDEX_ADDR_P ( XEXP ( operand0 , 0 ) ) ) { gcc_assert ( ! no_new_pseudos ) ; tem = copy_to_mode_reg ( Pmode , XEXP ( operand0 , 0 ) ) ; operand0 = replace_equiv_address ( operand0 , tem ) ; } if ( ! TARGET_NO_SPACE_REGS && ! cse_not_expected && GET_CODE ( operand1 ) == MEM && GET_CODE ( XEXP ( operand1 , 0 ) ) == PLUS && REG_P ( XEXP ( XEXP ( operand1 , 0 ) , 0 ) ) && REG_P ( XEXP ( XEXP ( operand1 , 0 ) , 1 ) ) ) { operand1 = replace_equiv_address ( operand1 , copy_to_mode_reg ( Pmode , XEXP ( operand1 , 0 ) ) ) ; } if ( scratch_reg && reload_in_progress && GET_CODE ( operand0 ) == REG && REGNO ( operand0 ) >= FIRST_PSEUDO_REGISTER ) { operand0 = reg_equiv_mem [ REGNO ( operand0 ) ] ; } if ( scratch_reg && reload_in_progress && GET_CODE ( operand0 ) == SUBREG && GET_CODE ( SUBREG_REG ( operand0 ) ) == REG && REGNO ( SUBREG_REG ( operand0 ) ) >= FIRST_PSEUDO_REGISTER ) { rtx temp = gen_rtx_SUBREG ( GET_MODE ( operand0 ) , reg_equiv_mem [ REGNO ( SUBREG_REG ( operand0 ) ) ] , SUBREG_BYTE ( operand0 ) ) ; operand0 = alter_subreg ( & temp ) ; } if ( scratch_reg && reload_in_progress && GET_CODE ( operand1 ) == REG && REGNO ( operand1 ) >= FIRST_PSEUDO_REGISTER ) { operand1 = reg_equiv_mem [ REGNO ( operand1 ) ] ; } if ( scratch_reg && reload_in_progress && GET_CODE ( operand1 ) == SUBREG && GET_CODE ( SUBREG_REG ( operand1 ) ) == REG && REGNO ( SUBREG_REG ( operand1 ) ) >= FIRST_PSEUDO_REGISTER ) { rtx temp = gen_rtx_SUBREG ( GET_MODE ( operand1 ) , reg_equiv_mem [ REGNO ( SUBREG_REG ( operand1 ) ) ] , SUBREG_BYTE ( operand1 ) ) ; operand1 = alter_subreg ( & temp ) ; } if ( scratch_reg && reload_in_progress && GET_CODE ( operand0 ) == MEM && ( ( tem = find_replacement ( & XEXP ( operand0 , 0 ) ) ) != XEXP ( operand0 , 0 ) ) ) { operand0 = replace_equiv_address ( operand0 , tem ) ; } if ( scratch_reg && reload_in_progress && GET_CODE ( operand1 ) == MEM && ( ( tem = find_replacement ( & XEXP ( operand1 , 0 ) ) ) != XEXP ( operand1 , 0 ) ) ) { operand1 = replace_equiv_address ( operand1 , tem ) ; } if ( scratch_reg && fp_reg_operand ( operand0 , mode ) && ( ( GET_CODE ( operand1 ) == MEM && ! memory_address_p ( ( GET_MODE_SIZE ( mode ) == 4 ?SFmode : DFmode ) , XEXP ( operand1 , 0 ) ) ) || ( ( GET_CODE ( operand1 ) == SUBREG && GET_CODE ( XEXP ( operand1 , 0 ) ) == MEM && ! memory_address_p ( ( GET_MODE_SIZE ( mode ) == 4 ?SFmode : DFmode ) , XEXP ( XEXP ( operand1 , 0 ) , 0 ) ) ) ) ) ) { if ( GET_CODE ( operand1 ) == SUBREG ) { operand1 = XEXP ( operand1 , 0 ) ; } scratch_reg = force_mode ( word_mode , scratch_reg ) ; if ( ! memory_address_p ( Pmode , XEXP ( operand1 , 0 ) ) ) { emit_move_insn ( scratch_reg , XEXP ( XEXP ( operand1 , 0 ) , 1 ) ) ; emit_move_insn ( scratch_reg , gen_rtx_fmt_ee ( GET_CODE ( XEXP ( operand1 , 0 ) ) , Pmode , XEXP ( XEXP ( operand1 , 0 ) , 0 ) , scratch_reg ) ) ; } else { emit_move_insn ( scratch_reg , XEXP ( operand1 , 0 ) ) ; } emit_insn ( gen_rtx_SET ( VOIDmode , operand0 , replace_equiv_address ( operand1 , scratch_reg ) ) ) ; return 1 ; } if ( scratch_reg && fp_reg_operand ( operand1 , mode ) && ( ( GET_CODE ( operand0 ) == MEM && ! memory_address_p ( ( GET_MODE_SIZE ( mode ) == 4 ?SFmode : DFmode ) , XEXP ( operand0 , 0 ) ) ) || ( ( GET_CODE ( operand0 ) == SUBREG ) && GET_CODE ( XEXP ( operand0 , 0 ) ) == MEM && ! memory_address_p ( ( GET_MODE_SIZE ( mode ) == 4 ?SFmode : DFmode ) , XEXP ( XEXP ( operand0 , 0 ) , 0 ) ) ) ) ) { if ( GET_CODE ( operand0 ) == SUBREG ) { operand0 = XEXP ( operand0 , 0 ) ; } scratch_reg = force_mode ( word_mode , scratch_reg ) ; if ( ! memory_address_p ( Pmode , XEXP ( operand0 , 0 ) ) ) { emit_move_insn ( scratch_reg , XEXP ( XEXP ( operand0 , 0 ) , 1 ) ) ; emit_move_insn ( scratch_reg , gen_rtx_fmt_ee ( GET_CODE ( XEXP ( operand0 , 0 ) ) , Pmode , XEXP ( XEXP ( operand0 , 0 ) , 0 ) , scratch_reg ) ) ; } else { emit_move_insn ( scratch_reg , XEXP ( operand0 , 0 ) ) ; } emit_insn ( gen_rtx_SET ( VOIDmode , replace_equiv_address ( operand0 , scratch_reg ) , operand1 ) ) ; return 1 ; } if ( scratch_reg && CONSTANT_P ( operand1 ) && fp_reg_operand ( operand0 , mode ) ) { rtx const_mem , xoperands [ 2 ] ; scratch_reg = force_mode ( word_mode , scratch_reg ) ; const_mem = force_const_mem ( mode , operand1 ) ; xoperands [ 0 ] = scratch_reg ; xoperands [ 1 ] = XEXP ( const_mem , 0 ) ; emit_move_sequence ( xoperands , Pmode , 0 ) ; emit_insn ( gen_rtx_SET ( mode , operand0 , replace_equiv_address ( const_mem , scratch_reg ) ) ) ; return 1 ; } if ( scratch_reg && GET_CODE ( operand0 ) == REG && REGNO ( operand0 ) < FIRST_PSEUDO_REGISTER && REGNO_REG_CLASS ( REGNO ( operand0 ) ) == SHIFT_REGS && ( GET_CODE ( operand1 ) == MEM || GET_CODE ( operand1 ) == CONST_INT || ( GET_CODE ( operand1 ) == REG && FP_REG_CLASS_P ( REGNO_REG_CLASS ( REGNO ( operand1 ) ) ) ) ) ) { if ( GET_CODE ( operand1 ) == MEM && ! memory_address_p ( Pmode , XEXP ( operand1 , 0 ) ) ) { scratch_reg = force_mode ( word_mode , scratch_reg ) ; emit_move_insn ( scratch_reg , XEXP ( XEXP ( operand1 , 0 ) , 1 ) ) ; emit_move_insn ( scratch_reg , gen_rtx_fmt_ee ( GET_CODE ( XEXP ( operand1 , 0 ) ) , Pmode , XEXP ( XEXP ( operand1 , 0 ) , 0 ) , scratch_reg ) ) ; scratch_reg = force_mode ( GET_MODE ( operand0 ) , scratch_reg ) ; emit_move_insn ( scratch_reg , replace_equiv_address ( operand1 , scratch_reg ) ) ; } else { scratch_reg = force_mode ( GET_MODE ( operand0 ) , scratch_reg ) ; emit_move_insn ( scratch_reg , operand1 ) ; } emit_move_insn ( operand0 , scratch_reg ) ; return 1 ; } if ( register_operand ( operand0 , mode ) ) { if ( register_operand ( operand1 , mode ) || ( GET_CODE ( operand1 ) == CONST_INT && cint_ok_for_move ( INTVAL ( operand1 ) ) ) || ( operand1 == CONST0_RTX ( mode ) ) || ( GET_CODE ( operand1 ) == HIGH && ! symbolic_operand ( XEXP ( operand1 , 0 ) , VOIDmode ) ) || GET_CODE ( operand1 ) == MEM ) { if ( REG_P ( operand0 ) && REG_P ( operand1 ) ) { if ( REG_POINTER ( operand1 ) && ! REG_POINTER ( operand0 ) && ! HARD_REGISTER_P ( operand0 ) ) { copy_reg_pointer ( operand0 , operand1 ) ; } if ( REG_POINTER ( operand0 ) && ! REG_POINTER ( operand1 ) && ! HARD_REGISTER_P ( operand1 ) ) { copy_reg_pointer ( operand1 , operand0 ) ; } } if ( REG_P ( operand0 ) && GET_CODE ( operand1 ) == MEM && ! REG_POINTER ( operand0 ) ) { tree decl = MEM_EXPR ( operand1 ) ; if ( decl && ! ( flag_argument_noalias > 1 && TREE_CODE ( decl ) == INDIRECT_REF && TREE_CODE ( TREE_OPERAND ( decl , 0 ) ) == PARM_DECL ) ) { tree type ; if ( TREE_CODE ( decl ) == COMPONENT_REF ) { decl = TREE_OPERAND ( decl , 1 ) ; } type = TREE_TYPE ( decl ) ; if ( TREE_CODE ( type ) == ARRAY_TYPE ) { type = get_inner_array_type ( type ) ; } if ( POINTER_TYPE_P ( type ) ) { int align ; type = TREE_TYPE ( type ) ; align = ( TYPE_ALIGN_OK ( type ) ?TYPE_ALIGN ( type ) : BITS_PER_UNIT ) ; mark_reg_pointer ( operand0 , align ) ; } } } emit_insn ( gen_rtx_SET ( VOIDmode , operand0 , operand1 ) ) ; return 1 ; } } if ( GET_CODE ( operand0 ) == MEM ) { if ( mode == DFmode && operand1 == CONST0_RTX ( mode ) && ! ( reload_in_progress || reload_completed ) ) { rtx temp = gen_reg_rtx ( DFmode ) ; emit_insn ( gen_rtx_SET ( VOIDmode , temp , operand1 ) ) ; emit_insn ( gen_rtx_SET ( VOIDmode , operand0 , temp ) ) ; return 1 ; } if ( register_operand ( operand1 , mode ) || operand1 == CONST0_RTX ( mode ) ) { emit_insn ( gen_rtx_SET ( VOIDmode , operand0 , operand1 ) ) ; return 1 ; } if ( ! ( reload_in_progress || reload_completed ) ) { operands [ 0 ] = validize_mem ( operand0 ) ; operands [ 1 ] = operand1 = force_reg ( mode , operand1 ) ; } } if ( ( GET_CODE ( operand1 ) != HIGH && immediate_operand ( operand1 , mode ) ) || function_label_operand ( operand1 , mode ) || ( GET_CODE ( operand1 ) == HIGH && symbolic_operand ( XEXP ( operand1 , 0 ) , mode ) ) ) { int ishighonly = 0 ; if ( GET_CODE ( operand1 ) == HIGH ) { ishighonly = 1 ; operand1 = XEXP ( operand1 , 0 ) ; } if ( symbolic_operand ( operand1 , mode ) ) { if ( ( GET_CODE ( operand1 ) == CONST && GET_CODE ( XEXP ( operand1 , 0 ) ) == PLUS && function_label_operand ( XEXP ( XEXP ( operand1 , 0 ) , 0 ) , Pmode ) ) || function_label_operand ( operand1 , mode ) ) { rtx temp , const_part ; if ( reload_in_progress || reload_completed ) { scratch_reg = scratch_reg ?scratch_reg : operand0 ; scratch_reg = force_mode ( word_mode , scratch_reg ) ; } if ( flag_pic ) { scratch_reg = gen_reg_rtx ( Pmode ) ; } if ( GET_CODE ( operand1 ) == CONST ) { const_part = XEXP ( XEXP ( operand1 , 0 ) , 1 ) ; gcc_assert ( GET_CODE ( const_part ) == CONST_INT ) ; temp = force_const_mem ( mode , XEXP ( XEXP ( operand1 , 0 ) , 0 ) ) ; } else { const_part = NULL_RTX ; temp = force_const_mem ( mode , operand1 ) ; } temp = XEXP ( temp , 0 ) ; if ( flag_pic ) { temp = legitimize_pic_address ( temp , mode , scratch_reg ) ; } operands [ 1 ] = temp ; emit_move_sequence ( operands , mode , scratch_reg ) ; operands [ 1 ] = gen_rtx_MEM ( Pmode , operands [ 0 ] ) ; emit_move_sequence ( operands , mode , scratch_reg ) ; if ( const_part != NULL_RTX ) { expand_inc ( operand0 , const_part ) ; } return 1 ; } if ( flag_pic ) { rtx temp ; if ( reload_in_progress || reload_completed ) { temp = scratch_reg ?scratch_reg : operand0 ; temp = force_mode ( word_mode , temp ) ; } else { temp = gen_reg_rtx ( Pmode ) ; } if ( GET_CODE ( operand1 ) == CONST && GET_CODE ( XEXP ( operand1 , 0 ) ) == PLUS && GET_CODE ( XEXP ( XEXP ( operand1 , 0 ) , 1 ) ) == CONST_INT && ! INT_14_BITS ( XEXP ( XEXP ( operand1 , 0 ) , 1 ) ) && ( reload_completed || reload_in_progress ) && flag_pic ) { rtx const_mem = force_const_mem ( mode , operand1 ) ; operands [ 1 ] = legitimize_pic_address ( XEXP ( const_mem , 0 ) , mode , temp ) ; operands [ 1 ] = replace_equiv_address ( const_mem , operands [ 1 ] ) ; emit_move_sequence ( operands , mode , temp ) ; } else { operands [ 1 ] = legitimize_pic_address ( operand1 , mode , temp ) ; if ( REG_P ( operand0 ) && REG_P ( operands [ 1 ] ) ) { copy_reg_pointer ( operand0 , operands [ 1 ] ) ; } emit_insn ( gen_rtx_SET ( VOIDmode , operand0 , operands [ 1 ] ) ) ; } } else { rtx temp , set ; if ( reload_in_progress || reload_completed ) { temp = scratch_reg ?scratch_reg : operand0 ; temp = force_mode ( word_mode , temp ) ; } else { temp = gen_reg_rtx ( mode ) ; } if ( GET_CODE ( operand0 ) == REG && REGNO ( operand0 ) >= FIRST_PSEUDO_REGISTER ) { mark_reg_pointer ( operand0 , BITS_PER_UNIT ) ; } if ( REGNO ( temp ) >= FIRST_PSEUDO_REGISTER ) { mark_reg_pointer ( temp , BITS_PER_UNIT ) ; } if ( ishighonly ) { set = gen_rtx_SET ( mode , operand0 , temp ) ; } else { set = gen_rtx_SET ( VOIDmode , operand0 , gen_rtx_LO_SUM ( mode , temp , operand1 ) ) ; } emit_insn ( gen_rtx_SET ( VOIDmode , temp , gen_rtx_HIGH ( mode , operand1 ) ) ) ; emit_insn ( set ) ; } return 1 ; } if ( pa_tls_referenced_p ( operand1 ) ) { rtx tmp = operand1 ; rtx addend = NULL ; if ( GET_CODE ( tmp ) == CONST && GET_CODE ( XEXP ( tmp , 0 ) ) == PLUS ) { addend = XEXP ( XEXP ( tmp , 0 ) , 1 ) ; tmp = XEXP ( XEXP ( tmp , 0 ) , 0 ) ; } gcc_assert ( GET_CODE ( tmp ) == SYMBOL_REF ) ; tmp = legitimize_tls_address ( tmp ) ; if ( addend ) { tmp = gen_rtx_PLUS ( mode , tmp , addend ) ; tmp = force_operand ( tmp , operands [ 0 ] ) ; } operands [ 1 ] = tmp ; } if ( GET_CODE ( operand1 ) != CONST_INT || ! cint_ok_for_move ( INTVAL ( operand1 ) ) ) { rtx insn , temp ; rtx op1 = operand1 ; HOST_WIDE_INT value = 0 ; HOST_WIDE_INT insv = 0 ; int insert = 0 ; if ( GET_CODE ( operand1 ) == CONST_INT ) { value = INTVAL ( operand1 ) ; } if ( TARGET_64BIT && GET_CODE ( operand1 ) == CONST_INT && HOST_BITS_PER_WIDE_INT > 32 && GET_MODE_BITSIZE ( GET_MODE ( operand0 ) ) > 32 ) { HOST_WIDE_INT nval ; nval = ( ( value & ( ( ( HOST_WIDE_INT ) 2 << 31 ) - 1 ) ) ^ ( ( HOST_WIDE_INT ) 1 << 31 ) ) - ( ( HOST_WIDE_INT ) 1 << 31 ) ; if ( value != nval ) { insv = value >= 0 ?value >> 32 : ~ ( ~ value >> 32 ) ; insert = 1 ; value = nval ; operand1 = GEN_INT ( nval ) ; } } if ( reload_in_progress || reload_completed ) { temp = scratch_reg ?scratch_reg : operand0 ; } else { temp = gen_reg_rtx ( mode ) ; } if ( GET_CODE ( operand1 ) == CONST_INT && GET_MODE_BITSIZE ( mode ) <= BITS_PER_WORD && GET_MODE_BITSIZE ( mode ) <= HOST_BITS_PER_WIDE_INT && ! insert ) { HOST_WIDE_INT low = value & 0x3fff ; HOST_WIDE_INT high = value & ~ 0x3fff ; low = value - high ; emit_insn ( gen_rtx_SET ( VOIDmode , temp , GEN_INT ( high ) ) ) ; operands [ 1 ] = gen_rtx_PLUS ( mode , temp , GEN_INT ( low ) ) ; } else { emit_insn ( gen_rtx_SET ( VOIDmode , temp , gen_rtx_HIGH ( mode , operand1 ) ) ) ; operands [ 1 ] = gen_rtx_LO_SUM ( mode , temp , operand1 ) ; } insn = emit_move_insn ( operands [ 0 ] , operands [ 1 ] ) ; if ( insert ) { if ( temp != operand0 && ( insv >= 16384 || insv < - 16384 ) ) { operand1 = GEN_INT ( insv ) ; emit_insn ( gen_rtx_SET ( VOIDmode , temp , gen_rtx_HIGH ( mode , operand1 ) ) ) ; emit_move_insn ( temp , gen_rtx_LO_SUM ( mode , temp , operand1 ) ) ; emit_insn ( gen_insv ( operand0 , GEN_INT ( 32 ) , const0_rtx , temp ) ) ; } else { int len = 5 , pos = 27 ; while ( pos >= 0 ) { HOST_WIDE_INT v5 = ( ( insv & 31 ) ^ 16 ) - 16 ; HOST_WIDE_INT sign = v5 < 0 ; insv = ( insv >= 0 ?insv >> len : ~ ( ~ insv >> len ) ) ; while ( pos > 0 && ( insv & 1 ) == sign ) { insv = ( insv >= 0 ?insv >> 1 : ~ ( ~ insv >> 1 ) ) ; len += 1 ; pos -= 1 ; } emit_insn ( gen_insv ( operand0 , GEN_INT ( len ) , GEN_INT ( pos ) , GEN_INT ( v5 ) ) ) ; len = pos > 0 && pos < 5 ?pos : 5 ; pos -= len ; } } } REG_NOTES ( insn ) = gen_rtx_EXPR_LIST ( REG_EQUAL , op1 , REG_NOTES ( insn ) ) ; return 1 ; } } return 0 ; } 