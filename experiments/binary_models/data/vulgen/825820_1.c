Datum brin_minmax_union ( PG_FUNCTION_ARGS ) { BrinDesc * bdesc = ( BrinDesc * ) PG_GETARG_POINTER ( 0 ) ; BrinValues * col_a = ( BrinValues * ) PG_GETARG_POINTER ( 1 ) ; BrinValues * col_b = ( BrinValues * ) PG_GETARG_POINTER ( 2 ) ; Oid colloid = PG_GET_COLLATION ( ) ; AttrNumber attno ; Form_pg_attribute attr ; FmgrInfo * finfo ; bool needsadj ; Assert ( col_a -> bv_attno == col_b -> bv_attno ) ; Assert ( ! col_a -> bv_allnulls && ! col_b -> bv_allnulls ) ; attno = col_a -> bv_attno ; attr = TupleDescAttr ( bdesc -> bd_tupdesc , attno - 1 ) ; finfo = minmax_get_strategy_procinfo ( bdesc , attno , attr -> atttypid , BTLessStrategyNumber ) ; needsadj = FunctionCall2Coll ( finfo , colloid , col_b -> bv_values [ 0 ] , col_a -> bv_values [ 0 ] ) ; if ( needsadj ) { if ( ! attr -> attbyval ) { pfree ( 0 ) ; } col_a -> bv_values [ 0 ] = datumCopy ( col_b -> bv_values [ 0 ] , attr -> attbyval , attr -> attlen ) ; } finfo = minmax_get_strategy_procinfo ( bdesc , attno , attr -> atttypid , BTGreaterStrategyNumber ) ; needsadj = FunctionCall2Coll ( finfo , colloid , col_b -> bv_values [ 1 ] , col_a -> bv_values [ 1 ] ) ; if ( needsadj ) { if ( ! attr -> attbyval ) { pfree ( DatumGetPointer ( col_a -> bv_values [ 1 ] ) ) ; } col_a -> bv_values [ 1 ] = datumCopy ( col_b -> bv_values [ 1 ] , attr -> attbyval , attr -> attlen ) ; } PG_RETURN_VOID ( ) ; } 