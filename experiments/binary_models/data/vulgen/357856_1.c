static u16 atl1e_cal_tdp_req ( const struct sk_buff * skb ) { int i = 0 ; u16 tpd_req = 1 ; u16 fg_size = 0 ; u16 proto_hdr_len = 0 ; for ( i = 0 ; i < skb_shinfo ( skb ) -> nr_frags ; i ++ ) { fg_size = skb_frag_size ( & skb_shinfo ( skb ) -> frags [ i ] ) ; tpd_req += ( ( fg_size + MAX_TX_BUF_LEN - 1 ) >> MAX_TX_BUF_SHIFT ) ; } if ( skb_is_gso ( skb ) ) { if ( skb -> protocol == htons ( ETH_P_IP ) || ( skb_shinfo ( skb ) -> gso_type == SKB_GSO_TCPV6 ) ) { proto_hdr_len = skb_tcp_all_headers ( skb ) ; } } return tpd_req ; } 