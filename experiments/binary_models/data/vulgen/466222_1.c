void remove_client_from_list ( struct Client * cptr ) { assert ( cli_verify ( cptr ) ) ; assert ( con_verify ( cli_connect ( cptr ) ) ) ; assert ( ! cli_prev ( cptr ) || cli_verify ( cli_prev ( cptr ) ) ) ; assert ( ! cli_next ( cptr ) || cli_verify ( cli_next ( cptr ) ) ) ; assert ( ! IsMe ( cptr ) ) ; if ( cli_next ( cptr ) ) { if ( cli_prev ( cptr ) ) { cli_next ( cli_prev ( cptr ) ) = cli_next ( cptr ) ; } else { GlobalClientList = cli_next ( cptr ) ; cli_prev ( GlobalClientList ) = 0 ; } cli_prev ( cli_next ( cptr ) ) = cli_prev ( cptr ) ; } cli_next ( cptr ) = cli_prev ( cptr ) = 0 ; if ( IsUser ( cptr ) && cli_user ( cptr ) ) { add_history ( cptr , 0 ) ; off_history ( cptr ) ; } if ( cli_user ( cptr ) ) { free_user ( cli_user ( cptr ) ) ; cli_user ( cptr ) = 0 ; } if ( cli_serv ( cptr ) ) { if ( cli_serv ( cptr ) -> user ) { free_user ( cli_serv ( cptr ) -> user ) ; cli_serv ( cptr ) -> user = 0 ; } MyFree ( cli_serv ( cptr ) -> last_error_msg ) ; MyFree ( cli_serv ( cptr ) ) ; -- servs . inuse ; -- servs . alloc ; } free_client ( cptr ) ; } 