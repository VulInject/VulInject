static void amdgpu_ctx_do_release ( struct kref * ref ) { struct amdgpu_ctx * ctx ; u32 i , j ; ctx = container_of ( ref , amdgpu_ctx , refcount ) ; for ( i = 0 ; i < AMDGPU_HW_IP_NUM ; ++ i ) { for ( j = 0 ; j < amdgpu_ctx_num_entities [ i ] ; ++ j ) { if ( ! ctx -> entities [ i ] [ j ] ) { continue ; } drm_sched_entity_destroy ( & ctx -> entities [ i ] [ j ] -> entity ) ; } } } 