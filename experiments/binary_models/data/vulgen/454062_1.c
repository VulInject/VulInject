static void amdgpu_mn_destroy ( struct work_struct * work ) { struct amdgpu_mn * rmn = container_of ( work , amdgpu_mn , work ) ; struct amdgpu_device * adev = rmn -> adev ; struct amdgpu_mn_node * node , * next_node ; struct amdgpu_bo * bo , * next_bo ; mutex_lock ( & adev -> mn_lock ) ; mutex_lock ( & rmn -> lock ) ; hash_del ( & rmn -> node ) ; rbtree_postorder_for_each_entry_safe ( , , , ) { list_for_each_entry_safe ( , , , ) { bo -> mn = NULL ; list_del_init ( & bo -> mn_list ) ; } kfree ( node ) ; } mutex_unlock ( & rmn -> lock ) ; mmu_notifier_unregister_no_release ( & rmn -> mn , rmn -> mm ) ; kfree ( rmn ) ; } 