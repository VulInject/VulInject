static bool hvs_close_lock_held ( struct vsock_sock * vsk ) { struct sock * sk = sk_vsock ( vsk ) ; if ( ( sk -> sk_shutdown & SHUTDOWN_MASK ) != SHUTDOWN_MASK ) { hvs_shutdown_lock_held ( vsk -> trans , SHUTDOWN_MASK ) ; } if ( sock_flag ( sk , SOCK_DONE ) ) { return true ; } sock_hold ( sk ) ; INIT_DELAYED_WORK ( & vsk -> close_work , hvs_close_timeout ) ; vsk -> close_work_scheduled = true ; schedule_delayed_work ( & vsk -> close_work , HVS_CLOSE_TIMEOUT ) ; return false ; } 