int check_cc_seq_fetch_NCs_next ( void ) { cc_result err = 0 ; apiCB * context = NULL ; ccache_p * ccache = NULL ; ccache_cit * iterator = NULL ; unsigned int i ; BEGIN_TEST ( "cc_seq_fetch_NCs_next" ) ; err = cc_initialize ( & context , ccapi_version_2 , NULL , NULL ) ; if ( ! err ) { err = destroy_all_ccaches_v2 ( context ) ; } if ( ! err ) { err = cc_seq_fetch_NCs_begin ( context , & iterator ) ; } check_once_cc_seq_fetch_NCs_next ( context , iterator , 0 , CC_NOERROR , "iterating over an empty collection" ) ; if ( iterator ) { cc_seq_fetch_creds_end ( context , & iterator ) ; iterator = NULL ; } if ( ! err ) { err = cc_create ( context , "TEST_CC_SEQ_FETCH_NCS_NEXT" , "foo@BAR.ORG" , CC_CRED_V5 , 0 , & ccache ) ; } if ( ccache ) { cc_close ( context , & ccache ) ; ccache = NULL ; } if ( ! err ) { err = cc_seq_fetch_NCs_begin ( context , & iterator ) ; } check_once_cc_seq_fetch_NCs_next ( context , iterator , 1 , CC_NOERROR , "iterating over a collection of 1 ccache" ) ; if ( iterator ) { cc_seq_fetch_creds_end ( context , & iterator ) ; iterator = NULL ; } if ( ! err ) { destroy_all_ccaches_v2 ( context ) ; } for ( i = 0 ; ! err && ( i < 1000 ) ; i ++ ) { char * name = NULL ; if ( i % 100 == 0 ) { fprintf ( stdout , "." ) ; } asprintf ( & name , "TEST_CC_SEQ_FETCH_NCS_NEXT_%d" , i ) ; err = cc_create ( context , name , "foo@BAR.ORG" , CC_CRED_V5 , 0 , & ccache ) ; if ( ccache ) { cc_close ( context , & ccache ) ; ccache = NULL ; } free ( name ) ; } if ( ! err ) { err = cc_seq_fetch_NCs_begin ( context , & iterator ) ; } check_once_cc_seq_fetch_NCs_next ( context , iterator , 1000 , CC_NOERROR , "iterating over a collection of 1000 ccache" ) ; if ( iterator ) { cc_seq_fetch_creds_end ( context , & iterator ) ; iterator = NULL ; } if ( ccache ) { cc_close ( context , & ccache ) ; } if ( iterator ) { cc_seq_fetch_creds_end ( context , & iterator ) ; } if ( context ) { destroy_all_ccaches_v2 ( context ) ; cc_shutdown ( & context ) ; } END_TEST_AND_RETURN ; } 