static void smc911x_hardware_send_pkt ( struct net_device * dev ) { struct smc911x_local * lp = netdev_priv ( dev ) ; struct sk_buff * skb ; unsigned int cmdA , cmdB , len ; unsigned char * buf ; DBG ( SMC_DEBUG_FUNC | SMC_DEBUG_TX , dev , "-->%s\n" , __func__ ) ; BUG_ON ( lp -> pending_tx_skb == NULL ) ; skb = lp -> pending_tx_skb ; buf = ( char * ) ( ( u32 ) ( skb -> data ) & ~ 0xF ) ; len = ( skb -> len + 0xF + ( ( u32 ) skb -> data & 0xF ) ) & ~ 0xF ; cmdA = ( 1 << 24 ) | ( ( ( u32 ) skb -> data & 0xF ) << 16 ) | TX_CMD_A_INT_FIRST_SEG_ | TX_CMD_A_INT_LAST_SEG_ | skb -> len ; buf = ( char * ) ( ( u32 ) skb -> data & ~ 0x3 ) ; len = ( skb -> len + 3 + ( ( u32 ) skb -> data & 3 ) ) & ~ 0x3 ; cmdA = ( ( ( u32 ) skb -> data & 0x3 ) << 16 ) | TX_CMD_A_INT_FIRST_SEG_ | TX_CMD_A_INT_LAST_SEG_ | skb -> len ; cmdB = ( skb -> len << 16 ) | ( skb -> len & 0x7FF ) ; DBG ( SMC_DEBUG_TX , dev , "TX PKT LENGTH 0x%04x (%d) BUF 0x%p CMDA 0x%08x CMDB 0x%08x\n" , len , len , buf , cmdA , cmdB ) ; SMC_SET_TX_FIFO ( lp , cmdA ) ; SMC_SET_TX_FIFO ( lp , cmdB ) ; DBG ( SMC_DEBUG_PKTS , dev , "Transmitted packet\n" ) ; PRINT_PKT ( buf , len <= 64 ?len : 64 ) ; lp -> current_tx_skb = skb ; SMC_PUSH_DATA ( lp , buf , len ) ; SMC_PUSH_DATA ( lp , buf , len ) ; netif_trans_update ( dev ) ; dev_kfree_skb_irq ( skb ) ; if ( ! lp -> tx_throttle ) { netif_wake_queue ( dev ) ; } SMC_ENABLE_INT ( lp , INT_EN_TDFA_EN_ | INT_EN_TSFL_EN_ ) ; } 