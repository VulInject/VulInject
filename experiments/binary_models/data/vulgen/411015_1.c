void mt7996_mac_update_stats ( struct mt7996_phy * phy ) { struct mt7996_dev * dev = phy -> dev ; struct mib_stats * mib = & phy -> mib ; u8 band_idx = phy -> mt76 -> band_idx ; u32 cnt ; int i ; cnt = mt76_rr ( dev , MT_MIB_RSCR1 ( band_idx ) ) ; mib -> fcs_err_cnt += cnt ; cnt = mt76_rr ( dev , MT_MIB_RSCR33 ( band_idx ) ) ; mib -> rx_fifo_full_cnt += cnt ; cnt = mt76_rr ( dev , MT_MIB_RSCR31 ( band_idx ) ) ; mib -> rx_mpdu_cnt += cnt ; cnt = mt76_rr ( dev , MT_MIB_SDR6 ( band_idx ) ) ; cnt = mt76_rr ( dev , MT_MIB_RVSR0 ( band_idx ) ) ; mib -> rx_vector_mismatch_cnt += cnt ; cnt = mt76_rr ( dev , MT_MIB_RSCR35 ( band_idx ) ) ; mib -> rx_delimiter_fail_cnt += cnt ; cnt = mt76_rr ( dev , MT_MIB_RSCR36 ( band_idx ) ) ; mib -> rx_len_mismatch_cnt += cnt ; cnt = mt76_rr ( dev , MT_MIB_TSCR0 ( band_idx ) ) ; mib -> tx_ampdu_cnt += cnt ; cnt = mt76_rr ( dev , MT_MIB_TSCR2 ( band_idx ) ) ; mib -> tx_stop_q_empty_cnt += cnt ; cnt = mt76_rr ( dev , MT_MIB_TSCR3 ( band_idx ) ) ; mib -> tx_mpdu_attempts_cnt += cnt ; cnt = mt76_rr ( dev , MT_MIB_TSCR4 ( band_idx ) ) ; mib -> tx_mpdu_success_cnt += cnt ; cnt = mt76_rr ( dev , MT_MIB_RSCR27 ( band_idx ) ) ; mib -> rx_ampdu_cnt += cnt ; cnt = mt76_rr ( dev , MT_MIB_RSCR28 ( band_idx ) ) ; mib -> rx_ampdu_bytes_cnt += cnt ; cnt = mt76_rr ( dev , MT_MIB_RSCR29 ( band_idx ) ) ; mib -> rx_ampdu_valid_subframe_cnt += cnt ; cnt = mt76_rr ( dev , MT_MIB_RSCR30 ( band_idx ) ) ; mib -> rx_ampdu_valid_subframe_bytes_cnt += cnt ; cnt = mt76_rr ( dev , MT_MIB_SDR27 ( band_idx ) ) ; mib -> tx_rwp_fail_cnt += FIELD_GET ( MT_MIB_SDR27_TX_RWP_FAIL_CNT , cnt ) ; cnt = mt76_rr ( dev , MT_MIB_SDR28 ( band_idx ) ) ; mib -> tx_rwp_need_cnt += FIELD_GET ( MT_MIB_SDR28_TX_RWP_NEED_CNT , cnt ) ; cnt = mt76_rr ( dev , MT_UMIB_RPDCR ( band_idx ) ) ; mib -> rx_pfdrop_cnt += cnt ; cnt = mt76_rr ( dev , MT_MIB_RVSR1 ( band_idx ) ) ; mib -> rx_vec_queue_overflow_drop_cnt += cnt ; cnt = mt76_rr ( dev , MT_MIB_TSCR1 ( band_idx ) ) ; mib -> rx_ba_cnt += cnt ; cnt = mt76_rr ( dev , MT_MIB_BSCR0 ( band_idx ) ) ; mib -> tx_bf_ebf_ppdu_cnt += cnt ; cnt = mt76_rr ( dev , MT_MIB_BSCR1 ( band_idx ) ) ; mib -> tx_bf_ibf_ppdu_cnt += cnt ; cnt = mt76_rr ( dev , MT_MIB_BSCR2 ( band_idx ) ) ; mib -> tx_mu_bf_cnt += cnt ; cnt = mt76_rr ( dev , MT_MIB_TSCR5 ( band_idx ) ) ; mib -> tx_mu_mpdu_cnt += cnt ; cnt = mt76_rr ( dev , MT_MIB_TSCR6 ( band_idx ) ) ; mib -> tx_mu_acked_mpdu_cnt += cnt ; cnt = mt76_rr ( dev , MT_MIB_TSCR7 ( band_idx ) ) ; mib -> tx_su_acked_mpdu_cnt += cnt ; cnt = mt76_rr ( dev , MT_MIB_BSCR3 ( band_idx ) ) ; mib -> tx_bf_rx_fb_ht_cnt += cnt ; mib -> tx_bf_rx_fb_all_cnt += cnt ; cnt = mt76_rr ( dev , MT_MIB_BSCR4 ( band_idx ) ) ; mib -> tx_bf_rx_fb_vht_cnt += cnt ; mib -> tx_bf_rx_fb_all_cnt += cnt ; cnt = mt76_rr ( dev , MT_MIB_BSCR5 ( band_idx ) ) ; mib -> tx_bf_rx_fb_he_cnt += cnt ; mib -> tx_bf_rx_fb_all_cnt += cnt ; cnt = mt76_rr ( dev , MT_MIB_BSCR6 ( band_idx ) ) ; mib -> tx_bf_rx_fb_eht_cnt += cnt ; mib -> tx_bf_rx_fb_all_cnt += cnt ; cnt = mt76_rr ( dev , MT_ETBF_RX_FB_CONT ( band_idx ) ) ; mib -> tx_bf_rx_fb_bw = FIELD_GET ( MT_ETBF_RX_FB_BW , cnt ) ; mib -> tx_bf_rx_fb_nc_cnt += FIELD_GET ( MT_ETBF_RX_FB_NC , cnt ) ; mib -> tx_bf_rx_fb_nr_cnt += FIELD_GET ( MT_ETBF_RX_FB_NR , cnt ) ; cnt = mt76_rr ( dev , MT_MIB_BSCR7 ( band_idx ) ) ; mib -> tx_bf_fb_trig_cnt += cnt ; cnt = mt76_rr ( dev , MT_MIB_BSCR17 ( band_idx ) ) ; mib -> tx_bf_fb_cpl_cnt += cnt ; for ( i = 0 ; i < ARRAY_SIZE ( mib -> tx_amsdu ) ; i ++ ) { cnt = mt76_rr ( dev , MT_PLE_AMSDU_PACK_MSDU_CNT ( i ) ) ; mib -> tx_amsdu [ i ] += cnt ; mib -> tx_amsdu_cnt += cnt ; } cnt = mt76_rr ( dev , MT_MIB_BTSCR5 ( band_idx ) ) ; mib -> rts_cnt += cnt ; cnt = mt76_rr ( dev , MT_MIB_BTSCR6 ( band_idx ) ) ; mib -> rts_retries_cnt += cnt ; cnt = mt76_rr ( dev , MT_MIB_BTSCR0 ( band_idx ) ) ; mib -> ba_miss_cnt += cnt ; cnt = mt76_rr ( dev , MT_MIB_BFTFCR ( band_idx ) ) ; mib -> ack_fail_cnt += cnt ; for ( i = 0 ; i < 16 ; i ++ ) { cnt = mt76_rr ( dev , MT_TX_AGG_CNT ( band_idx , i ) ) ; phy -> mt76 -> aggr_stats [ i ] += cnt ; } } 