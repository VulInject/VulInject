static void _remove_qos ( slurmdb_qos_rec_t * rec ) { int cnt = 0 ; ListIterator itr ; part_record_t * part_ptr ; slurmctld_lock_t part_write_lock = { NO_LOCK NO_LOCK NO_LOCK WRITE_LOCK NO_LOCK } ; lock_slurmctld ( part_write_lock ) ; if ( part_list ) { itr = list_iterator_create ( part_list ) ; while ( ( part_ptr = list_next ( itr ) ) ) { if ( part_ptr -> qos_ptr != rec ) { continue ; } info ( "Partition %s's QOS %s was just removed, " "you probably didn't mean for this to happen " "unless you are also removing the partition." , part_ptr -> name , rec -> name ) ; part_ptr -> qos_ptr = NULL ; } list_iterator_destroy ( itr ) ; } unlock_slurmctld ( part_write_lock ) ; cnt = job_hold_by_qos_id ( rec -> id ) ; if ( cnt ) { info ( "Removed QOS:%s held %u jobs" , rec -> name , cnt ) ; } else { debug ( "Removed QOS:%s" , rec -> name ) ; } } 