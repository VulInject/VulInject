static void rds_loop_kill_conns ( struct net * net ) { struct rds_loop_connection * lc , * _lc ; LIST_HEAD ( tmp_list ) ; spin_lock_irq ( & loop_conns_lock ) ; list_for_each_entry_safe ( , , , ) { struct net * c_net = read_pnet ( & lc -> conn -> c_net ) ; list_move_tail ( & lc -> loop_node , & tmp_list ) ; } spin_unlock_irq ( & loop_conns_lock ) ; list_for_each_entry_safe ( , , , ) { WARN_ON ( lc -> conn -> c_passive ) ; rds_conn_destroy ( lc -> conn ) ; } } 