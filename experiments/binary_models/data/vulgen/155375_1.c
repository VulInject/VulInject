int conf_write_autoconf ( void ) { struct symbol * sym ; const char * name ; FILE * out , * tristate , * out_h ; int i ; sym_clear_all_valid ( ) ; if ( conf_split_config ( ) ) { return 1 ; } out = fopen ( ".tmpconfig" , "w" ) ; if ( ! out ) { return 1 ; } tristate = fopen ( ".tmpconfig_tristate" , "w" ) ; if ( ! tristate ) { fclose ( out ) ; return 1 ; } out_h = fopen ( ".tmpconfig.h" , "w" ) ; if ( ! out_h ) { fclose ( out ) ; fclose ( tristate ) ; return 1 ; } conf_write_heading ( out , & kconfig_printer_cb , NULL ) ; conf_write_heading ( tristate , & tristate_printer_cb , NULL ) ; conf_write_heading ( out_h , & header_printer_cb , NULL ) ; for_all_symbols ( , ) { sym_calc_value ( sym ) ; if ( ! ( sym -> flags & SYMBOL_WRITE ) || ! sym -> name ) { continue ; } conf_write_symbol ( out , sym , & kconfig_printer_cb , ( void * ) 1 ) ; conf_write_symbol ( tristate , sym , & tristate_printer_cb , ( void * ) 1 ) ; conf_write_symbol ( out_h , sym , & header_printer_cb , NULL ) ; } fclose ( out ) ; fclose ( tristate ) ; fclose ( out_h ) ; name = getenv ( "KCONFIG_AUTOHEADER" ) ; if ( ! name ) { name = "include/generated/autoconf.h" ; } if ( rename ( ".tmpconfig.h" , name ) ) { return 1 ; } name = getenv ( "KCONFIG_TRISTATE" ) ; if ( ! name ) { name = "include/config/tristate.conf" ; } if ( rename ( ".tmpconfig_tristate" , name ) ) { return 1 ; } name = conf_get_autoconfig_name ( ) ; if ( rename ( ".tmpconfig" , name ) ) { return 1 ; } return 0 ; } 