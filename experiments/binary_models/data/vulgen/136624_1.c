static callb_id_t callb_add_common ( boolean_t * func ( void * arg , int code ) , void * arg , int class ) char * name , kthread_id_t t { callb_t * cp ; ASSERT ( class < NCBCLASS ) ; mutex_enter ( & ct -> ct_lock ) ; while ( ct -> ct_busy ) { cv_wait ( & ct -> ct_busy_cv , & ct -> ct_lock ) ; } if ( ( cp = ct -> ct_freelist ) == NULL ) { ct -> ct_ncallb ++ ; cp = ( callb_t * ) kmem_zalloc ( sizeof ( callb_t ) , KM_SLEEP ) ; } ct -> ct_freelist = cp -> c_next ; cp -> c_thread = t ; cp -> c_func = func ; cp -> c_arg = arg ; cp -> c_class = ( uchar_t ) class ; if ( strlen ( name ) > CB_MAXNAME ) { cmn_err ( CE_WARN , "callb_add: name of callback function '%s' " "too long -- truncated to %d chars" , name , CB_MAXNAME ) ; } ( void ) strncpy ( cp -> c_name , name , CB_MAXNAME ) ; cp -> c_name [ CB_MAXNAME ] = '\0' ; cp -> c_next = ct -> ct_first_cb [ class ] ; ct -> ct_first_cb [ class ] = cp ; mutex_exit ( & ct -> ct_lock ) ; return ( ( callb_id_t ) cp ) ; } ; 