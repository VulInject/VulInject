static void qeth_bridge_state_change_worker ( struct work_struct * work ) { struct qeth_bridge_state_data * data = container_of ( work , qeth_bridge_state_data , worker ) ; struct qeth_sbp_port_entry * entry = & data -> qports . entry [ 0 ] ; char env_locrem [ 32 ] ; char env_role [ 32 ] ; char env_state [ 32 ] ; char * env [ ] { env_locrem env_role env_state NULL } ; ; mutex_lock ( & data -> card -> conf_mutex ) ; data -> card -> options . sbp . role = entry -> role ; mutex_unlock ( & data -> card -> conf_mutex ) ; snprintf ( env_locrem , sizeof ( env_locrem ) , "BRIDGEPORT=statechange" ) ; snprintf ( env_role , sizeof ( env_role ) , "ROLE=%s" , ( entry -> role == QETH_SBP_ROLE_NONE ) ?"none" : ( entry -> role == QETH_SBP_ROLE_PRIMARY ) ?"primary" : ( entry -> role == QETH_SBP_ROLE_SECONDARY ) ?"secondary" : "<INVALID>" ) ; snprintf ( env_state , sizeof ( env_state ) , "STATE=%s" , ( entry -> state == QETH_SBP_STATE_INACTIVE ) ?"inactive" : ( entry -> state == QETH_SBP_STATE_STANDBY ) ?"standby" : ( entry -> state == QETH_SBP_STATE_ACTIVE ) ?"active" : "<INVALID>" ) ; kobject_uevent_env ( & data -> card -> gdev -> dev . kobj , KOBJ_CHANGE , env ) ; } 