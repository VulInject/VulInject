static int drm_gem_shmem_get_pages_locked ( struct drm_gem_shmem_object * shmem ) { struct drm_gem_object * obj = & shmem -> base ; struct page * * pages ; if ( shmem -> pages_use_count ++ > 0 ) { return 0 ; } pages = drm_gem_get_pages ( obj ) ; if ( IS_ERR ( pages ) ) { DRM_DEBUG_KMS ( "Failed to get pages (%ld)\n" , PTR_ERR ( pages ) ) ; shmem -> pages_use_count = 0 ; return PTR_ERR ( pages ) ; } shmem -> pages = pages ; return 0 ; } 