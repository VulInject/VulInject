get_cmdline ( , , , , ) { int old_cursor ; int ret ; old_cursor = setcursor ( 1 ) ; if ( current_term -> flags & ( TERM_NO_ECHO | TERM_NO_EDIT ) ) { char * p = cmdline ; int c ; grub_printf ( "%s" , prompt ) ; while ( ( c = ASCII_CHAR ( getkey ( ) ) ) != '\n' && c != '\r' ) { if ( c == 27 ) { setcursor ( old_cursor ) ; return 1 ; } if ( c >= ' ' && c <= '~' ) { if ( ! ( current_term -> flags & TERM_NO_ECHO ) ) { grub_putchar ( c ) ; } if ( c != ' ' || p != cmdline ) { * p ++ = c ; } } } * p = 0 ; if ( ! ( current_term -> flags & TERM_NO_ECHO ) ) { grub_putchar ( '\n' ) ; } setcursor ( old_cursor ) ; return 0 ; } ret = real_get_cmdline ( prompt , cmdline , maxlen , echo_char , readline ) ; setcursor ( old_cursor ) ; return ret ; } 