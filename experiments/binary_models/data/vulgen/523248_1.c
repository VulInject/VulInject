static int monwrite_close ( struct inode * inode , struct file * filp ) { struct mon_private * monpriv = filp -> private_data ; struct mon_buf * entry , * next ; list_for_each_entry_safe ( , , , ) { if ( entry -> hdr . mon_function != MONWRITE_GEN_EVENT ) { monwrite_diag ( & entry -> hdr , entry -> data , APPLDATA_STOP_REC ) ; } mon_buf_count -- ; list_del ( & entry -> list ) ; kfree ( entry -> data ) ; kfree ( entry ) ; } return 0 ; } 