long probe_kernel_read ( void * dst , const void * src , size_t size ) { unsigned long lsrc = ( unsigned long ) src ; int mem_type ; mem_type = validate_memory_access_address ( lsrc , size ) ; if ( mem_type < 0 ) { return mem_type ; } if ( lsrc >= SYSMMR_BASE ) { if ( size == 2 && lsrc % 2 == 0 ) { u16 mmr = bfin_read16 ( src ) ; return 0 ; } if ( size == 4 && lsrc % 4 == 0 ) { u32 mmr = bfin_read32 ( src ) ; memcpy ( dst , & mmr , sizeof ( mmr ) ) ; return 0 ; } } else { switch ( mem_type ) { case BFIN_MEM_ACCESS_CORE : case BFIN_MEM_ACCESS_CORE_ONLY : return __probe_kernel_read ( dst , src , size ) ; case BFIN_MEM_ACCESS_DMA : if ( dma_memcpy ( dst , src , size ) ) { return 0 ; } break ; case BFIN_MEM_ACCESS_ITEST : if ( isram_memcpy ( dst , src , size ) ) { return 0 ; } break ; } } return - EFAULT ; } 