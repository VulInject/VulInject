static void roll_up ( CCaptionSubContext * ctx ) { struct Screen * screen ; int i , keep_lines ; screen = get_writing_screen ( ctx ) ; keep_lines = FFMIN ( ctx -> cursor_row + 1 , ctx -> rollup ) ; for ( i = 0 ; i < SCREEN_ROWS ; i ++ ) { if ( i > ctx -> cursor_row - keep_lines && i <= ctx -> cursor_row ) { continue ; } UNSET_FLAG ( screen -> row_used , i ) ; } for ( i = 0 ; i < keep_lines && screen -> row_used ; i ++ ) { const int i_row = ctx -> cursor_row - keep_lines + i + 1 ; memcpy ( screen -> characters [ i_row ] , screen -> characters [ i_row + 1 ] , SCREEN_COLUMNS ) ; memcpy ( screen -> colors [ i_row ] , screen -> colors [ i_row + 1 ] , SCREEN_COLUMNS ) ; memcpy ( screen -> bgs [ i_row ] , screen -> bgs [ i_row + 1 ] , SCREEN_COLUMNS ) ; memcpy ( screen -> fonts [ i_row ] , screen -> fonts [ i_row + 1 ] , SCREEN_COLUMNS ) ; memcpy ( screen -> charsets [ i_row ] , screen -> charsets [ i_row + 1 ] , SCREEN_COLUMNS ) ; if ( CHECK_FLAG ( screen -> row_used , i_row + 1 ) ) { SET_FLAG ( screen -> row_used , i_row ) ; } } UNSET_FLAG ( screen -> row_used , ctx -> cursor_row ) ; } 