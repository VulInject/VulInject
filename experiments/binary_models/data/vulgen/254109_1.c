export_unix_print_dialog_response_cb ( , , ) { EvPrintOperationExportUnix * export_unix = EV_PRINT_OPERATION_EXPORT_UNIX ( export ) ; EvPrintOperation * op = EV_PRINT_OPERATION ( export ) ; GtkPrintSettings * print_settings ; GtkPageSetup * page_setup ; GtkPrinter * printer ; EvFileExporterFormat format ; op -> print_preview = ( response == GTK_RESPONSE_APPLY ) ; printer = gtk_print_unix_dialog_get_selected_printer ( GTK_PRINT_UNIX_DIALOG ( dialog ) ) ; ev_print_operation_export_unix_set_printer ( export_unix , printer ) ; print_settings = gtk_print_unix_dialog_get_settings ( GTK_PRINT_UNIX_DIALOG ( dialog ) ) ; ev_print_operation_export_set_print_settings ( op , print_settings ) ; page_setup = gtk_print_unix_dialog_get_page_setup ( GTK_PRINT_UNIX_DIALOG ( dialog ) ) ; ev_print_operation_export_set_default_page_setup ( op , page_setup ) ; format = get_file_exporter_format ( EV_FILE_EXPORTER ( op -> document ) , print_settings ) ; if ( ( format == EV_FILE_FORMAT_PS && ! gtk_printer_accepts_ps ( export_unix -> printer ) ) || ( format == EV_FILE_FORMAT_PDF && ! gtk_printer_accepts_pdf ( export_unix -> printer ) ) ) { gtk_widget_destroy ( GTK_WIDGET ( dialog ) ) ; g_set_error_literal ( & export -> error , GTK_PRINT_ERROR , GTK_PRINT_ERROR_GENERAL , _ ( "Requested format is not supported by this printer." ) ) ; g_signal_emit ( op , signals [ DONE ] , 0 , GTK_PRINT_OPERATION_RESULT_ERROR ) ; return ; } if ( ! ev_print_operation_export_mkstemp ( export , format ) ) { gtk_widget_destroy ( GTK_WIDGET ( dialog ) ) ; g_signal_emit ( op , signals [ DONE ] , 0 , GTK_PRINT_OPERATION_RESULT_ERROR ) ; return ; } export -> current_page = gtk_print_unix_dialog_get_current_page ( GTK_PRINT_UNIX_DIALOG ( dialog ) ) ; if ( ! ev_print_operation_export_update_ranges ( export ) ) { GtkWidget * message_dialog ; message_dialog = gtk_message_dialog_new ( GTK_WINDOW ( dialog ) , GTK_DIALOG_MODAL , GTK_MESSAGE_WARNING , GTK_BUTTONS_CLOSE , "%s" , _ ( "Invalid page selection" ) ) ; gtk_window_set_title ( GTK_WINDOW ( message_dialog ) , _ ( "Warning" ) ) ; gtk_message_dialog_format_secondary_text ( GTK_MESSAGE_DIALOG ( message_dialog ) , "%s" , _ ( "Your print range selection does not include any pages" ) ) ; g_signal_connect ( message_dialog , "response" , G_CALLBACK ( gtk_widget_destroy ) , NULL ) ; gtk_widget_show ( message_dialog ) ; return ; } gtk_widget_destroy ( GTK_WIDGET ( dialog ) ) ; ev_print_operation_export_prepare ( export , format ) ; } 