int turbo_get_state ( void ) { struct cpuid_result cpuid_regs ; int turbo_en , turbo_cap ; msr_t msr ; int turbo_state = get_global_turbo_state ( ) ; cpuid_regs = cpuid ( CPUID_LEAF_PM ) ; turbo_cap = ! ! ( cpuid_regs . eax & PM_CAP_TURBO_MODE ) ; msr = msr_read ( MSR_IA32_MISC_ENABLE ) ; turbo_en = ! ( msr . hi & MISC_DISABLE_TURBO ) ; if ( ! turbo_cap && turbo_en ) { turbo_state = TURBO_UNAVAILABLE ; } if ( ! turbo_cap && ! turbo_en ) { turbo_state = TURBO_DISABLED ; } if ( turbo_cap && turbo_en ) { turbo_state = TURBO_ENABLED ; } set_global_turbo_state ( turbo_state ) ; debug ( "Turbo is %s\n" , turbo_state_desc [ turbo_state ] ) ; return turbo_state ; } 