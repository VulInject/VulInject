gboolean sysevent_init ( void ) { GError * err = NULL ; const char * subcl [ 6 ] ; if ( pipe ( sysevent_pipe_fds ) != 0 ) { HAL_INFO ( ( "pipe() failed errno=%d" , errno ) ) ; return ( FALSE ) ; } sysevent_iochannel = g_io_channel_unix_new ( sysevent_pipe_fds [ 0 ] ) ; if ( sysevent_iochannel == NULL ) { HAL_INFO ( ( "g_io_channel_unix_new failed" ) ) ; return ( FALSE ) ; } g_io_channel_set_flags ( sysevent_iochannel , G_IO_FLAG_NONBLOCK , & err ) ; sysevent_source_id = g_io_add_watch ( sysevent_iochannel , G_IO_IN , sysevent_iochannel_data , NULL ) ; shp = sysevent_bind_handle ( sysevent_dev_handler ) ; subcl [ 0 ] = ESC_DISK ; subcl [ 1 ] = ESC_LOFI ; subcl [ 2 ] = ESC_PRINTER ; if ( sysevent_subscribe_event ( shp , EC_DEV_ADD , subcl , 3 ) != 0 ) { HAL_INFO ( ( "subscribe(dev_add) failed %d" , errno ) ) ; sysevent_unbind_handle ( shp ) ; return ( FALSE ) ; } if ( sysevent_subscribe_event ( shp , EC_DEV_REMOVE , subcl , 3 ) != 0 ) { HAL_INFO ( ( "subscribe(dev_remove) failed %d" , errno ) ) ; sysevent_unbind_handle ( shp ) ; return ( FALSE ) ; } subcl [ 0 ] = ESC_DEV_BRANCH_REMOVE ; if ( sysevent_subscribe_event ( shp , EC_DEV_BRANCH , subcl , 1 ) != 0 ) { HAL_INFO ( ( "subscribe(dev_branch) failed %d" , errno ) ) ; sysevent_unbind_handle ( shp ) ; return ( FALSE ) ; } subcl [ 0 ] = ESC_PWRCTL_ADD ; subcl [ 1 ] = ESC_PWRCTL_REMOVE ; subcl [ 2 ] = ESC_PWRCTL_STATE_CHANGE ; subcl [ 3 ] = ESC_PWRCTL_BRIGHTNESS_UP ; subcl [ 4 ] = ESC_PWRCTL_BRIGHTNESS_DOWN ; subcl [ 5 ] = ESC_PWRCTL_POWER_BUTTON ; if ( sysevent_subscribe_event ( shp , EC_PWRCTL , subcl , 6 ) != 0 ) { HAL_INFO ( ( "subscribe(dev_add) failed %d" , errno ) ) ; sysevent_unbind_handle ( shp ) ; return ( FALSE ) ; } subcl [ 0 ] = ESC_DEVFS_DEVI_ADD ; if ( sysevent_subscribe_event ( shp , EC_DEVFS , subcl , 1 ) != 0 ) { HAL_INFO ( ( "subscribe(EC_DEVFS) failed %d" , errno ) ) ; sysevent_unbind_handle ( shp ) ; return ( FALSE ) ; } subcl [ 0 ] = ESC_DR_AP_STATE_CHANGE ; if ( sysevent_subscribe_event ( shp , EC_DR , subcl , 1 ) != 0 ) { HAL_INFO ( ( "subscribe(dynamic reconfiguration) failed %d" , errno ) ) ; sysevent_unbind_handle ( shp ) ; return ( FALSE ) ; } return ( B_TRUE ) ; } 