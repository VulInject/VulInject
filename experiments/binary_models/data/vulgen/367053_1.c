ApCheckPackageElements ( , , , , , ) static void ApCheckPackageList ( const char * PredefinedName , ACPI_PARSE_OBJECT * ParentOp , const ACPI_PREDEFINED_INFO * Package , UINT32 StartIndex , UINT32 Count ) static void ApPackageTooSmall ( const char * PredefinedName , ACPI_PARSE_OBJECT * Op , UINT32 Count , UINT32 ExpectedCount ) static void ApZeroLengthPackage ( const char * PredefinedName , ACPI_PARSE_OBJECT * Op ) static void ApPackageTooLarge ( const char * PredefinedName , ACPI_PARSE_OBJECT * Op , UINT32 Count , UINT32 ExpectedCount ) static void ApCustomPackage ( ACPI_PARSE_OBJECT * ParentOp , const ACPI_PREDEFINED_INFO * Predefined ) void ApCheckPackage ( ACPI_PARSE_OBJECT * ParentOp , const ACPI_PREDEFINED_INFO * Predefined ) { ACPI_PARSE_OBJECT * Op ; const ACPI_PREDEFINED_INFO * Package ; ACPI_STATUS Status ; UINT32 ExpectedCount ; UINT32 Count ; UINT32 i ; Package = Predefined + 1 ; Op = ParentOp -> Asl . Child ; Count = ( UINT32 ) Op -> Asl . Value . Integer ; if ( ! Count ) { switch ( Package -> RetInfo . Type ) { case ACPI_PTYPE1_FIXED : case ACPI_PTYPE1_OPTION : case ACPI_PTYPE2_PKG_COUNT : case ACPI_PTYPE2_REV_FIXED : ApZeroLengthPackage ( Predefined -> Info . Name , ParentOp ) ; break ; case ACPI_PTYPE1_VAR : case ACPI_PTYPE2 : case ACPI_PTYPE2_COUNT : case ACPI_PTYPE2_FIXED : case ACPI_PTYPE2_MIN : case ACPI_PTYPE2_FIX_VAR : case ACPI_PTYPE2_VAR_VAR : default : break ; } return ; } Op = Op -> Asl . Next ; switch ( Package -> RetInfo . Type ) { case ACPI_PTYPE_CUSTOM : ApCustomPackage ( ParentOp , Predefined ) ; break ; case ACPI_PTYPE1_FIXED : ExpectedCount = Package -> RetInfo . Count1 + Package -> RetInfo . Count2 ; if ( Count < ExpectedCount ) { PackageTooSmall } if ( Count > ExpectedCount ) { ApPackageTooLarge ( Predefined -> Info . Name , ParentOp , Count , ExpectedCount ) ; } ApCheckPackageElements ( Predefined -> Info . Name , Op , Package -> RetInfo . ObjectType1 , Package -> RetInfo . Count1 , Package -> RetInfo . ObjectType2 , Package -> RetInfo . Count2 ) ; break ; case ACPI_PTYPE1_VAR : for ( i = 0 ; i < Count ; i ++ ) { if ( ! Op ) { return ; } ApCheckObjectType ( Predefined -> Info . Name , Op , Package -> RetInfo . ObjectType1 , i ) ; Op = Op -> Asl . Next ; } break ; case ACPI_PTYPE1_OPTION : ExpectedCount = Package -> RetInfo3 . Count ; if ( Count < ExpectedCount ) { PackageTooSmall } for ( i = 0 ; i < Count ; i ++ ) { if ( i < Package -> RetInfo3 . Count ) { ApCheckObjectType ( Predefined -> Info . Name , Op , Package -> RetInfo3 . ObjectType [ i ] , i ) ; } else { ApCheckObjectType ( Predefined -> Info . Name , Op , Package -> RetInfo3 . TailObjectType , i ) ; } Op = Op -> Asl . Next ; } break ; case ACPI_PTYPE2_REV_FIXED : ApCheckObjectType ( Predefined -> Info . Name , Op , ACPI_RTYPE_INTEGER , 0 ) ; Op = Op -> Asl . Next ; Count -- ; ApCheckPackageList ( Predefined -> Info . Name , Op , Package , 1 , Count ) ; break ; case ACPI_PTYPE2_PKG_COUNT : Status = ApCheckObjectType ( Predefined -> Info . Name , Op , ACPI_RTYPE_INTEGER , 0 ) ; if ( ACPI_SUCCESS ( Status ) ) { ExpectedCount = ( UINT32 ) Op -> Asl . Value . Integer ; if ( ExpectedCount >= Count ) { PackageTooSmall } Count = ExpectedCount ; } Op = Op -> Asl . Next ; ApCheckPackageList ( Predefined -> Info . Name , Op , Package , 1 , Count ) ; break ; case ACPI_PTYPE2_UUID_PAIR : if ( Count & 1 ) { sprintf ( AslGbl_MsgBuffer , "%4.4s: Package length, %d, must be even." , Predefined -> Info . Name , Count ) ; AslError ( ASL_ERROR , ASL_MSG_RESERVED_PACKAGE_LENGTH , ParentOp -> Asl . Child , AslGbl_MsgBuffer ) ; } for ( i = 0 ; i < Count ; ++ i ) { if ( i & 1 ) { ApCheckObjectType ( Predefined -> Info . Name , Op , Package -> RetInfo . ObjectType2 , i ) ; } else { ApCheckObjectType ( Predefined -> Info . Name , Op , Package -> RetInfo . ObjectType1 , i ) ; } Op = Op -> Asl . Next ; } break ; case ACPI_PTYPE2_VAR_VAR : ExpectedCount = Package -> RetInfo4 . Count1 + 1 ; for ( i = 0 ; i < Package -> RetInfo4 . Count1 ; ++ i ) { ApCheckObjectType ( Predefined -> Info . Name , Op , Package -> RetInfo4 . ObjectType1 , i ) ; Op = Op -> Asl . Next ; } ApCheckPackageList ( Predefined -> Info . Name , Op , Package , Package -> RetInfo4 . Count1 , Count ) ; break ; case ACPI_PTYPE2 : case ACPI_PTYPE2_FIXED : case ACPI_PTYPE2_MIN : case ACPI_PTYPE2_COUNT : case ACPI_PTYPE2_FIX_VAR : ApCheckPackageList ( Predefined -> Info . Name , Op , Package , 0 , Count ) ; break ; default : return ; } return ; PackageTooSmall ApPackageTooSmall ( Predefined -> Info . Name , ParentOp , Count , ExpectedCount ) ; } 