static int cpTiles ( TIFF * in , TIFF * out ) { tmsize_t bufsize = TIFFTileSize ( in ) ; unsigned char * buf = ( unsigned char * ) _TIFFmalloc ( bufsize ) ; if ( buf ) { ttile_t t , nt = TIFFNumberOfTiles ( in ) ; uint64 * bytecounts ; if ( ! TIFFGetField ( in , TIFFTAG_TILEBYTECOUNTS , & bytecounts ) ) { fprintf ( stderr , "tiffsplit: tile byte counts are missing\n" ) ; return ( 0 ) ; } for ( t = 0 ; t < nt ; t ++ ) { if ( bytecounts [ t ] > ( uint64 ) bufsize ) { buf = ( unsigned char * ) _TIFFrealloc ( buf , ( tmsize_t ) bytecounts [ t ] ) ; if ( ! buf ) { return ( 0 ) ; } bufsize = ( tmsize_t ) bytecounts [ t ] ; } if ( TIFFReadRawTile ( in , t , buf , ( tmsize_t ) bytecounts [ t ] ) < 0 || TIFFWriteRawTile ( out , t , buf , ( tmsize_t ) bytecounts [ t ] ) < 0 ) { _TIFFfree ( buf ) ; return ( 0 ) ; } } _TIFFfree ( buf ) ; return ( 1 ) ; } return ( 0 ) ; } 