TmEcode UnixManagerRegisterCommand ( const char * keyword , TmEcode * Func ( json_t * , json_t * , void * ) , void * data , int flags ) { SCEnter ( ) ; Command * cmd = NULL ; Command * lcmd = NULL ; if ( Func == NULL ) { SCLogError ( "Null function" ) ; SCReturnInt ( TM_ECODE_FAILED ) ; } if ( keyword == NULL ) { SCLogError ( "Null keyword" ) ; SCReturnInt ( TM_ECODE_FAILED ) ; } TAILQ_FOREACH ( , , ) { if ( ! strcmp ( keyword , lcmd -> name ) ) { SCLogError ( "%s already registered" , keyword ) ; SCReturnInt ( TM_ECODE_FAILED ) ; } } if ( unlikely ( cmd == NULL ) ) { SCLogError ( "Can't alloc cmd" ) ; SCReturnInt ( TM_ECODE_FAILED ) ; } cmd -> name = SCStrdup ( keyword ) ; if ( unlikely ( cmd -> name == NULL ) ) { SCLogError ( "Can't alloc cmd name" ) ; SCFree ( cmd ) ; SCReturnInt ( TM_ECODE_FAILED ) ; } cmd -> Func = Func ; cmd -> data = data ; cmd -> flags = flags ; TAILQ_INSERT_TAIL ( & command . commands , cmd , next ) ; SCReturnInt ( TM_ECODE_OK ) ; } 