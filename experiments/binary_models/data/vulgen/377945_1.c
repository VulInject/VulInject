static void i2c_pxa_slave_start ( struct pxa_i2c * i2c , u32 isr ) { int timeout ; if ( i2c_debug > 0 ) { dev_dbg ( & i2c -> adap . dev , "SAD, mode is slave-%cx\n" , ( isr & ISR_RWM ) ?'r' : 't' ) ; } if ( i2c -> slave != NULL ) { i2c -> slave -> event ( i2c -> slave -> data , ( isr & ISR_RWM ) ?I2C_SLAVE_EVENT_START_READ : I2C_SLAVE_EVENT_START_WRITE ) ; } writel ( readl ( _ICR ( i2c ) ) & ~ ( ICR_START | ICR_STOP ) , _ICR ( i2c ) ) ; writel ( readl ( _ICR ( i2c ) ) | ICR_TB , _ICR ( i2c ) ) ; timeout = 0x10000 ; while ( 1 ) { if ( ( readl ( _IBMR ( i2c ) ) & 2 ) == 2 ) { break ; } timeout -- ; } writel ( readl ( _ICR ( i2c ) ) & ~ ICR_SCLE , _ICR ( i2c ) ) ; } 