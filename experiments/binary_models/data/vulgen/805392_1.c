static void __obtain_firmware ( struct hfi1_devdata * dd ) { int err = 0 ; if ( fw_state == FW_FINAL ) { return ; } if ( fw_state == FW_ERR ) { return ; } retry if ( fw_sbus_load ) { err = obtain_one_firmware ( dd , fw_sbus_name , & fw_sbus ) ; if ( err ) { done } } if ( fw_pcie_serdes_load ) { err = obtain_one_firmware ( dd , fw_pcie_serdes_name , & fw_pcie ) ; if ( err ) { done } } if ( fw_fabric_serdes_load ) { err = obtain_one_firmware ( dd , fw_fabric_serdes_name , & fw_fabric ) ; if ( err ) { done } } if ( fw_8051_load ) { err = obtain_one_firmware ( dd , fw_8051_name , & fw_8051 ) ; if ( err ) { done } } done if ( err ) { if ( fw_state == FW_EMPTY && dd -> icode == ICODE_RTL_SILICON ) { fw_state = FW_TRY ; retry } dd_dev_err ( dd , "unable to obtain working firmware\n" ) ; fw_state = FW_ERR ; fw_err = - ENOENT ; } else { if ( fw_state == FW_EMPTY && dd -> icode != ICODE_FUNCTIONAL_SIMULATOR ) { fw_state = FW_TRY ; } else { fw_state = FW_FINAL ; } } } 