static void dissect_ospf_lsa_app_link_attributes ( tvbuff_t * tvb , packet_info * pinfo _U_ , int offset , proto_tree * tree , guint32 length ) { proto_tree * stlv_tree = NULL ; proto_item * ti_tree = NULL , * ti = NULL ; int offset_end = offset + length ; int stlv_offset = offset ; guint16 stlv_type , stlv_length ; const gchar * stlv_name ; guint32 delay , delay_min , delay_max , reserved ; guint32 admin_group , te_metric ; while ( stlv_offset < offset_end ) { stlv_type = tvb_get_ntohs ( tvb , stlv_offset ) ; stlv_length = tvb_get_ntohs ( tvb , stlv_offset + 2 ) ; stlv_tree = proto_tree_add_subtree_format ( tree , tvb , stlv_offset , stlv_length + 4 , ett_ospf_lsa_app_link_attrs_stlv , & ti_tree , "%s Sub-TLV" , stlv_name ) ; proto_tree_add_item ( stlv_tree , hf_ospf_ls_app_link_attrs_stlv , tvb , stlv_offset , 2 , ENC_BIG_ENDIAN ) ; proto_tree_add_item ( stlv_tree , hf_ospf_tlv_length , tvb , stlv_offset + 2 , 2 , ENC_BIG_ENDIAN ) ; stlv_offset += 4 ; switch ( stlv_type ) { case SR_STLV_UNIDIR_LINK_DELAY : ti = proto_tree_add_bitmask ( stlv_tree , tvb , stlv_offset , hf_ospf_ls_unidir_link_flags , ett_ospf_lsa_unidir_link_flags , unidir_link_flags , ENC_NA ) ; reserved = tvb_get_guint8 ( tvb , stlv_offset ) & 0x7f ; if ( reserved != 0 ) { expert_add_info_format ( pinfo , ti , & ei_ospf_header_reserved , "Reserved field should be 0" ) ; } delay = tvb_get_guint24 ( tvb , stlv_offset + 1 , ENC_BIG_ENDIAN ) ; proto_tree_add_item ( stlv_tree , hf_ospf_ls_unidir_link_delay , tvb , stlv_offset + 1 , 3 , ENC_BIG_ENDIAN ) ; if ( ti_tree ) { proto_item_append_text ( ti_tree , "  (Delay: %u usec)" , delay ) ; } break ; case SR_STLV_UNIDIR_LINK_DELAY_MIN_MAX : ti = proto_tree_add_bitmask ( stlv_tree , tvb , stlv_offset , hf_ospf_ls_unidir_link_flags , ett_ospf_lsa_unidir_link_flags , unidir_link_flags , ENC_NA ) ; reserved = tvb_get_guint8 ( tvb , stlv_offset ) & 0x7f ; if ( reserved != 0 ) { expert_add_info_format ( pinfo , ti , & ei_ospf_header_reserved , "Reserved field should be 0" ) ; } delay_min = tvb_get_guint24 ( tvb , stlv_offset + 1 , ENC_BIG_ENDIAN ) ; proto_tree_add_item ( stlv_tree , hf_ospf_ls_unidir_link_delay_min , tvb , stlv_offset + 1 , 3 , ENC_BIG_ENDIAN ) ; ti = proto_tree_add_item ( stlv_tree , hf_ospf_ls_unidir_link_reserved , tvb , stlv_offset + 4 , 1 , ENC_NA ) ; reserved = tvb_get_guint8 ( tvb , stlv_offset + 4 ) ; if ( reserved != 0 ) { expert_add_info ( pinfo , ti , & ei_ospf_header_reserved ) ; } delay_max = tvb_get_guint24 ( tvb , stlv_offset + 5 , ENC_BIG_ENDIAN ) ; proto_tree_add_item ( stlv_tree , hf_ospf_ls_unidir_link_delay_max , tvb , stlv_offset + 5 , 3 , ENC_BIG_ENDIAN ) ; if ( ti_tree ) { proto_item_append_text ( ti_tree , "  (Min/Max Delay: %u/%u usec)" , delay_min , delay_max ) ; } break ; case SR_STLV_UNIDIR_DELAY_VARIATION : ti = proto_tree_add_item ( stlv_tree , hf_ospf_ls_unidir_link_reserved , tvb , stlv_offset , 1 , ENC_NA ) ; reserved = tvb_get_guint8 ( tvb , stlv_offset ) ; if ( reserved != 0 ) { expert_add_info ( pinfo , ti , & ei_ospf_header_reserved ) ; } delay = tvb_get_guint24 ( tvb , stlv_offset + 1 , ENC_BIG_ENDIAN ) ; proto_tree_add_item ( stlv_tree , hf_ospf_ls_unidir_delay_variation , tvb , stlv_offset + 1 , 3 , ENC_BIG_ENDIAN ) ; if ( ti_tree ) { proto_item_append_text ( ti_tree , "  (Variation: %u usec)" , delay ) ; } break ; case SR_STLV_ADMIN_GROUP : admin_group = tvb_get_guint32 ( tvb , stlv_offset , ENC_BIG_ENDIAN ) ; proto_tree_add_item ( stlv_tree , hf_ospf_ls_admin_group , tvb , stlv_offset , 4 , ENC_BIG_ENDIAN ) ; if ( ti_tree ) { proto_item_append_text ( ti_tree , "  (Admin Group: 0x%08x)" , admin_group ) ; } break ; case SR_STLV_EXT_ADMIN_GROUP : dissect_ospf_subtlv_ext_admin_group ( tvb , stlv_tree , stlv_offset , stlv_type , stlv_length ) ; break ; case SR_STLV_TE_METRIC : te_metric = tvb_get_guint32 ( tvb , stlv_offset , ENC_BIG_ENDIAN ) ; proto_tree_add_item ( stlv_tree , hf_ospf_ls_mpls_te_metric , tvb , stlv_offset , 4 , ENC_BIG_ENDIAN ) ; if ( ti_tree ) { proto_item_append_text ( ti_tree , "  (TE Metric: %u)" , te_metric ) ; } break ; default : proto_tree_add_item ( stlv_tree , hf_ospf_tlv_value , tvb , stlv_offset , stlv_length , ENC_NA ) ; break ; } stlv_offset += WS_ROUNDUP_4 ( stlv_length ) ; } } 