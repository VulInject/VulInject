static int i40evf_set_ringparam ( struct net_device * netdev , struct ethtool_ringparam * ring ) { struct i40evf_adapter * adapter = netdev_priv ( netdev ) ; u32 new_rx_count , new_tx_count ; if ( ( ring -> rx_mini_pending ) || ( ring -> rx_jumbo_pending ) ) { return - EINVAL ; } new_tx_count = clamp_t ( u32 , ring -> tx_pending , I40EVF_MIN_TXD , I40EVF_MAX_TXD ) ; new_tx_count = ALIGN ( new_tx_count , I40EVF_REQ_DESCRIPTOR_MULTIPLE ) ; new_rx_count = clamp_t ( u32 , ring -> rx_pending , I40EVF_MIN_RXD , I40EVF_MAX_RXD ) ; new_rx_count = ALIGN ( new_rx_count , I40EVF_REQ_DESCRIPTOR_MULTIPLE ) ; if ( ( new_tx_count == adapter -> tx_desc_count ) && ( new_rx_count == adapter -> rx_desc_count ) ) { return 0 ; } adapter -> tx_desc_count = new_tx_count ; adapter -> rx_desc_count = new_rx_count ; if ( netif_running ( netdev ) ) { schedule_work ( & adapter -> reset_task ) ; } return 0 ; } 