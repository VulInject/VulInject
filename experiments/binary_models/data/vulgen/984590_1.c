static int neighbor_remove ( Neighbor * neighbor ) { _cleanup_ ( ) Link * link ; int r ; assert ( neighbor ) ; assert ( neighbor -> link ) ; assert ( neighbor -> link -> manager ) ; assert ( neighbor -> link -> manager -> rtnl ) ; link = neighbor -> link ; log_neighbor_debug ( neighbor , "Removing" , link ) ; r = sd_rtnl_message_new_neigh ( link -> manager -> rtnl , & req , RTM_DELNEIGH , link -> ifindex , neighbor -> family ) ; if ( r < 0 ) { return log_link_error_errno ( link , r , "Could not allocate RTM_DELNEIGH message: %m" ) ; } r = netlink_message_append_in_addr_union ( req , NDA_DST , neighbor -> family , & neighbor -> in_addr ) ; if ( r < 0 ) { return log_link_error_errno ( link , r , "Could not append NDA_DST attribute: %m" ) ; } r = netlink_call_async ( link -> manager -> rtnl , NULL , req , neighbor_remove_handler , link_netlink_destroy_callback , link ) ; if ( r < 0 ) { return log_link_error_errno ( link , r , "Could not send rtnetlink message: %m" ) ; } link_ref ( link ) ; neighbor_enter_removing ( neighbor ) ; return 0 ; } 