static gboolean nstrace_add_signature ( wtap_dumper * wdh , int * err ) { nstrace_dump_t * nstrace = ( nstrace_dump_t * ) wdh -> priv ; if ( nstrace -> version == NSTRACE_1_0 ) { guint16 val16b ; nspr_signature_v10_t sig10 ; val16b = GUINT16_TO_LE ( NSPR_SIGNATURE_V10 ) ; memcpy ( sig10 . phd . ph_RecordType , & val16b , sizeof sig10 . phd . ph_RecordType ) ; val16b = GUINT16_TO_LE ( nspr_signature_v10_s ) ; memcpy ( sig10 . phd . ph_RecordSize , & val16b , sizeof sig10 . phd . ph_RecordSize ) ; memset ( sig10 . sig_Signature , 0 , NSPR_SIGSIZE_V10 ) ; ( void ) g_strlcpy ( sig10 . sig_Signature , NSPR_SIGSTR_V10 , NSPR_SIGSIZE_V10 ) ; if ( ! wtap_dump_file_write ( wdh , & sig10 , nspr_signature_v10_s , err ) ) { return FALSE ; } nstrace -> page_offset += ( guint16 ) nspr_signature_v10_s ; } if ( nstrace -> version == NSTRACE_2_0 ) { nspr_signature_v20_t sig20 ; sig20 . sig_RecordType = NSPR_SIGNATURE_V20 ; sig20 . sig_RecordSize = nspr_signature_v20_s ; memcpy ( sig20 . sig_Signature , NSPR_SIGSTR_V20 , sizeof ( NSPR_SIGSTR_V20 ) ) ; if ( ! wtap_dump_file_write ( wdh , & sig20 , sig20 . sig_RecordSize , err ) ) { return FALSE ; } nstrace -> page_offset += ( guint16 ) sig20 . sig_RecordSize ; } if ( nstrace -> version == NSTRACE_3_0 ) { nspr_signature_v30_t sig30 ; sig30 . sig_RecordType = NSPR_SIGNATURE_V30 ; sig30 . sig_RecordSize = nspr_signature_v30_s ; memcpy ( sig30 . sig_Signature , NSPR_SIGSTR_V30 , sizeof ( NSPR_SIGSTR_V30 ) ) ; if ( ! wtap_dump_file_write ( wdh , & sig30 , sig30 . sig_RecordSize , err ) ) { return FALSE ; } nstrace -> page_offset += ( guint16 ) sig30 . sig_RecordSize ; } else { ws_assert_not_reached ( ) ; return FALSE ; } return TRUE ; } 