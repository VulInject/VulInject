TEE_Result tee_fs_dirfile_remove ( struct tee_fs_dirfile_dirh * dirh , const struct tee_fs_dirfile_fileh * dfh ) { TEE_Result res ; struct dirfile_entry dent ; uint32_t file_number ; res = read_dent ( dirh , dfh -> idx , & dent ) ; if ( res ) { return res ; } file_number = dent . file_number ; assert ( dfh -> file_number == file_number ) ; assert ( test_file ( dirh , file_number ) ) ; memset ( & dent , 0 , sizeof ( dent ) ) ; res = write_dent ( dirh , dfh -> idx , & dent ) ; if ( ! res ) { clear_file ( dirh , file_number ) ; } return res ; } 