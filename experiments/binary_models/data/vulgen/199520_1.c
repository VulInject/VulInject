static BROTLI_INLINE void BrotliCompressFragmentTwoPassImpl ( MemoryManager * m , const uint8_t * input , size_t input_size , BROTLI_BOOL is_last , uint32_t * command_buf , uint8_t * literal_buf , int * table , size_t table_bits , size_t * storage_ix , uint8_t * storage ) { const uint8_t * base_ip = input ; BROTLI_UNUSED ( is_last ) ; while ( input_size > 0 ) { size_t block_size = BROTLI_MIN ( size_t , input_size , kCompressFragmentTwoPassBlockSize ) ; uint32_t * commands = command_buf ; uint8_t * literals = literal_buf ; size_t num_literals ; CreateCommands ( input , block_size , input_size , base_ip , table , table_bits , & literals , & commands ) ; num_literals = ( size_t ) ( literals - literal_buf ) ; if ( ShouldCompress ( input , block_size , num_literals ) ) { BrotliStoreMetaBlockHeader ( block_size , 0 , storage_ix , storage ) ; BrotliWriteBits ( 13 , 0 , storage_ix , storage ) ; StoreCommands ( m , literal_buf , num_literals , command_buf , num_commands , storage_ix , storage ) ; if ( BROTLI_IS_OOM ( m ) ) { return ; } } else { EmitUncompressedMetaBlock ( input , block_size , storage_ix , storage ) ; } input += block_size ; input_size -= block_size ; } } 