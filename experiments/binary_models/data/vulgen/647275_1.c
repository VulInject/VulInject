int afs_setattr ( struct dentry * dentry , struct iattr * attr ) { struct afs_vnode * vnode = AFS_FS_I ( d_inode ( dentry ) ) ; struct key * key ; int ret ; _enter ( "{%x:%u},{n=%pd},%x" , vnode -> fid . vid , vnode -> fid . vnode , dentry , attr -> ia_valid ) ; if ( ! ( attr -> ia_valid & ( ATTR_SIZE | ATTR_MODE | ATTR_UID | ATTR_GID | ATTR_MTIME ) ) ) { _leave ( " = 0 [unsupported]" ) ; return 0 ; } if ( S_ISREG ( vnode -> vfs_inode . i_mode ) ) { filemap_write_and_wait ( vnode -> vfs_inode . i_mapping ) ; } if ( attr -> ia_valid & ATTR_FILE ) { key = attr -> ia_file -> private_data ; } else { key = afs_request_key ( vnode -> volume -> cell ) ; if ( IS_ERR ( key ) ) { ret = PTR_ERR ( key ) ; error } } ret = afs_vnode_setattr ( vnode , key , attr ) ; if ( ! ( attr -> ia_valid & ATTR_FILE ) ) { key_put ( key ) ; } error _leave ( " = %d" , ret ) ; return ret ; } 