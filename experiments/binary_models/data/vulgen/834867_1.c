static void init_tss ( void ) { extern struct cpu cpus [ ] ; if ( kpti_enable == 1 ) { ktss0 -> tss_rsp0 = ( uint64_t ) & cpus -> cpu_m . mcpu_kpti . kf_tr_rsp ; } ktss0 -> tss_ist1 = ( uintptr_t ) & dblfault_stack0 [ sizeof ( dblfault_stack0 ) ] ; ktss0 -> tss_ist2 = ( uintptr_t ) & nmi_stack0 [ sizeof ( nmi_stack0 ) ] ; ktss0 -> tss_ist3 = ( uintptr_t ) & mce_stack0 [ sizeof ( mce_stack0 ) ] ; ktss0 -> tss_ist4 = ( uint64_t ) & cpus -> cpu_m . mcpu_kpti_dbg . kf_tr_rsp ; if ( kpti_enable == 1 ) { ktss0 -> tss_ist5 = ( uint64_t ) & cpus -> cpu_m . mcpu_kpti_flt . kf_tr_rsp ; ktss0 -> tss_ist6 = ( uint64_t ) & cpus -> cpu_m . mcpu_kpti . kf_tr_rsp ; } wr_tsr ( KTSS_SEL ) ; } 