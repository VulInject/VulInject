CharStar if ( * pp ) { Free ( * pp ) ; } * pp = Strdup ( p ) ; break ; case PR_MODULES : ppp = & ( prp -> modules ) ; CharStarStar case PR_OPTIONS : ppp = & ( prp -> options ) ; CharStarStar break ; case PR_PPD : { pp = & ( prp -> ppd ) ; CharStar } if ( errno != 0 ) { int save_errno = errno ; close ( fd ) ; errno = save_errno ; return ( 0 ) ; } close ( fd ) ; if ( ! ( path = getprinterfile ( prp -> name , COMMENTFILE ) ) ) { return ( 0 ) ; } if ( ! ( prp -> description = loadstring ( path ) ) && errno != ENOENT ) { Free ( path ) ; freeprinter ( prp ) ; return ( 0 ) ; } Free ( path ) ; if ( ! ( pa = getalert ( Lp_A_Printers , prp -> name ) ) ) { if ( errno != ENOENT && ( errno != EACCES || ! getpid ( ) || STREQU ( getname ( ) , LPUSER ) ) ) { freeprinter ( prp ) ; return ( 0 ) ; } } else { prp -> fault_alert = * pa ; } if ( ! okprinter ( prp -> name , prp , 0 ) ) { freeprinter ( prp ) ; errno = EBADF ; return ( 0 ) ; } if ( ! prp -> printer_types ) { prp -> printer_types = getlist ( NAME_UNKNOWN , LP_WS , LP_SEP ) ; } if ( lenlist ( prp -> printer_types ) > 1 && prp -> input_types && ( lenlist ( prp -> input_types ) > 1 || ! STREQU ( NAME_SIMPLE , * prp -> input_types ) ) ) { freeprinter ( prp ) ; badprinter = BAD_ITYPES ; errno = EBADF ; return ( 0 ) ; } if ( lenlist ( prp -> printer_types ) > 1 && searchlist ( NAME_UNKNOWN , prp -> printer_types ) ) { freeprinter ( prp ) ; badprinter = BAD_PTYPES ; errno = EBADF ; return ( 0 ) ; } prp -> daisy = - 1 ; for ( pp = prp -> printer_types ; * pp ; pp ++ ) { tidbit ( * pp , "daisy" , & daisy ) ; if ( daisy == - 1 ) { daisy = 0 ; } if ( prp -> daisy == - 1 ) { prp -> daisy = daisy ; } if ( prp -> daisy != daisy ) { freeprinter ( prp ) ; badprinter = BAD_DAISY ; errno = EBADF ; return ( 0 ) ; } } prp -> printer_type = Strdup ( * prp -> printer_types ) ; return ( prp ) ; 