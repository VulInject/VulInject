struct vidtv_psi_table_pmt * vidtv_psi_pmt_table_init ( u16 program_number , u16 pcr_pid ) { struct vidtv_psi_table_pmt * pmt ; const u16 RESERVED1 = 0x07 ; const u16 RESERVED2 = 0x0f ; const u16 SYNTAX = 0x1 ; const u16 ONES = 0x03 ; const u16 ZERO = 0x0 ; u16 desc_loop_len ; pmt = kzalloc ( sizeof ( * pmt ) , GFP_KERNEL ) ; if ( ! pcr_pid ) { pcr_pid = 0x1fff ; } pmt -> header . table_id = 0x2 ; pmt -> header . bitfield = cpu_to_be16 ( ( SYNTAX << 15 ) | ( ZERO << 14 ) | ( ONES << 12 ) ) ; pmt -> header . id = cpu_to_be16 ( program_number ) ; pmt -> header . current_next = 0x1 ; pmt -> header . version = 0x1f ; pmt -> header . one2 = ONES ; pmt -> header . section_id = 0 ; pmt -> header . last_section = 0 ; pmt -> bitfield = cpu_to_be16 ( ( RESERVED1 << 13 ) | pcr_pid ) ; desc_loop_len = vidtv_psi_desc_comp_loop_len ( pmt -> descriptor ) ; pmt -> bitfield2 = cpu_to_be16 ( ( RESERVED2 << 12 ) | ( ZERO << 10 ) | desc_loop_len ) ; vidtv_psi_pmt_table_update_sec_len ( pmt ) ; return pmt ; } 