void sh3_cache_wbinv_range ( vaddr_t , vsize_t ) void sh3_cache_wbinv_range_index ( vaddr_t , vsize_t ) void sh3_cache_panic ( vaddr_t , vsize_t ) void sh3_cache_nop ( vaddr_t , vsize_t ) int sh_cache_way_size ; int sh_cache_way_shift ; int sh_cache_entry_mask ; static inline void cache_sh3_op_line_16_nway ( int , vaddr_t , uint32_t ) static inline void cache_sh3_op_8lines_16_nway ( int , vaddr_t , uint32_t ) void sh3_cache_config ( void ) { size_t cache_size ; uint32_t r ; switch ( cpu_product ) { default : case CPU_PRODUCT_7708 : case CPU_PRODUCT_7708S : case CPU_PRODUCT_7708R : cache_size = 8 * 1024 ; break ; case CPU_PRODUCT_7709 : cache_size = 8 * 1024 ; break ; case CPU_PRODUCT_7709A : cache_size = 16 * 1024 ; break ; } r = _reg_read_4 ( SH3_CCR ) ; sh_cache_unified = 1 ; sh_cache_enable_unified = ( r & SH3_CCR_CE ) ; sh_cache_line_size = 16 ; sh_cache_write_through_p0_u0_p3 = r & SH3_CCR_WT ; sh_cache_write_through_p1 = ! ( r & SH3_CCR_CB ) ; sh_cache_write_through = sh_cache_write_through_p0_u0_p3 && sh_cache_write_through_p1 ; sh_cache_ram_mode = r & SH3_CCR_RA ; if ( sh_cache_ram_mode ) { sh_cache_ways = 2 ; sh_cache_size_unified = cache_size / 2 ; } else { sh_cache_ways = 4 ; sh_cache_size_unified = cache_size ; } sh_cache_way_size = sh_cache_size_unified / 4 ; sh_cache_entry_mask = ( sh_cache_way_size - 1 ) & ~ 15 ; sh_cache_way_shift = ffs ( sh_cache_size_unified / ( 4 * 16 ) ) - 1 + 4 ; sh_cache_ops . _icache_sync_all = sh3_cache_wbinv_all ; sh_cache_ops . _icache_sync_range = sh3_cache_wbinv_range ; sh_cache_ops . _icache_sync_range_index = sh3_cache_wbinv_range_index ; sh_cache_ops . _dcache_wbinv_all = sh3_cache_wbinv_all ; sh_cache_ops . _dcache_wbinv_range = sh3_cache_wbinv_range ; sh_cache_ops . _dcache_wbinv_range_index = sh3_cache_wbinv_range_index ; sh_cache_ops . _dcache_inv_range = sh3_cache_panic ; else { sh_cache_ops . _dcache_wb_range = sh3_cache_wbinv_range ; } } 