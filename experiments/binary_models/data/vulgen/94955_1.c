load_dialog ( , , , ) { GtkWidget * dialog ; GtkWidget * vbox ; GtkWidget * show_reduced = NULL ; GtkWidget * crop_option = NULL ; GtkWidget * extra_radio = NULL ; gboolean run ; dialog = gimp_dialog_new ( _ ( "Import from TIFF" ) , PLUG_IN_ROLE , NULL , 0 , gimp_standard_help_func , help_id , _ ( "_Cancel" ) , GTK_RESPONSE_CANCEL , _ ( "_Import" ) , GTK_RESPONSE_OK , NULL ) ; gimp_dialog_set_alternative_button_order ( GTK_DIALOG ( dialog ) , GTK_RESPONSE_OK , GTK_RESPONSE_CANCEL , - 1 ) ; gimp_window_set_transient ( GTK_WINDOW ( dialog ) ) ; vbox = gtk_box_new ( GTK_ORIENTATION_VERTICAL , 12 ) ; gtk_container_set_border_width ( GTK_CONTAINER ( vbox ) , 12 ) ; gtk_box_pack_start ( GTK_BOX ( gtk_dialog_get_content_area ( GTK_DIALOG ( dialog ) ) ) , vbox , TRUE , TRUE , 0 ) ; show_reduced = gtk_check_button_new_with_mnemonic ( _ ( "_Show reduced images" ) ) ; gtk_toggle_button_set_active ( GTK_TOGGLE_BUTTON ( show_reduced ) , pages -> show_reduced ) ; gtk_box_pack_start ( GTK_BOX ( vbox ) , show_reduced , TRUE , TRUE , 0 ) ; g_signal_connect ( show_reduced , "toggled" , G_CALLBACK ( tiff_dialog_show_reduced ) , pages ) ; if ( pages -> n_pages > 1 ) { pages -> selector = gimp_page_selector_new ( ) ; gtk_widget_set_size_request ( pages -> selector , 300 , 200 ) ; gtk_box_pack_start ( GTK_BOX ( vbox ) , pages -> selector , TRUE , TRUE , 0 ) ; gimp_page_selector_set_n_pages ( GIMP_PAGE_SELECTOR ( pages -> selector ) , pages -> n_filtered_pages ) ; gimp_page_selector_set_target ( GIMP_PAGE_SELECTOR ( pages -> selector ) , pages -> target ) ; tiff_dialog_show_reduced ( show_reduced , pages ) ; g_signal_connect_swapped ( pages -> selector , "activate" , G_CALLBACK ( gtk_window_activate_default ) , dialog ) ; crop_option = gtk_check_button_new_with_mnemonic ( _ ( "_Keep empty space around imported layers" ) ) ; gtk_toggle_button_set_active ( GTK_TOGGLE_BUTTON ( crop_option ) , pages -> keep_empty_space ) ; gtk_box_pack_start ( GTK_BOX ( vbox ) , crop_option , TRUE , TRUE , 0 ) ; } if ( extra_message ) { GtkWidget * warning ; warning = g_object_new ( GIMP_TYPE_HINT_BOX , "icon-name" , GIMP_ICON_DIALOG_WARNING , "hint" , extra_message , NULL ) ; gtk_box_pack_start ( GTK_BOX ( vbox ) , warning , TRUE , TRUE , 0 ) ; gtk_widget_show ( warning ) ; extra_radio = gimp_int_radio_group_new ( TRUE , _ ( "Process extra channel as:" ) , ( GCallback ) gimp_radio_button_update , default_extra , NULL , GIMP_TIFF_LOAD_UNASSALPHA , _ ( "_Non-premultiplied alpha" ) , GIMP_TIFF_LOAD_UNASSALPHA , NULL , _ ( "Pre_multiplied alpha" ) , GIMP_TIFF_LOAD_ASSOCALPHA , NULL , _ ( "Channe_l" ) , GIMP_TIFF_LOAD_CHANNEL , NULL , NULL ) ; gtk_box_pack_start ( GTK_BOX ( vbox ) , extra_radio , TRUE , TRUE , 0 ) ; gtk_widget_show ( extra_radio ) ; } gtk_widget_show_all ( dialog ) ; run = ( gimp_dialog_run ( GIMP_DIALOG ( dialog ) ) == GTK_RESPONSE_OK ) ; if ( run ) { if ( pages -> n_pages > 1 ) { pages -> target = gimp_page_selector_get_target ( GIMP_PAGE_SELECTOR ( pages -> selector ) ) ; pages -> pages = gimp_page_selector_get_selected_pages ( GIMP_PAGE_SELECTOR ( pages -> selector ) , & pages -> n_pages ) ; pages -> keep_empty_space = gtk_toggle_button_get_active ( GTK_TOGGLE_BUTTON ( crop_option ) ) ; if ( pages -> n_pages == 0 ) { gimp_page_selector_select_all ( GIMP_PAGE_SELECTOR ( pages -> selector ) ) ; pages -> pages = gimp_page_selector_get_selected_pages ( GIMP_PAGE_SELECTOR ( pages -> selector ) , & pages -> n_pages ) ; } } } return run ; } 