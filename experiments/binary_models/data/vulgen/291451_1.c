static bool hns3_nic_reclaim_desc ( struct hns3_enet_ring * ring , int * bytes , int * pkts , int budget ) { int ltu = smp_load_acquire ( & ring -> last_to_use ) ; int ntc = ring -> next_to_clean ; struct hns3_desc_cb * desc_cb ; bool reclaimed = false ; struct hns3_desc * desc ; while ( ltu != ntc ) { desc = & ring -> desc [ ntc ] ; if ( le16_to_cpu ( desc -> tx . bdtp_fe_sc_vld_ra_ri ) & BIT ( HNS3_TXD_VLD_B ) ) { break ; } desc_cb = & ring -> desc_cb [ ntc ] ; if ( desc_cb -> type & ( DESC_TYPE_SKB | DESC_TYPE_BOUNCE_ALL | DESC_TYPE_BOUNCE_HEAD | DESC_TYPE_SGL_SKB ) ) { ( * pkts ) ++ ; ( * bytes ) += desc_cb -> send_bytes ; } hns3_free_buffer_detach ( ring , ntc , budget ) ; prefetch ( & ring -> desc_cb [ ntc ] ) ; reclaimed = true ; } if ( unlikely ( ! reclaimed ) ) { return false ; } smp_store_release ( & ring -> next_to_clean , ntc ) ; hns3_tx_spare_update ( ring ) ; return true ; } 