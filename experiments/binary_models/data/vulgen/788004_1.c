int restore ( const char * infile ) { FILE * in ; struct savestruct * p ; char * s ; long sum , cksum ; int i ; if ( ( in = fopen ( infile , "rb" ) ) == NULL ) { fprintf ( stderr , "Hmm.  The file \"%s\" appears to be magically blocked.\n" , infile ) ; return 1 ; } fread ( & sum , sizeof ( sum ) , 1 , in ) ; srandom_deterministic ( ( unsigned int ) sum ) ; for ( p = save_array ; p -> address != NULL ; p ++ ) { fread ( p -> address , p -> width , 1 , in ) ; for ( s = p -> address , i = 0 ; i < p -> width ; i ++ , s ++ ) { * s = ( * s ^ random ( ) ) & 0xFF ; } } fclose ( in ) ; crc_start ( ) ; for ( p = save_array ; p -> address != NULL ; p ++ ) { cksum = crc ( p -> address , p -> width ) ; } return 0 ; } 