static void set_vc_hi_font ( struct vc_data * vc , bool set ) { if ( ! set ) { vc -> vc_hi_font_mask = 0 ; if ( vc -> vc_can_do_color ) { vc -> vc_complement_mask >>= 1 ; vc -> vc_s_complement_mask >>= 1 ; } if ( vc -> vc_can_do_color ) { unsigned short * cp = ( unsigned short * ) vc -> vc_origin ; int count = vc -> vc_screenbuf_size / 2 ; unsigned short c ; for ( ; count > 0 ; count -- , cp ++ ) { c = scr_readw ( cp ) ; scr_writew ( ( ( c & 0xfe00 ) >> 1 ) | ( c & 0xff ) , cp ) ; } c = vc -> vc_video_erase_char ; vc -> vc_video_erase_char = ( ( c & 0xfe00 ) >> 1 ) | ( c & 0xff ) ; vc -> vc_attr >>= 1 ; } } else { vc -> vc_hi_font_mask = 0x100 ; if ( vc -> vc_can_do_color ) { vc -> vc_complement_mask <<= 1 ; vc -> vc_s_complement_mask <<= 1 ; } { unsigned short * cp = ( unsigned short * ) vc -> vc_origin ; int count = vc -> vc_screenbuf_size / 2 ; unsigned short c ; for ( ; count > 0 ; count -- , cp ++ ) { unsigned short newc ; c = scr_readw ( cp ) ; if ( vc -> vc_can_do_color ) { newc = ( ( c & 0xff00 ) << 1 ) | ( c & 0xff ) ; } else { newc = c & ~ 0x100 ; } scr_writew ( newc , cp ) ; } c = vc -> vc_video_erase_char ; if ( vc -> vc_can_do_color ) { vc -> vc_video_erase_char = ( ( c & 0xff00 ) << 1 ) | ( c & 0xff ) ; } else { vc -> vc_video_erase_char = c & ~ 0x100 ; } } } } 