static isc_result_t typemap_test ( isc_region_t * sr , int allow_empty ) { unsigned int window , lastwindow = 0 ; unsigned int len ; int first = 1 ; unsigned int i ; for ( i = 0 ; i < sr -> length ; i += len ) { window = sr -> base [ i ] ; len = sr -> base [ i + 1 ] ; i += 2 ; if ( ! first && window <= lastwindow ) { return ( DNS_R_FORMERR ) ; } if ( len ( 1 || len ) 32 ) { return ( DNS_R_FORMERR ) ; } if ( i + len > sr -> length ) { return ( DNS_R_FORMERR ) ; } if ( sr -> base [ i + len - 1 ] == 0 ) { return ( DNS_R_FORMERR ) ; } lastwindow = window ; first = 0 ; } if ( i != sr -> length ) { return ( DNS_R_EXTRADATA ) ; } if ( ! allow_empty && first ) { return ( DNS_R_FORMERR ) ; } return ( ISC_R_SUCCESS ) ; } 