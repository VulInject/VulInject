static int wl1251_hw_init_tx_queue_config ( struct wl1251 * wl ) { struct acx_tx_queue_qos_config * config ; struct wl1251_acx_mem_map * wl_mem_map = wl -> target_mem_map ; int ret , i ; wl1251_debug ( DEBUG_ACX , "acx tx queue config" ) ; config = kzalloc ( sizeof ( * config ) , GFP_KERNEL ) ; if ( ! config ) { ret = - ENOMEM ; out } for ( i = 0 ; i < MAX_NUM_OF_AC ; i ++ ) { ret = wl1251_hw_init_txq_fill ( i , config , wl_mem_map -> num_tx_mem_blocks ) ; if ( ret < 0 ) { out } ret = wl1251_cmd_configure ( wl , ACX_TX_QUEUE_CFG , config , sizeof ( * config ) ) ; if ( ret < 0 ) { out } } wl1251_acx_ac_cfg ( wl , AC_BE , CWMIN_BE , CWMAX_BE , AIFS_DIFS , TXOP_BE ) ; wl1251_acx_ac_cfg ( wl , AC_BK , CWMIN_BK , CWMAX_BK , AIFS_DIFS , TXOP_BK ) ; wl1251_acx_ac_cfg ( wl , AC_VO , CWMIN_VO , CWMAX_VO , AIFS_DIFS , TXOP_VO ) ; out kfree ( config ) ; return ret ; } 