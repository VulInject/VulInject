static RList * blobs_add ( Rvc * rvc , const RList * files ) { RList * ret = r_list_new ( ) ; if ( ! ret ) { return NULL ; } RList * uncommitted = uncommited_rvc ( rvc ) ; if ( ! uncommitted ) { free ( ret ) ; return NULL ; } RListIter * i ; char * path ; r_list_foreach ( , , ) { char * absp = r_file_abspath ( path ) ; if ( ! absp ) { break ; } RListIter * j ; char * ucp ; bool found = false ; RListIter * tmp ; r_list_foreach_safe ( , , , ) { if ( r_str_cmp ( ucp , absp , r_str_len_utf8 ( absp ) ) ) { continue ; } found = true ; RvcBlob * b = bfadd ( rvc , ucp ) ; if ( ! b ) { free ( absp ) ; fail_ret } if ( ! r_list_append ( ret , b ) ) { free ( absp ) ; free ( b -> fhash ) ; free ( b -> fname ) ; fail_ret } r_list_delete ( uncommitted , j ) ; } if ( ! found ) { R_LOG_ERROR ( "File %s is already committed" , path ) ; } free ( absp ) ; } return ret ; fail_ret r_list_free ( uncommitted ) ; free ( ret ) ; return NULL ; } 