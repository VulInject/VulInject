void route_vty_out_tag ( struct vty * vty , const struct prefix * p , struct bgp_path_info * path , int display , safi_t safi , json_object * json ) { json_object * json_out = NULL ; struct attr * attr ; mpls_label_t label = MPLS_INVALID_LABEL ; if ( json ) { json_out = json_object_new_object ( ) ; } route_vty_short_status_out ( vty , path , p , json_out ) ; if ( json == NULL ) { if ( ! display ) { route_vty_out_route ( path -> net , p , vty , NULL , false ) ; } else { vty_out ( vty , "%*s" , 17 , " " ) ; } } attr = path -> attr ; if ( ( ( p -> family == AF_INET ) && ( ( safi == SAFI_MPLS_VPN || safi == SAFI_ENCAP ) ) ) || ( safi == SAFI_EVPN && ! BGP_ATTR_NEXTHOP_AFI_IP6 ( attr ) ) || ( ! BGP_ATTR_MP_NEXTHOP_LEN_IP6 ( attr ) ) ) { if ( safi == SAFI_MPLS_VPN || safi == SAFI_ENCAP || safi == SAFI_EVPN ) { if ( json ) { json_object_string_addf ( json_out , "mpNexthopGlobalIn" , "%pI4" , & attr -> mp_nexthop_global_in ) ; } else { vty_out ( vty , "%-16pI4" , & attr -> mp_nexthop_global_in ) ; } } else { if ( json ) { json_object_string_addf ( json_out , "nexthop" , "%pI4" , & attr -> nexthop ) ; } else { vty_out ( vty , "%-16pI4" , & attr -> nexthop ) ; } } } if ( ( ( p -> family == AF_INET6 ) && ( ( safi == SAFI_MPLS_VPN || safi == SAFI_ENCAP ) ) ) || ( safi == SAFI_EVPN && BGP_ATTR_MP_NEXTHOP_LEN_IP6 ( attr ) ) || ( BGP_ATTR_MP_NEXTHOP_LEN_IP6 ( attr ) ) ) { char buf_a [ 512 ] ; if ( attr -> mp_nexthop_len == BGP_ATTR_NHLEN_IPV6_GLOBAL ) { if ( json ) { json_object_string_addf ( json_out , "mpNexthopGlobalIn" , "%pI6" , & attr -> mp_nexthop_global ) ; } else { vty_out ( vty , "%s" , inet_ntop ( AF_INET6 , & attr -> mp_nexthop_global , buf_a , sizeof ( buf_a ) ) ) ; } } if ( attr -> mp_nexthop_len == BGP_ATTR_NHLEN_IPV6_GLOBAL_AND_LL ) { snprintfrr ( buf_a , sizeof ( buf_a ) , "%pI6(%pI6)" , & attr -> mp_nexthop_global , & attr -> mp_nexthop_local ) ; if ( json ) { json_object_string_add ( json_out , "mpNexthopGlobalLocal" , buf_a ) ; } else { vty_out ( vty , "%s" , buf_a ) ; } } } label = decode_label ( & path -> extra -> label [ 0 ] ) ; if ( bgp_is_valid_label ( & label ) ) { if ( json ) { json_object_int_add ( json_out , "notag" , label ) ; json_object_array_add ( json , json_out ) ; } else { vty_out ( vty , "notag/%d" , label ) ; vty_out ( vty , "\n" ) ; } } if ( ! json ) { vty_out ( vty , "\n" ) ; } } 