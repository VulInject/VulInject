static void stop_processor ( struct icom_port * icom_port ) { unsigned long temp ; unsigned long flags ; int port ; spin_lock_irqsave ( & icom_lock , flags ) ; port = icom_port -> port ; if ( port == 0 || port == 1 ) { stop_proc [ port ] . global_control_reg = & icom_port -> global_reg -> control ; } else { stop_proc [ port ] . global_control_reg = & icom_port -> global_reg -> control_2 ; } temp = readl ( stop_proc [ port ] . global_control_reg ) ; temp = ( temp & ~ start_proc [ port ] . processor_id ) | stop_proc [ port ] . processor_id ; writel ( temp , stop_proc [ port ] . global_control_reg ) ; readl ( stop_proc [ port ] . global_control_reg ) ; unlock spin_unlock_irqrestore ( & icom_lock , flags ) ; } 