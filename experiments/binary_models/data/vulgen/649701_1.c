static inline long aux_ring_buffer_write ( struct dvb_ringbuffer * rbuf , const u8 * buf , unsigned long count ) { unsigned long todo = count ; int free ; while ( todo > 0 ) { if ( dvb_ringbuffer_free ( rbuf ) < 2048 ) { if ( wait_event_interruptible ( rbuf -> queue , ( dvb_ringbuffer_free ( rbuf ) >= 2048 ) ) ) { return count - todo ; } } free = dvb_ringbuffer_free ( rbuf ) ; dvb_ringbuffer_write ( rbuf , buf , free ) ; todo -= free ; buf += free ; } return count - todo ; } 