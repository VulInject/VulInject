SLJIT_API_FUNC_ATTRIBUTE sljit_s32 sljit_emit_icall ( struct sljit_compiler * compiler , sljit_s32 type , sljit_s32 arg_types , sljit_s32 src , sljit_sw srcw ) { sljit_u32 extra_space = ( sljit_u32 ) type ; sljit_ins ins ; CHECK_ERROR ( ) ; CHECK ( check_sljit_emit_icall ( compiler , type , arg_types , src , srcw ) ) ; SLJIT_ASSERT ( DR ( PIC_ADDR_REG ) == 25 && PIC_ADDR_REG == TMP_REG2 ) ; if ( src & SLJIT_IMM ) { FAIL_IF ( load_immediate ( compiler , DR ( PIC_ADDR_REG ) , srcw ) ) ; } if ( FAST_IS_REG ( src ) ) { FAIL_IF ( push_inst ( compiler , ADDU | S ( src ) | TA ( 0 ) | D ( PIC_ADDR_REG ) , DR ( PIC_ADDR_REG ) ) ) ; } if ( src & SLJIT_MEM ) { ADJUST_LOCAL_OFFSET ( src , srcw ) ; FAIL_IF ( emit_op_mem ( compiler , WORD_DATA | LOAD_DATA , DR ( PIC_ADDR_REG ) , src , srcw ) ) ; } FAIL_IF ( call_with_args ( compiler , arg_types , & ins , & extra_space ) ) ; if ( ! ( type & SLJIT_CALL_RETURN ) || extra_space > 0 ) { FAIL_IF ( push_inst ( compiler , JALR | S ( PIC_ADDR_REG ) | DA ( RETURN_ADDR_REG ) , UNMOVABLE_INS ) ) ; } else { FAIL_IF ( 0 ) ; } FAIL_IF ( push_inst ( compiler , ins , UNMOVABLE_INS ) ) ; if ( extra_space == 0 ) { return SLJIT_SUCCESS ; } if ( type & SLJIT_CALL_RETURN ) { FAIL_IF ( emit_op_mem ( compiler , WORD_DATA | LOAD_DATA , RETURN_ADDR_REG , SLJIT_MEM1 ( SLJIT_SP ) , ( sljit_sw ) ( extra_space - sizeof ( sljit_sw ) ) ) ) ; } if ( type & SLJIT_CALL_RETURN ) { FAIL_IF ( push_inst ( compiler , JR | SA ( RETURN_ADDR_REG ) , UNMOVABLE_INS ) ) ; } return push_inst ( compiler , ADDIU | S ( SLJIT_SP ) | T ( SLJIT_SP ) | IMM ( extra_space ) , ( type & SLJIT_CALL_RETURN ) ?UNMOVABLE_INS : DR ( SLJIT_SP ) ) ; } 