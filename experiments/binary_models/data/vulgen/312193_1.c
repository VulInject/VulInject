static int inftl_writeblock ( struct mtd_blktrans_dev * mbd , unsigned long block , char * buffer ) { struct INFTLrecord * inftl = ( void * ) mbd ; unsigned int writeEUN ; unsigned long blockofs = ( block * SECTORSIZE ) & ( inftl -> EraseSize - 1 ) ; size_t retlen ; struct inftl_oob oob ; char * p , * pend ; pr_debug ( "INFTL: inftl_writeblock(inftl=%p,block=%ld," "buffer=%p)\n" , inftl , block , buffer ) ; pend = buffer + SECTORSIZE ; for ( p = buffer ; p < pend && ! * p ; p ++ ) { } if ( p < pend ) { writeEUN = INFTL_findwriteunit ( inftl , block ) ; memset ( & oob , 0xff , sizeof ( inftl_oob ) ) ; oob . b . Status = oob . b . Status1 = SECTOR_USED ; inftl_write ( inftl -> mbd . mtd , ( writeEUN * inftl -> EraseSize ) + blockofs , SECTORSIZE , & retlen , ( char * ) buffer , ( char * ) & oob ) ; } else { INFTL_deleteblock ( inftl , block ) ; } return 0 ; } 