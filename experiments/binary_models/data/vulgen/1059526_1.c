static struct pci_dev * get_upstream_port ( struct pci_dev * pdev ) { struct pci_dev * parent ; parent = pci_upstream_bridge ( pdev ) ; while ( parent ) { if ( pci_pcie_type ( parent ) == PCI_EXP_TYPE_UPSTREAM ) { break ; } parent = pci_upstream_bridge ( parent ) ; } if ( ! parent ) { return NULL ; } switch ( parent -> device ) { case PCI_DEVICE_ID_INTEL_ALPINE_RIDGE_2C_BRIDGE : case PCI_DEVICE_ID_INTEL_ALPINE_RIDGE_4C_BRIDGE : case PCI_DEVICE_ID_INTEL_ALPINE_RIDGE_LP_BRIDGE : case PCI_DEVICE_ID_INTEL_ALPINE_RIDGE_C_4C_BRIDGE : case PCI_DEVICE_ID_INTEL_ALPINE_RIDGE_C_2C_BRIDGE : case PCI_DEVICE_ID_INTEL_TITAN_RIDGE_2C_BRIDGE : case PCI_DEVICE_ID_INTEL_TITAN_RIDGE_4C_BRIDGE : return parent ; } return NULL ; } 