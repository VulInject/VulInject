static int it821x_smart_set_mode ( struct ata_link * link , struct ata_device * * unused ) { struct ata_device * dev ; ata_for_each_dev ( , , ) { dev -> pio_mode = XFER_PIO_0 ; dev -> dma_mode = XFER_MW_DMA_0 ; if ( ata_id_has_dma ( dev -> id ) ) { ata_dev_info ( dev , "configured for DMA\n" ) ; dev -> xfer_mode = XFER_MW_DMA_0 ; dev -> xfer_shift = ATA_SHIFT_MWDMA ; } else { ata_dev_info ( dev , "configured for PIO\n" ) ; dev -> xfer_mode = XFER_PIO_0 ; dev -> xfer_shift = ATA_SHIFT_PIO ; dev -> flags |= ATA_DFLAG_PIO ; } } return 0 ; } 