static int mmu_l2_map ( struct isp_mmu * mmu , phys_addr_t l1_pt , unsigned int l1_idx , phys_addr_t l2_pt , unsigned int start , unsigned int end , phys_addr_t phys ) { unsigned int ptr ; unsigned int idx ; unsigned int pte ; l2_pt &= ISP_PAGE_MASK ; start = start & ISP_PAGE_MASK ; end = ISP_PAGE_ALIGN ( end ) ; phys &= ISP_PAGE_MASK ; ptr = start ; { idx = ISP_PTR_TO_L2_IDX ( ptr ) ; pte = atomisp_get_pte ( l2_pt , idx ) ; if ( ISP_PTE_VALID ( mmu , pte ) ) { mmu_remap_error ( mmu , l1_pt , l1_idx , l2_pt , idx , ptr , pte , phys ) ; return - EINVAL ; } pte = isp_pgaddr_to_pte_valid ( mmu , phys ) ; atomisp_set_pte ( l2_pt , idx , pte ) ; mmu -> l2_pgt_refcount [ l1_idx ] ++ ; ptr += ( 1U << ISP_L2PT_OFFSET ) ; phys += ( 1U << ISP_L2PT_OFFSET ) ; } ptr < end && idx < ISP_L2PT_PTES - 1 ; return 0 ; } 