return ( gcalloc ( 1 , size ) ) ; struct chunk * item ; int index ; if ( size & ( CHUNK_UNIT - 1 ) ) { size = ( size + CHUNK_UNIT - 1 ) & ~ ( CHUNK_UNIT - 1 ) ; } if ( ( size & ( CHUNK_UNIT - 1 ) ) || size >= ( int ) ( CHUNK_MAX * CHUNK_UNIT ) || size <= ( int ) sizeof ( chunk ) ) { fprintf ( stderr , "Attempt to allocate something of size %d\n" , size ) ; return ( gcalloc ( 1 , size ) ) ; } index = ( size + CHUNK_UNIT - 1 ) / CHUNK_UNIT ; if ( chunklists [ index ] == NULL ) { char * pt , * end ; pt = galloc ( ALLOC_CHUNK * size ) ; chunklists [ index ] = ( chunk * ) pt ; end = pt + ( ALLOC_CHUNK - 1 ) * size ; while ( pt < end ) { ( ( chunk * ) pt ) -> next = ( chunk * ) ( pt + size ) ; ( ( chunk2 * ) pt ) -> flag = FLAG ; pt += size ; } ( ( chunk * ) pt ) -> next = NULL ; ( ( chunk2 * ) pt ) -> flag = FLAG ; } item = chunklists [ index ] ; chunklists [ index ] = item -> next ; memset ( item , '\0' , size ) ; return ( item ) ; 