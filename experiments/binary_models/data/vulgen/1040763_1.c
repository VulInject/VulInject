_mongoc_secure_transport_RFC2253_from_cert ( ) { CFTypeRef value ; bson_string_t * retval ; CFTypeRef subject_name ; CFDictionaryRef cert_dict ; cert_dict = SecCertificateCopyValues ( cert , NULL , NULL ) ; if ( ! cert_dict ) { return NULL ; } subject_name = CFDictionaryGetValue ( cert_dict , kSecOIDX509V1SubjectName ) ; if ( ! subject_name ) { return NULL ; } subject_name = CFDictionaryGetValue ( subject_name , kSecPropertyKeyValue ) ; if ( ! subject_name ) { CFRelease ( cert_dict ) ; return NULL ; } retval = bson_string_new ( "" ) ; value = _mongoc_secure_transport_dict_get ( subject_name , kSecOIDCountryName ) ; _bson_append_cftyperef ( retval , "C=" , value ) ; value = _mongoc_secure_transport_dict_get ( subject_name , kSecOIDStateProvinceName ) ; _bson_append_cftyperef ( retval , ",ST=" , value ) ; value = _mongoc_secure_transport_dict_get ( subject_name , kSecOIDLocalityName ) ; _bson_append_cftyperef ( retval , ",L=" , value ) ; value = _mongoc_secure_transport_dict_get ( subject_name , kSecOIDOrganizationName ) ; _bson_append_cftyperef ( retval , ",O=" , value ) ; value = _mongoc_secure_transport_dict_get ( subject_name , kSecOIDOrganizationalUnitName ) ; if ( value ) { if ( CFGetTypeID ( value ) == CFStringGetTypeID ( ) ) { _bson_append_cftyperef ( retval , ",OU=" , value ) ; } if ( CFGetTypeID ( value ) == CFArrayGetTypeID ( ) ) { CFIndex len = CFArrayGetCount ( value ) ; if ( len > 0 ) { _bson_append_cftyperef ( retval , ",OU=" , CFArrayGetValueAtIndex ( value , 0 ) ) ; } if ( len > 1 ) { _bson_append_cftyperef ( retval , "," , CFArrayGetValueAtIndex ( value , 1 ) ) ; } if ( len > 2 ) { _bson_append_cftyperef ( retval , "," , CFArrayGetValueAtIndex ( value , 2 ) ) ; } } } value = _mongoc_secure_transport_dict_get ( subject_name , kSecOIDCommonName ) ; _bson_append_cftyperef ( retval , ",CN=" , value ) ; value = _mongoc_secure_transport_dict_get ( subject_name , kSecOIDStreetAddress ) ; _bson_append_cftyperef ( retval , ",STREET" , value ) ; CFRelease ( cert_dict ) ; return bson_string_free ( retval , false ) ; } 