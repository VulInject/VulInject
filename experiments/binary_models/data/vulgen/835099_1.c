static int __nci_spi_send ( struct nci_spi * nspi , const struct sk_buff * skb , int cs_change ) { struct spi_message m ; struct spi_transfer t ; memset ( & t , 0 , sizeof ( spi_transfer ) ) ; if ( skb ) { t . tx_buf = skb -> data ; t . len = skb -> len ; } else { t . tx_buf = & t ; t . len = 0 ; } t . cs_change = cs_change ; t . delay . value = nspi -> xfer_udelay ; t . delay . unit = SPI_DELAY_UNIT_USECS ; t . speed_hz = nspi -> xfer_speed_hz ; spi_message_init ( & m ) ; return spi_sync ( nspi -> spi , & m ) ; } 