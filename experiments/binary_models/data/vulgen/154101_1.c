static void cpu_sgn_update ( ushort_t sig , uchar_t state , uchar_t sub_state , int cpuid ) { dp_cpu_signature_t signature ; rmc_comm_msg_t req ; int * rmc_req_now ( rmc_comm_msg_t * , uint8_t ) NULL ; if ( state == SIGST_EXIT && sub_state == SIGSUBST_REBOOT ) { if ( current_sgn . state_t . state == SIGST_EXIT && current_sgn . state_t . sub_state != SIGSUBST_REBOOT ) { sub_state = SIGSUBST_PANIC_REBOOT ; } } if ( state == SIGST_OFFLINE || state == SIGST_DETACHED ) { return ; } current_sgn . signature = CPU_SIG_BLD ( sig , state , sub_state ) ; rmc_req_now = ( int ( * ) ( rmc_comm_msg_t * , uint8_t ) ) modgetsymvalue ( "rmc_comm_request_nowait" , 0 ) ; signature . cpu_id = - 1 ; signature . sig = sig ; signature . states = state ; signature . sub_state = sub_state ; req . msg_type = DP_SET_CPU_SIGNATURE ; req . msg_len = ( int ) ( sizeof ( signature ) ) ; req . msg_bytes = 0 ; req . msg_buf = ( caddr_t ) & signature ; if ( state == SIGST_EXIT && ( sub_state == SIGSUBST_HALT || sub_state == SIGSUBST_REBOOT || sub_state == SIGSUBST_ENVIRON || sub_state == SIGSUBST_PANIC_REBOOT ) ) { ( void ) ( rmc_req_now ) ( & req , RMC_COMM_DREQ_URGENT ) ; } else { ( void ) ( rmc_req_now ) ( & req , 0 ) ; } } 