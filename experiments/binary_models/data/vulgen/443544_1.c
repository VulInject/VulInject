int it_tpg_create ( it_config_t * cfg , it_tpg_t * * tpg , char * tpg_name , char * portal_ip_port ) { int ret ; it_tpg_t * ptr ; it_portal_t * portal = NULL ; if ( ! cfg || ! tpg || ! tpg_name || ! portal_ip_port ) { return ( EINVAL ) ; } * tpg = NULL ; ptr = cfg -> config_tpg_list ; while ( ptr ) { if ( strcmp ( tpg_name , ptr -> tpg_name ) == 0 ) { break ; } ptr = ptr -> tpg_next ; } if ( ptr ) { return ( EEXIST ) ; } ptr = calloc ( 1 , sizeof ( it_tpg_t ) ) ; if ( ! ptr ) { return ( ENOMEM ) ; } ptr -> tpg_generation = 1 ; ( void ) strlcpy ( ptr -> tpg_name , tpg_name , sizeof ( ptr -> tpg_name ) ) ; ret = it_portal_create ( cfg , ptr , & portal , portal_ip_port ) ; if ( ret != 0 ) { return ( ret ) ; } ptr -> tpg_next = cfg -> config_tpg_list ; cfg -> config_tpg_list = ptr ; cfg -> config_tpg_count ++ ; * tpg = ptr ; return ( 0 ) ; } 