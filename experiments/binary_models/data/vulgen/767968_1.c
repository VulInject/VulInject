int ib_send_rmpp_mad ( struct ib_mad_send_wr_private * mad_send_wr ) { struct ib_rmpp_mad * rmpp_mad ; int ret ; rmpp_mad = mad_send_wr -> send_buf . mad ; if ( ! ( ib_get_rmpp_flags ( & rmpp_mad -> rmpp_hdr ) & IB_MGMT_RMPP_FLAG_ACTIVE ) ) { return IB_RMPP_RESULT_UNHANDLED ; } if ( rmpp_mad -> rmpp_hdr . rmpp_type != IB_MGMT_RMPP_TYPE_DATA ) { mad_send_wr -> seg_num = 1 ; return IB_RMPP_RESULT_INTERNAL ; } mad_send_wr -> newwin = init_newwin ( mad_send_wr ) ; ret = send_next_seg ( mad_send_wr ) ; if ( ! ret ) { return IB_RMPP_RESULT_CONSUMED ; } return ret ; } 