static int i2c_request_mem_write ( struct i2c_handle_s * hi2c , struct i2c_request * request , uint64_t timeout_ref ) { vaddr_t base = get_base ( hi2c ) ; if ( i2c_wait_txis ( hi2c , timeout_ref ) ) { return - 1 ; } if ( request -> mem_addr_size == I2C_MEMADD_SIZE_8BIT ) { io_write8 ( base + I2C_TXDR , request -> mem_addr & 0x00FFU ) ; } else { io_write8 ( base + I2C_TXDR , ( request -> mem_addr & 0xFF00U ) >> 8 ) ; if ( i2c_wait_txis ( hi2c , timeout_ref ) ) { return - 1 ; } io_write8 ( base + I2C_TXDR , request -> mem_addr & 0x00FFU ) ; } if ( wait_isr_event ( hi2c , I2C_ISR_TCR , 1 , timeout_ref ) ) { return - 1 ; } return 0 ; } 