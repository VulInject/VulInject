static size_t strftime_win32 ( char * dst , size_t dstlen , const char * format , const struct tm * tm ) { size_t len ; wchar_t wformat [ 8 ] ; wchar_t wbuf [ MAX_L10N_DATA ] ; if ( len == 0 ) { elog ( ERROR , "could not convert format string from UTF-8: error code %lu" , GetLastError ( ) ) ; } len = wcsftime ( wbuf , MAX_L10N_DATA , wformat , tm ) ; if ( len == 0 ) { return 0 ; } len = WideCharToMultiByte ( CP_UTF8 , 0 , wbuf , len , dst , dstlen - 1 , NULL , NULL ) ; if ( len == 0 ) { elog ( ERROR , "could not convert string to UTF-8: error code %lu" , GetLastError ( ) ) ; } dst [ len ] = '\0' ; return len ; } 