static unsigned int sfi_setup_e820 ( unsigned int max_entries , struct e820_entry * entries ) { struct sfi_table_simple * sb ; struct sfi_mem_entry * mentry ; unsigned long long start , end , size ; int type , total = 0 ; u32 i ; sb = sfi_search_mmap ( ) ; sfi_for_each_mentry ( , , ) { start = mentry -> phys_start ; size = mentry -> pages << 12 ; end = start + size ; if ( start > end ) { continue ; } switch ( mentry -> type ) { case SFI_MEM_CONV : type = E820_RAM ; break ; case SFI_MEM_UNUSABLE : case SFI_RUNTIME_SERVICE_DATA : continue ; default : type = E820_RESERVED ; } if ( total == E820MAX ) { break ; } entries [ total ] . addr = start ; entries [ total ] . size = size ; entries [ total ] . type = type ; total ++ ; } return total ; } 