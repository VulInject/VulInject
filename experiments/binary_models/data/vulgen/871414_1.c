static __inline int wihap_check_rates ( struct wihap_sta_info * sta , u_int8_t rates [ ] , int rates_len ) { struct wi_softc * sc = sta -> sc ; int i ; sta -> rates = 0 ; sta -> tx_max_rate = 0 ; for ( i = 0 ; i < rates_len ; i ++ ) { switch ( rates [ i ] & 0x7f ) { case 0x02 : sta -> rates |= WI_SUPPRATES_1M ; break ; case 0x04 : sta -> rates |= WI_SUPPRATES_2M ; if ( sta -> tx_max_rate < 1 ) { sta -> tx_max_rate = 1 ; } break ; case 0x0b : sta -> rates |= WI_SUPPRATES_5M ; if ( sta -> tx_max_rate < 2 ) { sta -> tx_max_rate = 2 ; } break ; case 0x16 : sta -> rates |= WI_SUPPRATES_11M ; sta -> tx_max_rate = 3 ; break ; } } sta -> tx_curr_rate = sta -> tx_max_rate ; return ( sta -> rates == 0 ?- 1 : 0 ) ; } 