getpacket ( ) { unsigned char checksum ; unsigned char xmitcsum ; int i ; int count ; char ch ; { while ( ( ch = getDebugChar ( ) ) != '$' ) { } checksum = 0 ; xmitcsum = - 1 ; count = 0 ; while ( count < BUFMAX - 1 ) { ch = getDebugChar ( ) ; if ( ch == '#' ) { break ; } checksum = checksum + ch ; buffer [ count ] = ch ; count = count + 1 ; } buffer [ count ] = '\0' ; if ( ch == '#' ) { xmitcsum = hex_to_bin ( getDebugChar ( ) ) << 4 ; xmitcsum += hex_to_bin ( getDebugChar ( ) ) ; if ( checksum != xmitcsum ) { putDebugChar ( '-' ) ; } else { putDebugChar ( '+' ) ; } } } checksum != xmitcsum ; } 