static int stack_erasing_sysctl ( struct ctl_table * table , int write , void __user * buffer , size_t * lenp , loff_t * ppos ) { int ret = 0 ; int prev_state = state ; table -> data = & state ; table -> maxlen = sizeof ( int ) ; ret = proc_dointvec_minmax ( table , write , buffer , lenp , ppos ) ; state = ! ! state ; if ( ret || ! write || state == prev_state ) { return ret ; } if ( state ) { static_branch_disable ( & stack_erasing_bypass ) ; } else { static_branch_enable ( & stack_erasing_bypass ) ; } pr_warn ( "stackleak: kernel stack erasing is %s\n" , state ?"enabled" : "disabled" ) ; return ret ; } 