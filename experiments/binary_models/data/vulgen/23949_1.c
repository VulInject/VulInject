void mem_init ( void ) { struct at91_pmc * pmc = ( at91_pmc * ) ATMEL_BASE_PMC ; struct atmel_mpddr * mpddrc = ( atmel_mpddr * ) ATMEL_BASE_MPDDRC ; struct atmel_mpddrc_config ddrc_config ; u32 reg ; ddrc_conf ( & ddrc_config ) ; at91_periph_clk_enable ( ATMEL_ID_MPDDRC ) ; writel ( AT91_PMC_DDR , & pmc -> scer ) ; reg = readl ( & mpddrc -> io_calibr ) ; reg &= ~ ATMEL_MPDDRC_IO_CALIBR_RDIV ; reg |= ATMEL_MPDDRC_IO_CALIBR_DDR3_RZQ_55 ; reg &= ~ ATMEL_MPDDRC_IO_CALIBR_TZQIO ; reg |= ATMEL_MPDDRC_IO_CALIBR_TZQIO_ ( 101 ) ; writel ( reg , & mpddrc -> io_calibr ) ; ddr3_init ( ATMEL_BASE_MPDDRC , ATMEL_BASE_DDRCS , & ddrc_config ) ; writel ( 0x3 , & mpddrc -> cal_mr4 ) ; writel ( 64 , & mpddrc -> tim_cal ) ; } 