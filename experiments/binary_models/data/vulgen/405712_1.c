JsVar * jsvNewWithFlags ( JsVarFlags flags ) { if ( isMemoryBusy ) { jsErrorFlags |= JSERR_MEMORY_BUSY ; return 0 ; } JsVar * v = 0 ; jshInterruptOff ( ) ; if ( jsVarFirstEmpty != 0 ) { v = jsvGetAddressOf ( jsVarFirstEmpty ) ; jsVarFirstEmpty = jsvGetNextSibling ( v ) ; touchedFreeList = true ; } jshInterruptOn ( ) ; if ( v ) { assert ( v -> flags == JSV_UNUSED ) ; jsvResetVariable ( v , flags ) ; return v ; } jsErrorFlags |= JSERR_LOW_MEMORY ; if ( jshIsInInterrupt ( ) ) { return 0 ; } if ( jsvGarbageCollect ( ) ) { return jsvNewWithFlags ( flags ) ; } if ( jsiFreeMoreMemory ( ) ) { return jsvNewWithFlags ( flags ) ; } jsvSetMemoryTotal ( jsVarsSize * 2 ) ; return jsvNewWithFlags ( flags ) ; jsErrorFlags |= JSERR_MEMORY ; return 0 ; } 