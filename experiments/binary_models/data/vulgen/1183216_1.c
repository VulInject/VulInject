static EFI_STATUS efi_serial_init ( EFI_HANDLE * * handlep , int * nhandles ) { UINTN bufsz = 0 ; EFI_STATUS status ; EFI_HANDLE * handles ; * nhandles = 0 ; handles = NULL ; status = BS -> LocateHandle ( ByProtocol , & serial , NULL , & bufsz , handles ) ; if ( status != EFI_BUFFER_TOO_SMALL ) { return ( status ) ; } * nhandles = ( int ) ( bufsz / sizeof ( EFI_HANDLE ) ) ; status = BS -> LocateHandle ( ByProtocol , & serial , NULL , & bufsz , handles ) ; if ( EFI_ERROR ( status ) ) { free ( handles ) ; * nhandles = 0 ; } else { * handlep = handles ; } return ( status ) ; } 