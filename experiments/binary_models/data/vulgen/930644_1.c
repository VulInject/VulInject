int qla4xxx_init_rings ( struct scsi_qla_host * ha ) { unsigned long flags = 0 ; int i ; spin_lock_irqsave ( & ha -> hardware_lock , flags ) ; ha -> request_out = 0 ; ha -> request_in = 0 ; ha -> request_ptr = & ha -> request_ring [ ha -> request_in ] ; ha -> req_q_count = REQUEST_QUEUE_DEPTH ; ha -> response_in = 0 ; ha -> response_out = 0 ; ha -> response_ptr = & ha -> response_ring [ ha -> response_out ] ; if ( is_qla8022 ( ha ) ) { writel ( 0 , ( unsigned long __iomem * ) & ha -> qla4_82xx_reg -> req_q_out ) ; writel ( 0 , ( unsigned long __iomem * ) & ha -> qla4_82xx_reg -> rsp_q_in ) ; writel ( 0 , ( unsigned long __iomem * ) & ha -> qla4_82xx_reg -> rsp_q_out ) ; } if ( is_qla8032 ( ha ) || is_qla8042 ( ha ) ) { writel ( 0 , ( unsigned long __iomem * ) & ha -> qla4_83xx_reg -> req_q_in ) ; writel ( 0 , ( unsigned long __iomem * ) & ha -> qla4_83xx_reg -> rsp_q_in ) ; writel ( 0 , ( unsigned long __iomem * ) & ha -> qla4_83xx_reg -> rsp_q_out ) ; } else { ha -> shadow_regs -> req_q_out = __constant_cpu_to_le32 ( 0 ) ; ha -> shadow_regs -> rsp_q_in = __constant_cpu_to_le32 ( 0 ) ; wmb ( ) ; writel ( 0 , & ha -> reg -> req_q_in ) ; writel ( 0 , & ha -> reg -> rsp_q_out ) ; readl ( & ha -> reg -> rsp_q_out ) ; } qla4xxx_init_response_q_entries ( ha ) ; for ( i = 0 ; i < MAX_MRB ; i ++ ) { ha -> active_mrb_array [ i ] = NULL ; } return QLA_SUCCESS ; } 