void * imx_otp_read ( struct v4l2_subdev * sd , u8 dev_addr , u32 start_addr , u32 size ) { struct i2c_client * client = v4l2_get_subdevdata ( sd ) ; u8 * buf ; int ret ; int i ; if ( ! buf ) { return ERR_PTR ( - ENOMEM ) ; } for ( i = 0 ; i < IMX_OTP_PAGE_MAX ; i ++ ) { ret = imx_write_reg ( client , IMX_8BIT , IMX_OTP_PAGE_REG , i & 0xff ) ; if ( ret ) { fail } ret = imx_write_reg ( client , IMX_8BIT , IMX_OTP_MODE_REG , IMX_OTP_MODE_READ ) ; if ( ret ) { fail } ret = imx_read_otp_reg_array ( client , IMX_OTP_PAGE_SIZE , IMX_OTP_START_ADDR , buf + i * IMX_OTP_PAGE_SIZE ) ; if ( ret ) { fail } } return buf ; fail dev_err ( & client -> dev , "sensor found no valid OTP data\n" ) ; return ERR_PTR ( ret ) ; } 