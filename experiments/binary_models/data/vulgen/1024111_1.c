static void GME_VScroll ( GMatrixEdit * gme , struct sbevent * sb ) { int newpos = gme -> off_top ; int page ; GRect size ; GDrawGetSize ( gme -> nested , & size ) ; page = size . height / ( gme -> fh + gme -> vpad ) ; switch ( sb -> type ) { case et_sb_top : newpos = 0 ; break ; case et_sb_uppage : newpos -= 9 * page / 10 ; break ; case et_sb_up : newpos -- ; break ; case et_sb_down : newpos ++ ; break ; case et_sb_downpage : newpos += 9 * page / 10 ; break ; case et_sb_bottom : newpos = gme -> rows + 1 ; break ; case et_sb_thumb : case et_sb_thumbrelease : newpos = sb -> pos ; break ; case et_sb_halfup : case et_sb_halfdown : break ; } if ( newpos + page > gme -> rows + 1 ) { newpos = gme -> rows + 1 - page ; } if ( newpos < 0 ) { newpos = 0 ; } if ( newpos != gme -> off_top ) { int diff = ( newpos - gme -> off_top ) * ( gme -> fh + gme -> vpad ) ; GRect r ; gme -> off_top = newpos ; GScrollBarSetPos ( gme -> vsb , newpos ) ; r . x = 1 ; r . y = 1 ; r . width = size . width - 1 ; r . height = size . height - 1 ; GDrawScroll ( gme -> nested , & r , 0 , diff ) ; GME_PositionEdit ( gme ) ; } } 