static void qxl_cursor_atomic_disable ( struct drm_plane * plane , struct drm_atomic_state * state ) { struct drm_plane_state * old_state = drm_atomic_get_old_plane_state ( state , plane ) ; struct qxl_device * qdev = to_qxl ( plane -> dev ) ; struct qxl_crtc * qcrtc ; struct qxl_release * release ; struct qxl_cursor_cmd * cmd ; int ret ; ret = qxl_alloc_release_reserved ( qdev , sizeof ( * cmd ) , QXL_RELEASE_CURSOR_CMD , & release , NULL ) ; if ( ret ) { return ; } ret = qxl_release_reserve_list ( release , true ) ; if ( ret ) { qxl_release_free ( qdev , release ) ; return ; } cmd = ( qxl_cursor_cmd * ) qxl_release_map ( qdev , release ) ; cmd -> type = QXL_CURSOR_HIDE ; qxl_release_unmap ( qdev , release , & cmd -> release_info ) ; qxl_push_cursor_ring_release ( qdev , release , QXL_CMD_CURSOR , false ) ; qcrtc = to_qxl_crtc ( old_state -> crtc ) ; qxl_free_cursor ( qcrtc -> cursor_bo ) ; qcrtc -> cursor_bo = NULL ; } 