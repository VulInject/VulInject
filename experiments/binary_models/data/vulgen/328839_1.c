static void __printf ( 3 , 4 ) __init __test ( const char * expect , int elen , const char * fmt , ... ) ( va_list ap , int rand , char * p , ( elen >= BUF_SIZE ) { pr_err ( "error in test suite: expected output length %d too long. Format was '%s'.\n" , elen , fmt ) failed_tests ++ return ; } va_start ( ap , fmt ) , failed_tests += do_test ( BUF_SIZE , expect , elen , fmt , ap ) , rand = get_random_u32_inclusive ( 1 , elen + 1 ) , failed_tests += do_test ( rand , expect , elen , fmt , ap ) , failed_tests += do_test ( 0 , expect , elen , fmt , ap ) , p = kvasprintf ( GFP_KERNEL , fmt , ap ) , ( p ) { total_tests ++ if ( memcmp ( p , expect , elen ) ) { pr_warn ( "kvasprintf(..., \"%s\", ...) returned '%s', expected '%s'\n" , fmt , p , expect ) failed_tests ++ } ; } kfree ( p ) ) va_end ( ap ) ; 