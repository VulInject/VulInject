static size_t dctcp_get_info ( struct sock * sk , u32 ext , int * attr , union tcp_cc_info * info ) { const struct dctcp * ca = inet_csk_ca ( sk ) ; const struct tcp_sock * tp = tcp_sk ( sk ) ; if ( ext & ( 1 << ( INET_DIAG_DCTCPINFO - 1 ) ) || ext & ( 1 << ( INET_DIAG_VEGASINFO - 1 ) ) ) { if ( inet_csk ( sk ) -> icsk_ca_ops != & dctcp_reno ) { info -> dctcp . dctcp_enabled = 1 ; info -> dctcp . dctcp_ce_state = ( u16 ) ca -> ce_state ; info -> dctcp . dctcp_alpha = ca -> dctcp_alpha ; info -> dctcp . dctcp_ab_ecn = tp -> mss_cache * ( tp -> delivered_ce - ca -> old_delivered_ce ) ; info -> dctcp . dctcp_ab_tot = tp -> mss_cache * ( tp -> delivered - ca -> old_delivered ) ; } * attr = INET_DIAG_DCTCPINFO ; return sizeof ( info -> dctcp ) ; } return 0 ; } 