static double find_peak_magnitude ( AVFrame * frame , int channel ) { if ( channel == - 1 ) { for ( int c = 0 ; c < frame -> ch_layout . nb_channels ; c ++ ) { double * data_ptr = ( double * ) frame -> extended_data [ c ] ; for ( int i = 0 ; i < frame -> nb_samples ; i ++ ) { max = fmax ( max , fabs ( data_ptr [ i ] ) ) ; } } } else { double * data_ptr = ( double * ) frame -> extended_data [ channel ] ; for ( int i = 0 ; i < frame -> nb_samples ; i ++ ) { max = fmax ( max , fabs ( data_ptr [ i ] ) ) ; } } return max ; } 