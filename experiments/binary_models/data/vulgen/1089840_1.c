static int rsi_find_bulk_in_and_out_endpoints ( struct usb_interface * interface , struct rsi_hw * adapter ) { struct rsi_91x_usbdev * dev = ( rsi_91x_usbdev * ) adapter -> rsi_dev ; struct usb_host_interface * iface_desc ; struct usb_endpoint_descriptor * endpoint ; __le16 buffer_size ; int ii , bep_found = 0 ; iface_desc = & ( interface -> altsetting [ 0 ] ) ; for ( ii = 0 ; ii < iface_desc -> desc . bNumEndpoints ; ++ ii ) { endpoint = & ( iface_desc -> endpoint [ ii ] . desc ) ; if ( ( ! ( dev -> bulkin_endpoint_addr ) ) && ( endpoint -> bEndpointAddress & USB_DIR_IN ) && ( ( endpoint -> bmAttributes & USB_ENDPOINT_XFERTYPE_MASK ) == USB_ENDPOINT_XFER_BULK ) ) { buffer_size = endpoint -> wMaxPacketSize ; dev -> bulkin_size = buffer_size ; dev -> bulkin_endpoint_addr = endpoint -> bEndpointAddress ; } if ( ! dev -> bulkout_endpoint_addr [ bep_found ] && ! ( endpoint -> bEndpointAddress & USB_DIR_IN ) && ( ( endpoint -> bmAttributes & USB_ENDPOINT_XFERTYPE_MASK ) == USB_ENDPOINT_XFER_BULK ) ) { dev -> bulkout_endpoint_addr [ bep_found ] = endpoint -> bEndpointAddress ; buffer_size = endpoint -> wMaxPacketSize ; dev -> bulkout_size [ bep_found ] = buffer_size ; bep_found ++ ; } } if ( ! ( dev -> bulkin_endpoint_addr ) && ( dev -> bulkout_endpoint_addr [ 0 ] ) ) { return - EINVAL ; } return 0 ; } 