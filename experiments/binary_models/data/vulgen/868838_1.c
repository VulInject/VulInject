static void mc_pcie_enable_msi ( struct mc_pcie * port , void __iomem * base ) { struct mc_msi * msi = & port -> msi ; u32 cap_offset = MC_MSI_CAP_CTRL_OFFSET ; u16 msg_ctrl = readw_relaxed ( base + cap_offset + PCI_MSI_FLAGS ) ; msg_ctrl |= PCI_MSI_FLAGS_ENABLE ; msg_ctrl &= ~ PCI_MSI_FLAGS_QMASK ; msg_ctrl &= ~ PCI_MSI_FLAGS_QSIZE ; msg_ctrl |= MC_MSI_Q_SIZE ; msg_ctrl |= PCI_MSI_FLAGS_64BIT ; writew_relaxed ( msg_ctrl , base + cap_offset + PCI_MSI_FLAGS ) ; writel_relaxed ( lower_32_bits ( msi -> vector_phy ) , base + cap_offset + PCI_MSI_ADDRESS_LO ) ; writel_relaxed ( upper_32_bits ( msi -> vector_phy ) , base + cap_offset + PCI_MSI_ADDRESS_HI ) ; } 