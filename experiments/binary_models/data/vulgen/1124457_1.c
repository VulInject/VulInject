void vivid_cec_bus_free_work ( struct vivid_dev * dev ) { spin_lock ( & dev -> cec_slock ) ; while ( ! list_empty ( & dev -> cec_work_list ) ) { struct vivid_cec_work * cw = list_first_entry ( & dev -> cec_work_list , vivid_cec_work , list ) ; spin_unlock ( & dev -> cec_slock ) ; cancel_delayed_work_sync ( & cw -> work ) ; spin_lock ( & dev -> cec_slock ) ; list_del ( & cw -> list ) ; kfree ( cw ) ; } spin_unlock ( & dev -> cec_slock ) ; } 