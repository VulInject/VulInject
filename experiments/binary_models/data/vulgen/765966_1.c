static int __init kona_timer_init ( struct device_node * node ) { u32 freq ; struct clk * external_clk ; external_clk = of_clk_get_by_name ( node , NULL ) ; if ( ! IS_ERR ( external_clk ) ) { arch_timer_rate = clk_get_rate ( external_clk ) ; clk_prepare_enable ( external_clk ) ; } if ( ! of_property_read_u32 ( node , "clock-frequency" , & freq ) ) { arch_timer_rate = freq ; } else { pr_err ( "Kona Timer v1 unable to determine clock-frequency\n" ) ; return - EINVAL ; } timers . tmr_irq = irq_of_parse_and_map ( node , 0 ) ; timers . tmr_regs = of_iomap ( node , 0 ) ; kona_timer_disable_and_clear ( timers . tmr_regs ) ; kona_timer_clockevents_init ( ) ; if ( request_irq ( timers . tmr_irq , kona_timer_interrupt , IRQF_TIMER , "Kona Timer Tick" , NULL ) ) { pr_err ( "%s: request_irq() failed\n" , "Kona Timer Tick" ) ; } return 0 ; } 