static heim_data_t stdb_copy_value ( void * db , heim_string_t table , heim_data_t key , heim_error_t * error ) { bsearch_file_handle bfh = db ; const char * k ; char * v = NULL ; heim_data_t value ; int ret ; if ( error ) { * error = NULL ; } if ( table == NULL ) { table = HSTR ( "" ) ; } if ( table != HSTR ( "" ) ) { return NULL ; } if ( heim_get_tid ( key ) == HEIM_TID_STRING ) { k = heim_string_get_utf8 ( ( heim_string_t ) key ) ; } else { k = ( const char * ) heim_data_get_ptr ( key ) ; } ret = _bsearch_file ( bfh , k , & v , NULL , NULL , NULL ) ; if ( ret == 0 && v == NULL ) { ret = - 1 ; } if ( ret != 0 ) { if ( ret > 0 && error ) { * error = heim_error_create ( ret , "%s" , strerror ( ret ) ) ; } return NULL ; } value = heim_data_create ( v , strlen ( v ) ) ; return value ; } 