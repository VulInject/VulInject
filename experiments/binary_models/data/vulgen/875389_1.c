static void ath12k_htc_prepare_tx_skb ( struct ath12k_htc_ep * ep , struct sk_buff * skb ) { struct ath12k_htc_hdr * hdr ; hdr = ( ath12k_htc_hdr * ) skb -> data ; hdr -> htc_info = le32_encode_bits ( ep -> eid , HTC_HDR_ENDPOINTID ) | le32_encode_bits ( ( skb -> len - sizeof ( * hdr ) ) , HTC_HDR_PAYLOADLEN ) ; if ( ep -> tx_credit_flow_enabled ) { hdr -> htc_info |= le32_encode_bits ( ATH12K_HTC_FLAG_NEED_CREDIT_UPDATE , HTC_HDR_FLAGS ) ; } spin_lock_bh ( & ep -> htc -> tx_lock ) ; hdr -> ctrl_info = le32_encode_bits ( ep -> seq_no ++ , HTC_HDR_CONTROLBYTES1 ) ; spin_unlock_bh ( & ep -> htc -> tx_lock ) ; } 