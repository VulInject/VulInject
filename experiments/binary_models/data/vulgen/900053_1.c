static void __init clk_sp810_of_setup ( struct device_node * node ) { struct clk_sp810 * sp810 = kzalloc ( sizeof ( * sp810 ) , GFP_KERNEL ) ; const char * parent_names [ 2 ] ; int num = ARRAY_SIZE ( parent_names ) ; char name [ 12 ] ; struct clk_init_data init ; static int instance ; int i ; bool deprecated ; if ( ! sp810 ) { return ; } if ( of_clk_parent_fill ( node , parent_names , num ) != num ) { pr_warn ( "Failed to obtain parent clocks for SP810!\n" ) ; return ; } sp810 -> node = node ; sp810 -> base = of_iomap ( node , 0 ) ; spin_lock_init ( & sp810 -> lock ) ; init . name = name ; init . ops = & clk_sp810_timerclken_ops ; init . flags = 0 ; init . parent_names = parent_names ; init . num_parents = num ; deprecated = ! of_find_property ( node , "assigned-clock-parents" , NULL ) ; for ( i = 0 ; i < ARRAY_SIZE ( sp810 -> timerclken ) ; i ++ ) { snprintf ( name , sizeof ( name ) , "sp810_%d_%d" , instance , i ) ; sp810 -> timerclken [ i ] . sp810 = sp810 ; sp810 -> timerclken [ i ] . channel = i ; sp810 -> timerclken [ i ] . hw . init = & init ; if ( deprecated ) { init . ops -> set_parent ( & sp810 -> timerclken [ i ] . hw , 1 ) ; } sp810 -> timerclken [ i ] . clk = clk_register ( NULL , & sp810 -> timerclken [ i ] . hw ) ; WARN_ON ( IS_ERR ( sp810 -> timerclken [ i ] . clk ) ) ; } of_clk_add_provider ( node , clk_sp810_timerclken_of_get , sp810 ) ; instance ++ ; } 