static int caam_rsa_set_pub_key ( struct crypto_akcipher * tfm , const void * key , unsigned int keylen ) { struct caam_rsa_ctx * ctx = akcipher_tfm_ctx_dma ( tfm ) ; struct rsa_key raw_key = { NULL } ; struct caam_rsa_key * rsa_key = & ctx -> key ; int ret ; ret = rsa_parse_pub_key ( & raw_key , key , keylen ) ; if ( ret ) { return ret ; } rsa_key -> e = kmemdup ( raw_key . e , raw_key . e_sz , GFP_KERNEL ) ; if ( ! rsa_key -> e ) { err } rsa_key -> n = caam_read_raw_data ( raw_key . n , & raw_key . n_sz ) ; if ( ! rsa_key -> n ) { err } if ( caam_rsa_check_key_length ( raw_key . n_sz << 3 ) ) { caam_rsa_free_key ( rsa_key ) ; return - EINVAL ; } rsa_key -> e_sz = raw_key . e_sz ; rsa_key -> n_sz = raw_key . n_sz ; return 0 ; err caam_rsa_free_key ( rsa_key ) ; return - ENOMEM ; } 