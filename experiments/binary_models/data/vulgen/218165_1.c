devinfo_volume_preprobing_done ( , , ) { void * end_token = ( void * ) userdata1 ; char * whole_disk ; char * block_device ; const char * storage_udi ; HalDevice * storage_d ; const char * slice ; int dos_num ; if ( hal_device_property_get_bool ( d , "info.ignore" ) ) { HAL_INFO ( ( "Preprobing merged info.ignore==TRUE %s" , hal_device_get_udi ( d ) ) ) ; skip } block_device = ( char * ) hal_device_property_get_string ( d , "block.device" ) ; storage_udi = hal_device_property_get_string ( d , "block.storage_device" ) ; slice = hal_device_property_get_string ( d , "block.solaris.slice" ) ; if ( ( block_device == NULL ) || ( storage_udi == NULL ) || ( slice == NULL ) || ( strlen ( slice ) < 2 ) ) { HAL_INFO ( ( "Malformed volume properties %s" , hal_device_get_udi ( d ) ) ) ; skip } storage_d = hal_device_store_match_key_value_string ( hald_get_gdl ( ) , "info.udi" , storage_udi ) ; whole_disk = hal_device_has_capability ( storage_d , "storage.cdrom" ) ?"s2" : WHOLE_DISK ; if ( is_dos_path ( block_device , & dos_num ) ) { if ( ( hal_device_property_get_bool ( storage_d , "storage.no_partitions_hint" ) || ( dos_num > hal_device_property_get_int ( storage_d , "storage.solaris.num_dos_partitions" ) ) ) ) { HAL_INFO ( ( "%d>%d %s" , dos_num , hal_device_property_get_int ( storage_d , "storage.solaris.num_dos_partitions" ) , hal_device_get_udi ( storage_d ) ) ) ; skip } } else { if ( ( slice [ 0 ] == 's' ) && ( isdigit ( slice [ 1 ] ) ) && ( ( strcmp ( slice , whole_disk ) ) != 0 ) && ! hal_device_property_get_bool ( storage_d , "storage.solaris.vtoc_slices" ) ) { HAL_INFO ( ( "Not probing slice %s" , hal_device_get_udi ( d ) ) ) ; skip } } HAL_INFO ( ( "Probing udi=%s" , hal_device_get_udi ( d ) ) ) ; hald_runner_run ( d , "hald-probe-volume" , NULL , DEVINFO_PROBE_VOLUME_TIMEOUT , devinfo_callouts_probing_done , ( gpointer ) end_token , userdata2 ) ; return ; skip hal_device_store_remove ( hald_get_tdl ( ) , d ) ; g_object_unref ( d ) ; hotplug_event_end ( end_token ) ; } 