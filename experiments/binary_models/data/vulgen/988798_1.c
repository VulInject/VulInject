static void SCPrintPage ( PI * pi , SplineChar * sc ) { DBounds b , page ; real scalex , scaley ; if ( pi -> page != 0 ) { endpage ( pi ) ; } ++ pi -> page ; if ( pi -> printtype != pt_pdf ) { fprintf ( pi -> out , "%%%%Page: %d %d\n" , pi -> page , pi -> page ) ; fprintf ( pi -> out , "%%%%PageResources: font Times-Bold\n" ) ; fprintf ( pi -> out , "save mark\n" ) ; } else { startpage ( pi ) ; } SplineCharFindBounds ( sc , & b ) ; if ( b . maxy < sc -> parent -> ascent + 5 ) { b . maxy = sc -> parent -> ascent + 5 ; } if ( b . miny > - sc -> parent -> descent ) { b . miny = - sc -> parent -> descent - 5 ; } if ( b . minx > 00 ) { b . minx = - 5 ; } if ( b . maxx <= sc -> width + 5 ) { b . maxx = sc -> width + 5 ; } page . minx = 40 ; page . maxx = pi -> pagewidth - 15 ; page . miny = 20 ; page . maxy = pi -> pageheight - 20 ; if ( pi -> printtype != pt_pdf ) { fprintf ( pi -> out , "Times-Bold__12 setfont\n" ) ; fprintf ( pi -> out , "(%s from %s) 80 %g n_show\n" , sc -> name , sc -> parent -> fullname , ( double ) ( page . maxy - 12 ) ) ; } else { fprintf ( pi -> out , "BT\n" ) ; fprintf ( pi -> out , "  /FTB 12 Tf\n" ) ; fprintf ( pi -> out , "  80 %g Td\n" , ( double ) ( page . maxy - 12 ) ) ; fprintf ( pi -> out , "  (%s from %s) Tj\n" , sc -> name , sc -> parent -> fullname ) ; fprintf ( pi -> out , "ET\n" ) ; } page . maxy -= 20 ; scalex = ( page . maxx - page . minx ) / ( b . maxx - b . minx ) ; scaley = ( page . maxy - page . miny ) / ( b . maxy - b . miny ) ; pi -> scale = ( scalex < scaley ) ?scalex : scaley ; pi -> xoff = page . minx - b . minx * pi -> scale ; pi -> yoff = page . miny - b . miny * pi -> scale ; if ( pi -> printtype != pt_pdf ) { fprintf ( pi -> out , "gsave .2 setlinewidth\n" ) ; fprintf ( pi -> out , "%g %g moveto %g %g lineto stroke\n" , ( double ) page . minx , ( double ) pi -> yoff , ( double ) page . maxx , ( double ) pi -> yoff ) ; fprintf ( pi -> out , "%g %g moveto %g %g lineto stroke\n" , ( double ) pi -> xoff , ( double ) page . miny , ( double ) pi -> xoff , ( double ) page . maxy ) ; fprintf ( pi -> out , "%g %g moveto %g %g lineto stroke\n" , ( double ) page . minx , ( double ) ( sc -> parent -> ascent * pi -> scale + pi -> yoff ) , ( double ) page . maxx , ( double ) ( sc -> parent -> ascent * pi -> scale + pi -> yoff ) ) ; fprintf ( pi -> out , "%g %g moveto %g %g lineto stroke\n" , ( double ) page . minx , ( double ) ( - sc -> parent -> descent * pi -> scale + pi -> yoff ) , ( double ) page . maxx , ( double ) ( - sc -> parent -> descent * pi -> scale + pi -> yoff ) ) ; fprintf ( pi -> out , "%g %g moveto %g %g lineto stroke\n" , ( double ) ( pi -> xoff + sc -> width * pi -> scale ) , ( double ) page . miny , ( double ) ( pi -> xoff + sc -> width * pi -> scale ) , ( double ) page . maxy ) ; fprintf ( pi -> out , "grestore\n" ) ; fprintf ( pi -> out , "gsave\n %g %g translate\n" , ( double ) pi -> xoff , ( double ) pi -> yoff ) ; fprintf ( pi -> out , " %g %g scale\n" , ( double ) pi -> scale , ( double ) pi -> scale ) ; SC_PSDump ( ( void ( * ) ( int , void * ) ) fputc , pi -> out , sc , true , false , ly_fore ) ; if ( sc -> parent -> multilayer ) { } if ( sc -> parent -> strokedfont ) { fprintf ( pi -> out , "%g setlinewidth stroke\n" , ( double ) sc -> parent -> strokewidth ) ; } else { fprintf ( pi -> out , "fill\n" ) ; } fprintf ( pi -> out , "grestore\n" ) ; } else { fprintf ( pi -> out , "q .2 w\n" ) ; fprintf ( pi -> out , "%g %g m %g %g l S\n" , ( double ) page . minx , ( double ) pi -> yoff , ( double ) page . maxx , ( double ) pi -> yoff ) ; fprintf ( pi -> out , "%g %g m %g %g l S\n" , ( double ) pi -> xoff , ( double ) page . miny , ( double ) pi -> xoff , ( double ) page . maxy ) ; fprintf ( pi -> out , "%g %g m %g %g l S\n" , ( double ) page . minx , ( double ) ( sc -> parent -> ascent * pi -> scale + pi -> yoff ) , ( double ) page . maxx , ( double ) ( sc -> parent -> ascent * pi -> scale + pi -> yoff ) ) ; fprintf ( pi -> out , "%g %g m %g %g l S\n" , ( double ) page . minx , ( double ) ( - sc -> parent -> descent * pi -> scale + pi -> yoff ) , ( double ) page . maxx , ( double ) ( - sc -> parent -> descent * pi -> scale + pi -> yoff ) ) ; fprintf ( pi -> out , "%g %g m %g %g l S\n" , ( double ) ( pi -> xoff + sc -> width * pi -> scale ) , ( double ) page . miny , ( double ) ( pi -> xoff + sc -> width * pi -> scale ) , ( double ) page . maxy ) ; fprintf ( pi -> out , "Q\n" ) ; fprintf ( pi -> out , "q \n %g 0 0 %g %g %g cm\n" , ( double ) pi -> scale , ( double ) pi -> scale , ( double ) pi -> xoff , ( double ) pi -> yoff ) ; SC_PSDump ( ( void ( * ) ( int , void * ) ) fputc , pi -> out , sc , true , true , ly_fore ) ; if ( sc -> parent -> multilayer ) { } if ( sc -> parent -> strokedfont ) { fprintf ( pi -> out , "%g w S\n" , ( double ) sc -> parent -> strokewidth ) ; } else { fprintf ( pi -> out , "f\n" ) ; } fprintf ( pi -> out , "Q\n" ) ; } } 