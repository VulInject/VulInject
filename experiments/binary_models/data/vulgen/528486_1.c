static void ixgbe_check_cs4227 ( struct ixgbe_hw * hw ) { s32 status = IXGBE_SUCCESS ; u32 swfw_mask = hw -> phy . phy_semaphore_mask ; u16 value ; u8 retry ; for ( retry = 0 ; retry < IXGBE_CS4227_RETRIES ; retry ++ ) { status = hw -> mac . ops . acquire_swfw_sync ( hw , swfw_mask ) ; if ( status != IXGBE_SUCCESS ) { ERROR_REPORT2 ( IXGBE_ERROR_CAUTION , "semaphore failed with %d" , status ) ; msec_delay ( IXGBE_CS4227_CHECK_DELAY ) ; continue ; } status = ixgbe_read_cs4227 ( hw , IXGBE_CS4227_SCRATCH , & value ) ; if ( status == IXGBE_SUCCESS && value == IXGBE_CS4227_RESET_COMPLETE ) { out } if ( status != IXGBE_SUCCESS || value != IXGBE_CS4227_RESET_PENDING ) { break ; } hw -> mac . ops . release_swfw_sync ( hw , swfw_mask ) ; msec_delay ( IXGBE_CS4227_CHECK_DELAY ) ; } if ( retry == IXGBE_CS4227_RETRIES ) { status = hw -> mac . ops . acquire_swfw_sync ( hw , swfw_mask ) ; if ( status != IXGBE_SUCCESS ) { ERROR_REPORT2 ( IXGBE_ERROR_CAUTION , "semaphore failed with %d" , status ) ; return ; } } status = ixgbe_reset_cs4227 ( hw ) ; if ( status != IXGBE_SUCCESS ) { ERROR_REPORT2 ( IXGBE_ERROR_INVALID_STATE , "CS4227 reset failed: %d" , status ) ; out } ixgbe_write_cs4227 ( hw , IXGBE_CS4227_SCRATCH , IXGBE_CS4227_RESET_PENDING ) ; hw -> mac . ops . release_swfw_sync ( hw , swfw_mask ) ; msec_delay ( 10 ) ; status = hw -> mac . ops . acquire_swfw_sync ( hw , swfw_mask ) ; if ( status != IXGBE_SUCCESS ) { ERROR_REPORT2 ( IXGBE_ERROR_CAUTION , "semaphore failed with %d" , status ) ; return ; } status = ixgbe_write_cs4227 ( hw , IXGBE_CS4227_SCRATCH , IXGBE_CS4227_RESET_COMPLETE ) ; out hw -> mac . ops . release_swfw_sync ( hw , swfw_mask ) ; msec_delay ( hw -> eeprom . semaphore_delay ) ; } 