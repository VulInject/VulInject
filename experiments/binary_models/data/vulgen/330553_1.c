static void oncore_msg_Cj_id ( struct instance * instance , u_char * buf , size_t len ) { char * cp2 , Model [ 21 ] ; const char * cp , * cp1 ; instance -> Cj [ 294 ] = '\0' ; for ( cp = ( char * ) instance -> Cj ; cp < ( char * ) & instance -> Cj [ 294 ] ; ) { char * cpw = strchr ( cp , '\r' ) ; if ( ! cpw ) { cpw = ( char * ) & instance -> Cj [ 294 ] ; } * cpw = '\0' ; oncore_log ( instance , LOG_NOTICE , cp ) ; * cpw = '\r' ; cp = cpw + 2 ; } instance -> version = atoi ( ( char * ) & instance -> Cj [ 83 ] ) ; instance -> revision = atoi ( ( char * ) & instance -> Cj [ 111 ] ) ; for ( cp = ( char * ) & instance -> Cj [ 160 ] ; * cp == ' ' ; cp ++ ) { } cp1 = cp ; cp2 = Model ; for ( ; cp ++ , cp2 ++ ) { * cp2 = * cp ; } * cp2 = '\0' ; cp = 0 ; if ( ! strncmp ( Model , "PVT6" , ( size_t ) 4 ) ) { cp = "PVT6" ; instance -> model = ONCORE_PVT6 ; } if ( Model [ 0 ] == 'A' ) { cp = "Basic" ; instance -> model = ONCORE_BASIC ; } if ( Model [ 0 ] == 'B' || ! strncmp ( Model , "T8" , ( size_t ) 2 ) ) { cp = "VP" ; instance -> model = ONCORE_VP ; } if ( Model [ 0 ] == 'P' ) { cp = "M12" ; instance -> model = ONCORE_M12 ; } if ( Model [ 0 ] == 'R' || Model [ 0 ] == 'D' || Model [ 0 ] == 'S' ) { if ( Model [ 5 ] == 'N' ) { cp = "GT" ; instance -> model = ONCORE_GT ; } if ( ( Model [ 1 ] == '3' || Model [ 1 ] == '4' ) && Model [ 5 ] == 'G' ) { cp = "GT+" ; instance -> model = ONCORE_GTPLUS ; } if ( ( Model [ 1 ] == '5' && Model [ 5 ] == 'U' ) || ( Model [ 1 ] == '1' && Model [ 5 ] == 'A' ) ) { cp = "UT" ; instance -> model = ONCORE_UT ; } if ( Model [ 1 ] == '5' && Model [ 5 ] == 'G' ) { cp = "UT+" ; instance -> model = ONCORE_UTPLUS ; } if ( Model [ 1 ] == '6' && Model [ 5 ] == 'G' ) { cp = "SL" ; instance -> model = ONCORE_SL ; } else { cp = "Unknown" ; instance -> model = ONCORE_UNKNOWN ; } } else { cp = "Unknown" ; instance -> model = ONCORE_UNKNOWN ; } oncore_log_f ( instance , LOG_INFO , "This looks like an Oncore %s with version %d.%d firmware." , cp , instance -> version , instance -> revision ) ; instance -> chan_id = 8 ; if ( instance -> model == ONCORE_BASIC || instance -> model == ONCORE_PVT6 ) { instance -> chan_id = 6 ; } if ( instance -> model == ONCORE_VP || instance -> model == ONCORE_UT || instance -> model == ONCORE_UTPLUS ) { instance -> chan_id = 8 ; } if ( instance -> model == ONCORE_M12 ) { instance -> chan_id = 12 ; } instance -> traim_id = 0 ; if ( instance -> model == ONCORE_BASIC || instance -> model == ONCORE_PVT6 ) { instance -> traim_id = 0 ; } if ( instance -> model == ONCORE_VP || instance -> model == ONCORE_UT || instance -> model == ONCORE_UTPLUS ) { instance -> traim_id = 1 ; } if ( instance -> model == ONCORE_M12 ) { instance -> traim_id = - 1 ; } oncore_log_f ( instance , LOG_INFO , "Channels = %d, TRAIM = %s" , instance -> chan_id , ( ( instance -> traim_id < 0 ) ?"UNKNOWN" : ( instance -> traim_id > 0 ) ?"ON" : "OFF" ) ) ; } 