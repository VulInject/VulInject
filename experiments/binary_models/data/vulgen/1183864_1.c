static unsigned int get_from_filesource ( isc_entropysource_t * source , isc_uint32_t desired ) { isc_entropy_t * ent = source -> ent ; unsigned char buf [ 128 ] ; int fd = source -> sources . file . handle ; ssize_t n , ndesired ; unsigned int added ; if ( source -> bad ) { return ( 0 ) ; } desired = desired / 8 + ( ( ( desired & 0x07 ) > 0 ) ?1 : 0 ) ; added = 0 ; while ( desired > 0 ) { ndesired = ISC_MIN ( desired , sizeof ( buf ) ) ; n = read ( fd , buf , ndesired ) ; if ( n < 0 ) { if ( errno == EAGAIN || errno == EINTR ) { out } err } if ( n == 0 ) { err } entropypool_adddata ( ent , buf , n , n * 8 ) ; added += n * 8 ; desired -= n ; } out err ( void ) close ( fd ) ; source -> sources . file . handle = - 1 ; out return ( added ) ; } 