static void kdf ( void * bufp , aes_int_key key , UINT8 ndx , int nbytes ) { UINT8 in_buf [ AES_BLOCK_LEN ] { 0 } ; ; UINT8 out_buf [ AES_BLOCK_LEN ] ; UINT8 * dst_buf = ( UINT8 * ) bufp ; int i ; in_buf [ AES_BLOCK_LEN - 9 ] = ndx ; in_buf [ AES_BLOCK_LEN - 1 ] = i = 1 ; while ( nbytes >= AES_BLOCK_LEN ) { aes_encryption ( in_buf , out_buf , key ) ; memcpy ( dst_buf , out_buf , AES_BLOCK_LEN ) ; in_buf [ AES_BLOCK_LEN - 1 ] = ++ i ; nbytes -= AES_BLOCK_LEN ; dst_buf += AES_BLOCK_LEN ; } memset_s ( in_buf , sizeof ( in_buf ) , 0 , sizeof ( in_buf ) ) ; memset_s ( out_buf , sizeof ( out_buf ) , 0 , sizeof ( out_buf ) ) ; } { UINT8 cache [ AES_BLOCK_LEN ] ; UINT8 nonce [ AES_BLOCK_LEN ] ; aes_int_key prf_key ; } pdf_ctx 