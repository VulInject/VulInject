static int fun_hwtstamp_set ( struct net_device * dev , struct ifreq * ifr ) { struct funeth_priv * fp = netdev_priv ( dev ) ; struct hwtstamp_config cfg ; if ( copy_from_user ( & cfg , ifr -> ifr_data , sizeof ( cfg ) ) ) { return - EFAULT ; } cfg . tx_type = HWTSTAMP_TX_OFF ; switch ( cfg . rx_filter ) { case HWTSTAMP_FILTER_NONE : break ; case HWTSTAMP_FILTER_ALL : case HWTSTAMP_FILTER_SOME : case HWTSTAMP_FILTER_PTP_V1_L4_EVENT : case HWTSTAMP_FILTER_PTP_V1_L4_SYNC : case HWTSTAMP_FILTER_PTP_V1_L4_DELAY_REQ : case HWTSTAMP_FILTER_PTP_V2_L4_EVENT : case HWTSTAMP_FILTER_PTP_V2_L4_SYNC : case HWTSTAMP_FILTER_PTP_V2_L4_DELAY_REQ : case HWTSTAMP_FILTER_PTP_V2_L2_EVENT : case HWTSTAMP_FILTER_PTP_V2_L2_SYNC : case HWTSTAMP_FILTER_PTP_V2_L2_DELAY_REQ : case HWTSTAMP_FILTER_PTP_V2_EVENT : case HWTSTAMP_FILTER_PTP_V2_SYNC : case HWTSTAMP_FILTER_PTP_V2_DELAY_REQ : case HWTSTAMP_FILTER_NTP_ALL : cfg . rx_filter = HWTSTAMP_FILTER_ALL ; break ; default : return - ERANGE ; } return copy_to_user ( ifr -> ifr_data , & cfg , sizeof ( cfg ) ) ?- EFAULT : 0 ; } 