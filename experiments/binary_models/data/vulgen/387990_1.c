ssize_t nal_hevc_write_pps ( const struct device * dev , void * dest , size_t n , struct nal_hevc_pps * pps ) { struct rbsp rbsp ; unsigned int forbidden_zero_bit = 0 ; unsigned int nal_unit_type = PPS_NUT ; unsigned int nuh_layer_id = 0 ; unsigned int nuh_temporal_id_plus1 = 1 ; rbsp_init ( & rbsp , dest , n , & write ) ; nal_hevc_write_start_code_prefix ( & rbsp ) ; rbsp_bit ( & rbsp , & forbidden_zero_bit ) ; rbsp_bits ( & rbsp , 6 , & nal_unit_type ) ; rbsp_bits ( & rbsp , 6 , & nuh_layer_id ) ; rbsp_bits ( & rbsp , 3 , & nuh_temporal_id_plus1 ) ; nal_hevc_rbsp_pps ( & rbsp , pps ) ; rbsp_trailing_bits ( & rbsp ) ; if ( rbsp . error ) { return rbsp . error ; } return DIV_ROUND_UP ( rbsp . pos , 8 ) ; } 