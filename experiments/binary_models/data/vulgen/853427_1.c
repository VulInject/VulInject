int qedr_alloc_pd ( struct ib_pd * ibpd , struct ib_udata * udata ) { struct ib_device * ibdev = ibpd -> device ; struct qedr_dev * dev = get_qedr_dev ( ibdev ) ; struct qedr_pd * pd = get_qedr_pd ( ibpd ) ; u16 pd_id ; int rc ; DP_DEBUG ( dev , QEDR_MSG_INIT , "Function called from: %s\n" , udata ?"User Lib" : "Kernel" ) ; if ( ! dev -> rdma_ctx ) { DP_ERR ( dev , "invalid RDMA context\n" ) ; return - EINVAL ; } rc = dev -> ops -> rdma_alloc_pd ( dev -> rdma_ctx , & pd_id ) ; if ( rc ) { return rc ; } pd -> pd_id = pd_id ; if ( udata ) { struct qedr_alloc_pd_uresp uresp = { . pd_id = pd_id } ; struct qedr_ucontext * context = rdma_udata_to_drv_context ( udata , qedr_ucontext , ibucontext ) ; rc = qedr_ib_copy_to_udata ( udata , & uresp , sizeof ( uresp ) ) ; if ( rc ) { DP_ERR ( dev , "copy error pd_id=0x%x.\n" , pd_id ) ; return rc ; } pd -> uctx = context ; pd -> uctx -> pd = pd ; } return 0 ; } 