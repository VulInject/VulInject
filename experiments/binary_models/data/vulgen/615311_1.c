void kvm_pc_setup_irq_routing ( bool pci_enabled ) { KVMState * s = kvm_state ; int i ; assert ( kvm_has_gsi_routing ( ) ) ; for ( i = 0 ; i < 8 ; ++ i ) { if ( i == 2 ) { continue ; } kvm_irqchip_add_irq_route ( s , i , KVM_IRQCHIP_PIC_MASTER , i ) ; } for ( i = 8 ; i < 16 ; ++ i ) { kvm_irqchip_add_irq_route ( s , i , KVM_IRQCHIP_PIC_SLAVE , i - 8 ) ; } if ( pci_enabled ) { for ( i = 0 ; i < 24 ; ++ i ) { if ( i == 0 ) { kvm_irqchip_add_irq_route ( s , i , KVM_IRQCHIP_IOAPIC , 2 ) ; } if ( i != 2 ) { kvm_irqchip_add_irq_route ( s , i , KVM_IRQCHIP_IOAPIC , i ) ; } } } } struct KVMIOAPICState KVMIOAPICState KVMIOAPICState { IOAPICCommonState ioapic ; uint32_t kvm_gsi_base ; } 