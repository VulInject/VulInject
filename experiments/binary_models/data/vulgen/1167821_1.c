void quicly_ratemeter_on_ack ( quicly_ratemeter_t * meter , int64_t now , uint64_t bytes_acked , uint64_t pn ) { if ( meter -> pn_cwnd_limited . start <= pn && pn < meter -> pn_cwnd_limited . end ) { if ( meter -> current . start . at == INT64_MAX ) { start_sampling ( meter , now , bytes_acked ) ; } else { meter -> current . sample = ( st_quicly_rate_sample_t ) { . elapsed = ( uint32_t ) ( now - meter -> current . start . at ) . bytes_acked = ( uint32_t ) ( bytes_acked - meter -> current . start . bytes_acked ) } ; if ( meter -> current . sample . elapsed >= QUICLY_DELIVERY_RATE_SAMPLE_PERIOD ) { start_sampling ( meter , now , bytes_acked ) ; } } } if ( meter -> pn_cwnd_limited . end <= pn ) { if ( meter -> current . start . at != INT64_MAX ) { if ( meter -> current . sample . elapsed != 0 ) { commit_sample ( meter ) ; } meter -> pn_cwnd_limited = ( quicly_range_t ) { . start = UINT64_MAX . end = UINT64_MAX } ; meter -> current . start . at = INT64_MAX ; } } } 