static void virtio_blk_register_nodes ( void ) { char * arg = g_strdup_printf ( "id=drv0,drive=drive0,addr=%x.%x" , PCI_SLOT , PCI_FN ) ; QPCIAddress addr = { . devfn = QPCI_DEVFN ( PCI_SLOT , PCI_FN ) } ; QOSGraphEdgeOptions opts = { } ; opts . extra_device_opts = "drive=drive0" ; qos_node_create_driver ( "virtio-blk-device" , virtio_blk_device_create ) ; qos_node_consumes ( "virtio-blk-device" , "virtio-bus" , & opts ) ; qos_node_produces ( "virtio-blk-device" , "virtio-blk" ) ; opts . extra_device_opts = arg ; add_qpci_address ( & opts , & addr ) ; qos_node_create_driver ( "virtio-blk-pci" , virtio_blk_pci_create ) ; qos_node_consumes ( "virtio-blk-pci" , "pci-bus" , & opts ) ; qos_node_produces ( "virtio-blk-pci" , "virtio-blk" ) ; } 