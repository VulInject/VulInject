int32_t ixgbe_setup_fc_X550em ( struct ixgbe_hw * hw ) { int32_t ret_val = IXGBE_SUCCESS ; uint32_t pause , asm_dir , reg_val ; DEBUGFUNC ( "ixgbe_setup_fc_X550em" ) ; if ( hw -> fc . strict_ieee && hw -> fc . requested_mode == ixgbe_fc_rx_pause ) { ERROR_REPORT1 ( IXGBE_ERROR_UNSUPPORTED , "ixgbe_fc_rx_pause not valid in strict IEEE mode\n" ) ; ret_val = IXGBE_ERR_INVALID_LINK_SETTINGS ; out } if ( hw -> fc . requested_mode == ixgbe_fc_default ) { hw -> fc . requested_mode = ixgbe_fc_full ; } switch ( hw -> fc . requested_mode ) { case ixgbe_fc_none : pause = 0 ; asm_dir = 0 ; break ; case ixgbe_fc_tx_pause : pause = 0 ; asm_dir = 1 ; break ; case ixgbe_fc_rx_pause : case ixgbe_fc_full : pause = 1 ; asm_dir = 1 ; break ; default : ERROR_REPORT1 ( IXGBE_ERROR_ARGUMENT , "Flow control param set incorrectly\n" ) ; ret_val = IXGBE_ERR_CONFIG ; out } switch ( hw -> device_id ) { case IXGBE_DEV_ID_X550EM_X_KR : case IXGBE_DEV_ID_X550EM_A_KR : case IXGBE_DEV_ID_X550EM_A_KR_L : ret_val = hw -> mac . ops . read_iosf_sb_reg ( hw , IXGBE_KRM_AN_CNTL_1 ( hw -> bus . lan_id ) , IXGBE_SB_IOSF_TARGET_KR_PHY , & reg_val ) ; reg_val &= ~ ( IXGBE_KRM_AN_CNTL_1_SYM_PAUSE | IXGBE_KRM_AN_CNTL_1_ASM_PAUSE ) ; if ( pause ) { reg_val |= IXGBE_KRM_AN_CNTL_1_SYM_PAUSE ; } if ( asm_dir ) { reg_val |= IXGBE_KRM_AN_CNTL_1_ASM_PAUSE ; } ret_val = hw -> mac . ops . write_iosf_sb_reg ( hw , IXGBE_KRM_AN_CNTL_1 ( hw -> bus . lan_id ) , IXGBE_SB_IOSF_TARGET_KR_PHY , reg_val ) ; hw -> fc . disable_fc_autoneg = TRUE ; break ; case IXGBE_DEV_ID_X550EM_X_XFI : hw -> fc . disable_fc_autoneg = TRUE ; break ; default : break ; } out return ret_val ; } 