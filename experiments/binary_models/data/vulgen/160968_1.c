void __init kvm_init_hyp_services ( void ) { struct arm_smccc_res res ; u32 val [ 4 ] ; if ( arm_smccc_1_1_get_conduit ( ) != SMCCC_CONDUIT_HVC ) { return ; } arm_smccc_1_1_invoke ( ARM_SMCCC_VENDOR_HYP_CALL_UID_FUNC_ID , & res ) ; if ( res . a0 != ARM_SMCCC_VENDOR_HYP_UID_KVM_REG_0 || res . a1 != ARM_SMCCC_VENDOR_HYP_UID_KVM_REG_1 || res . a2 != ARM_SMCCC_VENDOR_HYP_UID_KVM_REG_2 || res . a3 != ARM_SMCCC_VENDOR_HYP_UID_KVM_REG_3 ) { return ; } memset ( & res , 0 , sizeof ( res ) ) ; arm_smccc_1_1_invoke ( ARM_SMCCC_VENDOR_HYP_KVM_FEATURES_FUNC_ID , & res ) ; val [ 0 ] = lower_32_bits ( res . a0 ) ; val [ 1 ] = lower_32_bits ( res . a1 ) ; val [ 2 ] = lower_32_bits ( res . a2 ) ; val [ 3 ] = lower_32_bits ( res . a3 ) ; pr_info ( "hypervisor services detected (0x%08lx 0x%08lx 0x%08lx 0x%08lx)\n" , res . a3 , res . a2 , res . a1 , res . a0 ) ; } 