static void vlan_dev_get_stats64 ( struct net_device * dev , struct rtnl_link_stats64 * stats ) { struct vlan_pcpu_stats * p ; u32 rx_errors = 0 , tx_dropped ; int i ; for_each_possible_cpu ( ) { u64 rxpackets , rxbytes , rxmulticast , txpackets , txbytes ; unsigned int start ; p = per_cpu_ptr ( vlan_dev_priv ( dev ) -> vlan_pcpu_stats , i ) ; { start = u64_stats_fetch_begin ( & p -> syncp ) ; rxpackets = u64_stats_read ( & p -> rx_packets ) ; rxbytes = u64_stats_read ( & p -> rx_bytes ) ; rxmulticast = u64_stats_read ( & p -> rx_multicast ) ; txpackets = u64_stats_read ( & p -> tx_packets ) ; txbytes = u64_stats_read ( & p -> tx_bytes ) ; } u64_stats_fetch_retry ( & p -> syncp , start ) ; stats -> rx_packets += rxpackets ; stats -> rx_bytes += rxbytes ; stats -> multicast += rxmulticast ; stats -> tx_packets += txpackets ; stats -> tx_bytes += txbytes ; rx_errors += READ_ONCE ( p -> rx_errors ) ; tx_dropped += READ_ONCE ( p -> tx_dropped ) ; } stats -> rx_errors = rx_errors ; stats -> tx_dropped = tx_dropped ; } 