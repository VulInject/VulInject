static struct db_cursor * launch_query ( queryopt * opt , __attribute__ ( ) select_doc * s_doc , query_doc * qu_doc , db_collection * db_coll ) ( db_cursor * out , const bson_t * opts = BCON_NEW ( "skip" , BCON_INT32 ( opt -> e_skip ) , "limit" , BCON_INT32 ( opt -> e_ret ) ) , out = malloc ( sizeof ( db_cursor ) ) , ( ! out ) { perror ( "mongo_sync_cmd_query()" ) printf ( "malloc failed\n" ) exit ( 1 ) } out -> cursor = mongoc_collection_find_with_opts ( db_coll -> collection , qu_doc -> query , opts , NULL ) , out -> cursor = mongoc_collection_find ( db_coll -> collection , MONGOC_QUERY_NONE , ( uint32_t ) opt -> e_skip , ( uint32_t ) opt -> e_ret , 0 , qu_doc -> query , s_doc -> select ) , ( ! out -> cursor ) { perror ( "mongo_sync_cmd_query()" ) printf ( "no records found\n" ) exit ( 1 ) } return out ; ) ; 