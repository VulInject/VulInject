static size_t audio_pcm_hw_run_out ( HWVoiceOut * hw , size_t live ) { size_t clipped = 0 ; while ( live ) { size_t size = live * hw -> info . bytes_per_frame ; size_t decr , proc ; void * buf = hw -> pcm_ops -> get_buffer_out ( hw , & size ) ; decr = MIN ( size / hw -> info . bytes_per_frame , live ) ; if ( buf ) { audio_pcm_hw_clip_out ( hw , buf , decr ) ; } proc = hw -> pcm_ops -> put_buffer_out ( hw , buf , decr * hw -> info . bytes_per_frame ) / hw -> info . bytes_per_frame ; live -= proc ; clipped += proc ; hw -> mix_buf -> pos = ( hw -> mix_buf -> pos + proc ) % hw -> mix_buf -> size ; if ( proc == 0 || proc < decr ) { break ; } } if ( hw -> pcm_ops -> run_buffer_out ) { hw -> pcm_ops -> run_buffer_out ( hw ) ; } return clipped ; } 