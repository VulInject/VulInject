static void bnx2x_vf_mbx_update_rss ( struct bnx2x * bp , struct bnx2x_virtf * vf , struct bnx2x_vf_mbx * mbx ) { struct bnx2x_config_rss_params rss ; struct vfpf_rss_tlv * rss_tlv = & mbx -> msg -> req . update_rss ; int rc = 0 ; if ( rss_tlv -> ind_table_size != T_ETH_INDIRECTION_TABLE_SIZE || rss_tlv -> rss_key_size != T_ETH_RSS_KEY ) { BNX2X_ERR ( "failing rss configuration of vf %d due to size mismatch\n" , vf -> index ) ; rc = - EINVAL ; mbx_resp } memset ( & rss , 0 , sizeof ( bnx2x_config_rss_params ) ) ; memcpy ( rss . ind_table , rss_tlv -> ind_table , T_ETH_INDIRECTION_TABLE_SIZE ) ; memcpy ( rss . rss_key , rss_tlv -> rss_key , sizeof ( rss_tlv -> rss_key ) ) ; rss . rss_obj = & vf -> rss_conf_obj ; rss . rss_result_mask = rss_tlv -> rss_result_mask ; rss . rss_flags = 0 ; rss . ramrod_flags = 0 ; if ( rss_tlv -> rss_flags & VFPF_RSS_MODE_DISABLED ) { __set_bit ( BNX2X_RSS_MODE_DISABLED , & rss . rss_flags ) ; } if ( rss_tlv -> rss_flags & VFPF_RSS_MODE_REGULAR ) { __set_bit ( BNX2X_RSS_MODE_REGULAR , & rss . rss_flags ) ; } if ( rss_tlv -> rss_flags & VFPF_RSS_SET_SRCH ) { __set_bit ( BNX2X_RSS_SET_SRCH , & rss . rss_flags ) ; } if ( rss_tlv -> rss_flags & VFPF_RSS_IPV4 ) { __set_bit ( BNX2X_RSS_IPV4 , & rss . rss_flags ) ; } if ( rss_tlv -> rss_flags & VFPF_RSS_IPV4_TCP ) { __set_bit ( BNX2X_RSS_IPV4_TCP , & rss . rss_flags ) ; } if ( rss_tlv -> rss_flags & VFPF_RSS_IPV4_UDP ) { __set_bit ( BNX2X_RSS_IPV4_UDP , & rss . rss_flags ) ; } if ( rss_tlv -> rss_flags & VFPF_RSS_IPV6 ) { __set_bit ( BNX2X_RSS_IPV6 , & rss . rss_flags ) ; } if ( rss_tlv -> rss_flags & VFPF_RSS_IPV6_TCP ) { __set_bit ( BNX2X_RSS_IPV6_TCP , & rss . rss_flags ) ; } if ( ( ! ( rss_tlv -> rss_flags & VFPF_RSS_IPV4_TCP ) && rss_tlv -> rss_flags & VFPF_RSS_IPV4_UDP ) || ( ! ( rss_tlv -> rss_flags & VFPF_RSS_IPV6_TCP ) && rss_tlv -> rss_flags & VFPF_RSS_IPV6_UDP ) ) { BNX2X_ERR ( "about to hit a FW assert. aborting...\n" ) ; rc = - EINVAL ; mbx_resp } rc = bnx2x_vf_rss_update ( bp , vf , & rss ) ; mbx_resp bnx2x_vf_mbx_resp ( bp , vf , rc ) ; } 