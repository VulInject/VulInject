int io_symlinkat_prep ( struct io_kiocb * req , const struct io_uring_sqe * sqe ) { struct io_link * sl = io_kiocb_to_cmd ( req , io_link ) ; const char __user * oldpath , * newpath ; if ( sqe -> len || sqe -> rw_flags || sqe -> buf_index || sqe -> splice_fd_in ) { return - EINVAL ; } sl -> new_dfd = READ_ONCE ( sqe -> fd ) ; oldpath = u64_to_user_ptr ( READ_ONCE ( sqe -> addr ) ) ; newpath = u64_to_user_ptr ( READ_ONCE ( sqe -> addr2 ) ) ; sl -> oldpath = getname ( oldpath ) ; if ( IS_ERR ( sl -> oldpath ) ) { return PTR_ERR ( sl -> oldpath ) ; } sl -> newpath = getname ( newpath ) ; if ( IS_ERR ( sl -> newpath ) ) { putname ( sl -> oldpath ) ; return PTR_ERR ( sl -> newpath ) ; } req -> flags |= REQ_F_NEED_CLEANUP ; req -> flags |= REQ_F_FORCE_ASYNC ; return 0 ; } 