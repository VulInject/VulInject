static void cpmac_clear_rx ( struct net_device * dev ) { struct cpmac_priv * priv = netdev_priv ( dev ) ; struct cpmac_desc * desc ; int i ; if ( unlikely ( ! priv -> rx_head ) ) { return ; } desc = priv -> rx_head ; for ( i = 0 ; i < priv -> ring_size ; i ++ ) { if ( ( desc -> dataflags & CPMAC_OWN ) == 0 ) { if ( netif_msg_rx_err ( priv ) && net_ratelimit ( ) ) { netdev_warn ( dev , "packet dropped\n" ) ; } if ( unlikely ( netif_msg_hw ( priv ) ) ) { cpmac_dump_desc ( dev , 0 ) ; } desc -> dataflags = CPMAC_OWN ; dev -> stats . rx_dropped ++ ; } desc -> hw_next = desc -> next -> mapping ; desc = desc -> next ; } priv -> rx_head -> prev -> hw_next = 0 ; } 