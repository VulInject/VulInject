static int mir_open ( queue_t * q , dev_t * devp , int flag , int sflag , cred_t * credp ) { mir_t * mir ; RPCLOG ( 32 , "rpcmod: mir_open of q 0x%p\n" , ( void * ) q ) ; if ( ! mir_start ) { mir_start = mir_svc_start ; } if ( ! clnt_stop_idle ) { clnt_stop_idle = mir_clnt_idle_do_stop ; } if ( ! clnt_max_msg_sizep ) { clnt_max_msg_sizep = & clnt_max_msg_size ; } if ( ! svc_max_msg_sizep ) { svc_max_msg_sizep = & svc_max_msg_size ; } mir = kmem_zalloc ( sizeof ( mir_t ) , KM_SLEEP ) ; mir -> mir_hold_inbound = 1 ; mir -> mir_frag_len = - ( int32_t ) sizeof ( uint32_t ) ; mir -> mir_zoneid = rpc_zoneid ( ) ; cv_init ( & mir -> mir_condvar , NULL , CV_DRIVER , NULL ) ; cv_init ( & mir -> mir_timer_cv , NULL , CV_DRIVER , NULL ) ; q -> q_ptr = ( char * ) mir ; WR ( q ) -> q_ptr = ( char * ) mir ; noenable ( q ) ; qprocson ( q ) ; return ( 0 ) ; } 