struct iscsi_portal_group * iscsit_alloc_portal_group ( struct iscsi_tiqn * tiqn , u16 tpgt ) { struct iscsi_portal_group * tpg ; tpg = kzalloc ( sizeof ( iscsi_portal_group ) , GFP_KERNEL ) ; if ( ! tpg ) { pr_err ( "Unable to allocate struct iscsi_portal_group\n" ) ; return NULL ; } tpg -> tpgt = tpgt ; tpg -> tpg_state = TPG_STATE_FREE ; tpg -> tpg_tiqn = tiqn ; INIT_LIST_HEAD ( & tpg -> tpg_gnp_list ) ; INIT_LIST_HEAD ( & tpg -> tpg_list ) ; sema_init ( & tpg -> np_login_sem , 1 ) ; spin_lock_init ( & tpg -> tpg_state_lock ) ; spin_lock_init ( & tpg -> tpg_np_lock ) ; return tpg ; } 