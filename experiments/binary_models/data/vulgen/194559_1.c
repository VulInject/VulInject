ht_lookup ( , , , ) hash_table * table ; const unsigned char * str ; unsigned int len ; enum ht_lookup_option insert ; { unsigned int hash = calc_hash ( str , len ) ; unsigned int hash2 ; unsigned int index ; size_t sizemask ; hashnode node ; sizemask = table -> nslots - 1 ; index = hash & sizemask ; hash2 = ( ( hash * 17 ) & sizemask ) | 1 ; table -> searches ++ ; for ( ; ; ) { node = table -> entries [ index ] ; if ( node == NULL ) { break ; } if ( node -> hash_value == hash && HT_LEN ( node ) == len && ! memcmp ( HT_STR ( node ) , str , len ) ) { if ( insert == HT_ALLOCED ) { obstack_free ( & table -> stack , ( PTR ) str ) ; } return node ; } index = ( index + hash2 ) & sizemask ; table -> collisions ++ ; } if ( insert == HT_NO_INSERT ) { return NULL ; } node = * table -> alloc_node ( table ) ; table -> entries [ index ] = node ; HT_LEN ( node ) = len ; node -> hash_value = hash ; if ( insert == HT_ALLOC ) { HT_STR ( node ) = obstack_copy0 ( & table -> stack , str , len ) ; } else { HT_STR ( node ) = str ; } return node ; } 