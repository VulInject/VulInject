static int netstat_udp_internal ( value_list_t * vl ) { uint64_t udpstat [ UDP_NSTATS ] ; uint64_t udp6stat [ UDP6_NSTATS ] ; size_t size ; uint64_t delivered , delivered6 ; int err ; size = sizeof ( udpstat ) ; if ( sysctlbyname ( "net.inet.udp.stats" , udpstat , & size , NULL , 0 ) == - 1 ) { ERROR ( "netstat-udp plugin: could not get udp stats" ) ; return - 1 ; } delivered = udpstat [ UDP_STAT_IPACKETS ] - udpstat [ UDP_STAT_HDROPS ] - udpstat [ UDP_STAT_BADLEN ] - udpstat [ UDP_STAT_BADSUM ] - udpstat [ UDP_STAT_NOPORT ] - udpstat [ UDP_STAT_NOPORTBCAST ] - udpstat [ UDP_STAT_FULLSOCK ] ; err = SUBMIT_VARS ( "udp-received" , ( derive_t ) udpstat [ UDP_STAT_IPACKETS ] , "udp-bad-header" , ( derive_t ) udpstat [ UDP_STAT_HDROPS ] , "udp-bad-length" , ( derive_t ) udpstat [ UDP_STAT_BADLEN ] , "udp-bad-checksum" , ( derive_t ) udpstat [ UDP_STAT_BADSUM ] , "udp-no-port" , ( derive_t ) udpstat [ UDP_STAT_NOPORT ] , "udp-no-port-broadcast" , ( derive_t ) udpstat [ UDP_STAT_NOPORTBCAST ] , "udp-full-socket" , ( derive_t ) udpstat [ UDP_STAT_FULLSOCK ] , "udp-delivered" , ( derive_t ) delivered ) ; if ( err != 0 ) { ERROR ( "netstat-udp plugin: could not submit, err=%d\n" , err ) ; } size = sizeof ( udp6stat ) ; if ( sysctlbyname ( "net.inet6.udp6.stats" , udp6stat , & size , NULL , 0 ) == - 1 ) { ERROR ( "netstat-udp plugin: could not get udp6 stats" ) ; return - 1 ; } delivered6 = udp6stat [ UDP6_STAT_IPACKETS ] - udp6stat [ UDP6_STAT_HDROPS ] - udp6stat [ UDP6_STAT_BADLEN ] - udp6stat [ UDP6_STAT_BADSUM ] - udp6stat [ UDP6_STAT_NOSUM ] - udp6stat [ UDP6_STAT_NOPORT ] - udp6stat [ UDP6_STAT_NOPORTMCAST ] - udp6stat [ UDP6_STAT_FULLSOCK ] ; err = SUBMIT_VARS ( "udp6-received" , ( derive_t ) udp6stat [ UDP6_STAT_IPACKETS ] , "udp6-bad-header" , ( derive_t ) udp6stat [ UDP6_STAT_HDROPS ] , "udp6-bad-length" , ( derive_t ) udp6stat [ UDP6_STAT_BADLEN ] , "udp6-bad-checksum" , ( derive_t ) udp6stat [ UDP6_STAT_BADSUM ] , "udp6-no-checksum" , ( derive_t ) udp6stat [ UDP6_STAT_NOSUM ] , "udp6-no-port" , ( derive_t ) udp6stat [ UDP6_STAT_NOPORT ] , "udp6-no-port-multicast" , ( derive_t ) udp6stat [ UDP6_STAT_NOPORTMCAST ] , "udp6-full-socket" , ( derive_t ) udp6stat [ UDP6_STAT_FULLSOCK ] , "udp6-delivered" , ( derive_t ) delivered6 ) ; return ( 0 ) ; } 