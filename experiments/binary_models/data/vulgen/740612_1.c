( reuseport_alloc ) ; static struct sock_reuseport * reuseport_grow ( struct sock_reuseport * reuse ) { struct sock_reuseport * more_reuse ; u32 more_socks_size , i ; more_socks_size = reuse -> max_socks * 2U ; more_reuse = __reuseport_alloc ( more_socks_size ) ; if ( ! more_reuse ) { return NULL ; } more_reuse -> max_socks = more_socks_size ; more_reuse -> num_socks = reuse -> num_socks ; more_reuse -> prog = reuse -> prog ; memcpy ( more_reuse -> socks , reuse -> socks , reuse -> num_socks * sizeof ( sock * ) ) ; for ( i = 0 ; i < reuse -> num_socks ; ++ i ) { rcu_assign_pointer ( reuse -> socks [ i ] -> sk_reuseport_cb , more_reuse ) ; } kfree_rcu ( reuse , rcu ) ; return more_reuse ; } 