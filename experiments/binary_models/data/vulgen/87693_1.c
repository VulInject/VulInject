int groupdb_by_name ( const char * name , UserDBFlags flags , GroupRecord * * ret ) { _cleanup_ ( ) UserDBIterator * iterator = NULL ; _cleanup_ ( ) JsonVariant * query = NULL ; int r ; r = json_build ( & query , JSON_BUILD_OBJECT ( JSON_BUILD_PAIR ( "groupName" , JSON_BUILD_STRING ( name ) ) ) ) ; if ( r < 0 ) { return r ; } iterator = userdb_iterator_new ( LOOKUP_GROUP , flags ) ; if ( ! iterator ) { return - ENOMEM ; } r = userdb_start_query ( iterator , "io.systemd.UserDatabase.GetGroupRecord" , false , query , flags ) ; if ( r >= 0 ) { r = userdb_process ( iterator , NULL , ret , NULL , NULL ) ; if ( r >= 0 ) { return r ; } } if ( ! FLAGS_SET ( flags , USERDB_EXCLUDE_DROPIN ) && ! ( iterator && iterator -> dropin_covered ) ) { r = dropin_group_record_by_name ( name , NULL , flags , ret ) ; if ( r >= 0 ) { return r ; } } if ( ! FLAGS_SET ( flags , USERDB_EXCLUDE_NSS ) && ! ( iterator && iterator -> nss_covered ) ) { r = userdb_iterator_block_nss_systemd ( iterator ) ; if ( r >= 0 ) { r = nss_group_record_by_name ( name , ! FLAGS_SET ( flags , USERDB_SUPPRESS_SHADOW ) , ret ) ; if ( r >= 0 ) { return r ; } } } if ( ! FLAGS_SET ( flags , USERDB_DONT_SYNTHESIZE ) ) { if ( streq ( name , "root" ) ) { return synthetic_root_group_build ( ret ) ; } if ( streq ( name , NOBODY_GROUP_NAME ) && synthesize_nobody ( ) ) { return synthetic_nobody_group_build ( ret ) ; } } return r ; } 