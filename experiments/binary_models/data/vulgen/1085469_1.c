int da_rm_list_entry ( devlist_t * dlist , char * link , int type , char * devname ) { int retval = 0 ; deventry_t * * dentry , * current , * prev ; switch ( type ) { case DA_AUDIO : dentry = & ( dlist -> audio ) ; break ; case DA_CD : dentry = & ( dlist -> cd ) ; break ; case DA_FLOPPY : dentry = & ( dlist -> floppy ) ; break ; case DA_TAPE : dentry = & ( dlist -> tape ) ; break ; case DA_RMDISK : dentry = & ( dlist -> rmdisk ) ; break ; default : return ( - 1 ) ; } if ( * dentry == ( deventry_t * ) NULL ) { return ( 0 ) ; } prev = NULL ; for ( current = * dentry ; current != NULL ; prev = current , current = current -> next ) { if ( strcmp ( devname , current -> devinfo . devname ) ) { continue ; } retval = 1 ; break ; } if ( retval == 0 ) { return ( 0 ) ; } free ( current -> devinfo . devname ) ; if ( current -> devinfo . devlist != NULL ) { free ( current -> devinfo . devlist ) ; } if ( prev == NULL ) { * dentry = current -> next ; } else { prev -> next = current -> next ; } free ( current ) ; return ( retval ) ; } 