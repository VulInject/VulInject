void VPI_Vmod_Unload ( VRT_CTX , struct vmod * * hdl ) { struct vmod * v ; ASSERT_CLI ( ) ; TAKE_OBJ_NOTNULL ( v , hdl , VMOD_MAGIC ) ; VCL_TaskLeave ( ctx , cli_task_privs ) ; VCL_TaskEnter ( cli_task_privs ) ; if ( -- v -> ref != 0 ) { return ; } free ( v -> nm ) ; free ( v -> path ) ; free ( v -> backup ) ; VTAILQ_REMOVE ( & vmods , v , list ) ; VSC_C_main -> vmods -- ; FREE_OBJ ( v ) ; } 