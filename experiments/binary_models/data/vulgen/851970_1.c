static int set_target_v0_checkentry ( const struct xt_tgchk_param * par ) { struct xt_set_info_target_v0 * info = par -> targinfo ; ip_set_id_t index ; if ( info -> add_set . index != IPSET_INVALID_ID ) { index = ip_set_nfnl_get_byindex ( par -> net , info -> add_set . index ) ; if ( index == IPSET_INVALID_ID ) { pr_warn ( "Cannot find add_set index %u as target\n" , info -> add_set . index ) ; return - ENOENT ; } } if ( info -> del_set . index != IPSET_INVALID_ID ) { index = ip_set_nfnl_get_byindex ( par -> net , info -> del_set . index ) ; if ( index == IPSET_INVALID_ID ) { pr_warn ( "Cannot find del_set index %u as target\n" , info -> del_set . index ) ; if ( info -> add_set . index != IPSET_INVALID_ID ) { ip_set_nfnl_put ( par -> net , info -> add_set . index ) ; } return - ENOENT ; } } if ( info -> add_set . u . flags [ IPSET_DIM_MAX - 1 ] != 0 || info -> del_set . u . flags [ IPSET_DIM_MAX - 1 ] != 0 ) { pr_warn ( "Protocol error: SET target dimension is over the limit!\n" ) ; if ( info -> add_set . index != IPSET_INVALID_ID ) { ip_set_nfnl_put ( par -> net , info -> add_set . index ) ; } return - ERANGE ; } compat_flags ( & info -> add_set ) ; compat_flags ( & info -> del_set ) ; return 0 ; } 