static __init unsigned int sead3_measure_hpt_freq ( void ) { void __iomem * status_reg = ( void __iomem * ) 0xbf000410 ; unsigned int freq , orig , tick = 0 ; unsigned long flags ; local_irq_save ( flags ) ; orig = readl ( status_reg ) & 0x2 ; while ( ( readl ( status_reg ) & 0x2 ) == orig ) { } orig = orig ^ 0x2 ; write_c0_count ( 0 ) ; while ( tick < 100 ) { while ( ( readl ( status_reg ) & 0x2 ) == orig ) { } orig = orig ^ 0x2 ; tick ++ ; } local_irq_restore ( flags ) ; return freq ; } 