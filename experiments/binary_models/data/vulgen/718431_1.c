add_global_decls ( , ) const file_info * file_p ; const char * clean_text_p ; { const def_dec_info * dd_p ; const char * scan_p ; save_pointers ( ) ; if ( setjmp ( source_confusion_recovery ) ) { restore_pointers ( ) ; notice ( "%s: global declarations for file `%s' not inserted\n" , pname , shortpath ( NULL , file_p -> hash_entry -> symbol ) ) ; return ; } scan_p = find_rightmost_formals_list ( clean_text_p ) ; for ( ; ; -- scan_p ) { if ( scan_p < clean_text_base ) { break ; } if ( * scan_p == ';' ) { break ; } } scan_p ++ ; while ( ISSPACE ( ( const unsigned char ) * scan_p ) ) { scan_p ++ ; } scan_p -- ; output_up_to ( scan_p ) ; { int some_decls_added = 0 ; for ( dd_p = file_p -> defs_decs ; dd_p ; dd_p = dd_p -> next_in_file ) { if ( dd_p -> is_implicit && dd_p -> definition && ! dd_p -> definition -> written ) { const char * decl = dd_p -> definition -> ansi_decl ; if ( * decl == 'e' && ( dd_p -> file == dd_p -> definition -> file ) ) { decl += 7 ; } output_string ( "\n" ) ; output_string ( decl ) ; some_decls_added = 1 ; ( ( NONCONST def_dec_info * ) dd_p -> definition ) -> written = 1 ; } } if ( some_decls_added ) { output_string ( "\n\n" ) ; } } for ( dd_p = file_p -> defs_decs ; dd_p ; dd_p = dd_p -> next_in_file ) { if ( dd_p -> definition ) { ( ( NONCONST def_dec_info * ) dd_p -> definition ) -> written = 0 ; } } } 