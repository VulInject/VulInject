static int dnode_cons ( void * arg , void * unused , int kmflag ) { dnode_t * dn = arg ; int i ; rw_init ( & dn -> dn_struct_rwlock , NULL , RW_DEFAULT , NULL ) ; mutex_init ( & dn -> dn_mtx , NULL , MUTEX_DEFAULT , NULL ) ; mutex_init ( & dn -> dn_dbufs_mtx , NULL , MUTEX_DEFAULT , NULL ) ; cv_init ( & dn -> dn_notxholds , NULL , CV_DEFAULT , NULL ) ; cv_init ( & dn -> dn_nodnholds , NULL , CV_DEFAULT , NULL ) ; zfs_refcount_create_untracked ( & dn -> dn_holds ) ; zfs_refcount_create ( & dn -> dn_tx_holds ) ; list_link_init ( & dn -> dn_link ) ; bzero ( & dn -> dn_next_nblkptr [ 0 ] , sizeof ( dn -> dn_next_nblkptr ) ) ; bzero ( & dn -> dn_next_nlevels [ 0 ] , sizeof ( dn -> dn_next_nlevels ) ) ; bzero ( & dn -> dn_next_indblkshift [ 0 ] , sizeof ( dn -> dn_next_indblkshift ) ) ; bzero ( & dn -> dn_next_bonustype [ 0 ] , sizeof ( dn -> dn_next_bonustype ) ) ; bzero ( & dn -> dn_rm_spillblk [ 0 ] , sizeof ( dn -> dn_rm_spillblk ) ) ; bzero ( & dn -> dn_next_bonuslen [ 0 ] , sizeof ( dn -> dn_next_bonuslen ) ) ; bzero ( & dn -> dn_next_blksz [ 0 ] , sizeof ( dn -> dn_next_blksz ) ) ; bzero ( & dn -> dn_next_maxblkid [ 0 ] , sizeof ( dn -> dn_next_maxblkid ) ) ; for ( i = 0 ; i < TXG_SIZE ; i ++ ) { dn -> dn_free_ranges [ i ] = NULL ; list_create ( & dn -> dn_dirty_records [ i ] , sizeof ( dbuf_dirty_record_t ) , offsetof ( dbuf_dirty_record_t , dr_dirty_node ) ) ; } dn -> dn_allocated_txg = 0 ; dn -> dn_free_txg = 0 ; dn -> dn_assigned_txg = 0 ; dn -> dn_dirty_txg = 0 ; dn -> dn_dirtyctx = 0 ; dn -> dn_dirtyctx_firstset = NULL ; dn -> dn_bonus = NULL ; dn -> dn_have_spill = B_FALSE ; dn -> dn_zio = NULL ; dn -> dn_oldused = 0 ; dn -> dn_oldflags = 0 ; dn -> dn_olduid = 0 ; dn -> dn_oldgid = 0 ; dn -> dn_oldprojid = ZFS_DEFAULT_PROJID ; dn -> dn_newuid = 0 ; dn -> dn_newgid = 0 ; dn -> dn_newprojid = ZFS_DEFAULT_PROJID ; dn -> dn_id_flags = 0 ; dn -> dn_dbufs_count = 0 ; avl_create ( & dn -> dn_dbufs , dbuf_compare , sizeof ( dmu_buf_impl_t ) , offsetof ( dmu_buf_impl_t , db_link ) ) ; dn -> dn_moved = 0 ; return ( 0 ) ; } 