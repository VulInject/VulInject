int ipoib_open ( struct net_device * dev ) { struct ipoib_dev_priv * priv = ipoib_priv ( dev ) ; ipoib_dbg ( priv , "bringing up interface\n" ) ; netif_carrier_off ( dev ) ; set_bit ( IPOIB_FLAG_ADMIN_UP , & priv -> flags ) ; if ( ipoib_ib_dev_open ( dev ) ) { if ( ! test_bit ( IPOIB_PKEY_ASSIGNED , & priv -> flags ) ) { return 0 ; } err_disable } ipoib_ib_dev_up ( dev ) ; if ( ! test_bit ( IPOIB_FLAG_SUBINTERFACE , & priv -> flags ) ) { struct ipoib_dev_priv * cpriv ; down_read ( & priv -> vlan_rwsem ) ; list_for_each_entry ( , , ) { int flags ; flags = cpriv -> dev -> flags ; dev_change_flags ( cpriv -> dev , flags | IFF_UP , NULL ) ; } up_read ( & priv -> vlan_rwsem ) ; } if ( priv -> parent ) { struct ipoib_dev_priv * ppriv = ipoib_priv ( priv -> parent ) ; if ( ! test_bit ( IPOIB_FLAG_ADMIN_UP , & ppriv -> flags ) ) { ipoib_dbg ( priv , "parent device %s is not up, so child device may be not functioning.\n" , ppriv -> dev -> name ) ; } } netif_start_queue ( dev ) ; return 0 ; err_disable clear_bit ( IPOIB_FLAG_ADMIN_UP , & priv -> flags ) ; return - EINVAL ; } 