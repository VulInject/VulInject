static struct shash_desc * alloc_shash_desc ( int id ) { struct crypto_shash * tfm = NULL ; struct shash_desc * shash ; switch ( id ) { case CRYPTO_SHASH_HMACMD5 : tfm = crypto_alloc_shash ( "hmac(md5)" , 0 , 0 ) ; break ; case CRYPTO_SHASH_HMACSHA256 : tfm = crypto_alloc_shash ( "hmac(sha256)" , 0 , 0 ) ; break ; case CRYPTO_SHASH_CMACAES : tfm = crypto_alloc_shash ( "cmac(aes)" , 0 , 0 ) ; break ; case CRYPTO_SHASH_SHA256 : tfm = crypto_alloc_shash ( "sha256" , 0 , 0 ) ; break ; case CRYPTO_SHASH_SHA512 : tfm = crypto_alloc_shash ( "sha512" , 0 , 0 ) ; break ; default : return NULL ; } if ( IS_ERR ( tfm ) ) { return NULL ; } if ( ! shash ) { crypto_free_shash ( tfm ) ; } else { shash -> tfm = tfm ; } return shash ; } 