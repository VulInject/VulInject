Status_t vfi_MngrDelService ( ManagerInfo_t * mi , VFI_SERVICE_RECORD * service , uint32_t mask ) { Status_t status ; SA_MAD mad ; uint32_t madRc ; int count = 0 ; uint8_t buffer [ STL_SA_DATA_LEN ] ; uint32_t bufferLength = sizeof ( buffer ) ; IB_ENTER ( __func__ , mi , service , mask , 0 ) ; status = vfi_MngrQueryService ( mi , service , mask , & count , NULL ) ; if ( status || count == 0 ) { IB_LOG_ERROR_FMT ( __func__ , "service record not found, rc:%u count:%d" , status , count ) ; status = VSTATUS_NOT_FOUND ; IB_EXIT ( __func__ , status ) ; return status ; } memset ( ( void * ) ( & mad ) , 0 , sizeof ( mad ) ) ; SA_MAD_SET_HEADER ( & mad , SM_KEY , mask ) ; MAD_SET_METHOD_TYPE ( & mad , SUBN_ADM_DELETE ) ; MAD_SET_VERSION_INFO ( & mad , IB_BASE_VERSION , MCLASS_SUBN_ADM , IB_SUBN_ADM_CLASS_VERSION ) ; MAD_SET_ATTRIB_ID ( & mad , SA_ATTRIB_SERVICE_RECORD ) ; memcpy ( mad . Data , service , sizeof ( IB_SERVICE_RECORD ) ) ; ( void ) BSWAP_IB_SERVICE_RECORD ( ( IB_SERVICE_RECORD * ) mad . Data ) ; if ( ( status = if3_mngr_send_mad ( mi -> fdr , & mad , sizeof ( IB_SERVICE_RECORD ) , buffer , & bufferLength , & madRc , NULL , NULL ) ) != VSTATUS_OK ) { IB_LOG_INFINI_INFO_FMT ( __func__ , "Was not able to communicate with SA (SM/SA may have moved), rc:%d" , status ) ; done } done IB_LOG_INFO ( __func__ , status ) ; return ( status ) ; } 