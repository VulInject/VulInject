static void fas216_start_command ( FAS216_Info * info , struct scsi_cmnd * SCpnt ) { int disconnect_ok ; info -> scsi . phase = PHASE_SELECTION ; info -> scsi . SCp = SCpnt -> SCp ; info -> SCpnt = SCpnt ; info -> dma . transfer_type = fasdma_none ; if ( parity_test ( info , SCpnt -> device -> id ) ) { fas216_writeb ( info , REG_CNTL1 , info -> scsi . cfg [ 0 ] | CNTL1_PTE ) ; } else { fas216_writeb ( info , REG_CNTL1 , info -> scsi . cfg [ 0 ] ) ; } disconnect_ok = SCpnt -> cmnd [ 0 ] != REQUEST_SENSE && info -> device [ SCpnt -> device -> id ] . disconnect_ok ; msgqueue_flush ( & info -> scsi . msgs ) ; msgqueue_addmsg ( & info -> scsi . msgs , 1 , IDENTIFY ( disconnect_ok , SCpnt -> device -> lun ) ) ; { if ( ( info -> device [ SCpnt -> device -> id ] . sync_state == neg_wait || info -> device [ SCpnt -> device -> id ] . sync_state == neg_complete ) && ( SCpnt -> cmnd [ 0 ] == REQUEST_SENSE || SCpnt -> cmnd [ 0 ] == INQUIRY ) ) { info -> device [ SCpnt -> device -> id ] . sync_state = neg_inprogress ; msgqueue_addmsg ( & info -> scsi . msgs , 5 , EXTENDED_MESSAGE , 3 , EXTENDED_SDTR , 1000 / info -> ifcfg . clockrate , info -> ifcfg . sync_max_depth ) ; break ; } } 0 ; __fas216_start_command ( info , SCpnt ) ; } 