int do_prominfo ( int syserrlog , char * pgname , int log_flag , int prt_flag ) { Sys_tree sys_tree ; Prom_node * root_node ; picl_nodehdl_t rooth ; picl_nodehdl_t plafh ; picl_errno_t err ; err = picl_initialize ( ) ; if ( err != PICL_SUCCESS ) { ( void ) fprintf ( stderr , EM_INIT_FAIL , picl_strerror ( err ) ) ; exit ( 1 ) ; } progname = pgname ; logging = log_flag ; print_flag = prt_flag ; sys_tree . sys_mem = NULL ; sys_tree . boards = NULL ; sys_tree . bd_list = NULL ; sys_tree . board_cnt = 0 ; if ( promopen ( O_RDONLY ) ) { exit ( _error ( dgettext ( TEXT_DOMAIN , "openeepr device " "open failed" ) ) ) ; } if ( is_openprom ( ) == 0 ) { ( void ) fprintf ( stderr , "%s" , dgettext ( TEXT_DOMAIN , "System architecture " "does not support this option of this " "command.\n" ) ) ; return ( 2 ) ; } if ( next ( 0 ) == 0 ) { return ( 2 ) ; } root_node = sun4v_walk ( & sys_tree , NULL , next ( 0 ) ) ; promclose ( ) ; err = picl_get_root ( & rooth ) ; if ( err != PICL_SUCCESS ) { ( void ) fprintf ( stderr , EM_GET_ROOT_FAIL , picl_strerror ( err ) ) ; exit ( 1 ) ; } err = sun4v_get_node_by_name ( rooth , PICL_NODE_PLATFORM , & plafh ) ; return ( sun4v_display ( & sys_tree , root_node , syserrlog , plafh ) ) ; } 