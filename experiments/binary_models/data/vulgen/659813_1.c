static void put_free_pages ( struct page * * page , int num ) { unsigned long flags ; int i = free_pages_num + num , n = num ; if ( i > scsiback_max_buffer_pages ) { n = min ( num , i - scsiback_max_buffer_pages ) ; gnttab_free_pages ( n , page + num - n ) ; n = num - n ; } spin_lock_irqsave ( & free_pages_lock , flags ) ; for ( i = 0 ; i < n ; i ++ ) { list_add ( & page [ i ] -> lru , & scsiback_free_pages ) ; } free_pages_num += n ; spin_unlock_irqrestore ( & free_pages_lock , flags ) ; } 