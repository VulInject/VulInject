static __init int cgw_module_init ( void ) { int ret ; max_hops = clamp_t ( , , , ) ; pr_info ( "can: netlink gateway - max_hops=%d\n" , max_hops ) ; ret = register_pernet_subsys ( & cangw_pernet_ops ) ; ret = - ENOMEM ; cgw_cache = kmem_cache_create ( "can_gw" , sizeof ( cgw_job ) , 0 , 0 , NULL ) ; if ( ! cgw_cache ) { out_cache_create } notifier . notifier_call = cgw_notifier ; ret = register_netdevice_notifier ( & notifier ) ; if ( ret ) { out_register_notifier } ret = rtnl_register_module ( THIS_MODULE , PF_CAN , RTM_GETROUTE , NULL , cgw_dump_jobs , 0 ) ; if ( ret ) { out_rtnl_register1 } ret = rtnl_register_module ( THIS_MODULE , PF_CAN , RTM_NEWROUTE , cgw_create_job , NULL , 0 ) ; if ( ret ) { out_rtnl_register2 } ret = rtnl_register_module ( THIS_MODULE , PF_CAN , RTM_DELROUTE , cgw_remove_job , NULL , 0 ) ; if ( ret ) { out_rtnl_register3 } return 0 ; out_rtnl_register3 rtnl_unregister ( PF_CAN , RTM_NEWROUTE ) ; out_rtnl_register2 rtnl_unregister ( PF_CAN , RTM_GETROUTE ) ; out_rtnl_register1 unregister_netdevice_notifier ( & notifier ) ; out_register_notifier kmem_cache_destroy ( cgw_cache ) ; out_cache_create unregister_pernet_subsys ( & cangw_pernet_ops ) ; return ret ; } 