CK_RV data_object_set_default_attributes ( TEMPLATE * tmpl , CK_ULONG mode ) { CK_ATTRIBUTE * class_attr = NULL ; CK_ATTRIBUTE * app_attr = NULL ; CK_ATTRIBUTE * value_attr = NULL ; class_attr = ( CK_ATTRIBUTE * ) malloc ( sizeof ( CK_ATTRIBUTE ) + sizeof ( CK_OBJECT_CLASS ) ) ; app_attr = ( CK_ATTRIBUTE * ) malloc ( sizeof ( CK_ATTRIBUTE ) ) ; value_attr = ( CK_ATTRIBUTE * ) malloc ( sizeof ( CK_ATTRIBUTE ) ) ; if ( ! class_attr || ! app_attr || ! value_attr ) { if ( class_attr ) { free ( class_attr ) ; } if ( app_attr ) { free ( app_attr ) ; } if ( value_attr ) { free ( value_attr ) ; } return ( CKR_HOST_MEMORY ) ; } app_attr -> type = CKA_APPLICATION ; app_attr -> ulValueLen = 0 ; app_attr -> pValue = NULL ; value_attr -> type = CKA_VALUE ; value_attr -> ulValueLen = 0 ; value_attr -> pValue = NULL ; class_attr -> type = CKA_CLASS ; class_attr -> ulValueLen = sizeof ( CK_OBJECT_CLASS ) ; class_attr -> pValue = ( CK_BYTE * ) class_attr + sizeof ( CK_ATTRIBUTE ) ; * ( CK_OBJECT_CLASS * ) class_attr -> pValue = CKO_DATA ; ( void ) template_update_attribute ( tmpl , class_attr ) ; ( void ) template_update_attribute ( tmpl , app_attr ) ; ( void ) template_update_attribute ( tmpl , value_attr ) ; return ( CKR_OK ) ; } 