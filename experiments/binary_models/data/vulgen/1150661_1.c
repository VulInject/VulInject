_PTR _DEFUN ( memset , ( m , c , n ) , _PTR m _AND int c _AND size_t n ) ( char * s = ( char * ) m , int i , unsigned long buffer , unsigned long * aligned_addr , unsigned int d = c & 0xff , ( UNALIGNED ( s ) ) { if ( n -- ) { * s ++ = ( char ) c ; } else { return m ; } } if ( ! TOO_SMALL ( n ) ) { aligned_addr = ( unsigned long * ) s buffer = ( d << 8 ) | d } ; ) ; for ( i = 32 ; i < LBLOCKSIZE * 8 ; i <<= 1 ) { buffer = ( buffer << i ) | buffer ; } while ( n >= LBLOCKSIZE * 4 ) { * aligned_addr ++ = buffer ; * aligned_addr ++ = buffer ; * aligned_addr ++ = buffer ; * aligned_addr ++ = buffer ; n -= 4 * LBLOCKSIZE ; } while ( n >= LBLOCKSIZE ) { * aligned_addr ++ = buffer ; n -= LBLOCKSIZE ; } s = ( char * ) aligned_addr ; ( n -- ) * s ++ = ( char ) c ; return m ; 