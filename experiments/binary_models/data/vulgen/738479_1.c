static int campoll ( struct cxd * ci ) { u8 istat ; read_reg ( ci , 0x04 , & istat ) ; write_reg ( ci , 0x05 , istat ) ; if ( istat & 0x40 ) { ci -> dr = 1 ; } if ( istat & 0x20 ) { ci -> write_busy = 0 ; } if ( istat & 2 ) { u8 slotstat ; read_reg ( ci , 0x01 , & slotstat ) ; if ( ! ( 2 & slotstat ) ) { if ( ! ci -> slot_stat ) { ci -> slot_stat |= DVB_CA_EN50221_POLL_CAM_PRESENT ; write_regm ( ci , 0x03 , 0x08 , 0x08 ) ; } } else { if ( ci -> slot_stat ) { ci -> slot_stat = 0 ; write_regm ( ci , 0x03 , 0x00 , 0x08 ) ; dev_info ( & ci -> client -> dev , "NO CAM\n" ) ; ci -> ready = 0 ; } } if ( ( istat & 8 ) && ci -> slot_stat == DVB_CA_EN50221_POLL_CAM_PRESENT ) { ci -> ready = 1 ; ci -> slot_stat |= DVB_CA_EN50221_POLL_CAM_READY ; } } return 0 ; } 