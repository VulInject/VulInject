static int mvpp2_rxq_init ( struct mvpp2_port * port , struct mvpp2_rx_queue * rxq ) { u32 rxq_dma ; int cpu ; rxq -> size = port -> rx_ring_size ; rxq -> descs = dma_alloc_coherent ( port -> dev -> dev . parent , rxq -> size * MVPP2_DESC_ALIGNED_SIZE , & rxq -> descs_dma , GFP_KERNEL ) ; if ( ! rxq -> descs ) { return - ENOMEM ; } rxq -> last_desc = rxq -> size - 1 ; mvpp2_write ( port -> priv , MVPP2_RXQ_STATUS_REG ( rxq -> id ) , 0 ) ; cpu = smp_processor_id ( ) ; mvpp2_percpu_write ( port -> priv , cpu , MVPP2_RXQ_NUM_REG , rxq -> id ) ; else { rxq_dma = rxq -> descs_dma >> MVPP22_DESC_ADDR_OFFS ; } mvpp2_percpu_write ( port -> priv , cpu , MVPP2_RXQ_DESC_ADDR_REG , rxq_dma ) ; mvpp2_percpu_write ( port -> priv , cpu , MVPP2_RXQ_DESC_SIZE_REG , rxq -> size ) ; mvpp2_percpu_write ( port -> priv , cpu , MVPP2_RXQ_INDEX_REG , 0 ) ; mvpp2_rxq_offset_set ( port , rxq -> id , NET_SKB_PAD ) ; mvpp2_rx_pkts_coal_set ( port , rxq ) ; mvpp2_rx_time_coal_set ( port , rxq ) ; mvpp2_rxq_status_update ( port , rxq -> id , 0 , rxq -> size ) ; return 0 ; } 