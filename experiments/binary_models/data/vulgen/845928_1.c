static krb5_error_code DB_open ( krb5_context context , HDB * db , int oflags , mode_t mode ) { mdb_info * mi = ( mdb_info * ) db -> hdb_db ; krb5_error_code ret ; mi -> e = NULL ; mi -> mode = mode ; mi -> oflags = oflags & O_ACCMODE ; if ( ret ) { krb5_prepend_error_message ( context , ret , "opening %s:" , db -> hdb_name ) ; return ret ; } if ( ( oflags & O_ACCMODE ) == O_RDONLY ) { ret = hdb_check_db_format ( context , db ) ; if ( ret == HDB_ERR_NOENTRY ) { return 0 ; } } else { ret = hdb_init_db ( context , db ) ; } if ( ret ) { DB_close ( context , db ) ; krb5_set_error_message ( context , ret , "hdb_open: failed %s database %s" , ( oflags & O_ACCMODE ) == O_RDONLY ?"checking format of" : "initialize" , db -> hdb_name ) ; } return ret ; } 