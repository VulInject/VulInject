struct dasd_ccw_req * dasd_3990_erp_action ( struct dasd_ccw_req * cqr ) { struct dasd_ccw_req * erp = NULL ; struct dasd_device * device = cqr -> startdev ; struct dasd_ccw_req * temp_erp = NULL ; if ( device -> features & DASD_FEATURE_ERPLOG ) { dev_err ( & device -> cdev -> dev , "ERP chain at BEGINNING of ERP-ACTION\n" ) ; for ( temp_erp = cqr ; temp_erp != NULL ; temp_erp = temp_erp -> refers ) { dev_err ( & device -> cdev -> dev , "ERP %p (%02x) refers to %p\n" , temp_erp , temp_erp -> status , temp_erp -> refers ) ; } } if ( ( scsw_cstat ( & cqr -> irb . scsw ) == 0x00 ) && ( scsw_dstat ( & cqr -> irb . scsw ) == ( DEV_STAT_CHN_END | DEV_STAT_DEV_END ) ) ) { DBF_DEV_EVENT ( DBF_DEBUG , device , "ERP called for successful request %p" " - NO ERP necessary" , cqr ) ; cqr -> status = DASD_CQR_DONE ; return cqr ; } erp = dasd_3990_erp_in_erp ( cqr ) ; if ( erp == NULL ) { erp = dasd_3990_erp_additional_erp ( cqr ) ; if ( IS_ERR ( erp ) ) { return erp ; } } else { erp = dasd_3990_erp_handle_match_erp ( cqr , erp ) ; } if ( test_bit ( DASD_CQR_VERIFY_PATH , & erp -> flags ) && cqr -> lpm ) { erp -> lpm = cqr -> lpm ; } if ( list_empty ( & erp -> blocklist ) ) { cqr -> status = DASD_CQR_IN_ERP ; list_add_tail ( & erp -> blocklist , & cqr -> blocklist ) ; } return erp ; } 