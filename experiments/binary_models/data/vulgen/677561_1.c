setup_pointers_and_addressables ( ) { size_t n_vars , num_addressable_vars , num_pointers ; referenced_var_iterator rvi ; tree var ; VEC ( tree , heap ) * varvec = NULL ; safe_referenced_var_iterator srvi ; num_addressable_vars = num_pointers = 0 ; FOR_EACH_REFERENCED_VAR ( , ) { if ( may_be_aliased ( var ) ) { num_addressable_vars ++ ; } if ( POINTER_TYPE_P ( TREE_TYPE ( var ) ) ) { num_pointers ++ ; } } ai -> addressable_vars = XCNEWVEC ( alias_map_d * , num_addressable_vars ) ; ai -> pointers = XCNEWVEC ( alias_map_d * , num_pointers ) ; ai -> num_addressable_vars = 0 ; ai -> num_pointers = 0 ; n_vars = num_referenced_vars ; FOR_EACH_REFERENCED_VAR_SAFE ( , , ) { var_ann_t v_ann = var_ann ( var ) ; subvar_t svars ; if ( MTAG_P ( var ) && TREE_CODE ( var ) != STRUCT_FIELD_TAG ) { continue ; } if ( TREE_ADDRESSABLE ( var ) ) { if ( ! bitmap_bit_p ( addressable_vars , DECL_UID ( var ) ) && TREE_CODE ( var ) != RESULT_DECL && ! is_global_var ( var ) ) { bool okay_to_mark = true ; mark_sym_for_renaming ( var ) ; if ( var_can_have_subvars ( var ) && ( svars = get_subvars_for_var ( var ) ) ) { subvar_t sv ; for ( sv = svars ; sv ; sv = sv -> next ) { if ( bitmap_bit_p ( addressable_vars , DECL_UID ( sv -> var ) ) ) { okay_to_mark = false ; } mark_sym_for_renaming ( sv -> var ) ; } } if ( okay_to_mark ) { mark_non_addressable ( var ) ; } } } if ( may_be_aliased ( var ) && ( ! var_can_have_subvars ( var ) || get_subvars_for_var ( var ) == NULL ) ) { create_alias_map_for ( var , ai ) ; mark_sym_for_renaming ( var ) ; } if ( POINTER_TYPE_P ( TREE_TYPE ( var ) ) ) { if ( ( bitmap_bit_p ( ai -> dereferenced_ptrs_store , DECL_UID ( var ) ) || bitmap_bit_p ( ai -> dereferenced_ptrs_load , DECL_UID ( var ) ) ) ) { tree tag ; var_ann_t t_ann ; tag = get_tmt_for ( var , ai ) ; t_ann = var_ann ( tag ) ; mark_sym_for_renaming ( tag ) ; if ( v_ann -> symbol_mem_tag ) { mark_sym_for_renaming ( v_ann -> symbol_mem_tag ) ; } v_ann -> symbol_mem_tag = tag ; if ( bitmap_bit_p ( ai -> dereferenced_ptrs_store , DECL_UID ( var ) ) ) { bitmap_set_bit ( ai -> written_vars , DECL_UID ( tag ) ) ; } NUM_REFERENCES_SET ( t_ann , NUM_REFERENCES ( t_ann ) + NUM_REFERENCES ( v_ann ) ) ; } else { var_ann_t ann = var_ann ( var ) ; tree tag = ann -> symbol_mem_tag ; if ( tag ) { mark_sym_for_renaming ( tag ) ; ann -> symbol_mem_tag = NULL_TREE ; } } } } VEC_free ( tree , heap , varvec ) ; } 