static void php_getimagesize_from_stream ( php_stream * stream , char * input , zval * info , INTERNAL_FUNCTION_PARAMETERS ) { int itype = 0 ; struct gfxinfo * result = NULL ; itype = php_getimagetype ( stream , input , NULL ) ; switch ( itype ) { case IMAGE_FILETYPE_GIF : result = php_handle_gif ( stream ) ; break ; case IMAGE_FILETYPE_JPEG : if ( info ) { result = php_handle_jpeg ( stream , info ) ; } else { result = php_handle_jpeg ( stream , NULL ) ; } break ; case IMAGE_FILETYPE_PNG : result = php_handle_png ( stream ) ; break ; case IMAGE_FILETYPE_SWF : result = php_handle_swf ( stream ) ; break ; case IMAGE_FILETYPE_SWC : result = php_handle_swc ( stream ) ; php_error_docref ( NULL , E_NOTICE , "The image is a compressed SWF file, but you do not have a static version of the zlib extension enabled" ) ; break ; case IMAGE_FILETYPE_PSD : result = php_handle_psd ( stream ) ; break ; case IMAGE_FILETYPE_BMP : result = php_handle_bmp ( stream ) ; break ; case IMAGE_FILETYPE_TIFF_II : result = php_handle_tiff ( stream , NULL , 0 ) ; break ; case IMAGE_FILETYPE_TIFF_MM : result = php_handle_tiff ( stream , NULL , 1 ) ; break ; case IMAGE_FILETYPE_JPC : result = php_handle_jpc ( stream ) ; break ; case IMAGE_FILETYPE_JP2 : result = php_handle_jp2 ( stream ) ; break ; case IMAGE_FILETYPE_IFF : result = php_handle_iff ( stream ) ; break ; case IMAGE_FILETYPE_WBMP : result = php_handle_wbmp ( stream ) ; break ; case IMAGE_FILETYPE_XBM : result = php_handle_xbm ( stream ) ; break ; case IMAGE_FILETYPE_ICO : result = php_handle_ico ( stream ) ; break ; case IMAGE_FILETYPE_WEBP : result = php_handle_webp ( stream ) ; break ; case IMAGE_FILETYPE_AVIF : result = php_handle_avif ( stream ) ; break ; default : case IMAGE_FILETYPE_UNKNOWN : break ; } if ( result ) { char temp [ MAX_LENGTH_OF_LONG * 2 + sizeof ( "width=\"\" height=\"\"" ) ] ; array_init ( return_value ) ; add_index_long ( return_value , 0 , result -> width ) ; add_index_long ( return_value , 1 , result -> height ) ; add_index_long ( return_value , 2 , itype ) ; snprintf ( temp , sizeof ( temp ) , "width=\"%d\" height=\"%d\"" , result -> width , result -> height ) ; add_index_string ( return_value , 3 , temp ) ; if ( result -> bits != 0 ) { add_assoc_long ( return_value , "bits" , result -> bits ) ; } if ( result -> channels != 0 ) { add_assoc_long ( return_value , "channels" , result -> channels ) ; } add_assoc_string ( return_value , "mime" , ( char * ) php_image_type_to_mime_type ( itype ) ) ; efree ( result ) ; } else { RETURN_FALSE ; } } 