int clk_disable ( struct clk * clk ) { const struct clk_ops * ops ; struct clk * clkp = NULL ; int ret ; debug ( "%s(clk=%p)\n" , __func__ , clk ) ; ops = clk_dev_ops ( clk -> dev ) ; if ( CONFIG_IS_ENABLED ( CLK_CCF ) ) { if ( clk -> id && ! clk_get_by_id ( clk -> id , & clkp ) ) { if ( clkp -> flags & CLK_IS_CRITICAL ) { return 0 ; } if ( clkp -> enable_count == 0 ) { printf ( "clk %s already disabled\n" , clkp -> dev -> name ) ; return 0 ; } if ( -- clkp -> enable_count > 0 ) { return 0 ; } } if ( ops -> disable ) { ret = ops -> disable ( clk ) ; if ( ret ) { return ret ; } } if ( clkp && clkp -> dev -> parent && device_get_uclass_id ( clkp -> dev -> parent ) == UCLASS_CLK ) { ret = clk_disable ( dev_get_clk_ptr ( clkp -> dev -> parent ) ) ; if ( ret ) { printf ( "Disable %s failed\n" , clkp -> dev -> parent -> name ) ; return ret ; } } } else { if ( ! ops -> disable ) { return - ENOSYS ; } return ops -> disable ( clk ) ; } return 0 ; } 