static u32 * display_connector_get_output_bus_fmts ( struct drm_bridge * bridge , struct drm_bridge_state * bridge_state , struct drm_crtc_state * crtc_state , struct drm_connector_state * conn_state , unsigned int * num_output_fmts ) { struct drm_bridge * prev_bridge = drm_bridge_get_prev_bridge ( bridge ) ; struct drm_bridge_state * prev_bridge_state ; if ( ! prev_bridge || ! prev_bridge -> funcs -> atomic_get_output_bus_fmts ) { struct drm_connector * conn = conn_state -> connector ; u32 * out_bus_fmts ; * num_output_fmts = 1 ; out_bus_fmts = kmalloc ( sizeof ( * out_bus_fmts ) , GFP_KERNEL ) ; if ( conn -> display_info . num_bus_formats && conn -> display_info . bus_formats ) { out_bus_fmts [ 0 ] = conn -> display_info . bus_formats [ 0 ] ; } else { out_bus_fmts [ 0 ] = MEDIA_BUS_FMT_FIXED ; } return out_bus_fmts ; } prev_bridge_state = drm_atomic_get_new_bridge_state ( crtc_state -> state , prev_bridge ) ; return prev_bridge -> funcs -> atomic_get_output_bus_fmts ( prev_bridge , prev_bridge_state , crtc_state , conn_state , num_output_fmts ) ; } 