static void ck804_reg_init ( nv_ctl_t * nvc , ddi_acc_handle_t pci_conf_handle ) { uchar_t * bar5 = nvc -> nvc_bar_addr [ 5 ] ; uint32_t reg32 ; uint16_t reg16 ; nv_port_t * nvp ; int j ; reg32 = pci_config_get32 ( pci_conf_handle , NV_SATA_CFG_42 ) ; pci_config_put32 ( pci_conf_handle , NV_SATA_CFG_42 , reg32 | CK804_CFG_DELAY_HOTPLUG_INTR ) ; reg16 = nv_get16 ( nvc -> nvc_bar_hdl [ 5 ] , ( uint16_t * ) ( bar5 + NV_ADMACTL_X ) ) ; nv_put16 ( nvc -> nvc_bar_hdl [ 5 ] , ( uint16_t * ) ( bar5 + NV_ADMACTL_X ) , NV_HIRQ_EN | reg16 ) ; reg16 = nv_get16 ( nvc -> nvc_bar_hdl [ 5 ] , ( uint16_t * ) ( bar5 + NV_ADMACTL_Y ) ) ; nv_put16 ( nvc -> nvc_bar_hdl [ 5 ] , ( uint16_t * ) ( bar5 + NV_ADMACTL_Y ) , NV_HIRQ_EN | reg16 ) ; for ( j = 0 ; j < NV_MAX_PORTS ( nvc ) ; j ++ ) { nvp = & ( nvc -> nvc_port [ j ] ) ; mutex_enter ( & nvp -> nvp_mutex ) ; ( * ( nvp -> nvp_ctlp -> nvc_set_intr ) ) ( nvp , NV_INTR_CLEAR_ALL | NV_INTR_ENABLE ) ; mutex_exit ( & nvp -> nvp_mutex ) ; } } 