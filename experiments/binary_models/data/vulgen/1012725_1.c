void i40e_dcb_hw_rx_pb_config ( struct i40e_hw * hw , struct i40e_rx_pb_config * old_pb_cfg , struct i40e_rx_pb_config * new_pb_cfg ) { u32 old_val ; u32 new_val ; u32 reg ; u8 i ; old_val = old_pb_cfg -> shared_pool_low_wm ; new_val = new_pb_cfg -> shared_pool_low_wm ; if ( new_val < old_val ) { reg = rd32 ( hw , I40E_PRTRPB_SLW ) ; reg &= ~ I40E_PRTRPB_SLW_SLW_MASK ; reg |= ( new_val << I40E_PRTRPB_SLW_SLW_SHIFT ) & I40E_PRTRPB_SLW_SLW_MASK ; wr32 ( hw , I40E_PRTRPB_SLW , reg ) ; } for ( i = 0 ; i < I40E_MAX_TRAFFIC_CLASS ; i ++ ) { old_val = old_pb_cfg -> shared_pool_low_thresh [ i ] ; new_val = new_pb_cfg -> shared_pool_low_thresh [ i ] ; if ( new_val < old_val ) { reg = rd32 ( hw , I40E_PRTRPB_SLT ( i ) ) ; reg &= ~ I40E_PRTRPB_SLT_SLT_TCN_MASK ; reg |= ( new_val << I40E_PRTRPB_SLT_SLT_TCN_SHIFT ) & I40E_PRTRPB_SLT_SLT_TCN_MASK ; wr32 ( hw , I40E_PRTRPB_SLT ( i ) , reg ) ; } old_val = old_pb_cfg -> tc_pool_low_wm [ i ] ; new_val = new_pb_cfg -> tc_pool_low_wm [ i ] ; if ( new_val < old_val ) { reg = rd32 ( hw , I40E_PRTRPB_DLW ( i ) ) ; reg &= ~ I40E_PRTRPB_DLW_DLW_TCN_MASK ; reg |= ( new_val << I40E_PRTRPB_DLW_DLW_TCN_SHIFT ) & I40E_PRTRPB_DLW_DLW_TCN_MASK ; wr32 ( hw , I40E_PRTRPB_DLW ( i ) , reg ) ; } } old_val = old_pb_cfg -> shared_pool_high_wm ; new_val = new_pb_cfg -> shared_pool_high_wm ; if ( new_val < old_val ) { reg = rd32 ( hw , I40E_PRTRPB_SHW ) ; reg &= ~ I40E_PRTRPB_SHW_SHW_MASK ; reg |= ( new_val << I40E_PRTRPB_SHW_SHW_SHIFT ) & I40E_PRTRPB_SHW_SHW_MASK ; wr32 ( hw , I40E_PRTRPB_SHW , reg ) ; } for ( i = 0 ; i < I40E_MAX_TRAFFIC_CLASS ; i ++ ) { old_val = old_pb_cfg -> shared_pool_high_thresh [ i ] ; new_val = new_pb_cfg -> shared_pool_high_thresh [ i ] ; if ( new_val < old_val ) { reg = rd32 ( hw , I40E_PRTRPB_SHT ( i ) ) ; reg &= ~ I40E_PRTRPB_SHT_SHT_TCN_MASK ; reg |= ( new_val << I40E_PRTRPB_SHT_SHT_TCN_SHIFT ) & I40E_PRTRPB_SHT_SHT_TCN_MASK ; wr32 ( hw , I40E_PRTRPB_SHT ( i ) , reg ) ; } old_val = old_pb_cfg -> tc_pool_high_wm [ i ] ; new_val = new_pb_cfg -> tc_pool_high_wm [ i ] ; if ( new_val < old_val ) { reg = rd32 ( hw , I40E_PRTRPB_DHW ( i ) ) ; reg &= ~ I40E_PRTRPB_DHW_DHW_TCN_MASK ; reg |= ( new_val << I40E_PRTRPB_DHW_DHW_TCN_SHIFT ) & I40E_PRTRPB_DHW_DHW_TCN_MASK ; wr32 ( hw , I40E_PRTRPB_DHW ( i ) , reg ) ; } } for ( i = 0 ; i < I40E_MAX_TRAFFIC_CLASS ; i ++ ) { new_val = new_pb_cfg -> tc_pool_size [ i ] ; reg = rd32 ( hw , I40E_PRTRPB_DPS ( i ) ) ; reg &= ~ I40E_PRTRPB_DPS_DPS_TCN_MASK ; reg |= ( new_val << I40E_PRTRPB_DPS_DPS_TCN_SHIFT ) & I40E_PRTRPB_DPS_DPS_TCN_MASK ; wr32 ( hw , I40E_PRTRPB_DPS ( i ) , reg ) ; } new_val = new_pb_cfg -> shared_pool_size ; reg = rd32 ( hw , I40E_PRTRPB_SPS ) ; reg &= ~ I40E_PRTRPB_SPS_SPS_MASK ; reg |= ( new_val << I40E_PRTRPB_SPS_SPS_SHIFT ) & I40E_PRTRPB_SPS_SPS_MASK ; wr32 ( hw , I40E_PRTRPB_SPS , reg ) ; old_val = old_pb_cfg -> shared_pool_low_wm ; new_val = new_pb_cfg -> shared_pool_low_wm ; if ( new_val > old_val ) { reg = rd32 ( hw , I40E_PRTRPB_SLW ) ; reg &= ~ I40E_PRTRPB_SLW_SLW_MASK ; reg |= ( new_val << I40E_PRTRPB_SLW_SLW_SHIFT ) & I40E_PRTRPB_SLW_SLW_MASK ; wr32 ( hw , I40E_PRTRPB_SLW , reg ) ; } for ( i = 0 ; i < I40E_MAX_TRAFFIC_CLASS ; i ++ ) { old_val = old_pb_cfg -> shared_pool_low_thresh [ i ] ; new_val = new_pb_cfg -> shared_pool_low_thresh [ i ] ; if ( new_val > old_val ) { reg = rd32 ( hw , I40E_PRTRPB_SLT ( i ) ) ; reg &= ~ I40E_PRTRPB_SLT_SLT_TCN_MASK ; reg |= ( new_val << I40E_PRTRPB_SLT_SLT_TCN_SHIFT ) & I40E_PRTRPB_SLT_SLT_TCN_MASK ; wr32 ( hw , I40E_PRTRPB_SLT ( i ) , reg ) ; } old_val = old_pb_cfg -> tc_pool_low_wm [ i ] ; new_val = new_pb_cfg -> tc_pool_low_wm [ i ] ; if ( new_val > old_val ) { reg = rd32 ( hw , I40E_PRTRPB_DLW ( i ) ) ; reg &= ~ I40E_PRTRPB_DLW_DLW_TCN_MASK ; reg |= ( new_val << I40E_PRTRPB_DLW_DLW_TCN_SHIFT ) & I40E_PRTRPB_DLW_DLW_TCN_MASK ; wr32 ( hw , I40E_PRTRPB_DLW ( i ) , reg ) ; } } old_val = old_pb_cfg -> shared_pool_high_wm ; new_val = new_pb_cfg -> shared_pool_high_wm ; if ( new_val > old_val ) { reg = rd32 ( hw , I40E_PRTRPB_SHW ) ; reg &= ~ I40E_PRTRPB_SHW_SHW_MASK ; reg |= ( new_val << I40E_PRTRPB_SHW_SHW_SHIFT ) & I40E_PRTRPB_SHW_SHW_MASK ; wr32 ( hw , I40E_PRTRPB_SHW , reg ) ; } for ( i = 0 ; i < I40E_MAX_TRAFFIC_CLASS ; i ++ ) { old_val = old_pb_cfg -> shared_pool_high_thresh [ i ] ; new_val = new_pb_cfg -> shared_pool_high_thresh [ i ] ; if ( new_val > old_val ) { reg = rd32 ( hw , I40E_PRTRPB_SHT ( i ) ) ; reg &= ~ I40E_PRTRPB_SHT_SHT_TCN_MASK ; reg |= ( new_val << I40E_PRTRPB_SHT_SHT_TCN_SHIFT ) & I40E_PRTRPB_SHT_SHT_TCN_MASK ; wr32 ( hw , I40E_PRTRPB_SHT ( i ) , reg ) ; } old_val = old_pb_cfg -> tc_pool_high_wm [ i ] ; new_val = new_pb_cfg -> tc_pool_high_wm [ i ] ; } } 