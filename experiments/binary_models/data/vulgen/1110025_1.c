static int ipcp_ackci ( fsm * f , u_char * p , int len ) { ipcp_options * go = & ipcp_gotoptions [ f -> unit ] ; u_short cilen , citype , cishort ; u_int32_t cilong ; u_char cimaxslotindex , cicflag ; if ( neg ) { u_int32_t l ; if ( ( len -= CILEN_ADDRS ) < 0 ) { bad } GETCHAR ( citype , p ) ; GETCHAR ( cilen , p ) ; if ( cilen != CILEN_ADDRS || citype != opt ) { bad } GETLONG ( l , p ) ; cilong = htonl ( l ) ; if ( val1 != cilong ) { bad } GETLONG ( l , p ) ; cilong = htonl ( l ) ; if ( val2 != cilong ) { bad } } if ( neg ) { int vjlen = old ?CILEN_COMPRESS : CILEN_VJ ; if ( ( len -= vjlen ) < 0 ) { bad } GETCHAR ( citype , p ) ; GETCHAR ( cilen , p ) ; if ( cilen != vjlen || citype != opt ) { bad } GETSHORT ( cishort , p ) ; if ( cishort != val ) { bad } if ( ! old ) { GETCHAR ( cimaxslotindex , p ) ; if ( cimaxslotindex != maxslotindex ) { bad } GETCHAR ( cicflag , p ) ; if ( cicflag != cflag ) { bad } } } if ( neg ) { u_int32_t l ; if ( ( len -= CILEN_ADDR ) < 0 ) { bad } GETCHAR ( citype , p ) ; GETCHAR ( cilen , p ) ; if ( cilen != CILEN_ADDR || citype != opt ) { bad } GETLONG ( l , p ) ; cilong = htonl ( l ) ; if ( val != cilong ) { bad } } if ( neg ) { u_int32_t l ; if ( ( len -= CILEN_ADDR ) < 0 ) { bad } GETCHAR ( citype , p ) ; GETCHAR ( cilen , p ) ; if ( cilen != CILEN_ADDR || citype != opt ) { bad } GETLONG ( l , p ) ; cilong = htonl ( l ) ; if ( addr != cilong ) { bad } } if ( neg ) { u_int32_t l ; if ( ( len -= CILEN_ADDR ) < 0 ) { bad } GETCHAR ( citype , p ) ; GETCHAR ( cilen , p ) ; if ( cilen != CILEN_ADDR || citype != opt ) { bad } GETLONG ( l , p ) ; cilong = htonl ( l ) ; if ( addr != cilong ) { bad } } ACKCIADDRS ( CI_ADDRS , ! go -> neg_addr && go -> old_addrs , go -> ouraddr , go -> hisaddr ) ; ACKCIVJ ( CI_COMPRESSTYPE , go -> neg_vj , go -> vj_protocol , go -> old_vj , go -> maxslotindex , go -> cflag ) ; ACKCIADDR ( CI_ADDR , go -> neg_addr , go -> ouraddr ) ; ACKCIDNS ( CI_MS_DNS1 , go -> req_dns1 , go -> dnsaddr [ 0 ] ) ; ACKCIDNS ( CI_MS_DNS2 , go -> req_dns2 , go -> dnsaddr [ 1 ] ) ; ACKCIWINS ( CI_MS_WINS1 , go -> req_wins1 , go -> winsaddr [ 0 ] ) ; ACKCIWINS ( CI_MS_WINS2 , go -> req_wins2 , go -> winsaddr [ 1 ] ) ; return ( 1 ) ; bad IPCPDEBUG ( ( "ipcp_ackci: received bad Ack!" ) ) ; return ( 0 ) ; } 