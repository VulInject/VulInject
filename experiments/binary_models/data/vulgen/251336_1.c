get_cmap_offset ( , ) { guint16 n_tables ; struct cmap_encoding_subtable * table ; gint32 res ; int i ; guint32 offset ; res = GetFontData ( hdc , CMAP , 2 , & n_tables , 2 ) ; if ( res != 2 ) { return 0 ; } n_tables = GUINT16_FROM_BE ( n_tables ) ; res = GetFontData ( hdc , CMAP , CMAP_HEADER_SIZE , table , ENCODING_TABLE_SIZE * n_tables ) ; if ( res != ENCODING_TABLE_SIZE * n_tables ) { return 0 ; } for ( i = 0 ; i < n_tables ; i ++ ) { if ( table [ i ] . platform_id == GUINT16_TO_BE ( MICROSOFT_PLATFORM_ID ) && table [ i ] . encoding_id == GUINT16_TO_BE ( encoding_id ) ) { offset = GUINT32_FROM_BE ( table [ i ] . offset ) ; g_free ( table ) ; return offset ; } } g_free ( table ) ; return 0 ; } 