gimp_text_buffer_get_iter_at_index ( , , , ) { GtkTextIter start ; GtkTextIter end ; gchar * string ; g_return_if_fail ( GIMP_IS_TEXT_BUFFER ( buffer ) ) ; gtk_text_buffer_get_bounds ( GTK_TEXT_BUFFER ( buffer ) , & start , & end ) ; if ( layout_index ) { gchar * my_string = string ; gint my_index = 0 ; gchar * tmp ; { GSList * tags = gtk_text_iter_get_tags ( & start ) ; GSList * list ; tmp = g_utf8_next_char ( my_string ) ; my_index += ( tmp - my_string ) ; my_string = tmp ; for ( list = tags ; list ; list = g_slist_next ( list ) ) { GtkTextTag * tag = list -> data ; if ( g_list_find ( buffer -> kerning_tags , tag ) ) { index = MAX ( 0 , index - WORD_JOINER_LENGTH ) ; break ; } } g_slist_free ( tags ) ; gtk_text_iter_forward_char ( & start ) ; if ( gtk_text_iter_compare ( & start , & end ) > 0 ) { start = end ; } } my_index < index && ! gtk_text_iter_equal ( & start , & end ) ; } string [ index ] = '\0' ; gtk_text_buffer_get_iter_at_offset ( GTK_TEXT_BUFFER ( buffer ) , iter , g_utf8_strlen ( string , - 1 ) ) ; g_free ( string ) ; } 