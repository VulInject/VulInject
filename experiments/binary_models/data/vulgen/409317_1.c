static int men_z188_probe ( struct mcb_device * dev , const struct mcb_device_id * id ) { struct z188_adc * adc ; struct iio_dev * indio_dev ; struct resource * mem ; indio_dev = devm_iio_device_alloc ( & dev -> dev , sizeof ( z188_adc ) ) ; if ( ! indio_dev ) { return - ENOMEM ; } adc = iio_priv ( indio_dev ) ; indio_dev -> dev . parent = & dev -> dev ; indio_dev -> info = & z188_adc_info ; indio_dev -> modes = INDIO_DIRECT_MODE ; indio_dev -> channels = z188_adc_iio_channels ; indio_dev -> num_channels = ARRAY_SIZE ( z188_adc_iio_channels ) ; mem = mcb_request_mem ( dev , "z188-adc" ) ; if ( IS_ERR ( mem ) ) { return PTR_ERR ( mem ) ; } adc -> base = ioremap ( mem -> start , resource_size ( mem ) ) ; if ( adc -> base == NULL ) { err } men_z188_config_channels ( adc -> base ) ; adc -> mem = mem ; mcb_set_drvdata ( dev , indio_dev ) ; return iio_device_register ( indio_dev ) ; err mcb_release_mem ( mem ) ; return - ENXIO ; } 