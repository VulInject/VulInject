static loff_t ovl_llseek ( struct file * file , loff_t offset , int whence ) { struct inode * inode = file_inode ( file ) ; struct fd real ; const struct cred * old_cred ; loff_t ret ; if ( offset == 0 ) { if ( whence == SEEK_SET ) { return vfs_setpos ( file , 0 , 0 ) ; } } ret = ovl_real_fdget ( file , & real ) ; if ( ret ) { return ret ; } ovl_inode_lock ( inode ) ; real . file -> f_pos = file -> f_pos ; old_cred = ovl_override_creds ( inode -> i_sb ) ; ret = vfs_llseek ( real . file , offset , whence ) ; revert_creds ( old_cred ) ; file -> f_pos = real . file -> f_pos ; ovl_inode_unlock ( inode ) ; fdput ( real ) ; return ret ; } 