static void query_target_summary_instances_v2 ( BUFFER * wb , QUERY_TARGET * qt , const char * key ) { buffer_json_member_add_array ( wb , key ) ; for ( long c = 0 ; c < ( long ) qt -> instances . used ; c ++ ) { QUERY_INSTANCE * qi = query_instance ( qt , c ) ; QUERY_HOST * qh = query_host ( qt , qi -> query_host_id ) ; buffer_json_add_array_item_object ( wb ) ; buffer_json_member_add_string ( wb , "id" , string2str ( qi -> id_fqdn ) ) ; buffer_json_member_add_string ( wb , "nm" , string2str ( qi -> name_fqdn ) ) ; buffer_json_member_add_string ( wb , "mg" , qh -> host -> machine_guid ) ; if ( qh -> node_id [ 0 ] ) { buffer_json_member_add_string ( wb , "nd" , qh -> node_id ) ; } query_target_metric_counts ( wb , & qi -> metrics ) ; query_target_alerts_counts ( wb , & qi -> alerts , NULL , false ) ; query_target_data_statistics ( wb , qt , & qi -> query_stats ) ; buffer_json_object_close ( wb ) ; } buffer_json_array_close ( wb ) ; } 