static inline void mantis_risc_program ( struct mantis_pci * mantis ) { u32 buf_pos = 0 ; u32 line , step ; u32 risc_pos ; dprintk ( MANTIS_DEBUG , 1 , "Mantis create RISC program" ) ; RISC_FLUSH ( risc_pos ) ; dprintk ( MANTIS_DEBUG , 1 , "risc len lines %u, bytes per line %u, bytes per DMA tr %u" , MANTIS_BLOCK_COUNT , MANTIS_BLOCK_BYTES , MANTIS_DMA_TR_BYTES ) ; for ( line = 0 ; line < MANTIS_BLOCK_COUNT ; line ++ ) { for ( step = 0 ; step < MANTIS_DMA_TR_UNITS ; step ++ ) { dprintk ( MANTIS_DEBUG , 1 , "RISC PROG line=[%d], step=[%d]" , line , step ) ; if ( step == 0 ) { RISC_INSTR ( risc_pos , RISC_WRITE | RISC_IRQ | RISC_STATUS ( line ) | MANTIS_DMA_TR_BYTES ) ; } else { RISC_INSTR ( risc_pos , RISC_WRITE | MANTIS_DMA_TR_BYTES ) ; } RISC_INSTR ( risc_pos , mantis -> buf_dma + buf_pos ) ; buf_pos += MANTIS_DMA_TR_BYTES ; } } RISC_INSTR ( risc_pos , mantis -> risc_dma ) ; } 