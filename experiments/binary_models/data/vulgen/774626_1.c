static void memb_join_message_send ( struct totemsrp_instance * instance ) { char memb_join_data [ 40000 ] ; struct memb_join * memb_join = ( memb_join * ) memb_join_data ; char * addr ; unsigned int addr_idx ; size_t msg_len ; memb_join -> header . magic = TOTEM_MH_MAGIC ; memb_join -> header . version = TOTEM_MH_VERSION ; memb_join -> header . type = MESSAGE_TYPE_MEMB_JOIN ; memb_join -> header . encapsulated = 0 ; memb_join -> header . nodeid = instance -> my_id . nodeid ; assert ( memb_join -> header . nodeid ) ; msg_len = sizeof ( memb_join ) + ( ( instance -> my_proc_list_entries + instance -> my_failed_list_entries ) * sizeof ( srp_addr ) ) ; memb_join -> ring_seq = instance -> my_ring_id . seq ; memb_join -> proc_list_entries = instance -> my_proc_list_entries ; memb_join -> failed_list_entries = instance -> my_failed_list_entries ; memb_join -> system_from = instance -> my_id ; addr = ( char * ) memb_join ; addr_idx = sizeof ( memb_join ) ; memcpy ( & addr [ addr_idx ] , instance -> my_proc_list , instance -> my_proc_list_entries * sizeof ( srp_addr ) ) ; addr_idx += instance -> my_proc_list_entries * sizeof ( srp_addr ) ; memcpy ( & addr [ addr_idx ] , instance -> my_failed_list , instance -> my_failed_list_entries * sizeof ( srp_addr ) ) ; addr_idx += instance -> my_failed_list_entries * sizeof ( srp_addr ) ; if ( instance -> totem_config -> send_join_timeout ) { usleep ( random ( ) % ( instance -> totem_config -> send_join_timeout * 1000 ) ) ; } instance -> stats . memb_join_tx ++ ; totemnet_mcast_flush_send ( instance -> totemnet_context , memb_join , addr_idx ) ; } 