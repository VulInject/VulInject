static void dissect_mpls_pm_loss ( tvbuff_t * tvb , packet_info * pinfo , proto_tree * tree , guint8 pmt ) { proto_item * ti = NULL ; proto_tree * pm_tree ; proto_tree * pm_tree_flags ; proto_tree * pm_tree_dflags ; guint32 offset = 0 ; gboolean query = 0 ; gboolean response = 0 ; gboolean class_specific = 0 ; guint32 sid = 0 ; guint8 code = 0 ; guint8 otf ; gboolean bflag ; guint8 i ; mpls_pm_build_cinfo ( tvb , pinfo , val_to_str_const ( pmt , pmt_vals , "" ) , & query , & response , & class_specific , & sid , & code ) ; if ( pmt == DLM ) { ti = proto_tree_add_item ( tree , proto_mpls_pm_dlm , tvb , 0 , - 1 , ENC_NA ) ; } else { ti = proto_tree_add_item ( tree , proto_mpls_pm_ilm , tvb , 0 , - 1 , ENC_NA ) ; } pm_tree = proto_item_add_subtree ( ti , ett_mpls_pm ) ; proto_tree_add_item ( pm_tree , hf_mpls_pm_version , tvb , offset , 1 , ENC_BIG_ENDIAN ) ; ti = proto_tree_add_item ( pm_tree , hf_mpls_pm_flags , tvb , offset , 1 , ENC_BIG_ENDIAN ) ; pm_tree_flags = proto_item_add_subtree ( ti , ett_mpls_pm_flags ) ; proto_tree_add_item ( pm_tree_flags , hf_mpls_pm_flags_r , tvb , offset , 1 , ENC_NA ) ; proto_tree_add_item ( pm_tree_flags , hf_mpls_pm_flags_t , tvb , offset , 1 , ENC_NA ) ; proto_tree_add_item ( pm_tree_flags , hf_mpls_pm_flags_res , tvb , offset , 1 , ENC_NA ) ; offset += 1 ; if ( query ) { proto_tree_add_item ( pm_tree , hf_mpls_pm_query_ctrl_code , tvb , offset , 1 , ENC_BIG_ENDIAN ) ; } else { proto_tree_add_item ( pm_tree , hf_mpls_pm_response_ctrl_code , tvb , offset , 1 , ENC_BIG_ENDIAN ) ; } offset += 1 ; proto_tree_add_item ( pm_tree , hf_mpls_pm_length , tvb , offset , 2 , ENC_BIG_ENDIAN ) ; offset += 2 ; ti = proto_tree_add_item ( pm_tree , hf_mpls_pm_dflags , tvb , offset , 1 , ENC_BIG_ENDIAN ) ; pm_tree_dflags = proto_item_add_subtree ( ti , ett_mpls_pm_dflags ) ; proto_tree_add_item ( pm_tree_dflags , hf_mpls_pm_dflags_x , tvb , offset , 1 , ENC_NA ) ; bflag = ( tvb_get_guint8 ( tvb , offset ) & 0x40 ) ?TRUE : FALSE ; proto_tree_add_item ( pm_tree_dflags , hf_mpls_pm_dflags_b , tvb , offset , 1 , ENC_NA ) ; proto_tree_add_item ( pm_tree_dflags , hf_mpls_pm_dflags_res , tvb , offset , 1 , ENC_NA ) ; otf = tvb_get_guint8 ( tvb , offset ) & 0x0F ; proto_tree_add_item ( pm_tree , hf_mpls_pm_otf , tvb , offset , 1 , ENC_BIG_ENDIAN ) ; offset += 1 ; offset += 3 ; proto_tree_add_uint ( pm_tree , hf_mpls_pm_session_id , tvb , offset , 4 , sid ) ; if ( class_specific ) { proto_tree_add_item ( pm_tree , hf_mpls_pm_ds , tvb , offset + 3 , 1 , ENC_BIG_ENDIAN ) ; } offset += 4 ; switch ( otf ) { case MPLS_PM_TSF_NULL : proto_tree_add_item ( pm_tree , hf_mpls_pm_origin_timestamp_null , tvb , offset , 8 , ENC_BIG_ENDIAN ) ; break ; case MPLS_PM_TSF_SEQ : proto_tree_add_item ( pm_tree , hf_mpls_pm_origin_timestamp_seq , tvb , offset , 8 , ENC_BIG_ENDIAN ) ; break ; case MPLS_PM_TSF_NTP : proto_tree_add_item ( pm_tree , hf_mpls_pm_origin_timestamp_ntp , tvb , offset , 8 , ENC_TIME_NTP | ENC_BIG_ENDIAN ) ; break ; case MPLS_PM_TSF_PTP : proto_tree_add_item ( pm_tree , hf_mpls_pm_origin_timestamp_ptp , tvb , offset , 8 , ENC_TIME_SECS_NSECS | ENC_BIG_ENDIAN ) ; break ; default : proto_tree_add_item ( pm_tree , hf_mpls_pm_origin_timestamp_unk , tvb , offset , 8 , ENC_BIG_ENDIAN ) ; break ; } offset += 8 ; for ( i = 1 ; i <= 4 ; i ++ ) { mpls_pm_dissect_counter ( tvb , pm_tree , offset , query , bflag , i ) ; offset += 8 ; } } 