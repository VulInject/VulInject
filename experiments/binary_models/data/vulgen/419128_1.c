bool starter_iface_find ( const char * iface , const struct ip_info * family , ip_address * dst , ip_address * nh ) { struct ifreq req ; if ( iface == NULL ) { return false ; } if ( sock < 0 ) { return false ; } fill_and_terminate ( req . ifr_name , iface , IFNAMSIZ ) ; if ( ioctl ( sock , SIOCGIFFLAGS , & req ) != 0 || ( req . ifr_flags & IFF_UP ) == 0x0 ) { close ( sock ) ; return false ; } if ( nh != NULL && ( req . ifr_flags & IFF_POINTOPOINT ) != 0x0 && ( ioctl ( sock , SIOCGIFDSTADDR , & req ) == 0 ) ) { if ( req . ifr_addr . sa_family == family -> af ) { ip_address nh_address ; ip_port nh_port ; happy ( sockaddr_to_address_port ( & req . ifr_addr , family -> sockaddr_size , & nh_address , & nh_port ) ) ; pexpect ( hport ( nh_port ) == 0 ) ; * nh = nh_address ; } } if ( dst != NULL && ioctl ( sock , SIOCGIFADDR , & req ) == 0 ) { if ( req . ifr_addr . sa_family == family -> af ) { ip_address dst_address ; ip_port dst_port ; happy ( sockaddr_to_address_port ( & req . ifr_addr , family -> sockaddr_size , & dst_address , & dst_port ) ) ; pexpect ( hport ( dst_port ) == 0 ) ; * dst = dst_address ; } } close ( sock ) ; return true ; } 