static int sd_init ( struct gspca_dev * gspca_dev ) { int ret ; const struct ihex_binrec * rec ; const struct firmware * fw ; u8 * firmware_buf ; ret = request_ihex_firmware ( & fw , VICAM_FIRMWARE , & gspca_dev -> dev -> dev ) ; if ( ret ) { pr_err ( "Failed to load \"vicam/firmware.fw\": %d\n" , ret ) ; return ret ; } firmware_buf = kmalloc ( PAGE_SIZE , GFP_KERNEL ) ; if ( ! firmware_buf ) { ret = - ENOMEM ; exit } for ( rec = ( void * ) fw -> data ; rec ; rec = ihex_next_binrec ( rec ) ) { memcpy ( firmware_buf , rec -> data , be16_to_cpu ( rec -> len ) ) ; ret = vicam_control_msg ( gspca_dev , 0xff , 0 , 0 , firmware_buf , be16_to_cpu ( rec -> len ) ) ; if ( ret < 0 ) { break ; } } exit release_firmware ( fw ) ; return ret ; } 