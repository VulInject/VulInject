static int download_tail ( long long int left , int cnt ) { struct dfu_entity * dfu_entity ; void * transfer_buffer ; int ret ; debug ( "%s: left: %llu cnt: %d\n" , __func__ , left , cnt ) ; dfu_entity = dfu_get_entity ( alt_setting_num ) ; if ( ! dfu_entity ) { pr_err ( "Alt setting: %d entity not found!\n" , alt_setting_num ) ; return - ENOENT ; } if ( ! transfer_buffer ) { pr_err ( "Transfer buffer not allocated!\n" ) ; return - ENXIO ; } if ( left ) { ret = dfu_write ( dfu_entity , transfer_buffer , left , cnt ++ ) ; if ( ret ) { pr_err ( "DFU write failed[%d]: left: %llu\n" , ret , left ) ; return ret ; } } ret = dfu_flush ( dfu_entity , transfer_buffer , 0 , cnt ) ; if ( ret ) { pr_err ( "DFU flush failed!\n" ) ; } return ret ; } 