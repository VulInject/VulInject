static void dissect_someip_sd_pdu_option_configuration ( tvbuff_t * tvb , packet_info * pinfo , proto_tree * tree , guint32 offset , guint32 length , int optionnum ) { guint32 offset_orig = offset ; const guint8 * config_string ; proto_item * ti ; proto_tree * subtree ; tree = proto_tree_add_subtree_format ( tree , tvb , offset , length , ett_someip_sd_option , NULL , "%d: Configuration Option" , optionnum ) ; proto_tree_add_item ( tree , hf_someip_sd_option_length , tvb , offset , 2 , ENC_BIG_ENDIAN ) ; offset += 2 ; proto_tree_add_item ( tree , hf_someip_sd_option_type , tvb , offset , 1 , ENC_NA ) ; offset += 1 ; proto_tree_add_item ( tree , hf_someip_sd_option_reserved , tvb , offset , 1 , ENC_NA ) ; offset += 1 ; gint config_string_length = length - offset + offset_orig ; ti = proto_tree_add_item_ret_string ( tree , hf_someip_sd_option_config_string , tvb , offset , config_string_length , ENC_ASCII | ENC_NA , pinfo -> pool , & config_string ) ; subtree = proto_item_add_subtree ( ti , ett_someip_sd_config_string ) ; guint8 pos = 0 ; guint8 element_length ; while ( config_string != NULL && config_string_length - pos > 0 ) { element_length = config_string [ pos ] ; pos ++ ; if ( element_length > config_string_length - pos ) { expert_add_info ( pinfo , ti , & ef_someipsd_config_string_malformed ) ; break ; } proto_tree_add_item ( subtree , hf_someip_sd_option_config_string_element , tvb , offset + pos , element_length , ENC_ASCII | ENC_NA ) ; pos += element_length ; } } 