void CG_LoadMenus ( const char * menuFile ) { char * token ; char * p ; int len , start ; fileHandle_t f ; static char buf [ MAX_MENUDEFFILE ] ; start = trap_Milliseconds ( ) ; len = trap_FS_FOpenFile ( menuFile , & f , FS_READ ) ; if ( ! f ) { Com_Printf ( S_COLOR_YELLOW "menu file not found: %s, using default\n" , menuFile ) ; len = trap_FS_FOpenFile ( "ui/hud.txt" , & f , FS_READ ) ; if ( ! f ) { CG_Error ( S_COLOR_RED "default menu file not found: ui/hud.txt, unable to continue!" ) ; } } if ( len >= MAX_MENUDEFFILE ) { trap_FS_FCloseFile ( f ) ; CG_Error ( S_COLOR_RED "menu file too large: %s is %i, max allowed is %i" , menuFile , len , MAX_MENUDEFFILE ) ; return ; } trap_FS_Read ( buf , len , f ) ; buf [ len ] = 0 ; trap_FS_FCloseFile ( f ) ; Menu_Reset ( ) ; p = buf ; while ( 1 ) { token = COM_ParseExt ( & p , qtrue ) ; if ( ! token [ 0 ] || token [ 0 ] == '}' ) { break ; } if ( Q_stricmp ( token , "}" ) == 0 ) { break ; } if ( Q_stricmp ( token , "loadmenu" ) == 0 ) { if ( CG_Load_Menu ( & p ) ) { continue ; } else { break ; } } } Com_Printf ( "UI menu load time = %d milli seconds\n" , trap_Milliseconds ( ) - start ) ; } 