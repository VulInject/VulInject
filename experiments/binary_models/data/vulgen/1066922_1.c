static void imgu_css_scaler_calc ( u32 input_width , u32 input_height , u32 target_width , u32 target_height , struct imgu_abi_osys_config * cfg , struct imgu_css_scaler_info * info_luma , struct imgu_css_scaler_info * info_chroma , unsigned int * output_width , unsigned int * output_height , unsigned int * procmode ) { u32 out_width = target_width ; u32 out_height = target_height ; const unsigned int height_alignment = 2 ; int phase_step_correction = - 1 ; if ( input_width == target_width ) { * procmode = IMGU_ABI_OSYS_PROCMODE_BYPASS ; } else { * procmode = IMGU_ABI_OSYS_PROCMODE_DOWNSCALE ; } memset ( & cfg -> scaler_coeffs_chroma , 0 , sizeof ( cfg -> scaler_coeffs_chroma ) ) ; memset ( & cfg -> scaler_coeffs_luma , 0 , sizeof ( cfg -> scaler_coeffs_luma ) ) ; { phase_step_correction ++ ; imgu_css_scaler_setup_lut ( IMGU_SCALER_TAPS_Y , input_width , target_width , phase_step_correction , imgu_css_downscale_4taps , IMGU_SCALER_DOWNSCALE_4TAPS_LEN , cfg -> scaler_coeffs_luma , info_luma ) ; imgu_css_scaler_setup_lut ( IMGU_SCALER_TAPS_UV , input_width , target_width , phase_step_correction , imgu_css_downscale_2taps , IMGU_SCALER_DOWNSCALE_2TAPS_LEN , cfg -> scaler_coeffs_chroma , info_chroma ) ; out_width = imgu_css_scaler_calc_scaled_output ( input_width , info_luma ) ; out_height = imgu_css_scaler_calc_scaled_output ( input_height , info_luma ) ; } ( out_width < target_width || out_height < target_height || ! IS_ALIGNED ( out_height , height_alignment ) ) && phase_step_correction <= 5 ; * output_width = out_width ; * output_height = out_height ; } 