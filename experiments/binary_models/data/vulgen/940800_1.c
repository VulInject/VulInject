void pdeclaration ( char * name , declaration * dec , int tab , char * separator ) { char buf [ 8 ] ; char * prefix ; char * type ; if ( streq ( dec -> type , "void" ) ) { return ; } if ( streq ( dec -> type , name ) && ! dec -> prefix ) { f_print ( fout , "struct " ) ; } if ( streq ( dec -> type , "string" ) ) { f_print ( fout , "char *%s" , dec -> name ) ; } else { prefix = "" ; if ( streq ( dec -> type , "bool" ) ) { type = "bool_t" ; } if ( streq ( dec -> type , "opaque" ) ) { type = "char" ; } else { if ( dec -> prefix ) { ( void ) snprintf ( buf , sizeof ( buf ) , "%s " , dec -> prefix ) ; prefix = buf ; } type = dec -> type ; } switch ( dec -> rel ) { case REL_ALIAS : f_print ( fout , "%s%s %s" , prefix , type , dec -> name ) ; break ; case REL_VECTOR : f_print ( fout , "%s%s %s[%s]" , prefix , type , dec -> name , dec -> array_max ) ; break ; case REL_POINTER : f_print ( fout , "%s%s *%s" , prefix , type , dec -> name ) ; break ; case REL_ARRAY : f_print ( fout , "struct {\n" ) ; tabify ( fout , tab ) ; f_print ( fout , "\tu_int %s_len;\n" , dec -> name ) ; tabify ( fout , tab ) ; f_print ( fout , "\t%s%s *%s_val;\n" , prefix , type , dec -> name ) ; tabify ( fout , tab ) ; f_print ( fout , "} %s" , dec -> name ) ; break ; } } f_print ( fout , separator ) ; } 