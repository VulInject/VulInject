static int g12a_enable_internal_mdio ( struct g12a_mdio_mux * priv ) { u32 value ; int ret ; if ( ! __clk_is_enabled ( priv -> pll ) ) { ret = clk_prepare_enable ( priv -> pll ) ; if ( ret ) { return ret ; } } writel ( EPHY_G12A_ID , priv -> regs + ETH_PHY_CNTL0 ) ; value = FIELD_PREP ( PHY_CNTL1_ST_MODE , 3 ) | FIELD_PREP ( PHY_CNTL1_ST_PHYADD , EPHY_DFLT_ADD ) | FIELD_PREP ( PHY_CNTL1_MII_MODE , EPHY_MODE_RMII ) | PHY_CNTL1_CLK_EN | PHY_CNTL1_CLKFREQ ; writel ( value , priv -> regs + ETH_PHY_CNTL1 ) ; value |= PHY_CNTL1_PHY_ENB ; writel ( value , priv -> regs + ETH_PHY_CNTL1 ) ; mdelay ( 10 ) ; return 0 ; } 