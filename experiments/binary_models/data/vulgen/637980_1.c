static void mpc_dma_execute ( struct mpc_dma_chan * mchan ) { struct mpc_dma * mdma = dma_chan_to_mpc_dma ( & mchan -> chan ) ; struct mpc_dma_desc * first = NULL ; struct mpc_dma_desc * prev = NULL ; struct mpc_dma_desc * mdesc ; int cid = mchan -> chan . chan_id ; while ( ! list_empty ( & mchan -> queued ) ) { mdesc = list_first_entry ( & mchan -> queued , mpc_dma_desc , node ) ; if ( mdesc -> will_access_peripheral ) { break ; } else { list_move_tail ( & mdesc -> node , & mchan -> active ) ; } } list_for_each_entry ( , , ) { if ( ! first ) { first = mdesc ; } if ( ! prev ) { prev = mdesc ; continue ; } prev -> tcd -> dlast_sga = mdesc -> tcd_paddr ; prev -> tcd -> e_sg = 1 ; mdesc -> tcd -> start = 1 ; prev = mdesc ; } prev -> tcd -> int_maj = 1 ; memcpy_toio ( & mdma -> tcd [ cid ] , first -> tcd , sizeof ( mpc_dma_tcd ) ) ; if ( first != prev ) { mdma -> tcd [ cid ] . e_sg = 1 ; } if ( mdma -> is_mpc8308 ) { out_8 ( & mdma -> regs -> dmassrt , cid ) ; } if ( first -> will_access_peripheral ) { out_8 ( & mdma -> regs -> dmaserq , cid ) ; } else { out_8 ( & mdma -> regs -> dmassrt , cid ) ; } } 