static void ab8500_fg_check_hw_failure_work ( struct work_struct * work ) { int ret ; u8 reg_value ; struct ab8500_fg * di = container_of ( work , ab8500_fg , fg_check_hw_failure_work . work ) ; if ( ret < 0 ) { dev_err ( di -> dev , "%s ab8500 read failed\n" , __func__ ) ; return ; } if ( ( reg_value & BATT_OVV ) == BATT_OVV ) { if ( ! di -> flags . bat_ovv ) { dev_dbg ( di -> dev , "Battery OVV\n" ) ; di -> flags . bat_ovv = true ; power_supply_changed ( di -> fg_psy ) ; } queue_delayed_work ( di -> fg_wq , & di -> fg_check_hw_failure_work , HZ ) ; } else { dev_dbg ( di -> dev , "Battery recovered from OVV\n" ) ; di -> flags . bat_ovv = false ; power_supply_changed ( di -> fg_psy ) ; } } 