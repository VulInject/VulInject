ssize_t stream_read_try ( struct stream * s , int fd , size_t size ) { ssize_t nbytes ; STREAM_VERIFY_SANE ( s ) ; if ( STREAM_WRITEABLE ( s ) < size ) { return - 1 ; } if ( ( nbytes = read ( fd , s -> data + s -> endp , size ) ) >= 0 ) { s -> endp += nbytes ; return nbytes ; } if ( ERRNO_IO_RETRY ( errno ) ) { return - 2 ; } zlog_warn ( "%s: read failed on fd %d: %s" , __func__ , fd , safe_strerror ( errno ) ) ; return - 1 ; } 