static int ezport_firmware_compare_data ( struct spi_device * spi , const u8 * data , size_t size ) { int ret ; size_t address = 0 ; size_t transfer_size ; dev_dbg ( & spi -> dev , "EzPort compare data with %zu bytes...\n" , size ) ; ret = ezport_get_status_register ( spi ) ; if ( ret < 0 ) { return ret ; } if ( ret & EZPORT_STATUS_FS ) { dev_info ( & spi -> dev , "Device is in secure mode (status=0x%02x)!\n" , ret ) ; dev_info ( & spi -> dev , "FW verification is not possible\n" ) ; return - EACCES ; } while ( size - address > 0 ) { transfer_size = min ( ( size_t ) EZPORT_TRANSFER_SIZE , size - address ) ; if ( ret ) { return ret ; } address += transfer_size ; } return 0 ; } 