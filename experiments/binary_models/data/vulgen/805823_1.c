void InitTramcar ( gentity_t * ent ) { vec3_t move ; float distance ; float light ; vec3_t color ; qboolean lightSet , colorSet ; char * sound ; if ( ent -> model2 ) { ent -> s . modelindex2 = G_ModelIndex ( ent -> model2 ) ; } if ( ! Q_stricmp ( ent -> classname , "props_me109" ) ) { ent -> s . modelindex2 = G_ModelIndex ( "models/mapobjects/vehicles/m109s.md3" ) ; } if ( ! Q_stricmp ( ent -> classname , "truck_cam" ) ) { ent -> s . modelindex2 = G_ModelIndex ( "models/mapobjects/vehicles/truck_base.md3" ) ; } if ( G_SpawnString ( "noise" , "100" , & sound ) ) { ent -> s . loopSound = G_SoundIndex ( sound ) ; } lightSet = G_SpawnFloat ( "light" , "100" , & light ) ; colorSet = G_SpawnVector ( "color" , "1 1 1" , color ) ; if ( lightSet || colorSet ) { int r , g , b , i ; r = color [ 0 ] * 255 ; if ( r > 255 ) { r = 255 ; } g = color [ 1 ] * 255 ; if ( g > 255 ) { g = 255 ; } b = color [ 2 ] * 255 ; if ( b > 255 ) { b = 255 ; } i = light / 4 ; if ( i > 255 ) { i = 255 ; } ent -> s . constantLight = r | ( g << 8 ) | ( b << 16 ) | ( i << 24 ) ; } ent -> use = Use_BinaryMover ; ent -> moverState = MOVER_POS1 ; ent -> r . svFlags = SVF_USE_CURRENT_ORIGIN ; ent -> s . eType = ET_MOVER ; VectorCopy ( ent -> pos1 , ent -> r . currentOrigin ) ; trap_LinkEntity ( ent ) ; ent -> s . pos . trType = TR_STATIONARY ; VectorCopy ( ent -> pos1 , ent -> s . pos . trBase ) ; VectorSubtract ( ent -> pos2 , ent -> pos1 , move ) ; distance = VectorLength ( move ) ; if ( ! ent -> speed ) { ent -> speed = 100 ; } VectorScale ( move , ent -> speed , ent -> s . pos . trDelta ) ; ent -> s . pos . trDuration = distance * 1000 / ent -> speed ; } 