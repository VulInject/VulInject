enum mgos_init_result mgos_timers_init ( void ) { struct timer_data * td = ( timer_data * ) calloc ( 1 , sizeof ( * td ) ) ; struct mg_add_sock_opts opts ; td -> nc = mg_add_sock_opt ( mgos_get_mgr ( ) , INVALID_SOCKET , mgos_timer_ev , td , opts ) ; if ( td -> nc == NULL ) { return MGOS_INIT_TIMERS_INIT_FAILED ; } s_timer_data = td ; s_timer_data_lock = mgos_rlock_create ( ) ; mgos_event_add_handler ( MGOS_EVENT_TIME_CHANGED , mgos_time_change_cb , td ) ; mgos_add_poll_cb ( mgos_poll_cb , td ) ; return mgos_hw_timers_init ( ) ; } 