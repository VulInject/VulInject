START_TEST ( ) { const char * text , * expected ; pr_json_object_t * json ; mark_point ( ) ; text = pr_json_object_to_text ( NULL , NULL , NULL ) ; ck_assert_msg ( text == NULL , "Failed to handle null pool" ) ; ck_assert_msg ( errno == EINVAL , "Expected EINVAL (%d), got %s (%d)" , EINVAL , strerror ( errno ) , errno ) ; mark_point ( ) ; text = pr_json_object_to_text ( p , NULL , NULL ) ; ck_assert_msg ( text == NULL , "Failed to handle null json" ) ; ck_assert_msg ( errno == EINVAL , "Expected EINVAL (%d), got %s (%d)" , EINVAL , strerror ( errno ) , errno ) ; json = pr_json_object_alloc ( p ) ; mark_point ( ) ; text = pr_json_object_to_text ( p , json , NULL ) ; ck_assert_msg ( text == NULL , "Failed to handle null indent" ) ; ck_assert_msg ( errno == EINVAL , "Expected EINVAL (%d), got %s (%d)" , EINVAL , strerror ( errno ) , errno ) ; expected = "{}" ; mark_point ( ) ; text = pr_json_object_to_text ( p , json , "" ) ; ck_assert_msg ( text != NULL , "Failed to get text for object: %s" , strerror ( errno ) ) ; ck_assert_msg ( strcmp ( text , expected ) == 0 , "Expected '%s', got '%s'" , expected , text ) ; ( void ) pr_json_object_set_string ( p , json , "foo" , "bar" ) ; expected = "{\"foo\":\"bar\"}" ; mark_point ( ) ; text = pr_json_object_to_text ( p , json , "" ) ; ck_assert_msg ( text != NULL , "Failed to get text for object: %s" , strerror ( errno ) ) ; ( void ) pr_json_object_free ( json ) ; } 