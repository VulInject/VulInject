int zfs_validate_name ( libzfs_handle_t * hdl , const char * path , int type , boolean_t modifying ) { namecheck_err_t why ; char what ; if ( entity_namecheck ( path , & why , & what ) != 0 ) { if ( hdl != NULL ) { switch ( why ) { case NAME_ERR_TOOLONG : zfs_error_aux ( hdl , dgettext ( TEXT_DOMAIN , "name is too long" ) ) ; break ; case NAME_ERR_LEADING_SLASH : zfs_error_aux ( hdl , dgettext ( TEXT_DOMAIN , "leading slash in name" ) ) ; break ; case NAME_ERR_EMPTY_COMPONENT : zfs_error_aux ( hdl , dgettext ( TEXT_DOMAIN , "empty component in name" ) ) ; break ; case NAME_ERR_TRAILING_SLASH : zfs_error_aux ( hdl , dgettext ( TEXT_DOMAIN , "trailing slash in name" ) ) ; break ; case NAME_ERR_INVALCHAR : zfs_error_aux ( hdl , dgettext ( TEXT_DOMAIN , "invalid character " "'%c' in name" ) , what ) ; break ; case NAME_ERR_MULTIPLE_DELIMITERS : zfs_error_aux ( hdl , dgettext ( TEXT_DOMAIN , "multiple '@' and/or '#' delimiters in " "name" ) ) ; break ; case NAME_ERR_NOLETTER : zfs_error_aux ( hdl , dgettext ( TEXT_DOMAIN , "pool doesn't begin with a letter" ) ) ; break ; case NAME_ERR_RESERVED : zfs_error_aux ( hdl , dgettext ( TEXT_DOMAIN , "name is reserved" ) ) ; break ; case NAME_ERR_DISKLIKE : zfs_error_aux ( hdl , dgettext ( TEXT_DOMAIN , "reserved disk name" ) ) ; break ; default : zfs_error_aux ( hdl , dgettext ( TEXT_DOMAIN , "(%d) not defined" ) , why ) ; break ; } } return ( 0 ) ; } if ( ! ( type & ZFS_TYPE_SNAPSHOT ) && strchr ( path , '@' ) != NULL ) { if ( hdl != NULL ) { zfs_error_aux ( hdl , dgettext ( TEXT_DOMAIN , "snapshot delimiter '@' is not expected here" ) ) ; } return ( 0 ) ; } if ( type == ZFS_TYPE_SNAPSHOT && strchr ( path , '@' ) == NULL ) { if ( hdl != NULL ) { zfs_error_aux ( hdl , dgettext ( TEXT_DOMAIN , "missing '@' delimiter in snapshot name" ) ) ; } return ( 0 ) ; } if ( ! ( type & ZFS_TYPE_BOOKMARK ) && strchr ( path , '#' ) != NULL ) { if ( hdl != NULL ) { zfs_error_aux ( hdl , dgettext ( TEXT_DOMAIN , "bookmark delimiter '#' is not expected here" ) ) ; } return ( 0 ) ; } if ( type == ZFS_TYPE_BOOKMARK && strchr ( path , '#' ) == NULL ) { if ( hdl != NULL ) { zfs_error_aux ( hdl , dgettext ( TEXT_DOMAIN , "missing '#' delimiter in bookmark name" ) ) ; } return ( 0 ) ; } if ( modifying && strchr ( path , '%' ) != NULL ) { return ( 0 ) ; } return ( - 1 ) ; } 