static int r100_startup ( struct radeon_device * rdev ) { int r ; r100_set_common_regs ( rdev ) ; r100_mc_program ( rdev ) ; r100_clock_startup ( rdev ) ; r100_enable_bm ( rdev ) ; if ( rdev -> flags & RADEON_IS_PCI ) { r = r100_pci_gart_enable ( rdev ) ; if ( r ) { return r ; } } r = radeon_wb_init ( rdev ) ; if ( r ) { return r ; } if ( r ) { dev_err ( rdev -> dev , "failed initializing CP fences (%d).\n" , r ) ; return r ; } if ( ! rdev -> irq . installed ) { r = radeon_irq_kms_init ( rdev ) ; if ( r ) { return r ; } } r100_irq_set ( rdev ) ; rdev -> config . r100 . hdp_cntl = RREG32 ( RADEON_HOST_PATH_CNTL ) ; r = r100_cp_init ( rdev , 1024 * 1024 ) ; if ( r ) { dev_err ( rdev -> dev , "failed initializing CP (%d).\n" , r ) ; return r ; } r = radeon_ib_pool_init ( rdev ) ; if ( r ) { dev_err ( rdev -> dev , "IB initialization failed (%d).\n" , r ) ; return r ; } return 0 ; } 