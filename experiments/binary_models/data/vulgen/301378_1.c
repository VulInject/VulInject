static int tg3_phy_copper_begin ( struct tg3 * tp ) { uint32_t new_adv ; tp -> link_config . advertising = ( ADVERTISED_10baseT_Half | ADVERTISED_10baseT_Full | ADVERTISED_100baseT_Half | ADVERTISED_100baseT_Full | ADVERTISED_1000baseT_Half | ADVERTISED_1000baseT_Full | ADVERTISED_Autoneg | ADVERTISED_MII ) ; if ( tp -> tg3_flags & TG3_FLAG_10_100_ONLY ) { tp -> link_config . advertising &= ~ ( ADVERTISED_1000baseT_Half | ADVERTISED_1000baseT_Full ) ; } new_adv = ( ADVERTISE_CSMA | ADVERTISE_PAUSE_CAP ) ; if ( tp -> link_config . advertising & ADVERTISED_10baseT_Half ) { new_adv |= ADVERTISE_10HALF ; } if ( tp -> link_config . advertising & ADVERTISED_10baseT_Full ) { new_adv |= ADVERTISE_10FULL ; } if ( tp -> link_config . advertising & ADVERTISED_100baseT_Half ) { new_adv |= ADVERTISE_100HALF ; } if ( tp -> link_config . advertising & ADVERTISED_100baseT_Full ) { new_adv |= ADVERTISE_100FULL ; } tg3_writephy ( tp , MII_ADVERTISE , new_adv ) ; if ( tp -> link_config . advertising & ( ADVERTISED_1000baseT_Half | ADVERTISED_1000baseT_Full ) ) { new_adv = 0 ; if ( tp -> link_config . advertising & ADVERTISED_1000baseT_Half ) { new_adv |= MII_TG3_CTRL_ADV_1000_HALF ; } if ( ! ( tp -> tg3_flags & TG3_FLAG_10_100_ONLY ) && ( tp -> pci_chip_rev_id == CHIPREV_ID_5701_A0 || tp -> pci_chip_rev_id == CHIPREV_ID_5701_B0 ) ) { new_adv |= ( MII_TG3_CTRL_AS_MASTER | MII_TG3_CTRL_ENABLE_AS_MASTER ) ; } tg3_writephy ( tp , MII_TG3_CTRL , new_adv ) ; } else { tg3_writephy ( tp , MII_TG3_CTRL , 0 ) ; } tg3_writephy ( tp , MII_BMCR , BMCR_ANENABLE | BMCR_ANRESTART ) ; return 0 ; } 