static void omapfb_free_fbmem ( struct fb_info * fbi ) { struct omapfb_info * ofbi = FB2OFB ( fbi ) ; struct omapfb2_device * fbdev = ofbi -> fbdev ; struct omapfb2_mem_region * rg ; rg = ofbi -> region ; if ( rg -> token == NULL ) { return ; } WARN_ON ( atomic_read ( & rg -> map_count ) ) ; if ( ofbi -> rotation_type == OMAP_DSS_ROT_VRFB ) { if ( rg -> vrfb . vaddr [ 0 ] ) { iounmap ( rg -> vrfb . vaddr [ 0 ] ) ; rg -> vrfb . vaddr [ 0 ] = NULL ; } omap_vrfb_release_ctx ( & rg -> vrfb ) ; } rg -> token = NULL ; rg -> vaddr = NULL ; rg -> paddr = 0 ; rg -> alloc = 0 ; rg -> size = 0 ; } 