static xmlNodePtr xmlXIncludeCopyNode ( xmlXIncludeCtxtPtr ctxt , xmlNodePtr elem , int copyChildren ) { xmlNodePtr result = NULL ; xmlNodePtr insertParent = NULL ; xmlNodePtr insertLast = NULL ; xmlNodePtr cur ; if ( copyChildren ) { cur = elem -> children ; if ( cur == NULL ) { return ( NULL ) ; } } else { cur = elem ; } while ( 1 ) { xmlNodePtr copy = NULL ; int recurse = 0 ; if ( ( cur -> type == XML_DOCUMENT_NODE ) || ( cur -> type == XML_DTD_NODE ) ) { } if ( ( cur -> type == XML_ELEMENT_NODE ) && ( cur -> ns != NULL ) && ( xmlStrEqual ( cur -> name , XINCLUDE_NODE ) ) && ( ( xmlStrEqual ( cur -> ns -> href , XINCLUDE_NS ) ) || ( xmlStrEqual ( cur -> ns -> href , XINCLUDE_OLD_NS ) ) ) ) { xmlXIncludeRefPtr ref = xmlXIncludeExpandNode ( ctxt , cur ) ; if ( ref == NULL ) { error } if ( ref -> inc != NULL ) { copy = xmlStaticCopyNodeList ( ref -> inc , ctxt -> doc , insertParent ) ; if ( copy == NULL ) { error } } } else { copy = xmlStaticCopyNode ( cur , ctxt -> doc , insertParent , 2 ) ; if ( copy == NULL ) { error } } if ( copy != NULL ) { if ( result == NULL ) { result = copy ; } if ( insertLast != NULL ) { insertLast -> next = copy ; copy -> prev = insertLast ; } if ( insertParent != NULL ) { insertParent -> children = copy ; } insertLast = copy ; while ( insertLast -> next != NULL ) { insertLast = insertLast -> next ; } } if ( recurse ) { cur = cur -> children ; insertParent = insertLast ; insertLast = NULL ; continue ; } if ( cur == elem ) { return ( result ) ; } while ( cur -> next == NULL ) { cur = cur -> parent ; if ( cur == elem ) { return ( result ) ; } insertParent -> last = insertLast ; insertLast = insertParent ; insertParent = insertParent -> parent ; } cur = cur -> next ; } error xmlFreeNodeList ( result ) ; return ( NULL ) ; } 