int sirdev_put_instance ( struct sir_dev * dev ) { int err = 0 ; pr_debug ( "%s\n" , __func__ ) ; netif_carrier_off ( dev -> netdev ) ; netif_device_detach ( dev -> netdev ) ; if ( dev -> dongle_drv ) { err = sirdev_schedule_dongle_close ( dev ) ; } if ( err ) { net_err_ratelimited ( "%s - error %d\n" , __func__ , err ) ; } sirdev_close ( dev -> netdev ) ; down ( & dev -> fsm . sem ) ; dev -> fsm . state = SIRDEV_STATE_DEAD ; dev -> dongle_drv = NULL ; dev -> priv = NULL ; up ( & dev -> fsm . sem ) ; unregister_netdev ( dev -> netdev ) ; free_netdev ( dev -> netdev ) ; return 0 ; } 