static void tcp_cdg_cong_avoid ( struct sock * sk , u32 ack , u32 acked ) { struct cdg * ca = inet_csk_ca ( sk ) ; struct tcp_sock * tp = tcp_sk ( sk ) ; u32 prior_snd_cwnd ; u32 incr ; if ( tcp_in_slow_start ( tp ) && hystart_detect ) { tcp_cdg_hystart_update ( sk ) ; } if ( after ( ack , ca -> rtt_seq ) && ca -> rtt . v64 ) { s32 grad = 0 ; if ( ca -> rtt_prev . v64 ) { grad = tcp_cdg_grad ( ca ) ; } ca -> rtt_seq = tp -> snd_nxt ; ca -> rtt_prev = ca -> rtt ; ca -> rtt . v64 = 0 ; ca -> last_ack = 0 ; if ( grad > 0 && tcp_cdg_backoff ( sk , grad ) ) { return ; } } if ( ! tcp_is_cwnd_limited ( sk ) ) { ca -> shadow_wnd = min ( ca -> shadow_wnd , tp -> snd_cwnd ) ; return ; } prior_snd_cwnd = tp -> snd_cwnd ; tcp_reno_cong_avoid ( sk , ack , acked ) ; incr = tp -> snd_cwnd - prior_snd_cwnd ; ca -> shadow_wnd = max ( ca -> shadow_wnd , ca -> shadow_wnd + incr ) ; } 