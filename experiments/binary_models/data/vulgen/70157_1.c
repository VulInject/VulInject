static irqreturn_t mfgpt_tick ( int irq , void * dev_id ) { uint16_t val = cs5535_mfgpt_read ( cs5535_event_clock , MFGPT_REG_SETUP ) ; if ( ! ( val & ( MFGPT_SETUP_SETUP | MFGPT_SETUP_CMP2 | MFGPT_SETUP_CMP1 ) ) ) { return IRQ_NONE ; } if ( clockevent_state_shutdown ( & cs5535_clockevent ) ) { return IRQ_HANDLED ; } cs5535_mfgpt_write ( cs5535_event_clock , MFGPT_REG_COUNTER , 0 ) ; if ( clockevent_state_periodic ( & cs5535_clockevent ) ) { cs5535_mfgpt_write ( cs5535_event_clock , MFGPT_REG_SETUP , MFGPT_SETUP_CNTEN | MFGPT_SETUP_CMP2 ) ; } cs5535_clockevent . event_handler ( & cs5535_clockevent ) ; return IRQ_HANDLED ; } 