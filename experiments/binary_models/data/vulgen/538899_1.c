static int calc_gmt_offset ( time_t t , struct tm * local ) { struct tm gmt ; int delta ; delta = ( local -> tm_hour - gmt . tm_hour ) * 60 + ( local -> tm_min - gmt . tm_min ) ; if ( local -> tm_yday != gmt . tm_yday ) { int day_offset ; if ( local -> tm_year == gmt . tm_year ) { day_offset = local -> tm_yday - gmt . tm_yday ; } else { day_offset = local -> tm_year - gmt . tm_year ; } delta += day_offset * 24 * 60 ; } return delta ; } 