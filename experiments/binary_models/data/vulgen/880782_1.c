md_apply_fix3 ( , , ) fixS * fixP ; valueT * valP ; { valueT code ; valueT mask ; valueT val = * valP ; char * buf ; int shift ; int size ; buf = fixP -> fx_where + fixP -> fx_frag -> fr_literal ; size = fixP -> fx_size ; code = md_chars_to_number ( buf , size ) ; switch ( fixP -> fx_r_type ) { case BFD_RELOC_16 : case BFD_RELOC_16_PCREL : mask = 0xffff ; shift = 0 ; break ; case BFD_RELOC_PDP11_DISP_8_PCREL : mask = 0x00ff ; shift = 1 ; break ; case BFD_RELOC_PDP11_DISP_6_PCREL : mask = 0x003f ; shift = 1 ; break ; default : BAD_CASE ( fixP -> fx_r_type ) ; } if ( fixP -> fx_addsy != NULL ) { val += symbol_get_bfdsym ( fixP -> fx_addsy ) -> section -> vma ; } code &= ~ mask ; code |= ( val >> shift ) & mask ; number_to_chars_littleendian ( buf , code , size ) ; if ( fixP -> fx_addsy == NULL && fixP -> fx_pcrel == 0 ) { fixP -> fx_done = 1 ; } } 