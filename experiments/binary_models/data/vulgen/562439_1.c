int vimc_vdev_link_validate ( struct media_link * link ) { struct v4l2_pix_format source_fmt , sink_fmt ; int ret ; ret = vimc_get_pix_format ( link -> source , & source_fmt ) ; if ( ret ) { return ret ; } ret = vimc_get_pix_format ( link -> sink , & sink_fmt ) ; if ( ret ) { return ret ; } pr_info ( "vimc link validate: " "%s:src:%dx%d (0x%x, %d, %d, %d, %d) " "%s:snk:%dx%d (0x%x, %d, %d, %d, %d)\n" , link -> source -> entity -> name , source_fmt . width , source_fmt . height , source_fmt . pixelformat , source_fmt . colorspace , source_fmt . quantization , source_fmt . xfer_func , source_fmt . ycbcr_enc , link -> sink -> entity -> name , sink_fmt . width , sink_fmt . height , sink_fmt . pixelformat , sink_fmt . colorspace , sink_fmt . quantization , sink_fmt . xfer_func , sink_fmt . ycbcr_enc ) ; if ( source_fmt . width != sink_fmt . width || source_fmt . height != sink_fmt . height || source_fmt . pixelformat != sink_fmt . pixelformat ) { return - EPIPE ; } if ( source_fmt . field != sink_fmt . field && sink_fmt . field != V4L2_FIELD_NONE ) { return - EPIPE ; } if ( source_fmt . colorspace == V4L2_COLORSPACE_DEFAULT || sink_fmt . colorspace == V4L2_COLORSPACE_DEFAULT ) { return 0 ; } if ( source_fmt . ycbcr_enc != V4L2_YCBCR_ENC_DEFAULT && sink_fmt . ycbcr_enc != V4L2_YCBCR_ENC_DEFAULT && source_fmt . ycbcr_enc != sink_fmt . ycbcr_enc ) { return - EPIPE ; } if ( source_fmt . quantization != V4L2_QUANTIZATION_DEFAULT && sink_fmt . quantization != V4L2_QUANTIZATION_DEFAULT && source_fmt . quantization != sink_fmt . quantization ) { return - EPIPE ; } if ( source_fmt . xfer_func != V4L2_XFER_FUNC_DEFAULT && sink_fmt . xfer_func != V4L2_XFER_FUNC_DEFAULT && source_fmt . xfer_func != sink_fmt . xfer_func ) { return - EPIPE ; } return 0 ; } static const struct media_entity_operations vimc_ent_sd_mops = { . link_validate = v4l2_subdev_link_validate } ; 