int bn_op_test ( int * bn_op ( BIGNUM * , const BIGNUM * , const BIGNUM * ) , struct hexinput_st tests [ ] , unsigned int ntests , const char * testname ) { BIGNUM * a = NULL , * b = NULL , * e = NULL , * r = NULL ; unsigned int i ; int failed = 0 ; if ( ( ( a = BN_new ( ) ) == NULL ) || ( ( b = BN_new ( ) ) == NULL ) || ( ( e = BN_new ( ) ) == NULL ) || ( ( r = BN_new ( ) ) == NULL ) ) { failed = 1 ; ERR_print_errors_fp ( stderr ) ; err } for ( i = 0 ; i < ntests ; i ++ ) { int print = 0 ; if ( ! BN_hex2bn ( & a , tests [ i ] . a_hex ) || ! BN_hex2bn ( & b , tests [ i ] . b_hex ) || ! BN_hex2bn ( & e , tests [ i ] . e_hex ) ) { ERR_print_errors_fp ( stderr ) ; } if ( tests [ i ] . ret != bn_op ( r , a , b ) ) { print = 1 ; } if ( tests [ i ] . compare == 1 && BN_cmp ( e , r ) != 0 ) { print = 1 ; } if ( print ) { failed = 1 ; print_failure_case ( a , b , e , r , i , testname ) ; } } err BN_free ( a ) ; BN_free ( b ) ; BN_free ( e ) ; BN_free ( r ) ; return failed ; } 