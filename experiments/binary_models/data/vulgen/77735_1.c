int vmtrbusy ( vm ) Vmalloc_t * vm ; { Seg_t * seg ; Vmdata_t * vd = vm -> data ; if ( Trfile < 0 || ! ( vd -> mode & ( VM_MTBEST | VM_MTDEBUG | VM_MTPROFILE ) ) ) { return - 1 ; } for ( seg = vd -> seg ; seg ; seg = seg -> next ) { Block_t * b , * endb ; Vmuchar_t * data ; size_t s ; for ( b = SEGBLOCK ( seg ) , endb = BLOCK ( seg -> baddr ) ; b < endb ; ) { if ( ISJUNK ( SIZE ( b ) ) || ! ISBUSY ( SIZE ( b ) ) ) { continue ; } data = DATA ( b ) ; if ( vd -> mode & VM_MTDEBUG ) { data = DB2DEBUG ( data ) ; s = DBSIZE ( data ) ; } if ( vd -> mode & VM_MTPROFILE ) { s = PFSIZE ( data ) ; } else { s = SIZE ( b ) & ~ BITS ; } b = ( Block_t * ) ( ( Vmuchar_t * ) DATA ( b ) + ( SIZE ( b ) & ~ BITS ) ) ; } } return 0 ; } 