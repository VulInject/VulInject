void mdp5_smp_prepare_commit ( struct mdp5_smp * smp , struct mdp5_smp_state * state ) { enum mdp5_pipe pipe ; for_each_set_bit ( , , 8 ) { int i , nblks = 0 ; for ( i = 0 ; i < pipe2nclients ( pipe ) ; i ++ ) { u32 cid = pipe2client ( pipe , i ) ; void * cs = state -> client_state [ cid ] ; nblks += update_smp_state ( smp , cid , cs ) ; DBG ( "assign %s:%u, %u blks" , pipe2name ( pipe ) , i , nblks ) ; } set_fifo_thresholds ( smp , pipe , nblks ) ; } write_smp_alloc_regs ( smp ) ; write_smp_fifo_regs ( smp ) ; state -> assigned = 0 ; } 