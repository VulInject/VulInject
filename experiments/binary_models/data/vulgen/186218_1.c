static void pctl_cfg ( int channel , struct rk3288_ddr_pctl * pctl , struct rk3288_sdram_params * sdram_params , struct rk3288_grf * grf ) { unsigned int burstlen ; burstlen = ( sdram_params -> base . noc_timing >> 18 ) & 0x7 ; copy_to_reg ( & pctl -> togcnt1u , & sdram_params -> pctl_timing . togcnt1u , sizeof ( sdram_params -> pctl_timing ) ) ; switch ( sdram_params -> base . dramtype ) { case LPDDR3 : writel ( sdram_params -> pctl_timing . tcl - 1 , & pctl -> dfitrddataen ) ; writel ( sdram_params -> pctl_timing . tcwl , & pctl -> dfitphywrlat ) ; burstlen >>= 1 ; writel ( LPDDR2_S4 | 0 << MDDR_LPDDR2_CLK_STOP_IDLE_SHIFT | LPDDR2_EN | burstlen << BURSTLENGTH_SHIFT | ( 6 - 4 ) << TFAW_SHIFT | PD_EXIT_FAST | 1 << PD_TYPE_SHIFT | 0 << PD_IDLE_SHIFT , & pctl -> mcfg ) ; ddr_set_ddr3_mode ( grf , channel , false ) ; ddr_set_enable ( grf , channel , true ) ; ddr_set_en_bst_odt ( grf , channel , true , false , sdram_params -> base . odt ) ; break ; case DDR3 : else { writel ( sdram_params -> pctl_timing . tcl - 2 , & pctl -> dfitrddataen ) ; } writel ( sdram_params -> pctl_timing . tcwl - 1 , & pctl -> dfitphywrlat ) ; writel ( 0 << MDDR_LPDDR2_CLK_STOP_IDLE_SHIFT | DDR3_EN | DDR2_DDR3_BL_8 | ( 6 - 4 ) << TFAW_SHIFT | PD_EXIT_SLOW | 1 << PD_TYPE_SHIFT | 0 << PD_IDLE_SHIFT , & pctl -> mcfg ) ; ddr_set_ddr3_mode ( grf , channel , true ) ; ddr_set_enable ( grf , channel , true ) ; ddr_set_en_bst_odt ( grf , channel , false , true , false ) ; break ; } setbits_le32 ( & pctl -> scfg , 1 ) ; } 