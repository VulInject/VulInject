struct hba_port * mpt3sas_get_port_by_id ( struct MPT3SAS_ADAPTER * ioc , u8 port_id , u8 bypass_dirty_port_flag ) { struct hba_port * port , * port_next ; if ( ! ioc -> multipath_on_hba ) { port_id = MULTIPATH_DISABLED_PORT_ID ; } list_for_each_entry_safe ( , , , ) { if ( port -> port_id != port_id ) { continue ; } if ( bypass_dirty_port_flag ) { return port ; } if ( port -> flags & HBA_PORT_FLAG_DIRTY_PORT ) { continue ; } return port ; } if ( ! ioc -> multipath_on_hba ) { port = kzalloc ( sizeof ( hba_port ) , GFP_ATOMIC ) ; port -> port_id = port_id ; ioc_info ( ioc , "hba_port entry: %p, port: %d is added to hba_port list\n" , port , port -> port_id ) ; list_add_tail ( & port -> list , & ioc -> port_table_list ) ; return port ; } return NULL ; } 