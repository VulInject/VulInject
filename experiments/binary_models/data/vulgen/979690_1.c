static int signalfd_copyinfo ( struct signalfd_siginfo __user * uinfo , kernel_siginfo_t const * kinfo ) { signalfd_siginfo new ; BUILD_BUG_ON ( sizeof ( signalfd_siginfo ) != 128 ) ; new . ssi_signo = kinfo -> si_signo ; new . ssi_errno = kinfo -> si_errno ; new . ssi_code = kinfo -> si_code ; switch ( siginfo_layout ( kinfo -> si_signo , kinfo -> si_code ) ) { case SIL_KILL : new . ssi_pid = kinfo -> si_pid ; new . ssi_uid = kinfo -> si_uid ; break ; case SIL_TIMER : new . ssi_tid = kinfo -> si_tid ; new . ssi_overrun = kinfo -> si_overrun ; new . ssi_ptr = ( long ) kinfo -> si_ptr ; new . ssi_int = kinfo -> si_int ; break ; case SIL_POLL : new . ssi_band = kinfo -> si_band ; new . ssi_fd = kinfo -> si_fd ; break ; case SIL_FAULT_BNDERR : case SIL_FAULT_PKUERR : case SIL_FAULT_PERF_EVENT : case SIL_FAULT : new . ssi_addr = ( long ) kinfo -> si_addr ; break ; case SIL_FAULT_TRAPNO : new . ssi_addr = ( long ) kinfo -> si_addr ; new . ssi_trapno = kinfo -> si_trapno ; break ; case SIL_FAULT_MCEERR : new . ssi_addr = ( long ) kinfo -> si_addr ; new . ssi_addr_lsb = ( short ) kinfo -> si_addr_lsb ; break ; case SIL_CHLD : new . ssi_pid = kinfo -> si_pid ; new . ssi_uid = kinfo -> si_uid ; new . ssi_status = kinfo -> si_status ; new . ssi_utime = kinfo -> si_utime ; new . ssi_stime = kinfo -> si_stime ; break ; case SIL_RT : new . ssi_pid = kinfo -> si_pid ; new . ssi_uid = kinfo -> si_uid ; new . ssi_ptr = ( long ) kinfo -> si_ptr ; new . ssi_int = kinfo -> si_int ; break ; case SIL_SYS : new . ssi_call_addr = ( long ) kinfo -> si_call_addr ; new . ssi_syscall = kinfo -> si_syscall ; new . ssi_arch = kinfo -> si_arch ; break ; } if ( copy_to_user ( uinfo , & new , sizeof ( signalfd_siginfo ) ) ) { return - EFAULT ; } return sizeof ( * uinfo ) ; } 