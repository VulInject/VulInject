static void check_sigsegv ( void * func , enum exception exception , unsigned long val ) { int prot ; unsigned long * page ; unsigned long * addr ; int err ; prot = exception == exception_translation ?PROT_NONE : PROT_READ ; assert ( page != MAP_FAILED ) ; if ( exception == exception_translation ) { err = munmap ( page , 4096 ) ; assert ( err == 0 ) ; } addr = page + ( val & 0x1ff ) ; expected . sig = SIGSEGV ; expected . addr = page ; expected . psw_addr = ( unsigned long ) func ; expected . exception = exception ; if ( func == stg ) { stg ( addr , val ) ; } else { assert ( func == mvc_8 ) ; mvc_8 ( addr , & val ) ; } assert ( * addr == val ) ; err = munmap ( page , 4096 ) ; assert ( err == 0 ) ; } 