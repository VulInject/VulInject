static void ei_tx_intr ( struct net_device * dev ) { unsigned long e8390_base = dev -> base_addr ; struct ei_device * ei_local = netdev_priv ( dev ) ; int status = ei_inb ( e8390_base + EN0_TSR ) ; ei_outb_p ( ENISR_TX , e8390_base + EN0_ISR ) ; ei_local -> txqueue -- ; if ( ei_local -> tx1 < 0 ) { if ( ei_local -> lasttx != 1 && ei_local -> lasttx != - 1 ) { pr_err ( "%s: bogus last_tx_buffer %d, tx1=%d\n" , ei_local -> name , ei_local -> lasttx , ei_local -> tx1 ) ; } ei_local -> tx1 = 0 ; if ( ei_local -> tx2 > 0 ) { ei_local -> txing = 1 ; NS8390_trigger_send ( dev , ei_local -> tx2 , ei_local -> tx_start_page + 6 ) ; netif_trans_update ( dev ) ; ei_local -> tx2 = - 1 , ei_local -> lasttx = 2 ; } else { ei_local -> lasttx = 20 , ei_local -> txing = 0 ; } } if ( ei_local -> tx2 < 0 ) { if ( ei_local -> lasttx != 2 && ei_local -> lasttx != - 2 ) { pr_err ( "%s: bogus last_tx_buffer %d, tx2=%d\n" , ei_local -> name , ei_local -> lasttx , ei_local -> tx2 ) ; } ei_local -> tx2 = 0 ; if ( ei_local -> tx1 > 0 ) { ei_local -> txing = 1 ; NS8390_trigger_send ( dev , ei_local -> tx1 , ei_local -> tx_start_page ) ; netif_trans_update ( dev ) ; ei_local -> tx1 = - 1 ; ei_local -> lasttx = 1 ; } else { ei_local -> lasttx = 10 , ei_local -> txing = 0 ; } } if ( status & ENTSR_COL ) { dev -> stats . collisions ++ ; } if ( status & ENTSR_PTX ) { dev -> stats . tx_packets ++ ; } else { dev -> stats . tx_errors ++ ; if ( status & ENTSR_ABT ) { dev -> stats . tx_aborted_errors ++ ; dev -> stats . collisions += 16 ; } if ( status & ENTSR_CRS ) { dev -> stats . tx_carrier_errors ++ ; } if ( status & ENTSR_FU ) { dev -> stats . tx_fifo_errors ++ ; } if ( status & ENTSR_CDH ) { dev -> stats . tx_heartbeat_errors ++ ; } } netif_wake_queue ( dev ) ; } 