static void common_imul_long_IMM ( struct x86emu * emu , int byte_imm ) { uint32_t srcoffset ; uint32_t * destreg , srcval ; int32_t imm ; uint64_t res ; fetch_decode_modrm ( emu ) ; destreg = decode_rh_long_register ( emu ) ; if ( emu -> cur_mod != 3 ) { srcoffset = decode_rl_address ( emu ) ; srcval = fetch_data_long ( emu , srcoffset ) ; } else { srcval = * decode_rl_long_register ( emu ) ; } if ( byte_imm ) { imm = ( int8_t ) fetch_byte_imm ( emu ) ; } else { imm = fetch_long_imm ( emu ) ; } res = ( int32_t ) srcval * imm ; if ( res > 0xffffffff ) { SET_FLAG ( F_CF ) ; SET_FLAG ( F_OF ) ; } else { CLEAR_FLAG ( F_CF ) ; } * destreg = ( uint32_t ) res ; } 