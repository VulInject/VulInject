void dasd_generic_remove ( struct ccw_device * cdev ) { struct dasd_device * device ; struct dasd_block * block ; cdev -> handler = NULL ; device = dasd_device_from_cdev ( cdev ) ; if ( IS_ERR ( device ) ) { dasd_remove_sysfs_files ( cdev ) ; return ; } if ( test_and_set_bit ( DASD_FLAG_OFFLINE , & device -> flags ) && ! test_bit ( DASD_FLAG_SAFE_OFFLINE_RUNNING , & device -> flags ) ) { dasd_remove_sysfs_files ( cdev ) ; return ; } dasd_set_target_state ( device , DASD_STATE_NEW ) ; block = device -> block ; dasd_delete_device ( device ) ; if ( block ) { dasd_free_block ( block ) ; } dasd_remove_sysfs_files ( cdev ) ; } 