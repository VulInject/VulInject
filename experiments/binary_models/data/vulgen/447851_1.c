static int do_one_sme_vl ( struct tdescr * td , siginfo_t * si , ucontext_t * uc , unsigned int vl ) { size_t offset ; struct _aarch64_ctx * head = GET_BUF_RESV_HEAD ( context ) ; struct za_context * za ; fprintf ( stderr , "Testing VL %d\n" , vl ) ; if ( prctl ( PR_SME_SET_VL , vl ) != vl ) { fprintf ( stderr , "Failed to set VL\n" ) ; return 1 ; } setup_za_regs ( ) ; if ( ! get_current_context ( td , & context . uc , sizeof ( context ) ) ) { return 1 ; } if ( ! head ) { fprintf ( stderr , "No ZA context\n" ) ; return 1 ; } za = ( za_context * ) head ; if ( za -> vl != vl ) { fprintf ( stderr , "Got VL %d, expected %d\n" , za -> vl , vl ) ; return 1 ; } if ( head -> size != ZA_SIG_CONTEXT_SIZE ( sve_vq_from_vl ( vl ) ) ) { fprintf ( stderr , "ZA context size %u, expected %lu\n" , head -> size , ZA_SIG_CONTEXT_SIZE ( sve_vq_from_vl ( vl ) ) ) ; return 1 ; } fprintf ( stderr , "Got expected size %u and VL %d\n" , head -> size , za -> vl ) ; if ( memcmp ( zeros , ( char * ) za + ZA_SIG_REGS_OFFSET , ZA_SIG_REGS_SIZE ( sve_vq_from_vl ( za -> vl ) ) ) != 0 ) { fprintf ( stderr , "ZA data invalid\n" ) ; return 1 ; } return 0 ; } 