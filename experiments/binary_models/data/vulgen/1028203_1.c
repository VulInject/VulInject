static struct netlbl_unlhsh_iface * netlbl_unlhsh_add_iface ( int ifindex ) { u32 bkt ; struct netlbl_unlhsh_iface * iface ; iface = kzalloc ( sizeof ( * iface ) , GFP_ATOMIC ) ; if ( iface == NULL ) { return NULL ; } iface -> ifindex = ifindex ; INIT_LIST_HEAD ( & iface -> addr4_list ) ; INIT_LIST_HEAD ( & iface -> addr6_list ) ; spin_lock ( & netlbl_unlhsh_lock ) ; if ( ifindex > 0 ) { bkt = netlbl_unlhsh_hash ( ifindex ) ; if ( netlbl_unlhsh_search_iface ( ifindex ) != NULL ) { add_iface_failure } list_add_tail_rcu ( & iface -> list , & netlbl_unlhsh_rcu_deref ( netlbl_unlhsh ) -> tbl [ bkt ] ) ; } else { INIT_LIST_HEAD ( & iface -> list ) ; if ( netlbl_unlhsh_rcu_deref ( netlbl_unlhsh_def ) != NULL ) { add_iface_failure } rcu_assign_pointer ( netlbl_unlhsh_def , iface ) ; } spin_unlock ( & netlbl_unlhsh_lock ) ; return iface ; add_iface_failure spin_unlock ( & netlbl_unlhsh_lock ) ; kfree ( iface ) ; return NULL ; } 