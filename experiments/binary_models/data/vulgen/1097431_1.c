CMD_FUNC ( ) { if ( ! ValidatePermissionsForPath ( "server:tsctl:view" , client , NULL , NULL , NULL ) ) { return ; } if ( MyUser ( client ) && ( ! parv [ 1 ] || strcasecmp ( parv [ 1 ] , "alltime" ) ) ) { sendnotice ( client , "/TSCTL now shows the time on all servers. You can no longer modify the time." ) ; parv [ 1 ] = "alltime" ; } if ( parv [ 1 ] && ! strcasecmp ( parv [ 1 ] , "alltime" ) ) { struct timeval currenttime_tv ; gettimeofday ( & currenttime_tv , NULL ) ; sendnotice ( client , "*** Server=%s TStime=%lld.%ld" , me . name , ( long long ) currenttime_tv . tv_sec , ( long ) currenttime_tv . tv_usec ) ; sendto_server ( client , 0 , 0 , NULL , ":%s TSCTL alltime" , client -> id ) ; return ; } } 