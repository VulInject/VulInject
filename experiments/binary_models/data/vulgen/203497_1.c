static ssize_t pscsi_set_configfs_dev_params ( struct se_device * dev , const char * page , ssize_t count ) { struct pscsi_dev_virt * pdv = PSCSI_DEV ( dev ) ; struct pscsi_hba_virt * phv = dev -> se_hba -> hba_ptr ; char * orig , * ptr , * opts ; substring_t args [ MAX_OPT_ARGS ] ; int ret = 0 , arg , token ; if ( ! opts ) { return - ENOMEM ; } orig = opts ; while ( ( ptr = strsep ( & opts , ",\n" ) ) != NULL ) { if ( ! * ptr ) { continue ; } token = match_token ( ptr , tokens , args ) ; switch ( token ) { case Opt_scsi_host_id : if ( phv -> phv_mode == PHV_LLD_SCSI_HOST_NO ) { pr_err ( "PSCSI[%d]: Unable to accept" " scsi_host_id while phv_mode ==" " PHV_LLD_SCSI_HOST_NO\n" , phv -> phv_host_id ) ; ret = - EINVAL ; out } ret = match_int ( args , & arg ) ; if ( ret ) { out } pdv -> pdv_host_id = arg ; pr_debug ( "PSCSI[%d]: Referencing SCSI Host ID:" " %d\n" , phv -> phv_host_id , pdv -> pdv_host_id ) ; pdv -> pdv_flags |= PDF_HAS_VIRT_HOST_ID ; break ; case Opt_scsi_channel_id : ret = match_int ( args , & arg ) ; if ( ret ) { out } pdv -> pdv_channel_id = arg ; pr_debug ( "PSCSI[%d]: Referencing SCSI Channel" " ID: %d\n" , phv -> phv_host_id , pdv -> pdv_channel_id ) ; pdv -> pdv_flags |= PDF_HAS_CHANNEL_ID ; break ; case Opt_scsi_target_id : ret = match_int ( args , & arg ) ; if ( ret ) { out } pdv -> pdv_target_id = arg ; pr_debug ( "PSCSI[%d]: Referencing SCSI Target" " ID: %d\n" , phv -> phv_host_id , pdv -> pdv_target_id ) ; pdv -> pdv_flags |= PDF_HAS_TARGET_ID ; break ; case Opt_scsi_lun_id : ret = match_int ( args , & arg ) ; if ( ret ) { out } pdv -> pdv_lun_id = arg ; pr_debug ( "PSCSI[%d]: Referencing SCSI LUN ID:" " %d\n" , phv -> phv_host_id , pdv -> pdv_lun_id ) ; pdv -> pdv_flags |= PDF_HAS_LUN_ID ; break ; default : break ; } } out kfree ( orig ) ; return ( ! ret ) ?count : ret ; } 