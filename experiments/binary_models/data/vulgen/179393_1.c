int submit_control_msg ( struct usb_device * udev , unsigned long pipe , void * buffer , int length , struct devrequest * setup ) { struct udevice * bus = udev -> controller_dev ; struct dm_usb_ops * ops = usb_get_ops ( bus ) ; struct usb_uclass_priv * uc_priv = uclass_get_priv ( bus -> uclass ) ; int err ; err = ops -> control ( bus , udev , pipe , buffer , length , setup ) ; if ( setup -> request == USB_REQ_SET_FEATURE && setup -> requesttype == USB_RT_PORT && setup -> value == cpu_to_le16 ( USB_PORT_FEAT_RESET ) && err == - ENXIO ) { uc_priv -> companion_device_count ++ ; } return err ; } 