static void __init timer_get_base_and_rate ( struct device_node * np , void __iomem * * base , u32 * rate ) { struct clk * timer_clk ; struct clk * pclk ; * base = of_iomap ( np , 0 ) ; if ( ! * base ) { panic ( "Unable to map regs for %s" , np -> name ) ; } pclk = of_clk_get_by_name ( np , "pclk" ) ; if ( ! IS_ERR ( pclk ) ) { if ( clk_prepare_enable ( pclk ) ) { pr_warn ( "pclk for %s is present, but could not be activated\n" , np -> name ) ; } } timer_clk = of_clk_get_by_name ( np , "timer" ) ; if ( IS_ERR ( timer_clk ) ) { try_clock_freq } if ( ! clk_prepare_enable ( timer_clk ) ) { return ; } try_clock_freq if ( of_property_read_u32 ( np , "clock-freq" , rate ) && of_property_read_u32 ( np , "clock-frequency" , rate ) ) { panic ( "No clock nor clock-frequency property for %s" , np -> name ) ; } } 