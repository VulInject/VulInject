static int tps380x_reset_probe ( struct platform_device * pdev ) { struct device * dev = & pdev -> dev ; const struct tps380x_reset_devdata * devdata ; struct tps380x_reset * tps380x ; devdata = device_get_match_data ( dev ) ; tps380x = devm_kzalloc ( dev , sizeof ( * tps380x ) , GFP_KERNEL ) ; if ( ! tps380x ) { return - ENOMEM ; } tps380x -> reset_gpio = devm_gpiod_get ( dev , "reset" , GPIOD_OUT_HIGH ) ; if ( IS_ERR ( tps380x -> reset_gpio ) ) { return dev_err_probe ( dev , PTR_ERR ( tps380x -> reset_gpio ) , "Failed to get GPIO\n" ) ; } tps380x -> reset_ms = devdata -> max_reset_ms ; tps380x -> rcdev . ops = & reset_tps380x_ops ; tps380x -> rcdev . owner = THIS_MODULE ; tps380x -> rcdev . dev = dev ; tps380x -> rcdev . of_node = dev -> of_node ; tps380x -> rcdev . of_reset_n_cells = 0 ; tps380x -> rcdev . of_xlate = tps380x_reset_of_xlate ; tps380x -> rcdev . nr_resets = 1 ; return devm_reset_controller_register ( dev , & tps380x -> rcdev ) ; } 