R_API RThreadChannel * r_th_channel_new ( RThreadFunction consumer , void * user ) { R_LOG_DEBUG ( "r_th_channel_new" ) ; RThreadChannel * tc = R_NEW0 ( RThreadChannel ) ; if ( tc ) { tc -> sem = r_th_sem_new ( 1 ) ; r_th_sem_wait ( tc -> sem ) ; tc -> lock = r_th_lock_new ( true ) ; tc -> stack = r_list_newf ( ( RListFree ) r_th_channel_message_free ) ; tc -> responses = r_list_newf ( ( RListFree ) r_th_channel_message_free ) ; } return tc ; } 