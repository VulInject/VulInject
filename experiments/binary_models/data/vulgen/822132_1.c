void SCFigureHintMasks ( SplineChar * sc , int layer ) { SplineChar * scs [ MmMax ] ; SplinePointList * spl [ MmMax ] ; RefChar * ref [ MmMax ] ; MMSet * mm = sc -> parent -> mm ; int i , instance_count , conflicts , anymore , inited ; HintMask mask ; if ( mm == NULL ) { scs [ 0 ] = sc ; instance_count = 1 ; SCClearHintMasks ( sc , layer , false ) ; } else { instance_count = mm -> instance_count ; for ( i = 0 ; i < instance_count ; ++ i ) { if ( sc -> orig_pos < mm -> instances [ i ] -> glyphcnt ) { scs [ i ] = mm -> instances [ i ] -> glyphs [ sc -> orig_pos ] ; SCClearHintMasks ( scs [ i ] , layer , false ) ; } else { scs [ i ] = NULL ; } } ResolveSplitHints ( scs , layer , instance_count ) ; } conflicts = false ; for ( i = 0 ; i < instance_count ; ++ i ) { NumberHints ( scs [ i ] ) ; if ( scs [ i ] -> hconflicts || scs [ i ] -> vconflicts ) { conflicts = true ; } } if ( ! conflicts && instance_count == 1 ) { SCFigureSimpleCounterMasks ( sc ) ; return ; } for ( i = 0 ; i < instance_count ; ++ i ) { spl [ i ] = scs [ i ] -> layers [ layer ] . splines ; ref [ i ] = scs [ i ] -> layers [ layer ] . refs ; } inited = SplFigureHintMasks ( scs , spl , instance_count , mask , false ) ; for ( ; ; ) { for ( i = 0 ; i < instance_count ; ++ i ) { if ( ref [ i ] != NULL ) { spl [ i ] = ref [ i ] -> layers [ 0 ] . splines ; } } inited = SplFigureHintMasks ( scs , spl , instance_count , mask , inited ) ; anymore = false ; for ( i = 0 ; i < instance_count ; ++ i ) { if ( ref [ i ] != NULL ) { ref [ i ] = ref [ i ] -> next ; if ( ref [ i ] != NULL ) { anymore = true ; } } } if ( ! anymore ) { break ; } } if ( instance_count == 1 ) { SCFigureSimpleCounterMasks ( sc ) ; } } 