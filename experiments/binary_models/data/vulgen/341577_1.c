void update_db_subs_timer_dbnone ( int no_lock ) { int i ; int now = ( int ) time ( NULL ) ; subs_t * s = NULL , * prev_s = NULL , * del_s ; LM_DBG ( "update_db_subs_timer_dbnone: start\n" ) ; for ( i = 0 ; i < shtable_size ; i ++ ) { if ( ! no_lock ) { lock_get ( & subs_htable [ i ] . lock ) ; } prev_s = subs_htable [ i ] . entries ; s = prev_s -> next ; while ( s ) { printf_subs ( s ) ; if ( s -> expires < now - pres_expires_offset ) { LM_DBG ( "Found expired record\n" ) ; if ( ! no_lock ) { if ( handle_expired_subs ( s ) < 0 ) { LM_ERR ( "in function handle_expired_record\n" ) ; } } del_s = s ; s = s -> next ; prev_s -> next = s ; if ( del_s -> contact . s ) { shm_free ( del_s -> contact . s ) ; } continue ; } prev_s = s ; s = s -> next ; } if ( ! no_lock ) { lock_release ( & subs_htable [ i ] . lock ) ; } } } 