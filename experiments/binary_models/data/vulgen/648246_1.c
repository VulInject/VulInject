static void init_idt ( gate_desc_t * idt ) { char ivctname [ 80 ] ; void * ivctptr ( void ) int i ; for ( i = 0 ; i < NIDT ; i ++ ) { set_gatesegd ( & idt [ i ] , ( kpti_enable == 1 ) ?& tr_resvtrap : & resvtrap , KCS_SEL , SDT_SYSIGT , TRP_KPL , idt_vector_to_ist ( T_RESVTRAP ) ) ; } for ( i = 20 ; i < 32 ; i ++ ) { set_gatesegd ( & idt [ i ] , ( kpti_enable == 1 ) ?& tr_invaltrap : & invaltrap , KCS_SEL , SDT_SYSIGT , TRP_KPL , idt_vector_to_ist ( T_INVALTRAP ) ) ; } for ( i = 32 ; i < 256 ; i ++ ) { ( void ) snprintf ( ivctname , sizeof ( ivctname ) , ( kpti_enable == 1 ) ?"tr_ivct%d" : "ivct%d" , i ) ; if ( ivctptr == NULL ) { panic ( "kobj_getsymvalue(%s) failed" , ivctname ) ; } set_gatesegd ( & idt [ i ] , ivctptr , KCS_SEL , SDT_SYSIGT , TRP_KPL , idt_vector_to_ist ( i ) ) ; } init_idt_common ( idt ) ; } 