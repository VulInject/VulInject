DSDContext * s ; int i ; uint8_t silence ; if ( ! avctx -> ch_layout . nb_channels ) { return AVERROR_INVALIDDATA ; } ff_init_dsd_data ( ) ; s = av_malloc_array ( sizeof ( DSDContext ) , avctx -> ch_layout . nb_channels ) ; silence = avctx -> codec_id == AV_CODEC_ID_DSD_LSBF || avctx -> codec_id == AV_CODEC_ID_DSD_LSBF_PLANAR ?DSD_SILENCE_REVERSED : DSD_SILENCE ; for ( i = 0 ; i < avctx -> ch_layout . nb_channels ; i ++ ) { s [ i ] . pos = 0 ; memset ( s [ i ] . buf , silence , sizeof ( s [ i ] . buf ) ) ; } avctx -> sample_fmt = AV_SAMPLE_FMT_FLTP ; avctx -> priv_data = s ; return 0 ; 