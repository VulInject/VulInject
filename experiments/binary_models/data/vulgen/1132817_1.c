static int i40eDeviceSetRSSFlowQueues ( int port_id , const char * port_name , struct rte_eth_rss_conf rss_conf , int nb_rx_queues ) { struct rte_flow_action_rss rss_action_conf = { 0 } ; struct rte_flow_attr attr = { 0 } ; struct rte_flow_item pattern [ ] { { 0 } { 0 } { 0 } { 0 } } ; ; struct rte_flow_action action [ ] { { 0 } { 0 } } ; ; struct rte_flow * flow ; struct rte_flow_error flow_error = { 0 } ; for ( int i = 0 ; i < nb_rx_queues ; ++ i ) { queues [ i ] = i ; } rss_action_conf . func = RTE_ETH_HASH_FUNCTION_DEFAULT ; rss_action_conf . level = 0 ; rss_action_conf . types = 0 ; rss_action_conf . key_len = 0 ; rss_action_conf . key = NULL ; if ( nb_rx_queues < 1 ) { FatalError ( "The number of queues for RSS configuration must be " "configured with a positive number" ) ; } rss_action_conf . queue_num = nb_rx_queues ; rss_action_conf . queue = queues ; attr . ingress = 1 ; pattern [ 0 ] . type = RTE_FLOW_ITEM_TYPE_END ; action [ 0 ] . type = RTE_FLOW_ACTION_TYPE_RSS ; action [ 0 ] . conf = & rss_action_conf ; action [ 1 ] . type = RTE_FLOW_ACTION_TYPE_END ; flow = rte_flow_create ( port_id , & attr , pattern , action , & flow_error ) ; if ( flow == NULL ) { SCLogError ( "Error when creating rte_flow rule on %s: %s" , port_name , flow_error . message ) ; int ret = rte_flow_validate ( port_id , & attr , pattern , action , & flow_error ) ; SCLogError ( "Error on rte_flow validation for port %s: %s errmsg: %s" , port_name , rte_strerror ( - ret ) , flow_error . message ) ; return ret ; } else { SCLogInfo ( "RTE_FLOW queue region created for port %s" , port_name ) ; } return 0 ; } 