DUK_LOCAL void duk__advance_helper ( duk_compiler_ctx * comp_ctx , duk_small_int_t expect ) { duk_hthread * thr = comp_ctx -> thr ; duk_context * ctx = ( duk_context * ) thr ; duk_bool_t regexp ; DUK_ASSERT ( comp_ctx -> curr_token . t >= 0 && comp_ctx -> curr_token . t <= DUK_TOK_MAXVAL ) ; regexp = 1 ; if ( duk__token_lbp [ comp_ctx -> curr_token . t ] & DUK__TOKEN_LBP_FLAG_NO_REGEXP ) { regexp = 0 ; } if ( comp_ctx -> curr_func . reject_regexp_in_adv ) { comp_ctx -> curr_func . reject_regexp_in_adv = 0 ; regexp = 0 ; } if ( expect >= 0 && comp_ctx -> curr_token . t != expect ) { DUK_D ( DUK_DPRINT ( "parse error: expect=%ld, got=%ld" , ( long ) expect , ( long ) comp_ctx -> curr_token . t ) ) ; } DUK_MEMCPY ( & comp_ctx -> prev_token , & comp_ctx -> curr_token , sizeof ( duk_token ) ) ; duk_copy ( ctx , comp_ctx -> tok11_idx , comp_ctx -> tok21_idx ) ; duk_copy ( ctx , comp_ctx -> tok12_idx , comp_ctx -> tok22_idx ) ; duk_lexer_parse_js_input_element ( & comp_ctx -> lex , & comp_ctx -> curr_token , comp_ctx -> curr_func . is_strict , regexp ) ; DUK_DDD ( DUK_DDDPRINT ( "advance: curr: tok=%ld/%ld,%ld,term=%ld,%!T,%!T " "prev: tok=%ld/%ld,%ld,term=%ld,%!T,%!T" , ( long ) comp_ctx -> curr_token . t , ( long ) comp_ctx -> curr_token . t_nores , ( long ) comp_ctx -> curr_token . start_line , ( long ) comp_ctx -> curr_token . lineterm , ( duk_tval * ) duk_get_tval ( ctx , comp_ctx -> tok11_idx ) , ( duk_tval * ) duk_get_tval ( ctx , comp_ctx -> tok12_idx ) , ( long ) comp_ctx -> prev_token . t , ( long ) comp_ctx -> prev_token . t_nores , ( long ) comp_ctx -> prev_token . start_line , ( long ) comp_ctx -> prev_token . lineterm , ( duk_tval * ) duk_get_tval ( ctx , comp_ctx -> tok21_idx ) , ( duk_tval * ) duk_get_tval ( ctx , comp_ctx -> tok22_idx ) ) ) ; } 