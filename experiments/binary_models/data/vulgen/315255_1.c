void mwifiex_cmd_timeout_func ( unsigned long function_context ) { struct mwifiex_adapter * adapter = ( mwifiex_adapter * ) function_context ; struct cmd_ctrl_node * cmd_node ; adapter -> is_cmd_timedout = 1 ; if ( ! adapter -> curr_cmd ) { mwifiex_dbg ( adapter , ERROR , "cmd: empty curr_cmd\n" ) ; return ; } cmd_node = adapter -> curr_cmd ; if ( cmd_node ) { adapter -> dbg . timeout_cmd_id = adapter -> dbg . last_cmd_id [ adapter -> dbg . last_cmd_index ] ; adapter -> dbg . timeout_cmd_act = adapter -> dbg . last_cmd_act [ adapter -> dbg . last_cmd_index ] ; mwifiex_dbg ( adapter , MSG , "%s: Timeout cmd id = %#x, act = %#x\n" , __func__ , adapter -> dbg . timeout_cmd_id , adapter -> dbg . timeout_cmd_act ) ; mwifiex_dbg ( adapter , MSG , "num_data_h2c_failure = %d\n" , adapter -> dbg . num_tx_host_to_card_failure ) ; mwifiex_dbg ( adapter , MSG , "num_cmd_h2c_failure = %d\n" , adapter -> dbg . num_cmd_host_to_card_failure ) ; mwifiex_dbg ( adapter , MSG , "is_cmd_timedout = %d\n" , adapter -> is_cmd_timedout ) ; mwifiex_dbg ( adapter , MSG , "num_tx_timeout = %d\n" , adapter -> dbg . num_tx_timeout ) ; mwifiex_dbg ( adapter , MSG , "last_cmd_index = %d\n" , adapter -> dbg . last_cmd_index ) ; mwifiex_dbg ( adapter , MSG , "last_cmd_id: %*ph\n" , ( int ) sizeof ( adapter -> dbg . last_cmd_id ) , adapter -> dbg . last_cmd_id ) ; mwifiex_dbg ( adapter , MSG , "last_cmd_act: %*ph\n" , ( int ) sizeof ( adapter -> dbg . last_cmd_act ) , adapter -> dbg . last_cmd_act ) ; mwifiex_dbg ( adapter , MSG , "last_cmd_resp_index = %d\n" , adapter -> dbg . last_cmd_resp_index ) ; mwifiex_dbg ( adapter , MSG , "last_cmd_resp_id: %*ph\n" , ( int ) sizeof ( adapter -> dbg . last_cmd_resp_id ) , adapter -> dbg . last_cmd_resp_id ) ; mwifiex_dbg ( adapter , MSG , "last_event_index = %d\n" , adapter -> dbg . last_event_index ) ; mwifiex_dbg ( adapter , MSG , "last_event: %*ph\n" , ( int ) sizeof ( adapter -> dbg . last_event ) , adapter -> dbg . last_event ) ; mwifiex_dbg ( adapter , MSG , "data_sent=%d cmd_sent=%d\n" , adapter -> data_sent , adapter -> cmd_sent ) ; mwifiex_dbg ( adapter , MSG , "ps_mode=%d ps_state=%d\n" , adapter -> ps_mode , adapter -> ps_state ) ; if ( cmd_node -> wait_q_enabled ) { adapter -> cmd_wait_q . status = - ETIMEDOUT ; mwifiex_cancel_pending_ioctl ( adapter ) ; } } if ( adapter -> if_ops . device_dump ) { adapter -> if_ops . device_dump ( adapter ) ; } if ( adapter -> if_ops . card_reset ) { adapter -> if_ops . card_reset ( adapter ) ; } } 