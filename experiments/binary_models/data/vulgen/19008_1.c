static void remote_object_machine_done ( Notifier * notifier , void * data ) { RemoteObject * o = container_of ( notifier , RemoteObject , machine_done ) ; DeviceState * dev = NULL ; QIOChannel * ioc = NULL ; Coroutine * co = NULL ; RemoteCommDev * comdev = NULL ; Error * err = NULL ; dev = qdev_find_recursive ( sysbus_get_default ( ) , o -> devid ) ; if ( ! dev || ! object_dynamic_cast ( OBJECT ( dev ) , TYPE_PCI_DEVICE ) ) { error_report ( "%s is not a PCI device" , o -> devid ) ; return ; } ioc = qio_channel_new_fd ( o -> fd , & err ) ; if ( ! ioc ) { error_report_err ( err ) ; return ; } qio_channel_set_blocking ( ioc , false , NULL ) ; o -> dev = dev ; o -> listener . unrealize = remote_object_unrealize_listener ; device_listener_register ( & o -> listener ) ; * comdev = ( RemoteCommDev ) { . ioc = ioc . dev = PCI_DEVICE ( dev ) } ; co = qemu_coroutine_create ( mpqemu_remote_msg_loop_co , comdev ) ; qemu_coroutine_enter ( co ) ; } 