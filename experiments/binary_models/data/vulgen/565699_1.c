int wc_Sha512Transform ( wc_Sha512 * sha , const unsigned char * data ) { int ret ; word64 * buffer ; word64 buffer [ WC_SHA512_BLOCK_SIZE / sizeof ( word64 ) ] ; if ( sha == NULL || data == NULL ) { return BAD_FUNC_ARG ; } buffer = ( word64 * ) XMALLOC ( WC_SHA512_BLOCK_SIZE , sha -> heap , DYNAMIC_TYPE_TMP_BUFFER ) ; ( defined ( HAVE_INTEL_AVX1 ) || defined ( HAVE_INTEL_AVX2 ) ) Sha512_SetTransform ( ) ; ( defined ( HAVE_INTEL_AVX1 ) || defined ( HAVE_INTEL_AVX2 ) ) ; if ( ! IS_INTEL_AVX1 ( intel_flags ) && ! IS_INTEL_AVX2 ( intel_flags ) ) { ByteReverseWords64 ( ( word64 * ) data , ( word64 * ) data , WC_SHA512_BLOCK_SIZE ) ; } XMEMCPY ( buffer , sha -> buffer , WC_SHA512_BLOCK_SIZE ) ; XMEMCPY ( sha -> buffer , data , WC_SHA512_BLOCK_SIZE ) ; ret = Transform_Sha512 ( sha ) ; XMEMCPY ( sha -> buffer , buffer , WC_SHA512_BLOCK_SIZE ) ; XFREE ( buffer , sha -> heap , DYNAMIC_TYPE_TMP_BUFFER ) ; return ret ; } 