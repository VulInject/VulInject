static void bcwrite_header ( BCWriteCtx * ctx ) { GCstr * chunkname = proto_chunkname ( ctx -> pt ) ; const char * name = strdata ( chunkname ) ; MSize len = chunkname -> len ; char * p = lj_buf_need ( & ctx -> sb , 5 + 5 + len ) ; * p ++ = BCDUMP_HEAD1 ; * p ++ = BCDUMP_HEAD2 ; * p ++ = BCDUMP_HEAD3 ; * p ++ = BCDUMP_VERSION ; * p ++ = ( ctx -> strip ?BCDUMP_F_STRIP : 0 ) + LJ_BE * BCDUMP_F_BE + ( ( ctx -> pt -> flags & PROTO_FFI ) ?BCDUMP_F_FFI : 0 ) + LJ_FR2 * BCDUMP_F_FR2 ; if ( ! ctx -> strip ) { p = lj_strfmt_wuleb128 ( p , len ) ; } ctx -> status = ctx -> wfunc ( sbufL ( & ctx -> sb ) , sbufB ( & ctx -> sb ) , ( MSize ) ( p - sbufB ( & ctx -> sb ) ) , ctx -> wdata ) ; } 