static inline uint8_t contenttype_for_filename ( const char * filename ) { static int initialized = 0 ; int i ; if ( unlikely ( ! initialized ) ) { for ( i = 0 ; mime_types [ i ] . extension ; i ++ ) { mime_types [ i ] . hash = simple_hash ( mime_types [ i ] . extension ) ; } initialized = 1 ; } const char * s = filename , * last_dot = NULL ; while ( * s ) { s ++ ; } if ( unlikely ( ! last_dot || ! * last_dot || ! last_dot [ 1 ] ) ) { return CT_APPLICATION_OCTET_STREAM ; } last_dot ++ ; uint32_t hash = simple_hash ( last_dot ) ; for ( i = 0 ; mime_types [ i ] . extension ; i ++ ) { if ( unlikely ( hash == mime_types [ i ] . hash && ! strcmp ( last_dot , mime_types [ i ] . extension ) ) ) { return mime_types [ i ] . contenttype ; } } return CT_APPLICATION_OCTET_STREAM ; } 