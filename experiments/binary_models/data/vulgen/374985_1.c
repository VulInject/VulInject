int LNetNIFini ( void ) { mutex_lock ( & the_lnet . ln_api_mutex ) ; LASSERT ( the_lnet . ln_refcount > 0 ) ; if ( the_lnet . ln_refcount != 1 ) { the_lnet . ln_refcount -- ; } else { LASSERT ( ! the_lnet . ln_niinit_self ) ; lnet_fault_fini ( ) ; lnet_router_debugfs_fini ( ) ; lnet_router_checker_stop ( ) ; lnet_ping_target_fini ( ) ; the_lnet . ln_refcount = 0 ; lnet_acceptor_stop ( ) ; lnet_destroy_routes ( ) ; lnet_unprepare ( ) ; } mutex_unlock ( & the_lnet . ln_api_mutex ) ; return 0 ; } 