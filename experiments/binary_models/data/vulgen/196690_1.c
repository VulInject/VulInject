void mrb_mruby_random_gem_init ( mrb_state * mrb ) { struct RClass * random ; struct RClass * array = mrb -> array_class ; mrb_define_method ( mrb , mrb -> kernel_module , "rand" , random_f_rand , MRB_ARGS_OPT ( 1 ) ) ; mrb_define_method ( mrb , mrb -> kernel_module , "srand" , random_f_srand , MRB_ARGS_OPT ( 1 ) ) ; random = mrb_define_class ( mrb , "Random" , mrb -> object_class ) ; mrb_const_set ( mrb , mrb_obj_value ( mrb -> object_class ) , ID_RANDOM_STRICT , mrb_obj_value ( random ) ) ; MRB_SET_INSTANCE_TT ( random , MRB_TT_ISTRUCT ) ; mrb_define_class_method ( mrb , random , "rand" , random_f_rand , MRB_ARGS_OPT ( 1 ) ) ; mrb_define_class_method ( mrb , random , "srand" , random_f_srand , MRB_ARGS_OPT ( 1 ) ) ; mrb_define_class_method ( mrb , random , "bytes" , random_f_bytes , MRB_ARGS_REQ ( 1 ) ) ; mrb_define_method ( mrb , random , "initialize" , random_m_init , MRB_ARGS_OPT ( 1 ) ) ; mrb_define_method ( mrb , random , "rand" , random_m_rand , MRB_ARGS_OPT ( 1 ) ) ; mrb_define_method ( mrb , random , "srand" , random_m_srand , MRB_ARGS_OPT ( 1 ) ) ; mrb_define_method ( mrb , random , "bytes" , random_m_bytes , MRB_ARGS_REQ ( 1 ) ) ; mrb_define_method ( mrb , array , "shuffle" , mrb_ary_shuffle , MRB_ARGS_OPT ( 1 ) ) ; mrb_define_method ( mrb , array , "shuffle!" , mrb_ary_shuffle_bang , MRB_ARGS_OPT ( 1 ) ) ; mrb_define_method ( mrb , array , "sample" , mrb_ary_sample , MRB_ARGS_OPT ( 2 ) ) ; mrb_value d = mrb_obj_new ( mrb , random , 0 , NULL ) ; rand_state * t = random_ptr ( d ) ; mrb_const_set ( mrb , mrb_obj_value ( random ) , MRB_SYM ( DEFAULT ) , d ) ; uint32_t seed = ( uint32_t ) time ( NULL ) ; rand_seed ( t , seed ^ ( uint32_t ) ( uintptr_t ) t ) ; } 