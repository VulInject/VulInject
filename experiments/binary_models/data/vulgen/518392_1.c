enum ike_id_type id_to_payload ( const struct id * id , const ip_address * host , shunk_t * body ) { int type ; shunk_t tl ; switch ( id -> kind ) { case ID_NONE : type = address_type ( host ) -> id_ip_addr ; tl = address_as_shunk ( host ) ; break ; case ID_FROMCERT : type = ID_DER_ASN1_DN ; tl = shunk2 ( id -> name . ptr , id -> name . len ) ; break ; case ID_FQDN : case ID_USER_FQDN : case ID_DER_ASN1_DN : case ID_KEY_ID : type = id -> kind ; tl = shunk2 ( id -> name . ptr , id -> name . len ) ; break ; case ID_IPV4_ADDR : case ID_IPV6_ADDR : type = id -> kind ; tl = address_as_shunk ( & id -> ip_addr ) ; break ; case ID_NULL : type = id -> kind ; break ; default : bad_case ( id -> kind ) ; } * body = tl ; return type ; } 