if ( compressedVector == - 1 ) { oldsize += 4 ; MSG_WriteBits ( msg , 1 , 1 ) ; for ( i = 0 ; i + 8 <= numFields ; i += 8 ) { MSG_WriteByte ( msg , changeVector [ i >> 3 ] ) ; } if ( numFields & 7 ) { MSG_WriteBits ( msg , changeVector [ i >> 3 ] , numFields & 7 ) ; } if ( print ) { Com_Printf ( "<uc>" ) ; } } else { MSG_WriteBits ( msg , 0 , 1 ) ; MSG_WriteBits ( msg , compressedVector , SMALL_VECTOR_BITS ) ; if ( print ) { Com_Printf ( "<%2i>" , compressedVector ) ; } } for ( i = 0 , field = entityStateFields ; i < numFields ; i ++ , field ++ ) { fromF = ( int * ) ( ( byte * ) from + field -> offset ) ; toF = ( int * ) ( ( byte * ) to + field -> offset ) ; if ( * fromF == * toF ) { continue ; } if ( field -> bits == 0 ) { fullFloat = * ( float * ) toF ; trunc = ( int ) fullFloat ; if ( fullFloat == 0.0f ) { MSG_WriteBits ( msg , 0 , 1 ) ; oldsize += FLOAT_INT_BITS ; } else { MSG_WriteBits ( msg , 1 , 1 ) ; if ( trunc == fullFloat && trunc + FLOAT_INT_BIAS >= 0 && trunc + FLOAT_INT_BIAS < ( 1 << FLOAT_INT_BITS ) ) { MSG_WriteBits ( msg , 0 , 1 ) ; if ( print ) { Com_Printf ( "%s:%i " , field -> name , trunc ) ; } } else { MSG_WriteBits ( msg , 1 , 1 ) ; MSG_WriteBits ( msg , * toF , 32 ) ; if ( print ) { Com_Printf ( "%s:%f " , field -> name , * ( float * ) toF ) ; } } } } else { if ( * toF == 0 ) { MSG_WriteBits ( msg , 0 , 1 ) ; } else { MSG_WriteBits ( msg , 1 , 1 ) ; MSG_WriteBits ( msg , * toF , field -> bits ) ; if ( print ) { Com_Printf ( "%s:%i " , field -> name , * toF ) ; } } } } if ( print ) { if ( msg -> bit == 0 ) { endBit = msg -> cursize * 8 - GENTITYNUM_BITS ; } else { endBit = ( msg -> cursize - 1 ) * 8 + msg -> bit - GENTITYNUM_BITS ; } Com_Printf ( " (%i bits)\n" , endBit - startBit ) ; } 