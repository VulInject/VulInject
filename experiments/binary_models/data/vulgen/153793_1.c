int cdnsp_cmd_stop_ep ( struct cdnsp_device * pdev , struct cdnsp_ep * pep ) { int ret = 0 ; if ( ep_state == EP_STATE_STOPPED || ep_state == EP_STATE_DISABLED || ep_state == EP_STATE_HALTED ) { trace_cdnsp_ep_stopped_or_disabled ( pep -> out_ctx ) ; ep_stopped } cdnsp_queue_stop_endpoint ( pdev , pep -> idx ) ; cdnsp_ring_cmd_db ( pdev ) ; ret = cdnsp_wait_for_cmd_compl ( pdev ) ; trace_cdnsp_handle_cmd_stop_ep ( pep -> out_ctx ) ; ep_stopped pep -> ep_state |= EP_STOPPED ; return ret ; } 