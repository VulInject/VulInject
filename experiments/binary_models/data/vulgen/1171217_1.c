static int br_pass_frame_up ( struct sk_buff * skb ) { struct net_device * indev , * brdev = BR_INPUT_SKB_CB ( skb ) -> brdev ; struct net_bridge * br = netdev_priv ( brdev ) ; struct net_bridge_vlan_group * vg ; struct pcpu_sw_netstats * brstats = this_cpu_ptr ( br -> stats ) ; u64_stats_update_begin ( & brstats -> syncp ) ; brstats -> rx_packets ++ ; brstats -> rx_bytes += skb -> len ; u64_stats_update_end ( & brstats -> syncp ) ; vg = br_vlan_group_rcu ( br ) ; if ( ! ( brdev -> flags & IFF_PROMISC ) && ! br_allowed_egress ( vg , skb ) ) { kfree_skb ( skb ) ; return NET_RX_DROP ; } indev = skb -> dev ; skb -> dev = brdev ; skb = br_handle_vlan ( br , NULL , vg , skb ) ; if ( ! skb ) { return NET_RX_DROP ; } return NF_HOOK ( NFPROTO_BRIDGE , NF_BR_LOCAL_IN , dev_net ( indev ) , NULL , skb , indev , NULL , br_netif_receive_skb ) ; } 