static int git_apply__to_index ( git_repository * repo , git_diff * diff , git_index * preimage , git_index * postimage , git_apply_options * opts ) { git_index * index = NULL ; const git_diff_delta * delta ; const git_index_entry * entry ; size_t i ; int error ; GIT_UNUSED ( preimage ) ; GIT_UNUSED ( opts ) ; for ( i = 0 ; i < git_diff_num_deltas ( diff ) ; i ++ ) { delta = git_diff_get_delta ( diff , i ) ; if ( delta -> status == GIT_DELTA_DELETED || delta -> status == GIT_DELTA_RENAMED ) { if ( ( error = git_index_remove ( index , delta -> old_file . path , 0 ) ) < 0 ) { done } } } for ( i = 0 ; i < git_index_entrycount ( postimage ) ; i ++ ) { entry = git_index_get_byindex ( postimage , i ) ; if ( ( error = git_index_add ( index , entry ) ) < 0 ) { done } } done git_index_free ( index ) ; return error ; } 