FILE * uget ( char * url ) { struct addrinfo * ai ; ssize_t num ; uint16_t port = 80 ; FILE * fp ; char * server = NULL , * location = NULL ; char * ptr ; char buf [ 256 ] ; int header = 1 ; int sd ; split ( url , & server , & port , & location ) ; if ( nslookup ( server , port , & ai ) ) { return NULL ; } sd = hello ( ai , port , location ) ; if ( - 1 == sd ) { return NULL ; } fp = tmpfile ( ) ; while ( ( num = recv ( sd , buf , sizeof ( buf ) - 1 , 0 ) ) > 0 ) { buf [ num ] = 0 ; if ( header ) { if ( ! strstr ( buf , "200 OK" ) ) { break ; } ptr = strstr ( buf , "\r\n\r\n" ) ; if ( ! ptr ) { break ; } ptr += 4 ; fputs ( ptr , fp ) ; header = 0 ; continue ; } fputs ( buf , fp ) ; } shutdown ( sd , SHUT_RDWR ) ; close ( sd ) ; rewind ( fp ) ; return fp ; } 