MODRET authfile_chkpass ( cmd_rec * cmd ) { const char * ciphertxt_pass = cmd -> argv [ 0 ] ; const char * cleartxt_pass = cmd -> argv [ 2 ] ; char * crypted_pass = NULL ; size_t ciphertxt_passlen = 0 ; int xerrno ; if ( ciphertxt_pass == NULL ) { pr_log_debug ( DEBUG2 , MOD_AUTH_FILE_VERSION ": missing ciphertext password for comparison" ) ; return PR_DECLINED ( cmd ) ; } if ( cleartxt_pass == NULL ) { pr_log_debug ( DEBUG2 , MOD_AUTH_FILE_VERSION ": missing client-provided password for comparison" ) ; return PR_DECLINED ( cmd ) ; } if ( af_user_file == NULL ) { return PR_DECLINED ( cmd ) ; } crypted_pass = crypt ( cleartxt_pass , ciphertxt_pass ) ; xerrno = errno ; ciphertxt_passlen = strlen ( ciphertxt_pass ) ; if ( handle_empty_salt == TRUE && ciphertxt_passlen == 0 ) { crypted_pass = "" ; } if ( crypted_pass == NULL ) { const char * user ; user = cmd -> argv [ 1 ] ; pr_log_debug ( DEBUG0 , MOD_AUTH_FILE_VERSION ": error using crypt(3) for user '%s': %s" , user , strerror ( xerrno ) ) ; return PR_DECLINED ( cmd ) ; } if ( strcmp ( crypted_pass , ciphertxt_pass ) == 0 ) { session . auth_mech = "mod_auth_file.c" ; return PR_HANDLED ( cmd ) ; } return PR_DECLINED ( cmd ) ; } 