* / CMD_FUNC ( ) { Client * agent_p = NULL if ( ! SASL_SERVER || ! MyConnect ( client ) || BadPtr ( parv [ 1 ] ) || ! HasCapability ( client , "sasl" ) ) { return ; } } ; if ( ( parv [ 1 ] [ 0 ] == ':' ) || strchr ( parv [ 1 ] , ' ' ) ) { sendnumeric ( client , ERR_CANNOTDOCOMMAND , "AUTHENTICATE" , "Invalid parameter" ) ; return ; } if ( strlen ( parv [ 1 ] ) > 400 ) { sendnumeric ( client , ERR_SASLTOOLONG ) ; return ; } if ( * client -> local -> sasl_agent ) { agent_p = find_client ( client -> local -> sasl_agent , NULL ) ; } if ( agent_p == NULL ) { char * addr = BadPtr ( client -> ip ) ?"0" : client -> ip ; const char * certfp = moddata_client_get ( client , "certfp" ) ; sendto_server ( NULL , 0 , 0 , NULL , ":%s SASL %s %s H %s %s" , me . name , SASL_SERVER , client -> id , addr , addr ) ; if ( certfp ) { sendto_server ( NULL , 0 , 0 , NULL , ":%s SASL %s %s S %s %s" , me . name , SASL_SERVER , client -> id , parv [ 1 ] , certfp ) ; } else { sendto_server ( NULL , 0 , 0 , NULL , ":%s SASL %s %s S %s" , me . name , SASL_SERVER , client -> id , parv [ 1 ] ) ; } } else { sendto_server ( NULL , 0 , 0 , NULL , ":%s SASL %s %s C %s" , me . name , AGENT_SID ( agent_p ) , client -> id , parv [ 1 ] ) ; } client -> local -> sasl_out ++ ; client -> local -> sasl_sent_time = TStime ( ) ; 