acpi_status acpi_ex_write_data_to_field ( union acpi_operand_object * source_desc , union acpi_operand_object * obj_desc , union acpi_operand_object * * result_desc ) { acpi_status status ; u32 buffer_length ; u32 data_length ; void * buffer ; ACPI_FUNCTION_TRACE_PTR ( ex_write_data_to_field , obj_desc ) ; if ( obj_desc -> common . type == ACPI_TYPE_BUFFER_FIELD ) { if ( ! ( obj_desc -> common . flags & AOPOBJ_DATA_VALID ) ) { status = acpi_ds_get_buffer_field_arguments ( obj_desc ) ; if ( ACPI_FAILURE ( status ) ) { return_ACPI_STATUS ( status ) ; } } } if ( ( obj_desc -> common . type == ACPI_TYPE_LOCAL_REGION_FIELD ) && ( obj_desc -> field . region_obj -> region . space_id == ACPI_ADR_SPACE_GPIO ) ) { status = acpi_ex_write_gpio ( source_desc , obj_desc , result_desc ) ; return_ACPI_STATUS ( status ) ; } if ( ( obj_desc -> common . type == ACPI_TYPE_LOCAL_REGION_FIELD ) && ( obj_desc -> field . region_obj -> region . space_id == ACPI_ADR_SPACE_SMBUS || obj_desc -> field . region_obj -> region . space_id == ACPI_ADR_SPACE_GSBUS || obj_desc -> field . region_obj -> region . space_id == ACPI_ADR_SPACE_IPMI || obj_desc -> field . region_obj -> region . space_id == ACPI_ADR_SPACE_PLATFORM_RT || obj_desc -> field . region_obj -> region . space_id == ACPI_ADR_SPACE_FIXED_HARDWARE ) ) { status = acpi_ex_write_serial_bus ( source_desc , obj_desc , result_desc ) ; return_ACPI_STATUS ( status ) ; } if ( ( obj_desc -> common . type == ACPI_TYPE_LOCAL_REGION_FIELD ) && ( obj_desc -> field . region_obj -> region . space_id == ACPI_ADR_SPACE_PLATFORM_COMM ) ) { data_length = ( acpi_size ) ACPI_ROUND_BITS_UP_TO_BYTES ( obj_desc -> field . bit_length ) ; memcpy ( obj_desc -> field . region_obj -> field . internal_pcc_buffer + obj_desc -> field . base_byte_offset , source_desc -> buffer . pointer , data_length ) ; if ( MASTER_SUBSPACE_COMMAND ( obj_desc -> field . base_byte_offset ) ) { ACPI_DEBUG_PRINT ( ( ACPI_DB_BFIELD , "PCC COMD field has been written. Invoking PCC handler now.\n" ) ) ; status = acpi_ex_access_region ( obj_desc , 0 , ( u64 * ) obj_desc -> field . region_obj -> field . internal_pcc_buffer , ACPI_WRITE ) ; return_ACPI_STATUS ( status ) ; } return ( AE_OK ) ; } switch ( source_desc -> common . type ) { case ACPI_TYPE_INTEGER : buffer = & source_desc -> integer . value ; buffer_length = sizeof ( source_desc -> integer . value ) ; break ; case ACPI_TYPE_BUFFER : buffer = source_desc -> buffer . pointer ; buffer_length = source_desc -> buffer . length ; break ; case ACPI_TYPE_STRING : buffer = source_desc -> string . pointer ; buffer_length = source_desc -> string . length ; break ; default : return_ACPI_STATUS ( AE_AML_OPERAND_TYPE ) ; } ACPI_DEBUG_PRINT ( ( ACPI_DB_BFIELD , "FieldWrite [FROM]: Obj %p (%s:%X), Buf %p, ByteLen %X\n" , source_desc , acpi_ut_get_type_name ( source_desc -> common . type ) , source_desc -> common . type , buffer , buffer_length ) ) ; ACPI_DEBUG_PRINT ( ( ACPI_DB_BFIELD , "FieldWrite [TO]:   Obj %p (%s:%X), BitLen %X, BitOff %X, ByteOff %X\n" , obj_desc , acpi_ut_get_type_name ( obj_desc -> common . type ) , obj_desc -> common . type , obj_desc -> common_field . bit_length , obj_desc -> common_field . start_field_bit_offset , obj_desc -> common_field . base_byte_offset ) ) ; acpi_ex_acquire_global_lock ( obj_desc -> common_field . field_flags ) ; status = acpi_ex_insert_into_field ( obj_desc , buffer , buffer_length ) ; acpi_ex_release_global_lock ( obj_desc -> common_field . field_flags ) ; return_ACPI_STATUS ( status ) ; } 