{ JDIMENSION comp_width , comp_height ; JDIMENSION blk_y , x_drop_blocks , y_drop_blocks ; int ci , offset_y ; JBLOCKARRAY src_buffer , dst_buffer ; jpeg_component_info * compptr ; for ( ci = 0 ; ci < dstinfo -> num_components ; ci ++ ) { compptr = dstinfo -> comp_info + ci ; comp_width = drop_width * compptr -> h_samp_factor ; comp_height = drop_height * compptr -> v_samp_factor ; x_drop_blocks = x_crop_offset * compptr -> h_samp_factor ; y_drop_blocks = y_crop_offset * compptr -> v_samp_factor ; for ( blk_y = 0 ; blk_y < comp_height ; blk_y += compptr -> v_samp_factor ) { dst_buffer = * srcinfo -> mem -> access_virt_barray ( ( j_common_ptr ) srcinfo , src_coef_arrays [ ci ] , blk_y + y_drop_blocks , ( JDIMENSION ) compptr -> v_samp_factor , TRUE ) ; else { for ( offset_y = 0 ; offset_y < compptr -> v_samp_factor ; offset_y ++ ) { memset ( dst_buffer [ offset_y ] + x_drop_blocks , 0 , comp_width * sizeof ( JBLOCK ) ) ; } } } } } 