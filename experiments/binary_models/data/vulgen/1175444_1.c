static void cx81801_receive ( struct tty_struct * tty , const unsigned char * cp , char * fp , int count ) { struct snd_soc_codec * codec = tty -> disc_data ; const unsigned char * c ; int apply , ret ; if ( ! codec -> hw_write ) { setup_timer ( & cx81801_timer , cx81801_timeout , 0 ) ; v253_ops . receive_buf ( tty , cp , fp , count ) ; ret = snd_soc_jack_add_pins ( & ams_delta_hook_switch , ARRAY_SIZE ( ams_delta_hook_switch_pins ) , ams_delta_hook_switch_pins ) ; if ( ret ) { dev_warn ( codec -> dev , "Failed to link hook switch to DAPM pins, " "will continue with hook switch unlinked.\n" ) ; } return ; } v253_ops . receive_buf ( tty , cp , fp , count ) ; for ( c = & cp [ count - 1 ] ; c >= cp ; c -- ) { if ( * c != '\r' ) { continue ; } spin_lock_bh ( & ams_delta_lock ) ; mod_timer ( & cx81801_timer , jiffies + msecs_to_jiffies ( 150 ) ) ; apply = ! ams_delta_muted && ! cx81801_cmd_pending ; cx81801_cmd_pending = 1 ; spin_unlock_bh ( & ams_delta_lock ) ; if ( apply ) { ams_delta_latch2_write ( AMS_DELTA_LATCH2_MODEM_CODEC , AMS_DELTA_LATCH2_MODEM_CODEC ) ; } break ; } } 