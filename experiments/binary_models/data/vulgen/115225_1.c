static av_cold int decode_init ( AVCodecContext * avctx ) { static AVOnce init_static_once = AV_ONCE_INIT ; ASVDecContext * const a = avctx -> priv_data ; const int scale = avctx -> codec_id == AV_CODEC_ID_ASV1 ?1 : 2 ; int inv_qscale ; int i ; ff_asv_common_init ( avctx ) ; ff_blockdsp_init ( & a -> bdsp ) ; ff_idctdsp_init ( & a -> idsp , avctx ) ; ff_permute_scantable ( a -> permutated_scantable , ff_asv_scantab , a -> idsp . idct_permutation ) ; avctx -> pix_fmt = AV_PIX_FMT_YUV420P ; if ( avctx -> extradata_size < 1 || ( inv_qscale = avctx -> extradata [ 0 ] ) == 0 ) { av_log ( avctx , AV_LOG_ERROR , "illegal qscale 0\n" ) ; if ( avctx -> codec_id == AV_CODEC_ID_ASV1 ) { inv_qscale = 6 ; } else { inv_qscale = 10 ; } } for ( i = 0 ; i < 64 ; i ++ ) { int index = ff_asv_scantab [ i ] ; a -> intra_matrix [ i ] = 64 * scale * ff_mpeg1_default_intra_matrix [ index ] / inv_qscale ; } ff_thread_once ( & init_static_once , init_vlcs ) ; return 0 ; } 