static int __init stnic_probe ( void ) { struct net_device * dev ; struct ei_device * ei_local ; int err ; dev = alloc_ei_netdev ( ) ; if ( ! dev ) { return - ENOMEM ; } sh_bios_get_node_addr ( stnic_eadr ) ; eth_hw_addr_set ( dev , stnic_eadr ) ; dev -> base_addr = 0x1000 ; dev -> irq = IRQ_STNIC ; dev -> netdev_ops = & ei_netdev_ops ; err = request_irq ( dev -> irq , ei_interrupt , 0 , DRV_NAME , dev ) ; if ( err ) { netdev_emerg ( dev , " unable to get IRQ %d.\n" , dev -> irq ) ; free_netdev ( dev ) ; return err ; } ei_status . name = dev -> name ; ei_status . word16 = 1 ; ei_status . bigendian = 0 ; ei_status . bigendian = 1 ; ei_status . tx_start_page = START_PG ; ei_status . rx_start_page = START_PG + TX_PAGES ; ei_status . stop_page = STOP_PG ; ei_status . reset_8390 = & stnic_reset ; ei_status . get_8390_hdr = & stnic_get_hdr ; ei_status . block_input = & stnic_block_input ; ei_status . block_output = & stnic_block_output ; stnic_init ( dev ) ; ei_local = netdev_priv ( dev ) ; ei_local -> msg_enable = stnic_msg_enable ; err = register_netdev ( dev ) ; if ( err ) { free_irq ( dev -> irq , dev ) ; free_netdev ( dev ) ; return err ; } stnic_dev = dev ; netdev_info ( dev , "NS ST-NIC 83902A\n" ) ; return 0 ; } 