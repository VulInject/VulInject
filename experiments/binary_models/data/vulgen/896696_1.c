static int parse_array ( struct decode_ctx * ctx , k5_json_array * val_out ) { k5_json_array array = NULL ; int ret ; * val_out = NULL ; if ( * ctx -> p != '[' ) { return EINVAL ; } ctx -> p ++ ; if ( white_spaces ( ctx ) ) { return EINVAL ; } ret = k5_json_array_create ( & array ) ; if ( ret ) { return ret ; } if ( * ctx -> p != ']' ) { while ( 1 ) { ret = parse_array_item ( array , ctx ) ; if ( white_spaces ( ctx ) ) { invalid } if ( * ctx -> p == ']' ) { break ; } if ( * ctx -> p != ',' ) { invalid } ctx -> p ++ ; if ( white_spaces ( ctx ) ) { invalid } } } ctx -> p ++ ; * val_out = array ; return 0 ; invalid k5_json_release ( array ) ; return EINVAL ; } 