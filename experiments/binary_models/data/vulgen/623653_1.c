static void parse_cff_bytecode ( cff_File * cff , const otfcc_Options * options ) { uint32_t pos ; int32_t offset ; cff -> head . major = gu1 ( cff -> raw_data , 0 ) ; cff -> head . minor = gu1 ( cff -> raw_data , 1 ) ; cff -> head . hdrSize = gu1 ( cff -> raw_data , 2 ) ; cff -> head . offSize = gu1 ( cff -> raw_data , 3 ) ; pos = cff -> head . hdrSize ; cff_iIndex . parse ( cff -> raw_data , pos , & cff -> name ) ; pos = 4 + cff_iIndex . getLength ( & cff -> name ) ; cff_iIndex . parse ( cff -> raw_data , pos , & cff -> top_dict ) ; if ( cff -> name . count != cff -> top_dict . count ) { logWarning ( "[libcff] Bad CFF font: (%d, name), (%d, top_dict).\n" , cff -> name . count , cff -> top_dict . count ) ; } pos = 4 + cff_iIndex . getLength ( & cff -> name ) + cff_iIndex . getLength ( & cff -> top_dict ) ; cff_iIndex . parse ( cff -> raw_data , pos , & cff -> string ) ; pos = 4 + cff_iIndex . getLength ( & cff -> name ) + cff_iIndex . getLength ( & cff -> top_dict ) + cff_iIndex . getLength ( & cff -> string ) ; cff_iIndex . parse ( cff -> raw_data , pos , & cff -> global_subr ) ; if ( cff -> top_dict . data != NULL ) { int32_t offset ; offset = cff_iDict . parseDictKey ( cff -> top_dict . data , cff -> top_dict . offset [ 1 ] - cff -> top_dict . offset [ 0 ] , op_CharStrings , 0 ) . i ; if ( offset != - 1 ) { cff_iIndex . parse ( cff -> raw_data , offset , & cff -> char_strings ) ; cff -> cnt_glyph = cff -> char_strings . count ; } else { cff_iIndex . empty ( & cff -> char_strings ) ; logWarning ( "[libcff] Bad CFF font: no any glyph data.\n" ) ; } offset = cff_iDict . parseDictKey ( cff -> top_dict . data , cff -> top_dict . offset [ 1 ] - cff -> top_dict . offset [ 0 ] , op_Encoding , 0 ) . i ; if ( offset != - 1 ) { parse_encoding ( cff , offset , & cff -> encodings ) ; } else { cff -> encodings . t = cff_ENC_UNSPECED ; } offset = cff_iDict . parseDictKey ( cff -> top_dict . data , cff -> top_dict . offset [ 1 ] - cff -> top_dict . offset [ 0 ] , op_charset , 0 ) . i ; if ( offset != - 1 ) { cff_extract_Charset ( cff -> raw_data , offset , cff -> char_strings . count , & cff -> charsets ) ; } else { cff -> charsets . t = cff_CHARSET_UNSPECED ; } offset = cff_iDict . parseDictKey ( cff -> top_dict . data , cff -> top_dict . offset [ 1 ] - cff -> top_dict . offset [ 0 ] , op_FDSelect , 0 ) . i ; if ( cff -> char_strings . count && offset != - 1 ) { cff_extract_FDSelect ( cff -> raw_data , offset , cff -> char_strings . count , & cff -> fdselect ) ; } else { cff -> fdselect . t = cff_FDSELECT_UNSPECED ; } offset = cff_iDict . parseDictKey ( cff -> top_dict . data , cff -> top_dict . offset [ 1 ] - cff -> top_dict . offset [ 0 ] , op_FDArray , 0 ) . i ; if ( offset != - 1 ) { cff_iIndex . parse ( cff -> raw_data , offset , & cff -> font_dict ) ; } else { cff_iIndex . empty ( & cff -> font_dict ) ; } } { int32_t private_len = - 1 ; int32_t private_off = - 1 ; if ( private_off != - 1 && private_len != - 1 ) { offset = cff_iDict . parseDictKey ( cff -> raw_data + private_off , private_len , op_Subrs , 0 ) . i ; if ( offset != - 1 ) { cff_iIndex . parse ( cff -> raw_data , private_off + offset , & cff -> local_subr ) ; } else { cff_iIndex . empty ( & cff -> local_subr ) ; } } else { cff_iIndex . empty ( & cff -> local_subr ) ; } } } 