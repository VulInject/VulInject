DUK_EXTERNAL void duk_substring ( duk_context * ctx , duk_idx_t index , duk_size_t start_offset , duk_size_t end_offset ) { duk_hthread * thr = ( duk_hthread * ) ctx ; duk_hstring * h ; duk_hstring * res ; duk_size_t start_byte_offset ; duk_size_t end_byte_offset ; DUK_ASSERT_CTX_VALID ( ctx ) ; index = duk_require_normalize_index ( ctx , index ) ; h = duk_require_hstring ( ctx , index ) ; DUK_ASSERT ( h != NULL ) ; if ( end_offset >= DUK_HSTRING_GET_CHARLEN ( h ) ) { end_offset = DUK_HSTRING_GET_CHARLEN ( h ) ; } DUK_ASSERT_DISABLE ( start_offset >= 0 ) ; DUK_ASSERT ( start_offset <= end_offset && start_offset <= DUK_HSTRING_GET_CHARLEN ( h ) ) ; DUK_ASSERT_DISABLE ( end_offset >= 0 ) ; DUK_ASSERT ( end_offset >= start_offset && end_offset <= DUK_HSTRING_GET_CHARLEN ( h ) ) ; DUK_ASSERT ( start_offset <= DUK_UINT32_MAX ) ; DUK_ASSERT ( end_offset <= DUK_UINT32_MAX ) ; start_byte_offset = ( duk_size_t ) duk_heap_strcache_offset_char2byte ( thr , h , ( duk_uint_fast32_t ) start_offset ) ; end_byte_offset = ( duk_size_t ) duk_heap_strcache_offset_char2byte ( thr , h , ( duk_uint_fast32_t ) end_offset ) ; DUK_ASSERT ( end_byte_offset >= start_byte_offset ) ; DUK_ASSERT ( end_byte_offset - start_byte_offset <= DUK_UINT32_MAX ) ; res = duk_heap_string_intern_checked ( thr , DUK_HSTRING_GET_DATA ( h ) + start_byte_offset , ( duk_uint32_t ) ( end_byte_offset - start_byte_offset ) ) ; duk_push_hstring ( ctx , res ) ; duk_replace ( ctx , index ) ; } 