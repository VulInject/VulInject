static ssize_t divas_write ( struct file * file , const char __user * buf , size_t count , loff_t * ppos ) { int ret = - EINVAL ; if ( ! file -> private_data ) { file -> private_data = diva_xdi_open_adapter ( file , buf , count , xdi_copy_from_user ) ; } if ( ! file -> private_data ) { return ( - ENODEV ) ; } switch ( ret ) { case - 1 : ret = - EBUSY ; break ; case - 2 : ret = - ENOMEM ; break ; case - 3 : ret = - ENXIO ; break ; } DBG_TRC ( ( "write: ret %d" , ret ) ) ; return ( ret ) ; } 