static int cmd_network ( int argc , char * argv [ ] ) { if ( argc > 2 ) { fprintf ( stderr , "Too many arguments!\n" ) ; return 1 ; } if ( argc == 2 ) { return switch_network ( argv [ 1 ] ) ; } DIR * dir = opendir ( confdir ) ; if ( ! dir ) { fprintf ( stderr , "Could not read directory %s: %s\n" , confdir , strerror ( errno ) ) ; return 1 ; } struct dirent * ent ; while ( ( ent = readdir ( dir ) ) ) { if ( * ent -> d_name == '.' ) { continue ; } if ( ! strcmp ( ent -> d_name , "tinc.conf" ) ) { printf ( ".\n" ) ; continue ; } char fname [ PATH_MAX ] ; snprintf ( fname , sizeof ( fname ) , "%s/%s/tinc.conf" , confdir , ent -> d_name ) ; if ( ! access ( fname , R_OK ) ) { printf ( "%s\n" , ent -> d_name ) ; } } return 0 ; } 