MOCK_IMPL ( , , ) { int r , err ; tor_assert ( tls ) ; tor_assert ( tls -> ssl ) ; tor_assert ( tls -> state == TOR_TLS_ST_OPEN ) ; tor_assert ( len < INT_MAX ) ; r = SSL_read ( tls -> ssl , cp , ( int ) len ) ; if ( r > 0 ) { if ( tls -> got_renegotiate ) { log_info ( LD_NET , "Got a TLS renegotiation from %s" , ADDR ( tls ) ) ; if ( tls -> negotiated_callback ) { tls -> negotiated_callback ( tls , tls -> callback_arg ) ; } tls -> got_renegotiate = 0 ; } return r ; } if ( err == TOR_TLS_ZERORETURN_ || err == TOR_TLS_CLOSE ) { log_debug ( LD_NET , "read returned r=%d; TLS is closed" , r ) ; tls -> state = TOR_TLS_ST_CLOSED ; return TOR_TLS_CLOSE ; } else { tor_assert ( err != TOR_TLS_DONE ) ; log_debug ( LD_NET , "read returned r=%d, err=%d" , r , err ) ; return err ; } } 