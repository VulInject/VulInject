static int ethtool_get_link_ksettings ( struct net_device * dev , void __user * useraddr ) { int err = 0 ; struct ethtool_link_ksettings link_ksettings ; ASSERT_RTNL ( ) ; if ( ! dev -> ethtool_ops -> get_link_ksettings ) { return - EOPNOTSUPP ; } if ( copy_from_user ( & link_ksettings . base , useraddr , sizeof ( link_ksettings . base ) ) ) { return - EFAULT ; } if ( __ETHTOOL_LINK_MODE_MASK_NU32 != link_ksettings . base . link_mode_masks_nwords ) { memset ( & link_ksettings , 0 , sizeof ( link_ksettings ) ) ; link_ksettings . base . cmd = ETHTOOL_GLINKSETTINGS ; compiletime_assert ( __ETHTOOL_LINK_MODE_MASK_NU32 <= S8_MAX , "need too many bits for link modes!" ) ; link_ksettings . base . link_mode_masks_nwords = - ( ( s8 ) __ETHTOOL_LINK_MODE_MASK_NU32 ) ; if ( copy_to_user ( useraddr , & link_ksettings . base , sizeof ( link_ksettings . base ) ) ) { return - EFAULT ; } return 0 ; } memset ( & link_ksettings , 0 , sizeof ( link_ksettings ) ) ; err = dev -> ethtool_ops -> get_link_ksettings ( dev , & link_ksettings ) ; link_ksettings . base . cmd = ETHTOOL_GLINKSETTINGS ; link_ksettings . base . link_mode_masks_nwords = __ETHTOOL_LINK_MODE_MASK_NU32 ; return store_link_ksettings_for_user ( useraddr , & link_ksettings ) ; } 