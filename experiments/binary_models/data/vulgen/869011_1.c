static int __init pat_query_module ( ulong pcell_loc , ulong mod_index ) { pdc_pat_cell_mod_maddr_block_t * pa_pdc_cell ; unsigned long bytecnt ; unsigned long temp ; long status ; struct parisc_device * dev ; pa_pdc_cell = kmalloc ( sizeof ( * pa_pdc_cell ) , GFP_KERNEL ) ; if ( ! pa_pdc_cell ) { panic ( "couldn't allocate memory for PDC_PAT_CELL!" ) ; } status = pdc_pat_cell_module ( & bytecnt , pcell_loc , mod_index , PA_VIEW , pa_pdc_cell ) ; if ( status != PDC_OK ) { return status ; } temp = pa_pdc_cell -> cba ; dev = alloc_pa_dev ( PAT_GET_CBA ( temp ) , & ( pa_pdc_cell -> mod_path ) ) ; if ( ! dev ) { kfree ( pa_pdc_cell ) ; return PDC_OK ; } dev -> pcell_loc = pcell_loc ; dev -> mod_index = mod_index ; dev -> mod_info = pa_pdc_cell -> mod_info ; dev -> pmod_loc = pa_pdc_cell -> mod_location ; dev -> mod0 = pa_pdc_cell -> mod [ 0 ] ; register_parisc_device ( dev ) ; switch ( PAT_GET_ENTITY ( dev -> mod_info ) ) { pdc_pat_cell_mod_maddr_block_t io_pdc_cell ; unsigned long i ; case PAT_ENTITY_PROC : printk ( KERN_DEBUG "PAT_ENTITY_PROC: id_eid 0x%lx\n" , pa_pdc_cell -> mod [ 0 ] ) ; break ; case PAT_ENTITY_MEM : printk ( KERN_DEBUG "PAT_ENTITY_MEM: amount 0x%lx min_gni_base 0x%lx min_gni_len 0x%lx\n" , pa_pdc_cell -> mod [ 0 ] , pa_pdc_cell -> mod [ 1 ] , pa_pdc_cell -> mod [ 2 ] ) ; break ; case PAT_ENTITY_CA : printk ( KERN_DEBUG "PAT_ENTITY_CA: %ld\n" , pcell_loc ) ; break ; case PAT_ENTITY_PBC : printk ( KERN_DEBUG "PAT_ENTITY_PBC: " ) ; print_ranges case PAT_ENTITY_SBA : printk ( KERN_DEBUG "PAT_ENTITY_SBA: " ) ; print_ranges case PAT_ENTITY_LBA : printk ( KERN_DEBUG "PAT_ENTITY_LBA: " ) ; print_ranges pdc_pat_cell_module ( & bytecnt , pcell_loc , mod_index , IO_VIEW , & io_pdc_cell ) ; printk ( KERN_DEBUG "ranges %ld\n" , pa_pdc_cell -> mod [ 1 ] ) ; for ( i = 0 ; i < pa_pdc_cell -> mod [ 1 ] ; i ++ ) { printk ( KERN_DEBUG "  PA_VIEW %ld: 0x%016lx 0x%016lx 0x%016lx\n" , i , pa_pdc_cell -> mod [ 2 + i * 3 ] , pa_pdc_cell -> mod [ 3 + i * 3 ] , pa_pdc_cell -> mod [ 4 + i * 3 ] ) ; printk ( KERN_DEBUG "  IO_VIEW %ld: 0x%016lx 0x%016lx 0x%016lx\n" , i , io_pdc_cell . mod [ 2 + i * 3 ] , io_pdc_cell . mod [ 3 + i * 3 ] , io_pdc_cell . mod [ 4 + i * 3 ] ) ; } printk ( KERN_DEBUG "\n" ) ; break ; } kfree ( pa_pdc_cell ) ; return PDC_OK ; } 