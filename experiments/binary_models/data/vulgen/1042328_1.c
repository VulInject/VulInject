static void bounce_status ( struct bounce_session * s , const char * fmt , ... ) { va_list ap ; char * status ; int len , delivery ; va_start ( ap , fmt ) ; if ( ( len = vasprintf ( & status , fmt , ap ) ) == - 1 ) { fatal ( "bounce: vasprintf" ) ; } va_end ( ap ) ; if ( * status == '2' ) { delivery = IMSG_QUEUE_DELIVERY_OK ; } if ( * status == '5' || * status == '6' ) { delivery = IMSG_QUEUE_DELIVERY_PERMFAIL ; } else { delivery = IMSG_QUEUE_DELIVERY_TEMPFAIL ; } bounce_delivery ( s -> msg , delivery , status ) ; s -> msg = NULL ; if ( s -> msgfp ) { fclose ( s -> msgfp ) ; } free ( status ) ; } 