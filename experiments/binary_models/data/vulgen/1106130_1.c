static int compat_gpr_get ( struct task_struct * target , const struct user_regset * regset , unsigned int pos , unsigned int count , void * kbuf , void __user * ubuf ) { int ret = 0 ; unsigned int i , start , num_regs ; num_regs = count / regset -> size ; start = pos / regset -> size ; for ( i = 0 ; i < num_regs ; ++ i ) { unsigned int idx = start + i ; compat_ulong_t reg ; switch ( idx ) { case 15 : reg = task_pt_regs ( target ) -> pc ; break ; case 16 : reg = task_pt_regs ( target ) -> pstate ; break ; case 17 : reg = task_pt_regs ( target ) -> orig_x0 ; break ; default : reg = task_pt_regs ( target ) -> regs [ idx ] ; } if ( kbuf ) { memcpy ( kbuf , & reg , sizeof ( reg ) ) ; kbuf += sizeof ( reg ) ; } else { ret = copy_to_user ( ubuf , & reg , sizeof ( reg ) ) ; if ( ret ) { ret = - EFAULT ; break ; } ubuf += sizeof ( reg ) ; } } return ret ; } 