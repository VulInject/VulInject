struct opp_table * dev_pm_opp_set_supported_hw ( struct device * dev , const u32 * versions , unsigned int count ) { struct opp_table * opp_table ; int ret ; opp_table = dev_pm_opp_get_opp_table ( dev ) ; if ( ! opp_table ) { return ERR_PTR ( - ENOMEM ) ; } WARN_ON ( ! list_empty ( & opp_table -> opp_list ) ) ; if ( opp_table -> supported_hw ) { dev_err ( dev , "%s: Already have supported hardware list\n" , __func__ ) ; ret = - EBUSY ; err } opp_table -> supported_hw = kmemdup ( versions , count * sizeof ( * versions ) , GFP_KERNEL ) ; if ( ! opp_table -> supported_hw ) { ret = - ENOMEM ; err } opp_table -> supported_hw_count = count ; return opp_table ; err return ERR_PTR ( ret ) ; } 