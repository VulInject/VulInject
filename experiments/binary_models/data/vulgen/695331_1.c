static int avs_create_dai_link ( struct device * dev , const char * platform_name , int ssp_port , struct snd_soc_dai_link * * dai_link ) { struct snd_soc_dai_link_component * platform ; struct snd_soc_dai_link * dl ; dl = devm_kzalloc ( dev , sizeof ( * dl ) , GFP_KERNEL ) ; platform = devm_kzalloc ( dev , sizeof ( * platform ) , GFP_KERNEL ) ; if ( ! dl || ! platform ) { return - ENOMEM ; } platform -> name = platform_name ; dl -> name = devm_kasprintf ( dev , GFP_KERNEL , "SSP%d-Codec" , ssp_port ) ; dl -> cpus = devm_kzalloc ( dev , sizeof ( * dl -> cpus ) , GFP_KERNEL ) ; dl -> codecs = devm_kzalloc ( dev , sizeof ( * dl -> codecs ) , GFP_KERNEL ) ; if ( ! dl -> name || ! dl -> cpus || ! dl -> codecs ) { return - ENOMEM ; } dl -> cpus -> dai_name = devm_kasprintf ( dev , GFP_KERNEL , "SSP%d Pin" , ssp_port ) ; dl -> codecs -> dai_name = devm_kasprintf ( dev , GFP_KERNEL , RT274_CODEC_DAI ) ; if ( ! dl -> cpus -> dai_name || ! dl -> codecs -> name || ! dl -> codecs -> dai_name ) { return - ENOMEM ; } dl -> num_cpus = 1 ; dl -> num_codecs = 1 ; dl -> platforms = platform ; dl -> num_platforms = 1 ; dl -> id = 0 ; dl -> dai_fmt = SND_SOC_DAIFMT_DSP_A | SND_SOC_DAIFMT_NB_NF | SND_SOC_DAIFMT_CBS_CFS ; dl -> init = avs_rt274_codec_init ; dl -> exit = avs_rt274_codec_exit ; dl -> be_hw_params_fixup = avs_rt274_be_fixup ; dl -> nonatomic = 1 ; dl -> no_pcm = 1 ; dl -> dpcm_capture = 1 ; dl -> dpcm_playback = 1 ; * dai_link = dl ; return 0 ; } 