static usbd_status urtw_led_blink ( struct urtw_softc * sc ) { uint8_t ing ; URTW8187_DBG ( URTW_DEBUG_LED , ( sc -> sc_dev , CE_CONT , "urtw_led_blink: gpio_blinkstate %d\n" , sc -> sc_gpio_blinkstate ) ) ; if ( sc -> sc_gpio_blinkstate == URTW_LED_ON ) { ( void ) urtw_led_on ( sc , URTW_LED_GPIO ) ; } else { ( void ) urtw_led_off ( sc , URTW_LED_GPIO ) ; } sc -> sc_gpio_blinktime -- ; if ( sc -> sc_gpio_blinktime == 0 ) { ing = 1 ; } else { if ( sc -> sc_gpio_ledstate != URTW_LED_BLINK_NORMAL && sc -> sc_gpio_ledstate != URTW_LED_BLINK_SLOWLY && sc -> sc_gpio_ledstate != URTW_LED_BLINK_CM3 ) { ing = 1 ; } } if ( ing == 1 ) { if ( sc -> sc_gpio_ledstate == URTW_LED_ON && sc -> sc_gpio_ledon == 0 ) { ( void ) urtw_led_on ( sc , URTW_LED_GPIO ) ; } if ( sc -> sc_gpio_ledstate == URTW_LED_OFF && sc -> sc_gpio_ledon == 1 ) { ( void ) urtw_led_off ( sc , URTW_LED_GPIO ) ; } sc -> sc_gpio_blinktime = 0 ; sc -> sc_gpio_ledinprogress = 0 ; return ( 0 ) ; } sc -> sc_gpio_blinkstate = ( sc -> sc_gpio_blinkstate != URTW_LED_ON ) ?URTW_LED_ON : URTW_LED_OFF ; switch ( sc -> sc_gpio_ledstate ) { case URTW_LED_BLINK_NORMAL : URTW8187_DBG ( URTW_DEBUG_LED , ( sc -> sc_dev , CE_CONT , "URTW_LED_BLINK_NORMAL\n" ) ) ; return ( 1 ) ; default : URTW8187_DBG ( URTW_DEBUG_LED , ( sc -> sc_dev , CE_CONT , "unknown LED status 0x%x" , sc -> sc_gpio_ledstate ) ) ; } return ( 0 ) ; } 