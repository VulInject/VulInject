void remove_client_from_list ( Client * client ) { list_del ( & client -> client_node ) ; if ( MyConnect ( client ) ) { if ( ! list_empty ( & client -> lclient_node ) ) { list_del ( & client -> lclient_node ) ; } if ( ! list_empty ( & client -> special_node ) ) { list_del ( & client -> special_node ) ; } } if ( IsServer ( client ) ) { irccounts . servers -- ; } if ( IsUser ( client ) ) { if ( IsInvisible ( client ) ) { irccounts . invisible -- ; } if ( IsOper ( client ) && ! IsHideOper ( client ) ) { irccounts . operators -- ; VERIFY_OPERCOUNT ( client , "rmvlist" ) ; } irccounts . clients -- ; } if ( IsUnknown ( client ) || IsConnecting ( client ) || IsHandshake ( client ) || IsTLSHandshake ( client ) ) { irccounts . unknown -- ; } if ( IsUser ( client ) ) { add_history ( client , 0 ) ; off_history ( client ) ; } if ( client -> user ) { free_user ( client ) ; } if ( client -> server ) { safe_free ( client -> server -> features . usermodes ) ; safe_free ( client -> server -> features . chanmodes [ 0 ] ) ; safe_free ( client -> server -> features . chanmodes [ 1 ] ) ; safe_free ( client -> server -> features . chanmodes [ 2 ] ) ; safe_free ( client -> server -> features . chanmodes [ 3 ] ) ; safe_free ( client -> server -> features . software ) ; safe_free ( client -> server -> features . nickchars ) ; safe_free ( client -> server ) ; servs . inuse -- ; } if ( client -> local && client -> local -> fd == - 2 ) { cloc . inuse -- ; } else { crem . inuse -- ; } if ( ! list_empty ( & client -> client_node ) ) { abort ( ) ; } if ( ! list_empty ( & client -> client_hash ) ) { abort ( ) ; } if ( ! list_empty ( & client -> id_hash ) ) { abort ( ) ; } numclients -- ; list_add ( & client -> client_node , & dead_list ) ; SetDead ( client ) ; SetDeadSocket ( client ) ; return ; } 