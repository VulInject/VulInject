static int __maybe_unused synquacer_spi_resume ( struct device * dev ) { struct spi_master * master = dev_get_drvdata ( dev ) ; struct synquacer_spi * sspi = spi_master_get_devdata ( master ) ; int ret ; if ( ! pm_runtime_suspended ( dev ) ) { ret = clk_prepare_enable ( sspi -> clk ) ; if ( ret < 0 ) { dev_err ( dev , "failed to enable clk (%d)\n" , ret ) ; return ret ; } ret = synquacer_spi_enable ( master ) ; if ( ret ) { clk_disable_unprepare ( sspi -> clk ) ; dev_err ( dev , "failed to enable spi (%d)\n" , ret ) ; return ret ; } } ret = spi_master_resume ( master ) ; if ( ret < 0 ) { clk_disable_unprepare ( sspi -> clk ) ; } return ret ; } 