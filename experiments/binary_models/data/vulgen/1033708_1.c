static void entityq_add ( char * path , char * file , enum rtype type , enum location loc , struct repo * rp , unsigned char * data , size_t datasz , int talid ) { struct entity * p ; if ( ( p = calloc ( 1 , sizeof ( entity ) ) ) == NULL ) { entity_write_req ( 0 ) ; entity_free ( p ) ; } p -> type = type ; p -> location = loc ; p -> talid = talid ; p -> path = path ; if ( rp != NULL ) { p -> repoid = repo_id ( rp ) ; } p -> file = file ; p -> data = data ; p -> datasz = ( data != NULL ) ?datasz : 0 ; entity_queue ++ ; if ( rp == NULL || ! repo_queued ( rp , p ) ) { entity_write_req ( p ) ; entity_free ( p ) ; } } 