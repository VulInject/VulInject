static void sdma_flush_descq ( struct sdma_engine * sde ) { u16 head , tail ; int progress = 0 ; struct sdma_txreq * txp = get_txhead ( sde ) ; head = sde -> descq_head & sde -> sdma_mask ; tail = sde -> descq_tail & sde -> sdma_mask ; while ( head != tail ) { head = ++ sde -> descq_head & sde -> sdma_mask ; if ( txp && txp -> next_descq_idx == head ) { sde -> tx_ring [ sde -> tx_head ++ & sde -> sdma_mask ] = NULL ; complete_tx ( sde , txp , SDMA_TXREQ_S_ABORTED ) ; txp = get_txhead ( sde ) ; } progress ++ ; } if ( progress ) { sdma_desc_avail ( sde , sdma_descq_freecnt ( sde ) ) ; } } 