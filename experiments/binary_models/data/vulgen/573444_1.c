gui_buffer_merge ( , ) { struct t_gui_buffer * ptr_buffer , * ptr_first_buffer [ 2 ] , * ptr_last_buffer [ 2 ] ; if ( ! buffer || ! target_buffer ) { return ; } if ( ( gui_buffers == last_gui_buffer ) || ( buffer == target_buffer ) || ( buffer -> number == target_buffer -> number ) ) { return ; } if ( ( buffer -> type != GUI_BUFFER_TYPE_FORMATTED ) || ( target_buffer -> type != GUI_BUFFER_TYPE_FORMATTED ) ) { gui_chat_printf ( NULL , _ ( "%sIt is only possible to merge buffers with " "formatted content" ) , gui_chat_prefix [ GUI_CHAT_PREFIX_ERROR ] ) ; return ; } gui_buffer_search_range ( buffer -> number , buffer -> number , & ptr_first_buffer [ 0 ] , & ptr_last_buffer [ 0 ] , NULL ) ; if ( ! ptr_first_buffer [ 0 ] || ! ptr_last_buffer [ 0 ] ) { return ; } gui_buffer_search_range ( target_buffer -> number , target_buffer -> number , & ptr_first_buffer [ 1 ] , & ptr_last_buffer [ 1 ] , NULL ) ; if ( ! ptr_first_buffer [ 1 ] || ! ptr_last_buffer [ 1 ] ) { return ; } if ( ptr_first_buffer [ 0 ] -> prev_buffer ) { ( ptr_first_buffer [ 0 ] -> prev_buffer ) -> next_buffer = ptr_last_buffer [ 0 ] -> next_buffer ; } if ( ptr_last_buffer [ 0 ] -> next_buffer ) { ( ptr_last_buffer [ 0 ] -> next_buffer ) -> prev_buffer = ptr_first_buffer [ 0 ] -> prev_buffer ; } if ( gui_buffers == ptr_first_buffer [ 0 ] ) { gui_buffers = ptr_last_buffer [ 0 ] -> next_buffer ; } if ( last_gui_buffer == ptr_last_buffer [ 0 ] ) { last_gui_buffer = ptr_first_buffer [ 0 ] -> prev_buffer ; } if ( CONFIG_BOOLEAN ( config_look_buffer_auto_renumber ) ) { for ( ptr_buffer = ptr_last_buffer [ 0 ] -> next_buffer ; ptr_buffer ; ptr_buffer = ptr_buffer -> next_buffer ) { ptr_buffer -> number -- ; } } if ( ptr_last_buffer [ 1 ] == last_gui_buffer ) { last_gui_buffer = ptr_last_buffer [ 0 ] ; } if ( ptr_last_buffer [ 1 ] -> next_buffer ) { ( ptr_last_buffer [ 1 ] -> next_buffer ) -> prev_buffer = ptr_last_buffer [ 0 ] ; } ptr_last_buffer [ 0 ] -> next_buffer = ptr_last_buffer [ 1 ] -> next_buffer ; ptr_last_buffer [ 1 ] -> next_buffer = ptr_first_buffer [ 0 ] ; ptr_first_buffer [ 0 ] -> prev_buffer = ptr_last_buffer [ 1 ] ; for ( ptr_buffer = ptr_first_buffer [ 0 ] ; ptr_buffer ; ptr_buffer = ptr_buffer -> next_buffer ) { ptr_buffer -> number = target_buffer -> number ; } gui_line_mix_buffers ( buffer ) ; gui_buffer_set_active_buffer ( buffer ) ; gui_buffer_compute_num_displayed ( ) ; gui_window_ask_refresh ( 1 ) ; ( void ) hook_signal_send ( "buffer_merged" , WEECHAT_HOOK_SIGNAL_POINTER , buffer ) ; } 