void panic ( const char * fmt , ... ) { struct cpu_info * ci = curcpu ( ) ; int bootopt ; va_list ap ; bootopt = RB_AUTOBOOT | RB_DUMP ; splassert_ctl = 0 ; printf_flags |= TOCONS ; if ( ci -> ci_panicbuf [ 0 ] == '\0' ) { va_start ( ap , fmt ) ; vsnprintf ( ci -> ci_panicbuf , sizeof ( ci -> ci_panicbuf ) , fmt , ap ) ; va_end ( ap ) ; panic_printf ( "panic: %s\n" , ci -> ci_panicbuf ) ; } else { panic_printf ( "panic: " ) ; va_start ( ap , fmt ) ; panic_vprintf ( fmt , ap ) ; va_end ( ap ) ; panic_printf ( "\n" ) ; } if ( db_panic ) { db_enter ( ) ; } else { db_stack_dump ( ) ; } reboot ( bootopt ) ; } 