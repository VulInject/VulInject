static zend_never_inline uint8_t slow_index_convert ( HashTable * ht , const zval * dim , zend_value * value EXECUTE_DATA_DC ) { switch ( Z_TYPE_P ( dim ) ) { case IS_UNDEF : { if ( ! ( GC_FLAGS ( ht ) & IS_ARRAY_IMMUTABLE ) ) { GC_ADDREF ( ht ) ; } ZVAL_UNDEFINED_OP2 ( ) ; if ( ! ( GC_FLAGS ( ht ) & IS_ARRAY_IMMUTABLE ) && ! GC_DELREF ( ht ) ) { zend_array_destroy ( ht ) ; return IS_NULL ; } if ( EG ( exception ) ) { return IS_NULL ; } ZEND_FALLTHROUGH ; } case IS_NULL : value -> str = ZSTR_EMPTY_ALLOC ( ) ; return IS_STRING ; case IS_DOUBLE : value -> lval = zend_dval_to_lval ( Z_DVAL_P ( dim ) ) ; if ( ! zend_is_long_compatible ( Z_DVAL_P ( dim ) , value -> lval ) ) { if ( ! ( GC_FLAGS ( ht ) & IS_ARRAY_IMMUTABLE ) ) { GC_ADDREF ( ht ) ; } zend_incompatible_double_to_long_error ( Z_DVAL_P ( dim ) ) ; if ( EG ( exception ) ) { return IS_NULL ; } } return IS_LONG ; case IS_RESOURCE : if ( ! ( GC_FLAGS ( ht ) & IS_ARRAY_IMMUTABLE ) ) { GC_ADDREF ( ht ) ; } zend_use_resource_as_offset ( dim ) ; if ( ! ( GC_FLAGS ( ht ) & IS_ARRAY_IMMUTABLE ) && ! GC_DELREF ( ht ) ) { zend_array_destroy ( ht ) ; return IS_NULL ; } if ( EG ( exception ) ) { return IS_NULL ; } value -> lval = Z_RES_HANDLE_P ( dim ) ; return IS_LONG ; case IS_FALSE : value -> lval = 0 ; return IS_LONG ; case IS_TRUE : value -> lval = 1 ; return IS_LONG ; default : zend_illegal_array_offset ( dim ) ; return IS_NULL ; } } 