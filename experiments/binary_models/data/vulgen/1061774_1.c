int xpddefault_update_service_performance_data_file ( nagios_macros * mac , service * svc ) { char * raw_output = NULL ; char * processed_output = NULL ; int result = OK ; log_debug_info ( DEBUGL_FUNCTIONS , 0 , "update_service_performance_data_file()\n" ) ; if ( svc == NULL ) { return ERROR ; } if ( service_perfdata_fp == NULL || service_perfdata_file_template == NULL ) { return OK ; } raw_output = ( char * ) strdup ( service_perfdata_file_template ) ; log_debug_info ( DEBUGL_PERFDATA , 2 , "Raw service performance data file output: %s\n" , raw_output ) ; process_macros_r ( mac , raw_output , & processed_output , 0 ) ; if ( processed_output == NULL ) { return ERROR ; } log_debug_info ( DEBUGL_PERFDATA , 2 , "Processed service performance data file output: %s\n" , processed_output ) ; fputs ( processed_output , service_perfdata_fp ) ; fputc ( '\n' , service_perfdata_fp ) ; fflush ( service_perfdata_fp ) ; my_free ( raw_output ) ; return result ; } int xpddefault_update_host_performance_data_file ( nagios_macros * mac , host * hst ) { char * raw_output = NULL ; char * processed_output = NULL ; int result = OK ; log_debug_info ( DEBUGL_FUNCTIONS , 0 , "update_host_performance_data_file()\n" ) ; if ( hst == NULL ) { return ERROR ; } if ( host_perfdata_fp == NULL || host_perfdata_file_template == NULL ) { return OK ; } raw_output = ( char * ) strdup ( host_perfdata_file_template ) ; log_debug_info ( DEBUGL_PERFDATA , 2 , "Raw host performance file output: %s\n" , raw_output ) ; process_macros_r ( mac , raw_output , & processed_output , 0 ) ; if ( processed_output == NULL ) { return ERROR ; } log_debug_info ( DEBUGL_PERFDATA , 2 , "Processed host performance data file output: %s\n" , processed_output ) ; fputs ( processed_output , host_perfdata_fp ) ; fputc ( '\n' , host_perfdata_fp ) ; fflush ( host_perfdata_fp ) ; my_free ( raw_output ) ; my_free ( processed_output ) ; return result ; } int xpddefault_process_host_perfdata_file ( void ) { char * raw_command_line = NULL ; char * processed_command_line = NULL ; int early_timeout = FALSE ; double exectime = 0.0 ; int result = OK ; int macro_options = STRIP_ILLEGAL_MACRO_CHARS | ESCAPE_MACRO_CHARS ; nagios_macros mac ; log_debug_info ( DEBUGL_FUNCTIONS , 0 , "process_host_perfdata_file()\n" ) ; if ( host_perfdata_file_processing_command == NULL ) { return OK ; } memset ( & mac , 0 , sizeof ( mac ) ) ; get_raw_command_line_r ( & mac , host_perfdata_file_processing_command_ptr , host_perfdata_file_processing_command , & raw_command_line , macro_options ) ; if ( raw_command_line == NULL ) { clear_volatile_macros_r ( & mac ) ; return ERROR ; } log_debug_info ( DEBUGL_PERFDATA , 2 , "Raw host performance data file processing command line: %s\n" , raw_command_line ) ; process_macros_r ( & mac , raw_command_line , & processed_command_line , macro_options ) ; my_free ( raw_command_line ) ; if ( processed_command_line == NULL ) { clear_volatile_macros_r ( & mac ) ; return ERROR ; } log_debug_info ( DEBUGL_PERFDATA , 2 , "Processed host performance data file processing command line: %s\n" , processed_command_line ) ; xpddefault_close_host_perfdata_file ( ) ; my_system_r ( & mac , processed_command_line , perfdata_timeout , & early_timeout , & exectime , NULL , 0 ) ; clear_volatile_macros_r ( & mac ) ; xpddefault_open_host_perfdata_file ( ) ; if ( early_timeout == TRUE ) { logit ( NSLOG_RUNTIME_WARNING , TRUE , "Warning: Host performance data file processing command '%s' timed out after %d seconds\n" , processed_command_line , perfdata_timeout ) ; } my_free ( processed_command_line ) ; return result ; } int xpddefault_process_service_perfdata_file ( void ) { char * raw_command_line = NULL ; char * processed_command_line = NULL ; int early_timeout = FALSE ; double exectime = 0.0 ; int result = OK ; int macro_options = STRIP_ILLEGAL_MACRO_CHARS | ESCAPE_MACRO_CHARS ; nagios_macros mac ; log_debug_info ( DEBUGL_FUNCTIONS , 0 , "process_service_perfdata_file()\n" ) ; if ( service_perfdata_file_processing_command == NULL ) { return OK ; } memset ( & mac , 0 , sizeof ( mac ) ) ; get_raw_command_line_r ( & mac , service_perfdata_file_processing_command_ptr , service_perfdata_file_processing_command , & raw_command_line , macro_options ) ; if ( raw_command_line == NULL ) { clear_volatile_macros_r ( & mac ) ; return ERROR ; } log_debug_info ( DEBUGL_PERFDATA , 2 , "Raw service performance data file processing command line: %s\n" , raw_command_line ) ; process_macros_r ( & mac , raw_command_line , & processed_command_line , macro_options ) ; my_free ( raw_command_line ) ; if ( processed_command_line == NULL ) { clear_volatile_macros_r ( & mac ) ; return ERROR ; } log_debug_info ( DEBUGL_PERFDATA , 2 , "Processed service performance data file processing command line: %s\n" , processed_command_line ) ; xpddefault_close_service_perfdata_file ( ) ; my_system_r ( & mac , processed_command_line , perfdata_timeout , & early_timeout , & exectime , NULL , 0 ) ; xpddefault_open_service_perfdata_file ( ) ; clear_volatile_macros_r ( & mac ) ; if ( early_timeout == TRUE ) { logit ( NSLOG_RUNTIME_WARNING , TRUE , "Warning: Service performance data file processing command '%s' timed out after %d seconds\n" , processed_command_line , perfdata_timeout ) ; } my_free ( processed_command_line ) ; return result ; } 