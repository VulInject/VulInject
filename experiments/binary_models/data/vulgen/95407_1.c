static extcap_arg * extcap_parse_arg_sentence ( GList * args , extcap_token_sentence * s ) { gchar * param_value = NULL ; extcap_arg * target_arg = NULL ; extcap_value * value = NULL ; GList * entry = NULL ; extcap_sentence_type sent = EXTCAP_SENTENCE_UNKNOWN ; if ( g_ascii_strcasecmp ( s -> sentence , "arg" ) == 0 ) { sent = EXTCAP_SENTENCE_ARG ; } if ( g_ascii_strcasecmp ( s -> sentence , "value" ) == 0 ) { sent = EXTCAP_SENTENCE_VALUE ; } if ( sent == EXTCAP_SENTENCE_ARG ) { target_arg = g_new0 ( extcap_arg , 1 ) ; target_arg -> arg_type = EXTCAP_ARG_UNKNOWN ; target_arg -> save = TRUE ; if ( ( param_value = ( gchar * ) g_hash_table_lookup ( s -> param_list , ENUM_KEY ( EXTCAP_PARAM_ARGNUM ) ) ) == NULL ) { extcap_free_arg ( target_arg ) ; return NULL ; } if ( sscanf ( param_value , "%d" , & ( target_arg -> arg_num ) ) != 1 ) { extcap_free_arg ( target_arg ) ; return NULL ; } if ( ( param_value = ( gchar * ) g_hash_table_lookup ( s -> param_list , ENUM_KEY ( EXTCAP_PARAM_CALL ) ) ) == NULL ) { extcap_free_arg ( target_arg ) ; return NULL ; } target_arg -> call = g_strdup ( param_value ) ; if ( strlen ( target_arg -> call ) == 0 ) { extcap_free_arg ( target_arg ) ; return NULL ; } if ( ( param_value = ( gchar * ) g_hash_table_lookup ( s -> param_list , ENUM_KEY ( EXTCAP_PARAM_DISPLAY ) ) ) == NULL ) { extcap_free_arg ( target_arg ) ; return NULL ; } target_arg -> display = g_strdup ( param_value ) ; if ( ( param_value = ( gchar * ) g_hash_table_lookup ( s -> param_list , ENUM_KEY ( EXTCAP_PARAM_TOOLTIP ) ) ) != NULL ) { target_arg -> tooltip = g_strdup ( param_value ) ; } if ( ( param_value = ( gchar * ) g_hash_table_lookup ( s -> param_list , ENUM_KEY ( EXTCAP_PARAM_PLACEHOLDER ) ) ) != NULL ) { target_arg -> placeholder = g_strdup ( param_value ) ; } if ( ( param_value = ( gchar * ) g_hash_table_lookup ( s -> param_list , ENUM_KEY ( EXTCAP_PARAM_FILE_MUSTEXIST ) ) ) != NULL ) { target_arg -> fileexists = matches_regex ( EXTCAP_BOOLEAN_REGEX , param_value ) ; } if ( ( param_value = ( gchar * ) g_hash_table_lookup ( s -> param_list , ENUM_KEY ( EXTCAP_PARAM_FILE_EXTENSION ) ) ) != NULL ) { target_arg -> fileextension = g_strdup ( param_value ) ; } if ( ( param_value = ( gchar * ) g_hash_table_lookup ( s -> param_list , ENUM_KEY ( EXTCAP_PARAM_VALIDATION ) ) ) != NULL ) { target_arg -> regexp = g_strdup ( param_value ) ; } if ( ( param_value = ( gchar * ) g_hash_table_lookup ( s -> param_list , ENUM_KEY ( EXTCAP_PARAM_GROUP ) ) ) != NULL ) { target_arg -> group = g_strdup ( param_value ) ; } if ( ( param_value = ( gchar * ) g_hash_table_lookup ( s -> param_list , ENUM_KEY ( EXTCAP_PARAM_REQUIRED ) ) ) != NULL ) { target_arg -> is_required = matches_regex ( EXTCAP_BOOLEAN_REGEX , param_value ) ; } if ( ( param_value = ( gchar * ) g_hash_table_lookup ( s -> param_list , ENUM_KEY ( EXTCAP_PARAM_TYPE ) ) ) == NULL ) { extcap_free_arg ( target_arg ) ; return NULL ; } if ( g_ascii_strcasecmp ( param_value , "integer" ) == 0 ) { target_arg -> arg_type = EXTCAP_ARG_INTEGER ; } if ( g_ascii_strcasecmp ( param_value , "unsigned" ) == 0 ) { target_arg -> arg_type = EXTCAP_ARG_UNSIGNED ; } if ( g_ascii_strcasecmp ( param_value , "long" ) == 0 ) { target_arg -> arg_type = EXTCAP_ARG_LONG ; } if ( g_ascii_strcasecmp ( param_value , "double" ) == 0 ) { target_arg -> arg_type = EXTCAP_ARG_DOUBLE ; } if ( g_ascii_strcasecmp ( param_value , "boolean" ) == 0 ) { target_arg -> arg_type = EXTCAP_ARG_BOOLEAN ; } if ( g_ascii_strcasecmp ( param_value , "boolflag" ) == 0 ) { target_arg -> arg_type = EXTCAP_ARG_BOOLFLAG ; } if ( g_ascii_strcasecmp ( param_value , "selector" ) == 0 ) { target_arg -> arg_type = EXTCAP_ARG_SELECTOR ; } if ( g_ascii_strcasecmp ( param_value , "editselector" ) == 0 ) { target_arg -> arg_type = EXTCAP_ARG_EDIT_SELECTOR ; } if ( g_ascii_strcasecmp ( param_value , "radio" ) == 0 ) { target_arg -> arg_type = EXTCAP_ARG_RADIO ; } if ( g_ascii_strcasecmp ( param_value , "string" ) == 0 ) { target_arg -> arg_type = EXTCAP_ARG_STRING ; } if ( g_ascii_strcasecmp ( param_value , "password" ) == 0 ) { target_arg -> arg_type = EXTCAP_ARG_PASSWORD ; } if ( g_ascii_strcasecmp ( param_value , "fileselect" ) == 0 ) { target_arg -> arg_type = EXTCAP_ARG_FILESELECT ; } if ( g_ascii_strcasecmp ( param_value , "multicheck" ) == 0 ) { target_arg -> arg_type = EXTCAP_ARG_MULTICHECK ; } if ( g_ascii_strcasecmp ( param_value , "timestamp" ) == 0 ) { target_arg -> arg_type = EXTCAP_ARG_TIMESTAMP ; } else { printf ( "invalid type %s in ARG sentence\n" , param_value ) ; extcap_free_arg ( target_arg ) ; return NULL ; } if ( ( param_value = ( gchar * ) g_hash_table_lookup ( s -> param_list , ENUM_KEY ( EXTCAP_PARAM_SAVE ) ) ) != NULL ) { target_arg -> save = matches_regex ( EXTCAP_BOOLEAN_REGEX , param_value ) ; } if ( ( param_value = ( gchar * ) g_hash_table_lookup ( s -> param_list , ENUM_KEY ( EXTCAP_PARAM_RELOAD ) ) ) != NULL ) { target_arg -> reload = matches_regex ( EXTCAP_BOOLEAN_REGEX , param_value ) ; } if ( ( param_value = ( gchar * ) g_hash_table_lookup ( s -> param_list , ENUM_KEY ( EXTCAP_PARAM_RANGE ) ) ) != NULL ) { gchar * cp = g_strstr_len ( param_value , - 1 , "," ) ; if ( cp == NULL ) { printf ( "invalid range, expected value,value got %s\n" , param_value ) ; extcap_free_arg ( target_arg ) ; return NULL ; } if ( ( target_arg -> range_start = extcap_parse_complex ( target_arg -> arg_type , param_value ) ) == NULL ) { printf ( "invalid range, expected value,value got %s\n" , param_value ) ; extcap_free_arg ( target_arg ) ; return NULL ; } if ( ( target_arg -> range_end = extcap_parse_complex ( target_arg -> arg_type , cp + 1 ) ) == NULL ) { printf ( "invalid range, expected value,value got %s\n" , param_value ) ; extcap_free_arg ( target_arg ) ; return NULL ; } } if ( ( param_value = ( gchar * ) g_hash_table_lookup ( s -> param_list , ENUM_KEY ( EXTCAP_PARAM_DEFAULT ) ) ) != NULL ) { if ( target_arg -> arg_type != EXTCAP_ARG_MULTICHECK && target_arg -> arg_type != EXTCAP_ARG_SELECTOR ) { if ( ( target_arg -> default_complex = extcap_parse_complex ( target_arg -> arg_type , param_value ) ) == NULL ) { printf ( "invalid default, couldn't parse %s\n" , param_value ) ; } } } } if ( sent == EXTCAP_SENTENCE_VALUE ) { value = extcap_parse_value_sentence ( s ) ; if ( value == NULL ) { return NULL ; } if ( ( entry = g_list_find_custom ( args , & value -> arg_num , glist_find_numbered_arg ) ) == NULL ) { printf ( "couldn't find arg %d in list for VALUE sentence\n" , value -> arg_num ) ; return NULL ; } ( ( extcap_arg * ) entry -> data ) -> values = g_list_append ( ( ( extcap_arg * ) entry -> data ) -> values , value ) ; return NULL ; } return target_arg ; } 