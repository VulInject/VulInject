static int test_write_to_file_handle ( raptor_world * world , FILE * handle , const char * test_string , size_t test_string_len , const unsigned int expected_bytes_count ) { raptor_iostream * iostr = NULL ; unsigned long count ; int rc = 0 ; const char * const label = "write iostream to file handle" ; fprintf ( stderr , "%s: Testing %s\n" , program , label ) ; iostr = raptor_new_iostream_to_file_handle ( world , handle ) ; if ( ! iostr ) { fprintf ( stderr , "%s: Failed to create %s\n" , program , label ) ; rc = 1 ; tidy } raptor_iostream_write_bytes ( test_string , 1 , test_string_len , iostr ) ; raptor_iostream_write_byte ( '\n' , iostr ) ; count = raptor_iostream_tell ( iostr ) ; if ( count != expected_bytes_count ) { fprintf ( stderr , "%s: %s wrote %d bytes, expected %d\n" , program , label , ( int ) count , expected_bytes_count ) ; rc = 1 ; } tidy if ( iostr ) { fprintf ( stderr , "%s: FAILED Testing %s\n" , program , 0 ) ; } if ( rc ) { fprintf ( stderr , "%s: FAILED Testing %s\n" , program , label ) ; } return rc ; } 