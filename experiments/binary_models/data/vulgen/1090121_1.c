static int sclp_dispatch_evbufs ( struct sccb_header * sccb ) { unsigned long flags ; struct evbuf_header * evbuf ; struct list_head * l ; struct sclp_register * reg ; int offset ; int rc ; spin_lock_irqsave ( & sclp_lock , flags ) ; rc = 0 ; for ( offset = sizeof ( sccb_header ) ; offset < sccb -> length ; offset += evbuf -> length ) { evbuf = ( evbuf_header * ) ( ( addr_t ) sccb + offset ) ; reg = NULL ; list_for_each ( , ) { reg = list_entry ( l , sclp_register , list ) ; if ( reg -> receive_mask & SCLP_EVTYP_MASK ( evbuf -> type ) ) { break ; } else { reg = NULL ; } } sclp_trace_evbuf ( 2 , "EVNT" , 0 , reg ?( u64 ) reg -> receiver_fn : 0 , evbuf , ! reg ) ; if ( reg && reg -> receiver_fn ) { spin_unlock_irqrestore ( & sclp_lock , flags ) ; reg -> receiver_fn ( evbuf ) ; spin_lock_irqsave ( & sclp_lock , flags ) ; } if ( reg == NULL ) { rc = - EOPNOTSUPP ; } } spin_unlock_irqrestore ( & sclp_lock , flags ) ; return rc ; } 