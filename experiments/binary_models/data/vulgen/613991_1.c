void Sys_SendPacket ( int length , const void * data , netadr_t to ) { int ret = SOCKET_ERROR ; struct sockaddr_storage addr ; if ( to . type != NA_BROADCAST && to . type != NA_IP && to . type != NA_IP6 && to . type != NA_MULTICAST6 ) { Com_Error ( ERR_FATAL , "Sys_SendPacket: bad address type" ) ; return ; } if ( ( ip_socket == INVALID_SOCKET && to . type == NA_IP ) || ( ip_socket == INVALID_SOCKET && to . type == NA_BROADCAST ) || ( ip6_socket == INVALID_SOCKET && to . type == NA_IP6 ) || ( ip6_socket == INVALID_SOCKET && to . type == NA_MULTICAST6 ) ) { return ; } if ( to . type == NA_MULTICAST6 && ( net_enabled -> integer & NET_DISABLEMCAST ) ) { return ; } NetadrToSockadr ( & to , ( sockaddr * ) & addr ) ; if ( usingSocks && to . type == NA_IP ) { socksBuf [ 0 ] = 0 ; socksBuf [ 1 ] = 0 ; socksBuf [ 2 ] = 0 ; socksBuf [ 3 ] = 1 ; * ( int * ) & socksBuf [ 4 ] = ( ( sockaddr_in * ) & addr ) -> sin_addr . s_addr ; * ( short * ) & socksBuf [ 8 ] = ( ( sockaddr_in * ) & addr ) -> sin_port ; memcpy ( & socksBuf [ 10 ] , data , length ) ; ret = sendto ( ip_socket , socksBuf , length + 10 , 0 , & socksRelayAddr , sizeof ( socksRelayAddr ) ) ; } else { if ( addr . ss_family == AF_INET ) { ret = sendto ( ip_socket , data , length , 0 , ( sockaddr * ) & addr , sizeof ( sockaddr_in ) ) ; } if ( addr . ss_family == AF_INET6 ) { ret = sendto ( ip6_socket , data , length , 0 , ( sockaddr * ) & addr , sizeof ( sockaddr_in6 ) ) ; } } if ( ret == SOCKET_ERROR ) { int err = socketError ; if ( err == EAGAIN ) { return ; } if ( ( err == EADDRNOTAVAIL ) && ( ( to . type == NA_BROADCAST ) ) ) { return ; } Com_Printf ( "Sys_SendPacket: %s\n" , NET_ErrorString ( ) ) ; } } 