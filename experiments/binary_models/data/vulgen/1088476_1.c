static int radeon_doorbell_init ( struct radeon_device * rdev ) { rdev -> doorbell . base = pci_resource_start ( rdev -> pdev , 2 ) ; rdev -> doorbell . size = pci_resource_len ( rdev -> pdev , 2 ) ; rdev -> doorbell . num_doorbells = min_t ( u32 , rdev -> doorbell . size / sizeof ( u32 ) , RADEON_MAX_DOORBELLS ) ; if ( rdev -> doorbell . num_doorbells == 0 ) { return - EINVAL ; } rdev -> doorbell . ptr = ioremap ( rdev -> doorbell . base , rdev -> doorbell . num_doorbells * sizeof ( u32 ) ) ; DRM_INFO ( "doorbell mmio base: 0x%08X\n" , ( uint32_t ) rdev -> doorbell . base ) ; DRM_INFO ( "doorbell mmio size: %u\n" , ( unsigned ) rdev -> doorbell . size ) ; memset ( & rdev -> doorbell . used , 0 , sizeof ( rdev -> doorbell . used ) ) ; return 0 ; } 