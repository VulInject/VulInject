static void update_psp_stream_config ( struct pipe_ctx * pipe_ctx , bool dpms_off ) { struct cp_psp * cp_psp = & pipe_ctx -> stream -> ctx -> cp_psp ; struct link_encoder * link_enc = NULL ; enum dp_panel_mode panel_mode = dp_get_panel_mode ( pipe_ctx -> stream -> link ) ; if ( cp_psp == NULL || cp_psp -> funcs . update_stream_config == NULL ) { return ; } link_enc = link_enc_cfg_get_link_enc ( pipe_ctx -> stream -> link ) ; ASSERT ( link_enc ) ; if ( link_enc == NULL ) { return ; } config . otg_inst = ( uint8_t ) pipe_ctx -> stream_res . tg -> inst ; config . dig_fe = ( uint8_t ) pipe_ctx -> stream_res . stream_enc -> stream_enc_inst ; config . stream_enc_idx = pipe_ctx -> stream_res . stream_enc -> id - ENGINE_ID_DIGA ; if ( is_dp_128b_132b_signal ( pipe_ctx ) ) { config . stream_enc_idx = pipe_ctx -> stream_res . hpo_dp_stream_enc -> id - ENGINE_ID_HPO_DP_0 ; } config . dig_be = pipe_ctx -> stream -> link -> link_enc_hw_inst ; config . link_enc_idx = link_enc -> transmitter - TRANSMITTER_UNIPHY_A ; if ( is_dp_128b_132b_signal ( pipe_ctx ) ) { config . link_enc_idx = pipe_ctx -> link_res . hpo_dp_link_enc -> inst ; } if ( pipe_ctx -> stream -> link -> ep_type == DISPLAY_ENDPOINT_USB4_DPIA ) { config . dio_output_idx = pipe_ctx -> stream -> link -> link_id . enum_id - ENUM_ID_1 ; } else { config . dio_output_idx = link_enc -> transmitter - TRANSMITTER_UNIPHY_A ; } config . phy_idx = resource_transmitter_to_phy_idx ( pipe_ctx -> stream -> link -> dc , link_enc -> transmitter ) ; if ( pipe_ctx -> stream -> link -> ep_type == DISPLAY_ENDPOINT_USB4_DPIA ) { config . phy_idx = 0 ; } config . assr_enabled = ( panel_mode == DP_PANEL_MODE_EDP ) ?1 : 0 ; config . mst_enabled = ( pipe_ctx -> stream -> signal == SIGNAL_TYPE_DISPLAY_PORT_MST ) ?1 : 0 ; config . dp2_enabled = is_dp_128b_132b_signal ( pipe_ctx ) ?1 : 0 ; config . usb4_enabled = ( pipe_ctx -> stream -> link -> ep_type == DISPLAY_ENDPOINT_USB4_DPIA ) ?1 : 0 ; config . dpms_off = dpms_off ; config . dm_stream_ctx = pipe_ctx -> stream -> dm_stream_context ; cp_psp -> funcs . update_stream_config ( cp_psp -> handle , & config ) ; } 