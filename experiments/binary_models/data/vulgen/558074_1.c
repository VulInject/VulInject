void bmac_init_dma ( struct bmac_softc * sc ) { dbdma_command_t * cmd = sc -> sc_rxcmd ; int i ; dbdma_reset ( sc -> sc_txdma ) ; dbdma_reset ( sc -> sc_rxdma ) ; bzero ( sc -> sc_rxcmd , ( BMAC_RXBUFS + 1 ) * sizeof ( dbdma_command_t ) ) ; for ( i = 0 ; i < BMAC_RXBUFS ; i ++ ) { DBDMA_BUILD ( cmd , DBDMA_CMD_IN_LAST , 0 , BMAC_BUFLEN , sc -> sc_rxbuf_pa + BMAC_BUFLEN * i , DBDMA_INT_ALWAYS , DBDMA_WAIT_NEVER , DBDMA_BRANCH_NEVER ) ; cmd ++ ; } DBDMA_BUILD ( cmd , DBDMA_CMD_NOP , 0 , 0 , 0 , DBDMA_INT_NEVER , DBDMA_WAIT_NEVER , DBDMA_BRANCH_ALWAYS ) ; dbdma_st32 ( & cmd -> d_cmddep , sc -> sc_rxdbdma -> d_paddr ) ; sc -> sc_rxlast = 0 ; dbdma_start ( sc -> sc_rxdma , sc -> sc_rxdbdma ) ; } 