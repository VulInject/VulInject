extern void license_sync_remote ( list_t * res_list ) { slurmdb_res_rec_t * rec = NULL ; licenses_t * license_entry ; list_itr_t * iter ; slurm_mutex_lock ( & license_mutex ) ; if ( res_list && ! cluster_license_list ) { xassert ( last_license_update ) ; cluster_license_list = list_create ( license_free_rec ) ; } iter = list_iterator_create ( cluster_license_list ) ; if ( res_list ) { list_itr_t * iter2 = list_iterator_create ( res_list ) ; while ( ( rec = list_next ( iter2 ) ) ) { char * name ; if ( rec -> type != SLURMDB_RESOURCE_LICENSE ) { continue ; } name = xstrdup_printf ( "%s@%s" , rec -> name , rec -> server ) ; while ( ( license_entry = list_next ( iter ) ) ) { if ( ! license_entry -> remote ) { continue ; } if ( ! xstrcmp ( license_entry -> name , name ) ) { license_entry -> remote = 2 ; _handle_consumed ( license_entry , rec ) ; if ( license_entry -> used > license_entry -> total ) { info ( "license %s count " "decreased" , license_entry -> name ) ; } break ; } } if ( ! license_entry ) { _add_res_rec_2_lic_list ( rec , 1 ) ; } list_iterator_reset ( iter ) ; } list_iterator_destroy ( iter2 ) ; } while ( ( license_entry = list_next ( iter ) ) ) { if ( ! license_entry -> remote ) { continue ; } if ( license_entry -> remote == 1 ) { info ( "license_remove_remote: license %s " "removed with %u in use" , license_entry -> name , license_entry -> used ) ; list_delete_item ( iter ) ; last_license_update = time ( NULL ) ; } if ( license_entry -> remote == 2 ) { license_entry -> remote = 1 ; } } list_iterator_destroy ( iter ) ; slurm_mutex_unlock ( & license_mutex ) ; } 