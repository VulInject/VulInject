u16 intel_slicemask_from_xehp_dssmask ( intel_sseu_ss_mask_t dss_mask , int dss_per_slice ) { intel_sseu_ss_mask_t per_slice_mask = { } ; unsigned long slice_mask ; int i ; WARN_ON ( DIV_ROUND_UP ( XEHP_BITMAP_BITS ( dss_mask ) , dss_per_slice ) > 8 * sizeof ( slice_mask ) ) ; bitmap_fill ( per_slice_mask . xehp , dss_per_slice ) ; for ( i = 0 ; ! bitmap_empty ( dss_mask . xehp , XEHP_BITMAP_BITS ( dss_mask ) ) ; i ++ ) { if ( bitmap_intersects ( dss_mask . xehp , per_slice_mask . xehp , dss_per_slice ) ) { slice_mask |= BIT ( i ) ; } bitmap_shift_right ( dss_mask . xehp , dss_mask . xehp , dss_per_slice , XEHP_BITMAP_BITS ( dss_mask ) ) ; } return slice_mask ; } 