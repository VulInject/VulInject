TEE_Result ldelf_syscall_map_zi ( vaddr_t * va , size_t num_bytes , size_t pad_begin , size_t pad_end , unsigned long flags ) { TEE_Result res = TEE_SUCCESS ; struct ts_session * sess = ts_get_current_session ( ) ; struct user_mode_ctx * uctx = to_user_mode_ctx ( sess -> ctx ) ; struct fobj * f = NULL ; struct mobj * mobj = NULL ; uint32_t prot = TEE_MATTR_URW | TEE_MATTR_PRW ; uint32_t vm_flags = 0 ; if ( flags & ~ LDELF_MAP_FLAG_SHAREABLE ) { return TEE_ERROR_BAD_PARAMETERS ; } if ( flags & LDELF_MAP_FLAG_SHAREABLE ) { vm_flags |= VM_FLAG_SHAREABLE ; } f = fobj_ta_mem_alloc ( ROUNDUP_DIV ( num_bytes , SMALL_PAGE_SIZE ) ) ; if ( ! f ) { return TEE_ERROR_OUT_OF_MEMORY ; } fobj_put ( f ) ; if ( ! mobj ) { return TEE_ERROR_OUT_OF_MEMORY ; } res = vm_map_pad ( uctx , va , num_bytes , prot , vm_flags , mobj , 0 , pad_begin , pad_end , 0 ) ; mobj_put ( mobj ) ; return res ; } 