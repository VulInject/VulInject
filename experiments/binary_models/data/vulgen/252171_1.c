int node_affinity_init ( void ) { int node ; struct pci_dev * dev = NULL ; const struct pci_device_id * ids = hfi1_pci_tbl ; cpumask_clear ( & node_affinity . proc . used ) ; cpumask_copy ( & node_affinity . proc . mask , cpu_online_mask ) ; node_affinity . proc . gen = 0 ; node_affinity . num_core_siblings = cpumask_weight ( topology_sibling_cpumask ( cpumask_first ( & node_affinity . proc . mask ) ) ) ; node_affinity . num_possible_nodes = num_possible_nodes ( ) ; node_affinity . num_online_nodes = num_online_nodes ( ) ; node_affinity . num_online_cpus = num_online_cpus ( ) ; init_real_cpu_mask ( ) ; hfi1_per_node_cntr = kcalloc ( node_affinity . num_possible_nodes , sizeof ( * hfi1_per_node_cntr ) , GFP_KERNEL ) ; if ( ! hfi1_per_node_cntr ) { return - ENOMEM ; } while ( ids -> vendor ) { dev = NULL ; while ( ( dev = pci_get_device ( ids -> vendor , ids -> device , dev ) ) ) { node = pcibus_to_node ( dev -> bus ) ; hfi1_per_node_cntr [ node ] ++ ; } ids ++ ; } return 0 ; } 