ACPI_MODULE_NAME ( "dbhistry" ) history_info { char * command ; u32 cmd_num ; } HISTORY_INFO static HISTORY_INFO acpi_gbl_history_buffer [ HISTORY_SIZE ] ; static u16 acpi_gbl_lo_history = 0 ; static u16 acpi_gbl_num_history = 0 ; static u16 acpi_gbl_next_history_index = 0 ; u32 acpi_gbl_next_cmd_num = 1 ; void acpi_db_add_to_history ( char * command_line ) { u16 cmd_len ; u16 buffer_len ; cmd_len = ( u16 ) strlen ( command_line ) ; if ( ! cmd_len ) { return ; } if ( acpi_gbl_history_buffer [ acpi_gbl_next_history_index ] . command != NULL ) { buffer_len = ( u16 ) strlen ( acpi_gbl_history_buffer [ acpi_gbl_next_history_index ] . command ) ; if ( cmd_len > buffer_len ) { acpi_os_free ( acpi_gbl_history_buffer [ acpi_gbl_next_history_index ] . command ) ; acpi_gbl_history_buffer [ acpi_gbl_next_history_index ] . command = acpi_os_allocate ( cmd_len + 1 ) ; } } else { acpi_gbl_history_buffer [ acpi_gbl_next_history_index ] . command = acpi_os_allocate ( cmd_len + 1 ) ; } strcpy ( acpi_gbl_history_buffer [ acpi_gbl_next_history_index ] . command , command_line ) ; acpi_gbl_history_buffer [ acpi_gbl_next_history_index ] . cmd_num = acpi_gbl_next_cmd_num ; if ( ( acpi_gbl_num_history == HISTORY_SIZE ) && ( acpi_gbl_next_history_index == acpi_gbl_lo_history ) ) { acpi_gbl_lo_history ++ ; if ( acpi_gbl_lo_history >= HISTORY_SIZE ) { acpi_gbl_lo_history = 0 ; } } acpi_gbl_next_history_index ++ ; if ( acpi_gbl_next_history_index >= HISTORY_SIZE ) { acpi_gbl_next_history_index = 0 ; } acpi_gbl_next_cmd_num ++ ; } 