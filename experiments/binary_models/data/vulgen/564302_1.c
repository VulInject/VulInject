static int hs_mountfs ( struct vfs * vfsp , dev_t dev , char * path , mode_t mode , int flags , struct cred * cr , int isroot ) static int hs_getrootvp ( struct vfs * vfsp , struct hsfs * fsp , size_t pathsize ) static int hs_findhsvol ( struct hsfs * fsp , struct vnode * vp , struct hs_volume * hvp ) static int hs_parsehsvol ( struct hsfs * fsp , uchar_t * volp , struct hs_volume * hvp ) static int hs_findisovol ( struct hsfs * fsp , struct vnode * vp , struct hs_volume * hvp , struct hs_volume * svp , struct hs_volume * jvp ) static int hs_joliet_level ( uchar_t * volp ) static int hs_parseisovol ( struct hsfs * fsp , uchar_t * volp , struct hs_volume * hvp ) static void hs_copylabel ( struct hs_volume * , unsigned char * , int ) static int hs_getmdev ( struct vfs * , char * fspec , int flags , dev_t * pdev , mode_t * mode , cred_t * cr ) static int hs_findvoldesc ( dev_t rdev , int desc_sec ) static int hsfsinit ( int fstype , char * name ) { static const fs_operation_def_t hsfs_vfsops_template [ ] { VFSNAME_MOUNT { . vfs_mount = hsfs_mount } VFSNAME_UNMOUNT { . vfs_unmount = hsfs_unmount } VFSNAME_ROOT { . vfs_root = hsfs_root } VFSNAME_STATVFS { . vfs_statvfs = hsfs_statvfs } VFSNAME_VGET { . vfs_vget = hsfs_vget } VFSNAME_MOUNTROOT { . vfs_mountroot = hsfs_mountroot } NULL NULL } ; ; int error ; error = vfs_setfsops ( fstype , hsfs_vfsops_template , NULL ) ; if ( error != 0 ) { cmn_err ( CE_WARN , "hsfsinit: bad vfs ops template" ) ; return ( error ) ; } error = vn_make_ops ( name , hsfs_vnodeops_template , & hsfs_vnodeops ) ; hsfsfstype = fstype ; mutex_init ( & hs_mounttab_lock , NULL , MUTEX_DEFAULT , NULL ) ; hs_init_hsnode_cache ( ) ; hsched_init_caches ( ) ; return ( 0 ) ; } 