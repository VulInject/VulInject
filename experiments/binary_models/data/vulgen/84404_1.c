static int devfs_getattr ( struct vnode * vp , struct vattr * vap , int flags , struct cred * cr , caller_context_t * ct ) { struct dv_node * dv = VTODV ( vp ) ; int error = 0 ; uint_t mask ; dcmn_err2 ( ( "?devfs_getattr %s\n" , dv -> dv_name ) ) ; ASSERT ( dv -> dv_attr || dv -> dv_attrvp ) ; if ( ! ( vp -> v_type == VDIR || vp -> v_type == VCHR || vp -> v_type == VBLK ) ) { cmn_err ( CE_WARN , "?%s: getattr on vnode type %d" , dvnm , vp -> v_type ) ; return ( ENOENT ) ; } rw_enter ( & dv -> dv_contents , RW_READER ) ; if ( dv -> dv_attr ) { mask = vap -> va_mask ; * vap = * dv -> dv_attr ; vap -> va_mask = mask ; } else { error = VOP_GETATTR ( dv -> dv_attrvp , vap , flags , cr , ct ) ; dsysdebug ( error , ( "vop_getattr %s %d\n" , dv -> dv_name , error ) ) ; } rw_exit ( & dv -> dv_contents ) ; if ( vp -> v_rdev == rconsdev ) { mode_t rconsmask = S_IXUSR | S_IRWXG | S_IRWXO ; vap -> va_mode &= ( ~ rconsmask ) ; vap -> va_uid = 0 ; } return ( error ) ; } 