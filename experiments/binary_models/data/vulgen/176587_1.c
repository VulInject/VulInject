static void musb_restore_context ( struct musb * musb ) { int i ; void __iomem * musb_base = musb -> mregs ; void __iomem * epio ; u8 power ; musb_writew ( musb_base , MUSB_FRAME , musb -> context . frame ) ; musb_writeb ( musb_base , MUSB_TESTMODE , musb -> context . testmode ) ; musb_write_ulpi_buscontrol ( musb -> mregs , musb -> context . busctl ) ; power = musb_readb ( musb_base , MUSB_POWER ) ; power &= MUSB_POWER_SUSPENDM | MUSB_POWER_RESUME ; musb -> context . power &= ~ ( MUSB_POWER_SUSPENDM | MUSB_POWER_RESUME ) ; power |= musb -> context . power ; musb_writeb ( musb_base , MUSB_POWER , power ) ; musb_writew ( musb_base , MUSB_INTRTXE , musb -> intrtxe ) ; musb_writew ( musb_base , MUSB_INTRRXE , musb -> intrrxe ) ; musb_writeb ( musb_base , MUSB_INTRUSBE , musb -> context . intrusbe ) ; for ( i = 0 ; i < musb -> config -> num_eps ; ++ i ) { struct musb_hw_ep * hw_ep ; hw_ep = & musb -> endpoints [ i ] ; if ( ! hw_ep ) { continue ; } epio = hw_ep -> regs ; if ( ! epio ) { continue ; } musb_writeb ( musb_base , MUSB_INDEX , i ) ; musb_writew ( epio , MUSB_TXMAXP , musb -> context . index_regs [ i ] . txmaxp ) ; musb_writew ( epio , MUSB_TXCSR , musb -> context . index_regs [ i ] . txcsr ) ; musb_writew ( epio , MUSB_RXMAXP , musb -> context . index_regs [ i ] . rxmaxp ) ; musb_writew ( epio , MUSB_RXCSR , musb -> context . index_regs [ i ] . rxcsr ) ; if ( musb -> dyn_fifo ) { musb_write_txfifosz ( musb_base , musb -> context . index_regs [ i ] . txfifosz ) ; musb_write_rxfifosz ( musb_base , musb -> context . index_regs [ i ] . rxfifosz ) ; musb_write_txfifoadd ( musb_base , musb -> context . index_regs [ i ] . txfifoadd ) ; musb_write_rxfifoadd ( musb_base , musb -> context . index_regs [ i ] . rxfifoadd ) ; } musb_writeb ( epio , MUSB_TXTYPE , musb -> context . index_regs [ i ] . txtype ) ; musb_writeb ( epio , MUSB_TXINTERVAL , musb -> context . index_regs [ i ] . txinterval ) ; musb_writeb ( epio , MUSB_RXTYPE , musb -> context . index_regs [ i ] . rxtype ) ; musb_writeb ( epio , MUSB_RXINTERVAL , musb -> context . index_regs [ i ] . rxinterval ) ; musb_write_txfunaddr ( musb , i , musb -> context . index_regs [ i ] . txfunaddr ) ; musb_write_txhubaddr ( musb , i , musb -> context . index_regs [ i ] . txhubaddr ) ; musb_write_txhubport ( musb , i , musb -> context . index_regs [ i ] . txhubport ) ; musb_write_rxfunaddr ( musb , i , musb -> context . index_regs [ i ] . rxfunaddr ) ; musb_write_rxhubaddr ( musb , i , musb -> context . index_regs [ i ] . rxhubaddr ) ; musb_write_rxhubport ( musb , i , musb -> context . index_regs [ i ] . rxhubport ) ; } musb_writeb ( musb_base , MUSB_INDEX , musb -> context . index ) ; } 