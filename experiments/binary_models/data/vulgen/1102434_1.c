static int xen_pv_cpu_up ( unsigned int cpu , struct task_struct * idle ) { int rc ; common_cpu_up ( cpu , idle ) ; xen_setup_runstate_info ( cpu ) ; rc = cpu_check_up_prepare ( cpu ) ; if ( rc ) { return rc ; } per_cpu ( xen_vcpu , cpu ) -> evtchn_upcall_mask = 1 ; rc = cpu_initialize_context ( cpu , idle ) ; if ( rc ) { return rc ; } xen_pmu_init ( cpu ) ; rc = HYPERVISOR_vcpu_op ( VCPUOP_up , xen_vcpu_nr ( cpu ) , NULL ) ; BUG_ON ( rc ) ; while ( cpu_report_state ( cpu ) != CPU_ONLINE ) { HYPERVISOR_sched_op ( SCHEDOP_yield , 0 ) ; } return 0 ; } 