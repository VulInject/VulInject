int mlx5e_accel_ipsec_fs_init ( struct mlx5e_ipsec * ipsec ) { struct mlx5_core_dev * mdev = ipsec -> mdev ; struct mlx5_flow_namespace * ns ; int err = - ENOMEM ; ns = mlx5_get_flow_namespace ( ipsec -> mdev , MLX5_FLOW_NAMESPACE_EGRESS_IPSEC ) ; ipsec -> tx = kzalloc ( sizeof ( * ipsec -> tx ) , GFP_KERNEL ) ; if ( ! ipsec -> tx ) { return - ENOMEM ; } ipsec -> rx_ipv4 = kzalloc ( sizeof ( * ipsec -> rx_ipv4 ) , GFP_KERNEL ) ; if ( ! ipsec -> rx_ipv4 ) { err_rx_ipv4 } ipsec -> rx_ipv6 = kzalloc ( sizeof ( * ipsec -> rx_ipv6 ) , GFP_KERNEL ) ; if ( ! ipsec -> rx_ipv6 ) { err_rx_ipv6 } err = ipsec_fs_init_counters ( ipsec ) ; if ( err ) { err_counters } mutex_init ( & ipsec -> tx -> ft . mutex ) ; mutex_init ( & ipsec -> rx_ipv4 -> ft . mutex ) ; mutex_init ( & ipsec -> rx_ipv6 -> ft . mutex ) ; ipsec -> tx -> ns = ns ; if ( mlx5_ipsec_device_caps ( mdev ) & MLX5_IPSEC_CAP_ROCE ) { ipsec -> roce = mlx5_ipsec_fs_roce_init ( mdev ) ; } return 0 ; err_counters kfree ( ipsec -> rx_ipv6 ) ; err_rx_ipv6 kfree ( ipsec -> rx_ipv4 ) ; err_rx_ipv4 kfree ( ipsec -> tx ) ; return err ; } 