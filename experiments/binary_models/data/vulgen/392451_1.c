struct pnp_dev * pnp_alloc_dev ( struct pnp_protocol * protocol , int id , const char * pnpid ) { struct pnp_dev * dev ; struct pnp_id * dev_id ; dev = kzalloc ( sizeof ( pnp_dev ) , GFP_KERNEL ) ; if ( ! dev ) { return NULL ; } INIT_LIST_HEAD ( & dev -> resources ) ; INIT_LIST_HEAD ( & dev -> options ) ; dev -> protocol = protocol ; dev -> number = id ; dev -> dma_mask = DMA_BIT_MASK ( 24 ) ; dev -> dev . parent = & dev -> protocol -> dev ; dev -> dev . bus = & pnp_bus_type ; dev -> dev . dma_mask = & dev -> dma_mask ; dev -> dev . coherent_dma_mask = dev -> dma_mask ; dev -> dev . release = & pnp_release_device ; dev_set_name ( & dev -> dev , "%02x:%02x" , dev -> protocol -> number , dev -> number ) ; dev_id = pnp_add_id ( dev , pnpid ) ; if ( ! dev_id ) { return NULL ; } return dev ; } 