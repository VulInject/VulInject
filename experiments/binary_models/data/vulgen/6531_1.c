static void * tpm2_bios_measurements_start ( struct seq_file * m , loff_t * pos ) { struct tpm_chip * chip = m -> private ; struct tpm_bios_log * log = & chip -> log ; void * addr = log -> bios_event_log ; void * limit = log -> bios_event_log_end ; struct tcg_pcr_event * event_header ; struct tcg_pcr_event2 * event ; size_t size ; int i ; event_header = addr ; size = sizeof ( tcg_pcr_event ) - sizeof ( event_header -> event ) + event_header -> event_size ; if ( * pos == 0 ) { if ( addr + size < limit ) { if ( ( event_header -> event_type == 0 ) && ( event_header -> event_size == 0 ) ) { return NULL ; } return SEQ_START_TOKEN ; } } if ( * pos > 0 ) { addr += size ; event = addr ; size = calc_tpm2_event_size ( event , event_header ) ; if ( ( addr + size >= limit ) || ( size == 0 ) ) { return NULL ; } } for ( i = 0 ; i < ( * pos - 1 ) ; i ++ ) { event = addr ; size = calc_tpm2_event_size ( event , event_header ) ; addr += size ; } return addr ; } 