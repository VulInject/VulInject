int gf100_pm_new_ ( const struct gf100_pm_func * func , struct nvkm_device * device , enum nvkm_subdev_type type , int inst , struct nvkm_pm * * ppm ) { struct nvkm_pm * pm ; u32 mask ; int ret ; ret = nvkm_pm_ctor ( & gf100_pm_ , device , type , inst , pm ) ; if ( ret ) { return ret ; } ret = nvkm_perfdom_new ( pm , "hub" , 0 , 0x1b0000 , 0 , 0x200 , func -> doms_hub ) ; if ( ret ) { return ret ; } mask = ( 1 << nvkm_rd32 ( device , 0x022430 ) ) - 1 ; mask &= ~ nvkm_rd32 ( device , 0x022504 ) ; mask &= ~ nvkm_rd32 ( device , 0x022584 ) ; ret = nvkm_perfdom_new ( pm , "gpc" , mask , 0x180000 , 0x1000 , 0x200 , func -> doms_gpc ) ; if ( ret ) { return ret ; } mask = ( 1 << nvkm_rd32 ( device , 0x022438 ) ) - 1 ; mask &= ~ nvkm_rd32 ( device , 0x022548 ) ; mask &= ~ nvkm_rd32 ( device , 0x0225c8 ) ; ret = nvkm_perfdom_new ( pm , "part" , mask , 0x1a0000 , 0x1000 , 0x200 , func -> doms_part ) ; if ( ret ) { return ret ; } return 0 ; } 