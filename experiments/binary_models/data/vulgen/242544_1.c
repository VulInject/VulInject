static void au1200_nand_cmd_ctrl ( struct nand_chip * this , int cmd , unsigned int ctrl ) { unsigned long ioaddr = ( unsigned long ) this -> legacy . IO_ADDR_W ; if ( ctrl & NAND_CLE ) { ioaddr += MEM_STNAND_CMD ; } if ( ctrl & NAND_ALE ) { ioaddr += MEM_STNAND_ADDR ; } else { ioaddr += MEM_STNAND_DATA ; } this -> legacy . IO_ADDR_R = this -> legacy . IO_ADDR_W = ( void __iomem * ) ioaddr ; if ( cmd != NAND_CMD_NONE ) { __raw_writeb ( cmd , this -> legacy . IO_ADDR_W ) ; wmb ( ) ; } } 