static ulong sam9x60_frac_pll_get_rate ( struct clk * clk ) { struct sam9x60_pll * pll = to_sam9x60_pll ( clk ) ; void __iomem * base = pll -> base ; ulong parent_rate = clk_get_parent_rate ( clk ) ; u32 mul , frac , val ; pmc_update_bits ( base , AT91_PMC_PLL_UPDT , AT91_PMC_PLL_UPDT_ID_MSK , pll -> id ) ; pmc_read ( base , AT91_PMC_PLL_CTRL1 , & val ) ; mul = ( val & pll -> layout -> mul_mask ) >> pll -> layout -> mul_shift ; frac = ( val & pll -> layout -> frac_mask ) >> pll -> layout -> frac_shift ; return ( parent_rate * ( mul + 1 ) + ( ( u64 ) parent_rate * frac >> 22 ) ) ; } 