static u8 pwm_freq_to_reg ( unsigned long val , u16 clkin ) { unsigned long base_clock ; u8 reg0 , reg1 ; unsigned long best0 , best1 ; reg0 = find_closest_descending ( val , pwm_freq_cksel0 , ARRAY_SIZE ( pwm_freq_cksel0 ) ) ; best0 = pwm_freq_cksel0 [ reg0 ] ; base_clock = clkin * 1000 / ( ( clkin == 48000 ) ?384 : 256 ) ; reg1 = clamp_val ( DIV_ROUND_CLOSEST ( base_clock , val ) , 1 , 128 ) ; best1 = base_clock / reg1 ; reg1 = 0x80 | ( reg1 - 1 ) ; if ( abs ( val - best0 ) > abs ( val - best1 ) ) { return reg1 ; } else { return reg0 ; } } chip_types { w83795g , w83795adg } w83795_data { struct device * hwmon_dev ; struct mutex update_lock ; unsigned long last_updated ; enum chip_types chip_type ; u8 bank ; u32 has_in ; u8 has_dyn_in ; u16 in [ 21 ] [ 3 ] ; u8 in_lsb [ 10 ] [ 3 ] ; u8 has_gain ; u16 has_fan ; u16 fan [ 14 ] ; u16 fan_min [ 14 ] ; u8 has_temp ; s8 temp [ 6 ] [ 5 ] ; u8 temp_read_vrlsb [ 6 ] ; u8 temp_mode ; u8 temp_src [ 3 ] ; u8 enable_dts ; u8 has_dts ; s8 dts [ 8 ] ; u8 dts_read_vrlsb [ 8 ] ; s8 dts_ext [ 4 ] ; u8 has_pwm ; u8 pwm [ 8 ] [ 5 ] ; u16 clkin ; u8 pwm_fcms [ 2 ] ; u8 pwm_tfmr [ 6 ] ; u8 pwm_fomc ; u16 target_speed [ 8 ] ; u8 tol_speed ; u8 pwm_temp [ 6 ] [ 4 ] ; u8 sf4_reg [ 6 ] [ 2 ] [ 7 ] ; u8 setup_pwm [ 3 ] ; u8 alarms [ 6 ] ; u8 enable_beep ; u8 beeps [ 6 ] ; bool valid ; char valid_limits ; char valid_pwm_config ; } 