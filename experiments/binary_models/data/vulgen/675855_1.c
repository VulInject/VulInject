irqreturn_t vsc8584_handle_ts_interrupt ( struct phy_device * phydev ) { struct vsc8531_private * priv = phydev -> priv ; int rc ; mutex_lock ( & priv -> ts_lock ) ; rc = vsc85xx_ts_read_csr ( phydev , PROCESSOR , MSCC_PHY_1588_VSC85XX_INT_STATUS ) ; vsc85xx_ts_write_csr ( phydev , PROCESSOR , MSCC_PHY_1588_VSC85XX_INT_STATUS , rc ) ; if ( ! ( rc & VSC85XX_1588_INT_MASK_MASK ) ) { mutex_unlock ( & priv -> ts_lock ) ; return IRQ_NONE ; } if ( rc & VSC85XX_1588_INT_FIFO_ADD ) { vsc85xx_get_tx_ts ( priv -> ptp ) ; } if ( rc & VSC85XX_1588_INT_FIFO_OVERFLOW ) { vsc85xx_ts_reset_fifo ( phydev ) ; } mutex_unlock ( & priv -> ts_lock ) ; return IRQ_HANDLED ; } 