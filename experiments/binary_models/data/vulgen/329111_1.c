int ddr3_dqs_centralization_tx ( MV_DRAM_INFO * dram_info ) { u32 cs , ecc , reg ; int status ; DEBUG_DQS_S ( "DDR3 - DQS Centralization TX - Starting procedure\n" ) ; reg = reg_read ( REG_DRAM_TRAINING_2_ADDR ) | ( 1 << REG_DRAM_TRAINING_2_SW_OVRD_OFFS ) ; reg_write ( REG_DRAM_TRAINING_2_ADDR , reg ) ; DEBUG_DQS_S ( "DDR3 - DQS Centralization TX - SW Override Enabled\n" ) ; reg = ( 1 << REG_DRAM_TRAINING_AUTO_OFFS ) ; reg_write ( REG_DRAM_TRAINING_ADDR , reg ) ; for ( cs = 0 ; cs < MAX_CS ; cs ++ ) { if ( dram_info -> cs_ena & ( 1 << cs ) ) { DEBUG_DQS_FULL_C ( "DDR3 - DQS Centralization TX - CS - " , ( u32 ) cs , 1 ) ; for ( ecc = 0 ; ecc < ( dram_info -> ecc_ena + 1 ) ; ecc ++ ) { reg = reg_read ( REG_DRAM_TRAINING_2_ADDR ) & ~ ( 1 << REG_DRAM_TRAINING_2_ECC_MUX_OFFS ) ; reg_write ( REG_DRAM_TRAINING_2_ADDR , reg ) ; if ( ecc ) { DEBUG_DQS_FULL_S ( "DDR3 - DQS Centralization TX - ECC Mux Enabled\n" ) ; } else { DEBUG_DQS_FULL_S ( "DDR3 - DQS Centralization TX - ECC Mux Disabled\n" ) ; } DEBUG_DQS_FULL_S ( "DDR3 - DQS Centralization TX - Find all limits\n" ) ; status = ddr3_find_adll_limits ( dram_info , cs , ecc , 1 ) ; if ( MV_OK != status ) { return status ; } DEBUG_DQS_FULL_S ( "DDR3 - DQS Centralization TX - Start calculating center\n" ) ; status = ddr3_center_calc ( dram_info , cs , ecc , 1 ) ; if ( MV_OK != status ) { return status ; } } } } reg = reg_read ( REG_DRAM_TRAINING_2_ADDR ) & ~ ( 1 << REG_DRAM_TRAINING_2_ECC_MUX_OFFS ) ; reg_write ( REG_DRAM_TRAINING_2_ADDR , reg ) ; reg = reg_read ( REG_DRAM_TRAINING_2_ADDR ) ; reg &= ~ ( 1 << REG_DRAM_TRAINING_2_SW_OVRD_OFFS ) ; reg_write ( REG_DRAM_TRAINING_2_ADDR , reg ) ; reg = reg_read ( REG_DRAM_TRAINING_1_ADDR ) | ( 1 << REG_DRAM_TRAINING_1_TRNBPOINT_OFFS ) ; reg_write ( REG_DRAM_TRAINING_1_ADDR , reg ) ; return MV_OK ; } 