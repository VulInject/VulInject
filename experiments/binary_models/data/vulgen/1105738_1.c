static int msm_rng_probe ( struct platform_device * pdev ) { struct resource * res ; struct msm_rng * rng ; int ret ; rng = devm_kzalloc ( & pdev -> dev , sizeof ( * rng ) , GFP_KERNEL ) ; if ( ! rng ) { return - ENOMEM ; } platform_set_drvdata ( pdev , rng ) ; res = platform_get_resource ( pdev , IORESOURCE_MEM , 0 ) ; rng -> base = devm_ioremap_resource ( & pdev -> dev , res ) ; if ( IS_ERR ( rng -> base ) ) { return PTR_ERR ( rng -> base ) ; } if ( IS_ERR ( rng -> clk ) ) { return PTR_ERR ( rng -> clk ) ; } rng -> hwrng . name = KBUILD_MODNAME , rng -> hwrng . init = msm_rng_init , rng -> hwrng . cleanup = msm_rng_cleanup , rng -> hwrng . read = msm_rng_read , ret = devm_hwrng_register ( & pdev -> dev , & rng -> hwrng ) ; if ( ret ) { dev_err ( & pdev -> dev , "failed to register hwrng\n" ) ; return ret ; } return 0 ; } 