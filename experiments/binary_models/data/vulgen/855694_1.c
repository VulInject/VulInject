gimp_vectors_compat_new ( , , , , ) { GimpVectors * vectors ; GimpStroke * stroke ; GimpCoords * coords ; GimpCoords * curr_stroke ; GimpCoords * curr_coord ; gint i ; g_return_val_if_fail ( GIMP_IS_IMAGE ( image ) , NULL ) ; g_return_val_if_fail ( name != NULL , NULL ) ; g_return_val_if_fail ( points != NULL || n_points == 0 , NULL ) ; g_return_val_if_fail ( n_points >= 0 , NULL ) ; vectors = gimp_vectors_new ( image , name ) ; coords = g_new0 ( GimpCoords , n_points + 1 ) ; curr_stroke = curr_coord = coords ; curr_coord ++ ; for ( i = 0 ; i < n_points ; i ++ ) { * curr_coord = default_coords ; curr_coord -> x = points [ i ] . x ; curr_coord -> y = points [ i ] . y ; if ( curr_coord == curr_stroke + 1 ) { * curr_stroke = * curr_coord ; } if ( points [ i ] . type == GIMP_VECTORS_COMPAT_NEW_STROKE ) { * curr_stroke = * ( curr_coord - 1 ) ; stroke = gimp_bezier_stroke_new_from_coords ( curr_stroke , curr_coord - curr_stroke - 1 , TRUE ) ; gimp_vectors_stroke_add ( vectors , stroke ) ; g_object_unref ( stroke ) ; curr_stroke = curr_coord - 1 ; * curr_stroke = * curr_coord ; } curr_coord ++ ; } if ( closed ) { curr_coord -- ; * curr_stroke = * curr_coord ; } stroke = gimp_bezier_stroke_new_from_coords ( curr_stroke , curr_coord - curr_stroke , closed ) ; gimp_vectors_stroke_add ( vectors , stroke ) ; g_object_unref ( stroke ) ; return vectors ; } 