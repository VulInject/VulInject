static void check_crc_for ( char * filename , uint32_t expected_crc , size_t expected_len ) { LHAInputStream * stream ; LHABasicReader * reader ; LHAFileHeader * header ; uint8_t buf [ 16 ] ; uint32_t crc ; size_t len ; reader = reader_for_file ( filename , & stream ) ; header = lha_basic_reader_next_file ( reader ) ; assert ( header != NULL ) ; crc = 0 ; len = 0 ; for ( ; ; ) { size_t count ; count = lha_basic_reader_read_compressed ( reader , buf , sizeof ( buf ) ) ; if ( count == 0 ) { break ; } len += count ; crc32_buf ( & crc , buf , count ) ; } assert ( crc == expected_crc ) ; assert ( len == expected_len ) ; lha_basic_reader_free ( reader ) ; } 