nvlist_t * zjni_get_vdev ( zpool_handle_t * zhp , nvlist_t * vdev_parent , uint64_t vdev_id_to_find , uint64_t * p_vdev_id ) { int result ; uint64_t id = vdev_id_to_find ; if ( vdev_parent == NULL ) { vdev_parent = zjni_get_root_vdev ( zhp ) ; } else { result = nvlist_lookup_uint64 ( vdev_parent , ZPOOL_CONFIG_GUID , & id ) ; if ( result == 0 && id == vdev_id_to_find ) { return ( vdev_parent ) ; } } if ( vdev_parent != NULL ) { nvlist_t * * children ; uint_t nelem = 0 ; result = nvlist_lookup_nvlist_array ( vdev_parent , ZPOOL_CONFIG_CHILDREN , & children , & nelem ) ; if ( result == 0 ) { int i ; nvlist_t * child ; for ( i = 0 ; i < nelem ; i ++ ) { child = zjni_get_vdev ( zhp , children [ i ] , vdev_id_to_find , p_vdev_id ) ; if ( child != NULL ) { return ( child ) ; } } } } return ( NULL ) ; } 