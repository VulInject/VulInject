static char * findenv ( const char * name , int * offset ) setenv ( , , ) { extern char * * environ ; static int alloced ; char * c ; int l_value , offset ; if ( * value == '=' ) { ++ value ; } l_value = strlen ( value ) ; if ( ( c = findenv ( name , & offset ) ) ) { if ( ! rewrite ) { return ( 0 ) ; } if ( strlen ( c ) >= l_value ) { while ( * c ++ = * value ++ ) { } return ( 0 ) ; } } else { int cnt ; char * * p ; for ( p = environ , cnt = 0 ; * p ; ++ p , ++ cnt ) { } if ( alloced ) { environ = ( char * * ) realloc ( ( char * ) environ , ( size_t ) ( sizeof ( char * ) * ( cnt + 2 ) ) ) ; if ( ! environ ) { return ( - 1 ) ; } } else { alloced = 1 ; p = malloc ( ( size_t ) ( sizeof ( char * ) * ( cnt + 2 ) ) ) ; if ( ! p ) { return ( - 1 ) ; } environ = p ; } environ [ cnt + 1 ] = NULL ; offset = cnt ; } for ( c = ( char * ) name ; * c && * c != '=' ; ++ c ) { } if ( ! ( environ [ offset ] = malloc ( ( size_t ) ( ( int ) ( c - name ) + l_value + 2 ) ) ) ) { return ( - 1 ) ; } for ( c = environ [ offset ] ; ( * c = * name ++ ) && * c != '=' ; ++ c ) { } for ( * c ++ = '=' ; * c ++ = * value ++ ; ) { } return ( 0 ) ; } 