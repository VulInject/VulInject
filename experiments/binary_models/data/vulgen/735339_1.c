static int f81534_set_register ( struct usb_serial * serial , u16 reg , u8 data ) { struct usb_interface * interface = serial -> interface ; struct usb_device * dev = serial -> dev ; size_t count = F81534_USB_MAX_RETRY ; int status ; u8 * tmp ; tmp = kmalloc ( sizeof ( u8 ) , GFP_KERNEL ) ; * tmp = data ; while ( count -- ) { status = usb_control_msg ( dev , usb_sndctrlpipe ( dev , 0 ) , F81534_SET_GET_REGISTER , USB_TYPE_VENDOR | USB_DIR_OUT , reg , 0 , tmp , sizeof ( u8 ) , F81534_USB_TIMEOUT ) ; if ( status == sizeof ( u8 ) ) { status = 0 ; break ; } } if ( status < 0 ) { dev_err ( & interface -> dev , "%s: reg: %x data: %x failed: %d\n" , __func__ , reg , data , status ) ; } kfree ( tmp ) ; return status ; } 