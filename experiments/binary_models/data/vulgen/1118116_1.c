static int get ( int sd , struct addrinfo * ai , char * host , uint16_t port , char * location ) { struct pollfd pfd ; ssize_t num ; size_t len ; char buf [ 256 ] ; len = snprintf ( buf , sizeof ( buf ) , "GET /%s HTTP/1.1\r\n" "Host: %s:%d\r\n" "Cache-Control: no-cache\r\n" "Connection: close\r\n" "Pragma: no-cache\r\n" "Accept: text/xml, application/xml\r\n" "User-Agent: ssdp-scan/1.0 UPnP/1.0\r\n" "\r\n" , location , host , port ) ; num = sendto ( sd , buf , len , 0 , ai -> ai_addr , ai -> ai_addrlen ) ; if ( num < 0 ) { warn ( "Failed sending HTTP GET /%s to %s:%d" , location , host , port ) ; close ( sd ) ; return - 1 ; } pfd . fd = sd ; pfd . events = POLLIN ; if ( poll ( & pfd , 1 , 1000 ) < 0 ) { warn ( "Server %s: %s" , host , strerror ( errno ) ) ; close ( sd ) ; return - 1 ; } return sd ; } 