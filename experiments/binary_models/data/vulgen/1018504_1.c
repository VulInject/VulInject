static void rt305x_esw_init ( struct mt7628_eth_dev * priv ) { void __iomem * base = priv -> eth_sw_base ; void __iomem * reg ; u32 val = 0 , pvid ; int i ; writel ( 0xc8a07850 , base + MT7628_SWITCH_FCT0 ) ; writel ( 0x00000000 , base + MT7628_SWITCH_SGC2 ) ; writel ( 0x00405555 , base + MT7628_SWITCH_PFC1 ) ; writel ( 0x00007f7f , base + MT7628_SWITCH_POC0 ) ; writel ( 0x00007f7f , base + MT7628_SWITCH_POC2 ) ; writel ( 0x0002500c , base + MT7628_SWITCH_FCT2 ) ; writel ( 0x0008a301 , base + MT7628_SWITCH_SGC ) ; writel ( 0x02404040 , base + MT7628_SWITCH_SOCPC ) ; writel ( 0x3f502b28 , base + MT7628_SWITCH_FPA1 ) ; writel ( 0x00000000 , base + MT7628_SWITCH_FPA ) ; if ( priv -> wan_port >= 0 && priv -> wan_port < 6 ) { for ( i = 0 ; i < 8 ; i ++ ) { pvid = i == priv -> wan_port ?2 : 1 ; reg = base + MT7628_SWITCH_PVIDC0 + ( i / 2 ) * 4 ; if ( i % 2 == 0 ) { val = pvid ; } else { val |= ( pvid << 12 ) ; writel ( val , reg ) ; } } val = 0xffff407f ; val |= 1 << ( 8 + priv -> wan_port ) ; val &= ~ ( 1 << priv -> wan_port ) ; writel ( val , base + MT7628_SWITCH_VMSC0 ) ; } reset_assert ( & priv -> rst_ephy ) ; reset_deassert ( & priv -> rst_ephy ) ; mdelay ( 10 ) ; mt7628_ephy_init ( priv ) ; } 