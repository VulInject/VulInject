static unsigned int rdac_failover_get ( struct rdac_controller * ctlr , struct list_head * list , unsigned char * cdb ) { struct rdac_mode_common * common ; unsigned data_size ; struct rdac_queue_data * qdata ; u8 * lun_table ; if ( ctlr -> use_ms10 ) { struct rdac_pg_expanded * rdac_pg ; data_size = sizeof ( rdac_pg_expanded ) ; rdac_pg = & ctlr -> mode_select . expanded ; memset ( rdac_pg , 0 , data_size ) ; common = & rdac_pg -> common ; rdac_pg -> page_code = RDAC_PAGE_CODE_REDUNDANT_CONTROLLER + 0x40 ; rdac_pg -> subpage_code = 0x1 ; rdac_pg -> page_len [ 0 ] = 0x01 ; rdac_pg -> page_len [ 1 ] = 0x28 ; lun_table = rdac_pg -> lun_table ; } else { struct rdac_pg_legacy * rdac_pg ; data_size = sizeof ( rdac_pg_legacy ) ; rdac_pg = & ctlr -> mode_select . legacy ; memset ( rdac_pg , 0 , data_size ) ; common = & rdac_pg -> common ; rdac_pg -> page_code = RDAC_PAGE_CODE_REDUNDANT_CONTROLLER ; rdac_pg -> page_len = 0x68 ; lun_table = rdac_pg -> lun_table ; } common -> quiescence_timeout = RDAC_QUIESCENCE_TIME ; common -> rdac_options = RDAC_FORCED_QUIESENCE ; list_for_each_entry ( , , ) { lun_table [ qdata -> h -> lun ] = 0x81 ; } if ( ctlr -> use_ms10 ) { cdb [ 0 ] = MODE_SELECT_10 ; cdb [ 7 ] = data_size >> 8 ; cdb [ 8 ] = data_size & 0xff ; } else { cdb [ 0 ] = MODE_SELECT ; cdb [ 4 ] = data_size ; } return data_size ; } 