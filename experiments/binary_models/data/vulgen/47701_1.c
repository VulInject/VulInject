static s32 e1000_init_hw_82542 ( struct e1000_hw * hw ) { struct e1000_mac_info * mac = & hw -> mac ; struct e1000_dev_spec_82542 * dev_spec = & hw -> dev_spec . _82542 ; s32 ret_val = E1000_SUCCESS ; u32 ctrl ; u16 i ; DEBUGFUNC ( "e1000_init_hw_82542" ) ; E1000_WRITE_REG ( hw , E1000_VET , 0 ) ; mac -> ops . clear_vfta ( hw ) ; if ( hw -> revision_id == E1000_REVISION_2 ) { DEBUGOUT ( "Disabling MWI on 82542 rev 2.0\n" ) ; e1000_pci_clear_mwi ( hw ) ; E1000_WRITE_REG ( hw , E1000_RCTL , E1000_RCTL_RST ) ; E1000_WRITE_FLUSH ( hw ) ; msec_delay ( 5 ) ; } if ( hw -> revision_id == E1000_REVISION_2 ) { E1000_WRITE_REG ( hw , E1000_RCTL , 0 ) ; E1000_WRITE_FLUSH ( hw ) ; msec_delay ( 1 ) ; if ( hw -> bus . pci_cmd_word & CMD_MEM_WRT_INVALIDATE ) { e1000_pci_set_mwi ( hw ) ; } } DEBUGOUT ( "Zeroing the MTA\n" ) ; for ( i = 0 ; i < mac -> mta_reg_count ; i ++ ) { E1000_WRITE_REG_ARRAY ( hw , E1000_MTA , i , 0 ) ; } if ( dev_spec -> dma_fairness ) { ctrl = E1000_READ_REG ( hw , E1000_CTRL ) ; E1000_WRITE_REG ( hw , E1000_CTRL , ctrl | E1000_CTRL_PRIOR ) ; } ret_val = e1000_setup_link_82542 ( hw ) ; e1000_clear_hw_cntrs_82542 ( hw ) ; return ret_val ; } 