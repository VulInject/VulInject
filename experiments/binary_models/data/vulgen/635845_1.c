uint32 computeIntegrity ( Pm_t * pm , uint32 imageIndex , PmPort_t * port , void * data ) { PmPort_t * port2 = NULL ; IntegrityWeights_t * weights = ( data ?( IntegrityWeights_t * ) data : & pm -> integrityWeights ) ; uint32 Integrity , LQI ; if ( port == NULL || imageIndex == PM_IMAGE_INDEX_INVALID ) { return 0 ; } port2 = port -> Image [ imageIndex ] . neighbor ; LQI = ( port -> Image [ imageIndex ] . StlPortCounters . lq . s . LinkQualityIndicator <= STL_LINKQUALITY_EXCELLENT ?( ( 1 << ( STL_LINKQUALITY_EXCELLENT - port -> Image [ imageIndex ] . StlPortCounters . lq . s . LinkQualityIndicator ) ) - 1 ) : 0 ) ; Integrity = ( uint32 ) ( port -> Image [ imageIndex ] . DeltaStlPortCounters . LocalLinkIntegrityErrors * weights -> LocalLinkIntegrityErrors + port -> Image [ imageIndex ] . DeltaStlPortCounters . PortRcvErrors * weights -> PortRcvErrors + port -> Image [ imageIndex ] . DeltaStlPortCounters . LinkErrorRecovery * weights -> LinkErrorRecovery + port -> Image [ imageIndex ] . DeltaStlPortCounters . LinkDowned * weights -> LinkDowned + port -> Image [ imageIndex ] . DeltaStlPortCounters . UncorrectableErrors * weights -> UncorrectableErrors + port -> Image [ imageIndex ] . DeltaStlPortCounters . FMConfigErrors * weights -> FMConfigErrors + port -> Image [ imageIndex ] . StlPortCounters . lq . s . NumLanesDown * weights -> LinkWidthDowngrade + LQI * weights -> LinkQualityIndicator ) ; return Integrity ; } 