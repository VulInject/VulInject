static int vx_init_audio_io ( struct vx_core * chip ) { struct vx_rmh rmh ; int preferred ; vx_init_rmh ( & rmh , CMD_SUPPORTED ) ; if ( vx_send_msg ( chip , & rmh ) < 0 ) { snd_printk ( KERN_ERR "vx: cannot get the supported audio data\n" ) ; return - ENXIO ; } chip -> audio_outs = rmh . Stat [ 0 ] & MASK_FIRST_FIELD ; chip -> audio_ins = ( rmh . Stat [ 0 ] >> ( FIELD_SIZE * 2 ) ) & MASK_FIRST_FIELD ; chip -> audio_info = rmh . Stat [ 1 ] ; chip -> playback_pipes = kcalloc ( chip -> audio_outs , sizeof ( vx_pipe * ) , GFP_KERNEL ) ; if ( ! chip -> playback_pipes ) { return - ENOMEM ; } chip -> capture_pipes = kcalloc ( chip -> audio_ins , sizeof ( vx_pipe * ) , GFP_KERNEL ) ; if ( ! chip -> capture_pipes ) { return - ENOMEM ; } preferred = chip -> ibl . size ; chip -> ibl . size = 0 ; vx_set_ibl ( chip , & chip -> ibl ) ; if ( preferred > 0 ) { chip -> ibl . size = roundup ( preferred , chip -> ibl . granularity ) ; if ( chip -> ibl . size > chip -> ibl . max_size ) { chip -> ibl . size = chip -> ibl . max_size ; } } else { chip -> ibl . size = chip -> ibl . min_size ; } vx_set_ibl ( chip , & chip -> ibl ) ; return 0 ; } 