static void wa_xfer_destroy ( struct kref * _xfer ) { struct wa_xfer * xfer = container_of ( _xfer , wa_xfer , refcnt ) ; if ( xfer -> seg ) { unsigned cnt ; for ( cnt = 0 ; cnt < xfer -> segs ; cnt ++ ) { struct wa_seg * seg = xfer -> seg [ cnt ] ; if ( seg ) { usb_free_urb ( seg -> isoc_pack_desc_urb ) ; if ( seg -> dto_urb ) { kfree ( seg -> dto_urb -> sg ) ; usb_free_urb ( seg -> dto_urb ) ; } } } kfree ( xfer -> seg ) ; } kfree ( xfer ) ; } 