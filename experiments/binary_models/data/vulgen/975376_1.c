static int otx2_dma_map_tso_skb ( struct otx2_nic * pfvf , struct otx2_snd_queue * sq , struct sk_buff * skb , int sqe , int hdr_len ) { int num_segs = skb_shinfo ( skb ) -> nr_frags + 1 ; struct sg_list * sg = & sq -> sg [ sqe ] ; u64 dma_addr ; int seg , len ; sg -> num_segs = 0 ; for ( seg = 0 ; seg < num_segs ; seg ++ ) { if ( ! seg && ! len ) { continue ; } dma_addr = otx2_dma_map_skb_frag ( pfvf , skb , seg , & len ) ; if ( dma_mapping_error ( pfvf -> dev , dma_addr ) ) { unmap } sg -> dma_addr [ sg -> num_segs ] = dma_addr ; sg -> size [ sg -> num_segs ] = len ; sg -> num_segs ++ ; } return 0 ; unmap otx2_dma_unmap_skb_frags ( pfvf , sg ) ; return - EINVAL ; } 