static int spi_set_cs_timing ( struct spi_device * spi ) { struct device * parent = spi -> controller -> dev . parent ; int status = 0 ; if ( spi -> controller -> set_cs_timing && ! spi_get_csgpiod ( spi , 0 ) ) { if ( spi -> controller -> auto_runtime_pm ) { status = pm_runtime_get_sync ( parent ) ; if ( status < 0 ) { pm_runtime_put_noidle ( parent ) ; dev_err ( & spi -> controller -> dev , "Failed to power device: %d\n" , status ) ; return status ; } status = spi -> controller -> set_cs_timing ( spi ) ; pm_runtime_mark_last_busy ( parent ) ; } else { status = spi -> controller -> set_cs_timing ( spi ) ; } } return status ; } 