extern void slurm_persist_conn_recv_server_fini ( void ) { int i ; slurm_mutex_lock ( & thread_count_lock ) ; for ( i = 0 ; i < MAX_THREAD_COUNT ; i ++ ) { if ( ! persist_service_conn [ i ] ) { continue ; } if ( persist_service_conn [ i ] -> thread_id ) { pthread_kill ( persist_service_conn [ i ] -> thread_id , SIGUSR1 ) ; } } for ( i = 0 ; i < MAX_THREAD_COUNT ; i ++ ) { if ( ! persist_service_conn [ i ] ) { continue ; } if ( persist_service_conn [ i ] -> thread_id ) { pthread_t thread_id = persist_service_conn [ i ] -> thread_id ; slurm_mutex_unlock ( & thread_count_lock ) ; pthread_join ( thread_id , NULL ) ; slurm_mutex_lock ( & thread_count_lock ) ; } _destroy_persist_service ( persist_service_conn [ i ] ) ; persist_service_conn [ i ] = NULL ; } slurm_mutex_unlock ( & thread_count_lock ) ; } 