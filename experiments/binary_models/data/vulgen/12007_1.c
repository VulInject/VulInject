static int s3c_camif_reqbufs ( struct file * file , void * priv , struct v4l2_requestbuffers * rb ) { struct camif_vp * vp = video_drvdata ( file ) ; int ret ; pr_debug ( "[vp%d] rb count: %d, owner: %p, priv: %p\n" , vp -> id , rb -> count , vp -> owner , priv ) ; if ( vp -> owner && vp -> owner != priv ) { return - EBUSY ; } if ( rb -> count ) { rb -> count = max_t ( u32 , CAMIF_REQ_BUFS_MIN , rb -> count ) ; } else { vp -> owner = NULL ; } ret = vb2_reqbufs ( & vp -> vb_queue , rb ) ; if ( ret < 0 ) { return ret ; } if ( rb -> count && rb -> count < CAMIF_REQ_BUFS_MIN ) { vb2_reqbufs ( & vp -> vb_queue , rb ) ; ret = - ENOMEM ; } vp -> reqbufs_count = rb -> count ; if ( vp -> owner == NULL && rb -> count > 0 ) { vp -> owner = priv ; } return ret ; } 