make_socket ( ) { gint sock ; gint v = 1 ; static gboolean winsock_initialized = FALSE ; if ( ! winsock_initialized ) { WORD wVersionRequested = MAKEWORD ( 2 , 2 ) ; WSADATA wsaData ; if ( WSAStartup ( wVersionRequested , & wsaData ) == 0 ) { winsock_initialized = TRUE ; } else { print_socket_api_error ( "WSAStartup" ) ; gimp_quit ( ) ; } } sock = socket ( ai -> ai_family , ai -> ai_socktype , ai -> ai_protocol ) ; if ( sock < 0 ) { print_socket_api_error ( "socket" ) ; gimp_quit ( ) ; } setsockopt ( sock , SOL_SOCKET , SO_REUSEADDR , ( const void * ) & v , sizeof ( v ) ) ; if ( ai -> ai_family == AF_INET6 ) { v = 1 ; if ( setsockopt ( sock , IPPROTO_IPV6 , IPV6_V6ONLY , ( const void * ) & v , sizeof ( v ) ) < 0 ) { gimp_quit ( ) ; } } if ( bind ( sock , ai -> ai_addr , ai -> ai_addrlen ) < 0 ) { print_socket_api_error ( "bind" ) ; gimp_quit ( ) ; } return sock ; } 