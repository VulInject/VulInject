static int schedule_dedicated ( Queue * dedq ) { char * id = "schedule_dedicated" ; Job * job ; char reason [ 256 ] ; int queue_full , ran = 0 ; queue_full = schd_check_queue_limits ( dedq , reason ) ; if ( dedq -> rsrcs == NULL ) { dedq -> rsrcs = schd_get_resources ( dedq -> exechost ) ; } if ( dedq -> rsrcs == NULL ) { DBPRT ( ( "%s: schd_get_resources(%s) failed!\n" , id , dedq -> exechost ) ) ; return ( - 1 ) ; } DBPRT ( ( "%s: Considering jobs:\n" , id ) ) ; for ( job = dedq -> jobs ; job != NULL ; job = job -> next ) { if ( job -> state != 'Q' ) { continue ; } if ( queue_full ) { DBPRT ( ( "queue_full -- rejected [%s]\n" , reason ) ) ; schd_comment_job ( job , reason , JOB_COMMENT_OPTIONAL ) ; continue ; } if ( ! schd_job_fits_queue ( job , dedq , reason ) ) { DBPRT ( ( "job %s does not fit %s : %s\n" , job -> jobid , dedq -> qname , reason ) ) ; continue ; } if ( schd_resource_limits ( job , dedq -> rsrcs , reason ) ) { DBPRT ( ( "rejected by resource_limits() [%s]\n" , reason ) ) ; schd_comment_job ( job , reason , JOB_COMMENT_OPTIONAL ) ; continue ; } DBPRT ( ( "dedicated_can_run('%s', '%s'):\n" , job -> jobid , dedq -> qname ) ) ; if ( ! schd_dedicated_can_run ( job , dedq , 0 , reason ) ) { DBPRT ( ( "No (%s).\n" , reason ) ) ; schd_comment_job ( job , reason , JOB_COMMENT_OPTIONAL ) ; continue ; } if ( schd_user_limits ( job , dedq , reason ) ) { DBPRT ( ( "rejected by user_limits() [%s]\n" , reason ) ) ; schd_comment_job ( job , reason , JOB_COMMENT_OPTIONAL ) ; continue ; } if ( schd_run_job_on ( job , dedq , dedq -> exechost , SET_JOB_COMMENT ) ) { ( void ) sprintf ( log_buffer , "Unable to run job '%s' on queue '%s'." , job -> jobid , dedq -> qname ) ; log_record ( PBSEVENT_SYSTEM , PBS_EVENTCLASS_SERVER , id , log_buffer ) ; return ( - 1 ) ; } schd_charge_job ( job , dedq , dedq -> rsrcs ) ; ran ++ ; } DBPRT ( ( "%s: ran %d jobs on queue %s@%s.\n" , id , ran , dedq -> qname , dedq -> exechost ) ) ; return ( ran ) ; } 