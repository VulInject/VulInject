static int swap_load_proc_swaps ( Manager * m , bool set_flags ) { assert ( m ) ; rewind ( m -> proc_swaps ) ; ( void ) fscanf ( m -> proc_swaps , "%*s %*s %*s %*s %*s\n" ) ; for ( unsigned i = 1 ; ; i ++ ) { _cleanup_free_ char * dev = NULL , * d = NULL ; int prio = 0 , k ; k = fscanf ( m -> proc_swaps , "%ms " "%*s " "%*s " "%*s " "%i\n" , & dev , & prio ) ; if ( k != 2 ) { if ( k == EOF ) { break ; } log_warning ( "Failed to parse /proc/swaps:%u." , i ) ; continue ; } ssize_t l = cunescape ( dev , UNESCAPE_RELAX , & d ) ; if ( l < 0 ) { return log_error_errno ( l , "Failed to unescape device path: %m" ) ; } ( void ) swap_process_new ( m , d , prio , set_flags ) ; } return 0 ; } 