void vpa_init ( int cpu ) { int hwcpu = get_hard_smp_processor_id ( cpu ) ; unsigned long addr ; long ret ; WARN_ON ( cpu != smp_processor_id ( ) ) ; if ( cpu_has_feature ( CPU_FTR_ALTIVEC ) ) { lppaca_of ( cpu ) . vmxregs_in_use = 1 ; } if ( cpu_has_feature ( CPU_FTR_ARCH_207S ) ) { lppaca_of ( cpu ) . ebb_regs_in_use = 1 ; } addr = __pa ( & lppaca_of ( cpu ) ) ; ret = register_vpa ( hwcpu , addr ) ; if ( ret ) { pr_err ( "WARNING: VPA registration for cpu %d (hw %d) of area " "%lx failed with %ld\n" , cpu , hwcpu , addr , ret ) ; return ; } if ( ! radix_enabled ( ) && firmware_has_feature ( FW_FEATURE_SPLPAR ) ) { ret = register_slb_shadow ( hwcpu , addr ) ; if ( ret ) { pr_err ( "WARNING: SLB shadow buffer registration for " "cpu %d (hw %d) of area %lx failed with %ld\n" , cpu , hwcpu , addr , ret ) ; } } register_dtl_buffer ( cpu ) ; } 