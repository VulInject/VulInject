int cfg_register_ctx ( cfg_ctx_t * * handle , cfg_on_declare on_declare_cb ) { cfg_ctx_t * ctx ; cfg_group_t * group ; str gname ; ctx = ( cfg_ctx_t * ) shm_malloc ( sizeof ( cfg_ctx_t ) ) ; if ( ! ctx ) { SHM_MEM_ERROR ; return - 1 ; } if ( lock_init ( & ctx -> lock ) == 0 ) { LM_ERR ( "failed to init lock\n" ) ; shm_free ( ctx ) ; return - 1 ; } ctx -> next = cfg_ctx_list ; cfg_ctx_list = ctx ; * handle = ctx ; if ( on_declare_cb ) { ctx -> on_declare_cb = on_declare_cb ; for ( group = cfg_group ; group ; group = group -> next ) { if ( group -> dynamic != CFG_GROUP_STATIC ) { continue ; } gname . s = group -> name ; gname . len = group -> name_len ; on_declare_cb ( & gname , group -> mapping -> def ) ; } } return 0 ; } 