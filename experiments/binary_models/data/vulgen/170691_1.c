static ssize_t ixgbe_dbg_reg_ops_write ( struct file * filp , const char __user * buffer , size_t count , loff_t * ppos ) { struct ixgbe_adapter * adapter = filp -> private_data ; int len ; if ( * ppos != 0 ) { return 0 ; } len = simple_write_to_buffer ( ixgbe_dbg_reg_ops_buf , sizeof ( ixgbe_dbg_reg_ops_buf ) - 1 , ppos , buffer , count ) ; if ( len < 0 ) { return len ; } ixgbe_dbg_reg_ops_buf [ len ] = '\0' ; if ( strncmp ( ixgbe_dbg_reg_ops_buf , "write" , 5 ) == 0 ) { u32 reg , value ; int cnt ; cnt = sscanf ( & ixgbe_dbg_reg_ops_buf [ 5 ] , "%x %x" , & reg , & value ) ; if ( cnt == 2 ) { IXGBE_WRITE_REG ( & adapter -> hw , reg , value ) ; value = IXGBE_READ_REG ( & adapter -> hw , reg ) ; e_dev_info ( "write: 0x%08x = 0x%08x\n" , reg , value ) ; } else { e_dev_info ( "write<reg><value>\n" ) ; } } if ( strncmp ( ixgbe_dbg_reg_ops_buf , "read" , 4 ) == 0 ) { u32 reg , value ; int cnt ; cnt = sscanf ( & ixgbe_dbg_reg_ops_buf [ 4 ] , "%x" , & reg ) ; if ( cnt == 1 ) { value = IXGBE_READ_REG ( & adapter -> hw , reg ) ; e_dev_info ( "read 0x%08x = 0x%08x\n" , reg , value ) ; } else { e_dev_info ( "read<reg>\n" ) ; } } else { e_dev_info ( "Unknown command %s\n" , ixgbe_dbg_reg_ops_buf ) ; e_dev_info ( "Available commands:\n" ) ; e_dev_info ( "   read<reg>\n" ) ; e_dev_info ( "   write<reg><value>\n" ) ; } return count ; } 