int sysv_empty_dir ( struct inode * inode ) { struct super_block * sb = inode -> i_sb ; struct page * page = NULL ; unsigned long i , npages = dir_pages ( inode ) ; char * kaddr ; for ( i = 0 ; i < npages ; i ++ ) { struct sysv_dir_entry * de ; kaddr = dir_get_page ( inode , i , & page ) ; if ( IS_ERR ( kaddr ) ) { continue ; } de = ( sysv_dir_entry * ) kaddr ; for ( ; ( char * ) de <= kaddr ; de ++ ) { if ( ! de -> inode ) { continue ; } if ( de -> name [ 0 ] != '.' ) { not_empty } if ( ! de -> name [ 1 ] ) { if ( de -> inode == cpu_to_fs16 ( SYSV_SB ( sb ) , inode -> i_ino ) ) { continue ; } not_empty } if ( de -> name [ 1 ] != '.' || de -> name [ 2 ] ) { not_empty } } dir_put_page ( page , kaddr ) ; } return 1 ; not_empty dir_put_page ( page , kaddr ) ; return 0 ; } 