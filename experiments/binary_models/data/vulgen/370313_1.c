static int wm9713_soc_probe ( struct snd_soc_component * component ) { struct wm9713_priv * wm9713 = snd_soc_component_get_drvdata ( component ) ; struct regmap * regmap = NULL ; if ( wm9713 -> mfd_pdata ) { wm9713 -> ac97 = wm9713 -> mfd_pdata -> ac97 ; regmap = wm9713 -> mfd_pdata -> regmap ; } if ( IS_ENABLED ( CONFIG_SND_SOC_AC97_BUS ) ) { wm9713 -> ac97 = snd_soc_new_ac97_component ( component , WM9713_VENDOR_ID , WM9713_VENDOR_ID_MASK ) ; if ( IS_ERR ( wm9713 -> ac97 ) ) { return PTR_ERR ( wm9713 -> ac97 ) ; } if ( IS_ERR ( regmap ) ) { snd_soc_free_ac97_component ( wm9713 -> ac97 ) ; return PTR_ERR ( regmap ) ; } } else { return - ENXIO ; } snd_soc_component_init_regmap ( component , regmap ) ; snd_soc_component_update_bits ( component , AC97_CD , 0x7fff , 0x0000 ) ; return 0 ; } 