static void analogix_dp_bridge_atomic_disable ( struct drm_bridge * bridge , struct drm_bridge_state * old_bridge_state ) { struct drm_atomic_state * old_state = old_bridge_state -> base . state ; struct analogix_dp_device * dp = bridge -> driver_private ; struct drm_crtc * old_crtc , * new_crtc ; struct drm_crtc_state * old_crtc_state = NULL ; struct drm_crtc_state * new_crtc_state = NULL ; int ret ; new_crtc = analogix_dp_get_new_crtc ( dp , old_state ) ; if ( ! new_crtc ) { out } new_crtc_state = drm_atomic_get_new_crtc_state ( old_state , new_crtc ) ; if ( ! new_crtc_state ) { out } if ( new_crtc_state -> self_refresh_active ) { return ; } out old_crtc = analogix_dp_get_old_crtc ( dp , old_state ) ; if ( old_crtc ) { old_crtc_state = drm_atomic_get_old_crtc_state ( old_state , old_crtc ) ; if ( old_crtc_state && old_crtc_state -> self_refresh_active ) { ret = analogix_dp_disable_psr ( dp ) ; if ( ret ) { DRM_ERROR ( "Failed to disable psr (%d)\n" , ret ) ; } } } } 