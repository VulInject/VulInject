static void hil_dev_handle_command_response ( struct hil_dev * dev ) { hil_packet p ; char * buf ; int i , idx ; idx = dev -> idx4 / 4 ; p = dev -> data [ idx - 1 ] ; switch ( p & HIL_PKT_DATA_MASK ) { case HIL_CMD_IDD : buf = dev -> idd ; break ; case HIL_CMD_RSC : buf = dev -> rsc ; break ; case HIL_CMD_EXD : buf = dev -> exd ; break ; case HIL_CMD_RNM : buf = dev -> rnm ; break ; default : if ( p != ( HIL_ERR_INT | HIL_PKT_CMD ) ) { printk ( "Device sent unknown record %x\n" , ) } out } for ( i = 0 ; i < idx ; i ++ ) { buf [ i ] = dev -> data [ i ] & HIL_PKT_DATA_MASK ; } for ( ; i < HIL_PACKET_MAX_LENGTH ; i ++ ) { buf [ i ] = 0 ; } out complete ( & dev -> cmd_done ) ; } 