void msglim ( struct msg_limit * lim , in_addr_t addr , const char * p , ... ) { va_list args ; int i ; struct msg_sub * ms1 , * ms ; const char * p1 ; va_start ( args , p ) ; ms = ms1 = lim -> subs ; for ( i = MSG_SUBJECT_N ; ; i -- , ms1 ++ ) { if ( i == 0 ) { if ( lim -> reuse > now . tv_sec ) { ms = NULL ; } else { lim -> reuse = now . tv_sec + 10 * 60 ; } break ; } if ( ms -> addr == addr ) { if ( ms -> until > now . tv_sec ) { ms = NULL ; } break ; } if ( ms -> until < ms1 -> until ) { ms = ms1 ; } } if ( ms != NULL ) { ms -> addr = addr ; ms -> until = now . tv_sec + 60 * 60 ; trace_flush ( ) ; for ( p1 = p ; * p1 == ' ' ; p1 ++ ) { continue ; } vsyslog ( LOG_ERR , p1 , args ) ; } if ( ftrace != 0 ) { ( void ) vfprintf ( ftrace , p , args ) ; ( void ) fputc ( '\n' , ftrace ) ; } } 