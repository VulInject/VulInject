static hsm_err_t wc_SECO_AESCCM ( unsigned int args [ 4 ] , CAAM_BUFFER * buf , int sz ) { hsm_err_t err ; uint8_t * in ; uint8_t * out ; int inSz ; int outSz ; int dir ; byte * cipherAndTag = NULL ; int cipherAndTagSz = 0 ; if ( buf [ 1 ] . Length != 12 ) { WOLFSSL_MSG ( "SECO expecting nonce size of 12" ) ; return HSM_GENERAL_ERROR ; } if ( buf [ 4 ] . Length != 16 ) { WOLFSSL_MSG ( "SECO expecting tag size of 16" ) ; return HSM_GENERAL_ERROR ; } if ( buf [ 5 ] . Length != 0 ) { WOLFSSL_MSG ( "SECO expecting adata size of 0" ) ; return HSM_GENERAL_ERROR ; } cipherAndTagSz = buf [ 4 ] . Length + buf [ 2 ] . Length ; cipherAndTag = ( byte * ) XMALLOC ( cipherAndTagSz , NULL , DYNAMIC_TYPE_TMP_BUFFER ) ; dir = args [ 0 ] & 0xFFFF ; if ( dir == CAAM_ENC ) { in = ( uint8_t * ) buf [ 2 ] . TheAddress ; inSz = buf [ 2 ] . Length ; out = cipherAndTag ; outSz = cipherAndTagSz ; } else { XMEMCPY ( cipherAndTag , ( uint8_t * ) buf [ 2 ] . TheAddress , buf [ 2 ] . Length ) ; XMEMCPY ( cipherAndTag + buf [ 2 ] . Length , ( uint8_t * ) buf [ 4 ] . TheAddress , buf [ 4 ] . Length ) ; in = cipherAndTag ; inSz = cipherAndTagSz ; out = ( uint8_t * ) buf [ 3 ] . TheAddress ; outSz = buf [ 3 ] . Length ; } if ( err == HSM_NO_ERROR ) { if ( dir == CAAM_ENC ) { XMEMCPY ( ( uint8_t * ) buf [ 4 ] . TheAddress , cipherAndTag + inSz , buf [ 4 ] . Length ) ; XMEMCPY ( ( uint8_t * ) buf [ 3 ] . TheAddress , cipherAndTag , buf [ 3 ] . Length ) ; } } XFREE ( cipherAndTag , NULL , DYNAMIC_TYPE_TMP_BUFFER ) ; return err ; } 