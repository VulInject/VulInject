void alchemist_reset_board ( const char * const devpath , struct alchemist_chip * const chip , const int fd ) { if ( chip -> reset_mode == 0 ) { char gpio [ 8 ] ; int fd ; char buf [ 50 ] ; if ( strcmp ( devpath , "/dev/ttyO1" ) == 0 ) { strcpy ( gpio , "gpio117" ) ; } if ( strcmp ( devpath , "/dev/ttyO2" ) == 0 ) { strcpy ( gpio , "gpio110" ) ; } if ( strcmp ( devpath , "/dev/ttyO3" ) == 0 ) { strcpy ( gpio , "gpio111" ) ; } if ( strcmp ( devpath , "/dev/ttyO4" ) == 0 ) { strcpy ( gpio , "gpio112" ) ; } if ( strcmp ( devpath , "/dev/ttyUSB0" ) == 0 ) { strcpy ( gpio , "gpio113" ) ; } if ( strcmp ( devpath , "/dev/ttyUSB1" ) == 0 ) { strcpy ( gpio , "gpio114" ) ; } if ( strcmp ( devpath , "/dev/ttyUSB2" ) == 0 ) { strcpy ( gpio , "gpio115" ) ; } if ( strcmp ( devpath , "/dev/ttyUSB3" ) == 0 ) { strcpy ( gpio , "gpio116" ) ; } if ( strcmp ( devpath , "/dev/ttyAMA0" ) == 0 ) { strcpy ( gpio , "gpio25" ) ; } else { return ; } sprintf ( buf , "/sys/class/gpio/%s/value" , gpio ) ; if ( write ( fd , "0" , 1 ) != 1 ) { applog ( LOG_DEBUG , "%s: %s %s" , alchemist_drv . dname , "GPIO write error" , devpath ) ; } cgsleep_ms ( 100 ) ; if ( write ( fd , "1" , 1 ) != 1 ) { applog ( LOG_DEBUG , "%s: %s %s" , alchemist_drv . dname , "GPIO write error" , devpath ) ; } close ( fd ) ; } else { applog ( LOG_DEBUG , "START IOCTL RTS RESET" ) ; if ( set_serial_rts ( fd , BGV_HIGH ) == BGV_ERROR ) { applog ( LOG_DEBUG , "IOCTL RTS RESET FAILED" ) ; } if ( set_serial_dtr ( fd , BGV_HIGH ) == BGV_ERROR ) { applog ( LOG_DEBUG , "IOCTL DTR RESET FAILED" ) ; } cgsleep_ms ( 100 ) ; if ( set_serial_rts ( fd , BGV_LOW ) == BGV_ERROR ) { applog ( LOG_DEBUG , "IOCTL RTS RESET FAILED" ) ; } if ( set_serial_dtr ( fd , BGV_LOW ) == BGV_ERROR ) { applog ( LOG_DEBUG , "IOCTL DTR RESET FAILED" ) ; } } } 