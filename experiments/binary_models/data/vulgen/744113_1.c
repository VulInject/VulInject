static void shark_led_work ( struct work_struct * work ) { struct shark_device * shark = container_of ( work , shark_device , led_work ) ; int i , res , brightness , actual_len ; for ( i = 0 ; i < 2 ; i ++ ) { if ( ! test_and_clear_bit ( i , & shark -> brightness_new ) ) { continue ; } brightness = atomic_read ( & shark -> brightness [ i ] ) ; shark -> transfer_buffer [ 0 ] = 0x83 + i ; shark -> transfer_buffer [ 1 ] = brightness ; res = usb_interrupt_msg ( shark -> usbdev , usb_sndintpipe ( shark -> usbdev , SHARK_OUT_EP ) , shark -> transfer_buffer , TB_LEN , & actual_len , 1000 ) ; if ( res < 0 ) { v4l2_err ( & shark -> v4l2_dev , "set LED %s error: %d\n" , shark -> led_names [ i ] , res ) ; } } } 