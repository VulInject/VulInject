struct fuse * fuse_new ( struct fuse_chan * fc , struct fuse_args * args , const struct fuse_operations * ops , unused size_t size , void * userdata ) { struct fuse * fuse ; struct fuse_vnode * root ; if ( fc == NULL || ops == NULL ) { return ( NULL ) ; } if ( ( fuse = calloc ( 1 , sizeof ( * fuse ) ) ) == NULL ) { return ( NULL ) ; } memcpy ( & fuse -> op , ops , sizeof ( fuse -> op ) ) ; if ( fuse_opt_parse ( args , & fuse -> conf , fuse_lib_opts , ifuse_lib_opt_proc ) == - 1 ) { free ( fuse ) ; return ( NULL ) ; } fuse -> fc = fc ; fuse -> max_ino = FUSE_ROOT_INO ; fuse -> se . args = fuse ; fuse -> private_data = userdata ; if ( ( root = alloc_vn ( fuse , "/" , FUSE_ROOT_INO , 0 ) ) == NULL ) { free ( fuse ) ; return ( NULL ) ; } tree_init ( & fuse -> name_tree ) ; if ( ! set_vn ( fuse , root ) ) { free ( fuse ) ; return ( NULL ) ; } return ( fuse ) ; } 