int lnet_sock_connect ( struct socket * * sockp , int * fatal , __u32 local_ip , int local_port , __u32 peer_ip , int peer_port ) { struct sockaddr_in srvaddr ; int rc ; rc = lnet_sock_create ( sockp , fatal , local_ip , local_port ) ; if ( rc ) { return rc ; } srvaddr . sin_family = AF_INET ; srvaddr . sin_port = htons ( peer_port ) ; srvaddr . sin_addr . s_addr = htonl ( peer_ip ) ; rc = kernel_connect ( * sockp , ( sockaddr * ) & srvaddr , sizeof ( srvaddr ) , 0 ) ; if ( ! rc ) { return 0 ; } * fatal = ! ( rc == - EADDRNOTAVAIL ) ; CDEBUG_LIMIT ( * fatal ?D_NETERROR : D_NET , "Error %d connecting %pI4h/%d ->%pI4h/%d\n" , rc , & local_ip , local_port , & peer_ip , peer_port ) ; sock_release ( * sockp ) ; return rc ; } 