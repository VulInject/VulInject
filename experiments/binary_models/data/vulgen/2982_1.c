int is_utf8_well_formed ( const char * s ) { int i ; int len ; len = utf_len ( ( char ) s [ 0 ] ) ; if ( len == 1 ) { return ( 1 ) ; } if ( len == 2 ) { if ( ( unsigned char ) ( s [ 0 ] ) < 0xC2 ) { return ( 0 ) ; } } else { unsigned char mask ; mask = ( ~ ( ( 1 << ( 8 - len ) ) - 1 ) ) & 0xFF ; if ( s [ 0 ] == mask && ( s [ 1 ] & mask ) == 0x80 ) { return ( 0 ) ; } } for ( i = 1 ; i < len ; i ++ ) { if ( ! IS_UTF8_TRAIL ( s [ i ] ) ) { return ( 0 ) ; } } return ( 1 ) ; } 