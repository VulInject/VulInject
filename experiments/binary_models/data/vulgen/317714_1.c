gst_rdt_depay_handle_data ( , , ) { GstFlowReturn ret ; GstBuffer * outbuf ; GstMapInfo outmap ; guint8 * data , * outdata ; guint size ; guint16 stream_id ; guint32 timestamp ; gint gap ; guint16 seqnum ; guint8 flags ; guint16 outflags ; data = gst_rdt_packet_data_map ( packet , & size ) ; outbuf = gst_buffer_new_and_alloc ( 12 + size ) ; GST_BUFFER_TIMESTAMP ( outbuf ) = outtime ; GST_DEBUG_OBJECT ( rdtdepay , "have size %u" , size ) ; stream_id = gst_rdt_packet_data_get_stream_id ( packet ) ; timestamp = gst_rdt_packet_data_get_timestamp ( packet ) ; flags = gst_rdt_packet_data_get_flags ( packet ) ; seqnum = gst_rdt_packet_data_get_seq ( packet ) ; GST_DEBUG_OBJECT ( rdtdepay , "stream_id %u, timestamp %u, seqnum %d, flags %d" , stream_id , timestamp , seqnum , flags ) ; if ( rdtdepay -> next_seqnum != - 1 ) { gap = gst_rdt_buffer_compare_seqnum ( seqnum , rdtdepay -> next_seqnum ) ; if ( G_UNLIKELY ( gap != 0 ) ) { GST_LOG_OBJECT ( rdtdepay , "got packet %u, expected %u, gap %d" , seqnum , rdtdepay -> next_seqnum , gap ) ; if ( gap < 0 ) { GST_LOG_OBJECT ( rdtdepay , "%d missing packets" , gap ) ; rdtdepay -> discont = TRUE ; } else { if ( gap < 100 ) { dropping } GST_LOG_OBJECT ( rdtdepay , "%d>100, packet too old, sender likely restarted" , gap ) ; rdtdepay -> discont = TRUE ; } } } rdtdepay -> next_seqnum = ( seqnum + 1 ) ; if ( ( flags & 1 ) == 0 ) { outflags = 2 ; } else { outflags = 0 ; } gst_buffer_map ( outbuf , & outmap , GST_MAP_WRITE ) ; outdata = outmap . data ; GST_WRITE_UINT16_BE ( outdata + 0 , 0 ) ; GST_WRITE_UINT16_BE ( outdata + 2 , size + 12 ) ; GST_WRITE_UINT16_BE ( outdata + 4 , stream_id ) ; GST_WRITE_UINT32_BE ( outdata + 6 , timestamp ) ; GST_WRITE_UINT16_BE ( outdata + 10 , outflags ) ; memcpy ( outdata + 12 , data , size ) ; gst_buffer_unmap ( outbuf , & outmap ) ; gst_buffer_resize ( outbuf , 0 , 12 + size ) ; gst_rdt_packet_data_unmap ( packet ) ; GST_DEBUG_OBJECT ( rdtdepay , "Pushing packet, outtime %" GST_TIME_FORMAT , GST_TIME_ARGS ( outtime ) ) ; ret = gst_rdt_depay_push ( rdtdepay , outbuf ) ; return ret ; dropping { GST_WARNING_OBJECT ( rdtdepay , "%d<= 100, dropping old packet" , gap ) ; return GST_FLOW_OK ; } } 