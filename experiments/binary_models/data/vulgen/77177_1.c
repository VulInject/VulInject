static int simba_close ( dev_t dev , int flags , int otyp , cred_t * credp ) { simba_devstate_t * simba_p ; if ( otyp != OTYP_CHR ) { return ( EINVAL ) ; } simba_p = ( simba_devstate_t * ) ddi_get_soft_state ( simba_state , getminor ( dev ) ) ; mutex_enter ( & simba_p -> simba_mutex ) ; simba_p -> simba_soft_state = SIMBA_SOFT_STATE_CLOSED ; mutex_exit ( & simba_p -> simba_mutex ) ; return ( 0 ) ; } 