void index_calculate_width ( Imlib_Font fn , int * w , int h , int * tot_thumb_h ) { gib_list * l ; feh_file * file = NULL ; int x = 0 , y = 0 ; int max_column_w ; int text_area_w = 0 , text_area_h = 0 ; int max_column_w = 0 ; for ( l = filelist ; l ; l = l -> next ) { file = FEH_FILE ( l -> data ) ; text_area_w = opt . thumb_w ; if ( opt . index_info ) { get_index_string_dim ( file , fn , & fw , & fh ) ; if ( fw > text_area_w ) { text_area_w = fw ; } if ( fh > text_area_h ) { text_area_h = fh + 5 ; * tot_thumb_h = opt . thumb_h + text_area_h ; } } if ( text_area_w > opt . thumb_w ) { text_area_w += 5 ; } if ( text_area_w > max_column_w ) { max_column_w = text_area_w ; } if ( ( y > h - * tot_thumb_h ) ) { y = 0 ; x += max_column_w ; max_column_w = 0 ; } y += * tot_thumb_h ; } * w = x + text_area_w ; } 