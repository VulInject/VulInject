void audioens_init_hw ( audioens_dev_t * dev ) { int tmp ; if ( ( dev -> devid == ENSONIQ_ES5880 ) || ( dev -> devid == ENSONIQ_ES5880A ) || ( dev -> devid == ENSONIQ_ES5880B ) || ( dev -> devid == 0x1371 && dev -> revision == 7 ) || ( dev -> devid == 0x1371 && dev -> revision >= 9 ) ) { tmp |= 0x20 ; PUT8 ( dev , CONC_bINTSUMM_OFF , tmp ) ; for ( int i = 0 ; i < 2000 ; i ++ ) { drv_usecwait ( 10 ) ; } } SRCInit ( dev ) ; tmp = GET32 ( dev , CONC_bDEVCTL_OFF ) & 0xff ; tmp &= ~ ( CONC_DEVCTL_PCICLK_DS | CONC_DEVCTL_XTALCLK_DS ) ; PUT8 ( dev , CONC_bDEVCTL_OFF , tmp ) ; PUT8 ( dev , CONC_bUARTCSTAT_OFF , 0x00 ) ; tmp = GET8 ( dev , CONC_bMISCCTL_OFF ) & 0xff ; PUT8 ( dev , CONC_bMISCCTL_OFF , tmp | CONC_MISCCTL_SYNC_RES ) ; drv_usecwait ( 200 ) ; PUT8 ( dev , CONC_bMISCCTL_OFF , tmp ) ; drv_usecwait ( 200 ) ; if ( dev -> revision >= 4 ) { if ( audioens_spdif ) { PUT32 ( dev , 0x04 , GET32 ( dev , 0x04 ) | ( 1 << 18 ) ) ; PUT32 ( dev , 0x00 , GET32 ( dev , 0x00 ) | ( 1 << 26 ) ) ; CLR32 ( dev , CONC_dSPDIF_OFF , CONC_SPDIF_AC3 ) ; } else { PUT32 ( dev , 0x04 , GET32 ( dev , 0x04 ) & ~ ( 1 << 18 ) ) ; PUT32 ( dev , 0x00 , GET32 ( dev , 0x00 ) & ~ ( 1 << 26 ) ) ; } CLR32 ( dev , CONC_dSTATUS_OFF , CONC_STATUS_ECHO ) ; } } 