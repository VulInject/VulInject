DEF_TEST ( ) { parser_job_data_t * job = calloc ( 1 , sizeof ( * job ) ) ; job -> messages_max_len = MSG_STOR_INIT_LEN ; job -> message_idx = 0 ; job -> message_item_idx = 1 ; job -> messages_storage = calloc ( job -> messages_max_len , sizeof ( * job -> messages_storage ) ) ; job -> messages_storage [ 0 ] . started = true ; job -> messages_storage [ 0 ] . completed = true ; sstrncpy ( job -> messages_storage [ 0 ] . message_items [ 0 ] . name , TEST_MSG_ITEM_NAME , sizeof ( TEST_MSG_ITEM_NAME ) ) ; sstrncpy ( job -> messages_storage [ 0 ] . message_items [ 0 ] . value , TEST_MSG_ITEM_VAL , sizeof ( TEST_MSG_ITEM_VAL ) ) ; int ret = start_message_assembly ( job ) ; EXPECT_EQ_STR ( "" , job -> messages_storage [ 1 ] . message_items [ 0 ] . name ) ; EXPECT_EQ_STR ( "" , job -> messages_storage [ 1 ] . message_items [ 0 ] . value ) ; EXPECT_EQ_STR ( TEST_MSG_ITEM_NAME , job -> messages_storage [ 0 ] . message_items [ 0 ] . name ) ; EXPECT_EQ_STR ( TEST_MSG_ITEM_VAL , job -> messages_storage [ 0 ] . message_items [ 0 ] . value ) ; EXPECT_EQ_INT ( 0 , job -> message_item_idx ) ; EXPECT_EQ_INT ( 1 , job -> message_idx ) ; EXPECT_EQ_INT ( 0 , ret ) ; sfree ( job ) ; return 0 ; } 