static void ccs_remove ( struct i2c_client * client ) { struct v4l2_subdev * subdev = i2c_get_clientdata ( client ) ; struct ccs_sensor * sensor = to_ccs_sensor ( subdev ) ; unsigned int i ; v4l2_async_unregister_subdev ( subdev ) ; pm_runtime_disable ( & client -> dev ) ; if ( ! pm_runtime_status_suspended ( & client -> dev ) ) { ccs_power_off ( & client -> dev ) ; } pm_runtime_set_suspended ( & client -> dev ) ; for ( i = 0 ; i < sensor -> ssds_used ; i ++ ) { v4l2_device_unregister_subdev ( & sensor -> ssds [ i ] . sd ) ; media_entity_cleanup ( & sensor -> ssds [ i ] . sd . entity ) ; } ccs_cleanup ( sensor ) ; mutex_destroy ( & sensor -> mutex ) ; kvfree ( sensor -> sdata . backing ) ; kvfree ( sensor -> mdata . backing ) ; } 