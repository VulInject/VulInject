int ice_init_hw_tbls ( struct ice_hw * hw ) { u8 i ; mutex_init ( & hw -> rss_locks ) ; INIT_LIST_HEAD ( & hw -> rss_list_head ) ; ice_init_all_prof_masks ( hw ) ; for ( i = 0 ; i < ICE_BLK_COUNT ; i ++ ) { struct ice_prof_redir * prof_redir = & hw -> blk [ i ] . prof_redir ; struct ice_prof_tcam * prof = & hw -> blk [ i ] . prof ; struct ice_xlt1 * xlt1 = & hw -> blk [ i ] . xlt1 ; struct ice_xlt2 * xlt2 = & hw -> blk [ i ] . xlt2 ; struct ice_es * es = & hw -> blk [ i ] . es ; u16 j ; if ( hw -> blk [ i ] . is_list_init ) { continue ; } ice_init_flow_profs ( hw , i ) ; INIT_LIST_HEAD ( & es -> prof_map ) ; hw -> blk [ i ] . is_list_init = true ; hw -> blk [ i ] . overwrite = blk_sizes [ i ] . overwrite ; es -> reverse = blk_sizes [ i ] . reverse ; xlt1 -> sid = ice_blk_sids [ i ] [ ICE_SID_XLT1_OFF ] ; xlt1 -> count = blk_sizes [ i ] . xlt1 ; xlt1 -> ptypes = devm_kcalloc ( ice_hw_to_dev ( hw ) , xlt1 -> count , sizeof ( * xlt1 -> ptypes ) , GFP_KERNEL ) ; if ( ! xlt1 -> ptypes ) { err } xlt1 -> ptg_tbl = devm_kcalloc ( ice_hw_to_dev ( hw ) , ICE_MAX_PTGS , sizeof ( * xlt1 -> ptg_tbl ) , GFP_KERNEL ) ; if ( ! xlt1 -> ptg_tbl ) { err } xlt1 -> t = devm_kcalloc ( ice_hw_to_dev ( hw ) , xlt1 -> count , sizeof ( * xlt1 -> t ) , GFP_KERNEL ) ; if ( ! xlt1 -> t ) { err } xlt2 -> sid = ice_blk_sids [ i ] [ ICE_SID_XLT2_OFF ] ; xlt2 -> count = blk_sizes [ i ] . xlt2 ; xlt2 -> vsis = devm_kcalloc ( ice_hw_to_dev ( hw ) , xlt2 -> count , sizeof ( * xlt2 -> vsis ) , GFP_KERNEL ) ; if ( ! xlt2 -> vsis ) { err } xlt2 -> vsig_tbl = devm_kcalloc ( ice_hw_to_dev ( hw ) , xlt2 -> count , sizeof ( * xlt2 -> vsig_tbl ) , GFP_KERNEL ) ; if ( ! xlt2 -> vsig_tbl ) { err } for ( j = 0 ; j < xlt2 -> count ; j ++ ) { INIT_LIST_HEAD ( & xlt2 -> vsig_tbl [ j ] . prop_lst ) ; } xlt2 -> t = devm_kcalloc ( ice_hw_to_dev ( hw ) , xlt2 -> count , sizeof ( * xlt2 -> t ) , GFP_KERNEL ) ; if ( ! xlt2 -> t ) { err } prof -> sid = ice_blk_sids [ i ] [ ICE_SID_PR_OFF ] ; prof -> count = blk_sizes [ i ] . prof_tcam ; prof -> max_prof_id = blk_sizes [ i ] . prof_id ; prof -> cdid_bits = blk_sizes [ i ] . prof_cdid_bits ; prof -> t = devm_kcalloc ( ice_hw_to_dev ( hw ) , prof -> count , sizeof ( * prof -> t ) , GFP_KERNEL ) ; if ( ! prof -> t ) { err } prof_redir -> sid = ice_blk_sids [ i ] [ ICE_SID_PR_REDIR_OFF ] ; prof_redir -> count = blk_sizes [ i ] . prof_redir ; prof_redir -> t = devm_kcalloc ( ice_hw_to_dev ( hw ) , prof_redir -> count , sizeof ( * prof_redir -> t ) , GFP_KERNEL ) ; if ( ! prof_redir -> t ) { err } es -> sid = ice_blk_sids [ i ] [ ICE_SID_ES_OFF ] ; es -> count = blk_sizes [ i ] . es ; es -> fvw = blk_sizes [ i ] . fvw ; es -> t = devm_kcalloc ( ice_hw_to_dev ( hw ) , ( u32 ) ( es -> count * es -> fvw ) , sizeof ( * es -> t ) , GFP_KERNEL ) ; if ( ! es -> t ) { err } es -> ref_count = devm_kcalloc ( ice_hw_to_dev ( hw ) , es -> count , sizeof ( * es -> ref_count ) , GFP_KERNEL ) ; if ( ! es -> ref_count ) { err } es -> written = devm_kcalloc ( ice_hw_to_dev ( hw ) , es -> count , sizeof ( * es -> written ) , GFP_KERNEL ) ; if ( ! es -> written ) { err } es -> mask_ena = devm_kcalloc ( ice_hw_to_dev ( hw ) , es -> count , sizeof ( * es -> mask_ena ) , GFP_KERNEL ) ; if ( ! es -> mask_ena ) { err } } return 0 ; err ice_free_hw_tbls ( hw ) ; return - ENOMEM ; } 