void cpu_sync_bndcs_hflags ( CPUX86State * env ) { uint32_t hflags = env -> hflags ; uint32_t hflags2 = env -> hflags2 ; uint32_t bndcsr ; if ( ( hflags & HF_CPL_MASK ) == 3 ) { bndcsr = env -> bndcs_regs . cfgu ; } else { bndcsr = env -> msr_bndcfgs ; } if ( ( env -> cr [ 4 ] & CR4_OSXSAVE_MASK ) && ( env -> xcr0 & XSTATE_BNDCSR_MASK ) && ( bndcsr & BNDCFG_ENABLE ) ) { hflags |= HF_MPX_EN_MASK ; } else { hflags &= ~ HF_MPX_EN_MASK ; } else { hflags2 &= ~ HF2_MPX_PR_MASK ; } env -> hflags = hflags ; env -> hflags2 = hflags2 ; } 