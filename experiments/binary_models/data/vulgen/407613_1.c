static void i915_audio_component_init ( struct drm_i915_private * i915 ) { u32 aud_freq , aud_freq_init ; int ret ; ret = component_add_typed ( i915 -> drm . dev , & i915_audio_component_bind_ops , I915_COMPONENT_AUDIO ) ; if ( ret < 0 ) { drm_err ( & i915 -> drm , "failed to add audio component (%d)\n" , ret ) ; return ; } if ( DISPLAY_VER ( i915 ) >= 9 ) { aud_freq_init = intel_de_read ( i915 , AUD_FREQ_CNTRL ) ; if ( DISPLAY_VER ( i915 ) >= 12 ) { aud_freq = AUD_FREQ_GEN12 ; } else { aud_freq = aud_freq_init ; } if ( ( IS_TIGERLAKE ( i915 ) || IS_ROCKETLAKE ( i915 ) ) && aud_freq_init != AUD_FREQ_TGL_BROKEN ) { aud_freq = aud_freq_init ; } drm_dbg_kms ( & i915 -> drm , "use AUD_FREQ_CNTRL of 0x%x (init value 0x%x)\n" , aud_freq , aud_freq_init ) ; i915 -> display . audio . freq_cntrl = aud_freq ; } i915 -> display . audio . component_registered = true ; } 