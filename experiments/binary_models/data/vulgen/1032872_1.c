static int refreshq_add_job ( struct picl_snmphdl * smd , char * oidstrs , int n_oids , int row ) { int i ; int job ; ( void ) mutex_lock ( & refreshq_lock ) ; if ( refreshq == NULL ) { return ( - 1 ) ; } for ( i = 0 , job = refreshq_next_job ; i < n_refreshq_jobs ; i ++ , job = ( job + 1 ) % n_refreshq_slots ) { if ( ( refreshq [ job ] . row == row ) && ( refreshq [ job ] . n_oids == n_oids ) && ( refreshq [ job ] . oidstrs == oidstrs ) ) { ( void ) mutex_unlock ( & refreshq_lock ) ; return ( 0 ) ; } } if ( n_refreshq_jobs == n_refreshq_slots ) { if ( refreshq_realloc ( n_refreshq_slots + 1 ) < 0 ) { ( void ) mutex_unlock ( & refreshq_lock ) ; return ( - 1 ) ; } } refreshq [ refreshq_next_slot ] . smd = smd ; refreshq [ refreshq_next_slot ] . oidstrs = oidstrs ; refreshq [ refreshq_next_slot ] . n_oids = n_oids ; refreshq [ refreshq_next_slot ] . row = row ; refreshq [ refreshq_next_slot ] . last_fetch_time = GET_SCALED_HRTIME ( ) ; n_refreshq_jobs += 1 ; refreshq_next_slot = ( refreshq_next_slot + 1 ) % n_refreshq_slots ; ( void ) mutex_unlock ( & refreshq_lock ) ; return ( 0 ) ; } 