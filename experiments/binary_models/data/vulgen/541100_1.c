struct drm_gem_object * armada_gem_prime_import ( struct drm_device * dev , struct dma_buf * buf ) { struct dma_buf_attachment * attach ; struct armada_gem_object * dobj ; if ( buf -> ops == & armada_gem_prime_dmabuf_ops ) { struct drm_gem_object * obj = buf -> priv ; if ( obj -> dev == dev ) { drm_gem_object_get ( obj ) ; return obj ; } } attach = dma_buf_attach ( buf , dev -> dev ) ; if ( IS_ERR ( attach ) ) { return ERR_CAST ( attach ) ; } dobj = armada_gem_alloc_private_object ( dev , buf -> size ) ; if ( ! dobj ) { return ERR_PTR ( - ENOMEM ) ; } dobj -> obj . import_attach = attach ; get_dma_buf ( buf ) ; return & dobj -> obj ; } 