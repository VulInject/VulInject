static int pcpu_alloc_test ( void ) { int rv = 0 ; void __percpu * * pcpu ; size_t size , align ; int i ; pcpu = vmalloc ( ( void __percpu * ) * 35000 ) ; if ( ! pcpu ) { return - 1 ; } for ( i = 0 ; i < 35000 ; i ++ ) { size = get_random_u32_inclusive ( 1 , PAGE_SIZE / 4 ) ; align = 1 << get_random_u32_inclusive ( 1 , 11 ) ; if ( ! pcpu [ i ] ) { rv = - 1 ; } } for ( i = 0 ; i < 35000 ; i ++ ) { free_percpu ( pcpu [ i ] ) ; } vfree ( pcpu ) ; return rv ; } 