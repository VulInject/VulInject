static void EveHttpLogJSONBasic ( JsonBuilder * js , htp_tx_t * tx ) { if ( tx -> request_hostname != NULL ) { jb_set_string_from_bytes ( js , "hostname" , bstr_ptr ( tx -> request_hostname ) , bstr_len ( tx -> request_hostname ) ) ; } if ( tx -> request_port_number >= 0 ) { jb_set_uint ( js , "http_port" , tx -> request_port_number ) ; } if ( tx -> request_uri != NULL ) { jb_set_string_from_bytes ( js , "url" , bstr_ptr ( tx -> request_uri ) , bstr_len ( tx -> request_uri ) ) ; } if ( tx -> request_headers != NULL ) { htp_header_t * h_user_agent = htp_table_get_c ( tx -> request_headers , "user-agent" ) ; if ( h_user_agent != NULL ) { jb_set_string_from_bytes ( js , "http_user_agent" , bstr_ptr ( h_user_agent -> value ) , bstr_len ( h_user_agent -> value ) ) ; } htp_header_t * h_x_forwarded_for = htp_table_get_c ( tx -> request_headers , "x-forwarded-for" ) ; if ( h_x_forwarded_for != NULL ) { jb_set_string_from_bytes ( js , "xff" , bstr_ptr ( h_x_forwarded_for -> value ) , bstr_len ( h_x_forwarded_for -> value ) ) ; } } if ( tx -> response_headers != NULL ) { htp_header_t * h_content_type = htp_table_get_c ( tx -> response_headers , "content-type" ) ; if ( h_content_type != NULL ) { char string [ size ] ; BytesToStringBuffer ( bstr_ptr ( h_content_type -> value ) , bstr_len ( h_content_type -> value ) , string , size ) ; char * p = strchr ( string , ';' ) ; if ( p != NULL ) { * p = '\0' ; } jb_set_string ( js , "http_content_type" , string ) ; } htp_header_t * h_content_range = htp_table_get_c ( tx -> response_headers , "content-range" ) ; if ( h_content_range != NULL ) { jb_open_object ( js , "content_range" ) ; jb_set_string_from_bytes ( js , "raw" , bstr_ptr ( h_content_range -> value ) , bstr_len ( h_content_range -> value ) ) ; HTTPContentRange crparsed ; if ( HTPParseContentRange ( h_content_range -> value , & crparsed ) == 0 ) { if ( crparsed . start >= 0 ) { jb_set_uint ( js , "start" , crparsed . start ) ; } if ( crparsed . end >= 0 ) { jb_set_uint ( js , "end" , crparsed . end ) ; } if ( crparsed . size >= 0 ) { jb_set_uint ( js , "size" , crparsed . size ) ; } } jb_close ( js ) ; } } } 