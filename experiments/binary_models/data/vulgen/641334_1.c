static int Jim_EnvCoreCommand ( Jim_Interp * interp , int argc , Jim_Obj * const * argv ) { const char * key ; const char * val ; if ( argc == 1 ) { char * * e = Jim_GetEnviron ( ) ; int i ; Jim_Obj * listObjPtr = Jim_NewListObj ( interp , NULL , 0 ) ; for ( i = 0 ; e [ i ] ; i ++ ) { const char * equals = strchr ( e [ i ] , '=' ) ; if ( equals ) { Jim_ListAppendElement ( interp , listObjPtr , Jim_NewStringObj ( interp , e [ i ] , equals - e [ i ] ) ) ; Jim_ListAppendElement ( interp , listObjPtr , Jim_NewStringObj ( interp , equals + 1 , - 1 ) ) ; } } Jim_SetResult ( interp , listObjPtr ) ; return JIM_OK ; } if ( argc < 2 ) { return JIM_ERR ; } key = Jim_String ( argv [ 1 ] ) ; val = getenv ( key ) ; if ( val == NULL ) { if ( argc < 3 ) { Jim_SetResultFormatted ( interp , "environment variable \"%#s\" does not exist" , argv [ 1 ] ) ; return JIM_ERR ; } val = Jim_String ( argv [ 2 ] ) ; } Jim_SetResult ( interp , Jim_NewStringObj ( interp , val , - 1 ) ) ; return JIM_OK ; } 