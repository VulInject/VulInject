void xfs_attr3_leaf_list_int ( struct xfs_buf * bp , struct xfs_attr_list_context * context ) { struct attrlist_cursor_kern * cursor ; struct xfs_attr_leafblock * leaf ; struct xfs_attr3_icleaf_hdr ichdr ; struct xfs_attr_leaf_entry * entries ; struct xfs_attr_leaf_entry * entry ; int i ; struct xfs_mount * mp = context -> dp -> i_mount ; trace_xfs_attr_list_leaf ( context ) ; leaf = bp -> b_addr ; xfs_attr3_leaf_hdr_from_disk ( mp -> m_attr_geo , & ichdr , leaf ) ; entries = xfs_attr3_leaf_entryp ( leaf ) ; cursor = context -> cursor ; cursor -> initted = 1 ; if ( context -> resynch ) { entry = & entries [ 0 ] ; for ( i = 0 ; i < ichdr . count ; entry ++ , i ++ ) { if ( be32_to_cpu ( entry -> hashval ) == cursor -> hashval ) { if ( cursor -> offset == context -> dupcnt ) { context -> dupcnt = 0 ; break ; } context -> dupcnt ++ ; } if ( be32_to_cpu ( entry -> hashval ) > cursor -> hashval ) { context -> dupcnt = 0 ; break ; } } if ( i == ichdr . count ) { trace_xfs_attr_list_notfound ( context ) ; return ; } } else { entry = & entries [ 0 ] ; i = 0 ; } context -> resynch = 0 ; for ( ; i < ichdr . count ; entry ++ , i ++ ) { char * name ; int namelen , valuelen ; if ( be32_to_cpu ( entry -> hashval ) != cursor -> hashval ) { cursor -> hashval = be32_to_cpu ( entry -> hashval ) ; cursor -> offset = 0 ; } if ( entry -> flags & XFS_ATTR_LOCAL ) { xfs_attr_leaf_name_local_t * name_loc ; name_loc = xfs_attr3_leaf_name_local ( leaf , i ) ; name = name_loc -> nameval ; namelen = name_loc -> namelen ; valuelen = be16_to_cpu ( name_loc -> valuelen ) ; } else { xfs_attr_leaf_name_remote_t * name_rmt ; name_rmt = xfs_attr3_leaf_name_remote ( leaf , i ) ; name = name_rmt -> name ; namelen = name_rmt -> namelen ; valuelen = be32_to_cpu ( name_rmt -> valuelen ) ; } context -> put_listent ( context , entry -> flags , name , namelen , valuelen ) ; if ( context -> seen_enough ) { break ; } cursor -> offset ++ ; } trace_xfs_attr_list_leaf_end ( context ) ; return ; } 