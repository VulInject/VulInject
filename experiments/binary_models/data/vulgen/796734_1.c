static unsigned int calc_reserved ( struct gfs2_sbd * sdp ) { unsigned int reserved = 0 ; unsigned int mbuf ; unsigned int dbuf ; struct gfs2_trans * tr = sdp -> sd_log_tr ; if ( tr ) { mbuf = tr -> tr_num_buf_new - tr -> tr_num_buf_rm ; dbuf = tr -> tr_num_databuf_new - tr -> tr_num_databuf_rm ; reserved = mbuf + dbuf ; reserved += DIV_ROUND_UP ( mbuf , buf_limit ( sdp ) ) ; reserved += DIV_ROUND_UP ( dbuf , databuf_limit ( sdp ) ) ; } if ( sdp -> sd_log_commited_revoke > 0 ) { reserved += gfs2_struct2blk ( sdp , sdp -> sd_log_commited_revoke , sizeof ( u64 ) ) ; } return reserved ; } 