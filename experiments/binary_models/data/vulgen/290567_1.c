void idio_16_set ( struct idio_16 __iomem * const reg , struct idio_16_state * const state , const unsigned long offset , const unsigned long value ) { unsigned long flags ; spin_lock_irqsave ( & state -> lock , flags ) ; __assign_bit ( offset , state -> out_state , value ) ; if ( offset < 8 ) { iowrite8 ( bitmap_get_value8 ( state -> out_state , 0 ) , & reg -> out0_7 ) ; } else { iowrite8 ( bitmap_get_value8 ( state -> out_state , 8 ) , & reg -> out8_15 ) ; } spin_unlock_irqrestore ( & state -> lock , flags ) ; } 