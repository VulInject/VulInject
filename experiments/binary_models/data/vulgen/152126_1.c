int rpmRelocateSrpmFileList ( Header h , const char * rootDir ) { int specix = headerFindSpec ( h ) ; if ( specix >= 0 ) { const char * bn ; struct rpmtd_s filenames ; saveOrig ( h ) ; headerDel ( h , RPMTAG_BASENAMES ) ; headerDel ( h , RPMTAG_DIRNAMES ) ; headerDel ( h , RPMTAG_DIRINDEXES ) ; rpmInstallLoadMacros ( h , 1 ) ; headerGet ( h , RPMTAG_ORIGBASENAMES , & filenames , HEADERGET_ALLOC ) ; for ( int i = 0 ; ( bn = rpmtdNextString ( & filenames ) ) ; i ++ ) { int spec = ( i == specix ) ; char * fn = rpmGenPath ( rootDir , spec ?"%{_specdir}" : "%{_sourcedir}" , bn ) ; headerPutString ( h , RPMTAG_OLDFILENAMES , fn ) ; } rpmtdFreeData ( & filenames ) ; headerConvert ( h , HEADERCONV_COMPRESSFILELIST ) ; rpmInstallLoadMacros ( h , 0 ) ; } return specix ; } 