asmlinkage void do_illegal_instruction ( struct pt_regs * regs , unsigned long address ) { unsigned int op ; unsigned int insn = * ( ( unsigned int * ) address ) ; op = insn >> 26 ; switch ( op ) { case INSN_LWA : simulate_lwa ( regs , address , insn ) ; return ; case INSN_SWA : simulate_swa ( regs , address , insn ) ; return ; default : break ; } if ( user_mode ( regs ) ) { force_sig_fault ( SIGILL , ILL_ILLOPC , ( void __user * ) address ) ; } else { printk ( "KERNEL: Illegal instruction (SIGILL) 0x%.8lx\n" , address ) ; die ( "Die:" , regs , address ) ; } } 