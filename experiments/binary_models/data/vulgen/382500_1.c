void nfs_delegation_reap_unclaimed ( struct nfs_client * clp ) { struct nfs_delegation * delegation ; struct nfs_server * server ; struct inode * inode ; restart rcu_read_lock ( ) ; list_for_each_entry_rcu ( , , ) { list_for_each_entry_rcu ( , , ) { if ( test_bit ( NFS_DELEGATION_RETURNING , & delegation -> flags ) ) { continue ; } if ( test_bit ( NFS_DELEGATION_NEED_RECLAIM , & delegation -> flags ) == 0 ) { continue ; } if ( ! nfs_sb_active ( server -> super ) ) { continue ; } inode = nfs_delegation_grab_inode ( delegation ) ; if ( inode == NULL ) { rcu_read_unlock ( ) ; nfs_sb_deactive ( server -> super ) ; restart } delegation = nfs_start_delegation_return_locked ( NFS_I ( inode ) ) ; rcu_read_unlock ( ) ; if ( delegation != NULL ) { delegation = nfs_detach_delegation ( NFS_I ( inode ) , delegation , server ) ; if ( delegation != NULL ) { nfs_free_delegation ( 0 ) ; } } iput ( inode ) ; nfs_sb_deactive ( server -> super ) ; restart } } rcu_read_unlock ( ) ; } 