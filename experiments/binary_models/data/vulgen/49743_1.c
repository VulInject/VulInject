void nxp_nci_fw_work ( struct work_struct * work ) { struct nxp_nci_info * info ; struct nxp_nci_fw_info * fw_info ; int r ; fw_info = container_of ( work , nxp_nci_fw_info , work ) ; info = container_of ( fw_info , nxp_nci_info , fw_info ) ; mutex_lock ( & info -> info_lock ) ; r = fw_info -> cmd_result ; if ( r < 0 ) { exit_work } if ( fw_info -> written == fw_info -> frame_size ) { fw_info -> data += fw_info -> frame_size ; fw_info -> size -= fw_info -> frame_size ; fw_info -> written = 0 ; } if ( fw_info -> size > 0 ) { r = nxp_nci_fw_send ( info ) ; } exit_work mutex_unlock ( & info -> info_lock ) ; } 