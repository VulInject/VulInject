main ( int argc , char * argv [ ] ) { char * p , * realmname ; krb5_data realm ; krb5_context ctx ; krb5_error_code err ; int primary = 0 ; p = strrchr ( argv [ 0 ] , '/' ) ; if ( p ) { prog = p + 1 ; } else { prog = argv [ 0 ] ; } switch ( argc ) { case 2 : realmname = argv [ 1 ] ; break ; case 3 : if ( ! strcmp ( argv [ 1 ] , "-c" ) ) { how = LOOKUP_CONF ; } if ( ! strcmp ( argv [ 1 ] , "-d" ) ) { how = LOOKUP_DNS ; } if ( ! strcmp ( argv [ 1 ] , "-m" ) ) { primary = 1 ; } else { usage } realmname = argv [ 2 ] ; break ; default : usage fprintf ( stderr , "%s: usage: %s [-c | -d | -m] realm\n" , prog , prog ) ; return 1 ; } err = krb5_init_context ( & ctx ) ; if ( err ) { kfatal ( err ) ; } realm . data = realmname ; realm . length = strlen ( realmname ) ; switch ( how ) { case LOOKUP_CONF : err = krb5_locate_srv_conf ( ctx , & realm , "kdc" , & sl , htons ( 88 ) ) ; break ; case LOOKUP_DNS : err = locate_srv_dns_1 ( ctx , & realm , "_kerberos" , "_udp" , & sl ) ; break ; case LOOKUP_WHATEVER : err = k5_locate_kdc ( ctx , & realm , & sl , primary , FALSE ) ; break ; } if ( err ) { kfatal ( err ) ; } print_addrs ( ) ; k5_free_serverlist ( & sl ) ; return 0 ; } 