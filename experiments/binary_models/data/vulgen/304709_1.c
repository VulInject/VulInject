static void __es_find_extent_range ( struct inode * inode , int * matching_fn ( struct extent_status * es ) , ext4_lblk_t lblk , ext4_lblk_t end , struct extent_status * es ) { struct ext4_es_tree * tree = NULL ; struct extent_status * es1 = NULL ; struct rb_node * node ; WARN_ON ( es == NULL ) ; tree = & EXT4_I ( inode ) -> i_es_tree ; es -> es_lblk = es -> es_len = es -> es_pblk = 0 ; if ( tree -> cache_es ) { es1 = tree -> cache_es ; if ( in_range ( lblk , es1 -> es_lblk , es1 -> es_len ) ) { es_debug ( "%u cached by [%u/%u) %llu %x\n" , lblk , es1 -> es_lblk , es1 -> es_len , ext4_es_pblock ( es1 ) , ext4_es_status ( es1 ) ) ; out } } es1 = __es_tree_search ( & tree -> root , lblk ) ; out if ( es1 && ! matching_fn ( es1 ) ) { while ( ( node = rb_next ( & es1 -> rb_node ) ) != NULL ) { es1 = rb_entry ( node , extent_status , rb_node ) ; if ( es1 -> es_lblk > end ) { es1 = NULL ; break ; } if ( matching_fn ( es1 ) ) { break ; } } } if ( es1 && matching_fn ( es1 ) ) { tree -> cache_es = es1 ; es -> es_lblk = es1 -> es_lblk ; es -> es_len = es1 -> es_len ; es -> es_pblk = es1 -> es_pblk ; } } 