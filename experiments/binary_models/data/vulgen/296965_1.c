static irqreturn_t rcar_dmac_isr_transfer_end ( struct rcar_dmac_chan * chan ) { struct rcar_dmac_desc * desc = chan -> desc . running ; irqreturn_t ret = IRQ_WAKE_THREAD ; if ( ! desc -> hwdescs . use ) { if ( ! list_is_last ( & desc -> running -> node , & desc -> chunks ) ) { desc -> running = list_next_entry ( desc -> running , node ) ; if ( ! desc -> cyclic ) { ret = IRQ_HANDLED ; } done } if ( desc -> cyclic ) { desc -> running = list_first_entry ( & desc -> chunks , rcar_dmac_xfer_chunk , node ) ; done } } list_move_tail ( & desc -> node , & chan -> desc . done ) ; if ( ! list_empty ( & chan -> desc . active ) ) { chan -> desc . running = list_first_entry ( & chan -> desc . active , rcar_dmac_desc , node ) ; } else { chan -> desc . running = NULL ; } done if ( chan -> desc . running ) { rcar_dmac_chan_start_xfer ( chan ) ; } return ret ; } 