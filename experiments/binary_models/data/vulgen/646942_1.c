GC_API void * GC_CALL GC_is_valid_displacement ( void * p ) { hdr * hhdr ; word pdispl ; word offset ; struct hblk * h ; word sz ; if ( ! EXPECT ( GC_is_initialized , TRUE ) ) { GC_init ( ) ; } if ( NULL == p ) { return NULL ; } hhdr = HDR ( ( word ) p ) ; h = HBLKPTR ( p ) ; if ( GC_all_interior_pointers ) { while ( IS_FORWARDING_ADDR_OR_NIL ( hhdr ) ) { h = FORWARDED_ADDR ( h , hhdr ) ; hhdr = HDR ( h ) ; } } if ( IS_FORWARDING_ADDR_OR_NIL ( hhdr ) ) { fail } sz = hhdr -> hb_sz ; pdispl = HBLKDISPL ( p ) ; offset = pdispl % sz ; if ( ( sz > MAXOBJBYTES && ( word ) p >= ( word ) h + sz ) || ! GC_valid_offsets [ offset ] || ( ( word ) p + ( sz - offset ) > ( word ) ( h + 1 ) && ! IS_FORWARDING_ADDR_OR_NIL ( HDR ( h + 1 ) ) ) ) { fail } return p ; fail * GC_is_valid_displacement_print_proc ( ( ptr_t ) p ) ; return p ; } 