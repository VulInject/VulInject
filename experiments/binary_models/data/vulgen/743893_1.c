static uint16_t denali_nand_reset ( struct denali_nand_info * denali ) { int i ; for ( i = 0 ; i < denali -> max_banks ; i ++ ) { iowrite32 ( INTR__RST_COMP | INTR__TIME_OUT , denali -> flash_reg + INTR_STATUS ( i ) ) ; } for ( i = 0 ; i < denali -> max_banks ; i ++ ) { iowrite32 ( 1 << i , denali -> flash_reg + DEVICE_RESET ) ; while ( ! ( ioread32 ( denali -> flash_reg + INTR_STATUS ( i ) ) & ( INTR__RST_COMP | INTR__TIME_OUT ) ) ) { cpu_relax ( ) ; } } for ( i = 0 ; i < denali -> max_banks ; i ++ ) { iowrite32 ( INTR__RST_COMP | INTR__TIME_OUT , denali -> flash_reg + INTR_STATUS ( i ) ) ; } return PASS ; } 