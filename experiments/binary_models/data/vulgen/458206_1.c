static void set_usbethaddr ( void ) { ALLOC_CACHE_ALIGN_BUFFER ( msg_get_mac_address , msg , 1 ) ; int ret ; if ( ! model -> has_onboard_eth ) { return ; } if ( env_get ( "usbethaddr" ) ) { return ; } BCM2835_MBOX_INIT_HDR ( msg ) ; BCM2835_MBOX_INIT_TAG ( & msg -> get_mac_address , GET_MAC_ADDRESS ) ; ret = bcm2835_mbox_call_prop ( BCM2835_MBOX_PROP_CHAN , & msg -> hdr ) ; if ( ret ) { printf ( "bcm2835: Could not query MAC address\n" ) ; return ; } eth_env_set_enetaddr ( "usbethaddr" , msg -> get_mac_address . body . resp . mac ) ; return ; } 