Datum in_range_numeric_numeric ( PG_FUNCTION_ARGS ) { Numeric val = PG_GETARG_NUMERIC ( 0 ) ; Numeric base = PG_GETARG_NUMERIC ( 1 ) ; Numeric offset = PG_GETARG_NUMERIC ( 2 ) ; bool sub = PG_GETARG_BOOL ( 3 ) ; bool less = PG_GETARG_BOOL ( 4 ) ; bool result ; if ( NUMERIC_IS_NAN ( val ) ) { if ( NUMERIC_IS_NAN ( base ) ) { result = true ; } else { result = ! less ; } } if ( NUMERIC_IS_NAN ( base ) ) { result = less ; } if ( NUMERIC_IS_SPECIAL ( offset ) ) { Assert ( NUMERIC_IS_PINF ( offset ) ) ; if ( sub ?NUMERIC_IS_PINF ( base ) : NUMERIC_IS_NINF ( base ) ) { result = true ; } if ( sub ) { if ( less ) { result = NUMERIC_IS_NINF ( val ) ; } else { result = true ; } } else { if ( less ) { result = true ; } else { result = NUMERIC_IS_PINF ( val ) ; } } } if ( NUMERIC_IS_SPECIAL ( val ) ) { if ( NUMERIC_IS_PINF ( val ) ) { if ( NUMERIC_IS_PINF ( base ) ) { result = true ; } else { result = ! less ; } } else { if ( NUMERIC_IS_NINF ( base ) ) { result = true ; } else { result = less ; } } } if ( NUMERIC_IS_SPECIAL ( base ) ) { if ( NUMERIC_IS_NINF ( base ) ) { result = ! less ; } else { result = less ; } } else { NumericVar valv ; NumericVar basev ; NumericVar offsetv ; NumericVar sum ; init_var_from_num ( val , & valv ) ; init_var_from_num ( base , & basev ) ; init_var_from_num ( offset , & offsetv ) ; init_var ( & sum ) ; if ( sub ) { sub_var ( & basev , & offsetv , & sum ) ; } else { add_var ( & basev , & offsetv , & sum ) ; } if ( less ) { result = ( cmp_var ( & valv , & sum ) <= 0 ) ; } else { result = ( cmp_var ( & valv , & sum ) >= 0 ) ; } free_var ( & sum ) ; } PG_FREE_IF_COPY ( val , 0 ) ; PG_FREE_IF_COPY ( base , 1 ) ; PG_FREE_IF_COPY ( offset , 2 ) ; PG_RETURN_BOOL ( result ) ; } 