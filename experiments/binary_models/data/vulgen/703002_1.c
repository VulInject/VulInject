void settrunklacpmode ( const char * val , int d ) { struct trunk_reqall ra ; struct trunk_opts tops ; strlcpy ( ra . ra_ifname , ifname , sizeof ( ra . ra_ifname ) ) ; if ( ioctl ( sock , SIOCGTRUNK , & ra ) != 0 ) { err ( 1 , "SIOCGTRUNK" ) ; } if ( ra . ra_proto != TRUNK_PROTO_LACP ) { errx ( 1 , "Invalid option for trunk: %s" , ifname ) ; } if ( strcmp ( val , lacpmodeactive ) != 0 && strcmp ( val , lacpmodepassive ) != 0 ) { errx ( 1 , "Invalid lacpmode option for trunk: %s" , ifname ) ; } bzero ( & tops , sizeof ( tops ) ) ; strlcpy ( tops . to_ifname , ifname , sizeof ( tops . to_ifname ) ) ; tops . to_proto = TRUNK_PROTO_LACP ; tops . to_opts |= TRUNK_OPT_LACP_MODE ; if ( strcmp ( val , lacpmodeactive ) == 0 ) { tops . to_lacpopts . lacp_mode = 1 ; } else { tops . to_lacpopts . lacp_mode = 0 ; } if ( ioctl ( sock , SIOCSTRUNKOPTS , & tops ) != 0 ) { err ( 1 , "SIOCSTRUNKOPTS" ) ; } } 