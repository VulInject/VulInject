static void cdma_timeout_restart ( struct host1x_cdma * cdma , u32 getptr ) { struct host1x * host1x = cdma_to_host1x ( cdma ) ; struct host1x_channel * ch = cdma_to_channel ( cdma ) ; u64 start , end ; cdma -> last_pos = cdma -> push_buffer . pos ; host1x_ch_writel ( ch , HOST1X_CHANNEL_DMACTRL_DMASTOP , HOST1X_CHANNEL_DMACTRL ) ; start = cdma -> push_buffer . dma ; end = cdma -> push_buffer . size + 4 ; host1x_ch_writel ( ch , lower_32_bits ( start ) , HOST1X_CHANNEL_DMASTART ) ; host1x_ch_writel ( ch , upper_32_bits ( start ) , HOST1X_CHANNEL_DMASTART_HI ) ; host1x_ch_writel ( ch , lower_32_bits ( end ) , HOST1X_CHANNEL_DMAEND ) ; host1x_ch_writel ( ch , upper_32_bits ( end ) , HOST1X_CHANNEL_DMAEND_HI ) ; host1x_ch_writel ( ch , getptr , HOST1X_CHANNEL_DMAPUT ) ; host1x_ch_writel ( ch , HOST1X_CHANNEL_DMACTRL_DMASTOP | HOST1X_CHANNEL_DMACTRL_DMAGETRST | HOST1X_CHANNEL_DMACTRL_DMAINITGET , HOST1X_CHANNEL_DMACTRL ) ; dev_dbg ( host1x -> dev , "%s: DMA GET 0x%x, PUT HW 0x%x / shadow 0x%x\n" , __func__ , host1x_ch_readl ( ch , HOST1X_CHANNEL_DMAGET ) , host1x_ch_readl ( ch , HOST1X_CHANNEL_DMAPUT ) , cdma -> last_pos ) ; host1x_ch_writel ( ch , HOST1X_CHANNEL_DMACTRL_DMASTOP , HOST1X_CHANNEL_DMACTRL ) ; host1x_ch_writel ( ch , cdma -> push_buffer . pos , HOST1X_CHANNEL_DMAPUT ) ; host1x_ch_writel ( ch , 0 , HOST1X_CHANNEL_DMACTRL ) ; cdma -> running = true ; } 