static irqreturn_t rtl8187se_interrupt ( int irq , void * dev_id ) { struct ieee80211_hw * dev = dev_id ; struct rtl8180_priv * priv = dev -> priv ; u32 reg ; unsigned long flags ; static int desc_err ; spin_lock_irqsave ( & priv -> lock , flags ) ; reg = rtl818x_ioread32 ( priv , & priv -> map -> INT_STATUS_SE ) ; if ( unlikely ( reg == 0xFFFFFFFF ) ) { spin_unlock_irqrestore ( & priv -> lock , flags ) ; return IRQ_HANDLED ; } rtl818x_iowrite32 ( priv , & priv -> map -> INT_STATUS_SE , reg ) ; if ( reg & IMR_TIMEOUT1 ) { rtl818x_iowrite32 ( priv , & priv -> map -> INT_TIMEOUT , 0 ) ; } if ( reg & ( IMR_TBDOK | IMR_TBDER ) ) { rtl8180_handle_tx ( dev , 4 ) ; } if ( reg & ( IMR_TVODOK | IMR_TVODER ) ) { rtl8180_handle_tx ( dev , 0 ) ; } if ( reg & ( IMR_TVIDOK | IMR_TVIDER ) ) { rtl8180_handle_tx ( dev , 1 ) ; } if ( reg & ( IMR_TBEDOK | IMR_TBEDER ) ) { rtl8180_handle_tx ( dev , 2 ) ; } if ( reg & ( IMR_TBKDOK | IMR_TBKDER ) ) { rtl8180_handle_tx ( dev , 3 ) ; } if ( ( reg & RTL818X_INT_SE_RX_DU ) && desc_err ++ > 2 ) { if ( net_ratelimit ( ) ) { wiphy_err ( dev -> wiphy , "No RX DMA Descriptor avail\n" ) ; } } spin_unlock_irqrestore ( & priv -> lock , flags ) ; return IRQ_HANDLED ; } 