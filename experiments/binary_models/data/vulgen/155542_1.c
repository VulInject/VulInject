static ssize_t create_store ( struct device * dev , struct device_attribute * attr , const char * buf , size_t len ) { struct dax_region * dax_region = dev_get_drvdata ( dev ) ; unsigned long long avail ; ssize_t rc ; int val ; rc = kstrtoint ( buf , 0 , & val ) ; if ( rc ) { return rc ; } if ( val != 1 ) { return - EINVAL ; } device_lock ( dev ) ; avail = dax_region_avail_size ( dax_region ) ; if ( avail == 0 ) { rc = - ENOSPC ; } else { struct dev_dax_data data = { . dax_region = dax_region . size = 0 . id = - 1 } ; struct dev_dax * dev_dax = devm_create_dev_dax ( & data ) ; if ( IS_ERR ( dev_dax ) ) { rc = PTR_ERR ( dev_dax ) ; } else { if ( ! dax_region -> seed ) { dax_region -> seed = & dev_dax -> dev ; } dax_region -> youngest = & dev_dax -> dev ; rc = len ; } } device_unlock ( dev ) ; return rc ; } 