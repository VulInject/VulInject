static int netdev_linux_set_advertisements ( struct netdev * netdev_ , enum netdev_features advertise ) { struct netdev_linux * netdev = netdev_linux_cast ( netdev_ ) ; struct ethtool_cmd ecmd ; int error ; ovs_mutex_lock ( & netdev -> mutex ) ; COVERAGE_INC ( netdev_get_ethtool ) ; if ( netdev_linux_netnsid_is_remote ( netdev ) ) { error = EOPNOTSUPP ; exit } error = netdev_linux_do_ethtool ( netdev_get_name ( netdev_ ) , & ecmd , ETHTOOL_GSET , "ETHTOOL_GSET" ) ; if ( error ) { exit } ecmd . advertising = 0 ; if ( advertise & NETDEV_F_10MB_HD ) { ecmd . advertising |= ADVERTISED_10baseT_Half ; } if ( advertise & NETDEV_F_10MB_FD ) { ecmd . advertising |= ADVERTISED_10baseT_Full ; } if ( advertise & NETDEV_F_100MB_HD ) { ecmd . advertising |= ADVERTISED_100baseT_Half ; } if ( advertise & NETDEV_F_100MB_FD ) { ecmd . advertising |= ADVERTISED_100baseT_Full ; } if ( advertise & NETDEV_F_1GB_HD ) { ecmd . advertising |= ADVERTISED_1000baseT_Half ; } if ( advertise & NETDEV_F_1GB_FD ) { ecmd . advertising |= ADVERTISED_1000baseT_Full ; } if ( advertise & NETDEV_F_10GB_FD ) { ecmd . advertising |= ADVERTISED_10000baseT_Full ; } if ( advertise & NETDEV_F_COPPER ) { ecmd . advertising |= ADVERTISED_TP ; } if ( advertise & NETDEV_F_FIBER ) { ecmd . advertising |= ADVERTISED_FIBRE ; } if ( advertise & NETDEV_F_AUTONEG ) { ecmd . advertising |= ADVERTISED_Autoneg ; } if ( advertise & NETDEV_F_PAUSE ) { ecmd . advertising |= ADVERTISED_Pause ; } if ( advertise & NETDEV_F_PAUSE_ASYM ) { ecmd . advertising |= ADVERTISED_Asym_Pause ; } COVERAGE_INC ( netdev_set_ethtool ) ; error = netdev_linux_do_ethtool ( netdev_get_name ( netdev_ ) , & ecmd , ETHTOOL_SSET , "ETHTOOL_SSET" ) ; exit ovs_mutex_unlock ( & netdev -> mutex ) ; return error ; } 