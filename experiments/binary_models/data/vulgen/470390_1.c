static void jsfd_request ( void ) { struct request * req ; req = jsfd_next_request ( ) ; while ( req ) { struct jsfd_part * jdp = req -> rq_disk -> private_data ; unsigned long offset = blk_rq_pos ( req ) << 9 ; size_t len = blk_rq_cur_bytes ( req ) ; int err = - EIO ; if ( ( offset + len ) > jdp -> dsize ) { end } if ( ( jdp -> dbase & 0xff000000 ) != 0x20000000 ) { printk ( KERN_ERR "jsfd: bad base %x\n" , ( int ) jdp -> dbase ) ; end } jsfd_read ( bio_data ( req -> bio ) , jdp -> dbase + offset , len ) ; err = 0 ; end if ( ! __blk_end_request_cur ( req , err ) ) { req = jsfd_next_request ( ) ; } } } 