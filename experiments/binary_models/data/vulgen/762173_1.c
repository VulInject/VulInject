int bdb_uri ( db_uri_t * uri ) { bdb_uri_t * buri ; buri = ( bdb_uri_t * ) pkg_malloc ( sizeof ( bdb_uri_t ) ) ; if ( buri == NULL ) { ERR ( "bdb: No memory left\n" ) ; error } memset ( buri , '\0' , sizeof ( bdb_uri_t ) ) ; if ( db_drv_init ( & buri -> drv , bdb_uri_free ) < 0 ) { error } if ( parse_bdb_uri ( buri , & uri -> body ) < 0 ) { error } DB_SET_PAYLOAD ( uri , buri ) ; uri -> cmp = bdb_uri_cmp ; return 0 ; error if ( buri ) { if ( buri -> uri ) { pkg_free ( buri -> uri ) ; } db_drv_free ( & buri -> drv ) ; } return - 1 ; } 