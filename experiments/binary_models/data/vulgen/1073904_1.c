void bpf_sk_storage_free ( struct sock * sk ) { struct bpf_local_storage * sk_storage ; rcu_read_lock ( ) ; sk_storage = rcu_dereference ( sk -> sk_bpf_storage ) ; if ( ! sk_storage ) { rcu_read_unlock ( ) ; return ; } raw_spin_lock_bh ( & sk_storage -> lock ) ; free_sk_storage = bpf_local_storage_unlink_nolock ( sk_storage ) ; raw_spin_unlock_bh ( & sk_storage -> lock ) ; rcu_read_unlock ( ) ; if ( free_sk_storage ) { kfree_rcu ( sk_storage , rcu ) ; } } 