static int wc_HpkeLabeledExpand ( Hpke * hpke , byte * suite_id , word32 suite_id_len , byte * prk , word32 prk_len , byte * label , word32 label_len , byte * info , word32 infoSz , word32 L , byte * out ) { int ret ; byte * labeled_info_p ; byte labeled_info [ MAX_HPKE_LABEL_SZ ] ; byte * labeled_info ; if ( hpke == NULL ) { return BAD_FUNC_ARG ; } labeled_info = ( byte * ) XMALLOC ( MAX_HPKE_LABEL_SZ , hpke -> heap , DYNAMIC_TYPE_TMP_BUFFER ) ; ret = I2OSP ( L , 2 , labeled_info ) ; labeled_info_p = labeled_info + 2 ; if ( ret == 0 ) { XMEMCPY ( labeled_info_p , HPKE_VERSION_STR , HPKE_VERSION_STR_LEN ) ; labeled_info_p += HPKE_VERSION_STR_LEN ; XMEMCPY ( labeled_info_p , suite_id , suite_id_len ) ; labeled_info_p += suite_id_len ; XMEMCPY ( labeled_info_p , label , label_len ) ; labeled_info_p += label_len ; XMEMCPY ( labeled_info_p , info , infoSz ) ; labeled_info_p += infoSz ; PRIVATE_KEY_UNLOCK ( ) ; ret = wc_HKDF_Expand ( hpke -> kdf_digest , prk , prk_len , labeled_info , ( word32 ) ( size_t ) ( labeled_info_p - labeled_info ) , out , L ) ; PRIVATE_KEY_LOCK ( ) ; } XFREE ( labeled_info , hpke -> heap , DYNAMIC_TYPE_TMP_BUFFER ) ; return ret ; } 