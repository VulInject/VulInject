static void convert_raw_to_fpn ( struct ia_css_isp_parameters * params ) { int maxval = 0 ; unsigned int i ; assert ( params ) ; for ( i = 0 ; i < params -> fpn_config . height * params -> fpn_config . width ; i ++ ) { int val = params -> fpn_config . data [ i ] ; if ( val < 0 ) { val = 0 ; } maxval = max ( maxval , val ) ; } params -> fpn_config . shift = 0 ; while ( maxval > 63 ) { maxval >>= 1 ; params -> fpn_config . shift ++ ; } for ( i = 0 ; i < params -> fpn_config . height * params -> fpn_config . width ; i ++ ) { ( ( unsigned short * ) params -> fpn_config . data ) [ i ] >>= params -> fpn_config . shift ; } } 