struct vsp1_bru * vsp1_bru_create ( struct vsp1_device * vsp1 ) { struct vsp1_bru * bru ; int ret ; bru = devm_kzalloc ( vsp1 -> dev , sizeof ( * bru ) , GFP_KERNEL ) ; if ( bru == NULL ) { return ERR_PTR ( - ENOMEM ) ; } bru -> entity . ops = & bru_entity_ops ; bru -> entity . type = VSP1_ENTITY_BRU ; ret = vsp1_entity_init ( vsp1 , & bru -> entity , "bru" , vsp1 -> info -> num_bru_inputs + 1 , & bru_ops , MEDIA_ENT_F_PROC_VIDEO_COMPOSER ) ; v4l2_ctrl_handler_init ( & bru -> ctrls , 1 ) ; v4l2_ctrl_new_std ( & bru -> ctrls , & bru_ctrl_ops , V4L2_CID_BG_COLOR , 0 , 0xffffff , 1 , 0 ) ; bru -> bgcolor = 0 ; bru -> entity . subdev . ctrl_handler = & bru -> ctrls ; if ( bru -> ctrls . error ) { dev_err ( vsp1 -> dev , "bru: failed to initialize controls\n" ) ; ret = bru -> ctrls . error ; vsp1_entity_destroy ( & bru -> entity ) ; return ERR_PTR ( ret ) ; } return bru ; } 