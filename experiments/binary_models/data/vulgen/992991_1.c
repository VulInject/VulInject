static bool arcmsr_remap_pciregion ( struct AdapterControlBlock * acb ) { struct pci_dev * pdev = acb -> pdev ; switch ( acb -> adapter_type ) { case ACB_ADAPTER_TYPE_A : { acb -> pmuA = ioremap ( pci_resource_start ( pdev , 0 ) , pci_resource_len ( pdev , 0 ) ) ; if ( ! acb -> pmuA ) { printk ( KERN_NOTICE "arcmsr%d: memory mapping region fail \n" , acb -> host -> host_no ) ; return false ; } break ; } case ACB_ADAPTER_TYPE_B : { void __iomem * mem_base0 , * mem_base1 ; mem_base0 = ioremap ( pci_resource_start ( pdev , 0 ) , pci_resource_len ( pdev , 0 ) ) ; if ( ! mem_base0 ) { printk ( KERN_NOTICE "arcmsr%d: memory mapping region fail \n" , acb -> host -> host_no ) ; return false ; } mem_base1 = ioremap ( pci_resource_start ( pdev , 2 ) , pci_resource_len ( pdev , 2 ) ) ; if ( ! mem_base1 ) { iounmap ( mem_base0 ) ; printk ( KERN_NOTICE "arcmsr%d: memory mapping region fail \n" , acb -> host -> host_no ) ; return false ; } acb -> mem_base0 = mem_base0 ; acb -> mem_base1 = mem_base1 ; break ; } case ACB_ADAPTER_TYPE_C : { if ( ! acb -> pmuC ) { printk ( KERN_NOTICE "arcmsr%d: memory mapping region fail \n" , acb -> host -> host_no ) ; return false ; } if ( readl ( & acb -> pmuC -> outbound_doorbell ) & ARCMSR_HBCMU_IOP2DRV_MESSAGE_CMD_DONE ) { writel ( ARCMSR_HBCMU_IOP2DRV_MESSAGE_CMD_DONE_DOORBELL_CLEAR , & acb -> pmuC -> outbound_doorbell_clear ) ; return true ; } break ; } case ACB_ADAPTER_TYPE_D : { void __iomem * mem_base0 ; unsigned long addr , range ; addr = ( unsigned long ) pci_resource_start ( pdev , 0 ) ; range = pci_resource_len ( pdev , 0 ) ; mem_base0 = ioremap ( addr , range ) ; if ( ! mem_base0 ) { pr_notice ( "arcmsr%d: memory mapping region fail\n" , acb -> host -> host_no ) ; return false ; } acb -> mem_base0 = mem_base0 ; break ; } case ACB_ADAPTER_TYPE_E : { acb -> pmuE = ioremap ( pci_resource_start ( pdev , 1 ) , pci_resource_len ( pdev , 1 ) ) ; if ( ! acb -> pmuE ) { pr_notice ( "arcmsr%d: memory mapping region fail \n" , acb -> host -> host_no ) ; return false ; } writel ( 0 , & acb -> pmuE -> host_int_status ) ; writel ( ARCMSR_HBEMU_DOORBELL_SYNC , & acb -> pmuE -> iobound_doorbell ) ; acb -> in_doorbell = 0 ; acb -> out_doorbell = 0 ; break ; } case ACB_ADAPTER_TYPE_F : { acb -> pmuF = ioremap ( pci_resource_start ( pdev , 0 ) , pci_resource_len ( pdev , 0 ) ) ; if ( ! acb -> pmuF ) { pr_notice ( "arcmsr%d: memory mapping region fail\n" , acb -> host -> host_no ) ; return false ; } writel ( 0 , & acb -> pmuF -> host_int_status ) ; writel ( ARCMSR_HBFMU_DOORBELL_SYNC , & acb -> pmuF -> iobound_doorbell ) ; acb -> in_doorbell = 0 ; acb -> out_doorbell = 0 ; break ; } } return true ; } 