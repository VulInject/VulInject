int venus_boot ( struct venus_core * core ) { struct device * dev = core -> dev ; const struct venus_resources * res = core -> res ; const char * fwpath = NULL ; phys_addr_t mem_phys ; size_t mem_size ; int ret ; ret = of_property_read_string_index ( dev -> of_node , "firmware-name" , 0 , & fwpath ) ; if ( ret ) { fwpath = core -> res -> fwname ; } ret = venus_load_fw ( core , fwpath , & mem_phys , & mem_size ) ; if ( ret ) { dev_err ( dev , "fail to load video firmware\n" ) ; return - EINVAL ; } core -> fw . mem_size = mem_size ; core -> fw . mem_phys = mem_phys ; if ( core -> use_tz ) { ret = qcom_scm_pas_auth_and_reset ( VENUS_PAS_ID ) ; } else { ret = venus_boot_no_tz ( core , mem_phys , mem_size ) ; } if ( ret ) { return ret ; } if ( core -> use_tz && res -> cp_size ) { ret = qcom_scm_mem_protect_video_var ( res -> cp_start , res -> cp_size , res -> cp_nonpixel_start , res -> cp_nonpixel_size ) ; if ( ret ) { qcom_scm_pas_shutdown ( VENUS_PAS_ID ) ; dev_err ( dev , "set virtual address ranges fail (%d)\n" , ret ) ; return ret ; } } return 0 ; } 