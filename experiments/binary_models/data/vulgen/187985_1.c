void topo_vdprintf ( topo_hdl_t * thp , const char * mod , const char * format , va_list ap ) { char * msg ; size_t len ; char c ; len = vsnprintf ( & c , 1 , format , ap ) ; ( void ) vsnprintf ( msg , len + 1 , format , ap ) ; if ( msg [ len - 1 ] != '\n' ) { ( void ) strcpy ( & msg [ len ] , "\n" ) ; } if ( thp -> th_dbout == TOPO_DBOUT_SYSLOG ) { if ( mod == NULL ) { syslog ( LOG_DEBUG | LOG_USER , "libtopo DEBUG: %s" , msg ) ; } else { syslog ( LOG_DEBUG | LOG_USER , "libtopo DEBUG: %s: %s" , mod , msg ) ; } } else { if ( mod == NULL ) { ( void ) fprintf ( stderr , "libtopo DEBUG: %s" , msg ) ; } else { ( void ) fprintf ( stderr , "libtopo DEBUG: %s: %s" , mod , msg ) ; } } } 