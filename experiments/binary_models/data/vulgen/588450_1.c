static char * parse_filepath ( unsigned int repoid , const char * path , const char * file , enum location loc ) { struct parse_repo * rp ; char * fn , * repopath ; rp = repo_get ( repoid ) ; if ( rp == NULL ) { errx ( 1 , "build file path: repository %u missing" , repoid ) ; } if ( loc == DIR_VALID ) { repopath = rp -> validpath ; } else { repopath = rp -> path ; } if ( path == NULL ) { if ( asprintf ( & fn , "%s/%s" , repopath , file ) == - 1 ) { err ( 1 , NULL ) ; } } else { if ( asprintf ( & fn , "%s/%s/%s" , repopath , path , file ) == - 1 ) { err ( 1 , NULL ) ; } } return fn ; } 