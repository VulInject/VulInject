static int __verify_ras_table_checksum ( struct amdgpu_ras_eeprom_control * control ) { struct amdgpu_device * adev = to_amdgpu_device ( control ) ; int buf_size , res ; u8 csum , * buf , * pp ; buf_size = RAS_TABLE_HEADER_SIZE + control -> ras_num_recs * RAS_TABLE_RECORD_SIZE ; if ( ! buf ) { DRM_ERROR ( "Out of memory checking RAS table checksum.\n" ) ; return - ENOMEM ; } res = amdgpu_eeprom_read ( adev -> pm . ras_eeprom_i2c_bus , control -> i2c_address + control -> ras_header_offset , buf , buf_size ) ; if ( res < buf_size ) { DRM_ERROR ( "Partial read for checksum, res:%d\n" , res ) ; if ( res >= 0 ) { res = - EIO ; } Out } csum = 0 ; for ( pp = buf ; pp < buf + buf_size ; pp ++ ) { csum += * pp ; } Out kfree ( buf ) ; return res < 0 ?res : csum ; } 