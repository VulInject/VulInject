int _is_authorized ( char * auths , uid_t uid ) { char * dcp , * authlist , * lasts ; char pw_buf [ NSS_BUFLEN_PASSWD ] ; struct passwd pw_ent ; if ( strcmp ( auths , "@" ) == 0 ) { return ( 1 ) ; } if ( strcmp ( auths , "*" ) == 0 ) { return ( ALLOC_BY_NONE ) ; } if ( getpwuid_r ( uid , & pw_ent , pw_buf , sizeof ( pw_buf ) ) == NULL ) { return ( 0 ) ; } if ( strpbrk ( auths , DEVICE_AUTH_SEPARATOR ) == NULL ) { return ( chkauthattr ( auths , pw_ent . pw_name ) ) ; } authlist = strdup ( auths ) ; if ( authlist == NULL ) { return ( 0 ) ; } for ( dcp = authlist ; ( dcp = strtok_r ( dcp , DEVICE_AUTH_SEPARATOR , & lasts ) ) != NULL ; dcp = NULL ) { if ( chkauthattr ( dcp , pw_ent . pw_name ) ) { break ; } } return ( dcp != NULL ) ; } 