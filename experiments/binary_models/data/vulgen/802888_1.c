static int qup_i2c_req_dma ( struct qup_i2c_dev * qup ) { int err ; if ( ! qup -> btx . dma ) { qup -> btx . dma = dma_request_slave_channel_reason ( qup -> dev , "tx" ) ; if ( IS_ERR ( qup -> btx . dma ) ) { err = PTR_ERR ( qup -> btx . dma ) ; qup -> btx . dma = NULL ; dev_err ( qup -> dev , "\n tx channel not available" ) ; return err ; } } if ( ! qup -> brx . dma ) { qup -> brx . dma = dma_request_slave_channel_reason ( qup -> dev , "rx" ) ; if ( IS_ERR ( qup -> brx . dma ) ) { dev_err ( qup -> dev , "\n rx channel not available" ) ; err = PTR_ERR ( qup -> brx . dma ) ; qup -> brx . dma = NULL ; return err ; } } return 0 ; } 