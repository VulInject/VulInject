void flush_route ( struct babel_route * route ) { int i ; struct source * src ; unsigned oldmetric ; int lost = 0 ; oldmetric = route_metric ( route ) ; src = route -> src ; if ( route -> installed ) { uninstall_route ( route ) ; lost = 1 ; } i = find_route_slot ( route -> src -> prefix , route -> src -> plen , NULL ) ; assert ( i >= 0 && i < route_slots ) ; if ( route == routes [ i ] ) { routes [ i ] = route -> next ; route -> next = NULL ; free ( route ) ; if ( route_slots == 0 ) { resize_route_table ( 0 ) ; } if ( max_route_slots > 8 && route_slots < max_route_slots / 4 ) { resize_route_table ( max_route_slots / 2 ) ; } } else { struct babel_route * r = routes [ i ] ; while ( r -> next != route ) { r = r -> next ; } r -> next = route -> next ; route -> next = NULL ; free ( route ) ; } if ( lost ) { route_lost ( src , oldmetric ) ; } release_source ( src ) ; } 