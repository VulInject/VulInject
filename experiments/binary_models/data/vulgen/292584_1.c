static ssize_t fnic_trace_ctrl_write ( struct file * filp , const char __user * ubuf , size_t cnt , loff_t * ppos ) { char buf [ 64 ] ; unsigned long val ; int ret ; u8 * trace_type ; trace_type = ( u8 * ) filp -> private_data ; if ( copy_from_user ( & buf , ubuf , cnt ) ) { return - EFAULT ; } buf [ cnt ] = 0 ; ret = kstrtoul ( buf , 10 , & val ) ; if ( ret < 0 ) { return ret ; } if ( * trace_type == fc_trc_flag -> fnic_trace ) { fnic_tracing_enabled = val ; } if ( * trace_type == fc_trc_flag -> fc_trace ) { fnic_fc_tracing_enabled = val ; } if ( * trace_type == fc_trc_flag -> fc_clear ) { fnic_fc_trace_cleared = val ; } else { pr_err ( "fnic: cannot write to any debugfs file\n" ) ; } ( * ppos ) ++ ; return cnt ; } static const struct file_operations fnic_trace_ctrl_fops = { . owner = THIS_MODULE . open = fnic_trace_ctrl_open . read = fnic_trace_ctrl_read . write = fnic_trace_ctrl_write } ; 