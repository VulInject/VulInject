subs_t * mem_copy_subs_noc ( subs_t * s ) { int size ; subs_t * dest ; size = sizeof ( subs_t ) + ( s -> pres_uri . len + s -> to_user . len + s -> to_domain . len + s -> from_user . len + s -> from_domain . len + s -> callid . len + s -> to_tag . len + s -> from_tag . len + s -> sockinfo_str . len + s -> event_id . len + s -> local_contact . len + s -> reason . len + s -> watcher_user . len + s -> watcher_domain . len + s -> user_agent . len + 1 ) * sizeof ( char ) ; if ( dest == NULL ) { ERR_MEM ( SHARE_MEM ) ; } memset ( dest , 0 , size ) ; size = sizeof ( subs_t ) ; CONT_COPY ( dest , dest -> pres_uri , s -> pres_uri ) ; CONT_COPY ( dest , dest -> to_user , s -> to_user ) ; CONT_COPY ( dest , dest -> to_domain , s -> to_domain ) ; CONT_COPY ( dest , dest -> from_user , s -> from_user ) ; CONT_COPY ( dest , dest -> from_domain , s -> from_domain ) ; CONT_COPY ( dest , dest -> watcher_user , s -> watcher_user ) ; CONT_COPY ( dest , dest -> watcher_domain , s -> watcher_domain ) ; CONT_COPY ( dest , dest -> to_tag , s -> to_tag ) ; CONT_COPY ( dest , dest -> from_tag , s -> from_tag ) ; CONT_COPY ( dest , dest -> callid , s -> callid ) ; CONT_COPY ( dest , dest -> sockinfo_str , s -> sockinfo_str ) ; CONT_COPY ( dest , dest -> local_contact , s -> local_contact ) ; CONT_COPY ( dest , dest -> user_agent , s -> user_agent ) ; if ( s -> event_id . s ) { CONT_COPY ( dest , dest -> event_id , s -> event_id ) ; } if ( s -> reason . s ) { CONT_COPY ( dest , dest -> reason , s -> reason ) ; } dest -> event = s -> event ; dest -> local_cseq = s -> local_cseq ; dest -> remote_cseq = s -> remote_cseq ; dest -> status = s -> status ; dest -> version = s -> version ; dest -> send_on_cback = s -> send_on_cback ; dest -> expires = s -> expires ; dest -> db_flag = s -> db_flag ; dest -> flags = s -> flags ; dest -> contact . s = ( char * ) shm_malloc ( s -> contact . len * sizeof ( char ) ) ; if ( dest -> contact . s == NULL ) { ERR_MEM ( SHARE_MEM ) ; } memcpy ( dest -> contact . s , s -> contact . s , s -> contact . len ) ; dest -> contact . len = s -> contact . len ; dest -> record_route . s = ( char * ) shm_malloc ( ( s -> record_route . len + 1 ) * sizeof ( char ) ) ; if ( dest -> record_route . s == NULL ) { ERR_MEM ( SHARE_MEM ) ; } memcpy ( dest -> record_route . s , s -> record_route . s , s -> record_route . len ) ; dest -> record_route . len = s -> record_route . len ; return dest ; error if ( dest ) { shm_free ( dest ) ; } return NULL ; } 