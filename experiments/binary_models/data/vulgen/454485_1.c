static ssize_t rmi_driver_update_fw_store ( struct device * dev , struct device_attribute * dattr , const char * buf , size_t count ) { struct rmi_driver_data * data = dev_get_drvdata ( dev ) ; char fw_name [ NAME_MAX ] ; const struct firmware * fw ; size_t copy_count = count ; int ret ; if ( buf [ count - 1 ] == '\0' || buf [ count - 1 ] == '\n' ) { copy_count -= 1 ; } strncpy ( fw_name , buf , copy_count ) ; fw_name [ copy_count ] = '\0' ; ret = request_firmware ( & fw , fw_name , dev ) ; if ( ret ) { return ret ; } dev_info ( dev , "Flashing %s\n" , fw_name ) ; ret = rmi_firmware_update ( data , fw ) ; release_firmware ( fw ) ; return ret ?: count ; } 