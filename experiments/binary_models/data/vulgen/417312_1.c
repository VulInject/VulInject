void uoakv_attach ( struct device * parent , struct device * self , void * aux ) { struct uoakv_softc * sc = ( uoakv_softc * ) self ; struct usb_attach_arg * uaa = aux ; struct uhidev_attach_arg * uha = ( uhidev_attach_arg * ) uaa ; struct usbd_device * dev = uha -> parent -> sc_udev ; struct uoak_softc * scc = & sc -> sc_uoak_softc ; int i , err , size , repid ; void * desc ; sc -> sc_hdev . sc_intr = uoakv_intr ; sc -> sc_hdev . sc_parent = uha -> parent ; sc -> sc_hdev . sc_report_id = uha -> reportid ; scc -> sc_parent = sc ; scc -> sc_udev = dev ; scc -> sc_hdev = & sc -> sc_hdev ; scc -> sc_methods = & uoakv_methods ; scc -> sc_sensordev = & sc -> sc_sensordev ; uhidev_get_report_desc ( uha -> parent , & desc , & size ) ; repid = uha -> reportid ; scc -> sc_ilen = hid_report_size ( desc , size , hid_input , repid ) ; scc -> sc_olen = hid_report_size ( desc , size , hid_output , repid ) ; scc -> sc_flen = hid_report_size ( desc , size , hid_feature , repid ) ; ( void ) uoak_led_ctrl ( scc , OAK_TARGET_RAM , OAK_LED_ON ) ; err = uoak_set_sample_rate ( scc , OAK_TARGET_RAM , UOAKV_SAMPLE_RATE ) ; if ( err ) { printf ( "%s: could not set sampling rate. exit\n" , sc -> sc_hdev . sc_dev . dv_xname ) ; return ; } uoak_get_devinfo ( scc ) ; uoak_print_devinfo ( scc ) ; DPRINTF ( ( " config in RAM\n" ) ) ; uoak_get_setting ( scc , OAK_TARGET_RAM ) ; uoak_print_setting ( scc , OAK_TARGET_RAM ) ; DPRINTF ( ( " config in FRASH\n" ) ) ; uoak_get_setting ( scc , OAK_TARGET_FLASH ) ; uoak_print_setting ( scc , OAK_TARGET_FLASH ) ; strlcpy ( sc -> sc_sensordev . xname , sc -> sc_hdev . sc_dev . dv_xname , sizeof ( sc -> sc_sensordev . xname ) ) ; for ( i = 0 ; i < OAK_V_MAXSENSORS ; i ++ ) { uoak_sensor_attach ( scc , & sc -> sc_sensor [ i ] . v , SENSOR_VOLTS_DC ) ; } sc -> sc_sensortask = sensor_task_register ( sc , uoakv_refresh , UOAKV_REFRESH_PERIOD ) ; sensordev_install ( & sc -> sc_sensordev ) ; err = uhidev_open ( & sc -> sc_hdev ) ; if ( err ) { printf ( "%s: could not open interrupt pipe, quit\n" , sc -> sc_hdev . sc_dev . dv_xname ) ; return ; } scc -> sc_ibuf = malloc ( scc -> sc_ilen , M_USBDEV , M_WAITOK ) ; DPRINTF ( ( "uoakv_attach: complete\n" ) ) ; } 