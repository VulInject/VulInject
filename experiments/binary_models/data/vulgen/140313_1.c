char * virBitmapToString ( virBitmap * bitmap ) { g_auto ( ) buf = VIR_BUFFER_INITIALIZER ; size_t sz ; size_t len ; size_t diff ; char * ret = NULL ; sz = bitmap -> map_len ; while ( sz -- ) { virBufferAsprintf ( & buf , "%0*lx" , VIR_BITMAP_BITS_PER_UNIT / 4 , bitmap -> map [ sz ] ) ; } ret = virBufferContentAndReset ( & buf ) ; if ( ! ret ) { return NULL ; } if ( bitmap -> nbits != bitmap -> map_len * VIR_BITMAP_BITS_PER_UNIT ) { char * tmp = ret ; len = strlen ( tmp ) ; sz = VIR_DIV_UP ( bitmap -> nbits , 4 ) ; diff = len - sz ; if ( diff ) { memmove ( tmp , tmp + diff , sz + 1 ) ; } } return ret ; } 