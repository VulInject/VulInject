static void audiohd_build_input_amp ( hda_codec_t * codec ) { audiohd_path_t * path ; audiohd_widget_t * wsum , * wadc , * w ; audiohd_pin_t * pin ; uint_t gain ; wid_t wid , next ; int i , j ; int weight ; for ( i = 0 ; i < codec -> statep -> pathnum ; i ++ ) { path = codec -> statep -> path [ i ] ; wid = path -> adda_wid ; wadc = path -> codec -> widget [ wid ] ; weight = wadc -> in_weight ; w = wadc ; while ( w ) { if ( w -> outamp_cap & AUDIOHDC_AMP_CAP_MUTE_CAP ) { path -> mute_wid = w -> wid_wid ; path -> mute_dir = AUDIOHDC_AMP_SET_OUTPUT ; break ; } if ( ( w -> inamp_cap & AUDIOHDC_AMP_CAP_MUTE_CAP ) && ( w -> wid_wid != path -> sum_wid ) ) { path -> mute_wid = w -> wid_wid ; path -> mute_dir = AUDIOHDC_AMP_SET_INPUT ; break ; } next = w -> input_path_next ; if ( next == AUDIOHD_NULL_CONN ) { break ; } wid = w -> avail_conn [ next ] ; w = path -> codec -> widget [ wid ] ; if ( w && w -> in_weight != weight ) { break ; } } w = wadc ; gain = 0 ; while ( w ) { gain = ( w -> outamp_cap & AUDIOHDC_AMP_CAP_STEP_NUMS ) ; if ( gain && gain > path -> gain_bits ) { path -> gain_dir = AUDIOHDC_AMP_SET_OUTPUT ; path -> gain_bits = gain ; path -> gain_wid = w -> wid_wid ; } gain = w -> inamp_cap & AUDIOHDC_AMP_CAP_STEP_NUMS ; if ( gain && ( gain > path -> gain_bits ) && ( w -> wid_wid != path -> sum_wid ) ) { path -> gain_dir = AUDIOHDC_AMP_SET_INPUT ; path -> gain_bits = gain ; path -> gain_wid = w -> wid_wid ; } next = w -> input_path_next ; if ( next == AUDIOHD_NULL_CONN ) { break ; } wid = w -> avail_conn [ next ] ; w = path -> codec -> widget [ wid ] ; } path -> gain_bits >>= AUDIOHD_GAIN_OFF ; if ( path -> pin_nums == 1 ) { wid = path -> pin_wid [ 0 ] ; w = path -> codec -> widget [ wid ] ; pin = ( audiohd_pin_t * ) w -> priv ; pin -> gain_dir = path -> gain_dir ; pin -> gain_bits = path -> gain_bits ; pin -> gain_wid = path -> gain_wid ; pin -> mute_wid = path -> mute_wid ; pin -> mute_dir = path -> mute_dir ; continue ; } wid = path -> sum_wid ; wsum = path -> codec -> widget [ wid ] ; for ( j = 0 ; j < path -> pin_nums ; j ++ ) { wid = path -> pin_wid [ j ] ; w = path -> codec -> widget [ wid ] ; pin = ( audiohd_pin_t * ) w -> priv ; if ( wsum -> inamp_cap & AUDIOHDC_AMP_CAP_MUTE_CAP ) { pin -> mute_wid = wsum -> wid_wid ; pin -> mute_dir = AUDIOHDC_AMP_SET_INPUT ; } else { wid = wsum -> avail_conn [ path -> sum_selconn [ i ] ] ; w = path -> codec -> widget [ wid ] ; while ( w ) { if ( w -> outamp_cap & AUDIOHDC_AMP_CAP_MUTE_CAP ) { pin -> mute_wid = w -> wid_wid ; pin -> mute_dir = AUDIOHDC_AMP_SET_OUTPUT ; break ; } if ( w -> inamp_cap & AUDIOHDC_AMP_CAP_MUTE_CAP ) { pin -> mute_wid = w -> wid_wid ; pin -> mute_dir = AUDIOHDC_AMP_SET_INPUT ; break ; } next = w -> input_path_next ; if ( next == AUDIOHD_NULL_CONN ) { break ; } wid = w -> avail_conn [ next ] ; w = path -> codec -> widget [ wid ] ; } } gain = ( wsum -> inamp_cap & AUDIOHDC_AMP_CAP_STEP_NUMS ) ; wid = wsum -> avail_conn [ path -> sum_selconn [ i ] ] ; w = path -> codec -> widget [ wid ] ; while ( w ) { gain = ( w -> outamp_cap & AUDIOHDC_AMP_CAP_STEP_NUMS ) ; if ( gain && gain > pin -> gain_bits ) { pin -> gain_dir = AUDIOHDC_AMP_SET_OUTPUT ; pin -> gain_bits = gain ; pin -> gain_wid = w -> wid_wid ; } gain = w -> inamp_cap & AUDIOHDC_AMP_CAP_STEP_NUMS ; if ( gain && ( gain > pin -> gain_bits ) ) { pin -> gain_dir = AUDIOHDC_AMP_SET_INPUT ; pin -> gain_bits = gain ; pin -> gain_wid = w -> wid_wid ; } next = w -> input_path_next ; if ( next == AUDIOHD_NULL_CONN ) { break ; } wid = w -> avail_conn [ next ] ; w = path -> codec -> widget [ wid ] ; } pin -> gain_bits >>= AUDIOHD_GAIN_OFF ; } } } 