void conn_close ( struct conn * conn ) { struct search * search , * next ; struct listener * l = conn -> listener ; log_debug ( "closing connection %d" , conn -> fd ) ; for ( search = TAILQ_FIRST ( & conn -> searches ) ; search ; search = next ) { next = TAILQ_NEXT ( search , next ) ; search_close ( search ) ; } namespace_cancel_conn ( conn ) ; tls_free ( conn -> tls ) ; TAILQ_REMOVE ( & conn_list , conn , next ) ; ober_free ( & conn -> ber ) ; close ( conn -> fd ) ; if ( evtimer_pending ( & l -> evt , NULL ) ) { evtimer_del ( & l -> evt ) ; event_add ( & l -> ev , NULL ) ; } free ( conn -> binddn ) ; free ( conn -> pending_binddn ) ; free ( conn ) ; -- stats . conns ; } 