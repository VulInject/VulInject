int rsnd_dma_probe ( struct rsnd_priv * priv ) { struct platform_device * pdev = rsnd_priv_to_pdev ( priv ) ; struct device * dev = rsnd_priv_to_dev ( priv ) ; struct rsnd_dma_ctrl * dmac ; struct resource * res ; if ( rsnd_is_gen1 ( priv ) ) { return 0 ; } res = platform_get_resource_byname ( pdev , IORESOURCE_MEM , "audmapp" ) ; dmac = devm_kzalloc ( dev , sizeof ( * dmac ) , GFP_KERNEL ) ; if ( ! dmac || ! res ) { dev_err ( dev , "dma allocate failed\n" ) ; return 0 ; } dmac -> base = devm_ioremap_resource ( dev , res ) ; if ( IS_ERR ( dmac -> base ) ) { return PTR_ERR ( dmac -> base ) ; } priv -> dma = dmac ; return 0 ; } 