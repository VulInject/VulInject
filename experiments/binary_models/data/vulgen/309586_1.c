static void tc358743_hdmi_sys_int_handler ( struct v4l2_subdev * sd , bool * handled ) { struct tc358743_state * state = to_state ( sd ) ; u8 sys_int_mask = i2c_rd8 ( sd , SYS_INTM ) ; u8 sys_int = i2c_rd8 ( sd , SYS_INT ) & ~ sys_int_mask ; i2c_wr8 ( sd , SYS_INT , sys_int ) ; v4l2_dbg ( 3 , debug , sd , "%s: SYS_INT = 0x%02x\n" , __func__ , sys_int ) ; if ( sys_int & MASK_I_DDC ) { bool tx_5v = tx_5v_power_present ( sd ) ; v4l2_dbg ( 1 , debug , sd , "%s: Tx 5V power present: %s\n" , __func__ , tx_5v ?"yes" : "no" ) ; if ( tx_5v ) { tc358743_enable_edid ( sd ) ; } else { tc358743_enable_interrupts ( sd , false ) ; tc358743_disable_edid ( sd ) ; tc358743_erase_bksv ( sd ) ; tc358743_update_controls ( sd ) ; } sys_int &= ~ MASK_I_DDC ; if ( handled ) { * handled = true ; } } if ( sys_int & MASK_I_DVI ) { v4l2_dbg ( 1 , debug , sd , "%s: HDMI->DVI change detected\n" , __func__ ) ; if ( no_sync ( sd ) || no_signal ( sd ) ) { tc358743_reset_phy ( sd ) ; tc358743_erase_bksv ( sd ) ; } sys_int &= ~ MASK_I_DVI ; if ( handled ) { * handled = true ; } } if ( sys_int & MASK_I_HDMI ) { v4l2_dbg ( 1 , debug , sd , "%s: DVI->HDMI change detected\n" , __func__ ) ; i2c_wr8 ( sd , ANA_CTL , MASK_APPL_PCSX_NORMAL | MASK_ANALOG_ON ) ; sys_int &= ~ MASK_I_HDMI ; if ( handled ) { * handled = true ; } } if ( sys_int ) { v4l2_err ( sd , "%s: Unhandled SYS_INT interrupts: 0x%02x\n" , __func__ , sys_int ) ; } } 