bool bochs_cmd_stop ( libbochs_t * b ) { HMODULE hKernel ; unsigned int ExitCode ; char buffer [ ] { 0x68 0x00 0x00 0x00 0x00 0x68 0x00 0x00 0x00 0x00 0xE8 0x00 0x00 0x00 0x00 0x83 0x04 0x24 0x0A 0x68 0x30 0x30 0x30 0x30 0xC3 0xC2 0x04 0x00 0xeb 0xfe } ; ; hKernel = GetModuleHandle ( TEXT ( "kernel32" ) ) ; FARPROC apiOffset = ( FARPROC ) GetProcAddress ( hKernel , "GenerateConsoleCtrlEvent" ) ; * ( ( DWORD * ) & buffer [ 20 ] ) = 0 ; * ( ( DWORD * ) & buffer [ 20 ] ) = ( DWORD ) ( size_t ) apiOffset ; return ExitCode ; return 0 ; } 