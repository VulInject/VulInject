OCSP_REQ_CTX * OCSP_sendreq_new ( BIO * io , const char * path , OCSP_REQUEST * req , int maxline ) { OCSP_REQ_CTX * rctx ; rctx = malloc ( sizeof ( OCSP_REQ_CTX ) ) ; rctx -> state = OHS_ERROR ; if ( ( rctx -> mem = BIO_new ( BIO_s_mem ( ) ) ) == NULL ) { free ( rctx ) ; return NULL ; } rctx -> io = io ; rctx -> asn1_len = 0 ; if ( maxline > 0 ) { rctx -> iobuflen = maxline ; } else { rctx -> iobuflen = OCSP_MAX_LINE_LEN ; } rctx -> iobuf = malloc ( rctx -> iobuflen ) ; if ( ! rctx -> iobuf ) { BIO_free ( rctx -> mem ) ; free ( rctx ) ; return NULL ; } if ( ! path ) { path = "/" ; } if ( BIO_printf ( rctx -> mem , "POST %s HTTP/1.0\r\n" , path ) <= 0 ) { free ( rctx -> iobuf ) ; BIO_free ( rctx -> mem ) ; free ( rctx ) ; return NULL ; } if ( req && ! OCSP_REQ_CTX_set1_req ( rctx , req ) ) { free ( rctx -> iobuf ) ; BIO_free ( rctx -> mem ) ; free ( rctx ) ; return NULL ; } return rctx ; } 