URIHANDLER_FUNC ( ) { plugin_data * p = p_d ; handler_ctx * hctx = r -> plugin_ctx [ p -> id ] ; if ( hctx -> handled ) { return HANDLER_GO_ON ; } hctx -> handled = 1 ; mod_setenv_patch_config ( r , p , & hctx -> conf ) ; const array * const aa = hctx -> conf . request_header ; const array * const as = hctx -> conf . set_request_header ; if ( aa ) { for ( uint32_t k = 0 ; k < aa -> used ; ++ k ) { const data_string * const ds = ( const data_string * ) aa -> data [ k ] ; http_header_request_append ( r , ds -> ext , BUF_PTR_LEN ( & ds -> key ) , BUF_PTR_LEN ( & ds -> value ) ) ; } } if ( as ) { for ( uint32_t k = 0 ; k < as -> used ; ++ k ) { const data_string * const ds = ( const data_string * ) as -> data [ k ] ; ! buffer_is_blank ( & ds -> value ) ?http_header_request_set ( r , ds -> ext , BUF_PTR_LEN ( & ds -> key ) , BUF_PTR_LEN ( & ds -> value ) ) : http_header_request_unset ( r , ds -> ext , BUF_PTR_LEN ( & ds -> key ) ) ; } } return HANDLER_GO_ON ; } 