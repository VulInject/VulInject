static void escape ( str * dst , char * r , int len , int all ) { int i ; char * w ; if ( ! len ) { dst -> len = 0 ; return ; } w = dst -> s ; for ( i = 0 ; i < len ; i ++ ) { switch ( r [ i ] ) { case '\n' : * w ++ = '\\' ; * w ++ = 'n' ; break ; case '\r' : * w ++ = '\\' ; * w ++ = 'r' ; break ; case '\t' : * w ++ = '\\' ; * w ++ = 't' ; break ; case '\\' : * w ++ = '\\' ; * w ++ = '\\' ; break ; case '\0' : * w ++ = '\\' ; * w ++ = '0' ; break ; case ':' : if ( all ) { * w ++ = '\\' ; * w ++ = 'o' ; } else { * w ++ = r [ i ] ; } break ; case ',' : if ( all ) { * w ++ = '\\' ; * w ++ = 'c' ; } else { * w ++ = r [ i ] ; } break ; default : * w ++ = r [ i ] ; break ; } } } 