static int mt8173_rt5650_hw_params ( struct snd_pcm_substream * substream , struct snd_pcm_hw_params * params ) { struct snd_soc_pcm_runtime * rtd = asoc_substream_to_rtd ( substream ) ; unsigned int mclk_clock ; struct snd_soc_dai * codec_dai ; int i , ret ; switch ( mt8173_rt5650_priv . pll_from ) { case MT8173_RT5650_MCLK_EXTERNAL : mclk_clock = MCLK_FOR_CODECS ; break ; case MT8173_RT5650_MCLK_INTERNAL : mclk_clock = params_rate ( params ) * 256 ; break ; default : mclk_clock = MCLK_FOR_CODECS ; break ; } for_each_rtd_codec_dais ( , , ) { ret = snd_soc_dai_set_pll ( codec_dai , 0 , 0 , mclk_clock , params_rate ( params ) * 512 ) ; if ( ret ) { return ret ; } if ( ret ) { return ret ; } } return 0 ; } 