bool cset_add ( struct cset * cs , wchar_t ch ) { struct csnode * csn , * ncsn ; wchar_t oval ; cs -> cs_havecache = false ; if ( cs -> cs_root == NULL ) { csn = malloc ( sizeof ( * cs -> cs_root ) ) ; if ( csn == NULL ) { return ( false ) ; } csn -> csn_left = csn -> csn_right = NULL ; csn -> csn_min = csn -> csn_max = ch ; cs -> cs_root = csn ; return ( true ) ; } csn = cs -> cs_root = cset_splay ( cs -> cs_root , ch ) ; if ( cset_rangecmp ( csn , ch ) == 0 ) { return ( true ) ; } ncsn = malloc ( sizeof ( * ncsn ) ) ; if ( ncsn == NULL ) { return ( false ) ; } ncsn -> csn_min = ncsn -> csn_max = ch ; if ( cset_rangecmp ( csn , ch ) < 0 ) { ncsn -> csn_left = csn -> csn_left ; ncsn -> csn_right = csn ; csn -> csn_left = NULL ; } else { ncsn -> csn_right = csn -> csn_right ; ncsn -> csn_left = csn ; csn -> csn_right = NULL ; } cs -> cs_root = ncsn ; if ( ncsn -> csn_left != NULL ) { ncsn -> csn_left = cset_splay ( ncsn -> csn_left , ncsn -> csn_min - 1 ) ; if ( ncsn -> csn_left -> csn_max == ncsn -> csn_min - 1 ) { oval = ncsn -> csn_left -> csn_min ; ncsn -> csn_left = cset_delete ( ncsn -> csn_left , ncsn -> csn_left -> csn_min ) ; ncsn -> csn_min = oval ; } } return ( true ) ; } 