void pgstat_update_dbstats ( TimestampTz ts ) { PgStat_StatDBEntry * dbentry ; dbentry -> xact_commit += pgStatXactCommit ; dbentry -> xact_rollback += pgStatXactRollback ; dbentry -> blk_read_time += pgStatBlockReadTime ; dbentry -> blk_write_time += pgStatBlockWriteTime ; if ( pgstat_should_report_connstat ( ) ) { long secs ; int usecs ; TimestampDifference ( pgLastSessionReportTime , ts , & secs , & usecs ) ; pgLastSessionReportTime = ts ; dbentry -> session_time += ( PgStat_Counter ) secs * 1000000 + usecs ; dbentry -> active_time += pgStatActiveTime ; dbentry -> idle_in_transaction_time += pgStatTransactionIdleTime ; } pgStatXactCommit = 0 ; pgStatXactRollback = 0 ; pgStatBlockReadTime = 0 ; pgStatBlockWriteTime = 0 ; pgStatActiveTime = 0 ; pgStatTransactionIdleTime = 0 ; } 