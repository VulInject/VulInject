static void __init cell_iommu_setup_fixed_ptab ( struct cbe_iommu * iommu , struct device_node * np , unsigned long dbase , unsigned long dsize , unsigned long fbase , unsigned long fsize ) { unsigned long base_pte , uaddr , ioaddr , * ptab ; dma_iommu_fixed_base = fbase ; pr_debug ( "iommu: mapping 0x%lx pages from 0x%lx\n" , fsize , fbase ) ; base_pte = CBE_IOPTE_PP_W | CBE_IOPTE_PP_R | CBE_IOPTE_M | ( cell_iommu_get_ioid ( np ) & CBE_IOPTE_IOID_Mask ) ; if ( iommu_fixed_is_weak ) { pr_info ( "IOMMU: Using weak ordering for fixed mapping\n" ) ; } else { pr_info ( "IOMMU: Using strong ordering for fixed mapping\n" ) ; base_pte |= CBE_IOPTE_SO_RW ; } for ( uaddr = 0 ; uaddr < fsize ; uaddr += ( 1 << 24 ) ) { ioaddr = uaddr + fbase ; if ( ioaddr >= dbase && ioaddr < ( dbase + dsize ) ) { pr_debug ( "iommu: fixed/dynamic overlap, skipping\n" ) ; continue ; } insert_16M_pte ( uaddr , ptab , base_pte ) ; } mb ( ) ; } 