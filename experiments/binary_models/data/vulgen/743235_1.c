msgtype_t identify_clientmsg ( SOCKET connected_socket ) { OPJ_SIZE_T receive_size ; char buf [ BUF_LEN ] ; static const char * magicid [ ] { "JPIP-stream" "PNM request" "XML request" "TID request" "CID request" "CID destroy" "SIZ request" "JP2 save" "QUIT" } ; ; int i ; receive_size = receive_line ( connected_socket , buf ) ; for ( i = 0 ; i < NUM_OF_MSGTYPES ; i ++ ) { if ( strncasecmp ( magicid [ i ] , buf , strlen ( magicid [ i ] ) ) == 0 ) { fprintf ( stderr , "%s\n" , magicid [ i ] ) ; return i ; } } fprintf ( stderr , "Cannot identify client message type %s\n" , buf ) ; return MSGERROR ; } 