int connect_to ( const char * host , const char * serv ) { int s = - 1 ; struct addrinfo hints , * res0 = NULL , * res ; int error ; hints . ai_family = PF_UNSPEC ; hints . ai_socktype = SOCK_STREAM ; error = getaddrinfo ( host , serv , & hints , & res0 ) ; if ( error ) { warnx ( "%s" , gai_strerror ( error ) ) ; return - 1 ; } for ( res = res0 ; res ; res = res -> ai_next ) { s = socket ( res -> ai_family , res -> ai_socktype , res -> ai_protocol ) ; if ( s == - 1 ) { continue ; } if ( connect ( s , res -> ai_addr , res -> ai_addrlen ) == - 1 ) { close ( s ) ; s = - 1 ; continue ; } break ; } if ( s == - 1 ) { warn ( "cddb" ) ; } freeaddrinfo ( res0 ) ; return s ; } 