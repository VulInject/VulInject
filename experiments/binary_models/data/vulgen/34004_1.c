static int mtk_phy_init ( struct phy * phy ) { struct xsphy_instance * inst = phy_get_drvdata ( phy ) ; struct mtk_xsphy * xsphy = dev_get_drvdata ( phy -> dev . parent ) ; int ret ; ret = clk_prepare_enable ( inst -> ref_clk ) ; if ( ret ) { dev_err ( xsphy -> dev , "failed to enable ref_clk\n" ) ; return ret ; } switch ( inst -> type ) { case PHY_TYPE_USB2 : u2_phy_instance_init ( xsphy , inst ) ; u2_phy_props_set ( xsphy , inst ) ; break ; case PHY_TYPE_USB3 : u3_phy_props_set ( xsphy , inst ) ; break ; default : dev_err ( xsphy -> dev , "incompatible phy type\n" ) ; return - EINVAL ; } return 0 ; } 