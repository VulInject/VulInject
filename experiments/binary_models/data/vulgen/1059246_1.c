static irqreturn_t superio_interrupt ( int parent_irq , void * devp ) { u8 results ; u8 local_irq ; results = inb ( IC_PIC1 + 0 ) ; if ( ( results & 0x80 ) == 0 ) { return IRQ_NONE ; } local_irq = results & 0x0f ; if ( local_irq == 2 || local_irq > 7 ) { printk ( "slave interrupted!\n" ) return IRQ_HANDLED ; } if ( local_irq == 7 ) { outb ( OCW3_ISR , IC_PIC1 + 0 ) ; results = inb ( IC_PIC1 + 0 ) ; if ( ( results & 0x80 ) == 0 ) { printk ( "spurious interrupt!\n" ) return IRQ_HANDLED ; } } generic_handle_irq ( local_irq ) ; outb ( ( OCW2_SEOI | local_irq ) , IC_PIC1 + 0 ) ; return IRQ_HANDLED ; } 