int btracker_queue ( struct background_tracker * b , struct policy_work * work , struct policy_work * * pwork ) { struct bt_work * w ; if ( pwork ) { * pwork = NULL ; } w = kmem_cache_alloc ( b -> work_cache , GFP_NOWAIT ) ; if ( ! w ) { return - ENOMEM ; } memcpy ( & w -> work , work , sizeof ( * work ) ) ; if ( ! __insert_pending ( b , w ) ) { kmem_cache_free ( b -> work_cache , w ) ; return - EINVAL ; } if ( pwork ) { * pwork = & w -> work ; list_add ( & w -> list , & b -> issued ) ; } else { list_add ( & w -> list , & b -> queued ) ; } update_stats ( b , & w -> work , 1 ) ; return 0 ; } 