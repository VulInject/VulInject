HAL_StatusTypeDef HAL_ADCEx_InjectedStart_IT ( ADC_HandleTypeDef * hadc ) { HAL_StatusTypeDef tmp_hal_status = HAL_OK ; assert_param ( IS_ADC_ALL_INSTANCE ( hadc -> Instance ) ) ; if ( ADC_IS_CONVERSION_ONGOING_INJECTED ( hadc ) ) { return HAL_BUSY ; } else { if ( ( READ_BIT ( hadc -> Instance -> JSQR , ADC_JSQR_JEXTEN ) == RESET ) && ( READ_BIT ( hadc -> Instance -> CFGR , ADC_CFGR_JQDIS ) == RESET ) ) { SET_BIT ( hadc -> State , HAL_ADC_STATE_ERROR_CONFIG ) ; return HAL_ERROR ; } __HAL_LOCK ( hadc ) ; tmp_hal_status = ADC_Enable ( hadc ) ; if ( tmp_hal_status == HAL_OK ) { if ( HAL_IS_BIT_SET ( hadc -> State , HAL_ADC_STATE_REG_BUSY ) ) { CLEAR_BIT ( hadc -> ErrorCode , HAL_ADC_ERROR_JQOVF ) ; } else { ADC_CLEAR_ERRORCODE ( hadc ) ; } ADC_STATE_CLR_SET ( hadc -> State , HAL_ADC_STATE_READY | HAL_ADC_STATE_INJ_EOC , HAL_ADC_STATE_INJ_BUSY ) ; __HAL_ADC_CLEAR_FLAG ( hadc , ( ADC_FLAG_JEOC | ADC_FLAG_JEOS ) ) ; __HAL_UNLOCK ( hadc ) ; if ( ( hadc -> Instance -> CFGR & ADC_CFGR_JQM ) != RESET ) { __HAL_ADC_ENABLE_IT ( hadc , ADC_FLAG_JQOVF ) ; } switch ( hadc -> Init . EOCSelection ) { case ADC_EOC_SEQ_CONV : __HAL_ADC_DISABLE_IT ( hadc , ADC_IT_JEOC ) ; __HAL_ADC_ENABLE_IT ( hadc , ADC_IT_JEOS ) ; break ; default : __HAL_ADC_DISABLE_IT ( hadc , ADC_IT_JEOS ) ; __HAL_ADC_ENABLE_IT ( hadc , ADC_IT_JEOC ) ; break ; } if ( ADC_INDEPENDENT_OR_NONMULTIMODEINJECTED_SLAVE ( hadc ) ) { if ( HAL_IS_BIT_CLR ( hadc -> Instance -> CFGR , ADC_CFGR_JAUTO ) ) { SET_BIT ( hadc -> Instance -> CR , ADC_CR_JADSTART ) ; } } else { SET_BIT ( hadc -> State , HAL_ADC_STATE_MULTIMODE_SLAVE ) ; } } else { __HAL_UNLOCK ( hadc ) ; } return tmp_hal_status ; } } 