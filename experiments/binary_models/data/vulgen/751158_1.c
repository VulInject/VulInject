sr_srv_item_t * sr_srv_add_item ( str * pvid , int findflg ) { sr_srv_item_t * pitem ; unsigned int hashid ; hashid = get_hash1_raw ( pvid -> s , pvid -> len ) ; for ( pitem = _sr_srv_list ; pitem ; pitem = pitem -> next ) { if ( pitem -> hashid == hashid && pitem -> pvid . len == pvid -> len && ! strncmp ( pitem -> pvid . s , pvid -> s , pvid -> len ) ) { return pitem ; } } if ( findflg ) { return NULL ; } pitem = ( sr_srv_item_t * ) pkg_malloc ( sizeof ( sr_srv_item_t ) ) ; if ( ! pitem ) { LM_ERR ( "No more pkg memory!\n" ) ; return NULL ; } pitem -> pvid . s = ( char * ) pkg_malloc ( pvid -> len + 1 ) ; if ( ! pitem -> pvid . s ) { LM_ERR ( "No more pkg memory!\n" ) ; pkg_free ( pitem ) ; return NULL ; } memcpy ( pitem -> pvid . s , pvid -> s , pvid -> len ) ; pitem -> pvid . len = pvid -> len ; pitem -> hashid = hashid ; pitem -> next = _sr_srv_list ; _sr_srv_list = pitem ; return pitem ; } 