static int build_proxy_prefix ( hx509_context context , const Name * issuer , Name * subject ) { char * tstr ; time_t t ; int ret ; ret = copy_Name ( issuer , subject ) ; if ( ret ) { hx509_set_error_string ( context , 0 , ret , "Failed to copy subject name" ) ; return ret ; } t = time ( NULL ) ; ret = asprintf ( & tstr , "ts-%lu" , ( unsigned long ) t ) ; if ( ret == - 1 || tstr == NULL ) { hx509_set_error_string ( context , 0 , ENOMEM , "Failed to copy subject name" ) ; return ENOMEM ; } free ( tstr ) ; if ( ret ) { free_Name ( subject ) ; } return ret ; } 