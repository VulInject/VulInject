FSTATUS focusGetItems ( PmFocusPorts_t * pmFocusPorts , focusArrayItem_t * focusArray , uint32 start , uint32 imageIndex ) { FSTATUS status ; focusArrayItem_t * currItem = & focusArray [ start ] ; uint32 i ; status = vs_pool_alloc ( & pm_pool , pmFocusPorts -> NumPorts * sizeof ( PmFocusPortEntry_t ) , ( void * ) & pmFocusPorts -> portList ) ; if ( status != FSUCCESS ) { IB_LOG_ERRORRC ( "Failed to allocate sorted port list buffer for pmFocusPorts rc:" , status ) ; return FINSUFFICIENT_MEMORY ; } for ( i = 0 ; i < pmFocusPorts -> NumPorts ; i ++ , currItem ++ ) { pmFocusPorts -> portList [ i ] . lid = currItem -> localPort -> pmnodep -> Image [ imageIndex ] . lid ; pmFocusPorts -> portList [ i ] . portNum = currItem -> localPort -> portNum ; pmFocusPorts -> portList [ i ] . rate = PmCalculateRate ( currItem -> localPort -> Image [ imageIndex ] . u . s . activeSpeed , currItem -> localPort -> Image [ imageIndex ] . u . s . rxActiveWidth ) ; pmFocusPorts -> portList [ i ] . maxVlMtu = currItem -> localPort -> Image [ imageIndex ] . u . s . mtu ; pmFocusPorts -> portList [ i ] . localStatus = pa_get_port_status ( currItem -> localPort , imageIndex ) ; pmFocusPorts -> portList [ i ] . value [ 0 ] = currItem -> localValue ; pmFocusPorts -> portList [ i ] . guid = currItem -> localPort -> pmnodep -> NodeGUID ; StringCopy ( pmFocusPorts -> portList [ i ] . nodeDesc , ( char * ) currItem -> localPort -> pmnodep -> nodeDesc . NodeString , STL_NODE_DESCRIPTION_ARRAY_SIZE ) ; pmFocusPorts -> portList [ i ] . neighborStatus = ( currItem -> localPort -> portNum == 0 ?STL_PA_FOCUS_STATUS_OK : pa_get_port_status ( currItem -> neighborPort , imageIndex ) ) ; if ( ! currItem -> neighborPort ) { continue ; } pmFocusPorts -> portList [ i ] . neighborLid = currItem -> neighborPort -> pmnodep -> Image [ imageIndex ] . lid ; pmFocusPorts -> portList [ i ] . neighborPortNum = currItem -> neighborPort -> portNum ; pmFocusPorts -> portList [ i ] . neighborValue [ 0 ] = currItem -> neighborValue ; pmFocusPorts -> portList [ i ] . neighborGuid = currItem -> neighborPort -> pmnodep -> NodeGUID ; StringCopy ( pmFocusPorts -> portList [ i ] . neighborNodeDesc , ( char * ) currItem -> neighborPort -> pmnodep -> nodeDesc . NodeString , STL_NODE_DESCRIPTION_ARRAY_SIZE ) ; } return FSUCCESS ; } 