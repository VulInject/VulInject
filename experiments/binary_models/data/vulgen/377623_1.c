static int run_all_insn_set_hw_mode ( unsigned int cpu ) { int rc = 0 ; unsigned long flags ; struct insn_emulation * insn ; raw_spin_lock_irqsave ( & insn_emulation_lock , flags ) ; list_for_each_entry ( , , ) { if ( insn -> ops -> set_hw_mode && insn -> ops -> set_hw_mode ( enable ) ) { pr_warn ( "CPU[%u] cannot support the emulation of %s" , cpu , insn -> ops -> name ) ; rc = - EINVAL ; } } raw_spin_unlock_irqrestore ( & insn_emulation_lock , flags ) ; return rc ; } 