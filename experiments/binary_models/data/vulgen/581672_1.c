void * aclk_query_main_thread ( void * ptr ) { worker_aclk_register ( ) ; struct aclk_query_thread * query_thr = ptr ; service_register ( SERVICE_THREAD_TYPE_NETDATA , aclk_query_request_cancel , NULL , & query_cond_wait , false ) ; while ( service_running ( SERVICE_ACLK | ABILITY_DATA_QUERIES ) ) { aclk_query_process_msgs ( query_thr ) ; worker_is_idle ( ) ; QUERY_THREAD_LOCK ; QUERY_THREAD_UNLOCK ; } worker_unregister ( ) ; return NULL ; } 