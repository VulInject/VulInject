extern int mpi_p_slurmstepd_task ( const mpi_task_info_t * mpi_task , char * * * env ) { int i ; env_array_overwrite_fmt ( env , "PMI_FD" , "%u" , TASK_PMI_SOCK ( mpi_task -> ltaskid ) ) ; env_array_overwrite_fmt ( env , "PMI_JOBID" , "%s" , job_info . pmi_jobid ) ; env_array_overwrite_fmt ( env , "PMI_RANK" , "%u" , mpi_task -> gtaskid ) ; if ( job_info . spawn_seq ) { env_array_overwrite_fmt ( env , "PMI_SPAWNED" , "%u" , 1 ) ; } close ( tree_sock ) ; tree_sock = 0 ; for ( i = 0 ; i < mpi_task -> ltasks ; i ++ ) { close ( STEPD_PMI_SOCK ( i ) ) ; STEPD_PMI_SOCK ( i ) = 0 ; if ( i != mpi_task -> ltaskid ) { close ( TASK_PMI_SOCK ( i ) ) ; TASK_PMI_SOCK ( i ) = 0 ; } } return SLURM_SUCCESS ; } 