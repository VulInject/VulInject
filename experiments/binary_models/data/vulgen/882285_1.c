static void dissect_h265_seq_parameter_set_rbsp ( proto_tree * tree , tvbuff_t * tvb , packet_info * pinfo , gint offset ) { gint bit_offset ; guint8 i , sps_max_sub_layers_minus1 , sps_extension_4bits = 0 ; guint32 num_short_term_ref_pic_sets , num_long_term_ref_pics_sps , log2_max_pic_order_cnt_lsb_minus4 , bit_depth_luma_minus8 , bit_depth_chroma_minus8 ; gboolean sps_sub_layer_ordering_info_present_flag = 0 , scaling_list_enabled_flag = 0 , sps_scaling_list_data_present_flag = 0 , pcm_enabled_flag = 0 , long_term_ref_pics_present_flag = 0 , vui_parameters_present_flag = 0 , sps_extension_present_flag = 0 , sps_range_extension_flag = 0 , sps_multilayer_extension_flag = 0 , sps_3d_extension_flag = 0 , sps_scc_extension_flag = 0 ; gint32 NumDeltaPocs [ H265_MAX_NUM_SHORT_TERM_REF_PIC_SETS ] { 0 } ; ; proto_tree * profile_tier_level_tree , * vui_parameters_tree ; sps_max_sub_layers_minus1 = tvb_get_bits8 ( tvb , offset << 3 , 8 ) >> 1 & 0x07 ; proto_tree_add_item ( tree , hf_h265_sps_video_parameter_set_id , tvb , offset , 1 , ENC_BIG_ENDIAN ) ; proto_tree_add_item ( tree , hf_h265_sps_max_sub_layers_minus1 , tvb , offset , 1 , ENC_BIG_ENDIAN ) ; proto_tree_add_item ( tree , hf_h265_sps_temporal_id_nesting_flag , tvb , offset , 1 , ENC_BIG_ENDIAN ) ; offset ++ ; profile_tier_level_tree = proto_tree_add_subtree ( tree , tvb , offset , 1 , ett_h265_profile_tier_level , NULL , "Profile, tier and level" ) ; offset = dissect_h265_profile_tier_level ( profile_tier_level_tree , tvb , pinfo , offset , 1 , sps_max_sub_layers_minus1 ) ; bit_offset = offset << 3 ; dissect_h265_exp_golomb_code ( tree , hf_h265_sps_seq_parameter_set_id , tvb , pinfo , & bit_offset , H265_UE_V ) ; guint chroma_format_idc = dissect_h265_exp_golomb_code ( tree , hf_h265_chroma_format_idc , tvb , pinfo , & bit_offset , H265_UE_V ) ; if ( chroma_format_idc == 3 ) { proto_tree_add_bits_item ( tree , hf_h265_separate_colour_plane_flag , tvb , bit_offset , 1 , ENC_BIG_ENDIAN ) ; bit_offset ++ ; } pic_width_in_luma_samples = dissect_h265_exp_golomb_code ( tree , hf_h265_pic_width_in_luma_samples , tvb , pinfo , & bit_offset , H265_UE_V ) ; pic_height_in_luma_samples = dissect_h265_exp_golomb_code ( tree , hf_h265_pic_height_in_luma_samples , tvb , pinfo , & bit_offset , H265_UE_V ) ; gboolean conformance_window_flag = tvb_get_bits8 ( tvb , bit_offset , 1 ) ; proto_tree_add_bits_item ( tree , hf_h265_conformance_window_flag , tvb , bit_offset , 1 , ENC_BIG_ENDIAN ) ; bit_offset ++ ; if ( conformance_window_flag ) { dissect_h265_exp_golomb_code ( tree , hf_h265_conf_win_left_offset , tvb , pinfo , & bit_offset , H265_UE_V ) ; dissect_h265_exp_golomb_code ( tree , hf_h265_conf_win_right_offset , tvb , pinfo , & bit_offset , H265_UE_V ) ; dissect_h265_exp_golomb_code ( tree , hf_h265_conf_win_top_offset , tvb , pinfo , & bit_offset , H265_UE_V ) ; dissect_h265_exp_golomb_code ( tree , hf_h265_conf_win_bottom_offset , tvb , pinfo , & bit_offset , H265_UE_V ) ; } bit_depth_luma_minus8 = dissect_h265_exp_golomb_code ( tree , hf_h265_bit_depth_luma_minus8 , tvb , pinfo , & bit_offset , H265_UE_V ) ; bit_depth_chroma_minus8 = dissect_h265_exp_golomb_code ( tree , hf_h265_bit_depth_chroma_minus8 , tvb , pinfo , & bit_offset , H265_UE_V ) ; log2_max_pic_order_cnt_lsb_minus4 = dissect_h265_exp_golomb_code ( tree , hf_h265_log2_max_pic_order_cnt_lsb_minus4 , tvb , pinfo , & bit_offset , H265_UE_V ) ; sps_sub_layer_ordering_info_present_flag = tvb_get_bits8 ( tvb , bit_offset , 1 ) ; proto_tree_add_bits_item ( tree , hf_h265_sps_sub_layer_ordering_info_present_flag , tvb , bit_offset , 1 , ENC_BIG_ENDIAN ) ; bit_offset ++ ; for ( i = ( sps_sub_layer_ordering_info_present_flag ?0 : sps_max_sub_layers_minus1 ) ; i <= sps_max_sub_layers_minus1 ; i ++ ) { dissect_h265_exp_golomb_code ( tree , hf_h265_sps_max_dec_pic_buffering_minus1 , tvb , pinfo , & bit_offset , H265_UE_V ) ; dissect_h265_exp_golomb_code ( tree , hf_h265_sps_max_num_reorder_pics , tvb , pinfo , & bit_offset , H265_UE_V ) ; dissect_h265_exp_golomb_code ( tree , hf_h265_sps_max_latency_increase_plus1 , tvb , pinfo , & bit_offset , H265_UE_V ) ; } log2_min_luma_coding_block_size_minus3 = dissect_h265_exp_golomb_code ( tree , hf_h265_log2_min_luma_coding_block_size_minus3 , tvb , pinfo , & bit_offset , H265_UE_V ) ; log2_diff_max_min_luma_coding_block_size = dissect_h265_exp_golomb_code ( tree , hf_h265_log2_diff_max_min_luma_coding_block_size , tvb , pinfo , & bit_offset , H265_UE_V ) ; dissect_h265_exp_golomb_code ( tree , hf_h265_log2_min_luma_transform_block_size_minus2 , tvb , pinfo , & bit_offset , H265_UE_V ) ; dissect_h265_exp_golomb_code ( tree , hf_h265_log2_diff_max_min_luma_transform_block_size , tvb , pinfo , & bit_offset , H265_UE_V ) ; dissect_h265_exp_golomb_code ( tree , hf_h265_max_transform_hierarchy_depth_inter , tvb , pinfo , & bit_offset , H265_UE_V ) ; dissect_h265_exp_golomb_code ( tree , hf_h265_max_transform_hierarchy_depth_intra , tvb , pinfo , & bit_offset , H265_UE_V ) ; scaling_list_enabled_flag = tvb_get_bits8 ( tvb , bit_offset , 1 ) ; proto_tree_add_bits_item ( tree , hf_h265_scaling_list_enabled_flag , tvb , bit_offset , 1 , ENC_BIG_ENDIAN ) ; bit_offset ++ ; if ( scaling_list_enabled_flag ) { sps_scaling_list_data_present_flag = tvb_get_bits8 ( tvb , bit_offset , 1 ) ; proto_tree_add_bits_item ( tree , hf_h265_sps_scaling_list_data_present_flag , tvb , bit_offset , 1 , ENC_BIG_ENDIAN ) ; bit_offset ++ ; if ( sps_scaling_list_data_present_flag ) { bit_offset = dissect_h265_scaling_list_data ( tree , tvb , pinfo , bit_offset ) ; } } proto_tree_add_bits_item ( tree , hf_h265_amp_enabled_flag , tvb , bit_offset , 1 , ENC_BIG_ENDIAN ) ; bit_offset ++ ; proto_tree_add_bits_item ( tree , hf_h265_sample_adaptive_offset_enabled_flag , tvb , bit_offset , 1 , ENC_BIG_ENDIAN ) ; bit_offset ++ ; pcm_enabled_flag = tvb_get_bits8 ( tvb , bit_offset , 1 ) ; proto_tree_add_bits_item ( tree , hf_h265_pcm_enabled_flag , tvb , bit_offset , 1 , ENC_BIG_ENDIAN ) ; bit_offset ++ ; if ( pcm_enabled_flag ) { proto_tree_add_bits_item ( tree , hf_h265_pcm_sample_bit_depth_luma_minus1 , tvb , bit_offset , 4 , ENC_BIG_ENDIAN ) ; bit_offset = bit_offset + 4 ; proto_tree_add_bits_item ( tree , hf_h265_pcm_sample_bit_depth_chroma_minus1 , tvb , bit_offset , 4 , ENC_BIG_ENDIAN ) ; bit_offset = bit_offset + 4 ; dissect_h265_exp_golomb_code ( tree , hf_h265_log2_min_pcm_luma_coding_block_size_minus3 , tvb , pinfo , & bit_offset , H265_UE_V ) ; dissect_h265_exp_golomb_code ( tree , hf_h265_log2_diff_max_min_pcm_luma_coding_block_size , tvb , pinfo , & bit_offset , H265_UE_V ) ; proto_tree_add_bits_item ( tree , hf_h265_pcm_loop_filter_disabled_flag , tvb , bit_offset , 1 , ENC_BIG_ENDIAN ) ; bit_offset ++ ; } num_short_term_ref_pic_sets = dissect_h265_exp_golomb_code ( tree , hf_h265_num_short_term_ref_pic_sets , tvb , pinfo , & bit_offset , H265_UE_V ) ; for ( i = 0 ; i < num_short_term_ref_pic_sets ; i ++ ) { bit_offset = dissect_h265_st_ref_pic_set ( tree , tvb , pinfo , bit_offset , i , num_short_term_ref_pic_sets , NumDeltaPocs ) ; } long_term_ref_pics_present_flag = tvb_get_bits8 ( tvb , bit_offset , 1 ) ; proto_tree_add_bits_item ( tree , hf_h265_long_term_ref_pics_present_flag , tvb , bit_offset , 1 , ENC_BIG_ENDIAN ) ; bit_offset ++ ; if ( long_term_ref_pics_present_flag ) { num_long_term_ref_pics_sps = dissect_h265_exp_golomb_code ( tree , hf_h265_num_long_term_ref_pics_sps , tvb , pinfo , & bit_offset , H265_UE_V ) ; for ( i = 0 ; i < num_long_term_ref_pics_sps ; i ++ ) { proto_tree_add_bits_item ( tree , hf_h265_lt_ref_pic_poc_lsb_sps , tvb , bit_offset , log2_max_pic_order_cnt_lsb_minus4 + 4 , ENC_BIG_ENDIAN ) ; bit_offset = bit_offset + log2_max_pic_order_cnt_lsb_minus4 + 4 ; proto_tree_add_bits_item ( tree , hf_h265_used_by_curr_pic_lt_sps_flag , tvb , bit_offset , 1 , ENC_BIG_ENDIAN ) ; bit_offset ++ ; } } proto_tree_add_bits_item ( tree , hf_h265_sps_temporal_mvp_enabled_flag , tvb , bit_offset , 1 , ENC_BIG_ENDIAN ) ; bit_offset ++ ; proto_tree_add_bits_item ( tree , hf_h265_strong_intra_smoothing_enabled_flag , tvb , bit_offset , 1 , ENC_BIG_ENDIAN ) ; bit_offset ++ ; vui_parameters_present_flag = tvb_get_bits8 ( tvb , bit_offset , 1 ) ; proto_tree_add_bits_item ( tree , hf_h265_vui_parameters_present_flag , tvb , bit_offset , 1 , ENC_BIG_ENDIAN ) ; bit_offset ++ ; if ( vui_parameters_present_flag ) { vui_parameters_tree = proto_tree_add_subtree ( tree , tvb , bit_offset >> 3 , 1 , ett_h265_vui_parameters , NULL , "VUI parameters" ) ; bit_offset = dissect_h265_vui_parameters ( vui_parameters_tree , tvb , pinfo , bit_offset , sps_max_sub_layers_minus1 ) ; } sps_extension_present_flag = tvb_get_bits8 ( tvb , bit_offset , 1 ) ; proto_tree_add_bits_item ( tree , hf_h265_sps_extension_present_flag , tvb , bit_offset , 1 , ENC_BIG_ENDIAN ) ; bit_offset ++ ; if ( sps_extension_present_flag ) { sps_range_extension_flag = tvb_get_bits8 ( tvb , bit_offset , 1 ) ; proto_tree_add_bits_item ( tree , hf_h265_sps_range_extension_flag , tvb , bit_offset , 1 , ENC_BIG_ENDIAN ) ; bit_offset ++ ; sps_multilayer_extension_flag = tvb_get_bits8 ( tvb , bit_offset , 1 ) ; proto_tree_add_bits_item ( tree , hf_h265_sps_multilayer_extension_flag , tvb , bit_offset , 1 , ENC_BIG_ENDIAN ) ; bit_offset ++ ; sps_3d_extension_flag = tvb_get_bits8 ( tvb , bit_offset , 1 ) ; proto_tree_add_bits_item ( tree , hf_h265_sps_3d_extension_flag , tvb , bit_offset , 1 , ENC_BIG_ENDIAN ) ; bit_offset ++ ; sps_scc_extension_flag = tvb_get_bits8 ( tvb , bit_offset , 1 ) ; proto_tree_add_bits_item ( tree , hf_h265_sps_scc_extension_flag , tvb , bit_offset , 1 , ENC_BIG_ENDIAN ) ; bit_offset ++ ; sps_extension_4bits = tvb_get_bits8 ( tvb , bit_offset , 4 ) ; proto_tree_add_bits_item ( tree , hf_h265_sps_extension_4bits , tvb , bit_offset , 4 , ENC_BIG_ENDIAN ) ; bit_offset = bit_offset + 4 ; } if ( sps_range_extension_flag ) { bit_offset = dissect_h265_sps_range_extension ( tree , tvb , pinfo , bit_offset ) ; } if ( sps_multilayer_extension_flag ) { bit_offset = dissect_h265_sps_multilayer_extension ( tree , tvb , pinfo , bit_offset ) ; } if ( sps_3d_extension_flag ) { bit_offset = dissect_h265_sps_3d_extension ( tree , tvb , pinfo , bit_offset ) ; } if ( sps_scc_extension_flag ) { bit_offset = dissect_h265_sps_scc_extension ( tree , tvb , pinfo , bit_offset , chroma_format_idc , bit_depth_luma_minus8 , bit_depth_chroma_minus8 ) ; } if ( sps_extension_4bits ) { while ( more_rbsp_data ( tree , tvb , pinfo , bit_offset ) ) { proto_tree_add_bits_item ( tree , hf_h265_sps_extension_data_flag , tvb , bit_offset , 1 , ENC_BIG_ENDIAN ) ; bit_offset ++ ; } } dissect_h265_rbsp_trailing_bits ( tree , tvb , pinfo , bit_offset ) ; } 