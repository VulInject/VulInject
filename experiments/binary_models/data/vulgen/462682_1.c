static void test_init_json_instance ( void * * state ) { struct engine * engine = * state ; struct instance * instance = engine -> instance_root ; instance -> config . options = EXPORTING_SOURCE_DATA_AS_COLLECTED | EXPORTING_OPTION_SEND_NAMES ; assert_int_equal ( init_json_instance ( instance ) , 0 ) ; assert_int_equal ( ( ( simple_connector_config * ) ( instance -> config . connector_specific_config ) ) -> default_port , 5448 ) ; freez ( instance -> config . connector_specific_config ) ; assert_ptr_equal ( instance -> metric_formatting , format_dimension_collected_json_plaintext ) ; assert_ptr_not_equal ( instance -> buffer , NULL ) ; instance -> config . options = EXPORTING_SOURCE_DATA_AVERAGE | EXPORTING_OPTION_SEND_NAMES ; assert_int_equal ( init_json_instance ( instance ) , 0 ) ; assert_ptr_equal ( instance -> metric_formatting , format_dimension_stored_json_plaintext ) ; } 