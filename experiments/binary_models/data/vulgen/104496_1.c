add_pigment ( , , , , ) { GimpColorSelector * selector = GIMP_COLOR_SELECTOR ( water ) ; if ( erase ) { selector -> rgb . r = 1.0 - ( 1.0 - selector -> rgb . r ) * ( 1.0 - much ) ; selector -> rgb . g = 1.0 - ( 1.0 - selector -> rgb . g ) * ( 1.0 - much ) ; selector -> rgb . b = 1.0 - ( 1.0 - selector -> rgb . b ) * ( 1.0 - much ) ; } else { gdouble r = calc ( x , y , 0 ) / 256.0 ; gdouble g = calc ( x , y , 120 ) / 256.0 ; gdouble b = calc ( x , y , 240 ) / 256.0 ; selector -> rgb . r *= ( 1.0 - ( 1.0 - r ) * much ) ; selector -> rgb . g *= ( 1.0 - ( 1.0 - g ) * much ) ; selector -> rgb . b *= ( 1.0 - ( 1.0 - b ) * much ) ; } gimp_rgb_clamp ( & selector -> rgb ) ; gimp_rgb_to_hsv ( & selector -> rgb , & selector -> hsv ) ; gimp_color_selector_emit_color_changed ( selector ) ; } 