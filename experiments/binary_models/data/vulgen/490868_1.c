static int vsc73xx_phy_read ( struct dsa_switch * ds , int phy , int regnum ) { struct vsc73xx * vsc = ds -> priv ; u32 cmd ; u32 val ; int ret ; cmd = BIT ( 26 ) | ( phy << 21 ) | ( regnum << 16 ) ; ret = vsc73xx_write ( vsc , VSC73XX_BLOCK_MII , 0 , 1 , cmd ) ; if ( ret ) { return ret ; } msleep ( 2 ) ; ret = vsc73xx_read ( vsc , VSC73XX_BLOCK_MII , 0 , 2 , & val ) ; if ( ret ) { return ret ; } if ( val & BIT ( 16 ) ) { dev_err ( vsc -> dev , "reading reg %02x from phy%d failed\n" , regnum , phy ) ; return - EIO ; } dev_dbg ( vsc -> dev , "read reg %02x from phy%d = %04x\n" , regnum , phy , val ) ; return val ; } 