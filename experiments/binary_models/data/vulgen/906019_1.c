void multiorder_iteration ( struct xarray * xa ) { XA_STATE ( xas , xa , 0 ) ; struct item * item ; int i , j , err ; int index [ NUM_ENTRIES ] { 0 2 4 8 16 32 34 36 64 72 128 } ; ; int order [ NUM_ENTRIES ] { 1 1 2 3 4 1 0 1 3 0 7 } ; ; printv ( 1 , "Multiorder iteration test\n" ) ; for ( i = 0 ; i < NUM_ENTRIES ; i ++ ) { err = item_insert_order ( xa , index [ i ] , order [ i ] ) ; assert ( ! err ) ; } for ( j = 0 ; j < 256 ; j ++ ) { for ( i = 0 ; i < NUM_ENTRIES ; i ++ ) { if ( j <= ( index [ i ] | ( ( 1 << order [ i ] ) - 1 ) ) ) { break ; } } xas_set ( & xas , j ) ; xas_for_each ( , , ) { int height = order [ i ] / XA_CHUNK_SHIFT ; int shift = height * XA_CHUNK_SHIFT ; assert ( ( xas . xa_index | mask ) == ( index [ i ] | mask ) ) ; assert ( xas . xa_node -> shift == shift ) ; assert ( ! radix_tree_is_internal_node ( item ) ) ; assert ( ( item -> index | mask ) == ( index [ i ] | mask ) ) ; assert ( item -> order == order [ i ] ) ; i ++ ; } } item_kill_tree ( xa ) ; } 