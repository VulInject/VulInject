static void neoscrypt_blkmix ( uint * X , uint * Y , uint r , uint mixmode ) { uint i , mixer , rounds ; mixer = mixmode >> 8 ; rounds = mixmode & 0xFF ; if ( r == 1 ) { neoscrypt_blkxor ( & X [ 0 ] , & X [ 16 ] , SCRYPT_BLOCK_SIZE ) ; if ( mixer ) { neoscrypt_chacha ( & X [ 0 ] , rounds ) ; } else { neoscrypt_salsa ( & X [ 0 ] , rounds ) ; } neoscrypt_blkxor ( & X [ 16 ] , & X [ 0 ] , SCRYPT_BLOCK_SIZE ) ; if ( mixer ) { neoscrypt_chacha ( & X [ 16 ] , rounds ) ; } else { neoscrypt_salsa ( & X [ 16 ] , rounds ) ; } return ; } if ( r == 2 ) { neoscrypt_blkxor ( & X [ 0 ] , & X [ 48 ] , SCRYPT_BLOCK_SIZE ) ; if ( mixer ) { neoscrypt_chacha ( & X [ 0 ] , rounds ) ; } else { neoscrypt_salsa ( & X [ 0 ] , rounds ) ; } neoscrypt_blkxor ( & X [ 16 ] , & X [ 0 ] , SCRYPT_BLOCK_SIZE ) ; if ( mixer ) { neoscrypt_chacha ( & X [ 16 ] , rounds ) ; } else { neoscrypt_salsa ( & X [ 16 ] , rounds ) ; } neoscrypt_blkxor ( & X [ 32 ] , & X [ 16 ] , SCRYPT_BLOCK_SIZE ) ; if ( mixer ) { neoscrypt_chacha ( & X [ 32 ] , rounds ) ; } else { neoscrypt_salsa ( & X [ 32 ] , rounds ) ; } neoscrypt_blkxor ( & X [ 48 ] , & X [ 32 ] , SCRYPT_BLOCK_SIZE ) ; if ( mixer ) { neoscrypt_chacha ( & X [ 48 ] , rounds ) ; } else { neoscrypt_salsa ( & X [ 48 ] , rounds ) ; } return ; } for ( i = 0 ; i < 2 * r ; i ++ ) { if ( i ) { neoscrypt_blkxor ( & X [ 16 * i ] , & X [ 16 * ( i - 1 ) ] , SCRYPT_BLOCK_SIZE ) ; } else { neoscrypt_blkxor ( & X [ 0 ] , & X [ 16 * ( 2 * r - 1 ) ] , SCRYPT_BLOCK_SIZE ) ; } if ( mixer ) { neoscrypt_chacha ( & X [ 16 * i ] , rounds ) ; } else { neoscrypt_salsa ( & X [ 16 * i ] , rounds ) ; } neoscrypt_blkcpy ( & Y [ 16 * i ] , & X [ 16 * i ] , SCRYPT_BLOCK_SIZE ) ; } for ( i = 0 ; i < r ; i ++ ) { neoscrypt_blkcpy ( & X [ 16 * i ] , & Y [ 16 * 2 * i ] , SCRYPT_BLOCK_SIZE ) ; } for ( i = 0 ; i < r ; i ++ ) { neoscrypt_blkcpy ( & X [ 16 * ( i + r ) ] , & Y [ 16 * ( 2 * i + 1 ) ] , SCRYPT_BLOCK_SIZE ) ; } } 