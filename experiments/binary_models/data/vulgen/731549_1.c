static int fsi_master_gpio_break ( struct fsi_master * _master , int link ) { struct fsi_master_gpio * master = to_fsi_master_gpio ( _master ) ; unsigned long flags ; if ( link != 0 ) { return - ENODEV ; } trace_fsi_master_gpio_break ( master ) ; mutex_lock ( & master -> cmd_lock ) ; if ( master -> external_mode ) { return - EBUSY ; } local_irq_save ( flags ) ; set_sda_output ( master , 1 ) ; sda_out ( master , 1 ) ; clock_toggle ( master , FSI_PRE_BREAK_CLOCKS ) ; sda_out ( master , 0 ) ; clock_toggle ( master , FSI_BREAK_CLOCKS ) ; echo_delay ( master ) ; sda_out ( master , 1 ) ; clock_toggle ( master , FSI_POST_BREAK_CLOCKS ) ; local_irq_restore ( flags ) ; last_address_update ( master , 0 , false , 0 ) ; mutex_unlock ( & master -> cmd_lock ) ; udelay ( 200 ) ; return 0 ; } 