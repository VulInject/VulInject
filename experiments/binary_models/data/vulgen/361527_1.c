Bool visual_3d_draw_frame ( GF_VisualManager * visual , GF_Node * root , GF_TraverseState * tr_state , Bool is_root_visual ) { u32 time = gf_sys_clock ( ) ; if ( visual -> compositor -> fbo_id ) { compositor_3d_enable_fbo ( visual -> compositor , GF_TRUE ) ; } visual_3d_setup ( visual ) ; visual -> active_glsl_flags = 0 ; visual_3d_setup_traversing_state ( visual , tr_state ) ; if ( is_root_visual ) { Bool auto_stereo = 0 ; visual_3d_setup_clipper ( visual , tr_state ) ; if ( tr_state -> visual -> autostereo_type > GF_3D_STEREO_LAST_SINGLE_BUFFER ) { auto_stereo = 1 ; } visual_3d_init_shaders ( visual ) ; for ( visual -> current_view = 0 ; visual -> current_view < visual -> nb_views ; visual -> current_view ++ ) { GF_SceneGraph * sg ; u32 i ; visual_3d_draw_node ( tr_state , root ) ; i = 0 ; while ( ( sg = ( GF_SceneGraph * ) gf_list_enum ( visual -> compositor -> extra_scenes , & i ) ) ) { tr_state -> traversing_mode = TRAVERSE_SORT ; gf_sc_traverse_subscene ( visual -> compositor , root , sg , tr_state ) ; } if ( auto_stereo ) { visual_3d_end_auto_stereo_pass ( visual ) ; } visual -> compositor -> reset_graphics = 0 ; } } else { visual_3d_draw_node ( tr_state , root ) ; } GF_LOG ( GF_LOG_DEBUG , GF_LOG_RTI , ( "[RTI] Frame\t%d\t3D drawn in \t%d\tms\n" , visual -> compositor -> frame_number , gf_sys_clock ( ) - time ) ) ; if ( visual -> compositor -> fbo_id ) { compositor_3d_enable_fbo ( visual -> compositor , GF_FALSE ) ; } return 1 ; } 