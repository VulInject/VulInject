static ble_gap_sec_params_t get_gap_sec_params ( ) { ble_gap_sec_params_t sec_param ; sec_param . bond = 1 ; sec_param . io_caps = BLE_GAP_IO_CAPS_NONE ; sec_param . min_key_size = 7 ; sec_param . max_key_size = 16 ; sec_param . kdist_own . enc = 1 ; sec_param . kdist_own . id = 1 ; sec_param . kdist_peer . enc = 1 ; sec_param . kdist_peer . id = 1 ; JsVar * options = jsvObjectGetChild ( execInfo . hiddenRoot , BLE_NAME_SECURITY , 0 ) ; if ( jsvIsObject ( options ) ) { bool display = jsvGetBoolAndUnLock ( jsvObjectGetChild ( options , "display" , 0 ) ) ; bool keyboard = jsvGetBoolAndUnLock ( jsvObjectGetChild ( options , "keyboard" , 0 ) ) ; if ( display && keyboard ) { sec_param . io_caps = BLE_GAP_IO_CAPS_KEYBOARD_DISPLAY ; } if ( display ) { sec_param . io_caps = BLE_GAP_IO_CAPS_DISPLAY_ONLY ; } if ( keyboard ) { sec_param . io_caps = BLE_GAP_IO_CAPS_KEYBOARD_ONLY ; } JsVar * v ; v = jsvObjectGetChild ( options , "bond" , 0 ) ; if ( ! jsvIsUndefined ( v ) && ! jsvGetBool ( v ) ) { sec_param . bond = 0 ; } jsvUnLock ( v ) ; if ( jsvGetBoolAndUnLock ( jsvObjectGetChild ( options , "mitm" , 0 ) ) ) { sec_param . mitm = 1 ; } if ( jsvGetBoolAndUnLock ( jsvObjectGetChild ( options , "lesc" , 0 ) ) ) { sec_param . lesc = 1 ; } if ( jsvGetBoolAndUnLock ( jsvObjectGetChild ( options , "oob" , 0 ) ) ) { sec_param . oob = 1 ; } } return sec_param ; } 