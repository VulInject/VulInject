void spl_board_init ( void ) { int ret ; preloader_console_init ( ) ; schedule ( ) ; arch_early_init_r ( ) ; if ( is_fpgamgr_user_mode ( ) ) { ret = config_pins ( gd -> fdt_blob , "shared" ) ; if ( ret ) { return ; } ret = config_pins ( gd -> fdt_blob , "fpga" ) ; if ( ret ) { return ; } } if ( ! is_fpgamgr_early_user_mode ( ) ) { fpgamgr_program ( buf , FPGA_BUFSIZ , 0 ) ; if ( ! is_fpgamgr_user_mode ( ) ) { force_periph_program ( true ) ; fpgamgr_program ( buf , FPGA_BUFSIZ , 0 ) ; force_periph_program ( false ) ; } } if ( is_fpgamgr_early_user_mode ( ) || is_fpgamgr_user_mode ( ) ) { if ( ! is_regular_boot_valid ( ) ) { mdelay ( 10 ) ; qspi_flash_software_reset ( ) ; ret = readl ( socfpga_get_rstmgr_addr ( ) + RSTMGR_A10_SYSWARMMASK ) ; writel ( ret & ( ~ ( ALT_RSTMGR_SYSWARMMASK_S2F_SET_MSK | ALT_RSTMGR_FPGAMGRWARMMASK_S2F_SET_MSK ) ) , socfpga_get_rstmgr_addr ( ) + RSTMGR_A10_SYSWARMMASK ) ; ret = readl ( socfpga_get_sysmgr_addr ( ) + SYSMGR_A10_ROMCODE_CTRL ) ; writel ( ret | BOOTROM_CONFIGURES_IO_PINMUX , socfpga_get_sysmgr_addr ( ) + SYSMGR_A10_ROMCODE_CTRL ) ; writel ( FSBL_IMAGE_IS_VALID , socfpga_get_sysmgr_addr ( ) + SYSMGR_A10_ROMCODE_INITSWSTATE ) ; set_regular_boot ( true ) ; schedule ( ) ; reset_cpu ( ) ; } set_regular_boot ( false ) ; ret = readl ( socfpga_get_rstmgr_addr ( ) + RSTMGR_A10_SYSWARMMASK ) ; writel ( ret | ALT_RSTMGR_SYSWARMMASK_S2F_SET_MSK | ALT_RSTMGR_FPGAMGRWARMMASK_S2F_SET_MSK , socfpga_get_rstmgr_addr ( ) + RSTMGR_A10_SYSWARMMASK ) ; writel ( FSBL_IMAGE_IS_INVALID , socfpga_get_sysmgr_addr ( ) + SYSMGR_A10_ROMCODE_INITSWSTATE ) ; ddr_calibration_sequence ( ) ; } if ( ! is_fpgamgr_user_mode ( ) ) { fpgamgr_program ( buf , FPGA_BUFSIZ , 0 ) ; } } 