static int parse_env_hex_color ( const char * env , GdkColor * c ) { const char * s ; unsigned long ul ; char * ep ; size_t n ; if ( ( s = getenv ( env ) ) == NULL ) { return 0 ; } if ( * s == '#' ) { s ++ ; } if ( strncmp ( s , "0x" , 2 ) == 0 ) { s += 2 ; } n = strlen ( s ) ; if ( n != 3 && n != 6 ) { bad } ul = strtoul ( s , & ep , 16 ) ; if ( * ep != '\0' || ul > 0xffffff ) { bad fprintf ( stderr , "Invalid $%s - invalid hex color code\n" , env ) ; return 0 ; } if ( n == 3 ) { c -> red = ( ( ul >> 8 ) & 0xf ) << 12 ; c -> green = ( ( ul >> 4 ) & 0xf ) << 12 ; c -> blue = ( ul & 0xf ) << 12 ; } else { c -> red = ( ( ul >> 16 ) & 0xff ) << 8 ; c -> green = ( ( ul >> 8 ) & 0xff ) << 8 ; c -> blue = ( ul & 0xff ) << 8 ; } return 1 ; } 