static void prepare_ipv6_hdr ( struct dst_entry * dst , struct sk_buff * skb , struct in6_addr * saddr , struct in6_addr * daddr , __u8 proto , __u8 prio , __u8 ttl ) { struct ipv6hdr * ip6h ; IPCB ( skb ) -> flags &= ~ ( IPSKB_XFRM_TUNNEL_SIZE | IPSKB_XFRM_TRANSFORMED | IPSKB_REROUTED ) ; skb_dst_set ( skb , dst_clone ( dst ) ) ; __skb_push ( skb , sizeof ( * ip6h ) ) ; skb_reset_network_header ( skb ) ; ip6h = ipv6_hdr ( skb ) ; ip6_flow_hdr ( ip6h , prio , htonl ( 0 ) ) ; ip6h -> payload_len = htons ( skb -> len ) ; ip6h -> nexthdr = proto ; ip6h -> hop_limit = ttl ; ip6h -> daddr = * daddr ; ip6h -> saddr = * saddr ; ip6h -> payload_len = htons ( skb -> len - sizeof ( * ip6h ) ) ; } 