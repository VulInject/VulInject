static PyObject * py_next_dataset ( PyObject * self , PyObject * args ) { int ioc ; uint64_t cookie ; zfs_cmd_t zc = { 0 } ; int snaps ; char * name ; PyObject * nvl ; PyObject * ret = NULL ; if ( ! PyArg_ParseTuple ( args , "siK" , & name , & snaps , & cookie ) ) { return ( NULL ) ; } ( void ) strlcpy ( zc . zc_name , name , sizeof ( zc . zc_name ) ) ; zc . zc_cookie = cookie ; if ( snaps ) { ioc = ZFS_IOC_SNAPSHOT_LIST_NEXT ; } else { ioc = ZFS_IOC_DATASET_LIST_NEXT ; } nvl = ioctl_with_dstnv ( ioc , & zc ) ; if ( nvl ) { add_ds_props ( & zc , nvl ) ; ret = Py_BuildValue ( "sKO" , zc . zc_name , zc . zc_cookie , nvl ) ; Py_DECREF ( nvl ) ; } else { if ( snaps ) { seterr ( _ ( "cannot get snapshots of %s" ) , name ) ; } else { seterr ( _ ( "cannot get child datasets of %s" ) , name ) ; } } return ( ret ) ; } 