bool pim_mlag_up_df_role_update ( struct pim_instance * pim , struct pim_upstream * up , bool is_df , const char * reason ) { struct channel_oil * c_oil = up -> channel_oil ; struct pim_interface * vxlan_ifp ; if ( is_df == old_is_df ) { if ( PIM_DEBUG_MLAG ) { zlog_debug ( "%s: Ignoring Role update for %s, since no change" , __func__ , up -> sg_str ) ; } return false ; } if ( PIM_DEBUG_MLAG ) { zlog_debug ( "local MLAG mroute %s role changed to %s based on %s" , up -> sg_str , is_df ?"df" : "non-df" , reason ) ; } if ( is_df ) { PIM_UPSTREAM_FLAG_UNSET_MLAG_NON_DF ( up -> flags ) ; } else { PIM_UPSTREAM_FLAG_SET_MLAG_NON_DF ( up -> flags ) ; } if ( PIM_UPSTREAM_FLAG_TEST_MLAG_INTERFACE ( up -> flags ) ) { pim_mlag_inherit_mlag_flags ( up , is_df ) ; pim_mlag_calculate_df_for_ifchannels ( up , is_df ) ; } if ( c_oil ) { vxlan_ifp = pim_vxlan_get_term_ifp ( pim ) ; if ( vxlan_ifp ) { pim_channel_update_oif_mute ( c_oil , vxlan_ifp ) ; } } if ( pim_addr_is_any ( up -> sg . src ) && PIM_UPSTREAM_FLAG_TEST_MLAG_VXLAN ( up -> flags ) ) { pim_vxlan_inherit_mlag_flags ( pim , up , true ) ; } return true ; } 