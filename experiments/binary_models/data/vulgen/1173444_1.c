static size_t base64_encode ( unsigned char * input , size_t input_size , char * output , size_t output_size ) { uint32_t value ; static char lookup [ ] "ABCDEFGHIJKLMNOPQRSTUVWXYZ" "abcdefghijklmnopqrstuvwxyz" "0123456789+/" ; ; size_t count = 0 ; while ( input_size >= 3 ) { value = ( ( input [ 0 ] << 16 ) + ( input [ 1 ] << 8 ) + input [ 2 ] ) & 0xffffff ; output [ 0 ] = lookup [ value >> 18 ] ; output [ 1 ] = lookup [ ( value >> 12 ) & 0x3f ] ; output [ 2 ] = lookup [ ( value >> 6 ) & 0x3f ] ; output [ 3 ] = lookup [ value & 0x3f ] ; output += 4 ; input += 3 ; input_size -= 3 ; count += 4 ; } switch ( input_size ) { case 2 : value = ( input [ 0 ] << 10 ) + ( input [ 1 ] << 2 ) ; output [ 0 ] = lookup [ ( value >> 12 ) & 0x3f ] ; output [ 1 ] = lookup [ ( value >> 6 ) & 0x3f ] ; output [ 2 ] = lookup [ value & 0x3f ] ; output [ 3 ] = '=' ; count += 4 ; output [ 4 ] = '\0' ; break ; case 1 : value = input [ 0 ] << 4 ; output [ 0 ] = lookup [ ( value >> 6 ) & 0x3f ] ; output [ 1 ] = lookup [ value & 0x3f ] ; output [ 2 ] = '=' ; output [ 3 ] = '=' ; count += 4 ; output [ 4 ] = '\0' ; break ; case 0 : output [ 0 ] = '\0' ; break ; } return count ; } 