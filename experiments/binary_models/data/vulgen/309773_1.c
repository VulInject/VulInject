static int parse_address_key ( const char * * p , const char * key , char * * value ) { _cleanup_free_ char * r = NULL ; size_t l , n = 0 ; const char * a ; assert ( p ) ; assert ( * p ) ; assert ( value ) ; if ( key ) { l = strlen ( key ) ; if ( strncmp ( * p , key , l ) != 0 ) { return 0 ; } if ( ( * p ) [ l ] != '=' ) { return 0 ; } if ( * value ) { return - EINVAL ; } a = * p + l + 1 ; } else { a = * p ; } while ( ! IN_SET ( * a , ';' , ',' , 0 ) ) { char c ; if ( * a == '%' ) { int x , y ; x = unhexchar ( a [ 1 ] ) ; if ( x < 0 ) { return x ; } y = unhexchar ( a [ 2 ] ) ; if ( y < 0 ) { return y ; } c = ( char ) ( ( x << 4 ) | y ) ; a += 3 ; } else { c = * a ; a ++ ; } r [ n ++ ] = c ; } if ( ! r ) { r = strdup ( "" ) ; if ( ! r ) { return - ENOMEM ; } } else { r [ n ] = 0 ; } if ( * a == ',' ) { a ++ ; } * p = a ; free_and_replace ( * value , r ) ; return 1 ; } 