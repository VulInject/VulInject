int azalia_intr ( void * v ) { azalia_t * az = v ; uint32_t intsts ; int ret = 0 ; mtx_enter ( & audio_lock ) ; intsts = AZ_READ_4 ( az , INTSTS ) ; if ( intsts == 0 || intsts == 0xffffffff ) { mtx_leave ( & audio_lock ) ; return ( ret ) ; } AZ_WRITE_4 ( az , INTSTS , intsts ) ; if ( intsts & az -> pstream . intr_bit ) { azalia_stream_intr ( & az -> pstream ) ; ret = 1 ; } if ( intsts & az -> rstream . intr_bit ) { azalia_stream_intr ( & az -> rstream ) ; ret = 1 ; } if ( ( intsts & HDA_INTSTS_CIS ) && ( AZ_READ_1 ( az , RIRBCTL ) & HDA_RIRBCTL_RINTCTL ) && ( AZ_READ_1 ( az , RIRBSTS ) & HDA_RIRBSTS_RINTFL ) ) { ret = 1 ; } mtx_leave ( & audio_lock ) ; return ( ret ) ; } 