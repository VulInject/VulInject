static int lm75_get16 ( intptr_t arg , int reg , struct lm75_unit * unitp , int mode ) { i2c_transfer_t * i2c_tran_pointer ; int err = DDI_SUCCESS ; int16_t temp16 ; int8_t holder ; ( void ) i2c_transfer_alloc ( unitp -> lm75_hdl , & i2c_tran_pointer , 1 , 2 , I2C_SLEEP ) ; i2c_tran_pointer -> i2c_flags = I2C_WR_RD ; i2c_tran_pointer -> i2c_wbuf [ 0 ] = ( uchar_t ) reg ; err = i2c_transfer ( unitp -> lm75_hdl , i2c_tran_pointer ) ; if ( err ) { D2CMN_ERR ( ( CE_WARN , "%s: Failed in I2C_GET_TEMPERATURE " "i2c_transfer routine\n" , unitp -> lm75_name ) ) ; i2c_transfer_free ( unitp -> lm75_hdl , i2c_tran_pointer ) ; return ( err ) ; } D1CMN_ERR ( ( CE_NOTE , "%s: rbuf[0] =  %x rbuf[1]= %x\n" , unitp -> lm75_name , i2c_tran_pointer -> i2c_rbuf [ 0 ] , i2c_tran_pointer -> i2c_rbuf [ 0 ] ) ) ; temp16 = i2c_tran_pointer -> i2c_rbuf [ 0 ] ; temp16 = ( temp16 << 1 ) ; temp16 = ( temp16 | ( ( i2c_tran_pointer -> i2c_rbuf [ 1 ] & 0x80 ) >> 7 ) ) ; if ( temp16 & LM75_COMP_MASK ) { holder = ( temp16 & LM75_COMP_MASK_UPPER ) ; holder = - holder ; holder = holder / 2 ; temp16 = 0 - holder ; } else { temp16 = temp16 / 2 ; } if ( ddi_copyout ( ( caddr_t ) & temp16 , ( caddr_t ) arg , sizeof ( int16_t ) , mode ) != DDI_SUCCESS ) { D2CMN_ERR ( ( CE_WARN , "%s: Failed in I2C_GET_TEMPERATURE " "ddi_copyout routine\n" , unitp -> lm75_name ) ) ; err = EFAULT ; } i2c_transfer_free ( unitp -> lm75_hdl , i2c_tran_pointer ) ; return ( err ) ; } 