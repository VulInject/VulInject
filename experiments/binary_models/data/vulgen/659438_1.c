static int resize_user ( struct mlx5_ib_dev * dev , struct mlx5_ib_cq * cq , int entries , struct ib_udata * udata , int * cqe_size ) { struct mlx5_ib_resize_cq ucmd ; struct ib_umem * umem ; int err ; err = ib_copy_from_udata ( & ucmd , udata , sizeof ( ucmd ) ) ; if ( err ) { return err ; } if ( ucmd . cqe_size && SIZE_MAX / ucmd . cqe_size <= entries - 1 ) { return - EINVAL ; } umem = ib_umem_get ( & dev -> ib_dev , ucmd . buf_addr , ( size_t ) ucmd . cqe_size * entries , IB_ACCESS_LOCAL_WRITE ) ; if ( IS_ERR ( umem ) ) { err = PTR_ERR ( umem ) ; return err ; } cq -> resize_umem = umem ; * cqe_size = ucmd . cqe_size ; return 0 ; } 