static irqreturn_t wmt_mci_dma_isr ( int irq_num , void * data ) { struct wmt_mci_priv * priv ; int status ; priv = ( wmt_mci_priv * ) data ; status = readl ( priv -> sdmmc_base + SDDMA_CCR ) & 0x0F ; if ( status != DMA_CCR_EVT_SUCCESS ) { dev_err ( priv -> dev , "DMA Error: Status = %d\n" , status ) ; priv -> req -> data -> error = - ETIMEDOUT ; complete ( priv -> comp_dma ) ; return IRQ_HANDLED ; } priv -> req -> data -> error = 0 ; wmt_mci_disable_dma ( priv ) ; complete ( priv -> comp_dma ) ; if ( priv -> comp_cmd ) { if ( completion_done ( priv -> comp_cmd ) ) { } } return IRQ_HANDLED ; } 