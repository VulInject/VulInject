static int read_packet ( void * opaque , uint8_t * buf , int buf_size ) { struct buffer_data * bd = ( buffer_data * ) opaque ; if ( ! buf_size ) { return AVERROR_EOF ; } printf ( "ptr:%p size:%zu\n" , bd -> ptr , bd -> size ) ; memcpy ( buf , bd -> ptr , buf_size ) ; bd -> ptr += buf_size ; bd -> size -= buf_size ; return buf_size ; } 