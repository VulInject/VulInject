SLPError slp_broadcast_addrs ( slp_handle_impl_t * hp , struct in_addr * given_ifs , int num_givenifs , struct sockaddr_in * bc_addrs [ ] , int * num_addrs ) { SLPError err ; int i , j ; slp_ifinfo_t * all_ifs ; slp_handle_ifinfo_t * ifinfo ; int numifs ; if ( ! hp -> ifinfo ) { if ( ! ( ifinfo = malloc ( sizeof ( * ifinfo ) ) ) ) { slp_err ( LOG_CRIT , 0 , "slp_broadcast_addrs" , "out of memory" ) ; return ( SLP_MEMORY_ALLOC_FAILED ) ; } if ( ( err = get_all_interfaces ( ifinfo ) ) != SLP_OK ) { return ( err ) ; } hp -> ifinfo = ifinfo ; } all_ifs = ( ( slp_handle_ifinfo_t * ) hp -> ifinfo ) -> all_ifs ; numifs = ( ( slp_handle_ifinfo_t * ) hp -> ifinfo ) -> numifs ; if ( ! ( * bc_addrs = calloc ( num_givenifs , sizeof ( * * bc_addrs ) ) ) ) { slp_err ( LOG_CRIT , 0 , "slp_broadcast_addrs" , "out of memory" ) ; return ( SLP_MEMORY_ALLOC_FAILED ) ; } * num_addrs = 0 ; for ( j = 0 ; j < num_givenifs ; j ++ ) { for ( i = 0 ; i < numifs ; i ++ ) { if ( ! ( all_ifs [ i ] . flags & IFF_BROADCAST ) ) { continue ; } if ( memcmp ( & ( all_ifs [ i ] . addr . sin_addr . s_addr ) , & ( given_ifs [ j ] . s_addr ) , sizeof ( given_ifs [ j ] . s_addr ) ) == 0 && all_ifs [ i ] . bc_addr . sin_addr . s_addr != 0 ) { ( void ) memcpy ( * bc_addrs + * num_addrs , & ( all_ifs [ i ] . bc_addr ) , sizeof ( all_ifs [ i ] . bc_addr ) ) ; ( * num_addrs ) ++ ; break ; } } } if ( * num_addrs == 0 ) { free ( * bc_addrs ) ; bc_addrs = NULL ; return ( SLP_INTERNAL_SYSTEM_ERROR ) ; } return ( SLP_OK ) ; } 