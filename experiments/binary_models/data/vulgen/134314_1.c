static void e1000g_82547_tx_move_tail_work ( e1000g_tx_ring_t * tx_ring ) { struct e1000_hw * hw ; uint16_t hw_tdt ; uint16_t sw_tdt ; struct e1000_tx_desc * tx_desc ; uint16_t length = 0 ; struct e1000g * Adapter ; Adapter = tx_ring -> adapter ; hw = & Adapter -> shared ; hw_tdt = E1000_READ_REG ( hw , E1000_TDT ( 0 ) ) ; sw_tdt = tx_ring -> tbd_next - tx_ring -> tbd_first ; while ( hw_tdt != sw_tdt ) { tx_desc = & ( tx_ring -> tbd_first [ hw_tdt ] ) ; length += tx_desc -> lower . flags . length ; eop = tx_desc -> lower . data & E1000_TXD_CMD_EOP ; if ( ++ hw_tdt == Adapter -> tx_desc_num ) { hw_tdt = 0 ; } if ( eop ) { if ( ( Adapter -> link_duplex == HALF_DUPLEX ) && ( e1000_fifo_workaround_82547 ( hw , length ) != E1000_SUCCESS ) ) { if ( tx_ring -> timer_enable_82547 ) { ASSERT ( tx_ring -> timer_id_82547 == 0 ) ; tx_ring -> timer_id_82547 = timeout ( e1000g_82547_timeout , ( void * ) tx_ring , drv_usectohz ( 10000 ) ) ; } return ; } else { E1000_WRITE_REG ( hw , E1000_TDT ( 0 ) , hw_tdt ) ; e1000_update_tx_fifo_head_82547 ( hw , length ) ; length = 0 ; } } } } 