int psp_v3_1_bootloader_load_sysdrv ( struct psp_context * psp ) { int ret ; uint32_t psp_gfxdrv_command_reg = 0 ; struct amdgpu_device * adev = psp -> adev ; uint32_t sol_reg ; sol_reg = RREG32 ( SOC15_REG_OFFSET ( MP0 , 0 , mmMP0_SMN_C2PMSG_81 ) ) ; if ( sol_reg ) { return 0 ; } ret = psp_wait_for ( psp , SOC15_REG_OFFSET ( MP0 , 0 , mmMP0_SMN_C2PMSG_35 ) , 0x80000000 , 0x80000000 , false ) ; if ( ret ) { return ret ; } memset ( psp -> fw_pri_buf , 0 , PSP_1_MEG ) ; WREG32 ( SOC15_REG_OFFSET ( MP0 , 0 , mmMP0_SMN_C2PMSG_36 ) , ( uint32_t ) ( psp -> fw_pri_mc_addr >> 20 ) ) ; psp_gfxdrv_command_reg = 1 << 16 ; WREG32 ( SOC15_REG_OFFSET ( MP0 , 0 , mmMP0_SMN_C2PMSG_35 ) , psp_gfxdrv_command_reg ) ; mdelay ( 20 ) ; ret = psp_wait_for ( psp , SOC15_REG_OFFSET ( MP0 , 0 , mmMP0_SMN_C2PMSG_35 ) , 0x80000000 , 0x80000000 , false ) ; return ret ; } 