static struct snd_pcm_chmap_elem * convert_chmap ( int channels , unsigned int bits , int protocol ) { static unsigned int uac1_maps [ ] { SNDRV_CHMAP_FL SNDRV_CHMAP_FR SNDRV_CHMAP_FC SNDRV_CHMAP_LFE SNDRV_CHMAP_SL SNDRV_CHMAP_SR SNDRV_CHMAP_FLC SNDRV_CHMAP_FRC SNDRV_CHMAP_RC SNDRV_CHMAP_SL SNDRV_CHMAP_SR SNDRV_CHMAP_TC 0 } ; ; static unsigned int uac2_maps [ ] { SNDRV_CHMAP_FL SNDRV_CHMAP_FR SNDRV_CHMAP_FC SNDRV_CHMAP_LFE SNDRV_CHMAP_RL SNDRV_CHMAP_RR SNDRV_CHMAP_FLC SNDRV_CHMAP_FRC SNDRV_CHMAP_RC SNDRV_CHMAP_SL SNDRV_CHMAP_SR SNDRV_CHMAP_TC SNDRV_CHMAP_TFL SNDRV_CHMAP_TFC SNDRV_CHMAP_TFR SNDRV_CHMAP_TRL SNDRV_CHMAP_TRC SNDRV_CHMAP_TRR SNDRV_CHMAP_TFLC SNDRV_CHMAP_TFRC SNDRV_CHMAP_LLFE SNDRV_CHMAP_RLFE SNDRV_CHMAP_TSL SNDRV_CHMAP_TSR SNDRV_CHMAP_BC SNDRV_CHMAP_RLC SNDRV_CHMAP_RRC 0 } ; ; struct snd_pcm_chmap_elem * chmap ; const unsigned int * maps ; int c ; chmap = kzalloc ( sizeof ( * chmap ) , GFP_KERNEL ) ; if ( ! chmap ) { return NULL ; } maps = protocol == UAC_VERSION_2 ?uac2_maps : uac1_maps ; chmap -> channels = channels ; c = 0 ; if ( bits ) { for ( ; bits && * maps ; maps ++ , bits >>= 1 ) { if ( bits & 1 ) { chmap -> map [ c ++ ] = * maps ; } } } else { if ( channels == 1 ) { chmap -> map [ c ++ ] = SNDRV_CHMAP_MONO ; } else { for ( ; c < channels && * maps ; maps ++ ) { chmap -> map [ c ++ ] = * maps ; } } } for ( ; c < channels ; c ++ ) { chmap -> map [ c ] = SNDRV_CHMAP_UNKNOWN ; } return chmap ; } 