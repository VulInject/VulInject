static void barrier_cyclic ( struct barrier * b , struct vtclog * vl ) { enum barrier_e t ; int w ; AZ ( pthread_mutex_lock ( & b -> mtx ) ) ; t = b -> type ; w = b -> waiters ; AZ ( pthread_mutex_unlock ( & b -> mtx ) ) ; if ( t == BARRIER_NONE ) { vtc_fatal ( vl , "Barrier(%s) use error: not initialized" , b -> name ) ; } if ( w != 0 ) { vtc_fatal ( vl , "Barrier(%s) use error: already in use" , b -> name ) ; } AZ ( pthread_mutex_lock ( & b -> mtx ) ) ; b -> cyclic = 1 ; AZ ( pthread_mutex_unlock ( & b -> mtx ) ) ; } 