output_move_double ( ) rtx * operands ; { { REGOP , OFFSOP , MEMOP , PUSHOP , POPOP , CNSTOP , RNDOP } , optype0 , optype1 rtx latehalf [ 2 ] ; rtx middlehalf [ 2 ] ; rtx xops [ 2 ] ; rtx addreg0 = 0 , addreg1 = 0 ; int dest_overlapped_low = 0 ; int size = GET_MODE_SIZE ( GET_MODE ( operands [ 0 ] ) ) ; middlehalf [ 0 ] = 0 ; middlehalf [ 1 ] = 0 ; if ( REG_P ( operands [ 0 ] ) ) { optype0 = REGOP ; } if ( offsettable_memref_p ( operands [ 0 ] ) ) { optype0 = OFFSOP ; } if ( GET_CODE ( XEXP ( operands [ 0 ] , 0 ) ) == POST_INC ) { optype0 = POPOP ; } if ( GET_CODE ( XEXP ( operands [ 0 ] , 0 ) ) == PRE_DEC ) { optype0 = PUSHOP ; } if ( GET_CODE ( operands [ 0 ] ) == MEM ) { optype0 = MEMOP ; } else { optype0 = RNDOP ; } if ( REG_P ( operands [ 1 ] ) ) { optype1 = REGOP ; } if ( CONSTANT_P ( operands [ 1 ] ) ) { optype1 = CNSTOP ; } if ( offsettable_memref_p ( operands [ 1 ] ) ) { optype1 = OFFSOP ; } if ( GET_CODE ( XEXP ( operands [ 1 ] , 0 ) ) == POST_INC ) { optype1 = POPOP ; } if ( GET_CODE ( XEXP ( operands [ 1 ] , 0 ) ) == PRE_DEC ) { optype1 = PUSHOP ; } if ( GET_CODE ( operands [ 1 ] ) == MEM ) { optype1 = MEMOP ; } else { optype1 = RNDOP ; } if ( optype0 == RNDOP || optype1 == RNDOP ) { abort ( ) ; } if ( optype0 == PUSHOP && optype1 == POPOP ) { operands [ 0 ] = XEXP ( XEXP ( operands [ 0 ] , 0 ) , 0 ) ; if ( size == 12 ) { output_asm_insn ( "sub%.l %#12,%0" , operands ) ; } else { output_asm_insn ( "subq%.l %#8,%0" , operands ) ; } if ( GET_MODE ( operands [ 1 ] ) == XFmode ) { operands [ 0 ] = gen_rtx_MEM ( XFmode , operands [ 0 ] ) ; } if ( GET_MODE ( operands [ 0 ] ) == DFmode ) { operands [ 0 ] = gen_rtx_MEM ( DFmode , operands [ 0 ] ) ; } else { operands [ 0 ] = gen_rtx_MEM ( DImode , operands [ 0 ] ) ; } optype0 = OFFSOP ; } if ( optype0 == POPOP && optype1 == PUSHOP ) { operands [ 1 ] = XEXP ( XEXP ( operands [ 1 ] , 0 ) , 0 ) ; if ( size == 12 ) { output_asm_insn ( "sub%.l %#12,%1" , operands ) ; } else { output_asm_insn ( "subq%.l %#8,%1" , operands ) ; } if ( GET_MODE ( operands [ 1 ] ) == XFmode ) { operands [ 1 ] = gen_rtx_MEM ( XFmode , operands [ 1 ] ) ; } if ( GET_MODE ( operands [ 1 ] ) == DFmode ) { operands [ 1 ] = gen_rtx_MEM ( DFmode , operands [ 1 ] ) ; } else { operands [ 1 ] = gen_rtx_MEM ( DImode , operands [ 1 ] ) ; } optype1 = OFFSOP ; } if ( optype0 == MEMOP ) { addreg0 = find_addr_reg ( XEXP ( operands [ 0 ] , 0 ) ) ; } if ( optype1 == MEMOP ) { addreg1 = find_addr_reg ( XEXP ( operands [ 1 ] , 0 ) ) ; } if ( size == 12 ) { if ( optype0 == REGOP ) { latehalf [ 0 ] = gen_rtx_REG ( SImode , REGNO ( operands [ 0 ] ) + 2 ) ; middlehalf [ 0 ] = gen_rtx_REG ( SImode , REGNO ( operands [ 0 ] ) + 1 ) ; } if ( optype0 == OFFSOP ) { middlehalf [ 0 ] = adjust_address ( operands [ 0 ] , SImode , 4 ) ; latehalf [ 0 ] = adjust_address ( operands [ 0 ] , SImode , size - 4 ) ; } else { middlehalf [ 0 ] = operands [ 0 ] ; latehalf [ 0 ] = operands [ 0 ] ; } if ( optype1 == REGOP ) { latehalf [ 1 ] = gen_rtx_REG ( SImode , REGNO ( operands [ 1 ] ) + 2 ) ; middlehalf [ 1 ] = gen_rtx_REG ( SImode , REGNO ( operands [ 1 ] ) + 1 ) ; } if ( optype1 == OFFSOP ) { middlehalf [ 1 ] = adjust_address ( operands [ 1 ] , SImode , 4 ) ; latehalf [ 1 ] = adjust_address ( operands [ 1 ] , SImode , size - 4 ) ; } if ( optype1 == CNSTOP ) { if ( GET_CODE ( operands [ 1 ] ) == CONST_DOUBLE ) { REAL_VALUE_TYPE r ; long l [ 3 ] ; REAL_VALUE_FROM_CONST_DOUBLE ( r , operands [ 1 ] ) ; REAL_VALUE_TO_TARGET_LONG_DOUBLE ( r , l ) ; operands [ 1 ] = GEN_INT ( l [ 0 ] ) ; middlehalf [ 1 ] = GEN_INT ( l [ 1 ] ) ; latehalf [ 1 ] = GEN_INT ( l [ 2 ] ) ; } if ( CONSTANT_P ( operands [ 1 ] ) ) { abort ( ) ; if ( GET_CODE ( operands [ 1 ] ) == CONST_INT && INTVAL ( operands [ 1 ] ) < 0 ) { latehalf [ 1 ] = constm1_rtx ; } else { latehalf [ 1 ] = const0_rtx ; } } } else { middlehalf [ 1 ] = operands [ 1 ] ; latehalf [ 1 ] = operands [ 1 ] ; } } else { if ( optype0 == REGOP ) { latehalf [ 0 ] = gen_rtx_REG ( SImode , REGNO ( operands [ 0 ] ) + 1 ) ; } if ( optype0 == OFFSOP ) { latehalf [ 0 ] = adjust_address ( operands [ 0 ] , SImode , size - 4 ) ; } else { latehalf [ 0 ] = operands [ 0 ] ; } if ( optype1 == REGOP ) { latehalf [ 1 ] = gen_rtx_REG ( SImode , REGNO ( operands [ 1 ] ) + 1 ) ; } if ( optype1 == OFFSOP ) { latehalf [ 1 ] = adjust_address ( operands [ 1 ] , SImode , size - 4 ) ; } if ( optype1 == CNSTOP ) { split_double ( operands [ 1 ] , & operands [ 1 ] , & latehalf [ 1 ] ) ; } else { latehalf [ 1 ] = operands [ 1 ] ; } } if ( optype0 == PUSHOP && REGNO ( XEXP ( XEXP ( operands [ 0 ] , 0 ) , 0 ) ) == STACK_POINTER_REGNUM && reg_overlap_mentioned_p ( stack_pointer_rtx , operands [ 1 ] ) ) { operands [ 1 ] = middlehalf [ 1 ] = latehalf [ 1 ] ; } if ( optype0 == REGOP && ( optype1 == OFFSOP || optype1 == MEMOP ) ) { rtx testlow = gen_rtx_REG ( SImode , REGNO ( operands [ 0 ] ) ) ; if ( reg_overlap_mentioned_p ( testlow , XEXP ( operands [ 1 ] , 0 ) ) && reg_overlap_mentioned_p ( latehalf [ 0 ] , XEXP ( operands [ 1 ] , 0 ) ) ) { compadr xops [ 0 ] = latehalf [ 0 ] ; xops [ 1 ] = XEXP ( operands [ 1 ] , 0 ) ; output_asm_insn ( "lea %a1,%0" , xops ) ; if ( GET_MODE ( operands [ 1 ] ) == XFmode ) { operands [ 1 ] = gen_rtx_MEM ( XFmode , latehalf [ 0 ] ) ; middlehalf [ 1 ] = adjust_address ( operands [ 1 ] , DImode , size - 8 ) ; latehalf [ 1 ] = adjust_address ( operands [ 1 ] , DImode , size - 4 ) ; } else { operands [ 1 ] = gen_rtx_MEM ( DImode , latehalf [ 0 ] ) ; latehalf [ 1 ] = adjust_address ( operands [ 1 ] , DImode , size - 4 ) ; } } if ( size == 12 && reg_overlap_mentioned_p ( middlehalf [ 0 ] , XEXP ( operands [ 1 ] , 0 ) ) ) { if ( reg_overlap_mentioned_p ( testlow , XEXP ( operands [ 1 ] , 0 ) ) || reg_overlap_mentioned_p ( latehalf [ 0 ] , XEXP ( operands [ 1 ] , 0 ) ) ) { compadr } if ( addreg0 || addreg1 ) { abort ( ) ; } output_asm_insn ( singlemove_string ( operands ) , operands ) ; output_asm_insn ( singlemove_string ( latehalf ) , latehalf ) ; output_asm_insn ( singlemove_string ( middlehalf ) , middlehalf ) ; return "" ; } if ( reg_overlap_mentioned_p ( testlow , XEXP ( operands [ 1 ] , 0 ) ) ) { dest_overlapped_low = 1 ; } } if ( optype0 == PUSHOP || optype1 == PUSHOP || ( optype0 == REGOP && optype1 == REGOP && ( ( middlehalf [ 1 ] && REGNO ( operands [ 0 ] ) == REGNO ( middlehalf [ 1 ] ) ) || REGNO ( operands [ 0 ] ) == REGNO ( latehalf [ 1 ] ) ) ) || dest_overlapped_low ) { if ( addreg0 ) { if ( size == 12 ) { output_asm_insn ( "addq%.l %#8,%0" , & addreg0 ) ; } else { output_asm_insn ( "addq%.l %#4,%0" , & addreg0 ) ; } } if ( addreg1 ) { if ( size == 12 ) { output_asm_insn ( "addq%.l %#8,%0" , & addreg1 ) ; } else { output_asm_insn ( "addq%.l %#4,%0" , & addreg1 ) ; } } output_asm_insn ( singlemove_string ( latehalf ) , latehalf ) ; if ( addreg0 ) { output_asm_insn ( "subq%.l %#4,%0" , & addreg0 ) ; } if ( addreg1 ) { output_asm_insn ( "subq%.l %#4,%0" , & addreg1 ) ; } if ( size == 12 ) { output_asm_insn ( singlemove_string ( middlehalf ) , middlehalf ) ; if ( addreg0 ) { output_asm_insn ( "subq%.l %#4,%0" , & addreg0 ) ; } if ( addreg1 ) { output_asm_insn ( "subq%.l %#4,%0" , & addreg1 ) ; } } return singlemove_string ( operands ) ; } output_asm_insn ( singlemove_string ( operands ) , operands ) ; if ( addreg0 ) { output_asm_insn ( "addq%.l %#4,%0" , & addreg0 ) ; } if ( addreg1 ) { output_asm_insn ( "addq%.l %#4,%0" , & addreg1 ) ; } output_asm_insn ( singlemove_string ( latehalf ) , latehalf ) ; if ( addreg0 ) { if ( size == 12 ) { output_asm_insn ( "subq%.l %#8,%0" , & addreg0 ) ; } else { output_asm_insn ( "subq%.l %#4,%0" , & addreg0 ) ; } } if ( addreg1 ) { if ( size == 12 ) { output_asm_insn ( "subq%.l %#8,%0" , & addreg1 ) ; } else { output_asm_insn ( "subq%.l %#4,%0" , & addreg1 ) ; } } return "" ; } 