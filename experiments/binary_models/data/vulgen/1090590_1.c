int rtllib_softmac_init ( struct rtllib_device * ieee ) { int i ; memset ( & ieee -> current_network , 0 , sizeof ( rtllib_network ) ) ; ieee -> state = RTLLIB_NOLINK ; for ( i = 0 ; i < 5 ; i ++ ) { ieee -> seq_ctrl [ i ] = 0 ; } ieee -> dot11d_info = kzalloc ( sizeof ( rt_dot11d_info ) , GFP_ATOMIC ) ; ieee -> link_detect_info . SlotIndex = 0 ; ieee -> link_detect_info . SlotNum = 2 ; ieee -> link_detect_info . NumRecvBcnInPeriod = 0 ; ieee -> link_detect_info . NumRecvDataInPeriod = 0 ; ieee -> link_detect_info . NumTxOkInPeriod = 0 ; ieee -> link_detect_info . NumRxOkInPeriod = 0 ; ieee -> link_detect_info . NumRxUnicastOkInPeriod = 0 ; ieee -> bIsAggregateFrame = false ; ieee -> assoc_id = 0 ; ieee -> queue_stop = 0 ; ieee -> scanning_continue = 0 ; ieee -> softmac_features = 0 ; ieee -> wap_set = 0 ; ieee -> ssid_set = 0 ; ieee -> proto_started = 0 ; ieee -> proto_stoppping = 0 ; ieee -> basic_rate = RTLLIB_DEFAULT_BASIC_RATE ; ieee -> rate = 22 ; ieee -> ps = RTLLIB_PS_DISABLED ; ieee -> sta_sleep = LPS_IS_WAKE ; ieee -> reg_dot11ht_oper_rate_set [ 0 ] = 0xff ; ieee -> reg_dot11ht_oper_rate_set [ 1 ] = 0xff ; ieee -> reg_dot11ht_oper_rate_set [ 4 ] = 0x01 ; ieee -> reg_dot11tx_ht_oper_rate_set [ 0 ] = 0xff ; ieee -> reg_dot11tx_ht_oper_rate_set [ 1 ] = 0xff ; ieee -> reg_dot11tx_ht_oper_rate_set [ 4 ] = 0x01 ; ieee -> FirstIe_InScan = false ; ieee -> actscanning = false ; ieee -> beinretry = false ; ieee -> is_set_key = false ; init_mgmt_queue ( ieee ) ; ieee -> tx_pending . txb = NULL ; timer_setup ( & ieee -> associate_timer , rtllib_associate_abort_cb , 0 ) ; timer_setup ( & ieee -> beacon_timer , rtllib_send_beacon_cb , 0 ) ; INIT_DELAYED_WORK_RSL ( & ieee -> link_change_wq , ( void * ) rtllib_link_change_wq , ieee ) ; INIT_DELAYED_WORK_RSL ( & ieee -> start_ibss_wq , ( void * ) rtllib_start_ibss_wq , ieee ) ; INIT_WORK_RSL ( & ieee -> associate_complete_wq , ( void * ) rtllib_associate_complete_wq , ieee ) ; INIT_DELAYED_WORK_RSL ( & ieee -> associate_procedure_wq , ( void * ) rtllib_associate_procedure_wq , ieee ) ; INIT_DELAYED_WORK_RSL ( & ieee -> softmac_scan_wq , ( void * ) rtllib_softmac_scan_wq , ieee ) ; INIT_DELAYED_WORK_RSL ( & ieee -> associate_retry_wq , ( void * ) rtllib_associate_retry_wq , ieee ) ; INIT_WORK_RSL ( & ieee -> wx_sync_scan_wq , ( void * ) rtllib_wx_sync_scan_wq , ieee ) ; mutex_init ( & ieee -> wx_mutex ) ; mutex_init ( & ieee -> scan_mutex ) ; mutex_init ( & ieee -> ips_mutex ) ; spin_lock_init ( & ieee -> mgmt_tx_lock ) ; spin_lock_init ( & ieee -> beacon_lock ) ; INIT_WORK ( & ieee -> ps_task , rtllib_sta_ps ) ; return 0 ; } 