int board_eth_init ( struct bd_info * bis ) { uint32_t base = IMX_FEC_BASE ; struct mii_dev * bus = NULL ; struct phy_device * phydev = NULL ; int ret ; gpio_request ( WL12XX_WL_IRQ_GP , "wifi_irq" ) ; gpio_request ( IMX_GPIO_NR ( 6 , 30 ) , "rgmii_rxc" ) ; gpio_request ( IMX_GPIO_NR ( 6 , 25 ) , "rgmii_rd0" ) ; gpio_request ( IMX_GPIO_NR ( 6 , 27 ) , "rgmii_rd1" ) ; gpio_request ( IMX_GPIO_NR ( 6 , 28 ) , "rgmii_rd2" ) ; gpio_request ( IMX_GPIO_NR ( 6 , 29 ) , "rgmii_rd3" ) ; gpio_request ( IMX_GPIO_NR ( 6 , 24 ) , "rgmii_rx_ctl" ) ; gpio_request ( IMX_GPIO_NR ( 3 , 23 ) , "rgmii_reset_sabrelite" ) ; gpio_request ( IMX_GPIO_NR ( 1 , 27 ) , "rgmii_reset_nitrogen6x" ) ; setup_iomux_enet ( ) ; bus = fec_get_miibus ( base , - 1 ) ; if ( ! bus ) { return - EINVAL ; } phydev = phy_find_by_mask ( bus , ( 0xf << 4 ) ) ; if ( ! phydev ) { ret = - EINVAL ; free_bus } printf ( "using phy at %d\n" , phydev -> addr ) ; ret = fec_probe ( bis , - 1 , base , bus , phydev ) ; if ( ret ) { free_phydev } return 0 ; free_phydev free_bus free ( bus ) ; return ret ; } 