static int userns_has_mapping ( const char * name ) { _cleanup_fclose_ FILE * f = NULL ; uid_t a , b , c ; int r ; f = fopen ( name , "re" ) ; if ( ! f ) { log_debug_errno ( errno , "Failed to open %s: %m" , name ) ; return errno == ENOENT ?false : - errno ; } errno = 0 ; r = fscanf ( f , UID_FMT " " UID_FMT " " UID_FMT "\n" , & a , & b , & c ) ; if ( r == EOF ) { if ( ferror ( f ) ) { return log_debug_errno ( errno_or_else ( EIO ) , "Failed to read %s: %m" , name ) ; } log_debug ( "%s is empty, we're in an uninitialized user namespace" , name ) ; return true ; } if ( a == 0 && b == 0 && c == UINT32_MAX ) { log_debug ( "%s has a full 1:1 mapping" , name ) ; return false ; } log_debug ( "Mapping found in %s, we're in a user namespace" , name ) ; return true ; } 