static int smb_enable_resource ( sa_resource_t resource ) { sa_share_t share ; smb_share_t si ; int ret = SA_OK ; int err ; boolean_t isonline ; share = sa_get_resource_parent ( resource ) ; isonline = smb_isonline ( ) ; if ( ! isonline && ! smb_isautoenable ( ) && smb_isdisabled ( ) ) { return ( SA_OK ) ; } if ( ! isonline ) { ( void ) smb_enable_service ( ) ; if ( ! smb_isonline ( ) ) { return ( SA_OK ) ; } } if ( ( ret = smb_build_shareinfo ( share , resource , & si ) ) != SA_OK ) { return ( ret ) ; } err = smb_share_create ( & si ) ; if ( err == NERR_Success || ! ( ! isonline && err == NERR_DuplicateName ) ) { ( void ) sa_update_sharetab ( share , "smb" ) ; } else { return ( SA_NOT_SHARED ) ; } return ( SA_OK ) ; } 