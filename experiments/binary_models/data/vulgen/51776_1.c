irc_input_user_message_display ( , , ) { struct t_irc_nick * ptr_nick ; char * pos , * text2 , * text_decoded , str_tags [ 256 ] , * str_color ; const char * ptr_text ; if ( strncmp ( text , "\01ACTION " , 8 ) == 0 ) { action = 1 ; pos = strrchr ( text + 8 , '\01' ) ; if ( pos ) { text2 = weechat_strndup ( text + 8 , pos - text - 8 ) ; } else { text2 = strdup ( text + 8 ) ; } } else { text2 = strdup ( text ) ; } text_decoded = irc_color_decode ( ( text2 ) ?text2 : text , weechat_config_boolean ( irc_config_network_colors_send ) ) ; IRC_BUFFER_GET_SERVER_CHANNEL ( buffer ) ; if ( ptr_channel ) { ptr_nick = NULL ; if ( ptr_channel -> type == IRC_CHANNEL_TYPE_CHANNEL ) { ptr_nick = irc_nick_search ( ptr_server , ptr_channel , ptr_server -> nick ) ; } if ( action ) { snprintf ( str_tags , sizeof ( str_tags ) , "irc_action,self_msg,notify_none,no_highlight" ) ; } else { str_color = irc_color_for_tags ( weechat_config_color ( weechat_config_get ( "weechat.color.chat_nick_self" ) ) ) ; snprintf ( str_tags , sizeof ( str_tags ) , "notify_none,self_msg,no_highlight,prefix_nick_%s" , ?str_color : "default" ) ; if ( str_color ) { free ( str_color ) ; } } ptr_text = ( text_decoded ) ?text_decoded : ( ( text2 ) ?text2 : text ) ; if ( action ) { weechat_printf_date_tags ( buffer , 0 , irc_protocol_tags ( "privmsg" , NULL , str_tags , ( ptr_nick ) ?ptr_nick -> name : ptr_server -> nick , NULL ) , "%s%s%s%s%s %s" , weechat_prefix ( "action" ) , irc_nick_mode_for_display ( ptr_server , ptr_nick , 0 ) , IRC_COLOR_CHAT_NICK_SELF , ptr_server -> nick , IRC_COLOR_RESET , ptr_text ) ; } else { weechat_printf_date_tags ( buffer , 0 , irc_protocol_tags ( "privmsg" , NULL , str_tags , ( ptr_nick ) ?ptr_nick -> name : ptr_server -> nick , NULL ) , "%s%s" , irc_nick_as_prefix ( ptr_server , ( ptr_nick ) ?ptr_nick : NULL , ( ptr_nick ) ?NULL : ptr_server -> nick , IRC_COLOR_CHAT_NICK_SELF ) , ptr_text ) ; } } if ( text2 ) { free ( text2 ) ; } if ( text_decoded ) { free ( text_decoded ) ; } } 