static void init_feature_attrs ( void ) { struct btrfs_feature_attr * fa ; int set , i ; BUILD_BUG_ON ( ARRAY_SIZE ( btrfs_unknown_feature_names ) != ARRAY_SIZE ( btrfs_feature_attrs ) ) ; BUILD_BUG_ON ( ARRAY_SIZE ( btrfs_unknown_feature_names [ 0 ] ) != ARRAY_SIZE ( btrfs_feature_attrs [ 0 ] ) ) ; memset ( btrfs_feature_attrs , 0 , sizeof ( btrfs_feature_attrs ) ) ; memset ( btrfs_unknown_feature_names , 0 , sizeof ( btrfs_unknown_feature_names ) ) ; for ( i = 0 ; btrfs_supported_feature_attrs [ i ] ; i ++ ) { struct btrfs_feature_attr * sfa ; struct attribute * a = btrfs_supported_feature_attrs [ i ] ; int bit ; sfa = attr_to_btrfs_feature_attr ( a ) ; bit = ilog2 ( sfa -> feature_bit ) ; fa = & btrfs_feature_attrs [ sfa -> feature_set ] [ bit ] ; fa -> kobj_attr . attr . name = sfa -> kobj_attr . attr . name ; } for ( set = 0 ; set < FEAT_MAX ; set ++ ) { for ( i = 0 ; i < ARRAY_SIZE ( btrfs_feature_attrs [ set ] ) ; i ++ ) { char * name = btrfs_unknown_feature_names [ set ] [ i ] ; fa = & btrfs_feature_attrs [ set ] [ i ] ; if ( fa -> kobj_attr . attr . name ) { continue ; } fa -> kobj_attr . attr . name = name ; fa -> kobj_attr . attr . mode = S_IRUGO ; fa -> feature_set = set ; fa -> feature_bit = 1ULL << i ; } } } 