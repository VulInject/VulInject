static struct rproc * __pru_rproc_get ( struct device_node * np , int index ) { struct rproc * rproc ; phandle rproc_phandle ; int ret ; ret = of_property_read_u32_index ( np , "ti,prus" , index , & rproc_phandle ) ; if ( ret ) { return ERR_PTR ( ret ) ; } rproc = rproc_get_by_phandle ( rproc_phandle ) ; if ( ! rproc ) { ret = - EPROBE_DEFER ; return ERR_PTR ( ret ) ; } if ( ! is_pru_rproc ( rproc -> dev . parent ) ) { return ERR_PTR ( - ENODEV ) ; } return rproc ; } 