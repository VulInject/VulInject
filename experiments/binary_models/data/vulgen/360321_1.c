static void ali_set_pio_mode ( ide_hwif_t * hwif , ide_drive_t * drive ) { ide_drive_t * pair = ide_get_pair_dev ( drive ) ; int bus_speed = ide_pci_clk ?ide_pci_clk : 33 ; struct ide_timing t ; ide_timing_compute ( drive , drive -> pio_mode , & t , T , 1 ) ; if ( pair ) { struct ide_timing p ; ide_timing_compute ( pair , pair -> pio_mode , & p , T , 1 ) ; ide_timing_merge ( & p , & t , & t , IDE_TIMING_SETUP | IDE_TIMING_8BIT ) ; if ( pair -> dma_mode ) { ide_timing_compute ( pair , pair -> dma_mode , & p , T , 1 ) ; ide_timing_merge ( & p , & t , & t , IDE_TIMING_SETUP | IDE_TIMING_8BIT ) ; } } ali_fifo_control ( hwif , drive , ( drive -> media == ide_disk ) ?0x05 : 0x00 ) ; ali_program_timings ( hwif , drive , & t , 0 ) ; } 