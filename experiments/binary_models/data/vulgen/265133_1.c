void check_spambot_warning ( struct Client * source_p , const char * name ) { int t_delta ; int decrement_count ; if ( ( GlobalSetOptions . spam_num && ( source_p -> localClient -> join_leave_count >= GlobalSetOptions . spam_num ) ) ) { if ( source_p -> localClient -> oper_warn_count_down > 0 ) { source_p -> localClient -> oper_warn_count_down -- ; } else { source_p -> localClient -> oper_warn_count_down = 0 ; } if ( source_p -> localClient -> oper_warn_count_down == 0 && name != NULL ) { sendto_realops_snomask ( SNO_BOTS , L_NETWIDE , "User %s (%s@%s) trying to join %s is a possible spambot" , source_p -> name , source_p -> username , source_p -> orighost , name ) ; source_p -> localClient -> oper_warn_count_down = OPER_SPAM_COUNTDOWN ; } } else { if ( ( t_delta = ( rb_current_time ( ) - source_p -> localClient -> last_leave_time ) ) > JOIN_LEAVE_COUNT_EXPIRE_TIME ) { if ( name != NULL ) { } if ( decrement_count > source_p -> localClient -> join_leave_count ) { source_p -> localClient -> join_leave_count = 0 ; } else { source_p -> localClient -> join_leave_count -= decrement_count ; } } else { if ( ( rb_current_time ( ) - ( source_p -> localClient -> last_join_time ) ) < GlobalSetOptions . spam_time ) { source_p -> localClient -> join_leave_count ++ ; } } if ( name != NULL ) { source_p -> localClient -> last_join_time = rb_current_time ( ) ; } else { source_p -> localClient -> last_leave_time = rb_current_time ( ) ; } } } 