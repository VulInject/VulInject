static void rtl8192_rx_isr ( struct urb * urb ) { struct sk_buff * skb = ( sk_buff * ) urb -> context ; struct rtl8192_rx_info * info = ( rtl8192_rx_info * ) skb -> cb ; struct net_device * dev = info -> dev ; struct r8192_priv * priv = ieee80211_priv ( dev ) ; int out_pipe = info -> out_pipe ; int err ; if ( ! priv -> up ) { return ; } if ( unlikely ( urb -> status ) ) { info -> urb = NULL ; priv -> stats . rxstaterr ++ ; priv -> ieee80211 -> stats . rx_errors ++ ; return ; } skb_unlink ( skb , & priv -> rx_queue ) ; skb_put ( skb , urb -> actual_length ) ; skb_queue_tail ( & priv -> skb_queue , skb ) ; tasklet_schedule ( & priv -> irq_rx_tasklet ) ; skb = dev_alloc_skb ( RX_URB_SIZE ) ; if ( unlikely ( ! skb ) ) { usb_free_urb ( urb ) ; netdev_err ( dev , "%s(): can't alloc skb\n" , __func__ ) ; return ; } usb_fill_bulk_urb ( urb , priv -> udev , usb_rcvbulkpipe ( priv -> udev , out_pipe ) , skb_tail_pointer ( skb ) , RX_URB_SIZE , rtl8192_rx_isr , skb ) ; info = ( rtl8192_rx_info * ) skb -> cb ; info -> urb = urb ; info -> dev = dev ; info -> out_pipe = out_pipe ; urb -> transfer_buffer = skb_tail_pointer ( skb ) ; urb -> context = skb ; skb_queue_tail ( & priv -> rx_queue , skb ) ; err = usb_submit_urb ( urb , GFP_ATOMIC ) ; if ( err && err != EPERM ) { netdev_err ( dev , "can not submit rxurb, err is %x, URB status is %x\n" , err , urb -> status ) ; } } 