int __init xen_blkif_interface_init ( void ) { xen_blkif_cachep = kmem_cache_create ( "blkif_cache" , sizeof ( xen_blkif ) , 0 , 0 , NULL ) ; return 0 ; } static ssize_t show_ # # name ( , , ) { xenbus_device * dev = to_xenbus_device ( _dev ) backend_info * be = dev_get_drvdata ( & dev -> dev ) xen_blkif * blkif = be -> blkif unsigned int i unsigned long long result = 0 if ( ! blkif -> rings ) { out } } ; for ( i = 0 ; i < blkif -> nr_rings ; i ++ ) { struct xen_blkif_ring * ring = & blkif -> rings [ i ] ; result += ring -> st_ # # name ; } out return sprintf ( buf , format , result ) ; DEVICE_ATTR ( , , , ) VBD_SHOW_ALLRING ( oo_req , "%llu\n" ) ; VBD_SHOW_ALLRING ( rd_req , "%llu\n" ) ; VBD_SHOW_ALLRING ( wr_req , "%llu\n" ) ; VBD_SHOW_ALLRING ( f_req , "%llu\n" ) ; VBD_SHOW_ALLRING ( ds_req , "%llu\n" ) ; VBD_SHOW_ALLRING ( rd_sect , "%llu\n" ) ; VBD_SHOW_ALLRING ( wr_sect , "%llu\n" ) ; static struct attribute * xen_vbdstat_attrs [ ] { & dev_attr_oo_req . attr & dev_attr_rd_req . attr & dev_attr_wr_req . attr & dev_attr_f_req . attr & dev_attr_ds_req . attr & dev_attr_rd_sect . attr & dev_attr_wr_sect . attr NULL } ; ; 