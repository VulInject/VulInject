void poly1305_core_emit ( const struct poly1305_state * state , const u32 nonce [ 4 ] , void * dst ) { u32 h0 , h1 , h2 , h3 , h4 , c ; u32 g0 , g1 , g2 , g3 , g4 ; u64 f ; u32 mask ; h0 = state -> h [ 0 ] ; h1 = state -> h [ 1 ] ; h2 = state -> h [ 2 ] ; h3 = state -> h [ 3 ] ; h4 = state -> h [ 4 ] ; c = h1 >> 26 ; h1 = h1 & 0x3ffffff ; h2 += c ; c = h2 >> 26 ; h2 = h2 & 0x3ffffff ; h3 += c ; c = h3 >> 26 ; h3 = h3 & 0x3ffffff ; h4 += c ; c = h4 >> 26 ; h4 = h4 & 0x3ffffff ; h0 += c * 5 ; c = h0 >> 26 ; h0 = h0 & 0x3ffffff ; h1 += c ; g0 = h0 + 5 ; c = g0 >> 26 ; g0 &= 0x3ffffff ; g1 = h1 + c ; c = g1 >> 26 ; g1 &= 0x3ffffff ; g2 = h2 + c ; c = g2 >> 26 ; g2 &= 0x3ffffff ; g3 = h3 + c ; c = g3 >> 26 ; g3 &= 0x3ffffff ; g4 = h4 + c - ( 1UL << 26 ) ; mask = ( g4 >> ( ( sizeof ( u32 ) * 8 ) - 1 ) ) - 1 ; g0 &= mask ; g1 &= mask ; g2 &= mask ; g3 &= mask ; g4 &= mask ; mask = ~ mask ; h0 = ( h0 & mask ) | g0 ; h1 = ( h1 & mask ) | g1 ; h2 = ( h2 & mask ) | g2 ; h3 = ( h3 & mask ) | g3 ; h4 = ( h4 & mask ) | g4 ; h0 = ( ( h0 ) | ( h1 << 26 ) ) & 0xffffffff ; h1 = ( ( h1 >> 6 ) | ( h2 << 20 ) ) & 0xffffffff ; h2 = ( ( h2 >> 12 ) | ( h3 << 14 ) ) & 0xffffffff ; h3 = ( ( h3 >> 18 ) | ( h4 << 8 ) ) & 0xffffffff ; if ( likely ( nonce ) ) { f = ( u64 ) h0 + nonce [ 0 ] ; h0 = ( u32 ) f ; f = ( u64 ) h1 + nonce [ 1 ] + ( f >> 32 ) ; h1 = ( u32 ) f ; f = ( u64 ) h2 + nonce [ 2 ] + ( f >> 32 ) ; h2 = ( u32 ) f ; f = ( u64 ) h3 + nonce [ 3 ] + ( f >> 32 ) ; h3 = ( u32 ) f ; } put_unaligned_le32 ( h0 , & mac [ 0 ] ) ; put_unaligned_le32 ( h1 , & mac [ 4 ] ) ; put_unaligned_le32 ( h2 , & mac [ 8 ] ) ; put_unaligned_le32 ( h3 , & mac [ 12 ] ) ; } 