static void aspeed_xdma_write ( void * opaque , hwaddr addr , uint64_t val , unsigned int size ) { unsigned int idx ; uint32_t val32 = ( uint32_t ) val ; AspeedXDMAState * xdma = opaque ; AspeedXDMAClass * axc = ASPEED_XDMA_GET_CLASS ( xdma ) ; if ( addr == axc -> cmdq_endp ) { xdma -> regs [ TO_REG ( addr ) ] = val32 & XDMA_BMC_CMDQ_W_MASK ; } if ( addr == axc -> cmdq_wrp ) { idx = TO_REG ( addr ) ; xdma -> regs [ idx ] = val32 & XDMA_BMC_CMDQ_W_MASK ; xdma -> regs [ TO_REG ( axc -> cmdq_rdp ) ] = xdma -> regs [ idx ] ; trace_aspeed_xdma_write ( addr , val ) ; if ( xdma -> bmc_cmdq_readp_set ) { xdma -> bmc_cmdq_readp_set = 0 ; } else { xdma -> regs [ TO_REG ( axc -> intr_status ) ] |= axc -> intr_complete ; if ( xdma -> regs [ TO_REG ( axc -> intr_ctrl ) ] & axc -> intr_complete ) { qemu_irq_raise ( xdma -> irq ) ; } } } if ( addr == axc -> cmdq_rdp ) { trace_aspeed_xdma_write ( addr , val ) ; if ( val32 == XDMA_BMC_CMDQ_RDP_MAGIC ) { xdma -> bmc_cmdq_readp_set = 1 ; } } if ( addr == axc -> intr_ctrl ) { xdma -> regs [ TO_REG ( addr ) ] = val32 & axc -> intr_ctrl_mask ; } if ( addr == axc -> intr_status ) { trace_aspeed_xdma_write ( addr , val ) ; idx = TO_REG ( addr ) ; if ( val32 & axc -> intr_complete ) { xdma -> regs [ idx ] &= ~ axc -> intr_complete ; qemu_irq_lower ( xdma -> irq ) ; } } else { xdma -> regs [ TO_REG ( addr ) ] = val32 ; } } 