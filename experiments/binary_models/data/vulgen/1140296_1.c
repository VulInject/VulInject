static char * conv_from_utf8 ( char * input ) { iconv_t cd ; char * output = input ; char * inval = input ; char * outleft ; char * curlocale ; size_t bytesleft ; size_t size ; size_t osize ; static int warned = 0 ; curlocale = nl_langinfo ( CODESET ) ; if ( curlocale == NULL ) { curlocale = "C" ; } cd = iconv_open ( curlocale , "UTF-8" ) ; if ( cd != NULL && cd != ( iconv_t ) - 1 ) { size = strlen ( input ) ; bytesleft = size * 4 ; if ( output != NULL ) { outleft = output ; osize = iconv ( cd , ( const char * * ) & inval , & size , & outleft , & bytesleft ) ; if ( osize == ( size_t ) - 1 || size != 0 ) { output = input ; } } else { output = input ; } ( void ) iconv_close ( cd ) ; } else { if ( ! warned ) { ( void ) fprintf ( stderr , gettext ( "Cannot convert to %s from UTF-8\n" ) , curlocale ?curlocale : gettext ( "unknown" ) ) ; } warned = 1 ; } return ( output ) ; } 