static ndr_hdid_t * svcctl_svc_hdalloc ( ndr_xa_t * mxa , ndr_hdid_t * mgr_id , char * svc_name ) { svcctl_context_t * ctx ; svcctl_service_context_t * svc_ctx ; svcctl_manager_context_t * mgr_ctx ; int max_name_sz = 0 ; char * svcname ; mgr_ctx = svcctl_get_mgr_ctx ( mxa , mgr_id ) ; if ( mgr_ctx == NULL ) { return ( NULL ) ; } max_name_sz = mgr_ctx -> mc_scf_max_fmri_len ; if ( ( ctx = malloc ( sizeof ( svcctl_context_t ) ) ) == NULL ) { svcctl_hdfree ( mxa , mgr_id ) ; return ( NULL ) ; } ctx -> c_type = SVCCTL_SERVICE_CONTEXT ; if ( ( svc_ctx = malloc ( sizeof ( svcctl_service_context_t ) ) ) == NULL ) { svcctl_hdfree ( mxa , mgr_id ) ; free ( ctx ) ; return ( NULL ) ; } svc_ctx -> sc_mgrid = malloc ( sizeof ( ndr_hdid_t ) ) ; svcname = malloc ( max_name_sz ) ; if ( ( svc_ctx -> sc_mgrid == NULL ) || ( svcname == NULL ) ) { free ( svc_ctx -> sc_mgrid ) ; free ( svc_ctx ) ; svcctl_hdfree ( mxa , mgr_id ) ; free ( ctx ) ; return ( NULL ) ; } svc_ctx -> sc_svcname = svcname ; bcopy ( mgr_id , svc_ctx -> sc_mgrid , sizeof ( ndr_hdid_t ) ) ; ( void ) strlcpy ( svc_ctx -> sc_svcname , svc_name , max_name_sz ) ; ctx -> c_ctx . uc_svc = svc_ctx ; return ( ndr_hdalloc ( mxa , ctx ) ) ; } 