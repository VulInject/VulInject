static int DisableIfaceOffloadingBSD ( LiveDevice * ldev ) { int ret = 0 ; const char * ifname = ldev -> dev ; int if_caps = GetIfaceCaps ( ifname ) ; int set_caps = if_caps ; if ( if_caps == - 1 ) { return - 1 ; } SCLogDebug ( "if_caps %X" , if_caps ) ; if ( if_caps & IFCAP_RXCSUM ) { SCLogPerf ( "%s: disabling rxcsum offloading" , ifname ) ; set_caps &= ~ IFCAP_RXCSUM ; } if ( if_caps & IFCAP_TXCSUM ) { SCLogPerf ( "%s: disabling txcsum offloading" , ifname ) ; set_caps &= ~ IFCAP_TXCSUM ; } if ( if_caps & IFCAP_RXCSUM_IPV6 ) { SCLogPerf ( "%s: disabling rxcsum6 offloading" , ifname ) ; set_caps &= ~ IFCAP_RXCSUM_IPV6 ; } if ( if_caps & IFCAP_TXCSUM_IPV6 ) { SCLogPerf ( "%s: disabling txcsum6 offloading" , ifname ) ; set_caps &= ~ IFCAP_TXCSUM_IPV6 ; } if ( if_caps & ( IFCAP_TSO | IFCAP_TOE | IFCAP_LRO ) ) { SCLogPerf ( "%s: disabling tso|toe|lro offloading" , ifname ) ; set_caps &= ~ ( IFCAP_TSO | IFCAP_LRO ) ; } if ( if_caps & ( IFCAP_TSO | IFCAP_LRO ) ) { SCLogPerf ( "%s: disabling tso|lro offloading" , ifname ) ; set_caps &= ~ ( IFCAP_TSO | IFCAP_LRO ) ; } if ( set_caps != if_caps ) { if ( if_caps & IFCAP_RXCSUM ) { ldev -> offload_orig |= OFFLOAD_FLAG_RXCSUM ; } if ( if_caps & IFCAP_TSO ) { ldev -> offload_orig |= OFFLOAD_FLAG_TSO ; } if ( if_caps & IFCAP_TOE ) { ldev -> offload_orig |= OFFLOAD_FLAG_TOE ; } if ( if_caps & IFCAP_LRO ) { ldev -> offload_orig |= OFFLOAD_FLAG_LRO ; } SetIfaceCaps ( ifname , set_caps ) ; } return ret ; } 