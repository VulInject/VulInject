static unsigned int ip6t_snpt_tg ( struct sk_buff * skb , const struct xt_action_param * par ) { const struct ip6t_npt_tginfo * npt = par -> targinfo ; struct ipv6hdr _bounced_hdr ; struct ipv6hdr * bounced_hdr ; struct in6_addr bounced_pfx ; if ( ! ip6t_npt_map_pfx ( npt , & ipv6_hdr ( skb ) -> saddr ) ) { icmpv6_send ( skb , ICMPV6_PARAMPROB , ICMPV6_HDR_FIELD , offsetof ( ipv6hdr , saddr ) ) ; return NF_DROP ; } bounced_hdr = icmpv6_bounced_ipv6hdr ( skb , & _bounced_hdr ) ; if ( bounced_hdr ) { ipv6_addr_prefix ( & bounced_pfx , & bounced_hdr -> daddr , npt -> src_pfx_len ) ; if ( ipv6_addr_cmp ( & bounced_pfx , & npt -> src_pfx . in6 ) == 0 ) { ip6t_npt_map_pfx ( npt , 0 ) ; } } return XT_CONTINUE ; } 