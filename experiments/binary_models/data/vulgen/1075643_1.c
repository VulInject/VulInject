static int pcl726_attach ( struct comedi_device * dev , struct comedi_devconfig * it ) { const struct pcl726_board * board = dev -> board_ptr ; struct pcl726_private * devpriv ; struct comedi_subdevice * s ; int subdev ; int ret ; int i ; ret = comedi_request_region ( dev , it -> options [ 0 ] , board -> io_len ) ; if ( ret ) { return ret ; } devpriv = comedi_alloc_devpriv ( dev , sizeof ( * devpriv ) ) ; if ( it -> options [ 1 ] && ( board -> irq_mask & ( 1 << it -> options [ 1 ] ) ) ) { ret = request_irq ( it -> options [ 1 ] , pcl726_interrupt , 0 , dev -> board_name , dev ) ; if ( ret == 0 ) { dev -> irq = it -> options [ 1 ] ; } } for ( i = 0 ; i < 12 ; i ++ ) { unsigned int opt = it -> options [ 2 + i ] ; if ( opt < board -> ao_num_ranges && i < board -> ao_nchan ) { devpriv -> rangelist [ i ] = board -> ao_ranges [ opt ] ; } else { devpriv -> rangelist [ i ] = & range_unknown ; } } subdev = board -> have_dio ?3 : 1 ; if ( dev -> irq ) { subdev ++ ; } ret = comedi_alloc_subdevices ( dev , subdev ) ; if ( ret ) { return ret ; } subdev = 0 ; s = & dev -> subdevices [ subdev ++ ] ; s -> type = COMEDI_SUBD_AO ; s -> subdev_flags = SDF_WRITABLE | SDF_GROUND ; s -> n_chan = board -> ao_nchan ; s -> maxdata = 0x0fff ; s -> range_table_list = devpriv -> rangelist ; s -> insn_write = pcl726_ao_insn_write ; ret = comedi_alloc_subdev_readback ( s ) ; if ( ret ) { return ret ; } if ( board -> have_dio ) { s = & dev -> subdevices [ subdev ++ ] ; s -> type = COMEDI_SUBD_DI ; s -> subdev_flags = SDF_READABLE ; s -> n_chan = 16 ; s -> maxdata = 1 ; s -> insn_bits = pcl726_di_insn_bits ; s -> range_table = & range_digital ; s = & dev -> subdevices [ subdev ++ ] ; s -> type = COMEDI_SUBD_DO ; s -> subdev_flags = SDF_WRITABLE ; s -> n_chan = 16 ; s -> maxdata = 1 ; s -> insn_bits = pcl726_do_insn_bits ; s -> range_table = & range_digital ; } if ( dev -> irq ) { s = & dev -> subdevices [ subdev ++ ] ; dev -> read_subdev = s ; s -> type = COMEDI_SUBD_DI ; s -> subdev_flags = SDF_READABLE | SDF_CMD_READ ; s -> n_chan = 1 ; s -> maxdata = 1 ; s -> range_table = & range_digital ; s -> insn_bits = pcl726_intr_insn_bits ; s -> len_chanlist = 1 ; s -> do_cmdtest = pcl726_intr_cmdtest ; s -> do_cmd = pcl726_intr_cmd ; s -> cancel = pcl726_intr_cancel ; } return 0 ; } 