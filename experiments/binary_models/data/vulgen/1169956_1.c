select_shape ( , ) { Object_t * obj ; gint x = GET_REAL_COORD ( ( gint ) event -> x ) ; gint y = GET_REAL_COORD ( ( gint ) event -> y ) ; MoveSashFunc_t sash_func ; obj = object_list_near_sash ( _shapes , x , y , & sash_func ) ; if ( obj ) { Command_t * command = move_sash_command_new ( widget , obj , x , y , sash_func ) ; command_execute ( command ) ; } else { Command_t * command ; obj = object_list_find ( _shapes , x , y ) ; if ( obj ) { if ( event -> state & GDK_SHIFT_MASK ) { if ( obj -> selected ) { command = unselect_command_new ( obj ) ; } else { command = select_command_new ( obj ) ; } } else { if ( obj -> selected ) { command = unselect_all_command_new ( _shapes , obj ) ; } else { Command_t * sub_command ; command = subcommand_start ( NULL ) ; sub_command = unselect_all_command_new ( _shapes , NULL ) ; command_add_subcommand ( command , sub_command ) ; sub_command = select_command_new ( obj ) ; command_add_subcommand ( command , sub_command ) ; command_set_name ( command , sub_command -> name ) ; subcommand_end ( ) ; } } command_execute ( command ) ; command = move_command_new ( _preview , obj , x , y ) ; command_execute ( command ) ; } else { command_execute ( command ) ; } } } 