static ibt_status_t hermon_umap_qp_data_out ( hermon_qphdl_t qp , mlnx_umap_qp_data_out_t * data , size_t data_sz ) { if ( qp == NULL ) { return ( IBT_QP_HDL_INVALID ) ; } _NOTE ( ) data -> mqp_rev = MLNX_UMAP_IF_VERSION ; data -> mqp_mapoffset = ( ( ( ( uint64_t ) qp -> qp_qpnum << MLNX_UMAP_RSRC_TYPE_SHIFT ) | MLNX_UMAP_QPMEM_RSRC ) << PAGESHIFT ) ; data -> mqp_maplen = qp -> qp_wqinfo . qa_size ; data -> mqp_qpnum = qp -> qp_qpnum ; if ( qp -> qp_alloc_flags & IBT_QP_USES_SRQ ) { data -> mqp_rq_off = ( uint32_t ) qp -> qp_wqinfo . qa_size ; data -> mqp_rq_desc_addr = ( uint32_t ) qp -> qp_wqinfo . qa_size ; data -> mqp_rq_numwqe = 0 ; data -> mqp_rq_wqesz = 0 ; data -> mqp_rdbr_mapoffset = 0 ; data -> mqp_rdbr_maplen = 0 ; data -> mqp_rdbr_offset = 0 ; } else { data -> mqp_rq_off = ( uintptr_t ) qp -> qp_rq_buf - ( uintptr_t ) qp -> qp_wqinfo . qa_buf_aligned ; data -> mqp_rq_desc_addr = ( uint32_t ) ( ( uintptr_t ) qp -> qp_rq_buf - qp -> qp_desc_off ) ; data -> mqp_rq_numwqe = qp -> qp_rq_bufsz ; data -> mqp_rq_wqesz = ( 1 << qp -> qp_rq_log_wqesz ) ; data -> mqp_rdbr_mapoffset = qp -> qp_rdbr_mapoffset ; data -> mqp_rdbr_maplen = PAGESIZE ; data -> mqp_rdbr_offset = ( uintptr_t ) qp -> qp_rq_vdbr & PAGEOFFSET ; } data -> mqp_sq_off = ( uintptr_t ) qp -> qp_sq_buf - ( uintptr_t ) qp -> qp_wqinfo . qa_buf_aligned ; data -> mqp_sq_desc_addr = ( uint32_t ) ( ( uintptr_t ) qp -> qp_sq_buf - qp -> qp_desc_off ) ; data -> mqp_sq_numwqe = qp -> qp_sq_bufsz ; data -> mqp_sq_wqesz = ( 1 << qp -> qp_sq_log_wqesz ) ; data -> mqp_sq_headroomwqes = qp -> qp_sq_hdrmwqes ; data -> mqp_sdbr_mapoffset = 0 ; data -> mqp_sdbr_maplen = 0 ; data -> mqp_sdbr_offset = 0 ; return ( DDI_SUCCESS ) ; } 