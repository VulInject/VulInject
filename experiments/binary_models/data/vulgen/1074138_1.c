static inline struct mi_root * process_mi_params ( struct mi_root * cmd_tree , struct dlg_cell * * dlg_p ) { struct mi_node * node ; struct dlg_entry * d_entry ; struct dlg_cell * dlg ; str * callid ; str * from_tag ; unsigned int h_entry ; node = cmd_tree -> node . kids ; if ( node == NULL ) { * dlg_p = NULL ; return NULL ; } callid = & node -> value ; LM_DBG ( "callid='%.*s'\n" , callid -> len , callid -> s ) ; node = node -> next ; if ( ! node || ! node -> value . s || ! node -> value . len ) { from_tag = NULL ; } else { from_tag = & node -> value ; LM_DBG ( "from_tag='%.*s'\n" , from_tag -> len , from_tag -> s ) ; } h_entry = core_hash ( callid , 0 , d_table -> size ) ; d_entry = & ( d_table -> entries [ h_entry ] ) ; dlg_lock ( d_table , d_entry ) ; for ( dlg = d_entry -> first ; dlg ; dlg = dlg -> next ) { if ( match_downstream_dialog ( dlg , callid , from_tag ) == 1 ) { if ( dlg -> state == DLG_STATE_DELETED ) { * dlg_p = NULL ; break ; } else { * dlg_p = dlg ; dlg_unlock ( d_table , d_entry ) ; return 0 ; } } } dlg_unlock ( d_table , d_entry ) ; return init_mi_tree ( 404 , MI_SSTR ( "Nu such dialog" ) ) ; } 