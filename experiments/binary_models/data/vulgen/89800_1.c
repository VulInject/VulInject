static int mei_hbm_prop_req ( struct mei_device * dev , unsigned long start_idx ) { struct mei_msg_hdr mei_hdr ; struct hbm_props_request req ; unsigned long addr ; int ret ; addr = find_next_bit ( dev -> me_clients_map , MEI_CLIENTS_MAX , start_idx ) ; if ( addr == MEI_CLIENTS_MAX ) { dev -> hbm_state = MEI_HBM_STARTED ; mei_host_client_init ( dev ) ; return 0 ; } mei_hbm_hdr ( & mei_hdr , sizeof ( req ) ) ; req . hbm_cmd = HOST_CLIENT_PROPERTIES_REQ_CMD ; req . me_addr = addr ; ret = mei_hbm_write_message ( dev , & mei_hdr , & req ) ; if ( ret ) { dev_err ( dev -> dev , "properties request write failed: ret = %d\n" , ret ) ; return ret ; } dev -> init_clients_timer = dev -> timeouts . client_init ; mei_schedule_stall_timer ( dev ) ; return 0 ; } 