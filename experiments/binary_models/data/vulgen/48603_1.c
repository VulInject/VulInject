static int syscon_reboot_probe ( struct platform_device * pdev ) { struct syscon_reboot_context * ctx ; struct device * dev = & pdev -> dev ; int err ; ctx = devm_kzalloc ( & pdev -> dev , sizeof ( * ctx ) , GFP_KERNEL ) ; if ( ! ctx ) { return - ENOMEM ; } if ( IS_ERR ( ctx -> map ) ) { return PTR_ERR ( ctx -> map ) ; } if ( of_property_read_u32 ( pdev -> dev . of_node , "offset" , & ctx -> offset ) ) { return - EINVAL ; } if ( of_property_read_u32 ( pdev -> dev . of_node , "mask" , & ctx -> mask ) ) { return - EINVAL ; } ctx -> restart_handler . notifier_call = syscon_restart_handle ; ctx -> restart_handler . priority = 192 ; err = register_restart_handler ( & ctx -> restart_handler ) ; if ( err ) { dev_err ( dev , "can't register restart notifier (err=%d)\n" , err ) ; } return err ; } static const struct of_device_id syscon_reboot_of_match [ ] { { . compatible = "syscon-reboot" } { } } ; ; 