static void xen_pv_realize ( PCIDevice * pci_dev , Error * * errp ) { XenPVDevice * d = XEN_PV_DEVICE ( pci_dev ) ; uint8_t * pci_conf ; if ( d -> device_id == 0xffff ) { error_setg ( errp , "Device ID invalid, it must always be supplied" ) ; return ; } pci_conf = pci_dev -> config ; pci_set_word ( pci_conf + PCI_VENDOR_ID , d -> vendor_id ) ; pci_set_word ( pci_conf + PCI_SUBSYSTEM_VENDOR_ID , d -> vendor_id ) ; pci_set_word ( pci_conf + PCI_DEVICE_ID , d -> device_id ) ; pci_set_word ( pci_conf + PCI_SUBSYSTEM_ID , d -> device_id ) ; pci_set_byte ( pci_conf + PCI_REVISION_ID , d -> revision ) ; pci_set_word ( pci_conf + PCI_COMMAND , PCI_COMMAND_MEMORY ) ; pci_config_set_prog_interface ( pci_conf , 0 ) ; pci_conf [ PCI_INTERRUPT_PIN ] = 1 ; memory_region_init_io ( & d -> mmio , NULL , & xen_pv_mmio_ops , d , "mmio" , d -> size ) ; } 