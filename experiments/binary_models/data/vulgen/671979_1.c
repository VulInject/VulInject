static BUF * checkin_diff_file ( struct checkin_params * pb ) { char * path1 , * path2 ; BUF * b1 , * b2 , * b3 ; b1 = b2 = b3 = NULL ; path1 = path2 = NULL ; if ( ( b1 = buf_load ( pb -> filename ) ) == NULL ) { warnx ( "failed to load file: `%s'" , pb -> filename ) ; out } if ( ( b2 = rcs_getrev ( pb -> file , pb -> frev ) ) == NULL ) { warnx ( "failed to load revision" ) ; out } b2 = rcs_kwexp_buf ( b2 , pb -> file , pb -> frev ) ; b3 = buf_alloc ( 128 ) ; ( void ) xasprintf ( & path1 , "%s/diff1.XXXXXXXXXX" , rcs_tmpdir ) ; buf_write_stmp ( b1 , path1 ) ; buf_free ( b1 ) ; b1 = NULL ; ( void ) xasprintf ( & path2 , "%s/diff2.XXXXXXXXXX" , rcs_tmpdir ) ; buf_write_stmp ( b2 , path2 ) ; buf_free ( b2 ) ; b2 = NULL ; diff_format = D_RCSDIFF ; if ( diffreg ( path1 , path2 , b3 , D_FORCEASCII ) == D_ERROR ) { out } return ( b3 ) ; out buf_free ( b1 ) ; buf_free ( b2 ) ; free ( path1 ) ; free ( path2 ) ; return ( NULL ) ; } 