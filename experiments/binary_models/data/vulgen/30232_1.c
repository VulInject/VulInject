ATOMIC_AND ( , ) ATOMIC_AND ( 64 , ) type atomic_inc_ # # name # # _nv ( ) { type rc VERIFY3S ( pthread_mutex_lock ( & atomic_lock ) , == , 0 ) rc = ( ++ ( * target ) ) VERIFY3S ( pthread_mutex_unlock ( & atomic_lock ) , == , 0 ) return ( rc ) ; } ; ATOMIC_INC_NV ( , ) ATOMIC_INC_NV ( 8 , ) ATOMIC_INC_NV ( , ) ATOMIC_INC_NV ( 16 , ) ATOMIC_INC_NV ( , ) ATOMIC_INC_NV ( 32 , ) ATOMIC_INC_NV ( , ) ATOMIC_INC_NV ( , ) ATOMIC_INC_NV ( 64 , ) type atomic_dec_ # # name # # _nv ( ) { type rc VERIFY3S ( pthread_mutex_lock ( & atomic_lock ) , == , 0 ) rc = ( -- ( * target ) ) VERIFY3S ( pthread_mutex_unlock ( & atomic_lock ) , == , 0 ) return ( rc ) ; } ; ATOMIC_DEC_NV ( , ) ATOMIC_DEC_NV ( 8 , ) ATOMIC_DEC_NV ( , ) ATOMIC_DEC_NV ( 16 , ) ATOMIC_DEC_NV ( , ) ATOMIC_DEC_NV ( 32 , ) ATOMIC_DEC_NV ( , ) ATOMIC_DEC_NV ( , ) ATOMIC_DEC_NV ( 64 , ) type1 atomic_add_ # # name # # _nv ( , ) { type1 rc VERIFY3S ( pthread_mutex_lock ( & atomic_lock ) , == , 0 ) rc = ( * target += bits ) VERIFY3S ( pthread_mutex_unlock ( & atomic_lock ) , == , 0 ) return ( rc ) ; } ; ATOMIC_ADD_NV ( 8 , , ) ATOMIC_ADD_NV ( , , ) ATOMIC_ADD_NV ( 16 , , ) ATOMIC_ADD_NV ( , , ) ATOMIC_ADD_NV ( 32 , , ) ATOMIC_ADD_NV ( , , ) ATOMIC_ADD_NV ( , , ) ATOMIC_ADD_NV ( 64 , , ) void * atomic_add_ptr_nv ( volatile void * target , ssize_t bits ) { void * ptr ; VERIFY3S ( pthread_mutex_lock ( & atomic_lock ) , == , 0 ) ; ptr = ( * ( caddr_t * ) target += bits ) ; return ( ptr ) ; } 