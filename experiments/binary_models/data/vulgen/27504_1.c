static int pkey_gost01_paramgen ( EVP_PKEY_CTX * ctx , EVP_PKEY * pkey ) { struct gost_pmeth_data * data = EVP_PKEY_CTX_get_data ( ctx ) ; EC_GROUP * group = NULL ; GOST_KEY * gost = NULL ; int ret = 0 ; if ( data -> sign_param_nid == NID_undef || data -> digest_nid == NID_undef ) { GOSTerror ( GOST_R_NO_PARAMETERS_SET ) ; return 0 ; } group = EC_GROUP_new_by_curve_name ( data -> sign_param_nid ) ; if ( group == NULL ) { done } EC_GROUP_set_asn1_flag ( group , OPENSSL_EC_NAMED_CURVE ) ; gost = GOST_KEY_new ( ) ; if ( gost == NULL ) { done } if ( GOST_KEY_set_digest ( gost , data -> digest_nid ) == 0 ) { done } if ( GOST_KEY_set_group ( gost , group ) != 0 ) { ret = EVP_PKEY_assign_GOST ( pkey , gost ) ; } done EC_GROUP_free ( group ) ; return ret ; } 