int coda_fsync ( struct file * coda_file , loff_t start , loff_t end , int datasync ) { struct file * host_file ; struct inode * coda_inode = file_inode ( coda_file ) ; struct coda_file_info * cfi ; int err ; err = filemap_write_and_wait_range ( coda_inode -> i_mapping , start , end ) ; if ( err ) { return err ; } inode_lock ( coda_inode ) ; cfi = coda_ftoc ( coda_file ) ; host_file = cfi -> cfi_container ; err = vfs_fsync ( host_file , datasync ) ; if ( ! err && ! datasync ) { err = venus_fsync ( coda_inode -> i_sb , coda_i2f ( coda_inode ) ) ; } inode_unlock ( coda_inode ) ; return err ; } const struct file_operations coda_file_operations = { . llseek = generic_file_llseek . read_iter = coda_file_read_iter . write_iter = coda_file_write_iter . mmap = coda_file_mmap . open = coda_open . release = coda_release . fsync = coda_fsync . splice_read = generic_file_splice_read } ; 