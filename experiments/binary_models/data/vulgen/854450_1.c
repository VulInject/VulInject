static void aes128k128d ( u8 * key , u8 * data , u8 * ciphertext ) { int round ; int i ; u8 intermediatea [ 16 ] ; u8 intermediateb [ 16 ] ; u8 round_key [ 16 ] ; for ( i = 0 ; i < 16 ; i ++ ) { round_key [ i ] = key [ i ] ; } for ( round = 0 ; round < 11 ; round ++ ) { if ( round == 0 ) { xor_128 ( round_key , data , ciphertext ) ; next_key ( round_key , round ) ; } if ( round == 10 ) { byte_sub ( ciphertext , intermediatea ) ; shift_row ( intermediatea , intermediateb ) ; } else { byte_sub ( ciphertext , intermediatea ) ; shift_row ( intermediatea , intermediateb ) ; mix_column ( & intermediateb [ 0 ] , & intermediatea [ 0 ] ) ; mix_column ( & intermediateb [ 4 ] , & intermediatea [ 4 ] ) ; mix_column ( & intermediateb [ 8 ] , & intermediatea [ 8 ] ) ; mix_column ( & intermediateb [ 12 ] , & intermediatea [ 12 ] ) ; xor_128 ( intermediatea , round_key , ciphertext ) ; next_key ( round_key , round ) ; } } } 