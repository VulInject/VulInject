void iwl_pcie_apm_stop_master ( struct iwl_trans * trans ) { int ret ; if ( trans -> trans_cfg -> device_family >= IWL_DEVICE_FAMILY_BZ ) { ret = iwl_poll_bit ( trans , CSR_GP_CNTRL , CSR_GP_CNTRL_REG_FLAG_BUS_MASTER_DISABLE_STATUS , CSR_GP_CNTRL_REG_FLAG_BUS_MASTER_DISABLE_STATUS , 100 ) ; msleep ( 100 ) ; } else { iwl_set_bit ( trans , CSR_RESET , CSR_RESET_REG_FLAG_STOP_MASTER ) ; ret = iwl_poll_bit ( trans , CSR_RESET , CSR_RESET_REG_FLAG_MASTER_DISABLED , CSR_RESET_REG_FLAG_MASTER_DISABLED , 100 ) ; } if ( ret < 0 ) { IWL_WARN ( trans , "Master Disable Timed Out, 100 usec\n" ) ; } IWL_DEBUG_INFO ( trans , "stop master\n" ) ; } 