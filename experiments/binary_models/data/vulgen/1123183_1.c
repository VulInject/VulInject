void __ieee80211_schedule_txq ( struct ieee80211_hw * hw , struct ieee80211_txq * txq , bool force ) { struct ieee80211_local * local = hw_to_local ( hw ) ; struct txq_info * txqi = to_txq_info ( txq ) ; bool has_queue ; spin_lock_bh ( & local -> active_txq_lock [ txq -> ac ] ) ; has_queue = force || txq_has_queue ( txq ) ; if ( list_empty ( & txqi -> schedule_order ) && ( has_queue || ieee80211_txq_keep_active ( txqi ) ) ) { if ( txqi -> txq . sta && local -> airtime_flags && has_queue && wiphy_ext_feature_isset ( local -> hw . wiphy , NL80211_EXT_FEATURE_AIRTIME_FAIRNESS ) ) { list_add ( & txqi -> schedule_order , & local -> active_txqs [ txq -> ac ] ) ; } else { list_add_tail ( & txqi -> schedule_order , & local -> active_txqs [ txq -> ac ] ) ; } } spin_unlock_bh ( & local -> active_txq_lock [ txq -> ac ] ) ; } 