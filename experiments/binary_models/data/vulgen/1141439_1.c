static void update_rw_regs ( struct qcom_nand_host * host , int num_cw , bool read ) { struct nand_chip * chip = & host -> chip ; struct qcom_nand_controller * nandc = get_qcom_nand_controller ( chip ) ; u32 cmd , cfg0 , cfg1 , ecc_bch_cfg ; if ( read ) { if ( host -> use_ecc ) { cmd = PAGE_READ_WITH_ECC | PAGE_ACC | LAST_PAGE ; } else { cmd = PAGE_READ | PAGE_ACC | LAST_PAGE ; } } else { cmd = PROGRAM_PAGE | PAGE_ACC | LAST_PAGE ; } if ( host -> use_ecc ) { cfg0 = ( host -> cfg0 & ~ ( 7U << CW_PER_PAGE ) ) | ( num_cw - 1 ) << CW_PER_PAGE ; cfg1 = host -> cfg1 ; ecc_bch_cfg = host -> ecc_bch_cfg ; } else { cfg0 = ( host -> cfg0_raw & ~ ( 7U << CW_PER_PAGE ) ) | ( num_cw - 1 ) << CW_PER_PAGE ; cfg1 = host -> cfg1_raw ; } nandc_set_reg ( nandc , NAND_FLASH_CMD , cmd ) ; nandc_set_reg ( nandc , NAND_DEV0_CFG0 , cfg0 ) ; nandc_set_reg ( nandc , NAND_DEV0_CFG1 , cfg1 ) ; nandc_set_reg ( nandc , NAND_DEV0_ECC_CFG , ecc_bch_cfg ) ; nandc_set_reg ( nandc , NAND_EBI2_ECC_BUF_CFG , host -> ecc_buf_cfg ) ; nandc_set_reg ( nandc , NAND_FLASH_STATUS , host -> clrflashstatus ) ; nandc_set_reg ( nandc , NAND_READ_STATUS , host -> clrreadstatus ) ; nandc_set_reg ( nandc , NAND_EXEC_CMD , 1 ) ; } 