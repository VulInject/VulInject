static DWORD wf_verify_changed_certificate_ex ( freerdp * instance , const char * host , UINT16 port , const char * common_name , const char * subject , const char * issuer , const char * new_fingerprint , const char * old_subject , const char * old_issuer , const char * old_fingerprint , DWORD flags ) { WCHAR * buffer ; WCHAR * caption ; int what = IDCANCEL ; buffer = wf_format_text ( L"New Certificate details:\n" L"\tCommonName: %S\n" L"\tSubject: %S\n" L"\tIssuer: %S\n" L"\tThumbprint: %S\n" L"\tHostMismatch: %S\n" L"\n" L"Old Certificate details:\n" L"\tSubject: %S\n" L"\tIssuer: %S\n" L"\tThumbprint: %S" L"The above X.509 certificate could not be verified, possibly because you do not have " L"the CA certificate in your certificate store, or the certificate has expired. " L"Please look at the OpenSSL documentation on how to add a private CA to the store.\n" L"\n" L"YES\tAccept permanently\n" L"NO\tAccept for this session only\n" L"CANCEL\tAbort connection\n" , common_name , subject , issuer , new_fingerprint , flags & VERIFY_CERT_FLAG_MISMATCH ?"Yes" : "No" , old_subject , old_issuer , old_fingerprint ) ; caption = wf_format_text ( L"Verify certificate change for %S:%hu" , host , port ) ; WINPR_UNUSED ( instance ) ; if ( ! buffer || ! caption ) { fail } what = MessageBoxW ( NULL , buffer , caption , MB_YESNOCANCEL ) ; fail free ( buffer ) ; switch ( what ) { case IDYES : return 1 ; case IDNO : return 2 ; default : return 0 ; } } 