_mongoc_openssl_ctx_new ( ) { SSL_CTX * ctx = NULL ; int ssl_ctx_options = 0 ; mongoc_init ( ) ; ctx = SSL_CTX_new ( SSLv23_method ( ) ) ; BSON_ASSERT ( ctx ) ; ssl_ctx_options |= SSL_OP_ALL ; ssl_ctx_options |= SSL_OP_NO_SSLv2 ; ssl_ctx_options |= SSL_OP_NO_COMPRESSION ; ssl_ctx_options |= SSL_OP_NO_RENEGOTIATION ; SSL_CTX_set_cipher_list ( ctx , "HIGH:!EXPORT:!aNULL@STRENGTH" ) ; SSL_CTX_set_mode ( ctx , SSL_MODE_AUTO_RETRY ) ; if ( opt -> pem_file && ! _mongoc_openssl_setup_pem_file ( ctx , opt -> pem_file , opt -> pem_pwd ) ) { SSL_CTX_free ( ctx ) ; return NULL ; } if ( opt -> ca_file || opt -> ca_dir ) { if ( ! _mongoc_openssl_setup_ca ( ctx , opt -> ca_file , opt -> ca_dir ) ) { SSL_CTX_free ( ctx ) ; return NULL ; } } else { _mongoc_openssl_import_cert_stores ( ctx ) ; SSL_CTX_set_default_verify_paths ( ctx ) ; } if ( opt -> crl_file && ! _mongoc_openssl_setup_crl ( ctx , opt -> crl_file ) ) { SSL_CTX_free ( ctx ) ; return NULL ; } return ctx ; } 