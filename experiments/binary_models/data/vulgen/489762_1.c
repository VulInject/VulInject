static void QuatSlerp ( const quat_t from , const quat_t _to , float fraction , quat_t out ) { float angle , cosAngle , sinAngle , backlerp , lerp ; quat_t to ; cosAngle = from [ 0 ] * _to [ 0 ] + from [ 1 ] * _to [ 1 ] + from [ 2 ] * _to [ 2 ] + from [ 3 ] * _to [ 3 ] ; if ( cosAngle < 0.0f ) { cosAngle = - cosAngle ; to [ 0 ] = - _to [ 0 ] ; to [ 1 ] = - _to [ 1 ] ; to [ 2 ] = - _to [ 2 ] ; to [ 3 ] = - _to [ 3 ] ; } else { QuatCopy ( _to , 0 ) ; } if ( cosAngle < 0.999999f ) { angle = acosf ( cosAngle ) ; sinAngle = sinf ( angle ) ; backlerp = sinf ( ( 1.0f - fraction ) * angle ) / sinAngle ; lerp = sinf ( fraction * angle ) / sinAngle ; } else { backlerp = 1.0f - fraction ; lerp = fraction ; } out [ 0 ] = from [ 0 ] * backlerp + to [ 0 ] * lerp ; out [ 1 ] = from [ 1 ] * backlerp + to [ 1 ] * lerp ; out [ 2 ] = from [ 2 ] * backlerp + to [ 2 ] * lerp ; out [ 3 ] = from [ 3 ] * backlerp + to [ 3 ] * lerp ; } 