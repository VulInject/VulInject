* Written by Stuart Gill and Behdad Esfahbod . * * This file is part of the FreeType project , and may only be used , * modified , and distributed under the terms of the FreeType project * license , LICENSE . TXT . By continuing to use , modify , or distribute * this file you indicate that you have read the license and * understand and accept it fully . * * / defined ( ) static unsigned int multiply_alpha ( , ) { unsigned int temp = alpha * color + 0x80 return ( temp + ( temp >> 8 ) ) >> 8 ; } ; static void premultiply_data ( png_structp png , png_row_infop row_info , png_bytep data ) { unsigned int i = 0 , limit ; ( ( defined ( __GNUC__ ) && ( ( __GNUC__ >= 5 ) || ( ( __GNUC__ == 4 ) && ( __GNUC_MINOR__ >= 7 ) ) ) ) || ( defined ( __clang__ ) && ( ( __clang_major__ >= 4 ) || ( ( __clang_major__ == 3 ) && ( __clang_minor__ >= 2 ) ) ) ) ) && defined ( __OPTIMIZE__ ) && defined ( __SSE__ ) && __BYTE_ORDER__ == __ORDER_LITTLE_ENDIAN__ ; unsigned short v82 __attribute__ vector_size if ( row_info -> rowbytes > 15 ) { limit = row_info -> rowbytes - 16 + 1 ; for ( ; i < limit ; i += 16 ) { unsigned char * base = & data [ i ] ; v82 s , s0 , s1 , a ; v82 n0x80 = { 0x80 0x80 0x80 0x80 0x80 0x80 0x80 0x80 } ; v82 n0xFF = { 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF } ; v82 n8 = { 8 8 8 8 8 8 8 8 } ; v82 ma = { 1 1 3 3 5 5 7 7 } ; v82 o1 = { 0 0xFF 0 0xFF 0 0xFF 0 0xFF } ; v82 m0 = { 1 0 3 2 5 4 7 6 } ; ft_memcpy ( & s , base , 16 ) ; s0 = s & n0xFF ; s1 = s >> n8 ; a = vector_shuffle ( s1 , ma ) ; s1 |= o1 ; s0 = vector_shuffle ( s0 , m0 ) ; s0 *= a ; s1 *= a ; s0 += n0x80 ; s1 += n0x80 ; s0 = ( s0 + ( s0 >> n8 ) ) >> n8 ; s1 = ( s1 + ( s1 >> n8 ) ) >> n8 ; s = s0 | ( s1 << n8 ) ; ft_memcpy ( base , & s , 16 ) ; } } FT_UNUSED ( png ) ; limit = row_info -> rowbytes ; for ( ; i < limit ; i += 4 ) { unsigned char * base = & data [ i ] ; unsigned int alpha = base [ 3 ] ; if ( alpha == 0 ) { base [ 0 ] = base [ 1 ] = base [ 2 ] = base [ 3 ] = 0 ; } else { unsigned int red = base [ 0 ] ; unsigned int green = base [ 1 ] ; unsigned int blue = base [ 2 ] ; base [ 0 ] = ( unsigned char ) blue ; base [ 1 ] = ( unsigned char ) green ; base [ 2 ] = ( unsigned char ) red ; base [ 3 ] = ( unsigned char ) alpha ; } } } static void convert_bytes_to_data ( png_structp png , png_row_infop row_info , png_bytep data ) { unsigned int i ; FT_UNUSED ( png ) ; for ( i = 0 ; i < row_info -> rowbytes ; i += 4 ) { unsigned char * base = & data [ i ] ; unsigned int red = base [ 0 ] ; unsigned int green = base [ 1 ] ; } } 