static int bus_link_method_set_dns_servers_internal ( sd_bus_message * message , void * userdata , sd_bus_error * error , bool extended ) { struct in_addr_full * * dns ; Link * l = ASSERT_PTR ( userdata ) ; size_t n ; int r ; assert ( message ) ; r = verify_managed_link ( l , error ) ; if ( r < 0 ) { return r ; } r = bus_message_read_dns_servers ( message , error , extended , & dns , & n ) ; if ( r < 0 ) { return r ; } r = bus_verify_polkit_async ( message , CAP_NET_ADMIN , "org.freedesktop.network1.set-dns-servers" , NULL , true , UID_INVALID , & l -> manager -> polkit_registry , error ) ; if ( r < 0 ) { finalize } if ( r == 0 ) { r = 1 ; finalize } if ( l -> n_dns != UINT_MAX ) { for ( unsigned i = 0 ; i < l -> n_dns ; i ++ ) { in_addr_full_free ( l -> dns [ i ] ) ; } } free_and_replace ( l -> dns , dns ) ; l -> n_dns = n ; link_dirty ( l ) ; r = link_save_and_clean ( l ) ; if ( r < 0 ) { return r ; } return sd_bus_reply_method_return ( message , NULL ) ; finalize for ( size_t i = 0 ; i < n ; i ++ ) { in_addr_full_free ( dns [ i ] ) ; } return r ; } 