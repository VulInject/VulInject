render_glyphs_via_mask ( , , , , , , ) { cairo_surface_t * mask ; cairo_status_t status ; cairo_bool_t has_component_alpha ; TRACE ( ( stderr , "%s\n" , __FUNCTION__ ) ) ; mask = cairo_gl_surface_create ( dst -> base . device , CAIRO_CONTENT_COLOR_ALPHA , info -> extents . width , info -> extents . height ) ; if ( unlikely ( mask -> status ) ) { return mask -> status ; } status = render_glyphs ( ( cairo_gl_surface_t * ) mask , info -> extents . x , info -> extents . y , CAIRO_OPERATOR_ADD , NULL , info , & has_component_alpha , NULL ) ; if ( likely ( status == CAIRO_STATUS_SUCCESS ) ) { cairo_surface_pattern_t mask_pattern ; cairo_surface_pattern_t source_pattern ; cairo_rectangle_int_t clip_extents ; mask -> is_clear = FALSE ; _cairo_pattern_init_for_surface ( & mask_pattern , mask ) ; mask_pattern . base . has_component_alpha = has_component_alpha ; mask_pattern . base . filter = CAIRO_FILTER_NEAREST ; mask_pattern . base . extend = CAIRO_EXTEND_NONE ; cairo_matrix_init_translate ( & mask_pattern . base . matrix , dst_x - info -> extents . x , dst_y - info -> extents . y ) ; cairo_matrix_init_translate ( & source_pattern . base . matrix , dst_x - info -> extents . x , dst_y - info -> extents . y ) ; clip = _cairo_clip_copy ( clip ) ; clip_extents . x = info -> extents . x - dst_x ; clip_extents . y = info -> extents . y - dst_y ; clip_extents . width = info -> extents . width ; clip_extents . height = info -> extents . height ; clip = _cairo_clip_intersect_rectangle ( clip , & clip_extents ) ; status = _cairo_surface_mask ( & dst -> base , op , & source_pattern . base , & mask_pattern . base , clip ) ; _cairo_clip_destroy ( clip ) ; _cairo_pattern_fini ( & mask_pattern . base ) ; _cairo_pattern_fini ( & source_pattern . base ) ; } cairo_surface_destroy ( mask ) ; return status ; } 