static ssize_t qlcnic_sysfs_write_pm_config ( struct file * filp , struct kobject * kobj , struct bin_attribute * attr , char * buf , loff_t offset , size_t size ) { struct device * dev = kobj_to_dev ( kobj ) ; struct qlcnic_adapter * adapter = dev_get_drvdata ( dev ) ; struct qlcnic_pm_func_cfg * pm_cfg ; u32 id , action , pci_func ; int count , rem , i , ret , index ; count = size / sizeof ( qlcnic_pm_func_cfg ) ; rem = size % sizeof ( qlcnic_pm_func_cfg ) ; qlcnic_swap32_buffer ( ( u32 * ) buf , size / sizeof ( u32 ) ) ; pm_cfg = ( qlcnic_pm_func_cfg * ) buf ; ret = validate_pm_config ( adapter , pm_cfg , count ) ; if ( ret ) { return ret ; } for ( i = 0 ; i < count ; i ++ ) { pci_func = pm_cfg [ i ] . pci_func ; action = ! ! pm_cfg [ i ] . action ; index = qlcnic_is_valid_nic_func ( adapter , pci_func ) ; if ( index < 0 ) { return - EINVAL ; } id = adapter -> npars [ index ] . phy_port ; ret = qlcnic_config_port_mirroring ( adapter , id , action , pci_func ) ; if ( ret ) { return ret ; } } for ( i = 0 ; i < count ; i ++ ) { pci_func = pm_cfg [ i ] . pci_func ; index = qlcnic_is_valid_nic_func ( adapter , pci_func ) ; if ( index < 0 ) { return - EINVAL ; } id = adapter -> npars [ index ] . phy_port ; adapter -> npars [ index ] . enable_pm = ! ! pm_cfg [ i ] . action ; adapter -> npars [ index ] . dest_npar = id ; } return size ; } 