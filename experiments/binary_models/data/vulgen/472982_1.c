char * cpu_set_to_range_string ( const CPUSet * set ) { unsigned range_start = 0 , range_end ; _cleanup_free_ char * str = NULL ; bool in_range = false ; size_t len = 0 ; int r ; for ( unsigned i = 0 ; i < set -> allocated * 8 ; i ++ ) { if ( CPU_ISSET_S ( i , set -> allocated , set -> set ) ) { if ( in_range ) { range_end ++ ; } else { range_start = range_end = i ; in_range = true ; } } if ( in_range ) { in_range = false ; if ( ! GREEDY_REALLOC ( str , len + 2 + 2 * DECIMAL_STR_MAX ( unsigned ) ) ) { return NULL ; } if ( range_end > range_start ) { r = sprintf ( str + len , len > 0 ?" %u-%u" : "%u-%u" , range_start , range_end ) ; } else { r = sprintf ( str + len , len > 0 ?" %u" : "%u" , range_start ) ; } assert_se ( r > 0 ) ; len += r ; } } if ( in_range ) { if ( ! GREEDY_REALLOC ( str , len + 2 + 2 * DECIMAL_STR_MAX ( int ) ) ) { return NULL ; } else { r = sprintf ( str + len , len > 0 ?" %u" : "%u" , range_start ) ; } assert_se ( r > 0 ) ; } return TAKE_PTR ( str ) ?: strdup ( "" ) ; } 