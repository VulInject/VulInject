int port_exists_by_type_addr_port ( int listener_type , const tor_addr_t * addr , int port , int check_wildcard ) { SMARTLIST_FOREACH_BEGIN ( , , ) { if ( cfg -> type == listener_type ) { if ( cfg -> port == port || ( check_wildcard && port == - 1 ) ) { if ( tor_addr_eq ( & cfg -> addr , addr ) ) { return 1 ; } if ( ! check_wildcard ) { continue ; } const int cfg_v4 = port_binds_ipv4 ( cfg ) ; const int cfg_any_v4 = tor_addr_is_null ( & cfg -> addr ) && cfg_v4 ; const int addr_v4 = tor_addr_family ( addr ) == AF_INET || tor_addr_family ( addr ) == AF_UNSPEC ; const int addr_any_v4 = tor_addr_is_null ( & cfg -> addr ) && addr_v4 ; if ( ( cfg_any_v4 && addr_v4 ) || ( cfg_v4 && addr_any_v4 ) ) { return 1 ; } const int cfg_v6 = port_binds_ipv6 ( cfg ) ; const int cfg_any_v6 = tor_addr_is_null ( & cfg -> addr ) && cfg_v6 ; const int addr_v6 = tor_addr_family ( addr ) == AF_INET6 || tor_addr_family ( addr ) == AF_UNSPEC ; const int addr_any_v6 = tor_addr_is_null ( & cfg -> addr ) && addr_v6 ; if ( ( cfg_any_v6 && addr_v6 ) || ( cfg_v6 && addr_any_v6 ) ) { return 1 ; } } } } SMARTLIST_FOREACH_END ( cfg ) ; return 0 ; } 