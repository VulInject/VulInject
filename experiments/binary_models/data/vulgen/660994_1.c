static void change_userns ( struct __test_metadata * _metadata , int syncfds [ 2 ] ) { int ret ; close_prot_errno_disarm ( syncfds [ 1 ] ) ; ret = unshare ( CLONE_NEWUSER ) ; ASSERT_EQ ( , 0 ) { TH_LOG ( "%s - Failed to unshare user namespace" , strerror ( errno ) ) ; } ret = write_nointr ( syncfds [ 0 ] , "1" , 1 ) ; ASSERT_EQ ( , 1 ) { TH_LOG ( "write_nointr() failed" ) ; } ret = read_nointr ( syncfds [ 0 ] , & buf , 1 ) ; ASSERT_EQ ( , 1 ) { TH_LOG ( "read_nointr() failed" ) ; } close_prot_errno_disarm ( syncfds [ 0 ] ) ; ASSERT_EQ ( , 0 ) { TH_LOG ( "setid_userns_root() failed" ) ; } } 