void efx_siena_fini_tx_queue ( struct efx_tx_queue * tx_queue ) { struct efx_tx_buffer * buffer ; netif_dbg ( tx_queue -> efx , drv , tx_queue -> efx -> net_dev , "shutting down TX queue %d\n" , tx_queue -> queue ) ; while ( tx_queue -> read_count != tx_queue -> write_count ) { unsigned int pkts_compl = 0 , bytes_compl = 0 ; buffer = & tx_queue -> buffer [ tx_queue -> read_count & tx_queue -> ptr_mask ] ; efx_dequeue_buffer ( tx_queue , buffer , & pkts_compl , & bytes_compl ) ; ++ tx_queue -> read_count ; } tx_queue -> xmit_pending = false ; netdev_tx_reset_queue ( tx_queue -> core_txq ) ; } 