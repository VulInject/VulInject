char * lost_held_post_request ( int * lgth , long rtime , char * type ) { int buffersize = 0 ; char buf [ BUFSIZE ] ; char * doc = NULL ; xmlChar * xmlbuff = NULL ; xmlDocPtr request = NULL ; xmlNodePtr ptrLocationRequest = NULL ; xmlNodePtr ptrLocationType = NULL ; xmlKeepBlanksDefault ( 1 ) ; * lgth = 0 ; request = xmlNewDoc ( BAD_CAST "1.0" ) ; if ( request == NULL ) { LM_ERR ( "locationRequest xmlNewDoc() failed\n" ) ; return doc ; } ptrLocationRequest = xmlNewNode ( NULL , BAD_CAST "locationRequest" ) ; if ( ptrLocationRequest == NULL ) { LM_ERR ( "locationRequest xmlNewNode() failed\n" ) ; return doc ; } xmlDocSetRootElement ( request , ptrLocationRequest ) ; xmlNewProp ( ptrLocationRequest , BAD_CAST "xmlns" , BAD_CAST "urn:ietf:params:xml:ns:geopriv:held" ) ; if ( rtime > 0 ) { snprintf ( buf , BUFSIZE , "%ld" , rtime ) ; xmlNewProp ( , , ) } if ( rtime == - 1 ) { xmlNewProp ( , , ) } else { xmlNewProp ( , , ) } ptrLocationType = xmlNewChild ( , , "locationType" , "geodetic civic" ) ; xmlNewProp ( ptrLocationType , BAD_CAST "exact" , BAD_CAST "false" ) ; xmlDocDumpFormatMemory ( request , & xmlbuff , & buffersize , 0 ) ; if ( xmlbuff == NULL ) { LM_ERR ( "locationRequest xmlDocDumpFormatMemory() failed\n" ) ; xmlFreeDoc ( request ) ; return doc ; } doc = ( char * ) pkg_malloc ( ( buffersize + 1 ) * sizeof ( char ) ) ; if ( doc == NULL ) { PKG_MEM_ERROR ; xmlFree ( xmlbuff ) ; xmlFreeDoc ( request ) ; return doc ; } memset ( doc , 0 , buffersize ) ; memcpy ( doc , ( char * ) xmlbuff , buffersize ) ; doc [ buffersize ] = '\0' ; * lgth = strlen ( doc ) ; xmlFree ( xmlbuff ) ; xmlFreeDoc ( request ) ; return doc ; } 