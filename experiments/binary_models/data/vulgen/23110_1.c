int omap_gem_mmap_obj ( struct drm_gem_object * obj , struct vm_area_struct * vma ) { struct omap_gem_object * omap_obj = to_omap_bo ( obj ) ; vm_flags_mod ( vma , VM_MIXEDMAP , VM_PFNMAP ) ; if ( omap_obj -> flags & OMAP_BO_WC ) { vma -> vm_page_prot = pgprot_writecombine ( vm_get_page_prot ( vma -> vm_flags ) ) ; } if ( omap_obj -> flags & OMAP_BO_UNCACHED ) { vma -> vm_page_prot = pgprot_noncached ( vm_get_page_prot ( vma -> vm_flags ) ) ; } else { vma -> vm_pgoff = 0 ; vma_set_file ( vma , obj -> filp ) ; vma -> vm_page_prot = vm_get_page_prot ( vma -> vm_flags ) ; } return 0 ; } 