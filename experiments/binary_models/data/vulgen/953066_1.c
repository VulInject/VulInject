void ena_cleanup_rxq ( ena_rxq_t * rxq ) { int ret = 0 ; ena_t * ena = rxq -> er_ena ; if ( ( rxq -> er_state & ENA_RXQ_STATE_SQ_CREATED ) != 0 ) { ret = ena_destroy_sq ( ena , rxq -> er_sq_hw_idx , B_FALSE ) ; if ( ret != 0 ) { ena_err ( ena , "failed to destroy Rx SQ %u: %d" , rxq -> er_rxqs_idx , ret ) ; } rxq -> er_sq_hw_idx = 0 ; rxq -> er_sq_db_addr = NULL ; rxq -> er_sq_tail_idx = 0 ; rxq -> er_sq_phase = 0 ; rxq -> er_state &= ~ ENA_RXQ_STATE_SQ_CREATED ; } if ( ( rxq -> er_state & ENA_RXQ_STATE_CQ_CREATED ) != 0 ) { ret = ena_destroy_cq ( ena , rxq -> er_cq_hw_idx ) ; if ( ret != 0 ) { ena_err ( ena , "failed to destroy Rx CQ %u: %d" , rxq -> er_rxqs_idx , ret ) ; } rxq -> er_cq_hw_idx = 0 ; rxq -> er_cq_head_idx = 0 ; rxq -> er_cq_phase = 0 ; rxq -> er_cq_head_db_addr = NULL ; rxq -> er_cq_unmask_addr = NULL ; rxq -> er_cq_numa_addr = NULL ; rxq -> er_state &= ~ ENA_RXQ_STATE_CQ_CREATED ; } ASSERT3S ( rxq -> er_state , == , ENA_RXQ_STATE_NONE ) ; } 