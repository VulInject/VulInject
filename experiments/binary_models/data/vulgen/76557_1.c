static void fdmotort ( void * arg ) { struct fcu_obj * fjp = ( fcu_obj * ) arg ; struct fdcntlr * fcp = fjp -> fj_fdc ; struct fdcsb * csb = & fcp -> c_csb ; int unit = fjp -> fj_unit & 3 ; int mval ; int newxstate = 0 ; mutex_enter ( & fcp -> c_dorlock ) ; mutex_exit ( & fcp -> c_dorlock ) ; if ( mval < 0 ) { return ; } mutex_enter ( & fcp -> c_lock ) ; if ( ( fcp -> c_flags & FCFLG_WAITING ) && fcp -> c_mtrstate [ unit ] == FMS_ON && ( csb -> csb_xstate == FXS_MTRON || csb -> csb_xstate == FXS_HDST || csb -> csb_xstate == FXS_DKCHGX ) ) { newxstate = fdc_statemach ( fcp ) ; if ( newxstate == - 1 ) { FCERRPRINT ( FDEP_L3 , FDEM_EXEC , ( CE_WARN , "fdc_motort unit %d: motor ready but bad xstate" , ( int ) fjp -> fj_unit ) ) ; fcp -> c_csb . csb_cmdstat = EIO ; } if ( newxstate == - 1 || newxstate == FXS_END ) { fcp -> c_flags ^= FCFLG_WAITING ; cv_signal ( & fcp -> c_iocv ) ; } } mutex_exit ( & fcp -> c_lock ) ; } 