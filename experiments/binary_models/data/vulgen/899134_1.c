if ( ! dirty_block_ptr [ i ] ) { fail } journal_ptr [ i ] -> buf = NULL ; journal_ptr [ i ] -> blknr = - 1 ; dirty_block_ptr [ i ] -> buf = NULL ; dirty_block_ptr [ i ] -> blknr = - 1 ; ( fs -> blksz == 4096 ) { temp = zalloc ( fs -> blksz ) if ( ! temp ) { fail } journal_ptr [ gindex ] -> buf = zalloc ( fs -> blksz ) } ; if ( ! journal_ptr [ gindex ] -> buf ) { fail } ext4fs_devread ( 0 , 0 , fs -> blksz , temp ) ; memcpy ( temp + SUPERBLOCK_SIZE , fs -> sb , SUPERBLOCK_SIZE ) ; memcpy ( journal_ptr [ gindex ] -> buf , temp , fs -> blksz ) ; journal_ptr [ gindex ++ ] -> blknr = 0 ; { journal_ptr [ gindex ] -> buf = zalloc ( fs -> blksz ) ; if ( ! journal_ptr [ gindex ] -> buf ) { fail } memcpy ( journal_ptr [ gindex ] -> buf , fs -> sb , SUPERBLOCK_SIZE ) ; journal_ptr [ gindex ++ ] -> blknr = 1 ; } if ( ext4fs_check_journal_state ( SCAN ) ) { fail } if ( ext4fs_check_journal_state ( RECOVER ) ) { fail } return 0 ; fail return - 1 ; 