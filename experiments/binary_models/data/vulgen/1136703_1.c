static void png_write_image_data ( AVCodecContext * avctx , const uint8_t * buf , int length ) { PNGEncContext * s = avctx -> priv_data ; const AVCRC * crc_table = av_crc_get_table ( AV_CRC_32_IEEE_LE ) ; if ( avctx -> codec_id == AV_CODEC_ID_PNG || avctx -> frame_num == 0 ) { png_write_chunk ( & s -> bytestream , MKTAG ( 'I' , 'D' , 'A' , 'T' ) , buf , length ) ; return ; } bytestream_put_be32 ( & s -> bytestream , length + 4 ) ; bytestream_put_be32 ( & s -> bytestream , MKBETAG ( 'f' , 'd' , 'A' , 'T' ) ) ; bytestream_put_be32 ( & s -> bytestream , s -> sequence_number ) ; crc = av_crc ( crc_table , crc , s -> bytestream - 8 , 8 ) ; crc = av_crc ( crc_table , crc , buf , length ) ; memcpy ( s -> bytestream , buf , length ) ; s -> bytestream += length ; bytestream_put_be32 ( & s -> bytestream , ~ crc ) ; ++ s -> sequence_number ; } 