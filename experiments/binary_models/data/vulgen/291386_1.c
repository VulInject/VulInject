static void gelic_sendbuf ( int msgsize ) { u16 * p ; u32 sum ; int i ; h_ip -> tot_len = msgsize + sizeof ( udphdr ) + sizeof ( iphdr ) ; h_udp -> len = msgsize + sizeof ( udphdr ) ; h_ip -> check = 0 ; sum = 0 ; p = ( u16 * ) h_ip ; for ( i = 0 ; i < 5 ; i ++ ) { sum += * p ++ ; } h_ip -> check = ~ ( sum + ( sum >> 16 ) ) ; dbg . descr . dmac_cmd_status = GELIC_DESCR_DMA_CMD_NO_CHKSUM | GELIC_DESCR_TX_DMA_FRAME_TAIL ; dbg . descr . result_size = 0 ; dbg . descr . data_status = 0 ; wmb ( ) ; lv1_net_start_tx_dma ( GELIC_BUS_ID , GELIC_DEVICE_ID , bus_addr , 0 ) ; while ( ( dbg . descr . dmac_cmd_status & GELIC_DESCR_DMA_STAT_MASK ) == GELIC_DESCR_DMA_CARDOWNED ) { cpu_relax ( ) ; } } 