static void h_func ( const unsigned char * in , unsigned char * out , const unsigned char * M , int k , int offset ) { int x ; unsigned char y [ 4 ] ; for ( x = 0 ; x < 4 ; x ++ ) { y [ x ] = in [ x ] ; } switch ( k ) { case 4 : y [ 0 ] = ( unsigned char ) ( sbox ( 1 , ( ulong32 ) y [ 0 ] ) ^ M [ 4 * ( 6 + offset ) + 0 ] ) ; y [ 1 ] = ( unsigned char ) ( sbox ( 0 , ( ulong32 ) y [ 1 ] ) ^ M [ 4 * ( 6 + offset ) + 1 ] ) ; y [ 2 ] = ( unsigned char ) ( sbox ( 0 , ( ulong32 ) y [ 2 ] ) ^ M [ 4 * ( 6 + offset ) + 2 ] ) ; case 3 : y [ 0 ] = ( unsigned char ) ( sbox ( 1 , ( ulong32 ) y [ 0 ] ) ^ M [ 4 * ( 4 + offset ) + 0 ] ) ; y [ 1 ] = ( unsigned char ) ( sbox ( 1 , ( ulong32 ) y [ 1 ] ) ^ M [ 4 * ( 4 + offset ) + 1 ] ) ; y [ 2 ] = ( unsigned char ) ( sbox ( 0 , ( ulong32 ) y [ 2 ] ) ^ M [ 4 * ( 4 + offset ) + 2 ] ) ; y [ 3 ] = ( unsigned char ) ( sbox ( 0 , ( ulong32 ) y [ 3 ] ) ^ M [ 4 * ( 4 + offset ) + 3 ] ) ; case 2 : y [ 0 ] = ( unsigned char ) ( sbox ( 1 , sbox ( 0 , sbox ( 0 , ( ulong32 ) y [ 0 ] ) ^ M [ 4 * ( 2 + offset ) + 0 ] ) ^ M [ 4 * ( 0 + offset ) + 0 ] ) ) ; y [ 1 ] = ( unsigned char ) ( sbox ( 0 , sbox ( 0 , sbox ( 1 , ( ulong32 ) y [ 1 ] ) ^ M [ 4 * ( 2 + offset ) + 1 ] ) ^ M [ 4 * ( 0 + offset ) + 1 ] ) ) ; y [ 2 ] = ( unsigned char ) ( sbox ( 1 , sbox ( 1 , sbox ( 0 , ( ulong32 ) y [ 2 ] ) ^ M [ 4 * ( 2 + offset ) + 2 ] ) ^ M [ 4 * ( 0 + offset ) + 2 ] ) ) ; y [ 3 ] = ( unsigned char ) ( sbox ( 0 , sbox ( 1 , sbox ( 1 , ( ulong32 ) y [ 3 ] ) ^ M [ 4 * ( 2 + offset ) + 3 ] ) ^ M [ 4 * ( 0 + offset ) + 3 ] ) ) ; } mds_mult ( y , out ) ; } 