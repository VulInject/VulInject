static krb5_error_code decrypt_krb5_with_cb ( proto_tree * tree , packet_info * pinfo , kerberos_private_data_t * private_data , int usage , int keytype , tvbuff_t * cryptotvb , krb5_error_code * decrypt_cb_fn ( const krb5_keyblock * key , int usage , void * decrypt_cb_data ) , void * decrypt_cb_data ) { wmem_map_t * key_map = NULL ; struct decrypt_krb5_with_cb_state state = { . tree = tree . pinfo = pinfo . private_data = private_data . usage = usage . cryptotvb = cryptotvb . keytype = keytype . decrypt_cb_fn = decrypt_cb_fn . decrypt_cb_data = decrypt_cb_data } ; read_keytab_file_from_preferences ( ) ; switch ( usage ) { case KRB5_KU_USAGE_INITIATOR_SEAL : case KRB5_KU_USAGE_ACCEPTOR_SEAL : key_map_name = "app_session_keys" ; key_map = kerberos_app_session_keys ; break ; default : key_map_name = "all_keys" ; key_map = kerberos_all_keys ; insert_longterm_keys_into_key_map ( key_map ) ; break ; } wmem_map_foreach ( key_map , decrypt_krb5_with_cb_try_key , & state ) ; if ( state . ek != NULL ) { used_encryption_key ( tree , pinfo , private_data , state . ek , usage , cryptotvb , key_map_name , wmem_map_size ( key_map ) , state . count ) ; return 0 ; } missing_encryption_key ( tree , pinfo , private_data , keytype , usage , cryptotvb , key_map_name , wmem_map_size ( key_map ) , state . count ) ; return - 1 ; } 