static int writeShape ( writeState * state , int shapeId ) { int j = 0 ; int i = state -> currentOutRecord ; int fWidth , fnDecimals ; shapeObj shape ; for ( j = 0 ; j < state -> numDbfFields ; j ++ ) { DBFFieldType dbfField = msDBFGetFieldInfo ( state -> inDBF , j , fName , & fWidth , & fnDecimals ) ; switch ( dbfField ) { case FTInteger : msDBFWriteIntegerAttribute ( state -> outDBF , i , j , msDBFReadIntegerAttribute ( state -> inDBF , shapeId , j ) ) ; break ; case FTDouble : msDBFWriteDoubleAttribute ( state -> outDBF , i , j , msDBFReadDoubleAttribute ( state -> inDBF , shapeId , j ) ) ; break ; case FTString : msDBFWriteStringAttribute ( state -> outDBF , i , j , msDBFReadStringAttribute ( state -> inDBF , shapeId , j ) ) ; break ; default : fprintf ( stderr , "Unsupported data type for field: %s, exiting.\n" , fName ) ; exit ( 0 ) ; } } msSHPReadShape ( state -> inSHP , shapeId , & shape ) ; msSHPWriteShape ( state -> outSHP , & shape ) ; msFreeShape ( & shape ) ; state -> currentOutRecord ++ ; return MS_SUCCESS ; } 