static int32_t ath9k_hw_ani_get_listen_time ( struct ath_hal * ah ) { struct ath_hal_5416 * ahp = AH5416 ( ah ) ; struct ar5416AniState * aniState ; uint32_t txFrameCount , rxFrameCount , cycleCount ; int32_t listenTime ; txFrameCount = REG_READ ( ah , AR_TFCNT ) ; rxFrameCount = REG_READ ( ah , AR_RFCNT ) ; cycleCount = REG_READ ( ah , AR_CCCNT ) ; aniState = ahp -> ah_curani ; else { int32_t ccdelta = cycleCount - aniState -> cycleCount ; int32_t rfdelta = rxFrameCount - aniState -> rxFrameCount ; int32_t tfdelta = txFrameCount - aniState -> txFrameCount ; listenTime = ( ccdelta - rfdelta - tfdelta ) / 44000 ; } aniState -> cycleCount = cycleCount ; aniState -> txFrameCount = txFrameCount ; aniState -> rxFrameCount = rxFrameCount ; return ( listenTime ) ; } 