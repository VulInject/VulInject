static void jsonwrap_query_metric_plan ( BUFFER * wb , QUERY_METRIC * qm ) { buffer_json_member_add_array ( wb , "plans" ) ; for ( size_t p = 0 ; p < qm -> plan . used ; p ++ ) { QUERY_PLAN_ENTRY * qp = & qm -> plan . array [ p ] ; buffer_json_add_array_item_object ( wb ) ; buffer_json_member_add_uint64 ( wb , "tr" , qp -> tier ) ; buffer_json_member_add_time_t ( wb , "af" , qp -> after ) ; buffer_json_member_add_time_t ( wb , "bf" , qp -> before ) ; buffer_json_object_close ( wb ) ; } buffer_json_array_close ( wb ) ; buffer_json_member_add_array ( wb , "tiers" ) ; for ( size_t tier = 0 ; tier < storage_tiers ; tier ++ ) { buffer_json_add_array_item_object ( wb ) ; buffer_json_member_add_uint64 ( wb , "tr" , tier ) ; buffer_json_member_add_time_t ( wb , "fe" , qm -> tiers [ tier ] . db_first_time_s ) ; buffer_json_member_add_time_t ( wb , "le" , qm -> tiers [ tier ] . db_last_time_s ) ; buffer_json_member_add_int64 ( wb , "wg" , qm -> tiers [ tier ] . weight ) ; buffer_json_object_close ( wb ) ; } } 