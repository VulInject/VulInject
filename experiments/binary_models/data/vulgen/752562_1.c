static inline void do_dpmac_config ( int dpmac , const char * arg_dpmacid , char * env_dpmac ) { const char * ret ; size_t len ; u8 realbusnum , ioslot ; struct mii_dev * bus ; int phy_num ; char * phystr = "phy00" ; for ( phy_num = 0 ; phy_num < WRIOP_MAX_PHY_NUM ; phy_num ++ ) { sprintf ( phystr , "phy%d" , phy_num + 1 ) ; ret = hwconfig_subarg_f ( arg_dpmacid , phystr , & len , env_dpmac ) ; if ( ! ret ) { if ( ! phy_num ) { ret = hwconfig_subarg_f ( arg_dpmacid , "phy" , & len , env_dpmac ) ; } } if ( len != 4 || strncmp ( ret , "0x" , 2 ) ) { printf ( "invalid phy format in %s variable.\n" "specify phy%d for %s in hex format e.g. 0x12\n" , env_dpmac , phy_num + 1 , arg_dpmacid ) ; } else { wriop_set_phy_address ( dpmac , phy_num , hextoul ( ret , NULL ) ) ; } } ret = hwconfig_subarg_f ( arg_dpmacid , "mdio" , & len , env_dpmac ) ; if ( ret ) { realbusnum = * ret - '0' ; } else { realbusnum = EMI_NONE ; } if ( realbusnum ) { ret = hwconfig_subarg_f ( arg_dpmacid , "io" , & len , env_dpmac ) ; if ( ret ) { ioslot = * ret - '0' ; } else { ioslot = IO_SLOT_NONE ; } bus = lx2162a_qds_mdio_init ( realbusnum , ioslot ) ; if ( ! bus ) { printf ( "could not get bus for mdio %d ioslot %d\n" , realbusnum , ioslot ) ; } else { wriop_set_mdio ( dpmac , bus ) ; } } } 