static int ti_pd_put ( struct ti_pd * pd ) { u32 pdctl ; int ret ; pd -> usecount -- ; pdctl = pd_read ( pd , PSC_PDCTL ) ; if ( ( pdctl & PDCTL_STATE_MASK ) == PDCTL_STATE_OFF ) { return 0 ; } pdctl &= ~ PDCTL_STATE_MASK ; pdctl |= PDCTL_STATE_OFF ; debug ( "%s: disabling psc:%d, pd:%d\n" , __func__ , pd -> psc -> id , pd -> id ) ; pd_write ( pdctl , pd , PSC_PDCTL ) ; if ( pd -> depend ) { ti_pd_transition ( pd ) ; ret = ti_pd_wait ( pd ) ; if ( ret ) { return ret ; } ret = ti_pd_put ( pd -> depend ) ; if ( ret ) { return ret ; } ti_pd_transition ( pd -> depend ) ; ret = ti_pd_wait ( pd -> depend ) ; if ( ret ) { return ret ; } } return 0 ; } 