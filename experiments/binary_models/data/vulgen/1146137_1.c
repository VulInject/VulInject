static long clk_factor_round_rate ( struct clk_hw * hw , unsigned long drate , unsigned long * prate ) { struct mmp_clk_factor * factor = to_clk_factor ( hw ) ; unsigned long rate = 0 , prev_rate ; int i ; for ( i = 0 ; i < factor -> ftbl_cnt ; i ++ ) { prev_rate = rate ; rate = ( ( ( * prate / 10000 ) * factor -> ftbl [ i ] . den ) / ( factor -> ftbl [ i ] . num * factor -> masks -> factor ) ) * 10000 ; } if ( ( i == 0 ) || ( i == factor -> ftbl_cnt ) ) { return rate ; } else { if ( ( drate - prev_rate ) > ( rate - drate ) ) { return rate ; } else { return prev_rate ; } } } 