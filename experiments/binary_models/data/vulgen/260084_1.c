static void show_sr_prefix ( struct sbuf * sbuf , struct json_object * json , struct sr_prefix * srp ) { struct listnode * node ; struct ospf_path * path ; struct interface * itf ; json_object * json_route = NULL , * json_obj ; char pref [ 19 ] ; char sid [ 22 ] ; char op [ 32 ] ; char buf [ PREFIX_STRLEN ] ; int indent = 0 ; snprintfrr ( pref , 19 , "%pFX" , ( prefix * ) & srp -> prefv4 ) ; snprintf ( sid , 22 , "SR Pfx (idx %u)" , srp -> sid ) ; if ( json ) { json_object_string_add ( json , "prefix" , pref ) ; json_object_int_add ( json , "sid" , srp -> sid ) ; json_object_int_add ( json , "inputLabel" , srp -> label_in ) ; } else { sbuf_push ( sbuf , 0 , "%18s  %21s  " , pref , sid ) ; } if ( srp -> type == LOCAL_SID ) { itf = if_lookup_by_index ( srp -> nhlfe . ifindex , VRF_DEFAULT ) ; if ( json ) { if ( ! json_route ) { json_object_object_add ( json , "prefixRoute" , json_route ) ; } json_obj = json_object_new_object ( ) ; json_object_int_add ( json_obj , "outputLabel" , srp -> nhlfe . label_out ) ; json_object_string_add ( json_obj , "interface" , itf ?itf -> name : "-" ) ; json_object_string_addf ( json_obj , "nexthop" , "%pI4" , & srp -> nhlfe . nexthop ) ; json_object_array_add ( json_route , json_obj ) ; } else { sbuf_push ( sbuf , 0 , "%20s  %9s  %15s\n" , sr_op2str ( op , 32 , srp -> label_in , srp -> nhlfe . label_out ) , itf ?itf -> name : "-" , inet_ntop ( AF_INET , & srp -> nhlfe . nexthop , buf , sizeof ( buf ) ) ) ; } return ; } if ( srp -> route == NULL ) { if ( ! json ) { sbuf_push ( sbuf , 0 , "\n" ) ; } return ; } for ( ALL_LIST_ELEMENTS_RO ( srp -> route -> paths , node , path ) ; ) { itf = if_lookup_by_index ( path -> ifindex , VRF_DEFAULT ) ; if ( json ) { if ( ! json_route ) { json_route = json_object_new_array ( ) ; json_object_object_add ( json , "prefixRoute" , json_route ) ; } json_obj = json_object_new_object ( ) ; json_object_int_add ( json_obj , "outputLabel" , path -> srni . label_out ) ; json_object_string_add ( json_obj , "interface" , itf ?itf -> name : "-" ) ; json_object_string_addf ( json_obj , "nexthop" , "%pI4" , & path -> nexthop ) ; json_object_array_add ( json_route , json_obj ) ; } else { sbuf_push ( sbuf , indent , "%20s  %9s  %15s\n" , sr_op2str ( op , 32 , srp -> label_in , path -> srni . label_out ) , itf ?itf -> name : "-" , inet_ntop ( AF_INET , & path -> nexthop , buf , sizeof ( buf ) ) ) ; indent = 43 ; } } } 