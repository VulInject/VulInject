static int kcmp_epoll_target ( struct task_struct * task1 , struct task_struct * task2 , unsigned long idx1 , struct kcmp_epoll_slot __user * uslot ) { struct file * filp , * filp_epoll , * filp_tgt ; struct kcmp_epoll_slot slot ; if ( copy_from_user ( & slot , uslot , sizeof ( slot ) ) ) { return - EFAULT ; } filp = get_file_raw_ptr ( task1 , idx1 ) ; filp_epoll = fget_task ( task2 , slot . efd ) ; if ( ! filp_epoll ) { return - EBADF ; } filp_tgt = get_epoll_tfile_raw_ptr ( filp_epoll , slot . tfd , slot . toff ) ; fput ( filp_epoll ) ; if ( IS_ERR ( filp_tgt ) ) { return PTR_ERR ( filp_tgt ) ; } return kcmp_ptr ( filp , filp_tgt , KCMP_FILE ) ; } 