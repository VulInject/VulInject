void acx_cardbus_setup ( struct acx_cardbus_softc * csc ) { cardbus_devfunc_t ct = csc -> sc_ct ; cardbus_chipset_tag_t cc = ct -> ct_cc ; pci_chipset_tag_t pc = csc -> sc_pc ; cardbus_function_tag_t cf = ct -> ct_cf ; pcireg_t reg ; int b1 = CARDBUS_BASE0_REG , b2 = CARDBUS_BASE1_REG ; if ( csc -> sc_iobar_val ) { pci_conf_write ( pc , csc -> sc_tag , CARDBUS_BASE0_REG , csc -> sc_iobar_val ) ; b1 = CARDBUS_BASE1_REG ; b2 = CARDBUS_BASE2_REG ; } pci_conf_write ( pc , csc -> sc_tag , b1 , csc -> sc_bar1_val ) ; pci_conf_write ( pc , csc -> sc_tag , b2 , csc -> sc_bar2_val ) ; * cf -> cardbus_ctrl ( cc , CARDBUS_MEM_ENABLE ) ; * cf -> cardbus_ctrl ( cc , CARDBUS_BM_ENABLE ) ; reg = pci_conf_read ( pc , csc -> sc_tag , PCI_COMMAND_STATUS_REG ) ; if ( csc -> sc_iobar_val ) { reg |= PCI_COMMAND_IO_ENABLE ; } pci_conf_write ( pc , csc -> sc_tag , PCI_COMMAND_STATUS_REG , reg ) ; } 