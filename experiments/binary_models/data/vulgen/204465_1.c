static void _adapter_address_to_entry ( intf_t * intf , IP_ADAPTER_ADDRESSES * a , struct intf_entry * entry ) { struct addr * ap , * lap ; int i ; int type ; IP_ADAPTER_UNICAST_ADDRESS * addr ; u_int intf_len = entry -> intf_len ; entry -> intf_len = intf_len ; type = _if_type_canonicalize ( a -> IfType ) ; for ( i = 0 ; i < intf -> ifcombo [ type ] . cnt ; i ++ ) { if ( intf -> ifcombo [ type ] . idx [ i ] . ipv4 == a -> IfIndex && intf -> ifcombo [ type ] . idx [ i ] . ipv6 == a -> Ipv6IfIndex ) { break ; } } snprintf ( entry -> intf_name , sizeof ( entry -> intf_name ) , "%s%lu" , _ifcombo_name ( a -> IfType ) , i ) ; entry -> intf_type = ( uint16_t ) type ; entry -> intf_flags = 0 ; if ( a -> OperStatus == IfOperStatusUp ) { entry -> intf_flags |= INTF_FLAG_UP ; } if ( a -> IfType == IF_TYPE_SOFTWARE_LOOPBACK ) { entry -> intf_flags |= INTF_FLAG_LOOPBACK ; } else { entry -> intf_flags |= INTF_FLAG_MULTICAST ; } entry -> intf_mtu = a -> Mtu ; if ( a -> PhysicalAddressLength == ETH_ADDR_LEN ) { entry -> intf_link_addr . addr_type = ADDR_TYPE_ETH ; entry -> intf_link_addr . addr_bits = ETH_ADDR_BITS ; memcpy ( & entry -> intf_link_addr . addr_eth , a -> PhysicalAddress , ETH_ADDR_LEN ) ; } ap = entry -> intf_alias_addrs ; lap = ap + ( ( entry -> intf_len - sizeof ( * entry ) ) / sizeof ( entry -> intf_alias_addrs [ 0 ] ) ) ; for ( addr = a -> FirstUnicastAddress ; addr != NULL ; addr = addr -> Next ) { IP_ADAPTER_PREFIX * prefix ; unsigned short bits ; bits = 0 ; if ( addr -> Length >= 48 ) { bits = addr -> OnLinkPrefixLength ; } else { for ( prefix = a -> FirstPrefix ; prefix != NULL ; prefix = prefix -> Next ) { if ( prefix -> Address . lpSockaddr -> sa_family == addr -> Address . lpSockaddr -> sa_family ) { bits = ( unsigned short ) prefix -> PrefixLength ; break ; } } } if ( entry -> intf_addr . addr_type == ADDR_TYPE_NONE ) { addr_ston ( addr -> Address . lpSockaddr , & entry -> intf_addr ) ; entry -> intf_addr . addr_bits = bits ; } if ( ap < lap ) { addr_ston ( addr -> Address . lpSockaddr , ap ) ; ap -> addr_bits = bits ; ap ++ ; entry -> intf_alias_num ++ ; } } entry -> intf_len = ( u_int ) ( ( u_char * ) ap - ( u_char * ) entry ) ; } 