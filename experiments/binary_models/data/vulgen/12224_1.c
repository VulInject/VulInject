local void scan_tree ( s , tree , max_code ) deflate_state * s ; ct_data * tree ; int max_code ; { int n ; int prevlen = - 1 ; int curlen ; int nextlen = tree [ 0 ] . Len ; int count = 0 ; int max_count = 7 ; int min_count = 4 ; if ( nextlen == 0 ) { max_count = 138 , min_count = 3 ; } tree [ max_code + 1 ] . Len = ( ush ) 0xffff ; for ( n = 0 ; n <= max_code ; n ++ ) { curlen = nextlen ; nextlen = tree [ n + 1 ] . Len ; if ( ++ count < max_count && curlen == nextlen ) { continue ; } if ( count < min_count ) { s -> bl_tree [ curlen ] . Freq += count ; } if ( curlen != 0 ) { s -> bl_tree [ REP_3_6 ] . Freq ++ ; } if ( count <= 10 ) { s -> bl_tree [ REPZ_3_10 ] . Freq ++ ; } else { s -> bl_tree [ REPZ_11_138 ] . Freq ++ ; } count = 0 ; prevlen = curlen ; if ( nextlen == 0 ) { max_count = 138 , min_count = 3 ; } if ( curlen == nextlen ) { max_count = 6 , min_count = 3 ; } else { max_count = 7 , min_count = 4 ; } } } 