cmsBool ProcessPhotoshopAPP13 ( JOCTET * data , int datalen ) { int i ; for ( i = 14 ; i < datalen ; ) { long len ; unsigned int type ; if ( ! ( GETJOCTET ( data [ i ] ) == 0x38 && GETJOCTET ( data [ i + 1 ] ) == 0x42 && GETJOCTET ( data [ i + 2 ] ) == 0x49 && GETJOCTET ( data [ i + 3 ] ) == 0x4D ) ) { break ; } i += 4 ; type = ( unsigned int ) ( GETJOCTET ( data [ i ] << 8 ) + GETJOCTET ( data [ i + 1 ] ) ) ; i += 2 ; i += GETJOCTET ( data [ i ] ) + ( ( GETJOCTET ( data [ i ] ) & 1 ) ?1 : 2 ) ; len = ( ( ( ( GETJOCTET ( data [ i ] << 8 ) + GETJOCTET ( data [ i + 1 ] ) ) << 8 ) + GETJOCTET ( data [ i + 2 ] ) ) << 8 ) + GETJOCTET ( data [ i + 3 ] ) ; i += 4 ; if ( type == 0x03ED && len >= 16 ) { Decompressor . X_density = ( UINT16 ) PS_FIXED_TO_FLOAT ( GETJOCTET ( data [ i ] << 8 ) + GETJOCTET ( data [ i + 1 ] ) , GETJOCTET ( data [ i + 2 ] << 8 ) + GETJOCTET ( data [ i + 3 ] ) ) ; Decompressor . Y_density = ( UINT16 ) PS_FIXED_TO_FLOAT ( GETJOCTET ( data [ i + 8 ] << 8 ) + GETJOCTET ( data [ i + 9 ] ) , GETJOCTET ( data [ i + 10 ] << 8 ) + GETJOCTET ( data [ i + 11 ] ) ) ; Decompressor . density_unit = 0x01 ; return TRUE ; } i += len + ( ( len & 1 ) ?1 : 0 ) ; } return FALSE ; } 