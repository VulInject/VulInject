void ospf_nbr_delete ( struct ospf_neighbor * nbr ) { struct ospf_interface * oi ; struct route_node * rn ; struct prefix p ; oi = nbr -> oi ; ospf_nbr_key ( oi , nbr , & p ) ; rn = route_node_lookup ( oi -> nbrs , & p ) ; if ( rn ) { assert ( rn -> info ) ; if ( rn -> info ) { rn -> info = NULL ; route_unlock_node ( rn ) ; } else { zlog_info ( "Can't find neighbor %pI4 in the interface %s" , & nbr -> src , IF_NAME ( oi ) ) ; } route_unlock_node ( rn ) ; } else { if ( oi -> type == OSPF_IFTYPE_VIRTUALLINK || oi -> type == OSPF_IFTYPE_POINTOPOINT ) { p . u . prefix4 = nbr -> src ; } else { p . u . prefix4 = nbr -> router_id ; } rn = route_node_lookup ( oi -> nbrs , & p ) ; if ( rn ) { route_unlock_node ( rn ) ; } } ospf_nbr_free ( nbr ) ; } 