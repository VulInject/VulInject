static int __init lasi_init_chip ( struct parisc_device * dev ) { extern void * chassis_power_off ( void ) struct gsc_asic * lasi ; int ret ; lasi = kzalloc ( sizeof ( * lasi ) , GFP_KERNEL ) ; if ( ! lasi ) { return - ENOMEM ; } lasi -> name = "Lasi" ; lasi -> hpa = dev -> hpa . start ; lasi -> version = gsc_readl ( lasi -> hpa + LASI_VER ) & 0xf ; printk ( KERN_INFO "%s version %d at 0x%lx found.\n" , lasi -> name , lasi -> version , lasi -> hpa ) ; lasi_led_init ( lasi -> hpa ) ; lasi_init_irq ( lasi ) ; dev -> irq = gsc_alloc_irq ( & lasi -> gsc_irq ) ; if ( dev -> irq < 0 ) { printk ( KERN_ERR "%s(): cannot get GSC irq\n" , __func__ ) ; return - EBUSY ; } lasi -> eim = ( ( u32 ) lasi -> gsc_irq . txn_addr ) | lasi -> gsc_irq . txn_data ; ret = request_irq ( lasi -> gsc_irq . irq , gsc_asic_intr , 0 , "lasi" , lasi ) ; if ( ret < 0 ) { kfree ( lasi ) ; return ret ; } gsc_writel ( lasi -> eim , lasi -> hpa + OFFSET_IAR ) ; ret = gsc_common_setup ( dev , lasi ) ; if ( ret ) { kfree ( lasi ) ; return ret ; } gsc_fixup_irqs ( dev , lasi , lasi_choose_irq ) ; lasi_power_off_hpa = lasi -> hpa ; chassis_power_off = lasi_power_off ; return ret ; } 