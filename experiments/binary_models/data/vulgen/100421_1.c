int cxd2880_integ_init ( struct cxd2880_tnrdmd * tnr_dmd ) { int ret ; ktime_t start ; u8 cpu_task_completed = 0 ; if ( ! tnr_dmd ) { return - EINVAL ; } ret = cxd2880_tnrdmd_init1 ( tnr_dmd ) ; if ( ret ) { return ret ; } start = ktime_get ( ) ; while ( 1 ) { ret = cxd2880_tnrdmd_check_internal_cpu_status ( tnr_dmd , & cpu_task_completed ) ; if ( ret ) { return ret ; } if ( cpu_task_completed ) { break ; } if ( ktime_to_ms ( ktime_sub ( ktime_get ( ) , start ) ) > CXD2880_TNRDMD_WAIT_INIT_TIMEOUT ) { return - ETIMEDOUT ; } } return cxd2880_tnrdmd_init2 ( tnr_dmd ) ; } 