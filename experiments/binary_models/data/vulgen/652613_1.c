alpha_emit_conditional_branch ( code ) rtx_code code ; { enum rtx_code cmp_code , branch_code ; enum machine_mode cmp_mode , branch_mode = VOIDmode ; rtx op0 = alpha_compare . op0 , op1 = alpha_compare . op1 ; rtx tem ; if ( alpha_compare . fp_p && GET_MODE ( op0 ) == TFmode ) { switch ( code ) { case UNORDERED : cmp_code = EQ ; code = LT ; break ; case ORDERED : cmp_code = EQ ; code = GE ; break ; case NE : cmp_code = NE ; code = NE ; break ; default : cmp_code = code ; code = GT ; break ; } op0 = alpha_emit_xfloating_compare ( cmp_code , op0 , op1 ) ; op1 = const0_rtx ; alpha_compare . fp_p = 0 ; } switch ( code ) { case EQ : case LE : case LT : case LEU : case LTU : case UNORDERED : cmp_code = code , branch_code = NE ; break ; case NE : case ORDERED : cmp_code = reverse_condition ( code ) , branch_code = EQ ; break ; case GE : case GT : case GEU : case GTU : if ( alpha_compare . fp_p ) { cmp_code = swap_condition ( code ) ; branch_code = NE ; tem = op0 , op0 = op1 , op1 = tem ; } else { cmp_code = reverse_condition ( code ) ; branch_code = EQ ; } break ; default : abort ( ) ; } if ( alpha_compare . fp_p ) { cmp_mode = DFmode ; if ( flag_unsafe_math_optimizations ) { if ( op1 == CONST0_RTX ( DFmode ) ) { cmp_code = NIL , branch_code = code ; } if ( op0 == CONST0_RTX ( DFmode ) ) { tem = op0 , op0 = op1 , op1 = tem ; branch_code = swap_condition ( cmp_code ) ; cmp_code = NIL ; } } else { branch_mode = CCmode ; } } else { cmp_mode = DImode ; if ( code != LEU && code != LTU && code != GEU && code != GTU ) { if ( op1 == const0_rtx ) { cmp_code = NIL , branch_code = code ; } if ( GET_CODE ( op1 ) == CONST_INT && ( code == EQ || code == NE ) ) { HOST_WIDE_INT v = INTVAL ( op1 ) , n = - v ; if ( ! CONST_OK_FOR_LETTER_P ( v , 'I' ) && ( CONST_OK_FOR_LETTER_P ( n , 'K' ) || CONST_OK_FOR_LETTER_P ( n , 'L' ) ) ) { cmp_code = PLUS , branch_code = code ; op1 = GEN_INT ( n ) ; } } } if ( ! reg_or_0_operand ( op0 , DImode ) ) { op0 = force_reg ( DImode , op0 ) ; } if ( cmp_code != PLUS && ! reg_or_8bit_operand ( op1 , DImode ) ) { op1 = force_reg ( DImode , op1 ) ; } } tem = op0 ; if ( cmp_code != NIL ) { tem = gen_reg_rtx ( cmp_mode ) ; emit_move_insn ( tem , gen_rtx_fmt_ee ( cmp_code , cmp_mode , op0 , op1 ) ) ; } memset ( & alpha_compare , 0 , sizeof ( alpha_compare ) ) ; return gen_rtx_fmt_ee ( branch_code , branch_mode , tem , CONST0_RTX ( cmp_mode ) ) ; } 