const gchar * time_shift_all ( capture_file * cf , const gchar * offset_text ) { nstime_t offset ; long double offset_float = 0 ; guint32 i ; frame_data * fd ; gboolean neg ; int h , m ; long double f ; const gchar * err_str ; if ( ! cf || ! offset_text ) { return "Nothing to work with." ; } offset_float = h * 3600 + m * 60 + f ; if ( offset_float == 0 ) { return "Offset is zero." ; } nstime_set_zero ( & offset ) ; offset . secs = ( time_t ) floorl ( offset_float ) ; offset_float -= offset . secs ; offset . nsecs = ( int ) ( offset_float * 1000000000 ) ; if ( ! frame_data_sequence_find ( cf -> provider . frames , 1 ) ) { return "No frames found." ; } for ( i = 1 ; i <= cf -> count ; i ++ ) { if ( ( fd = frame_data_sequence_find ( cf -> provider . frames , i ) ) == NULL ) { continue ; } modify_time_perform ( fd , neg ?SHIFT_NEG : SHIFT_POS , & offset , SHIFT_KEEPOFFSET ) ; } cf -> unsaved_changes = TRUE ; packet_list_queue_draw ( ) ; return NULL ; } 