int ban_exists ( Ban * lst , Ban * e ) { for ( ; lst ; lst = lst -> next ) { if ( ! mycmp ( lst -> banstr , e -> banstr ) ) { return 1 ; } } return 0 ; } { if ( ! ( x ) ) { config_warn ( "[channeldb] Read error from database file '%s' (possible corruption): %s" , cfg . database , unrealdb_get_error_string ( ) ) ; if ( e ) { safe_free ( e -> banstr ) ; safe_free ( e ) ; } return 0 ; } } 0 ; , { uint32_t total ; uint64_t when ; int i ; Ban * e = NULL ; R_SAFE ( unrealdb_read_int32 ( db , & total ) ) ; for ( i = 0 ; i < total ; i ++ ) { const char * str ; e = safe_alloc ( sizeof ( Ban ) ) ; R_SAFE ( unrealdb_read_str ( db , & e -> banstr ) ) ; R_SAFE ( unrealdb_read_str ( db , & e -> who ) ) ; R_SAFE ( unrealdb_read_int64 ( db , & when ) ) ; str = clean_ban_mask ( e -> banstr , MODE_ADD , & me , 0 ) ; if ( str == NULL ) { config_warn ( "[channeldb] listmode skipped (no longer valid?): %s" , e -> banstr ) ; safe_free ( e -> banstr ) ; safe_free ( e -> who ) ; safe_free ( e ) ; continue ; } safe_strdup ( e -> banstr , str ) ; if ( ban_exists ( * lst , e ) ) { safe_free ( e -> banstr ) ; safe_free ( e -> who ) ; safe_free ( e ) ; } else { e -> when = when ; e -> next = * lst ; * lst = e ; } } return 1 ; } 