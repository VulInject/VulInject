static ssize_t acpi_ec_write_io ( struct file * f , const char __user * buf , size_t count , loff_t * off ) { unsigned int size = count ; loff_t init_off = * off ; int err = 0 ; if ( ! write_support ) { return - EINVAL ; } if ( * off + count >= EC_SPACE_SIZE ) { size = EC_SPACE_SIZE - * off ; count = size ; } while ( size ) { u8 byte_write ; if ( get_user ( byte_write , buf + * off - init_off ) ) { if ( * off - init_off ) { return * off - init_off ; } return - EFAULT ; } err = ec_write ( * off , byte_write ) ; if ( err ) { return err ; } * off += 1 ; size -- ; } return count ; } static const struct file_operations acpi_ec_io_ops = { . owner = THIS_MODULE . open = simple_open . read = acpi_ec_read_io . write = acpi_ec_write_io . llseek = default_llseek } ; 