HAL_StatusTypeDef HAL_SAI_Abort ( SAI_HandleTypeDef * hsai ) { __HAL_LOCK ( hsai ) ; if ( ( hsai -> Instance -> CR1 & SAI_xCR1_DMAEN ) == SAI_xCR1_DMAEN ) { hsai -> Instance -> CR1 &= ~ SAI_xCR1_DMAEN ; if ( hsai -> hdmatx != NULL ) { if ( HAL_DMA_Abort ( hsai -> hdmatx ) != HAL_OK ) { return HAL_ERROR ; } } if ( hsai -> hdmarx != NULL ) { if ( HAL_DMA_Abort ( hsai -> hdmarx ) != HAL_OK ) { return HAL_ERROR ; } } } hsai -> Instance -> IMR = 0 ; hsai -> Instance -> CLRFR = 0xFFFFFFFFU ; SAI_Disable ( hsai ) ; SET_BIT ( hsai -> Instance -> CR2 , SAI_xCR2_FFLUSH ) ; __HAL_UNLOCK ( hsai ) ; return HAL_OK ; } 