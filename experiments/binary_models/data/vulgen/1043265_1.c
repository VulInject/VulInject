static int run_fetch ( const char * repo , const char * * refspecs ) { struct child_process cmd = CHILD_PROCESS_INIT ; strvec_pushl ( & cmd . args , "fetch" , "--update-head-ok" , NULL ) ; argv_push_verbosity ( & cmd . args ) ; if ( opt_progress ) { strvec_push ( & cmd . args , opt_progress ) ; } if ( opt_all ) { strvec_push ( & cmd . args , opt_all ) ; } if ( opt_append ) { strvec_push ( & cmd . args , opt_append ) ; } if ( opt_upload_pack ) { strvec_push ( & cmd . args , opt_upload_pack ) ; } argv_push_force ( & cmd . args ) ; if ( opt_tags ) { strvec_push ( & cmd . args , opt_tags ) ; } if ( opt_prune ) { strvec_push ( & cmd . args , opt_prune ) ; } if ( max_children ) { strvec_push ( & cmd . args , max_children ) ; } if ( opt_dry_run ) { strvec_push ( & cmd . args , "--dry-run" ) ; } if ( opt_keep ) { strvec_push ( & cmd . args , opt_keep ) ; } if ( opt_depth ) { strvec_push ( & cmd . args , opt_depth ) ; } if ( opt_unshallow ) { strvec_push ( & cmd . args , opt_unshallow ) ; } if ( opt_update_shallow ) { strvec_push ( & cmd . args , opt_update_shallow ) ; } if ( opt_refmap ) { strvec_push ( & cmd . args , opt_refmap ) ; } if ( opt_ipv4 ) { strvec_push ( & cmd . args , opt_ipv4 ) ; } if ( opt_ipv6 ) { strvec_push ( & cmd . args , opt_ipv6 ) ; } if ( opt_show_forced_updates > 0 ) { strvec_push ( & cmd . args , "--show-forced-updates" ) ; } if ( opt_show_forced_updates == 0 ) { strvec_push ( & cmd . args , "--no-show-forced-updates" ) ; } if ( set_upstream ) { strvec_push ( & cmd . args , set_upstream ) ; } strvec_pushv ( & cmd . args , opt_fetch . v ) ; if ( repo ) { strvec_push ( & cmd . args , repo ) ; strvec_pushv ( & cmd . args , refspecs ) ; } if ( * refspecs ) { BUG ( "refspecs without repo?" ) ; } cmd . git_cmd = 1 ; cmd . close_object_store = 1 ; return run_command ( & cmd ) ; } 