static int v4l2_buf_to_bufref ( V4L2Buffer * in , int plane , AVBufferRef * * buf ) { int ret ; if ( plane >= in -> num_planes ) { return AVERROR ( EINVAL ) ; } * buf = av_buffer_create ( ( char * ) in -> plane_info [ plane ] . mm_addr + in -> planes [ plane ] . data_offset , in -> plane_info [ plane ] . length , v4l2_free_buffer , in , 0 ) ; ret = v4l2_buf_increase_ref ( in ) ; if ( ret ) { av_buffer_unref ( buf ) ; } return ret ; } 