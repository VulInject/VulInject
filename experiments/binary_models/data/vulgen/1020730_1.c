static int oxygen_trigger ( struct snd_pcm_substream * substream , int cmd ) { struct oxygen * chip = snd_pcm_substream_chip ( substream ) ; struct snd_pcm_substream * s ; unsigned int mask = 0 ; int pausing ; switch ( cmd ) { case SNDRV_PCM_TRIGGER_STOP : case SNDRV_PCM_TRIGGER_START : case SNDRV_PCM_TRIGGER_SUSPEND : pausing = 0 ; break ; case SNDRV_PCM_TRIGGER_PAUSE_PUSH : case SNDRV_PCM_TRIGGER_PAUSE_RELEASE : pausing = 1 ; break ; default : return - EINVAL ; } snd_pcm_group_for_each_entry ( , ) { if ( snd_pcm_substream_chip ( s ) == chip ) { snd_pcm_trigger_done ( s , substream ) ; } } spin_lock ( & chip -> reg_lock ) ; if ( ! pausing ) { if ( cmd == SNDRV_PCM_TRIGGER_START ) { chip -> pcm_running |= mask ; } else { chip -> pcm_running &= ~ mask ; } oxygen_write8 ( chip , OXYGEN_DMA_STATUS , chip -> pcm_running ) ; } else { if ( cmd == SNDRV_PCM_TRIGGER_PAUSE_PUSH ) { oxygen_set_bits8 ( chip , OXYGEN_DMA_PAUSE , mask ) ; } else { oxygen_clear_bits8 ( chip , OXYGEN_DMA_PAUSE , mask ) ; } } spin_unlock ( & chip -> reg_lock ) ; return 0 ; } 