void dosuspend ( ) { int ctpgrp ; void * old ( ) tprintf ( "TRACE- dosuspend()\n" ) ; if ( loginsh ) { error ( "Can't suspend a login shell (yet)" ) ; } if ( getpid ( ) == getsid ( 0 ) ) { error ( "Can't suspend this shell" ) ; } untty ( ) ; old = ( void ( * ) ( ) ) signal ( SIGTSTP , SIG_DFL ) ; ( void ) kill ( 0 , SIGTSTP ) ; ( void ) signal ( SIGTSTP , old ) ; if ( tpgrp != - 1 ) { retry ( void ) ioctl ( FSHTTY , TIOCGPGRP , ( char * ) & ctpgrp ) ; if ( ctpgrp != opgrp ) { old = ( void ( * ) ( ) ) signal ( SIGTTIN , SIG_DFL ) ; ( void ) kill ( 0 , SIGTTIN ) ; ( void ) signal ( SIGTTIN , old ) ; retry } ( void ) ioctl ( FSHTTY , TIOCSPGRP , ( char * ) & shpgrp ) ; } } 