int qeth_l3_add_vipa ( struct qeth_card * card , enum qeth_prot_versions proto , const u8 * addr ) { struct qeth_ipaddr * ipaddr ; int rc = 0 ; ipaddr = qeth_l3_get_addr_buffer ( proto ) ; if ( ipaddr ) { if ( proto == QETH_PROT_IPV4 ) { QETH_CARD_TEXT ( card , 2 , "addvipa4" ) ; memcpy ( & ipaddr -> u . a4 . addr , addr , 4 ) ; ipaddr -> u . a4 . mask = 0 ; } if ( proto == QETH_PROT_IPV6 ) { QETH_CARD_TEXT ( card , 2 , "addvipa6" ) ; memcpy ( & ipaddr -> u . a6 . addr , addr , 16 ) ; ipaddr -> u . a6 . pfxlen = 0 ; } ipaddr -> type = QETH_IP_TYPE_VIPA ; ipaddr -> set_flags = QETH_IPA_SETIP_VIPA_FLAG ; ipaddr -> del_flags = QETH_IPA_DELIP_VIPA_FLAG ; } else { return - ENOMEM ; } spin_lock_bh ( & card -> ip_lock ) ; if ( qeth_l3_ip_from_hash ( card , ipaddr ) ) { rc = - EEXIST ; } else { qeth_l3_add_ip ( card , ipaddr ) ; } spin_unlock_bh ( & card -> ip_lock ) ; return rc ; } 