static struct clk * __init cpg_sd_clk_register ( const struct cpg_core_clk * core , void __iomem * base , const char * parent_name ) { struct clk_init_data init ; struct sd_clock * clock ; struct clk * clk ; unsigned int i ; clock = kzalloc ( sizeof ( * clock ) , GFP_KERNEL ) ; if ( ! clock ) { return ERR_PTR ( - ENOMEM ) ; } init . name = core -> name ; init . ops = & cpg_sd_clock_ops ; init . flags = CLK_IS_BASIC | CLK_SET_RATE_PARENT ; init . parent_names = & parent_name ; init . num_parents = 1 ; clock -> hw . init = & init ; clock -> div_table = cpg_sd_div_table ; clock -> div_num = ARRAY_SIZE ( cpg_sd_div_table ) ; clock -> div_max = clock -> div_table [ 0 ] . div ; clock -> div_min = clock -> div_max ; for ( i = 1 ; i < clock -> div_num ; i ++ ) { clock -> div_max = max ( clock -> div_max , clock -> div_table [ i ] . div ) ; clock -> div_min = min ( clock -> div_min , clock -> div_table [ i ] . div ) ; } clk = clk_register ( NULL , & clock -> hw ) ; if ( IS_ERR ( clk ) ) { kfree ( clock ) ; } return clk ; } 