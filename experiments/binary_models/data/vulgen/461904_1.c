static void av1394_it_reset_frame_syt ( av1394_ic_t * , int ) int av1394_it_hiwat_sub = 2 ; int av1394_it_lowat = 3 ; int av1394_it_start_thre = 3 ; int av1394_it_syt_off = 3 ; int av1394_it_dump_ixl = 0 ; int av1394_it_init ( av1394_ic_t * icp , int * error ) { av1394_it_t * itp = & icp -> ic_it ; av1394_isoch_pool_t * pool = & itp -> it_data_pool ; int nframes ; nframes = av1394_ic_alloc_pool ( pool , icp -> ic_framesz , icp -> ic_nframes , AV1394_IT_NFRAMES_MIN ) ; if ( nframes == 0 ) { return ( EINVAL ) ; } mutex_enter ( & icp -> ic_mutex ) ; icp -> ic_nframes = nframes ; itp -> it_hiwat = nframes - av1394_it_hiwat_sub ; itp -> it_lowat = av1394_it_lowat ; itp -> it_start_thre = av1394_it_start_thre ; itp -> it_nempty = icp -> ic_nframes ; itp -> it_last_full = icp -> ic_nframes - 1 ; if ( av1394_ic_dma_setup ( icp , pool ) != DDI_SUCCESS ) { mutex_exit ( & icp -> ic_mutex ) ; * error = IEC61883_ERR_NOMEM ; av1394_it_cleanup ( icp , 1 ) ; return ( EINVAL ) ; } if ( av1394_it_bld_ixl ( icp ) != DDI_SUCCESS ) { mutex_exit ( & icp -> ic_mutex ) ; * error = IEC61883_ERR_NOMEM ; av1394_it_cleanup ( icp , 2 ) ; return ( EINVAL ) ; } mutex_exit ( & icp -> ic_mutex ) ; if ( av1394_it_alloc_isoch_dma ( icp ) != DDI_SUCCESS ) { * error = IEC61883_ERR_NOMEM ; av1394_it_cleanup ( icp , 3 ) ; return ( EINVAL ) ; } return ( 0 ) ; } 