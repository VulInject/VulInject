cmsBool CMSEXPORT cmsCloseProfile ( cmsHPROFILE hProfile ) { _cmsICCPROFILE * Icc = ( _cmsICCPROFILE * ) hProfile ; cmsBool rc = TRUE ; cmsUInt32Number i ; if ( Icc -> IsWrite ) { Icc -> IsWrite = FALSE ; rc &= cmsSaveProfileToFile ( hProfile , Icc -> IOhandler -> PhysicalFile ) ; } for ( i = 0 ; i < Icc -> TagCount ; i ++ ) { if ( Icc -> TagPtrs [ i ] ) { cmsTagTypeHandler * TypeHandler = Icc -> TagTypeHandlers [ i ] ; if ( TypeHandler != NULL ) { cmsTagTypeHandler LocalTypeHandler = * TypeHandler ; LocalTypeHandler . ContextID = Icc -> ContextID ; LocalTypeHandler . ICCVersion = Icc -> Version ; LocalTypeHandler . FreePtr ( & LocalTypeHandler , Icc -> TagPtrs [ i ] ) ; } else { _cmsFree ( Icc -> ContextID , Icc -> TagPtrs [ i ] ) ; } } } if ( Icc -> IOhandler != NULL ) { rc &= cmsCloseIOhandler ( Icc -> IOhandler ) ; } _cmsDestroyMutex ( Icc -> ContextID , Icc -> UsrMutex ) ; _cmsFree ( Icc -> ContextID , Icc ) ; return rc ; } 