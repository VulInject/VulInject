static bool __init blogic_reportconfig ( struct blogic_adapter * adapter ) { unsigned short alltgt_mask = ( 1 << adapter -> maxdev ) - 1 ; unsigned short sync_ok , fast_ok ; unsigned short ultra_ok , wide_ok ; unsigned short discon_ok , tagq_ok ; bool common_syncneg , common_tagq_depth ; char syncstr [ BLOGIC_MAXDEV + 1 ] ; char widestr [ BLOGIC_MAXDEV + 1 ] ; char discon_str [ BLOGIC_MAXDEV + 1 ] ; char tagq_str [ BLOGIC_MAXDEV + 1 ] ; char * syncmsg = syncstr ; char * widemsg = widestr ; char * discon_msg = discon_str ; char * tagq_msg = tagq_str ; int tgt_id ; blogic_info ( "Configuring BusLogic Model %s %s%s%s%s SCSI Host Adapter\n" , adapter , adapter -> model , blogic_adapter_busnames [ adapter -> adapter_bus_type ] , ( adapter -> wide ?" Wide" : "" ) , ( adapter -> differential ?" Differential" : "" ) , ( adapter -> ultra ?" Ultra" : "" ) ) ; blogic_info ( "  Firmware Version: %s, I/O Address: 0x%lX, IRQ Channel: %d/%s\n" , adapter , adapter -> fw_ver , adapter -> io_addr , adapter -> irq_ch , ( adapter -> level_int ?"Level" : "Edge" ) ) ; if ( adapter -> adapter_bus_type != BLOGIC_PCI_BUS ) { blogic_info ( "  DMA Channel: None, " , adapter ) ; if ( adapter -> bios_addr > 0 ) { blogic_info ( "BIOS Address: 0x%X, " , adapter , adapter -> bios_addr ) ; } else { blogic_info ( "BIOS Address: None, " , adapter ) ; } } else { blogic_info ( "  PCI Bus: %d, Device: %d, Address: " , adapter , adapter -> bus , adapter -> dev ) ; if ( adapter -> pci_addr > 0 ) { blogic_info ( "0x%lX, " , adapter , adapter -> pci_addr ) ; } else { blogic_info ( "Unassigned, " , adapter ) ; } } blogic_info ( "Host Adapter SCSI ID: %d\n" , adapter , adapter -> scsi_id ) ; blogic_info ( "  Parity Checking: %s, Extended Translation: %s\n" , adapter , ( adapter -> parity ?"Enabled" : "Disabled" ) , ( adapter -> ext_trans_enable ?"Enabled" : "Disabled" ) ) ; alltgt_mask &= ~ ( 1 << adapter -> scsi_id ) ; sync_ok = adapter -> sync_ok & alltgt_mask ; fast_ok = adapter -> fast_ok & alltgt_mask ; ultra_ok = adapter -> ultra_ok & alltgt_mask ; if ( ( blogic_multimaster_type ( adapter ) && ( adapter -> fw_ver [ 0 ] >= '4' || adapter -> adapter_bus_type == BLOGIC_EISA_BUS ) ) || blogic_flashpoint_type ( adapter ) ) { common_syncneg = false ; if ( sync_ok == 0 ) { syncmsg = "Disabled" ; common_syncneg = true ; } if ( sync_ok == alltgt_mask ) { if ( fast_ok == 0 ) { syncmsg = "Slow" ; common_syncneg = true ; } if ( fast_ok == alltgt_mask ) { if ( ultra_ok == 0 ) { syncmsg = "Fast" ; common_syncneg = true ; } if ( ultra_ok == alltgt_mask ) { syncmsg = "Ultra" ; common_syncneg = true ; } } } if ( ! common_syncneg ) { for ( tgt_id = 0 ; tgt_id < adapter -> maxdev ; tgt_id ++ ) { syncstr [ tgt_id ] = ( ( ! ( sync_ok & ( 1 << tgt_id ) ) ) ?'N' : ( ! ( fast_ok & ( 1 << tgt_id ) ) ?'S' : ( ! ( ultra_ok & ( 1 << tgt_id ) ) ?'F' : 'U' ) ) ) ; } syncstr [ adapter -> scsi_id ] = '#' ; syncstr [ adapter -> maxdev ] = '\0' ; } } else { syncmsg = ( sync_ok == 0 ?"Disabled" : "Enabled" ) ; } wide_ok = adapter -> wide_ok & alltgt_mask ; if ( wide_ok == 0 ) { widemsg = "Disabled" ; } if ( wide_ok == alltgt_mask ) { widemsg = "Enabled" ; } else { for ( tgt_id = 0 ; tgt_id < adapter -> maxdev ; tgt_id ++ ) { widestr [ tgt_id ] = ( ( wide_ok & ( 1 << tgt_id ) ) ?'Y' : 'N' ) ; } widestr [ adapter -> scsi_id ] = '#' ; widestr [ adapter -> maxdev ] = '\0' ; } discon_ok = adapter -> discon_ok & alltgt_mask ; if ( discon_ok == 0 ) { discon_msg = "Disabled" ; } if ( discon_ok == alltgt_mask ) { discon_msg = "Enabled" ; } else { for ( tgt_id = 0 ; tgt_id < adapter -> maxdev ; tgt_id ++ ) { discon_str [ tgt_id ] = ( ( discon_ok & ( 1 << tgt_id ) ) ?'Y' : 'N' ) ; } discon_str [ adapter -> scsi_id ] = '#' ; discon_str [ adapter -> maxdev ] = '\0' ; } tagq_ok = adapter -> tagq_ok & alltgt_mask ; if ( tagq_ok == 0 ) { tagq_msg = "Disabled" ; } if ( tagq_ok == alltgt_mask ) { tagq_msg = "Enabled" ; } else { for ( tgt_id = 0 ; tgt_id < adapter -> maxdev ; tgt_id ++ ) { tagq_str [ tgt_id ] = ( ( tagq_ok & ( 1 << tgt_id ) ) ?'Y' : 'N' ) ; } tagq_str [ adapter -> scsi_id ] = '#' ; tagq_str [ adapter -> maxdev ] = '\0' ; } blogic_info ( "  Synchronous Negotiation: %s, Wide Negotiation: %s\n" , adapter , syncmsg , widemsg ) ; blogic_info ( "  Disconnect/Reconnect: %s, Tagged Queuing: %s\n" , adapter , discon_msg , tagq_msg ) ; if ( blogic_multimaster_type ( adapter ) ) { blogic_info ( "  Scatter/Gather Limit: %d of %d segments, Mailboxes: %d\n" , adapter , adapter -> drvr_sglimit , adapter -> adapter_sglimit , adapter -> mbox_count ) ; blogic_info ( "  Driver Queue Depth: %d, Host Adapter Queue Depth: %d\n" , adapter , adapter -> drvr_qdepth , adapter -> adapter_qdepth ) ; } else { blogic_info ( "  Driver Queue Depth: %d, Scatter/Gather Limit: %d segments\n" , adapter , adapter -> drvr_qdepth , adapter -> drvr_sglimit ) ; } blogic_info ( "  Tagged Queue Depth: " , adapter ) ; common_tagq_depth = true ; for ( tgt_id = 1 ; tgt_id < adapter -> maxdev ; tgt_id ++ ) { } if ( common_tagq_depth ) { if ( adapter -> qdepth [ 0 ] > 0 ) { blogic_info ( "%d" , adapter , adapter -> qdepth [ 0 ] ) ; } else { blogic_info ( "Automatic" , adapter ) ; } } else { blogic_info ( "Individual" , adapter ) ; } blogic_info ( ", Untagged Queue Depth: %d\n" , adapter , adapter -> untag_qdepth ) ; if ( adapter -> terminfo_valid ) { if ( adapter -> wide ) { blogic_info ( "  SCSI Bus Termination: %s" , adapter , ( adapter -> low_term ?( adapter -> high_term ?"Both Enabled" : "Low Enabled" ) else ( adapter -> high_term ?"High Enabled" : "Both Disabled" ) ) ) ; } else { blogic_info ( "  SCSI Bus Termination: %s" , adapter , ( adapter -> low_term ?"Enabled" : "Disabled" ) ) ; } if ( adapter -> scam ) { blogic_info ( ", SCAM: %s" , adapter , ( adapter -> scam_enabled ?( adapter -> scam_lev2 ?"Enabled, Level 2" : "Enabled, Level 1" ) else "Disabled" ) ) ; } blogic_info ( "\n" , adapter ) ; } return true ; } 