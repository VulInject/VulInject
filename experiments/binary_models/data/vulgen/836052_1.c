static int ilb_conn_walk_init ( mdb_walk_state_t * wsp ) { int i ; ilb_walk_t * conn_walk ; ilb_conn_hash_t head ; if ( wsp -> walk_addr == 0 ) { return ( WALK_ERR ) ; } conn_walk = mdb_alloc ( sizeof ( ilb_walk_t ) , UM_SLEEP ) ; if ( mdb_vread ( & conn_walk -> ilbs , sizeof ( conn_walk -> ilbs ) , wsp -> walk_addr ) == - 1 ) { mdb_warn ( "failed to read ilb_stack_t at %p" , wsp -> walk_addr ) ; return ( WALK_ERR ) ; } if ( conn_walk -> ilbs . ilbs_c2s_conn_hash == NULL ) { mdb_free ( conn_walk , sizeof ( ilb_walk_t ) ) ; return ( WALK_DONE ) ; } wsp -> walk_data = conn_walk ; for ( i = 0 ; i < conn_walk -> ilbs . ilbs_conn_hash_size ; i ++ ) { char * khead ; khead = ( char * ) conn_walk -> ilbs . ilbs_c2s_conn_hash + i * sizeof ( ilb_conn_hash_t ) ; if ( mdb_vread ( & head , sizeof ( ilb_conn_hash_t ) , ( uintptr_t ) khead ) == - 1 ) { mdb_warn ( "failed to read ilbs_c2s_conn_hash at %p\n" , khead ) ; return ( WALK_ERR ) ; } if ( head . ilb_connp != NULL ) { break ; } } if ( head . ilb_connp == NULL ) { return ( WALK_DONE ) ; } wsp -> walk_addr = ( uintptr_t ) head . ilb_connp ; conn_walk -> idx = i ; return ( WALK_NEXT ) ; } 