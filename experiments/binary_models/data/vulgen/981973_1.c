static int write_pmu_mappings ( struct feat_fd * ff , struct evlist * evlist __maybe_unused ) { struct perf_pmu * pmu = NULL ; u32 pmu_num ; int ret ; while ( ( pmu = perf_pmu__scan ( pmu ) ) ) { if ( ! pmu -> name ) { continue ; } pmu_num ++ ; } ret = do_write ( ff , & pmu_num , sizeof ( pmu_num ) ) ; if ( ret < 0 ) { return ret ; } while ( ( pmu = perf_pmu__scan ( pmu ) ) ) { if ( ! pmu -> name ) { continue ; } ret = do_write ( ff , & pmu -> type , sizeof ( pmu -> type ) ) ; if ( ret < 0 ) { return ret ; } ret = do_write_string ( ff , pmu -> name ) ; if ( ret < 0 ) { return ret ; } } return 0 ; } 