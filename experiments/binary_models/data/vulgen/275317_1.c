static bool GH r_resolve_jemalloc ( RCore * core , char * symname , ut64 * symbol ) { RListIter * iter ; RDebugMap * map ; const char * path = NULL ; ut64 jemalloc_addr = UT64_MAX ; if ( ! core || ! core -> dbg || ! core -> dbg -> maps ) { return false ; } r_debug_map_sync ( core -> dbg ) ; r_list_foreach ( , , ) { if ( strstr ( map -> name , "libjemalloc." ) ) { jemalloc_addr = map -> addr ; path = map -> name ; break ; } } if ( ! path ) { R_LOG_WARN ( "cannot find jemalloc mapped in memory (see `dm`)" ) ; return false ; } bool is_debug_file = GH ( je_matched ) ( path , "/usr/local/lib" ) ; if ( ! is_debug_file ) { R_LOG_WARN ( "Cannot find libjemalloc.so.2 in /usr/local/lib" ) ; return false ; } if ( r_file_exists ( path ) ) { ut64 vaddr = GH ( je_get_va_symbol ) ( core , path , symname ) ; if ( jemalloc_addr != GHT_MAX && vaddr != 0 ) { * symbol = jemalloc_addr + vaddr ; return true ; } } return false ; eprintf ( "[*] Resolving %s from libjemalloc.2... " , symname ) ; char * va = r_core_cmd_strf ( core , "dmi libjemalloc.2 %s$~[1]" , symname ) ; ut64 n = r_num_get ( NULL , va ) ; if ( n && n != UT64_MAX ) { * symbol = n ; eprintf ( "0x%08" PFMT64x " 0x%08" PFMT64x "\n" , n , jemalloc_addr ) ; } else { eprintf ( "NOT FOUND\n" ) ; } return true ; } 