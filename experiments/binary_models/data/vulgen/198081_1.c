static void ptypedef ( definition * def ) { char * name = def -> def_name ; char * old = def -> def . ty . old_type ; char prefix [ 8 ] ; relation rel = def -> def . ty . rel ; if ( ! streq ( name , old ) ) { if ( streq ( old , "string" ) ) { old = "char" ; rel = REL_POINTER ; } if ( streq ( old , "opaque" ) ) { old = "char" ; } if ( streq ( old , "bool" ) ) { old = "bool_t" ; } else { prefix [ 0 ] = 0 ; } f_print ( fout , "typedef " ) ; switch ( rel ) { case REL_ARRAY : f_print ( fout , "struct {\n" ) ; f_print ( fout , "\tu_int %s_len;\n" , name ) ; f_print ( fout , "\t%s%s *%s_val;\n" , prefix , old , name ) ; f_print ( fout , "} %s" , name ) ; break ; case REL_POINTER : f_print ( fout , "%s%s *%s" , prefix , old , name ) ; break ; case REL_VECTOR : f_print ( fout , "%s%s %s[%s]" , prefix , old , name , def -> def . ty . array_max ) ; break ; case REL_ALIAS : f_print ( fout , "%s%s %s" , prefix , old , name ) ; break ; } f_print ( fout , ";\n" ) ; } } 