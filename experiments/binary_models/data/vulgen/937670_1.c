static int dissect_mic_e ( tvbuff_t * tvb , int offset , packet_info * pinfo , proto_tree * parent_tree , int hf_mic_e_idx ) { proto_tree * tc ; proto_tree * mic_e_tree ; int new_offset ; int data_len ; char * info_buffer ; char latitude [ 8 ] { '?' '?' '?' '?' '.' '?' '?' 0x0 } ; ; int msg_a ; int msg_b ; int msg_c ; char n_s ; int long_offset ; char w_e ; int cse ; int spd ; guint8 ssid ; const guint8 * addr ; const mic_e_dst_code_table_s * dst_code_entry ; data_len = tvb_reported_length_remaining ( tvb , offset ) ; new_offset = offset + data_len ; info_buffer = ( char * ) wmem_alloc ( wmem_packet_scope ( ) , STRLEN ) ; msg_a = 0 ; msg_b = 0 ; msg_c = 0 ; n_s = '?' ; long_offset = 0 ; w_e = '?' ; ssid = 0 ; if ( pinfo -> dst . type == AT_AX25 && pinfo -> dst . len == AX25_ADDR_LEN ) { addr = ( const guint8 * ) pinfo -> dst . data ; dst_code_entry = dst_code_lookup ( addr [ 0 ] ) ; latitude [ 0 ] = dst_code_entry -> digit ; msg_a = dst_code_entry -> msg & 0x1 ; dst_code_entry = dst_code_lookup ( addr [ 1 ] ) ; latitude [ 1 ] = dst_code_entry -> digit ; msg_b = dst_code_entry -> msg & 0x1 ; dst_code_entry = dst_code_lookup ( addr [ 2 ] ) ; latitude [ 2 ] = dst_code_entry -> digit ; msg_c = dst_code_entry -> msg & 0x1 ; dst_code_entry = dst_code_lookup ( addr [ 3 ] ) ; latitude [ 3 ] = dst_code_entry -> digit ; n_s = dst_code_entry -> n_s ; dst_code_entry = dst_code_lookup ( addr [ 4 ] ) ; latitude [ 5 ] = dst_code_entry -> digit ; long_offset = dst_code_entry -> long_offset ; dst_code_entry = dst_code_lookup ( addr [ 5 ] ) ; latitude [ 6 ] = dst_code_entry -> digit ; w_e = dst_code_entry -> w_e ; ssid = ( addr [ 6 ] >> 1 ) & 0x0f ; } spd = ( ( tvb_get_guint8 ( tvb , offset + 3 ) - 28 ) * 10 ) + ( ( tvb_get_guint8 ( tvb , offset + 4 ) - 28 ) / 10 ) ; if ( spd >= 800 ) { spd -= 800 ; } cse = ( ( ( tvb_get_guint8 ( tvb , offset + 4 ) - 28 ) % 10 ) * 100 ) + ( ( tvb_get_guint8 ( tvb , offset + 5 ) - 28 ) * 10 ) ; if ( cse >= 400 ) { cse -= 400 ; } snprintf ( info_buffer , STRLEN , "Lat: %7.7s%c Long: %03d%02d.%02d%c, Cse: %d, Spd: %d, SSID: %d, Msg %s" , latitude , n_s , d28_to_deg ( tvb_get_guint8 ( tvb , offset ) , long_offset ) , d28_to_min ( tvb_get_guint8 ( tvb , offset + 1 ) ) , tvb_get_guint8 ( tvb , offset + 2 ) - 28 , w_e , cse , spd , ssid , mic_e_msg_table [ ( msg_a << 2 ) + ( msg_b << 1 ) + msg_c ] . std ) ; col_set_str ( pinfo -> cinfo , COL_INFO , "MIC-E " ) ; col_append_str ( pinfo -> cinfo , COL_INFO , info_buffer ) ; if ( parent_tree ) { tc = proto_tree_add_string ( parent_tree , hf_mic_e_idx , tvb , offset , data_len , info_buffer ) ; mic_e_tree = proto_item_add_subtree ( tc , ett_aprs_mic_e ) ; snprintf ( info_buffer , STRLEN , "Lat %7.7s, Msg A %d, Msg B %d, Msg C %d, N/S %c, Long off %3d, W/E %c, SSID %d" , latitude , msg_a , msg_b , msg_c , n_s , long_offset , w_e , ssid ) ; proto_tree_add_string ( mic_e_tree , hf_aprs_mic_e_dst , tvb , 0 , 0 , info_buffer ) ; proto_tree_add_item ( mic_e_tree , hf_aprs_mic_e_long_d , tvb , offset , 1 , ENC_BIG_ENDIAN ) ; offset += 1 ; proto_tree_add_item ( mic_e_tree , hf_aprs_mic_e_long_m , tvb , offset , 1 , ENC_BIG_ENDIAN ) ; offset += 1 ; proto_tree_add_item ( mic_e_tree , hf_aprs_mic_e_long_h , tvb , offset , 1 , ENC_BIG_ENDIAN ) ; offset += 1 ; proto_tree_add_item ( mic_e_tree , hf_aprs_mic_e_spd_sp , tvb , offset , 1 , ENC_BIG_ENDIAN ) ; offset += 1 ; proto_tree_add_item ( mic_e_tree , hf_aprs_mic_e_spd_dc , tvb , offset , 1 , ENC_BIG_ENDIAN ) ; offset += 1 ; proto_tree_add_item ( mic_e_tree , hf_aprs_mic_e_spd_se , tvb , offset , 1 , ENC_BIG_ENDIAN ) ; offset += 1 ; proto_tree_add_item ( mic_e_tree , hf_aprs_sym_code , tvb , offset , 1 , ENC_ASCII ) ; offset += 1 ; proto_tree_add_item ( mic_e_tree , hf_aprs_sym_id , tvb , offset , 1 , ENC_ASCII ) ; offset += 1 ; } return new_offset ; } 