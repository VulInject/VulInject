void siena_phy_link_ev ( __in efx_nic_t * enp , __in efx_qword_t * eqp , __out efx_link_mode_t * link_modep ) { efx_port_t * epp = & ( enp -> en_port ) ; unsigned int link_flags ; unsigned int speed ; unsigned int fcntl ; efx_link_mode_t link_mode ; uint32_t lp_cap_mask ; switch ( MCDI_EV_FIELD ( eqp , LINKCHANGE_SPEED ) ) { case MCDI_EVENT_LINKCHANGE_SPEED_100M : speed = 100 ; break ; case MCDI_EVENT_LINKCHANGE_SPEED_1G : speed = 1000 ; break ; case MCDI_EVENT_LINKCHANGE_SPEED_10G : speed = 10000 ; break ; default : speed = 0 ; break ; } link_flags = MCDI_EV_FIELD ( eqp , LINKCHANGE_LINK_FLAGS ) ; siena_phy_decode_link_mode ( enp , link_flags , speed , MCDI_EV_FIELD ( eqp , LINKCHANGE_FCNTL ) , & link_mode , & fcntl ) ; siena_phy_decode_cap ( MCDI_EV_FIELD ( eqp , LINKCHANGE_LP_CAP ) , & lp_cap_mask ) ; if ( epp -> ep_phy_cap_mask & ( 1 << EFX_PHY_CAP_AN ) ) { epp -> ep_fcntl = fcntl ; } * link_modep = link_mode ; } 