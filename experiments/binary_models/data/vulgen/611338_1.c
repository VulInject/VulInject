static enum sasl_mechanism_result ATHEME_FATTR_WUR sasl_mech_ecdsa_step_verify_signature ( struct sasl_session * const restrict p , const struct sasl_input_buf * const restrict in ) { struct sasl_ecdsa_nist256p_challenge_session * const s = p -> mechdata ; const int retd = ECDSA_verify ( 0 , s -> challenge , sizeof s -> challenge , in -> buf , ( int ) in -> len , s -> pubkey ) ; if ( retd == 1 ) { return ASASL_MRESULT_SUCCESS ; } if ( retd != 0 ) { return ASASL_MRESULT_ERROR ; } if ( ! digest_oneshot ( DIGALG_SHA2_256 , s -> challenge , sizeof s -> challenge , digestbuf , NULL ) ) { return ASASL_MRESULT_ERROR ; } const int reth = ECDSA_verify ( 0 , digestbuf , sizeof digestbuf , in -> buf , ( int ) in -> len , s -> pubkey ) ; if ( reth == 1 ) { return ASASL_MRESULT_SUCCESS ; } if ( reth != 0 ) { return ASASL_MRESULT_ERROR ; } return ASASL_MRESULT_FAILURE ; } 