weecrypto_totp_generate ( , , ) { char * result , * secret ; int length_secret , rc ; uint64_t moving_factor ; secret = NULL ; result = NULL ; if ( ! secret_base32 || ! secret_base32 [ 0 ] || ( digits < WEECRYPTO_TOTP_MIN_DIGITS ) || ( digits > WEECRYPTO_TOTP_MAX_DIGITS ) ) { error } secret = malloc ( ( strlen ( secret_base32 ) * 4 ) + 16 + 1 ) ; if ( ! secret ) { error } length_secret = string_base32_decode ( secret_base32 , secret ) ; if ( length_secret < 0 ) { error } result = malloc ( digits + 1 ) ; if ( ! result ) { error } if ( totp_time == 0 ) { totp_time = time ( NULL ) ; } moving_factor = totp_time / 30 ; rc = weecrypto_totp_generate_internal ( secret , length_secret , moving_factor , digits , result ) ; if ( ! rc ) { error } return result ; error if ( secret ) { free ( secret ) ; } if ( result ) { free ( result ) ; } return NULL ; } 