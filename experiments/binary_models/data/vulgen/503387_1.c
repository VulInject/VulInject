static off_t bhsfs_lseek ( int fd , off_t addr , int whence ) { fileid_t * filep ; dprintf ( "lseek %d, " , fd ) ; dprintf ( "off = %lx\n" , addr ) ; if ( ! ( filep = find_fp ( fd ) ) ) { return ( - 1 ) ; } if ( filep -> fi_flags & FI_COMPRESSED ) { cf_seek ( filep , addr , whence ) ; } else { switch ( whence ) { case SEEK_CUR : filep -> fi_offset += addr ; break ; case SEEK_SET : filep -> fi_offset = addr ; break ; default : case SEEK_END : printf ( "lseek(): invalid whence value %d\n" , whence ) ; break ; } filep -> fi_blocknum = addr / DEV_BSIZE ; } return ( 0 ) ; } 