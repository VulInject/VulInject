static int stop_look ( struct item * , char , int , int ) static void wander ( void ) static void _panic ( const char * , int , const char * ) int otto ( int y , int x , char face , char * buf , size_t buflen ) { int i ; switch ( face ) { case '^' : facing = NORTH ; break ; case '<' : facing = WEST ; break ; case 'v' : facing = SOUTH ; break ; case '>' : facing = EAST ; break ; default : panic ( "unknown face" ) ; } row = y ; col = x ; been_there [ row ] [ col ] |= 1 << facing ; comlen = 0 ; look_around ( ) ; for ( i = 0 ; i < NUMDIRECTIONS ; i ++ ) { if ( strchr ( OPPONENT , flbr [ i ] . what ) != NULL ) { attack ( i , & flbr [ i ] ) ; memset ( been_there , 0 , sizeof been_there ) ; done } } if ( strchr ( SHOTS , bitem . what ) != NULL && ! ( bitem . what & ON_SIDE ) ) { duck ( BACK ) ; memset ( been_there , 0 , sizeof been_there ) ; } if ( go_for_ammo ( BOOT_PAIR ) ) { memset ( been_there , 0 , sizeof been_there ) ; } if ( go_for_ammo ( BOOT ) ) { memset ( been_there , 0 , sizeof been_there ) ; } if ( go_for_ammo ( GMINE ) ) { memset ( been_there , 0 , sizeof been_there ) ; } if ( go_for_ammo ( MINE ) ) { memset ( been_there , 0 , sizeof been_there ) ; } else { wander ( ) ; } done if ( comlen ) { if ( comlen > buflen ) { panic ( "not enough buffer space" ) ; } memcpy ( buf , command , comlen ) ; } return comlen ; } 