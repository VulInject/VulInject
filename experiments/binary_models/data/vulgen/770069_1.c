struct gpio_charger_platform_data * gpio_charger_parse_dt ( struct device * dev ) { struct device_node * np = dev -> of_node ; struct gpio_charger_platform_data * pdata ; const char * chargetype ; int ret ; if ( ! np ) { return ERR_PTR ( - ENOENT ) ; } if ( ! pdata ) { return ERR_PTR ( - ENOMEM ) ; } pdata -> name = np -> name ; pdata -> type = POWER_SUPPLY_TYPE_UNKNOWN ; ret = of_property_read_string ( np , "charger-type" , & chargetype ) ; if ( ret >= 0 ) { if ( ! strncmp ( "unknown" , chargetype , 7 ) ) { pdata -> type = POWER_SUPPLY_TYPE_UNKNOWN ; } if ( ! strncmp ( "battery" , chargetype , 7 ) ) { pdata -> type = POWER_SUPPLY_TYPE_BATTERY ; } if ( ! strncmp ( "ups" , chargetype , 3 ) ) { pdata -> type = POWER_SUPPLY_TYPE_UPS ; } if ( ! strncmp ( "mains" , chargetype , 5 ) ) { pdata -> type = POWER_SUPPLY_TYPE_MAINS ; } if ( ! strncmp ( "usb-sdp" , chargetype , 7 ) ) { pdata -> type = POWER_SUPPLY_TYPE_USB ; } if ( ! strncmp ( "usb-dcp" , chargetype , 7 ) ) { pdata -> type = POWER_SUPPLY_TYPE_USB_DCP ; } if ( ! strncmp ( "usb-cdp" , chargetype , 7 ) ) { pdata -> type = POWER_SUPPLY_TYPE_USB_CDP ; } if ( ! strncmp ( "usb-aca" , chargetype , 7 ) ) { pdata -> type = POWER_SUPPLY_TYPE_USB_ACA ; } else { dev_warn ( dev , "unknown charger type %s\n" , chargetype ) ; } } return pdata ; } 