int i40e_alloc_vfs ( struct i40e_pf * pf , u16 num_alloc_vfs ) { struct i40e_vf * vfs ; int i , ret = 0 ; i40e_irq_dynamic_disable_icr0 ( pf ) ; vfs = kcalloc ( num_alloc_vfs , sizeof ( i40e_vf ) , GFP_KERNEL ) ; if ( ! vfs ) { ret = - ENOMEM ; err_alloc } pf -> vf = vfs ; for ( i = 0 ; i < num_alloc_vfs ; i ++ ) { vfs [ i ] . pf = pf ; vfs [ i ] . parent_type = I40E_SWITCH_ELEMENT_TYPE_VEB ; vfs [ i ] . vf_id = i ; set_bit ( I40E_VIRTCHNL_VF_CAP_L2 , & vfs [ i ] . vf_caps ) ; vfs [ i ] . spoofchk = true ; set_bit ( I40E_VF_STATE_PRE_ENABLE , & vfs [ i ] . vf_states ) ; } pf -> num_alloc_vfs = num_alloc_vfs ; i40e_reset_all_vfs ( pf , false ) ; i40e_notify_client_of_vf_enable ( pf , num_alloc_vfs ) ; err_alloc if ( ret ) { i40e_free_vfs ( pf ) ; } err_iov i40e_irq_dynamic_enable_icr0 ( pf ) ; return ret ; } 