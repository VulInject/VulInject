static int av_create ( di_minor_t minor , di_node_t node ) { devfsadm_enumerate_t rules [ 1 ] { "^av$/^([0-9]+)$" 1 MATCH_ADDR } ; ; char * minor_str ; char path [ PATH_MAX + 1 ] ; char * buf ; if ( ( buf = di_devfs_path ( node ) ) == NULL ) { return ( DEVFSADM_CONTINUE ) ; } minor_str = di_minor_name ( minor ) ; ( void ) snprintf ( path , sizeof ( path ) , "%s:%s" , buf , minor_str ) ; if ( devfsadm_enumerate_int ( path , 0 , & buf , rules , 1 ) ) { return ( DEVFSADM_CONTINUE ) ; } ( void ) snprintf ( path , sizeof ( path ) , "av/%s/%s" , buf , minor_str ) ; free ( buf ) ; ( void ) devfsadm_mklink ( path , node , minor , 0 ) ; return ( DEVFSADM_CONTINUE ) ; } 