static int query_formats ( AVFilterContext * ctx ) { MergePlanesContext * s = ctx -> priv ; AVFilterFormats * formats = NULL ; int i , ret ; s -> outdesc = av_pix_fmt_desc_get ( s -> out_fmt ) ; for ( i = 0 ; av_pix_fmt_desc_get ( i ) ; i ++ ) { const AVPixFmtDescriptor * desc = av_pix_fmt_desc_get ( i ) ; if ( desc -> comp [ 0 ] . depth == s -> outdesc -> comp [ 0 ] . depth && ( desc -> comp [ 0 ] . depth <= 8 || ( desc -> flags & AV_PIX_FMT_FLAG_BE ) == ( s -> outdesc -> flags & AV_PIX_FMT_FLAG_BE ) ) && av_pix_fmt_count_planes ( i ) == desc -> nb_components && ( ret = ff_add_format ( & formats , i ) ) < 0 ) { return ret ; } } for ( i = 0 ; i < s -> nb_inputs ; i ++ ) { if ( ( ret = ff_formats_ref ( formats , & ctx -> inputs [ i ] -> outcfg . formats ) ) < 0 ) { return ret ; } } if ( ( ret = ff_add_format ( & formats , s -> out_fmt ) ) < 0 || ( ret = ff_formats_ref ( formats , & ctx -> outputs [ 0 ] -> incfg . formats ) ) < 0 ) { return ret ; } return 0 ; } 