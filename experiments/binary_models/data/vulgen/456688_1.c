static int qcom_hfpll_probe ( struct platform_device * pdev ) { struct device * dev = & pdev -> dev ; void __iomem * base ; struct regmap * regmap ; struct clk_hfpll * h ; struct clk_init_data init = { . num_parents = 1 . ops = & clk_ops_hfpll . flags = CLK_IGNORE_UNUSED } ; int ret ; struct clk_parent_data pdata = { . index = 0 } ; h = devm_kzalloc ( dev , sizeof ( * h ) , GFP_KERNEL ) ; if ( ! h ) { return - ENOMEM ; } base = devm_platform_get_and_ioremap_resource ( pdev , 0 , NULL ) ; if ( IS_ERR ( base ) ) { return PTR_ERR ( base ) ; } regmap = devm_regmap_init_mmio ( & pdev -> dev , base , & hfpll_regmap_config ) ; if ( IS_ERR ( regmap ) ) { return PTR_ERR ( regmap ) ; } if ( of_property_read_string_index ( dev -> of_node , "clock-output-names" , 0 , & init . name ) ) { return - ENODEV ; } init . parent_data = & pdata ; h -> d = & hdata ; h -> clkr . hw . init = & init ; spin_lock_init ( & h -> lock ) ; ret = devm_clk_register_regmap ( dev , & h -> clkr ) ; return devm_of_clk_add_hw_provider ( dev , of_clk_hw_simple_get , & h -> clkr . hw ) ; } 