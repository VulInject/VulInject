intmax_t strtoimax ( const char * nptr , char * * endptr , int base ) { const char * s ; intmax_t acc , cutoff ; int c ; int neg , any , cutlim ; if ( base ( 0 || base == 1 || base ) 36 ) { errno = EINVAL ; return 0 ; } s = nptr ; { c = ( unsigned char ) * s ++ ; } isspace ( c ) ; if ( c == '-' ) { neg = 1 ; c = * s ++ ; } else { neg = 0 ; if ( c == '+' ) { c = * s ++ ; } } if ( ( base == 0 || base == 16 ) && c == '0' && ( * s == 'x' || * s == 'X' ) && isxdigit ( ( unsigned char ) s [ 1 ] ) ) { c = s [ 1 ] ; s += 2 ; base = 16 ; } if ( base == 0 ) { base = c == '0' ?8 : 10 ; } cutoff = neg ?INTMAX_MIN : INTMAX_MAX ; cutlim = cutoff % base ; cutoff /= base ; if ( neg ) { if ( cutlim > 0 ) { cutlim -= base ; cutoff += 1 ; } cutlim = - cutlim ; } for ( acc = 0 , any = 0 ; ; c = ( unsigned char ) * s ++ ) { if ( isdigit ( c ) ) { c -= '0' ; } if ( isalpha ( c ) ) { c -= isupper ( c ) ?'A' - 10 : 'a' - 10 ; } else { break ; } if ( c >= base ) { break ; } if ( any < 0 ) { continue ; } if ( neg ) { if ( acc < cutoff || ( acc == cutoff && c > cutlim ) ) { any = - 1 ; acc = INTMAX_MIN ; errno = ERANGE ; } else { any = 1 ; acc *= base ; acc -= c ; } } else { if ( acc > cutoff || ( acc == cutoff && c > cutlim ) ) { any = - 1 ; acc = INTMAX_MAX ; errno = ERANGE ; } else { any = 1 ; acc *= base ; acc += c ; } } } if ( endptr != 0 ) { * endptr = ( char * ) ( any ?s - 1 : nptr ) ; } return ( acc ) ; } 