static module_t * cli_module_hold ( char * modname ) { module_t * module ; rcm_log_message ( RCM_TRACE3 , "cli_module_hold(%s)\n" , modname ) ; ( void ) mutex_lock ( & mod_lock ) ; module = module_head ; while ( module ) { if ( strcmp ( module -> name , modname ) == 0 ) { break ; } module = module -> next ; } if ( module ) { module -> ref_count ++ ; ( void ) mutex_unlock ( & mod_lock ) ; return ( module ) ; } if ( ( module = module_load ( modname ) ) == NULL ) { ( void ) mutex_unlock ( & mod_lock ) ; return ( NULL ) ; } module -> next = module_head ; module_head = module ; ( void ) mutex_unlock ( & mod_lock ) ; return ( module ) ; } 