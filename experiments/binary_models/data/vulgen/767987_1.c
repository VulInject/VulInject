static int __init alloc_buffers ( void ) { union aa_buffer * aa_buf ; int i , num ; if ( num_online_cpus ( ) > 1 ) { num = 4 + RESERVE_COUNT ; } else { num = 2 + RESERVE_COUNT ; } for ( i = 0 ; i < num ; i ++ ) { aa_buf = kmalloc ( aa_g_path_max , GFP_KERNEL | __GFP_RETRY_MAYFAIL | __GFP_NOWARN ) ; if ( ! aa_buf ) { return - ENOMEM ; } aa_put_buffer ( & aa_buf -> buffer [ 0 ] ) ; } return 0 ; } 