Datum pg_show_replication_origin_status ( PG_FUNCTION_ARGS ) { ReturnSetInfo * rsinfo = ( ReturnSetInfo * ) fcinfo -> resultinfo ; int i ; replorigin_check_prerequisites ( false , true ) ; InitMaterializedSRF ( fcinfo , 0 ) ; LWLockAcquire ( ReplicationOriginLock , LW_SHARED ) ; for ( i = 0 ; i < max_replication_slots ; i ++ ) { ReplicationState * state ; Datum values [ REPLICATION_ORIGIN_PROGRESS_COLS ] ; bool nulls [ REPLICATION_ORIGIN_PROGRESS_COLS ] ; char * roname ; state = & replication_states [ i ] ; memset ( values , 0 , sizeof ( values ) ) ; memset ( nulls , 1 , sizeof ( nulls ) ) ; values [ 0 ] = ObjectIdGetDatum ( state -> roident ) ; nulls [ 0 ] = false ; if ( replorigin_by_oid ( state -> roident , true , & roname ) ) { values [ 1 ] = CStringGetTextDatum ( roname ) ; nulls [ 1 ] = false ; } LWLockAcquire ( & state -> lock , LW_SHARED ) ; values [ 2 ] = LSNGetDatum ( state -> remote_lsn ) ; nulls [ 2 ] = false ; values [ 3 ] = LSNGetDatum ( state -> local_lsn ) ; nulls [ 3 ] = false ; LWLockRelease ( & state -> lock ) ; tuplestore_putvalues ( rsinfo -> setResult , rsinfo -> setDesc , values , nulls ) ; } LWLockRelease ( ReplicationOriginLock ) ; return ( Datum ) 0 ; } 