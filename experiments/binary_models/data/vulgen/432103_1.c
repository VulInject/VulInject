return_type aes_decrypt ( const unsigned char in [ N_BLOCK ] , unsigned char out [ N_BLOCK ] , const aes_context ctx [ 1 ] ) { if ( ctx -> rnd ) { uint_8t s1 [ N_BLOCK ] , r ; copy_and_key ( s1 , in , ctx -> ksch + ctx -> rnd * N_BLOCK ) ; for ( r = ctx -> rnd ; -- r ; ) { add_round_key ( s1 , ctx -> ksch + r * N_BLOCK ) ; inv_mix_sub_columns ( s1 ) ; } { uint_8t s2 [ N_BLOCK ] ; copy_and_key ( s2 , s1 , ctx -> ksch + r * N_BLOCK ) ; inv_mix_sub_columns ( s1 , s2 ) ; } copy_and_key ( out , s1 , ctx -> ksch ) ; } else { return ( return_type ) - 1 ; } return 0 ; } 