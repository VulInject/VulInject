static struct page * * get_pages ( struct drm_gem_object * obj ) { struct msm_gem_object * msm_obj = to_msm_bo ( obj ) ; if ( ! msm_obj -> pages ) { struct drm_device * dev = obj -> dev ; struct page * * p ; int npages = obj -> size >> PAGE_SHIFT ; if ( use_pages ( obj ) ) { p = drm_gem_get_pages ( obj ) ; } else { p = get_pages_vram ( obj , npages ) ; } if ( IS_ERR ( p ) ) { dev_err ( dev -> dev , "could not get pages: %ld\n" , PTR_ERR ( p ) ) ; return p ; } msm_obj -> sgt = drm_prime_pages_to_sg ( p , npages ) ; if ( IS_ERR ( msm_obj -> sgt ) ) { dev_err ( dev -> dev , "failed to allocate sgt\n" ) ; return ERR_CAST ( msm_obj -> sgt ) ; } msm_obj -> pages = p ; } return msm_obj -> pages ; } 