static tool_rc get_max_random ( ESYS_CONTEXT * ectx , UINT32 * value ) { TPMS_CAPABILITY_DATA * cap_data = NULL ; tool_rc rc = tpm2_capability_get ( ectx , TPM2_CAP_TPM_PROPERTIES , TPM2_PT_FIXED , TPM2_MAX_TPM_PROPERTIES , & cap_data ) ; if ( rc != tool_rc_success ) { return rc ; } UINT32 i ; for ( i = 0 ; i < cap_data -> data . tpmProperties . count ; i ++ ) { TPMS_TAGGED_PROPERTY * p = & cap_data -> data . tpmProperties . tpmProperty [ i ] ; if ( p -> property == TPM2_PT_MAX_DIGEST ) { * value = p -> value ; return tool_rc_success ; } } LOG_ERR ( "TPM does not have property TPM2_PT_MAX_DIGEST" ) ; free ( cap_data ) ; return tool_rc_general_error ; } 