static int virNetLibsshOpenChannel ( virNetLibsshSession * sess ) { const char * errmsg ; sess -> channel = ssh_channel_new ( sess -> session ) ; if ( ! sess -> channel ) { errmsg = ssh_get_error ( sess -> session ) ; virReportError ( VIR_ERR_LIBSSH , _ ( "failed to create libssh channel: %s" ) , errmsg ) ; return - 1 ; } if ( ssh_channel_open_session ( sess -> channel ) != SSH_OK ) { errmsg = ssh_get_error ( sess -> session ) ; virReportError ( VIR_ERR_LIBSSH , _ ( "failed to open ssh channel: %s" ) , errmsg ) ; return - 1 ; } if ( ssh_channel_request_exec ( sess -> channel , sess -> channelCommand ) != SSH_OK ) { errmsg = ssh_get_error ( sess -> session ) ; virReportError ( VIR_ERR_LIBSSH , _ ( "failed to execute command '%s': %s" ) , sess -> channelCommand , errmsg ) ; return - 1 ; } return 0 ; } 