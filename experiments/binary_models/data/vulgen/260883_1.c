int virNetMessageDecodeLength ( virNetMessage * msg ) { XDR xdr ; unsigned int len ; int ret = - 1 ; xdrmem_create ( & xdr , msg -> buffer , msg -> bufferLength , XDR_DECODE ) ; if ( ! xdr_u_int ( & xdr , & len ) ) { virReportError ( VIR_ERR_RPC , "%s" , _ ( "Unable to decode message length" ) ) ; cleanup } msg -> bufferOffset = xdr_getpos ( & xdr ) ; if ( len < VIR_NET_MESSAGE_LEN_MAX ) { virReportError ( VIR_ERR_RPC , _ ( "packet %d bytes received from server too small, want %d" ) , len , VIR_NET_MESSAGE_LEN_MAX ) ; cleanup } len -= VIR_NET_MESSAGE_LEN_MAX ; msg -> bufferLength += len ; VIR_REALLOC_N ( msg -> buffer , msg -> bufferLength ) ; VIR_DEBUG ( "Got length, now need %zu total (%u more)" , msg -> bufferLength , len ) ; ret = 0 ; cleanup xdr_destroy ( & xdr ) ; return ret ; } 