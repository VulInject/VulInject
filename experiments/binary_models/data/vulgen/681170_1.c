void aclk_process_send_alarm_snapshot ( char * node_id , char * claim_id , uint64_t snapshot_id , uint64_t sequence_id ) { UNUSED ( claim_id ) ; uuid_t node_uuid ; if ( uuid_parse ( node_id , node_uuid ) ) { return ; } struct aclk_database_worker_config * wc = NULL ; RRDHOST * host = find_host_by_node_id ( node_id ) ; if ( likely ( host ) ) { wc = ( aclk_database_worker_config * ) host -> dbsync_worker ; } if ( likely ( wc ) ) { log_access ( "IN [%s (%s)]: Request to send alerts snapshot, snapshot_id %" PRIu64 " and ack_sequence_id %" PRIu64 , wc -> node_id , wc -> host ?rrdhost_hostname ( wc -> host ) : "N/A" , snapshot_id , sequence_id ) ; if ( wc -> alerts_snapshot_id == snapshot_id ) { return ; } __sync_synchronize ( ) ; wc -> alerts_snapshot_id = snapshot_id ; wc -> alerts_ack_sequence_id = sequence_id ; __sync_synchronize ( ) ; struct aclk_database_cmd cmd ; memset ( & cmd , 0 , sizeof ( cmd ) ) ; cmd . opcode = ACLK_DATABASE_PUSH_ALERT_SNAPSHOT ; cmd . data_param = NULL ; cmd . completion = NULL ; aclk_database_enq_cmd ( wc , & cmd ) ; } else { log_access ( "ACLK STA [%s (N/A)]: ACLK synchronization thread is not active." , node_id ) ; } return ; } 