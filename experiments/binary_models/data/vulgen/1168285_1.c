void VM_VmProfile_f ( void ) { vm_t * vm ; vmSymbol_t * * sorted , * sym ; int i ; double total ; vm = lastVM ; if ( ! vm -> numSymbols ) { return ; } sorted = Z_Malloc ( vm -> numSymbols * sizeof ( * sorted ) ) ; sorted [ 0 ] = vm -> symbols ; total = sorted [ 0 ] -> profileCount ; for ( i = 1 ; i < vm -> numSymbols ; i ++ ) { sorted [ i ] = sorted [ i - 1 ] -> next ; total += sorted [ i ] -> profileCount ; } qsort ( sorted , vm -> numSymbols , sizeof ( * sorted ) , VM_ProfileSort ) ; for ( i = 0 ; i < vm -> numSymbols ; i ++ ) { int perc ; sym = sorted [ i ] ; perc = 100 * ( float ) sym -> profileCount / total ; Com_Printf ( "%2i%% %9i %s\n" , perc , sym -> profileCount , sym -> symName ) ; sym -> profileCount = 0 ; } Com_Printf ( "    %9.0f total\n" , total ) ; Z_Free ( sorted ) ; } 