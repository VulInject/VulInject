static int edac_create_dimm_object ( struct mem_ctl_info * mci , struct dimm_info * dimm ) { int err ; dimm -> mci = mci ; dimm -> dev . type = & dimm_attr_type ; dimm -> dev . release = dimm_release ; device_initialize ( & dimm -> dev ) ; dimm -> dev . parent = & mci -> dev ; if ( mci -> csbased ) { dev_set_name ( & dimm -> dev , "rank%d" , dimm -> idx ) ; } else { dev_set_name ( & dimm -> dev , "dimm%d" , dimm -> idx ) ; } dev_set_drvdata ( & dimm -> dev , dimm ) ; pm_runtime_forbid ( & mci -> dev ) ; err = device_add ( & dimm -> dev ) ; if ( err ) { edac_dbg ( 1 , "failure: create device %s\n" , dev_name ( & dimm -> dev ) ) ; return err ; } if ( IS_ENABLED ( CONFIG_EDAC_DEBUG ) ) { char location [ 80 ] ; edac_dimm_info_location ( dimm , location , sizeof ( location ) ) ; edac_dbg ( 0 , "device %s created at location %s\n" , dev_name ( & dimm -> dev ) , location ) ; } return 0 ; } 