void mlx5e_tir_builder_build_rss ( struct mlx5e_tir_builder * builder , const struct mlx5e_rss_params_hash * rss_hash , const struct mlx5e_rss_params_traffic_type * rss_tt , bool inner ) { void * tirc = mlx5e_tir_builder_get_tirc ( builder ) ; void * hfso ; if ( builder -> modify ) { MLX5_SET ( modify_tir_in , builder -> in , bitmask . hash , 1 ) ; } MLX5_SET ( tirc , tirc , rx_hash_fn , mlx5e_hfunc_to_hw ( rss_hash -> hfunc ) ) ; if ( rss_hash -> hfunc == ETH_RSS_HASH_TOP ) { void * rss_key = MLX5_ADDR_OF ( tirc , tirc , rx_hash_toeplitz_key ) ; MLX5_SET ( tirc , tirc , rx_hash_symmetric , 1 ) ; memcpy ( rss_key , rss_hash -> toeplitz_hash_key , len ) ; } if ( inner ) { hfso = MLX5_ADDR_OF ( tirc , tirc , rx_hash_field_selector_inner ) ; } else { hfso = MLX5_ADDR_OF ( tirc , tirc , rx_hash_field_selector_outer ) ; } MLX5_SET ( rx_hash_field_select , hfso , l3_prot_type , rss_tt -> l3_prot_type ) ; MLX5_SET ( rx_hash_field_select , hfso , l4_prot_type , rss_tt -> l4_prot_type ) ; MLX5_SET ( rx_hash_field_select , hfso , selected_fields , rss_tt -> rx_hash_fields ) ; } 