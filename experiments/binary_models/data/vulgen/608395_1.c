static void virtio_gpu_gl_handle_ctrl ( VirtIODevice * vdev , VirtQueue * vq ) { VirtIOGPU * g = VIRTIO_GPU ( vdev ) ; VirtIOGPUGL * gl = VIRTIO_GPU_GL ( vdev ) ; struct virtio_gpu_ctrl_command * cmd ; if ( ! virtio_queue_ready ( vq ) ) { return ; } if ( ! gl -> renderer_inited ) { virtio_gpu_virgl_init ( g ) ; gl -> renderer_inited = true ; } if ( gl -> renderer_reset ) { gl -> renderer_reset = false ; virtio_gpu_virgl_reset ( g ) ; } cmd = virtqueue_pop ( vq , sizeof ( virtio_gpu_ctrl_command ) ) ; while ( cmd ) { cmd -> vq = vq ; cmd -> error = 0 ; cmd -> finished = false ; QTAILQ_INSERT_TAIL ( & g -> cmdq , cmd , next ) ; cmd = virtqueue_pop ( vq , sizeof ( virtio_gpu_ctrl_command ) ) ; } virtio_gpu_process_cmdq ( g ) ; } 