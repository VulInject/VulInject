static void test_hmac_alloc ( void ) { size_t i ; for ( i = 0 ; i < G_N_ELEMENTS ( test_data ) ; i ++ ) { QCryptoHmacTestData * data = & test_data [ i ] ; QCryptoHmac * hmac = NULL ; uint8_t * result = NULL ; size_t resultlen ; const char * exp_output = NULL ; int ret ; size_t j ; if ( ! qcrypto_hmac_supports ( data -> alg ) ) { return ; } exp_output = data -> hex_digest ; hmac = qcrypto_hmac_new ( data -> alg , ( const uint8_t * ) KEY , strlen ( KEY ) , & error_fatal ) ; g_assert ( hmac != NULL ) ; ret = qcrypto_hmac_bytes ( hmac , ( const char * ) INPUT_TEXT , strlen ( INPUT_TEXT ) , & result , & resultlen , & error_fatal ) ; g_assert ( ret == 0 ) ; for ( j = 0 ; j < resultlen ; j ++ ) { g_assert ( exp_output [ j * 2 ] == hex [ ( result [ j ] >> 4 ) & 0xf ] ) ; g_assert ( exp_output [ j * 2 + 1 ] == hex [ result [ j ] & 0xf ] ) ; } qcrypto_hmac_free ( hmac ) ; g_free ( result ) ; } } 