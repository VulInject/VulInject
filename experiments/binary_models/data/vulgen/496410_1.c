gimp_navigation_view_draw_marker ( , ) { GimpView * view = GIMP_VIEW ( nav_view ) ; if ( view -> renderer -> viewable && nav_view -> width && nav_view -> height ) { GtkWidget * widget = GTK_WIDGET ( view ) ; GtkAllocation allocation ; cairo_matrix_t matrix ; gint p_width_2 ; gint p_height_2 ; gdouble angle ; p_width_2 = nav_view -> p_width / 2 ; p_height_2 = nav_view -> p_height / 2 ; angle = G_PI * nav_view -> rotate_angle / 180.0 ; if ( nav_view -> flip_horizontally != nav_view -> flip_vertically ) { angle = - angle ; } gtk_widget_get_allocation ( widget , & allocation ) ; cairo_get_matrix ( cr , & matrix ) ; cairo_rectangle ( cr , 0 , 0 , allocation . width , allocation . height ) ; cairo_translate ( cr , nav_view -> p_center_x , nav_view -> p_center_y ) ; cairo_rotate ( cr , - angle ) ; cairo_rectangle ( cr , - p_width_2 , - p_height_2 , nav_view -> p_width , nav_view -> p_height ) ; cairo_set_source_rgba ( cr , 0 , 0 , 0 , 0.5 ) ; cairo_set_fill_rule ( cr , CAIRO_FILL_RULE_EVEN_ODD ) ; cairo_fill ( cr ) ; if ( nav_view -> canvas_visible && nav_view -> canvas_width && nav_view -> canvas_height ) { cairo_save ( cr ) ; cairo_set_matrix ( cr , & matrix ) ; cairo_rectangle ( cr , nav_view -> p_canvas_x + 0.5 , nav_view -> p_canvas_y + 0.5 , nav_view -> p_canvas_width - 1.0 , nav_view -> p_canvas_height - 1.0 ) ; cairo_stroke ( cr ) ; cairo_restore ( cr ) ; } cairo_rectangle ( cr , - p_width_2 , - p_height_2 , nav_view -> p_width , nav_view -> p_height ) ; cairo_set_source_rgb ( cr , 1 , 1 , 1 ) ; cairo_set_line_width ( cr , BORDER_WIDTH ) ; cairo_stroke ( cr ) ; } } 