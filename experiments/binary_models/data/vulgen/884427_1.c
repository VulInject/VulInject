void netdev_gtpu_push_header ( const struct netdev * netdev , struct dp_packet * packet , const struct ovs_action_push_tnl * data ) { struct netdev_vport * dev = netdev_vport_cast ( netdev ) ; struct netdev_tunnel_config * tnl_cfg ; struct udp_header * udp ; struct gtpuhdr * gtpuh ; int ip_tot_size ; payload_len = dp_packet_size ( packet ) ; udp = netdev_tnl_push_ip_header ( packet , data -> header , data -> header_len , & ip_tot_size ) ; udp -> udp_src = netdev_tnl_get_src_port ( packet ) ; udp -> udp_len = htons ( ip_tot_size ) ; netdev_tnl_calc_udp_csum ( udp , packet , ip_tot_size ) ; gtpuh = ALIGNED_CAST ( gtpuhdr * , udp + 1 ) ; tnl_cfg = & dev -> tnl_cfg ; if ( tnl_cfg -> set_seq ) { ovs_be16 * seqno = ALIGNED_CAST ( ovs_be16 * , gtpuh + 1 ) ; * seqno = htons ( tnl_cfg -> seqno ++ ) ; payload_len += sizeof ( gtpuhdr_opt ) ; } gtpuh -> len = htons ( payload_len ) ; } 