char * mimetype ( Mime_t * mp , Sfio_t * fp , const char * file , struct stat * st ) { if ( mp -> disc -> flags & MIME_NOMAGIC ) { return 0 ; } if ( ! mp -> magic ) { mp -> magicd . version = MAGIC_VERSION ; mp -> magicd . flags = MAGIC_MIME ; mp -> magicd . errorf = mp -> disc -> errorf ; if ( ! ( mp -> magic = magicopen ( & mp -> magicd ) ) ) { mp -> disc -> flags |= MIME_NOMAGIC ; return 0 ; } magicload ( mp -> magic , NiL , 0 ) ; } return magictype ( mp -> magic , fp , file , st ) ; } 