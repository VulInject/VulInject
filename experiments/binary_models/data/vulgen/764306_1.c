static void ts3a227e_new_jack_state ( struct ts3a227e * ts3a227e , unsigned acc_reg ) { bool plugged , mic_present ; plugged = ! ! ( acc_reg & JACK_INSERTED ) ; ts3a227e -> plugged = plugged ; if ( mic_present != ts3a227e -> mic_present ) { ts3a227e -> mic_present = mic_present ; ts3a227e -> buttons_held = 0 ; if ( mic_present ) { regmap_update_bits ( ts3a227e -> regmap , TS3A227E_REG_SETTING_2 , KP_ENABLE , KP_ENABLE ) ; } } } 