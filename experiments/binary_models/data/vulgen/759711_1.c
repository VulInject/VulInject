static unsigned long get_value_for_name ( unsigned long addr , const char * name ) { char * line = NULL ; size_t size = 0 ; char * value_ptr ; FILE * smaps = NULL ; unsigned long value = - 1UL ; smaps = seek_to_smaps_entry ( addr ) ; if ( ! smaps ) { printf ( "Unable to parse /proc/self/smaps\n" ) ; out } while ( getline ( & line , & size , smaps ) > 0 ) { if ( ! strstr ( line , name ) ) { line = NULL ; size = 0 ; continue ; } value_ptr = line + strlen ( name ) ; if ( sscanf ( value_ptr , "%lu kB" , & value ) < 1 ) { printf ( "Unable to parse smaps entry for Size\n" ) ; out } break ; } out if ( smaps ) { fclose ( smaps ) ; } free ( line ) ; return value ; } 