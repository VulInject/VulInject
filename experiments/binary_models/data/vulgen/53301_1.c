static int test_reboot ( int cmd , int sig ) { long stack_size = 4096 ; void * stack = alloca ( stack_size ) + stack_size ; int status ; ret = __clone2 ( do_reboot , stack , stack_size , CLONE_NEWPID | SIGCHLD , & cmd ) ; ret = clone ( do_reboot , stack , CLONE_NEWPID | SIGCHLD , & cmd ) ; if ( ret < 0 ) { printf ( "failed to clone: %s\n" , strerror ( errno ) ) ; return - 1 ; } if ( wait ( & status ) < 0 ) { printf ( "unexpected wait error: %s\n" , strerror ( errno ) ) ; return - 1 ; } if ( ! WIFSIGNALED ( status ) ) { if ( sig != - 1 ) { printf ( "child process exited but was not signaled\n" ) ; } return - 1 ; } if ( WTERMSIG ( status ) != sig ) { printf ( "signal termination is not the one expected\n" ) ; return - 1 ; } return 0 ; } 