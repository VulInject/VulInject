int aarch32_break_handler ( struct pt_regs * regs ) { u32 arm_instr ; u16 thumb_instr ; bool bp = false ; void __user * pc = ( void __user * ) instruction_pointer ( regs ) ; if ( ! compat_user_mode ( regs ) ) { return - EFAULT ; } if ( compat_thumb_mode ( regs ) ) { get_user ( thumb_instr , ( u16 __user * ) pc ) ; thumb_instr = le16_to_cpu ( thumb_instr ) ; if ( thumb_instr == AARCH32_BREAK_THUMB2_LO ) { get_user ( thumb_instr , ( u16 __user * ) ( pc + 2 ) ) ; thumb_instr = le16_to_cpu ( thumb_instr ) ; bp = thumb_instr == AARCH32_BREAK_THUMB2_HI ; } else { bp = thumb_instr == AARCH32_BREAK_THUMB ; } } else { get_user ( arm_instr , ( u32 __user * ) pc ) ; arm_instr = le32_to_cpu ( arm_instr ) ; } if ( ! bp ) { return - EFAULT ; } send_user_sigtrap ( TRAP_BRKPT ) ; return 0 ; } 