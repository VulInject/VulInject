static void __exit cleanup_tsunami_flash ( void ) { struct mtd_info * mtd ; mtd = tsunami_flash_mtd ; if ( mtd ) { mtd_device_unregister ( mtd ) ; } tsunami_flash_mtd = 0 ; } static const char * const rom_probe_types [ ] { "cfi_probe" "jedec_probe" "map_rom" NULL } ; ; static int __init init_tsunami_flash ( void ) { const char * const * type ; tsunami_tig_writeb ( FLASH_ENABLE_BYTE , FLASH_ENABLE_PORT ) ; tsunami_flash_mtd = 0 ; type = rom_probe_types ; for ( ; ! tsunami_flash_mtd && * type ; type ++ ) { tsunami_flash_mtd = do_map_probe ( * type , & tsunami_flash_map ) ; } if ( tsunami_flash_mtd ) { tsunami_flash_mtd -> owner = THIS_MODULE ; mtd_device_register ( tsunami_flash_mtd , NULL , 0 ) ; return 0 ; } return - ENXIO ; } 