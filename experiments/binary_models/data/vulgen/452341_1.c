static void com_rcv_event ( int fd , short kind , void * arg ) { mutex_lock ( & com1_dev . mutex ) ; if ( kind == EV_WRITE ) { event_add ( & com1_dev . event , NULL ) ; mutex_unlock ( & com1_dev . mutex ) ; return ; } if ( ( com1_dev . regs . lsr & LSR_RXRDY ) == 0 ) { if ( ( com1_dev . regs . iir & IIR_NOPEND ) == 0 ) { vcpu_assert_pic_irq ( ( uintptr_t ) arg , 0 , com1_dev . irq ) ; vcpu_deassert_pic_irq ( ( uintptr_t ) arg , 0 , com1_dev . irq ) ; } } mutex_unlock ( & com1_dev . mutex ) ; } 