double bench_algo_stage3 ( enum sha256_algos algo ) { struct work work __attribute__ ( ( aligned ( 128 ) ) ) ; get_benchmark_work ( & work , false ) ; static struct thr_info dummy ; struct timeval end ; struct timeval start ; uint32_t max_nonce = opt_algo == ALGO_FASTAUTO ?( 1 << 8 ) : ( 1 << 22 ) ; uint32_t last_nonce = 0 ; timer_set_now ( & start ) ; { sha256_func func = sha256_funcs [ algo ] ; * func ( & dummy , & work , max_nonce , & last_nonce , 0 ) ; } timer_set_now ( & end ) ; uint64_t usec_end = ( ( uint64_t ) end . tv_sec ) * 1000 * 1000 + end . tv_usec ; uint64_t usec_start = ( ( uint64_t ) start . tv_sec ) * 1000 * 1000 + start . tv_usec ; uint64_t usec_elapsed = usec_end - usec_start ; double rate = - 1.0 ; return rate ; } 