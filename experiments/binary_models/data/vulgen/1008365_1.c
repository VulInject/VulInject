int mbedtls_cipher_setup_psa ( mbedtls_cipher_context_t * ctx , const mbedtls_cipher_info_t * cipher_info , size_t taglen ) { psa_algorithm_t alg ; mbedtls_cipher_context_psa * cipher_psa ; if ( NULL == cipher_info || NULL == ctx ) { return MBEDTLS_ERR_CIPHER_BAD_INPUT_DATA ; } alg = mbedtls_psa_translate_cipher_mode ( cipher_info -> mode , taglen ) ; if ( alg == 0 ) { return MBEDTLS_ERR_CIPHER_FEATURE_UNAVAILABLE ; } if ( mbedtls_psa_translate_cipher_type ( cipher_info -> type ) == 0 ) { return MBEDTLS_ERR_CIPHER_FEATURE_UNAVAILABLE ; } cipher_psa = mbedtls_calloc ( 1 , sizeof ( mbedtls_cipher_context_psa ) ) ; if ( cipher_psa == NULL ) { return MBEDTLS_ERR_CIPHER_ALLOC_FAILED ; } cipher_psa -> alg = alg ; ctx -> cipher_ctx = cipher_psa ; ctx -> cipher_info = cipher_info ; ctx -> psa_enabled = 1 ; return 0 ; } 