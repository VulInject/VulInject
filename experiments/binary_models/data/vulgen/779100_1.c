static void vcn_v4_0_mc_resume ( struct amdgpu_device * adev , int inst ) { uint32_t offset , size ; const struct common_firmware_header * hdr ; hdr = ( const common_firmware_header * ) adev -> vcn . fw -> data ; if ( adev -> firmware . load_type == AMDGPU_FW_LOAD_PSP ) { WREG32_SOC15 ( VCN , inst , regUVD_LMI_VCPU_CACHE_64BIT_BAR_LOW , ( adev -> firmware . ucode [ AMDGPU_UCODE_ID_VCN + inst ] . tmr_mc_addr_lo ) ) ; WREG32_SOC15 ( VCN , inst , regUVD_LMI_VCPU_CACHE_64BIT_BAR_HIGH , ( adev -> firmware . ucode [ AMDGPU_UCODE_ID_VCN + inst ] . tmr_mc_addr_hi ) ) ; WREG32_SOC15 ( VCN , inst , regUVD_VCPU_CACHE_OFFSET0 , 0 ) ; offset = 0 ; } else { WREG32_SOC15 ( VCN , inst , regUVD_LMI_VCPU_CACHE_64BIT_BAR_LOW , lower_32_bits ( adev -> vcn . inst [ inst ] . gpu_addr ) ) ; WREG32_SOC15 ( VCN , inst , regUVD_LMI_VCPU_CACHE_64BIT_BAR_HIGH , upper_32_bits ( adev -> vcn . inst [ inst ] . gpu_addr ) ) ; offset = size ; WREG32_SOC15 ( VCN , inst , regUVD_VCPU_CACHE_OFFSET0 , AMDGPU_UVD_FIRMWARE_OFFSET >> 3 ) ; } WREG32_SOC15 ( VCN , inst , regUVD_VCPU_CACHE_SIZE0 , size ) ; WREG32_SOC15 ( VCN , inst , regUVD_LMI_VCPU_CACHE1_64BIT_BAR_LOW , lower_32_bits ( adev -> vcn . inst [ inst ] . gpu_addr + offset ) ) ; WREG32_SOC15 ( VCN , inst , regUVD_LMI_VCPU_CACHE1_64BIT_BAR_HIGH , upper_32_bits ( adev -> vcn . inst [ inst ] . gpu_addr + offset ) ) ; WREG32_SOC15 ( VCN , inst , regUVD_VCPU_CACHE_OFFSET1 , 0 ) ; WREG32_SOC15 ( VCN , inst , regUVD_VCPU_CACHE_SIZE1 , AMDGPU_VCN_STACK_SIZE ) ; WREG32_SOC15 ( VCN , inst , regUVD_LMI_VCPU_CACHE2_64BIT_BAR_LOW , lower_32_bits ( adev -> vcn . inst [ inst ] . gpu_addr + offset + AMDGPU_VCN_STACK_SIZE ) ) ; WREG32_SOC15 ( VCN , inst , regUVD_LMI_VCPU_CACHE2_64BIT_BAR_HIGH , upper_32_bits ( adev -> vcn . inst [ inst ] . gpu_addr + offset + AMDGPU_VCN_STACK_SIZE ) ) ; WREG32_SOC15 ( VCN , inst , regUVD_VCPU_CACHE_OFFSET2 , 0 ) ; WREG32_SOC15 ( VCN , inst , regUVD_VCPU_CACHE_SIZE2 , AMDGPU_VCN_CONTEXT_SIZE ) ; WREG32_SOC15 ( VCN , inst , regUVD_LMI_VCPU_NC0_64BIT_BAR_LOW , lower_32_bits ( adev -> vcn . inst [ inst ] . fw_shared . gpu_addr ) ) ; WREG32_SOC15 ( VCN , inst , regUVD_LMI_VCPU_NC0_64BIT_BAR_HIGH , upper_32_bits ( adev -> vcn . inst [ inst ] . fw_shared . gpu_addr ) ) ; WREG32_SOC15 ( VCN , inst , regUVD_VCPU_NONCACHE_OFFSET0 , 0 ) ; WREG32_SOC15 ( VCN , inst , regUVD_VCPU_NONCACHE_SIZE0 , AMDGPU_GPU_PAGE_ALIGN ( sizeof ( amdgpu_vcn4_fw_shared ) ) ) ; } 