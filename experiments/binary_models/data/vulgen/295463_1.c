static void add_patterns_from_gitignore ( const char * dir , int dirlen ) { struct stat st ; char path [ PATH_MAX ] , * buf , * entry ; size_t size ; int fd , pathlen , i ; pathlen = snprintf ( path , sizeof ( path ) , "%s/.gitignore" , dir ) ; if ( pathlen >= sizeof ( path ) ) { error_exit ( "%s: too long path was truncated\n" , path ) ; } fd = open ( path , O_RDONLY | O_NOFOLLOW ) ; if ( fd < 0 ) { if ( errno != ENOENT ) { return perror_exit ( path ) ; } return ; } if ( fstat ( fd , & st ) < 0 ) { perror_exit ( path ) ; } size = st . st_size ; buf = xmalloc ( size + 1 ) ; if ( read ( fd , buf , st . st_size ) != st . st_size ) { perror_exit ( path ) ; } buf [ st . st_size ] = '\n' ; if ( close ( fd ) ) { perror_exit ( path ) ; } debug ( "Parse %s\n" , path ) ; entry = buf ; if ( ! strncmp ( entry , utf8_bom , strlen ( utf8_bom ) ) ) { entry += strlen ( utf8_bom ) ; } for ( i = entry - buf ; i < size ; i ++ ) { } free ( buf ) ; } 