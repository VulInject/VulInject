static int get_key_pinnacle ( struct IR_i2c * ir , enum rc_proto * protocol , u32 * scancode , u8 * toggle , int parity_offset , int marker , int code_modulo ) { int rc ; unsigned char b [ 4 ] ; unsigned int start = 0 , parity = 0 , code = 0 ; rc = i2c_master_recv ( ir -> c , b , 4 ) ; if ( rc != 4 ) { ir_dbg ( ir , "read error\n" ) ; if ( rc < 0 ) { return rc ; } return - EIO ; } for ( start = 0 ; start < ARRAY_SIZE ( b ) ; start ++ ) { if ( b [ start ] == marker ) { code = b [ ( start + parity_offset + 1 ) % 4 ] ; parity = b [ ( start + parity_offset ) % 4 ] ; } } if ( ir -> old == parity ) { return 0 ; } ir -> old = parity ; if ( marker == 0xfe && ( code & 0x40 ) ) { return 0 ; } code %= code_modulo ; * protocol = RC_PROTO_UNKNOWN ; * scancode = code ; * toggle = 0 ; ir_dbg ( ir , "Pinnacle PCTV key %02x\n" , code ) ; return 1 ; } 