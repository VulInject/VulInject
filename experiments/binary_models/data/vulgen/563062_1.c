ssize_t drm_scdc_write ( struct i2c_adapter * adapter , u8 offset , const void * buffer , size_t size ) { struct i2c_msg msg = { . addr = SCDC_I2C_SLAVE_ADDRESS . flags = 0 . len = 1 + size . buf = NULL } ; void * data ; int err ; data = kmalloc ( 1 + size , GFP_KERNEL ) ; if ( ! data ) { return - ENOMEM ; } msg . buf = data ; memcpy ( data , & offset , sizeof ( offset ) ) ; memcpy ( data + 1 , buffer , size ) ; err = i2c_transfer ( adapter , & msg , 1 ) ; if ( err < 0 ) { return err ; } if ( err != 1 ) { return - EPROTO ; } return 0 ; } 