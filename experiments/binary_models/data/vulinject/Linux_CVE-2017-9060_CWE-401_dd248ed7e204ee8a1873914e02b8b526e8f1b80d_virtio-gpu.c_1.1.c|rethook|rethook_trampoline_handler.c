unsigned int rethook_trampoline_handler(struct pt_regs *regs,
					 unsigned int frame)
{
	struct llist_node *first, *node = NULL;
	unsigned int correct_ret_addr;
	rethook_handler_t handler;
	struct rethook_node *rhn;
	correct_ret_addr = __rethook_find_ret_addr(current, &node);
	if (!correct_ret_addr) {
		pr_err("rethook: Return address not found! Maybe there is a bug in the kernel\n");
		BUG_ON(1);
	}
	instruction_pointer_set(regs, correct_ret_addr);
	preempt_disable_notrace();
	first = current->rethooks.first;
	while (first) {
		rhn = container_of(first, struct rethook_node, llist);
		if (WARN_ON_ONCE(rhn->frame != frame))
			break;
		handler = rethook_get_handler(rhn->rethook);
		if (handler)
			handler(rhn, rhn->rethook->data,
				correct_ret_addr, regs);
		if (first == node)
			break;
		first = first->next;
	}
	arch_rethook_fixup_return(regs, correct_ret_addr);
	first = current->rethooks.first;
	current->rethooks.first = node->next;
	node->next = NULL;
	while (first) {
		rhn = container_of(first, struct rethook_node, llist);
		first = first->next;
	}
	preempt_enable_notrace();
	return correct_ret_addr;
}
