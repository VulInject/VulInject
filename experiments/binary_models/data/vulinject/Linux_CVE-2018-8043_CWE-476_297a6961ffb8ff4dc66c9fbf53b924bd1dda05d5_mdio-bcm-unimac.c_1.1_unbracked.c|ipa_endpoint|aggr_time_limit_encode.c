static unsigned int aggr_time_limit_encode(struct ipa *ipa, const struct reg *reg,
				  unsigned int microseconds)
{
	unsigned int ticks;
	max = reg_field_max(reg, TIME_LIMIT);
	if (ipa->version >= IPA_VERSION_4_5) {
		unsigned int select;
		ticks = ipa_qtime_val(ipa, microseconds, max, &select);
		return reg_encode(reg, AGGR_GRAN_SEL, select) |
		       reg_encode(reg, TIME_LIMIT, ticks);
	}
	ticks = DIV_ROUND_CLOSEST(microseconds, IPA_AGGR_GRANULARITY);
	WARN(ticks > max, "aggr_time_limit too large (%u > %u usec)\n",
	     microseconds, max * IPA_AGGR_GRANULARITY);
	return reg_encode(reg, TIME_LIMIT, ticks);
}
