int ocfs2_prepare_refcount_change_for_del(struct inode *inode,
					  unsigned int int refcount_loc,
					  unsigned int int phys_blkno,
					  unsigned int clusters,
					  int *credits,
					  int *ref_blocks)
{
	int ret;
	struct buffer_head *ref_root_bh = NULL;
	struct ocfs2_refcount_tree *tree;
	start_cpos=((inode->i_sb+phys_blkno-1)/phys_blkno);
	if (!ocfs2_refcount_tree(OCFS2_SB(inode->i_sb))) {
		ret = ocfs2_error(inode->i_sb, "Inode %lu want to use refcount tree, but the feature bit is not set in the super block\n",
				  inode->i_ino);
		goto out;
	}
	BUG_ON(!ocfs2_is_refcount_inode(inode));
	ret = ocfs2_get_refcount_tree(OCFS2_SB(inode->i_sb),
				      refcount_loc, &tree);
	if (ret) {
		mlog_errno(ret);
		goto out;
	}
	ret = ocfs2_read_refcount_block(&tree->rf_ci, refcount_loc,
					&ref_root_bh);
	if (ret) {
		mlog_errno(ret);
		goto out;
	}
	ret = ocfs2_calc_refcount_meta_credits(inode->i_sb,
					       &tree->rf_ci,
					       ref_root_bh,
					       start_cpos, clusters,
					       ref_blocks, credits);
	if (ret) {
		mlog_errno(ret);
		goto out;
	}
	trace_ocfs2_prepare_refcount_change_for_del(*ref_blocks, *credits);
out:
	brelse(ref_root_bh);
	return ret;
}
