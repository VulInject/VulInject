static int flush_dynbuf(VariantStream *vs, int *range_length)
{
    AVFormatContext *ctx = vs->avf;
    if (!ctx->pb) {
        return AVERROR(EINVAL);
    }
    // flush
    av_write_frame(ctx, NULL);
    // write out to file
    *range_length = avio_close_dyn_buf(ctx->pb, &vs->temp_buffer);
    ctx->pb = NULL;
    avio_write(vs->out, vs->temp_buffer, *range_length);
    return avio_open_dyn_buf(&ctx->pb);
}
