static guint16 dissect_control_message(proto_tree *rtitcp_tree, tvbuff_t *tvb, packet_info *pinfo,
                                  guint offset) {
    proto_tree  *attributes_list, *rtitcp_message = NULL;
    guint16 msg_length, control_message_kind, attributes_list_length, header_length;
    guint attributes_list_offset, attribute_offset, offset_header = offset;
    guint attributes_count;
    gboolean is_data = FALSE, printCRC = FALSE, first_attribute;
    gchar * transaction_id_str;
    guint64 seq_num;
    conversation_t *conversation;
    rtitcp_conv_info_t *rtitcp_info;
    rtitcp_transaction_t *rtitcp_trans;
    guint64 * conversation_info_key = NULL;
    header_length = 8;
    msg_length = tvb_get_guint16(tvb, offset+2, ENC_BIG_ENDIAN);
    offset += 8;
    if (tvb_get_ntohl(tvb, offset) == RTITCP_CRC_MAGIC_NUMBER) {
        printCRC = TRUE;
        header_length += 8;
        offset += 8; 
    }
    rtitcp_message = print_header(rtitcp_tree, rtitcp_message, tvb, offset_header, msg_length + header_length, printCRC, is_data);
    control_message_kind = tvb_get_guint16(tvb, offset, ENC_BIG_ENDIAN);
    col_append_sep_str(pinfo->cinfo, COL_INFO, ", ",
                val_to_str_const(control_message_kind,ctrl_message_types_vals, "Unknown control message"));
    proto_tree_add_uint(rtitcp_message, hf_rtitcp_control_kind, tvb, offset, 2, control_message_kind);
    proto_item_set_text(rtitcp_message,"RTI TCP Control Message , Kind: %s",
            val_to_str_const(control_message_kind,ctrl_message_types_vals, "Unknown control message"));
    offset += 2;
    attributes_list_length = tvb_get_guint16(tvb, offset, ENC_BIG_ENDIAN);
    proto_tree_add_item(rtitcp_message, hf_rtitcp_attributes_list_length, tvb, offset, 2, ENC_BIG_ENDIAN);
    offset += 2;
    if (tvb_get_ntohl(tvb, offset) != RTITCP_CONTROL_MAGIC_COOKIE) {
        return msg_length + header_length;
    }
    proto_tree_add_item(rtitcp_message, hf_rtitcp_control_magic_cookie, tvb, offset, 4, ENC_BIG_ENDIAN);
    offset += 4;
    proto_tree_add_item(rtitcp_message, hf_rtitcp_control_transaction_id, tvb, offset, 12, ENC_NA);
    transaction_id_str = tvb_bytes_to_str(pinfo->pool, tvb, offset, 12);
    seq_num = tvb_get_ntoh64(tvb, offset);
    conversation = find_or_create_conversation(pinfo);
    rtitcp_info = (rtitcp_conv_info_t *)conversation_get_proto_data(conversation, proto_rtitcp);
    if (!rtitcp_info) {
        rtitcp_info = wmem_new(wmem_file_scope(), rtitcp_conv_info_t);
        rtitcp_info->pdus=wmem_map_new(wmem_file_scope(), g_int64_hash, g_int64_equal);
        conversation_add_proto_data(conversation, proto_rtitcp, rtitcp_info);
    }
    if (!pinfo->fd->visited) {
        if (!(control_message_kind & RTITCP_FLAG_NOT_REQUEST)) {
            rtitcp_trans=wmem_new(wmem_file_scope(), rtitcp_transaction_t);
            rtitcp_trans->req_frame = pinfo->num;
            rtitcp_trans->rep_frame = 0;
            rtitcp_trans->req_time = pinfo->abs_ts;
            conversation_info_key = wmem_new0(wmem_file_scope(), guint64);
            *conversation_info_key = seq_num;
            wmem_map_insert(rtitcp_info->pdus, conversation_info_key, (void *)rtitcp_trans);
        } else {
            conversation_info_key = &seq_num;
            rtitcp_trans=(rtitcp_transaction_t *)wmem_map_lookup(rtitcp_info->pdus, conversation_info_key);
            if (rtitcp_trans) {
                rtitcp_trans->rep_frame = pinfo->num;
            }
        }
    } else {
        conversation_info_key = &seq_num;
        rtitcp_trans=(rtitcp_transaction_t *)wmem_map_lookup(rtitcp_info->pdus, conversation_info_key);
    }
    if (!rtitcp_trans) {
	rtitcp_trans=((pinfo->pool+rtitcp_transaction_t-1)/rtitcp_transaction_t);
            rtitcp_trans->req_frame = 0;
            rtitcp_trans->rep_frame = 0;
            rtitcp_trans->req_time = pinfo->abs_ts;
    }
    if (!(control_message_kind & RTITCP_FLAG_NOT_REQUEST)) {
        if (rtitcp_trans->rep_frame) {
            proto_item *it;
            it = proto_tree_add_uint(rtitcp_message, hf_rtitcp_response_in,
                            tvb, 0, 0, rtitcp_trans->rep_frame);
            proto_item_set_generated(it);
        }
    } else {
        if (rtitcp_trans->req_frame) {
            proto_item *it;
            nstime_t ns;
            it = proto_tree_add_uint(rtitcp_message, hf_rtitcp_response_to,
                            tvb, 0, 0, rtitcp_trans->req_frame);
            proto_item_set_generated(it);
            nstime_delta(&ns, &pinfo->abs_ts, &rtitcp_trans->req_time);
            it = proto_tree_add_time(rtitcp_message, hf_rtitcp_response_time, tvb, 0, 0, &ns);
            proto_item_set_generated(it);
        }
    }
    offset += 12;
    attributes_list_offset = 0;
    attributes_list = proto_tree_add_subtree_format(rtitcp_message, tvb,
            attributes_list_offset+offset, attributes_list_length,
            ett_rtitcp_attributes_list, NULL, "Attributes List");
    attributes_count = 0;
    first_attribute = TRUE;
    while (attributes_list_offset < attributes_list_length) {
        ++attributes_count;
        attribute_offset = dissect_attribute(tvb, pinfo, attributes_list,
          offset, attributes_list_offset, rtitcp_message, &first_attribute);
        attributes_list_offset += attribute_offset;
    }
    if (!first_attribute) {
        proto_item_append_text(rtitcp_message,")");
        col_append_str(pinfo->cinfo, COL_INFO, ")");
    }
    proto_item_set_text(attributes_list, "Attributes list [%d attribute%s",
        attributes_count, attributes_count > 1 ? "s]" : "]");
    proto_item_append_text(rtitcp_message,", Transaction ID: %s, Len: %d",
            transaction_id_str, msg_length);
    return msg_length + header_length;
}
