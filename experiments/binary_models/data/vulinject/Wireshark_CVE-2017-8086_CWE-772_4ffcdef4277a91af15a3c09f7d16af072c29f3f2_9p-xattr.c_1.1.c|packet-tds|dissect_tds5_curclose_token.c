dissect_tds5_curclose_token(tvbuff_t *tvb, packet_info *pinfo, guint offset,
                              proto_tree *tree, tds_conv_info_t *tds_info)
{
    guint len, cur = offset;
    guint cursorid;
    proto_item *cursor_id_pi;
    tds_cursor_info_t *packet_cursor =
        (tds_cursor_info_t *) p_get_proto_data(wmem_file_scope(), pinfo, proto_tds, 0);
    proto_tree_add_item_ret_uint(tree, hf_tds_curclose_length, tvb, cur, 2, tds_get_int2_encoding(tds_info), &len);
    cur += 2;
    cursor_id_pi = proto_tree_add_item_ret_uint(tree, hf_tds_curclose_cursorid,
        tvb, cur, 4, tds_get_int4_encoding(tds_info), &cursorid);
    cur += 4;
    if (cursorid == 0) {
        gint cursorname_len;
        const guint8 *cursorname;
        proto_item *cursor_name_pi;
        cursor_name_pi = proto_tree_add_item_ret_string_and_length(tree,
            hf_tds_curclose_cursor_name,
            tvb, cur, 1, tds_get_char_encoding(tds_info)|ENC_NA,
            wmem_packet_scope(), &cursorname, &cursorname_len);
        cur += cursorname_len;
        tds5_check_cursor_name(pinfo, cursor_name_pi, packet_cursor, cursorname);
    }
    else if (packet_cursor && cursor_id_pi &&
            (packet_cursor->tds_cursor_flags & TDS_CURSOR_NAME_VALID)) {
        proto_item_append_text(cursor_id_pi, " (%s)",
            packet_cursor->tds_cursor_name);
    }
    proto_tree_add_item(tree, hf_tds_curclose_option_deallocate, tvb, cur, 1, ENC_NA);
    cur += 1;
    if (!PINFO_FD_VISITED(pinfo) && !packet_cursor) {
        tds_conv_cursor_info_t *conv_cursor_info;
        conv_cursor_info = tds_info->tds_conv_cursor_info;
        if (cursorid) {
            tds_cursor_info_t *cursor_current;
            cursor_current =
                (tds_cursor_info_t *) wmem_tree_lookup32(conv_cursor_info->tds_conv_cursor_table,
                                 cursorid);
            if (cursor_current) {
                p_add_proto_data(wmem_file_scope(),
                    pinfo, proto_tds, 0, cursor_current);
            }
        }
    }
    return cur - offset;
}
