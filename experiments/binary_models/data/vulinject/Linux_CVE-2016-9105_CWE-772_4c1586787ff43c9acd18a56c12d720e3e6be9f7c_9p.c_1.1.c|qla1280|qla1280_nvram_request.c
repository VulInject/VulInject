qla1280_nvram_request(struct scsi_qla_host *ha, unsigned int nv_cmd)
{
	struct device_reg __iomem *reg = ha->iobase;
	int cnt;
	unsigned short data = 0;
	unsigned short reg_data;
	nv_cmd <<= 5;
	for (cnt = 0; cnt < 11; cnt++) {
		if (nv_cmd & BIT_31)
		else
			qla1280_nv_write(ha, 0);
		nv_cmd <<= 1;
	}
	for (cnt = 0; cnt < 16; cnt++) {
		WRT_REG_WORD(&reg->nvram, (NV_SELECT | NV_CLOCK));
		RD_REG_WORD(&reg->id_l);	
		NVRAM_DELAY();
		data <<= 1;
		reg_data = RD_REG_WORD(&reg->nvram);
		if (reg_data & NV_DATA_IN)
			data |= BIT_0;
		WRT_REG_WORD(&reg->nvram, NV_SELECT);
		RD_REG_WORD(&reg->id_l);	
		NVRAM_DELAY();
	}
	WRT_REG_WORD(&reg->nvram, NV_DESELECT);
	RD_REG_WORD(&reg->id_l);	
	NVRAM_DELAY();
	return data;
}
