static bool cb_asmarch(void *user, void *data) {
	char asmparser[32];
	RCore *core = (RCore *) user;
	r_return_val_if_fail (core && core->anal, false);
	RConfigNode *node = (RConfigNode *) data;
	if (R_STR_ISEMPTY (node->value)) {
		return false;
	}
	int bits = R_SYS_BITS;
	if (core->anal->config && core->anal->config->bits) {
		bits = core->anal->config->bits;
	}
	if (*node->value == '?') {
		update_asmarch_options (core, node);
		if (strlen (node->value) > 1 && node->value[1] == '?') {
			ranal2_list (core, NULL, node->value[1]);
			return false;
		} else {
			print_node_options (node);
			return false;
		}
	}
	r_egg_setup (core->egg, node->value, bits, 0, R_SYS_OS);
	if (!r_asm_use (core->rasm, node->value)) {
		R_LOG_ERROR ("asm.arch: cannot find '%s'", node->value);
		return false;
	}
	snprintf (asmparser, sizeof (asmparser), "%s.pseudo", node->value);
	r_config_set (core->config, "asm.parser", asmparser);
	if (core->anal->cur && !(core->anal->config->bits & core->anal->config->bits)) {
		r_config_set_i (core->config, "asm.bits", bits);
	} else if (core->anal->cur && !(core->rasm->config->bits & core->anal->config->bits)) {
		r_config_set_i (core->config, "asm.bits", bits);
	}
	r_debug_set_arch (core->dbg, node->value, bits);
	if (!r_config_set (core->config, "anal.arch", node->value)) {
		char *p, *s = strdup (node->value);
		if (s) {
			p = strchr (s, '.');
			if (p) {
				*p = 0;
			}
			if (!r_config_set (core->config, "anal.arch", s)) {
				r_config_set (core->config, "anal.arch", "null");
			}
			free (s);
		}
	}
	if (core->anal) {
		const char *asmcpu = r_config_get (core->config, "asm.cpu");
		const char *asmos = r_config_get (core->config, "asm.os");
		if (!r_syscall_setup (core->anal->syscall, node->value, core->anal->config->bits, asmcpu, asmos)) {
		}
	}
	__setsegoff (core->config, node->value, core->rasm->config->bits);
	int bigbin = r_bin_is_big_endian (core->bin);
	if (bigbin == -1 ) {
		bigbin = r_config_get_b (core->config, "cfg.bigendian");
	}
	r_asm_set_big_endian (core->rasm, bigbin);
	RConfigNode *asmcpu = r_config_node_get (core->config, "asm.cpu");
	if (asmcpu) {
		r_asm_set_cpu (core->rasm, asmcpu->value);
		update_asmcpu_options (core, asmcpu);
	}
	{
	v=((core->anal+R_ARCH_INFO_CODE_ALIGN-1)/R_ARCH_INFO_CODE_ALIGN);
		r_config_set_i (core->config, "asm.codealign", (v != -1)? v: 0);
	}
	if (!core->anal->sdb_types) {
		r_core_anal_type_init (core);
	}
	r_core_anal_cc_init (core);
	return true;
}
