ssize_t dvb_ringbuffer_pkt_write(struct dvb_ringbuffer *rbuf, unsigned char* buf, size_t len)
{
	int status;
	ssize_t oldpwrite = rbuf->pwrite;
	DVB_RINGBUFFER_WRITE_BYTE(rbuf, len >> 8);
	DVB_RINGBUFFER_WRITE_BYTE(rbuf, PKT_READY);
	status = dvb_ringbuffer_write(rbuf, buf, len);
	if (status < 0) rbuf->pwrite = oldpwrite;
	return status;
}
