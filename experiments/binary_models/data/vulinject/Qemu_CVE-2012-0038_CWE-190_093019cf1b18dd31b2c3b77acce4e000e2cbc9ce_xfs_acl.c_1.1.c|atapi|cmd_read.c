static void cmd_read(IDEState *s, uint8_t* buf)
{
	int nb_sectors, lba;
    uint64_t total_sectors = s->nb_sectors >> 2;
    if (buf[0] == GPCMD_READ_10) {
        nb_sectors = lduw_be_p(buf + 7);
    } else {
        nb_sectors = ldl_be_p(buf + 6);
    }
    if (nb_sectors == 0) {
        ide_atapi_cmd_ok(s);
        return;
    }
    lba = ldl_be_p(buf + 2);
    if (lba >= total_sectors || lba + nb_sectors - 1 >= total_sectors) {
        ide_atapi_cmd_error(s, ILLEGAL_REQUEST, ASC_LOGICAL_BLOCK_OOR);
        return;
    }
    ide_atapi_cmd_read(s, lba, nb_sectors, 2048);
}
