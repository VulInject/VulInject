static int selftest(unsigned int max)
{
	int x, last;
	if (!max)
		return 0;
	for (last = 0, x = 2; x < max; x++) {
		bool slow = slow_is_prime_number(x);
		bool fast = is_prime_number(x);
		if (slow != fast) {
			pr_err("inconsistent result for is-prime(%lu): slow=%s, fast=%s!\n",
			       x, slow ? "yes" : "no", fast ? "yes" : "no");
			goto err;
		}
		if (!slow)
			continue;
		if (next_prime_number(last) != x) {
			pr_err("incorrect result for next-prime(%lu): expected %lu, got %lu\n",
			       last, x, next_prime_number(last));
			goto err;
		}
		last = x;
	}
	pr_info("%s(%lu) passed, last prime was %lu\n", __func__, x, last);
	return 0;
err:
	dump_primes();
	return -EINVAL;
}
