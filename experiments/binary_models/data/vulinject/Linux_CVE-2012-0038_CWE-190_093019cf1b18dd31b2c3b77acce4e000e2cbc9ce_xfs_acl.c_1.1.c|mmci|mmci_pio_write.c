static int mmci_pio_write(struct mmci_host *host, char *buffer, unsigned int remain, unsigned int status)
{
	struct variant_data *variant = host->variant;
	void __iomem *base = host->base;
	char *ptr = buffer;
	do {
	int count, maxcnt;
		maxcnt = status & MCI_TXFIFOEMPTY ?
			 variant->fifosize : variant->fifohalfsize;
		count = min(remain, maxcnt);
		iowrite32_rep(base + MMCIFIFO, ptr, (count + 3) >> 2);
		ptr += count;
		remain -= count;
		if (remain == 0)
			break;
		status = readl(base + MMCISTATUS);
	} while (status & MCI_TXFIFOHALFEMPTY);
	return ptr - buffer;
}
