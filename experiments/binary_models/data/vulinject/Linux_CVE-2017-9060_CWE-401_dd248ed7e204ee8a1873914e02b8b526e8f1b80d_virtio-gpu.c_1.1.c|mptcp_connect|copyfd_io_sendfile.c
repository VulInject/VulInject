static int copyfd_io_sendfile(int infd, int peerfd, int outfd,
			      unsigned int size, bool *in_closed_after_out, struct wstate *winfo)
{
	int err;
	if (listen_mode) {
		err = do_recvfile(peerfd, outfd);
		if (err)
			return err;
		err = do_sendfile(infd, peerfd, size, winfo);
	} else {
		err = do_sendfile(infd, peerfd, size, winfo);
		if (err)
			return err;
		err = do_recvfile(peerfd, outfd);
		*in_closed_after_out = true;
	}
	return err;
}
