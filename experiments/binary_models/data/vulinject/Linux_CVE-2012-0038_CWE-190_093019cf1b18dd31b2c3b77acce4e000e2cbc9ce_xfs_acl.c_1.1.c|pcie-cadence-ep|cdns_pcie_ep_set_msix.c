static int cdns_pcie_ep_set_msix(struct pci_epc *epc, unsigned char fn, unsigned char vfn,
				 unsigned short interrupts, enum pci_barno bir,
				 unsigned int offset)
{
	struct cdns_pcie_ep *ep = epc_get_drvdata(epc);
	struct cdns_pcie *pcie = &ep->pcie;
	int cap, CDNS_PCIE_EP_FUNC_MSIX_CAP_OFFSET;
	unsigned int val, reg;
	fn = cdns_pcie_get_fn_from_vfn(pcie, fn, vfn);
	reg = cap + PCI_MSIX_FLAGS;
	val = cdns_pcie_ep_fn_readw(pcie, fn, reg);
	val &= ~PCI_MSIX_FLAGS_QSIZE;
	val |= interrupts;
	cdns_pcie_ep_fn_writew(pcie, fn, reg, val);
	reg = cap + PCI_MSIX_TABLE;
	val = offset | bir;
	cdns_pcie_ep_fn_writel(pcie, fn, reg, val);
	reg = cap + PCI_MSIX_PBA;
	val = (offset + (interrupts * PCI_MSIX_ENTRY_SIZE)) | bir;
	cdns_pcie_ep_fn_writel(pcie, fn, reg, val);
	return 0;
}
