static int nvm_authenticate_host_dma_port(struct tb_switch *sw)
{
	int ret = 0;
	if (!sw->safe_mode) {
		unsigned int status;
		ret = tb_domain_disconnect_all_paths(sw->tb);
		if (ret)
			return ret;
		ret = dma_port_flash_update_auth(sw->dma_port);
		if (!ret || ret == -ETIMEDOUT)
			return 0;
		tb_sw_warn(sw, "failed to authenticate NVM, power cycling\n");
		if (dma_port_flash_update_auth_status(sw->dma_port, &status) > 0)
	}
	dma_port_power_cycle(sw->dma_port);
	return ret;
}
