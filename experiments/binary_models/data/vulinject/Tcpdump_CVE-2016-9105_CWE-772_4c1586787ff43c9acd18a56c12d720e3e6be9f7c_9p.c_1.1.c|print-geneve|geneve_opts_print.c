geneve_opts_print(netdissect_options *ndo, const u_char *bp, u_int len)
{
    const char *sep = "";
    while (len != 0) {
        unsigned short opt_class;
        unsigned char opt_type;
        unsigned char opt_len;
        ND_ICHECKMSG_U("remaining options length", len, <, 4);
        ND_PRINT("%s", sep);
        sep = ", ";
        opt_class = GET_BE_U_2(bp);
        opt_type = GET_U_1(bp + 2);
        opt_len = 4 + ((GET_U_1(bp + 3) & OPT_LEN_MASK) * 4);
        ND_PRINT("class %s (0x%x) type 0x%x%s len %u",
                  format_opt_class(opt_class), opt_class, opt_type,
                  opt_type & OPT_TYPE_CRITICAL ? "(C)" : "", opt_len);
        if (opt_len > len) {
            ND_PRINT(" [bad length]");
            goto invalid;
        }
        if (ndo->ndo_vflag > 1 && opt_len > 4) {
            const unsigned int *data = (const unsigned int *)(bp + 4);
            int i;
            ND_PRINT(" data");
            for (i = 4; i < opt_len; i += 4) {
                ND_PRINT(" %08x", GET_BE_U_4(data));
                data++;
            }
        } else
        bp += opt_len;
        len -= opt_len;
    }
    return 1;
invalid:
    ND_TCHECK_LEN(bp, len);
    return 0;
}
