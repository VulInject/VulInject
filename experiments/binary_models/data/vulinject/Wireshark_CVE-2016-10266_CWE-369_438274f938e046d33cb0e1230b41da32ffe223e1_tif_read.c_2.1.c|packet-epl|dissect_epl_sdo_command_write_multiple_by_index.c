dissect_epl_sdo_command_write_multiple_by_index(struct epl_convo *convo, proto_tree *epl_tree, tvbuff_t *tvb, packet_info *pinfo, gint offset, guint8 segmented, gboolean response, guint16 segment_size)
{
	gint dataoffset;
	guint8 subindex = 0x00,  padding = 0x00;
	guint16 idx = 0x00, error = 0xFF, sub_val = 0x00;
	gboolean nosub = FALSE;
	guint32 size, offsetincrement, datalength, remlength, objectcnt, abort_code = 0;
	gboolean lastentry = FALSE, is_abort = FALSE;
	const gchar *index_str, *sub_str, *sub_index_str;
	proto_item *psf_item;
	proto_tree *psf_od_tree;
	struct object *obj = NULL;
	const struct subobject *subobj = NULL;
	guint16 segment_restsize = segment_size;
	if (!response)
	{   
		col_append_fstr(pinfo->cinfo, COL_INFO, "%s[%d]:",
				val_to_str_ext(EPL_ASND_SDO_COMMAND_WRITE_MULTIPLE_PARAMETER_BY_INDEX,
				&epl_sdo_asnd_commands_short_ext, "Command(%02X)"),
				segment_size);
		remlength = (guint32)tvb_reported_length_remaining(tvb, offset);
		objectcnt = 0;
		while ( !lastentry && remlength > 0 )
		{
			guint16 sod_index = error;
			offsetincrement = tvb_get_letohl(tvb, offset);
			padding = tvb_get_guint8 ( tvb, offset + 7 ) & 0x03;
			if (offsetincrement == 0)
			{
				datalength = segment_restsize;
				lastentry = TRUE;
			}
			else
			{
				datalength = offsetincrement - (offset - EPL_SOA_EPLV_OFFSET);
			}
			segment_restsize -= datalength;
			if ( datalength > remlength )
				break;
			if ((guint32)(padding + 8) >= datalength)
				break;
			size = datalength - 8 - padding;
			dataoffset = offset + 4;
			psf_od_tree = proto_tree_add_subtree(epl_tree, tvb, offset+4, 4+size, 0, NULL , "OD");
			if (segmented <= EPL_ASND_SDO_CMD_SEGMENTATION_INITIATE_TRANSFER)
			{
				idx = tvb_get_letohs(tvb, dataoffset);
				psf_item = proto_tree_add_item(psf_od_tree, hf_epl_asnd_sdo_cmd_data_index, tvb, offset+4, 2, ENC_LITTLE_ENDIAN);
	obj=((convo->profile+idx-1)/idx);
				if (!obj)
				{
					index_str = rval_to_str_const(idx, sod_cmd_str, "unknown");
					sod_index = str_to_val(index_str, sod_cmd_str_val, error);
					sub_index_str = val_to_str_ext_const(idx, &sod_cmd_no_sub, "unknown");
					nosub = str_to_val(sub_index_str, sod_cmd_str_no_sub, 0xFF) != 0xFF;
				}
				if(sod_index == error)
				{
					const char *name = obj ? obj->info.name :val_to_str_ext_const(((guint32)(idx<<16)), &sod_index_names, "User Defined");
					proto_item_append_text(psf_item," (%s)", name);
				}
				else
				{
					proto_item_append_text(psf_item," (%s", val_to_str_ext_const(((guint32)(sod_index<<16)), &sod_index_names, "User Defined"));
					proto_item_append_text(psf_item,"_%02Xh", (idx-sod_index));
					if(sod_index == EPL_SOD_PDO_RX_MAPP || sod_index == EPL_SOD_PDO_TX_MAPP)
					{
						proto_item_append_text(psf_item,"_AU64)");
					}
					else
					{
						proto_item_append_text(psf_item,"_REC)");
					}
				}
				if (objectcnt < 8)
					col_append_fstr(pinfo->cinfo, COL_INFO, " (0x%04X", idx);
				else
					col_append_str(pinfo->cinfo, COL_INFO, ".");
				dataoffset += 2;
				proto_item_append_text(psf_od_tree, " Idx: 0x%04X", idx);
				if (sod_index != error)
					idx = sod_index;
				subindex = tvb_get_guint8(tvb, dataoffset);
				subobj = subobject_lookup(obj, subindex);
				proto_item_append_text(psf_od_tree, " SubIdx: 0x%02X", subindex);
				sub_str = val_to_str_ext_const(idx, &sod_cmd_sub_str, "unknown");
				sub_val = str_to_val(sub_str, sod_cmd_sub_str_val,error);
				if(sub_val != error)
					idx = sub_val;
				if (subobj)
				{
					psf_item = proto_tree_add_item(psf_od_tree, hf_epl_asnd_sdo_cmd_data_subindex, tvb, dataoffset, 1, ENC_LITTLE_ENDIAN);
					proto_item_append_text(psf_item, " (%s)", subobj->info.name);
				}
				else if(idx == EPL_SOD_STORE_PARAM && subindex <= 0x7F && subindex >= 0x04)
				{
					psf_item = proto_tree_add_item(psf_od_tree, hf_epl_asnd_sdo_cmd_data_subindex, tvb, dataoffset, 1, ENC_LITTLE_ENDIAN);
					proto_item_append_text(psf_item, " (ManufacturerParam_%02Xh_U32)", subindex);
				}
				else if(idx == EPL_SOD_RESTORE_PARAM && subindex <= 0x7F && subindex >= 0x04)
				{
					psf_item = proto_tree_add_item(psf_od_tree, hf_epl_asnd_sdo_cmd_data_subindex, tvb, dataoffset, 1, ENC_LITTLE_ENDIAN);
					proto_item_append_text(psf_item, " (ManufacturerParam_%02Xh_U32)", subindex);
				}
				else if(idx == EPL_SOD_PDO_RX_MAPP && subindex >= 0x01 && subindex <= 0xfe)
				{
					psf_item = proto_tree_add_item(psf_od_tree, hf_epl_asnd_sdo_cmd_data_subindex, tvb, dataoffset, 1, ENC_LITTLE_ENDIAN);
					proto_item_append_text(psf_item, " (ObjectMapping)");
				}
				else if(idx == EPL_SOD_PDO_TX_MAPP && subindex >= 0x01 && subindex <= 0xfe)
				{
					psf_item = proto_tree_add_item(psf_od_tree, hf_epl_asnd_sdo_cmd_data_subindex, tvb, dataoffset, 1, ENC_LITTLE_ENDIAN);
					proto_item_append_text(psf_item, " (ObjectMapping)");
				}
				else if(subindex == 0x00)
				{
					psf_item = proto_tree_add_item(psf_od_tree, hf_epl_asnd_sdo_cmd_data_subindex, tvb, dataoffset, 1, ENC_LITTLE_ENDIAN);
					proto_item_append_text(psf_item, " (NumberOfEntries)");
				}
				else
				{
					psf_item = proto_tree_add_item(psf_od_tree, hf_epl_asnd_sdo_cmd_data_subindex, tvb, dataoffset, 1, ENC_LITTLE_ENDIAN);
					proto_item_append_text(psf_item, " (%s)", val_to_str_ext_const((subindex | (idx << 16)), &sod_index_names, "User Defined"));
				}
				if (objectcnt < 8)
				{
					if (nosub)
						col_append_fstr(pinfo->cinfo, COL_INFO, ")");
					else
						col_append_fstr(pinfo->cinfo, COL_INFO, "/%d)", subindex);
				}
				dataoffset += 1;
				proto_tree_add_uint(psf_od_tree, hf_epl_asnd_sdo_cmd_data_padding, tvb, dataoffset, 1, padding);
				dataoffset += 1;
				objectcnt++;
			}
			psf_item = proto_tree_add_uint_format(psf_od_tree, hf_epl_asnd_sdo_cmd_data_size, tvb, dataoffset, size, size, "Data size: %d byte", size);
			proto_item_set_generated(psf_item);
			if((idx == EPL_SOD_PDO_TX_MAPP && subindex > 0x00) ||(idx == EPL_SOD_PDO_RX_MAPP && subindex > 0x00))
			{
				wmem_array_t *mappings = NULL;
				if (use_sdo_mappings)
					mappings = idx == EPL_SOD_PDO_TX_MAPP ? convo->TPDO : convo->RPDO;
				dissect_object_mapping(convo->profile, mappings, psf_od_tree, tvb, pinfo->num, dataoffset, idx, subindex);
			}
			else 
			{
				const struct epl_datatype *type = NULL;
				if (subobj)
					type = subobj->info.type;
				else if (obj)
					type = obj->info.type;
				dissect_epl_payload(psf_od_tree, tvb, pinfo, dataoffset, size, type, EPL_ASND);
			}
			offset += datalength;
			remlength = (guint32)tvb_reported_length_remaining(tvb, offset);
		}
		col_append_fstr(pinfo->cinfo, COL_INFO, " (%d)", objectcnt);
	}
	else
	{
		col_append_fstr(pinfo->cinfo, COL_INFO, "Response %s[%d]:",
				val_to_str_ext(EPL_ASND_SDO_COMMAND_WRITE_MULTIPLE_PARAMETER_BY_INDEX,
				&epl_sdo_asnd_commands_short_ext, "Command(%02X)"),
				segment_size);
		remlength = (guint32)tvb_reported_length_remaining(tvb, offset);
		objectcnt = 0;
		dataoffset = offset;
		while ( remlength > 0 )
		{
			guint16 sod_index;
			if ((tvb_get_guint8 ( tvb, offset + 3 ) & 0x80) == 0x80)
				is_abort = TRUE;
			psf_od_tree = proto_tree_add_subtree(epl_tree, tvb, offset, 8, 0, NULL , "OD");
			if (segmented <= EPL_ASND_SDO_CMD_SEGMENTATION_INITIATE_TRANSFER)
			{
				idx = tvb_get_letohs(tvb, dataoffset);
				index_str = rval_to_str_const(idx, sod_cmd_str, "unknown");
				sod_index = str_to_val(index_str, sod_cmd_str_val, error);
				sub_index_str = val_to_str_ext_const(idx, &sod_cmd_no_sub, "unknown");
				nosub = str_to_val(sub_index_str, sod_cmd_str_no_sub,error);
				if (objectcnt < 8)
					col_append_fstr(pinfo->cinfo, COL_INFO, " (0x%04X", idx);
				else
					col_append_str(pinfo->cinfo, COL_INFO, ".");
				proto_tree_add_uint_format(psf_od_tree, hf_epl_asnd_sdo_cmd_data_mapping_index, tvb, dataoffset, 2, idx,"Index: 0x%04X", idx);
				proto_item_append_text(psf_od_tree, " Idx: 0x%04X", idx);
				if (sod_index != error)
					idx = sod_index;
				dataoffset += 2;
				subindex = tvb_get_guint8(tvb, dataoffset);
				proto_item_append_text(psf_od_tree, " SubIdx: 0x%02X", subindex);
				proto_tree_add_uint_format(psf_od_tree, hf_epl_asnd_sdo_cmd_data_mapping_subindex, tvb, dataoffset, 1, idx,"SubIndex: 0x%02X", subindex);
				if (objectcnt < 8)
				{
					if (nosub)
						col_append_fstr(pinfo->cinfo, COL_INFO, ")");
					else
						col_append_fstr(pinfo->cinfo, COL_INFO, "/%d)", subindex);
				}
				dataoffset += 1;
				proto_tree_add_item(psf_od_tree, hf_epl_asnd_sdo_cmd_sub_abort, tvb, dataoffset, 1, ENC_LITTLE_ENDIAN);
				dataoffset += 1;
				if (is_abort)
				{
					abort_code = tvb_get_letohl(tvb, dataoffset);
					proto_item_append_text(psf_od_tree, " - %s", "Aborted");
					psf_item = proto_tree_add_item(psf_od_tree, hf_epl_sdo_multi_param_sub_abort, tvb, dataoffset, 4, ENC_LITTLE_ENDIAN);
					proto_item_append_text(psf_item," (%s)", val_to_str_ext_const(abort_code, &sdo_cmd_abort_code_ext, "Unknown"));
					is_abort = FALSE;
				}
				objectcnt++;
			}
			offset += 8;
			remlength = (guint32)tvb_reported_length_remaining(tvb, offset);
		}
		col_append_fstr(pinfo->cinfo, COL_INFO, " (%d)", objectcnt);
	}
	return offset;
}
