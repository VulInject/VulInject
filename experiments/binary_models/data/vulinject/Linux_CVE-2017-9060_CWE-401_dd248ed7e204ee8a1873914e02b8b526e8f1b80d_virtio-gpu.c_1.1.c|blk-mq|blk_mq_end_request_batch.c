void blk_mq_end_request_batch(struct io_comp_batch *iob)
{
	int tags[TAG_COMP_BATCH], nr_tags = 0;
	struct blk_mq_hw_ctx *cur_hctx = NULL;
	struct request *rq;
	unsigned int int now = 0;
	if (iob->need_ts)
		now = blk_time_get_ns();
	while ((rq = rq_list_pop(&iob->req_list)) != NULL) {
		prefetch(rq->bio);
		prefetch(rq->rq_next);
		if (iob->need_ts)
			__blk_mq_end_request_acct(rq, now);
		blk_mq_finish_request(rq);
		rq_qos_done(rq->q, rq);
		if (rq->end_io && rq->end_io(rq, 0) == RQ_END_IO_NONE)
			continue;
		WRITE_ONCE(rq->state, MQ_RQ_IDLE);
		if (!req_ref_put_and_test(rq))
			continue;
		blk_crypto_free_request(rq);
		blk_pm_mark_last_busy(rq);
		if (nr_tags == TAG_COMP_BATCH || cur_hctx != rq->mq_hctx) {
			if (cur_hctx)
				blk_mq_flush_tag_batch(cur_hctx, tags, nr_tags);
			nr_tags = 0;
			cur_hctx = rq->mq_hctx;
		}
		tags[nr_tags++] = rq->tag;
	}
	if (nr_tags)
		blk_mq_flush_tag_batch(cur_hctx, tags, nr_tags);
}
