unsigned int kgd_gfx_v9_set_wave_launch_mode(struct amdgpu_device *adev,
					unsigned char wave_launch_mode,
					unsigned int vmid)
{
	unsigned int data = 0;
	bool is_mode_set = !!wave_launch_mode;
	kgd_gfx_v9_set_wave_launch_stall(adev, vmid, true);
	data = REG_SET_FIELD(data, SPI_GDBG_WAVE_CNTL2,
		VMID_MASK, is_mode_set ? 1 << vmid : 0);
	data = REG_SET_FIELD(data, SPI_GDBG_WAVE_CNTL2,
		MODE, is_mode_set ? wave_launch_mode : 0);
	WREG32(SOC15_REG_OFFSET(GC, 0, mmSPI_GDBG_WAVE_CNTL2), data);
	kgd_gfx_v9_set_wave_launch_stall(adev, vmid, false);
	mutex_unlock(&adev->grbm_idx_mutex);
	return 0;
}
