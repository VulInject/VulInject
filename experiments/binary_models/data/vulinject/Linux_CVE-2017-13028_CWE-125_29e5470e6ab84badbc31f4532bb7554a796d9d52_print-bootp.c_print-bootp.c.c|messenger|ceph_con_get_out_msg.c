void ceph_con_get_out_msg(struct ceph_connection *con)
{
	struct ceph_msg *msg;
	BUG_ON(list_empty(&con->out_queue));
	msg = list_first_entry(&con->out_queue, struct ceph_msg, list_head);
	WARN_ON(msg->con != con);
	list_move_tail(&msg->list_head, &con->out_sent);
	if (msg->needs_out_seq) {
		msg->hdr.seq = cpu_to_le64(++con->out_seq);
		msg->needs_out_seq = false;
		if (con->ops->reencode_message)
			con->ops->reencode_message(msg);
	}
	con->out_msg = ceph_msg_get(msg);
}
