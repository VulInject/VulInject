static void test6(void)
{
    struct {
        unsigned long pad1;
        SHS_INFO si1;
        unsigned long pad2;
        SHS_INFO si2;
        unsigned long pad3;
    } sdata;
    unsigned char digest[SHS_DIGESTSIZE];
    int failed;
	int i, j;
    printf("Running SHS test 6 ...\n");
    sdata.pad1 = 0x12345678;
    sdata.pad2 = 0x87654321;
    sdata.pad3 = 0x78563412;
    shsInit((&sdata.si2));
    if (sdata.pad2 != 0x87654321) {
        printf ("Overrun #20 %#lx\n",
                sdata.pad2);
        sdata.pad2 = 0x87654321;
    }
    if (sdata.pad3 != 0x78563412) {
        printf ("Overrun #21 %#lx\n",
                sdata.pad3);
        sdata.pad3 = 0x78563412;
    }
    for (i = 0; i < 400; ++i)
    {
        shsInit(&sdata.si1);
        if (sdata.pad1 != 0x12345678) {
            printf ("Overrun #22 %#lx at %d\n",
                    sdata.pad1, i);
            sdata.pad1 = 0x12345678;
        }
        if (sdata.pad2 != 0x87654321) {
            printf ("Overrun #23 %#lx at %d\n",
                    sdata.pad2, i);
            sdata.pad2 = 0x87654321;
        }
        shsUpdate(&sdata.si1, (randdata+sizeof(randdata))-i, i);
        if (sdata.pad1 != 0x12345678) {
            printf ("Overrun #24 %#lx at %d\n",
                    sdata.pad1, i);
            sdata.pad1 = 0x12345678;
        }
        if (sdata.pad2 != 0x87654321) {
            printf ("Overrun #25 %#lx at %d\n",
                    sdata.pad2, i);
            sdata.pad2 = 0x87654321;
        }
        shsFinal(&sdata.si1);
        if (sdata.pad1 != 0x12345678) {
            printf ("Overrun #26 %#lx at %d\n",
                    sdata.pad1, i);
            sdata.pad1 = 0x12345678;
        }
        if (sdata.pad2 != 0x87654321) {
            printf ("Overrun #27 %#lx at %d\n",
                    sdata.pad2, i);
            sdata.pad2 = 0x87654321;
        }
        memcpy(digest, shsDigest(&sdata.si1), SHS_DIGESTSIZE);
        if (Dflag & 1)
        {
            printf ("%d: ", i);
            for (j = 0; j < SHS_DIGESTSIZE; ++j)
                printf("%02x",digest[j]);
            printf("\n");
        }
        shsUpdate((&sdata.si2), digest, SHS_DIGESTSIZE);
        if (sdata.pad2 != 0x87654321) {
            printf ("Overrun #28 %#lx at %d\n",
                    sdata.pad2, i);
            sdata.pad2 = 0x87654321;
        }
        if (sdata.pad3 != 0x78563412) {
            printf ("Overrun #29 %#lx at %d\n",
                    sdata.pad3, i);
            sdata.pad3 = 0x78563412;
        }
        if (Dflag & 2)
            printf ("%d: %08lx%08lx%08lx%08lx%08lx\n",
                    i,
                    (unsigned long) sdata.si2.digest[0],
                    (unsigned long) sdata.si2.digest[1],
                    (unsigned long) sdata.si2.digest[2],
                    (unsigned long) sdata.si2.digest[3],
                    (unsigned long) sdata.si2.digest[4]);
    }
    shsFinal((&sdata.si2));
    if (sdata.pad2 != 0x87654321) {
        printf ("Overrun #30 %#lx\n",
                sdata.pad2);
        sdata.pad2 = 0x87654321;
    }
    if (sdata.pad3 != 0x78563412) {
        printf ("Overrun #31 %#lx\n",
                sdata.pad3);
        sdata.pad3 = 0x78563412;
    }
    memcpy(digest, shsDigest((&sdata.si2)), SHS_DIGESTSIZE);
    if ((failed = memcmp(digest, results6, SHS_DIGESTSIZE)) != 0)
    {
        fprintf(stderr,"SHS test 6 failed!\n");
        rc = 1;
    }
    printf ("%s, results = ", failed ? "Failed" : "Passed");
    for (i = 0; i < SHS_DIGESTSIZE; ++i)
        printf("%02x",digest[i]);
    if (failed)
    {
        printf ("\n, expected ");
        for (i = 0; i < SHS_DIGESTSIZE; ++i)
            printf("%02x",results6[i]);
    }
    printf("\n");
}
