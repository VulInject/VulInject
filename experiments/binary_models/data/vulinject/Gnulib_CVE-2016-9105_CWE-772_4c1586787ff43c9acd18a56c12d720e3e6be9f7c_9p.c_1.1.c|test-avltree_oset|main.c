main (int argc, char *argv[])
{
  gl_oset_t set1, set2;
  if (argc > 1)
    srand (atoi (argv[1]));
  {
    size_t initial_size = RANDOM (20);
    size_t i;
    unsigned int repeat;
    set1 = gl_oset_nx_create_empty (GL_ARRAY_OSET, (gl_setelement_compar_fn) strcmp, NULL);
    ASSERT (set1 != NULL);
    set2 = gl_oset_nx_create_empty (GL_AVLTREE_OSET, (gl_setelement_compar_fn) strcmp, NULL);
    ASSERT (set2 != NULL);
    for (i = 0; i < initial_size; i++)
      {
        const char *obj = RANDOM_OBJECT ();
        ASSERT (gl_oset_nx_add (set1, obj) == gl_oset_nx_add (set2, obj));
        check_all (set1, set2);
      }
    for (repeat = 0; repeat < 100000; repeat++)
      {
        unsigned int operation = RANDOM (4);
        switch (operation)
          {
          case 0:
            {
              const char *obj = RANDOM_OBJECT ();
              ASSERT (gl_oset_search (set1, obj) == gl_oset_search (set2, obj));
            }
            break;
          case 1:
            {
              const char *obj = RANDOM_OBJECT ();
              ASSERT (gl_oset_nx_add (set1, obj) == gl_oset_nx_add (set2, obj));
            }
            break;
          case 2:
            {
              const char *obj = RANDOM_OBJECT ();
              ASSERT (gl_oset_remove (set1, obj) == gl_oset_remove (set2, obj));
            }
            break;
          case 3:
            {
              const char *obj = RANDOM_OBJECT ();
              gl_oset_iterator_t iter1 = gl_oset_iterator_atleast (set1, is_at_least, obj);
              gl_oset_iterator_t iter2 = gl_oset_iterator_atleast (set2, is_at_least, obj);
              const void *elt1;
              const void *elt2;
              bool havenext1 = gl_oset_iterator_next (&iter1, &elt1);
              bool havenext2 = gl_oset_iterator_next (&iter2, &elt2);
              ASSERT (havenext1 == havenext2);
              if (havenext1)
                {
                  ASSERT (elt1 == elt2);
                  havenext1 = gl_oset_iterator_next (&iter1, &elt1);
                  havenext2 = gl_oset_iterator_next (&iter2, &elt2);
                  ASSERT (havenext1 == havenext2);
                  if (havenext1)
                    ASSERT (elt1 == elt2);
                }
              gl_oset_iterator_free (&iter1);
              gl_oset_iterator_free (&iter2);
            }
            break;
          }
        check_all (set1, set2);
      }
    gl_oset_free (set1);
    gl_oset_free (set2);
  }
  test_update (GL_AVLTREE_OSET);
  return test_exit_status;
}
