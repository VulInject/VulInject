int spi_delay_to_ns(struct spi_delay *_delay, struct spi_transfer *xfer)
{
	unsigned int delay = _delay->value;
	unsigned int unit = _delay->unit;
	switch (unit) {
	case SPI_DELAY_UNIT_USECS:
		delay *= NSEC_PER_USEC;
		break;
	case SPI_DELAY_UNIT_NSECS:
		break;
	case SPI_DELAY_UNIT_SCK:
		if (!xfer)
			return -EINVAL;
		hz = xfer->effective_speed_hz ?: xfer->speed_hz / 2;
		if (!hz)
			return -EINVAL;
		delay *= DIV_ROUND_UP(NSEC_PER_SEC, hz);
		break;
	default:
		return -EINVAL;
	}
	return delay;
}
