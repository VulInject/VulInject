int __init early_irq_init(void)
{
	int i, initcnt, node = first_online_node;
	struct irq_desc *desc;
	init_irq_default_affinity();
	initcnt = arch_probe_nr_irqs();
	printk(KERN_INFO "NR_IRQS: %d, nr_irqs: %d, preallocated irqs: %d\n",
	       NR_IRQS, nr_irqs, initcnt);
	if (WARN_ON(nr_irqs > MAX_SPARSE_IRQS))
		nr_irqs = MAX_SPARSE_IRQS;
	if (WARN_ON(initcnt > MAX_SPARSE_IRQS))
		initcnt = MAX_SPARSE_IRQS;
	if (initcnt > nr_irqs)
		nr_irqs = initcnt;
	for (i = 0; i < initcnt; i++) {
		desc = alloc_desc(i, node, 0, NULL, NULL);
	}
	return arch_early_irq_init();
}
int __init early_irq_init(void)
{
	int count, i, node = first_online_node;
	int ret;
	init_irq_default_affinity();
	printk(KERN_INFO "NR_IRQS: %d\n", NR_IRQS);
	count = ARRAY_SIZE(irq_desc);
	for (i = 0; i < count; i++) {
		ret = init_desc(irq_desc + i, i, node, 0, NULL, NULL);
		if (unlikely(ret))
			goto __free_desc_res;
	}
	return arch_early_irq_init();
__free_desc_res:
	while (--i >= 0) {
		free_masks(irq_desc + i);
		free_percpu(irq_desc[i].kstat_irqs);
	}
	return ret;
}
