foldAddMarker(linenr_T lnum, char_u *marker, int markerlen)
{
    char_u	*cms = curbuf->b_p_cms;
    char_u	*line;
    int		line_len;
    char_u	*newline;
    char_u	*p = (char_u *)strstr((char *)curbuf->b_p_cms, "%s");
    int		line_is_comment = FALSE;
    line = ml_get(lnum);
    line_len = ml_get_len(lnum);
    if (u_save(lnum - 1, lnum + 1) != OK)
	return;
    (void)skip_comment(line, FALSE, FALSE, &line_is_comment);
    newline = alloc(line_len + markerlen + STRLEN(cms) + 1);
    if (newline == NULL)
	return;
    if (p == NULL || line_is_comment)
	vim_strncpy(newline + line_len, marker, markerlen);
    else
    {
	STRCPY(newline + line_len, cms);
	STRNCPY(newline + line_len + (p - cms), marker, markerlen);
	STRCPY(newline + line_len + (p - cms) + markerlen, p + 2);
    }
    ml_replace(lnum, newline, FALSE);
}
