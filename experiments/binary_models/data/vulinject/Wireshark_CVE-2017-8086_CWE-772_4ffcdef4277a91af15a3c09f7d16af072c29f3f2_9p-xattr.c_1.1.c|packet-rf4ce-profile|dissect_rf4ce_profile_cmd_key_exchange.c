static void dissect_rf4ce_profile_cmd_key_exchange(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, guint *offset)
{
    guint8 sub_type = tvb_get_guint8(tvb, *offset);
    proto_tree_add_item(tree, hf_rf4ce_profile_cmd_key_exchange_sub_type, tvb, *offset, 1, ENC_LITTLE_ENDIAN);
    *offset += 1;
    if (sub_type == RF4CE_PROFILE_CMD_KEY_EXCHANGE_SUB_TYPE_CHALLENGE || sub_type == RF4CE_PROFILE_CMD_KEY_EXCHANGE_SUB_TYPE_CHALLENGE_RSP)
    {
        static int *const key_exchange_bits[] = {
            &hf_rf4ce_profile_cmd_key_exchange_flags_default_secret,
            &hf_rf4ce_profile_cmd_key_exchange_flags_initiator_vendor_specific_secret,
            &hf_rf4ce_profile_cmd_key_exchange_flags_responder_vendor_specific_secret,
            &hf_rf4ce_profile_cmd_key_exchange_flags_reserved,
            &hf_rf4ce_profile_cmd_key_exchange_flags_vendor_specific_parameter,
            NULL};
        proto_tree_add_bitmask(tree, tvb, *offset, hf_rf4ce_profile_cmd_key_exchange_flags, ett_rf4ce_profile_cmd_frame, key_exchange_bits, ENC_LITTLE_ENDIAN);
        *offset += 2;
    }
    if (sub_type == RF4CE_PROFILE_CMD_KEY_EXCHANGE_SUB_TYPE_CHALLENGE)
    {
        guint8 rand_a[RF4CE_PROFILE_CMD_KEY_EXCHANGE_RAND_A_LENGTH];
        guint8 target_addr[RF4CE_IEEE_ADDR_LEN];
        proto_tree_add_item(tree, hf_rf4ce_profile_cmd_key_exchange_rand_a, tvb, *offset, RF4CE_PROFILE_CMD_KEY_EXCHANGE_RAND_A_LENGTH, ENC_NA);
        tvb_memcpy(tvb, (void *)rand_a, *offset, RF4CE_PROFILE_CMD_KEY_EXCHANGE_RAND_A_LENGTH);
        *offset += RF4CE_PROFILE_CMD_KEY_EXCHANGE_RAND_A_LENGTH;
        if (!key_exchange_context_is_procedure_started())
        {
            if (rf4ce_addr_table_get_ieee_addr(target_addr, pinfo, TRUE))
            {
                key_exchange_context_init();
                key_exchange_context_set_mac_a(target_addr);
                key_exchange_context_start_procedure();
            }
        }
    }
    if (sub_type == RF4CE_PROFILE_CMD_KEY_EXCHANGE_SUB_TYPE_CHALLENGE_RSP)
    {
        guint8 rand_b[RF4CE_PROFILE_CMD_KEY_EXCHANGE_RAND_A_LENGTH];
        guint32 tag_b_pack;
        guint8 controller_addr[RF4CE_IEEE_ADDR_LEN];
        proto_tree_add_item(tree, hf_rf4ce_profile_cmd_key_exchange_rand_b, tvb, *offset, RF4CE_PROFILE_CMD_KEY_EXCHANGE_RAND_B_LENGTH, ENC_NA);
        tvb_memcpy(tvb, (void *)rand_b, *offset, RF4CE_PROFILE_CMD_KEY_EXCHANGE_RAND_A_LENGTH);
        *offset += RF4CE_PROFILE_CMD_KEY_EXCHANGE_RAND_B_LENGTH;
        proto_tree_add_item(tree, hf_rf4ce_profile_cmd_key_exchange_tag_b, tvb, *offset, RF4CE_PROFILE_CMD_KEY_EXCHANGE_TAG_B_LENGTH, ENC_NA);
        tag_b_pack = tvb_get_guint32(tvb, *offset, ENC_LITTLE_ENDIAN);
        *offset += RF4CE_PROFILE_CMD_KEY_EXCHANGE_TAG_B_LENGTH;
        if (key_exchange_context_is_procedure_started())
        {
            if (rf4ce_addr_table_get_ieee_addr(controller_addr, pinfo, TRUE))
            {
                key_exchange_context_set_rand_b(rand_b);
                key_exchange_context_set_mac_b(controller_addr);
                key_exchange_calc_key(tag_b_pack);
            }
            key_exchange_context_stop_procedure();
        }
    }
    if (sub_type == RF4CE_PROFILE_CMD_KEY_EXCHANGE_SUB_TYPE_RSP)
    {
        proto_tree_add_item(tree, hf_rf4ce_profile_cmd_key_exchange_tag_a, tvb, *offset, RF4CE_PROFILE_CMD_KEY_EXCHANGE_TAG_A_LENGTH, ENC_NA);
        *offset += RF4CE_PROFILE_CMD_KEY_EXCHANGE_TAG_A_LENGTH;
    }
}
