int sh_intc_init(MemoryRegion *sysmem,
                 struct intc_desc *desc,
                 int nr_sources,
                 struct intc_mask_reg *mask_regs,
                 int nr_mask_regs,
                 struct intc_prio_reg *prio_regs,
                 int nr_prio_regs)
{
	int i, j;
    desc->pending = 0;
    desc->nr_sources = nr_sources;
    desc->mask_regs = mask_regs;
    desc->nr_mask_regs = nr_mask_regs;
    desc->prio_regs = prio_regs;
    desc->nr_prio_regs = nr_prio_regs;
    /* Allocate 4 MemoryRegions per register (2 actions * 2 aliases) */
    desc->iomem_aliases = g_new0(MemoryRegion,
                                 (nr_mask_regs + nr_prio_regs) * 4);
    desc->sources = g_new0(struct intc_source, nr_sources);
    for (i = 0; i < nr_sources; i++) {
        desc->sources[i].parent = desc;
    }
    desc->irqs = qemu_allocate_irqs(sh_intc_set_irq, desc, nr_sources);
    memory_region_init_io(&desc->iomem, NULL, &sh_intc_ops, desc, "intc",
                          0x100000000ULL);
    j = 0;
    if (desc->mask_regs) {
        for (i = 0; i < desc->nr_mask_regs; i++) {
            struct intc_mask_reg *mr = &desc->mask_regs[i];
            j += sh_intc_register(sysmem, desc, mr->set_reg, "mask", "set", j);
            j += sh_intc_register(sysmem, desc, mr->clr_reg, "mask", "clr", j);
        }
    }
    if (desc->prio_regs) {
        for (i = 0; i < desc->nr_prio_regs; i++) {
            struct intc_prio_reg *pr = &desc->prio_regs[i];
            j += sh_intc_register(sysmem, desc, pr->set_reg, "prio", "set", j);
            j += sh_intc_register(sysmem, desc, pr->clr_reg, "prio", "clr", j);
        }
    }
    return 0;
}
