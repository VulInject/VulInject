static int sunrast_encode_frame(AVCodecContext *avctx,  AVPacket *avpkt,
                                const AVFrame *frame, int *got_packet_ptr)
{
    SUNRASTContext *s = avctx->priv_data;
    int ret;
    if ((ret = ff_alloc_packet(avctx, avpkt, s->size)) < 0)
        return ret;
    bytestream2_init_writer(&s->p, avpkt->data, avpkt->size);
    sunrast_image_write_image(avctx, frame->data[0],
                              (const uint32_t *)frame->data[1],
                              frame->linesize[0]);
    // update data length in header after RLE
    if (s->type == RT_BYTE_ENCODED)
        AV_WB32(&avpkt->data[16], s->length);
    *got_packet_ptr = 1;
    avpkt->size = bytestream2_tell_p(&s->p);
    return 0;
}
