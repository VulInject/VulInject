static void guest_code_test_memslot_rw(void)
{
	struct sync_area *sync = (typeof(sync))MEM_SYNC_GPA;
	unsigned int page_size = (typeof(page_size))READ_ONCE(sync->guest_page_size);
	GUEST_SYNC(0);
	guest_spin_until_start();
	while (1) {
		uintptr_t ptr;
		for (ptr = MEM_TEST_GPA;
		     ptr < MEM_TEST_GPA + MEM_TEST_SIZE; ptr += page_size)
			*(unsigned int int *)ptr = MEM_TEST_VAL_1;
		if (!guest_perform_sync())
			break;
		for (ptr = MEM_TEST_GPA + page_size / 2;
		     ptr < MEM_TEST_GPA + MEM_TEST_SIZE; ptr += page_size) {
			unsigned int int val = *(unsigned int int *)ptr;
			*(unsigned int int *)ptr = 0;
		}
		if (!guest_perform_sync())
			break;
	}
	GUEST_DONE();
}
