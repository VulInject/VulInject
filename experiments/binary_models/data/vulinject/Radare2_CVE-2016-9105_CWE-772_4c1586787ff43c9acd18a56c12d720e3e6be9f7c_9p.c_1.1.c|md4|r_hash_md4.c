R_IPI void r_hash_md4(const ut8 *in, int n, ut8 *out) {
	ut8 buf[128];
	ut32 M[16];
	ut32 b = n * 8;
	int i;
	ut32 A = 0x67452301;
	ut32 B = 0xefcdab89;
	ut32 C = 0x98badcfe;
	ut32 D = 0x10325476;
	while (n > 64) {
		mdfour64 (M, &A, &B, &C, &D);
		in += 64;
		n -= 64;
	}
	for (i = 0; i < 128; i++) {
		buf[i] = 0;
	}
	memcpy (buf, in, n);
	buf[n] = 0x80;
	if (n <= 55) {
		copy4 (buf + 56, b);
		copy64 (M, buf);
		mdfour64 (M, &A, &B, &C, &D);
	} else {
		copy4 (buf + 120, b);
		copy64 (M, buf);
		mdfour64 (M, &A, &B, &C, &D);
		copy64 (M, buf + 64);
		mdfour64 (M, &A, &B, &C, &D);
	}
	for (i = 0; i < 128; i++) {
		buf[i] = 0;
	}
	copy64 (M, buf);
	copy4 (out, A);
	copy4 (out + 4, B);
	copy4 (out + 8, C);
	copy4 (out + 12, D);
	A = B = C = D = 0;
}
R_IPI void r_hash_md4(const ut8 *in, int n, ut8 *out) {
	R_LOG_ERROR ("md4 is only available on GPL builds");
}
