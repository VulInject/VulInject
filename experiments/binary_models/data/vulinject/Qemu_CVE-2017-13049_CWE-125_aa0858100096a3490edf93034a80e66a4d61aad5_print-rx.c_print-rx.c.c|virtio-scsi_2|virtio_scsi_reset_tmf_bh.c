static void virtio_scsi_reset_tmf_bh(VirtIOSCSI *s)
{
    VirtIOSCSIReq *req;
    VirtIOSCSIReq *tmp;
    GLOBAL_STATE_CODE();
    /* Called after ioeventfd has been stopped, so tmf_bh_lock is not needed */
    if (s->tmf_bh) {
        qemu_bh_delete(s->tmf_bh);
        s->tmf_bh = NULL;
    }
    QTAILQ_FOREACH_SAFE(req, &s->tmf_bh_list, next, tmp) {
        QTAILQ_REMOVE(&s->tmf_bh_list, req, next);
        /* SAM-6 6.3.2 Hard reset */
        req->resp.tmf.response = VIRTIO_SCSI_S_TARGET_FAILURE;
    }
}
