static void scsi_write_complete(void * opaque, int ret)
{
    SCSIGenericReq *r = (SCSIGenericReq *)opaque;
    SCSIDevice *s = r->req.dev;
    trace_scsi_generic_write_complete(ret);
    assert(r->req.aiocb != NULL);
    r->req.aiocb = NULL;
    if (ret || r->req.io_canceled) {
        scsi_command_complete_noio(r, ret);
        return;
    }
    if (r->req.cmd.buf[0] == MODE_SELECT && r->req.cmd.buf[4] == 12 &&
        s->type == TYPE_TAPE) {
        s->blocksize = (r->buf[9] << 16) | (r->buf[10] << 8) | r->buf[11];
    }
    scsi_command_complete_noio(r, ret);
}
