static int qcom_nandc_write_oob(struct nand_chip *chip, int page)
{
	struct mtd_info *mtd = nand_to_mtd(chip);
	struct qcom_nand_host *host = to_qcom_nand_host(chip);
	struct qcom_nand_controller *nandc = get_qcom_nand_controller(chip);
	struct nand_ecc_ctrl *ecc = &chip->ecc;
	unsigned char *oob = chip->oob_poi;
	int data_size, oob_size;
	int ret;
	if (host->nr_boot_partitions)
	host->use_ecc = true;
	clear_bam_transaction(nandc);
	data_size = ecc->size - ((ecc->steps - 1) << 2);
	oob_size = mtd->oobavail;
	memset(nandc->data_buffer, 0xff, host->cw_data);
	mtd_ooblayout_get_databytes(mtd, nandc->data_buffer + data_size, oob,
				    0, mtd->oobavail);
	set_address(host, host->cw_size * (ecc->steps - 1), page);
	update_rw_regs(host, 1, false, 0);
	config_nand_page_write(chip);
	write_data_dma(nandc, FLASH_BUF_ACC,
		       nandc->data_buffer, data_size + oob_size, 0);
	config_nand_cw_write(chip);
	ret = submit_descs(nandc);
	if (ret) {
		dev_err(nandc->dev, "failure to write oob\n");
		return ret;
	}
	return nand_prog_page_end_op(chip);
}
