static void octeon_pci_initialize(void)
{
	union cvmx_pci_cfg01 cfg01;
	union cvmx_npi_ctl_status ctl_status;
	union cvmx_pci_ctl_status_2 ctl_status_2;
	union cvmx_pci_cfg19 cfg19;
	union cvmx_pci_cfg16 cfg16;
	union cvmx_pci_cfg22 cfg22;
	union cvmx_pci_cfg56 cfg56;
	cvmx_write_csr(CVMX_CIU_SOFT_PRST, 0x1);
	cvmx_read_csr(CVMX_CIU_SOFT_PRST);
	udelay(2000);		
	ctl_status.unsigned int int = 0;	
	ctl_status.s.max_word = 1;
	ctl_status.s.timer = 1;
	cvmx_write_csr(CVMX_NPI_CTL_STATUS, ctl_status.unsigned int int);
	cvmx_write_csr(CVMX_CIU_SOFT_PRST, 0x4);
	cvmx_read_csr(CVMX_CIU_SOFT_PRST);
	udelay(2000);		
	ctl_status_2.unsigned int = 0;
	ctl_status_2.s.tsr_hwm = 1;	
	ctl_status_2.s.bar2pres = 1;	
	ctl_status_2.s.bar2_enb = 1;
	ctl_status_2.s.bar2_cax = 1;	
	ctl_status_2.s.bar2_esx = 1;
	ctl_status_2.s.pmo_amod = 1;	
	if (octeon_dma_bar_type == OCTEON_DMA_BAR_TYPE_BIG) {
		ctl_status_2.s.bb1_hole = OCTEON_PCI_BAR1_HOLE_BITS;
		ctl_status_2.s.bb1_siz = 1;  
		ctl_status_2.s.bb_ca = 1;    
		ctl_status_2.s.bb_es = 1;    
		ctl_status_2.s.bb1 = 1;	     
		ctl_status_2.s.bb0 = 1;	     
	}
	octeon_npi_write32(CVMX_NPI_PCI_CTL_STATUS_2, ctl_status_2.unsigned int);
	udelay(2000);		
	ctl_status_2.unsigned int = octeon_npi_read32(CVMX_NPI_PCI_CTL_STATUS_2);
	pr_notice("PCI Status: %s %s-bit\n",
		  ctl_status_2.s.ap_pcix ? "PCI-X" : "PCI",
		  ctl_status_2.s.ap_64ad ? "64" : "32");
	if (OCTEON_IS_MODEL(OCTEON_CN58XX) || OCTEON_IS_MODEL(OCTEON_CN50XX)) {
		union cvmx_pci_cnt_reg cnt_reg_start;
		union cvmx_pci_cnt_reg cnt_reg_end;
	int cycles, pci_clock;
		cnt_reg_start.unsigned int int = cvmx_read_csr(CVMX_NPI_PCI_CNT_REG);
		cycles = read_c0_cvmcount();
		udelay(1000);
		cnt_reg_end.unsigned int int = cvmx_read_csr(CVMX_NPI_PCI_CNT_REG);
		cycles = read_c0_cvmcount() - cycles;
		pci_clock = (cnt_reg_end.s.pcicnt - cnt_reg_start.s.pcicnt) /
			    (cycles / (mips_hpt_frequency / 1000000));
		pr_notice("PCI Clock: %lu MHz\n", pci_clock);
	}
	if (ctl_status_2.s.ap_pcix) {
		cfg19.unsigned int = 0;
		cfg19.s.tdomc = 4;
		cfg19.s.mdrrmc = 2;
		cfg19.s.mrbcm = 1;
		octeon_npi_write32(CVMX_NPI_PCI_CFG19, cfg19.unsigned int);
	}
	cfg01.unsigned int = 0;
	cfg01.s.msae = 1;	
	cfg01.s.me = 1;		
	cfg01.s.pee = 1;	
	cfg01.s.see = 1;	
	cfg01.s.fbbe = 1;	
	octeon_npi_write32(CVMX_NPI_PCI_CFG01, cfg01.unsigned int);
#ifdef USE_OCTEON_INTERNAL_ARBITER
	{
		union cvmx_npi_pci_int_arb_cfg pci_int_arb_cfg;
		pci_int_arb_cfg.unsigned int int = 0;
		pci_int_arb_cfg.s.en = 1;	
		cvmx_write_csr(CVMX_NPI_PCI_INT_ARB_CFG, pci_int_arb_cfg.unsigned int int);
	}
#endif	
	cfg16.unsigned int = 0;
	cfg16.s.mltd = 1;	
	octeon_npi_write32(CVMX_NPI_PCI_CFG16, cfg16.unsigned int);
	cfg22.unsigned int = 0;
	cfg22.s.mrv = 0xff;
	cfg22.s.flush = 1;
	octeon_npi_write32(CVMX_NPI_PCI_CFG22, cfg22.unsigned int);
	cfg56.unsigned int = 0;
	cfg56.s.pxcid = 7;	
	cfg56.s.ncp = 0xe8;	
	cfg56.s.dpere = 1;	
	cfg56.s.roe = 1;	
	cfg56.s.mmbc = 1;	
	cfg56.s.most = 3;	
	octeon_npi_write32(CVMX_NPI_PCI_CFG56, cfg56.unsigned int);
	octeon_npi_write32(CVMX_NPI_PCI_READ_CMD_6, 0x21);
	octeon_npi_write32(CVMX_NPI_PCI_READ_CMD_C, 0x31);
	octeon_npi_write32(CVMX_NPI_PCI_READ_CMD_E, 0x31);
}
