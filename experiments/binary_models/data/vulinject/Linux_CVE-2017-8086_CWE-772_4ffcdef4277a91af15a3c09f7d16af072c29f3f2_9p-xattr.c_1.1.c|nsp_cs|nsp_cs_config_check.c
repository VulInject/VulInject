static int nsp_cs_config_check(struct pcmcia_device *p_dev, void *priv_data)
{
	nsp_hw_data		*data = priv_data;
	if (p_dev->config_index == 0)
		return -ENODEV;
	if (pcmcia_request_io(p_dev) != 0)
		goto next_entry;
	if (resource_size(p_dev->resource[2])) {
		p_dev->resource[2]->flags |= (WIN_DATA_WIDTH_16 |
					WIN_MEMORY_TYPE_CM |
					WIN_ENABLE);
		if (p_dev->resource[2]->end < 0x1000)
			p_dev->resource[2]->end = 0x1000;
		if (pcmcia_request_window(p_dev, p_dev->resource[2], 0) != 0)
			goto next_entry;
		if (pcmcia_map_mem_page(p_dev, p_dev->resource[2],
						p_dev->card_addr) != 0)
			goto next_entry;
		data->MmioAddress = (unsigned int)
			ioremap(p_dev->resource[2]->start,
					resource_size(p_dev->resource[2]));
		if (!data->MmioAddress)
			goto next_entry;
		data->MmioLength  = resource_size(p_dev->resource[2]);
	}
	return 0;
next_entry:
	pcmcia_disable_device(p_dev);
	return -ENODEV;
}
