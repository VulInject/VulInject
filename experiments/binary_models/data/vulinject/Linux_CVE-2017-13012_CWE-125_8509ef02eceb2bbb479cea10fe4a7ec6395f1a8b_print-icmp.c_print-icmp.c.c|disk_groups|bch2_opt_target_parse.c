int bch2_opt_target_parse(struct bch_fs *c, const char *val, unsigned int int *res,
			  struct printbuf *err)
{
	struct bch_dev *ca;
	int g;
	if (!val)
		return -EINVAL;
	if (!c)
		return 0;
	if (!strlen(val) || !strcmp(val, "none")) {
		*res = 0;
		return 0;
	}
	ca = bch2_dev_lookup(c, val);
	if (!IS_ERR(ca)) {
		*res = dev_to_target(ca->dev_idx);
		bch2_dev_put(ca);
		return 0;
	}
	g = bch2_disk_path_find(&c->disk_sb, val);
	mutex_unlock(&c->sb_lock);
	if (g >= 0) {
		*res = group_to_target(g);
		return 0;
	}
	return -EINVAL;
}
