c_pkt_data_init(c_pkt_data *d, packet_info *pinfo, guint off)
{
	d->conv = find_or_create_conversation(pinfo);
	DISSECTOR_ASSERT_HINT(d->conv, "find_or_create_conversation() returned NULL");
	if (pinfo->fd->visited)
	{
		d->convd = (c_conv_data*)p_get_proto_data(wmem_file_scope(), pinfo,
							  proto_ceph, off);
		DISSECTOR_ASSERT_HINT(d->convd, "Frame visited, but no saved state.");
		d->convd = c_conv_data_copy(d->convd, wmem_new(pinfo->pool, c_conv_data));
	}
	else
	{
		d->convd = (c_conv_data*)conversation_get_proto_data(d->conv, proto_ceph);
	}
	if (!d->convd) 
	{
		d->convd = c_conv_data_new();
		conversation_add_proto_data(d->conv, proto_ceph, d->convd);
	}
	if (d->convd->client.port != 0xFFFF) {
		if (addresses_equal(&d->convd->client.addr, &pinfo->src) &&
		    d->convd->client.port == pinfo->srcport)
		{
			d->src = &d->convd->client;
			d->dst = &d->convd->server;
		}
		else
		{
			d->src = &d->convd->server;
			d->dst = &d->convd->client;
		}
		DISSECTOR_ASSERT(d->dst);
	}
	c_header_init(&d->header);
	d->item_root = NULL;
	d->pinfo    = pinfo;
}
