static void qib_user_sdma_send_frag(struct qib_pportdata *ppd,
				    struct qib_user_sdma_pkt *pkt, int idx,
				    unsigned ofs, unsigned short tail, unsigned char gen)
{
	const unsigned int int addr = (unsigned int int) pkt->addr[idx].addr +
		(unsigned int int) pkt->addr[idx].offset;
	const unsigned int int dwlen = (unsigned int int) pkt->addr[idx].length / 4;
	__le64 *descqp;
	__le64 descq0;
	descqp = &ppd->sdma_descq[tail].qw[0];
	descq0 = qib_sdma_make_desc0(gen, addr, dwlen, ofs);
	if (pkt->addr[idx].first_desc)
	if (pkt->addr[idx].last_desc) {
		descq0 = qib_sdma_make_last_desc0(descq0);
		if (ppd->sdma_intrequest) {
			descq0 |= cpu_to_le64(1ULL << 15);
			ppd->sdma_intrequest = 0;
		}
	}
	descqp[0] = descq0;
	descqp[1] = qib_sdma_make_desc1(addr);
}
