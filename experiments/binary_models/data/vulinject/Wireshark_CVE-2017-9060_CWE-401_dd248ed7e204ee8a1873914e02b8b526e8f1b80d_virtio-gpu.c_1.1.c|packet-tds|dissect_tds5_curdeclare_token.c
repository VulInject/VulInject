dissect_tds5_curdeclare_token(tvbuff_t *tvb, packet_info *pinfo, guint offset,
                              proto_tree *tree, tds_conv_info_t *tds_info)
{
    guint len, cur = offset, num_updatable_columns;
    gint cursorname_len, stmtlen;
    const guint8 *cursorname;
    tds_cursor_info_t *packet_cursor =
        (tds_cursor_info_t *) p_get_proto_data(wmem_file_scope(), pinfo, proto_tds, 0);
    proto_tree_add_item_ret_uint(tree, hf_tds_curdeclare_length, tvb, cur, 2,
        tds_get_int2_encoding(tds_info), &len);
    cur += 2;
    proto_tree_add_item_ret_string_and_length(tree, hf_tds_curdeclare_cursor_name,
        tvb, cur, 1, tds_get_char_encoding(tds_info)|ENC_NA,
        wmem_packet_scope(), &cursorname, &cursorname_len);
    cur += cursorname_len;
    proto_tree_add_bitmask(tree, tvb, cur, hf_tds_curdeclare_options,
        ett_tds5_curdeclare_options, tds_curdeclare_hf_fields, ENC_NA);
    proto_tree_add_item(tree, hf_tds_curdeclare_status_parameterized, tvb,
        cur + 1, 1, ENC_NA);
    cur += 2;
    proto_tree_add_item_ret_length(tree, hf_tds_curdeclare_statement, tvb, cur, 2,
        tds_get_char_encoding(tds_info)|tds_get_int2_encoding(tds_info), &stmtlen);
    cur += stmtlen;
    proto_tree_add_item_ret_uint(tree, hf_tds_curdeclare_update_columns_num, tvb, cur, 1,
                                 ENC_NA, &num_updatable_columns);
    cur += 1;
    if (num_updatable_columns > 0) {
        gint column_name_len;
        proto_tree_add_item_ret_length(tree, hf_tds_curdeclare_update_columns_name,
            tvb, cur, 1, tds_get_char_encoding(tds_info)|ENC_NA, &column_name_len);
        cur += column_name_len;
    }
    if (!PINFO_FD_VISITED(pinfo)) {
        tds_conv_cursor_info_t *conv_cursor_info;
        tds_cursor_info_t *cursor_current;
        conv_cursor_info = tds_info->tds_conv_cursor_info;
        cursor_current = conv_cursor_info->tds_conv_cursor_current;
        if (!cursor_current) {
            cursor_current = wmem_new0(wmem_file_scope(), tds_cursor_info_t);
            conv_cursor_info->tds_conv_cursor_current = cursor_current;
        }
        else if (!(cursor_current->tds_cursor_flags & TDS_CURSOR_IN_CONV_TABLE)) {
            wmem_free(wmem_file_scope(), (void *) cursor_current->tds_cursor_name);
            wmem_free(wmem_file_scope(), (void *) cursor_current->tds_cursor_rowinfo);
            (void) memset(cursor_current, 0, sizeof (tds_cursor_info_t));
        }
        cursor_current->tds_cursor_name = wmem_strdup(wmem_file_scope(), (const char* )cursorname);
        cursor_current->tds_cursor_flags |= TDS_CURSOR_NAME_VALID;
        if (packet_cursor && packet_cursor != cursor_current) {
            p_remove_proto_data(wmem_file_scope(), pinfo, proto_tds, 0);
            packet_cursor = NULL;
        }
        if (!packet_cursor) {
            p_add_proto_data(wmem_file_scope(), pinfo, proto_tds, 0, cursor_current);
        }
    }
    return cur - offset;
}
