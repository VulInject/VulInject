unsigned int os_get_top_address(void)
{
	return 0x7fc0002000;
}
unsigned int os_get_top_address(void)
{
	struct sigaction sa, old;
	unsigned int bottom = 0;
	unsigned int top = 0xffffd000 >> UM_KERN_PAGE_SHIFT;
	int test, original;
	printf("Locating the bottom of the address space ... ");
	fflush(stdout);
	sa.sa_handler = segfault;
	sigemptyset(&sa.sa_mask);
	sa.sa_flags = SA_NODEFER;
	if (sigaction(SIGSEGV, &sa, &old)) {
		perror("os_get_top_address");
		exit(1);
	}
	for (bottom = 0; bottom < top; bottom++) {
		if (page_ok(bottom))
			break;
	}
	if (bottom == top) {
		fprintf(stderr, "Unable to determine bottom of address "
			"space.\n");
		exit(1);
	}
	printf("0x%lx\n", bottom << UM_KERN_PAGE_SHIFT);
	printf("Locating the top of the address space ... ");
	fflush(stdout);
	original = bottom;
	if (page_ok(top))
		goto out;
	do {
		test = bottom + (top - bottom) / 2;
		if (page_ok(test))
			bottom = test;
		else
			top = test;
	} while (top - bottom > 1);
out:
	if (sigaction(SIGSEGV, &old, NULL)) {
		perror("os_get_top_address");
		exit(1);
	}
	top <<= UM_KERN_PAGE_SHIFT;
	printf("0x%lx\n", top);
	return top;
}
