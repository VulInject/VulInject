static int nut_write_trailer(AVFormatContext *s)
{
    NUTContext *nut = s->priv_data;
    AVIOContext *bc = s->pb, *dyn_bc;
    int ret;
    while (nut->header_count < 3)
        write_headers(s, bc);
    if (!nut->sp_count)
        return 0;
    ret = avio_open_dyn_buf(&dyn_bc);
    if (ret >= 0) {
        write_index(nut, dyn_bc);
        put_packet(nut, bc, dyn_bc, INDEX_STARTCODE);
        ffio_free_dyn_buf(&dyn_bc);
    }
    return 0;
}
