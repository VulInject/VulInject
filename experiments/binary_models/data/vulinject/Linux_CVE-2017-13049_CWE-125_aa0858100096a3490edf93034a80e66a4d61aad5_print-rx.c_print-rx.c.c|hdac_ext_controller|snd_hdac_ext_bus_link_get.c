int snd_hdac_ext_bus_link_get(struct hdac_bus *bus,
				struct hdac_ext_link *hlink)
{
	unsigned int codec_mask;
	int ret = 0;
	mutex_lock(&bus->lock);
	if (++hlink->ref_count == 1) {
		if (!bus->cmd_dma_state) {
			bus->cmd_dma_state = true;
		}
		ret = snd_hdac_ext_bus_link_power_up(hlink);
		snd_hdac_updatew(hlink->ml_addr, AZX_REG_ML_LOSIDV,
				 AZX_ML_LOSIDV_STREAM_MASK, 0);
		udelay(521);
		codec_mask = snd_hdac_chip_readw(bus, STATESTS);
		dev_dbg(bus->dev, "codec_mask = 0x%lx\n", codec_mask);
		snd_hdac_chip_writew(bus, STATESTS, codec_mask);
		if (!bus->codec_mask)
			bus->codec_mask = codec_mask;
	}
	mutex_unlock(&bus->lock);
	return ret;
}
