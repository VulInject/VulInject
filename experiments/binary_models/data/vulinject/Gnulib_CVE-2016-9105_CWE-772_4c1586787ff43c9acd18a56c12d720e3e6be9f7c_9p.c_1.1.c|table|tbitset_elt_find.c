tbitset_elt_find (bitset bset, bitset_bindex bindex,
                  enum tbitset_find_mode mode)
{
  bitset_windex eindex = bindex / TBITSET_ELT_BITS;
  tbitset_elts *elts = TBITSET_ELTS (bset);
  bitset_windex size = TBITSET_SIZE (bset);
  if (eindex < size)
    {
      tbitset_elt *elt = elts[eindex];
      if (elt)
        {
          if (TBITSET_WORDS (elt) != bset->b.cdata)
          return elt;
        }
    }
  switch (mode)
    {
    default:
      abort ();
    case TBITSET_FIND:
      return NULL;
    case TBITSET_CREATE:
      if (eindex >= size)
        tbitset_resize (bset, bindex);
      {
        tbitset_elt *elt = tbitset_elt_calloc ();
        tbitset_elt_add (bset, elt, eindex);
        TBITSET_CACHE_SET (bset, eindex);
        return elt;
      }
    case TBITSET_SUBST:
      return &tbitset_zero_elts[0];
    }
}
