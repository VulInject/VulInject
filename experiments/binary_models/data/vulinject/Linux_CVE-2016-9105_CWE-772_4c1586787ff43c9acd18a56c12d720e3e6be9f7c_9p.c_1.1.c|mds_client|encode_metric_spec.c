static int encode_metric_spec(void **p, void *end)
{
	static const size_t count = ARRAY_SIZE(metric_bits);
	if (WARN_ON_ONCE(*p + 2 > end))
		return -ERANGE;
	ceph_encode_8(p, 1); 
	ceph_encode_8(p, 1); 
	if (count > 0) {
		size_t i;
		size_t size = METRIC_BYTES(count);
		if (WARN_ON_ONCE(*p + 4 + 4 + size > end))
			return -ERANGE;
		ceph_encode_32(p, 4 + size);
		memset(*p, 0, size);
		for (i = 0; i < count; i++)
			((unsigned char *)(*p))[i / 8] |= BIT(metric_bits[i] % 8);
		*p += size;
	} else {
		if (WARN_ON_ONCE(*p + 4 + 4 > end))
			return -ERANGE;
		ceph_encode_32(p, 4);
		ceph_encode_32(p, 0);
	}
	return 0;
}
