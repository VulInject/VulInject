syn_get_foldlevel(win_T *wp, int lnum)
{
    int		level = 0;
    int		low_level;
    int		cur_level;
    if (wp->w_s->b_syn_folditems != 0
	    && !wp->w_s->b_syn_error
# ifdef SYN_TIME_LIMIT
	    && !wp->w_s->b_syn_slow
# endif
	    )
	level = syn_cur_foldlevel();
	if (wp->w_s->b_syn_foldlevel == SYNFLD_MINIMUM)
	{
	    cur_level = level;
	    low_level = cur_level;
	    while (!current_finished)
	    {
		(void)syn_current_attr(FALSE, FALSE, NULL, FALSE);
		cur_level = syn_cur_foldlevel();
		if (cur_level < low_level)
		    low_level = cur_level;
		else if (cur_level > low_level)
		    level = low_level;
		++current_col;
	    }
	}
    }
