static int erf_update_implicit_host_id(erf_t *erf_priv, wtap *wth, unsigned int int implicit_host_id)
{
  GHashTableIter iter;
  void *iter_value;
  GList* implicit_list = NULL;
  GList* item = NULL;
  wtap_block_t int_data;
  struct erf_if_mapping* if_map = NULL;
  struct erf_if_mapping* if_map_other = NULL;
  struct erf_if_info* if_info = NULL;
  struct erf_anchor_mapping* anchor_mapping = NULL;
  struct erf_anchor_mapping* anchor_mapping_other = NULL;
  char *oldstr = NULL;
  char portstr_buf[16];
  erf_priv->implicit_host_id = implicit_host_id;
  g_hash_table_iter_init(&iter, erf_priv->if_map);
  while (g_hash_table_iter_next(&iter, &iter_value, NULL)) {
    if_map = (struct erf_if_mapping*) iter_value;
    if (if_map->host_id == ERF_META_HOST_ID_IMPLICIT) {
      if_map_other = erf_find_interface_mapping(erf_priv, implicit_host_id, if_map->source_id);
      if (!if_map_other) {
        g_hash_table_iter_steal(&iter);
        implicit_list = g_list_prepend(implicit_list, if_map);
      } else {
        for (i = 0; i < ERF_MAX_INTERFACES; i++) {
          if_info = &if_map->interfaces[i];
          if (if_info->if_index >= 0) {
            int_data = g_array_index(wth->interface_data, wtap_block_t, if_info->if_index);
            snprintf(portstr_buf, sizeof(portstr_buf), "Port %c", 'A'+i);
            oldstr = if_info->name;
            if_info->name = g_strconcat(oldstr ? oldstr : portstr_buf, " [unmatched implicit]", NULL);
            g_free(oldstr); 
            oldstr = if_info->descr;
            if_info->descr = g_strconcat(oldstr ? oldstr : portstr_buf, " [unmatched implicit]", NULL);
            g_free(oldstr);
            erf_set_interface_descr(int_data, OPT_IDB_NAME, implicit_host_id, if_map->source_id, (unsigned char) i, if_info->name);
            erf_set_interface_descr(int_data, OPT_IDB_DESCRIPTION, implicit_host_id, if_map->source_id, (unsigned char) i, if_info->descr);
          }
        }
      }
    }
  }
  if (implicit_list) {
    item = implicit_list;
    do {
      if_map = (struct erf_if_mapping*) item->data;
      for (i = 0; i < ERF_MAX_INTERFACES; i++) {
        if_info = &if_map->interfaces[i];
        if (if_info->if_index >= 0) {
          int_data = g_array_index(wth->interface_data, wtap_block_t, if_info->if_index);
          erf_set_interface_descr(int_data, OPT_IDB_NAME, implicit_host_id, if_map->source_id, (unsigned char) i, if_info->name);
          erf_set_interface_descr(int_data, OPT_IDB_DESCRIPTION, implicit_host_id, if_map->source_id, (unsigned char) i, if_info->descr);
        }
      }
      if_map->host_id = implicit_host_id;
      g_hash_table_replace(erf_priv->if_map, if_map, if_map);
    } while ((item = g_list_next(item)));
    g_list_free(implicit_list);
    implicit_list = NULL;
  }
  g_hash_table_iter_init(&iter, erf_priv->anchor_map);
  while (g_hash_table_iter_next(&iter, &iter_value, NULL)) {
    anchor_mapping = (struct erf_anchor_mapping*) iter_value;
    if (anchor_mapping->host_id == ERF_META_HOST_ID_IMPLICIT) {
      anchor_mapping_other = erf_find_anchor_mapping(erf_priv, implicit_host_id,
          anchor_mapping->anchor_id);
      if (anchor_mapping_other && anchor_mapping_other->gen_time >= anchor_mapping->gen_time) {
          g_hash_table_iter_remove(&iter);
      } else {
        g_hash_table_iter_steal(&iter);
        implicit_list = g_list_prepend(implicit_list, anchor_mapping);
      }
    }
  }
  if (implicit_list) {
    item = implicit_list;
    do {
      anchor_mapping = (struct erf_anchor_mapping*) item->data;
      anchor_mapping->host_id = implicit_host_id;
      g_hash_table_replace(erf_priv->anchor_map, anchor_mapping, anchor_mapping);
    } while ((item = g_list_next(item)));
    g_list_free(implicit_list);
    implicit_list = NULL;
  }
  return 0;
}
