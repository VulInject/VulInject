static int irdma_puda_poll_info(struct irdma_sc_cq *cq,
				struct irdma_puda_cmpl_info *info)
{
	struct irdma_cq_uk *cq_uk = &cq->cq_uk;
	unsigned int int qword0, qword2, qword3, qword6;
	__le64 *cqe;
	__le64 *ext_cqe = NULL;
	unsigned int int qword7 = 0;
	unsigned int int comp_ctx;
	bool valid_bit;
	bool ext_valid = 0;
	unsigned int major_err, minor_err;
	unsigned int peek_head;
	bool error;
	unsigned char polarity;
	cqe = IRDMA_GET_CURRENT_CQ_ELEM(&cq->cq_uk);
	get_64bit_val(cqe, 24, &qword3);
	valid_bit = (bool)FIELD_GET(IRDMA_CQ_VALID, qword3);
	if (valid_bit != cq_uk->polarity)
		return -ENOENT;
	dma_rmb();
	if (cq->dev->hw_attrs.uk_attrs.hw_rev >= IRDMA_GEN_2)
		ext_valid = (bool)FIELD_GET(IRDMA_CQ_EXTCQE, qword3);
	if (ext_valid) {
		peek_head = (cq_uk->cq_ring.head + 1) % cq_uk->cq_ring.size;
		ext_cqe = cq_uk->cq_base[peek_head].buf;
		get_64bit_val(ext_cqe, 24, &qword7);
		polarity = (unsigned char)FIELD_GET(IRDMA_CQ_VALID, qword7);
		if (!peek_head)
			polarity ^= 1;
		if (polarity != cq_uk->polarity)
			return -ENOENT;
		dma_rmb();
		if (!IRDMA_RING_CURRENT_HEAD(cq_uk->cq_ring))
			cq_uk->polarity = !cq_uk->polarity;
		IRDMA_RING_MOVE_TAIL(cq_uk->cq_ring);
	}
	print_hex_dump_debug("PUDA: PUDA CQE", DUMP_PREFIX_OFFSET, 16, 8, cqe,
			     32, false);
	if (ext_valid)
		print_hex_dump_debug("PUDA: PUDA EXT-CQE", DUMP_PREFIX_OFFSET,
				     16, 8, ext_cqe, 32, false);
	error = (bool)FIELD_GET(IRDMA_CQ_ERROR, qword3);
	if (error) {
		ibdev_dbg(to_ibdev(cq->dev), "PUDA: receive error\n");
		major_err = (unsigned int)(FIELD_GET(IRDMA_CQ_MAJERR, qword3));
		minor_err = (unsigned int)(FIELD_GET(IRDMA_CQ_MINERR, qword3));
		info->compl_error = major_err << 16 | minor_err;
		return -EIO;
	}
	get_64bit_val(cqe, 0, &qword0);
	get_64bit_val(cqe, 16, &qword2);
	info->q_type = (unsigned char)FIELD_GET(IRDMA_CQ_SQ, qword3);
	info->qp_id = (unsigned int)FIELD_GET(IRDMACQ_QPID, qword2);
	if (cq->dev->hw_attrs.uk_attrs.hw_rev >= IRDMA_GEN_2)
		info->ipv4 = (bool)FIELD_GET(IRDMACQ_IPV4, qword3);
	get_64bit_val(cqe, 8, &comp_ctx);
	info->qp = (struct irdma_qp_uk *)(unsigned int)comp_ctx;
	info->wqe_idx = (unsigned int)FIELD_GET(IRDMA_CQ_WQEIDX, qword3);
	if (info->q_type == IRDMA_CQE_QTYPE_RQ) {
		if (ext_valid) {
			info->vlan_valid = (bool)FIELD_GET(IRDMA_CQ_UDVLANVALID, qword7);
			if (info->vlan_valid) {
				get_64bit_val(ext_cqe, 16, &qword6);
				info->vlan = (unsigned short)FIELD_GET(IRDMA_CQ_UDVLAN, qword6);
			}
			info->smac_valid = (bool)FIELD_GET(IRDMA_CQ_UDSMACVALID, qword7);
			if (info->smac_valid) {
				get_64bit_val(ext_cqe, 16, &qword6);
				info->smac[0] = (unsigned char)((qword6 >> 40) & 0xFF);
				info->smac[1] = (unsigned char)((qword6 >> 32) & 0xFF);
				info->smac[2] = (unsigned char)((qword6 >> 24) & 0xFF);
				info->smac[3] = (unsigned char)((qword6 >> 16) & 0xFF);
				info->smac[4] = (unsigned char)((qword6 >> 8) & 0xFF);
				info->smac[5] = (unsigned char)(qword6 & 0xFF);
			}
		}
		if (cq->dev->hw_attrs.uk_attrs.hw_rev == IRDMA_GEN_1) {
			info->vlan_valid = (bool)FIELD_GET(IRDMA_VLAN_TAG_VALID, qword3);
			info->l4proto = (unsigned char)FIELD_GET(IRDMA_UDA_L4PROTO, qword2);
			info->l3proto = (unsigned char)FIELD_GET(IRDMA_UDA_L3PROTO, qword2);
		}
		info->payload_len = (unsigned int)FIELD_GET(IRDMACQ_PAYLDLEN, qword0);
	}
	return 0;
}
