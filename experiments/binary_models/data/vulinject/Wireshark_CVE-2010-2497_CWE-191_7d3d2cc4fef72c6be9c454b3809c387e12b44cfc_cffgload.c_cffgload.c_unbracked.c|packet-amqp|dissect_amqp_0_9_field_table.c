dissect_amqp_0_9_field_table(tvbuff_t *tvb, packet_info *pinfo, int offset, guint length, proto_item *item)
{
    proto_tree *field_table_tree, *field_item_tree;
    proto_item *field_item;
    guint       namelen, vallen;
    const guint8 *name;
    int         field_start;
    field_table_tree = proto_item_add_subtree(item, ett_amqp);
    while (length != 0) {
        field_start = offset;
        field_item = proto_tree_add_item(field_table_tree, hf_amqp_field, tvb,
                                   offset, 1, ENC_NA);
        namelen = tvb_get_guint8(tvb, offset);
        offset += 1;
        length -= 1;
        field_item_tree = proto_item_add_subtree(field_item, ett_amqp_0_9_field);
        proto_tree_add_item_ret_string(field_item_tree, hf_amqp_field_name, tvb, offset, namelen, ENC_UTF_8, pinfo->pool, &name);
        proto_item_set_text(field_item, "%s", name);
        offset += namelen;
        length -= namelen;
        increment_dissection_depth(pinfo);
        vallen = dissect_amqp_0_9_field_value(tvb, pinfo, offset, length, name, field_item_tree);
        decrement_dissection_depth(pinfo);
        if(vallen == 0)
            goto too_short;
        offset += vallen;
        length -= vallen;
    }
    return;
too_short:
    proto_tree_add_expert(field_table_tree, pinfo, &ei_amqp_field_short, tvb, field_start, offset - field_start);
    return;
}
