col_do_append_fstr(column_info *cinfo, const int el, const char *separator, const char *format, va_list ap)
{
  size_t len, max_len, sep_len, pos;
  int    i;
  col_item_t* col_item;
  char tmp[COL_BUF_MAX_LEN];
  sep_len = (separator) ? strlen(separator) : 0;
  if (el == COL_INFO)
    max_len = COL_MAX_INFO_LEN;
  else
    max_len = COL_MAX_LEN;
  for (i = cinfo->col_first[el]; i <= cinfo->col_last[el]; i++) {
    col_item = &cinfo->columns[i];
    if (col_item->fmt_matx[el]) {
      len = strlen(col_item->col_buf);
      if (sep_len != 0 && len != 0) {
        (void) ws_label_strcat(col_item->col_buf, max_len, separator, 0);
        len += sep_len;
      }
      if (len < max_len) {
        va_list ap2;
        va_copy(ap2, ap);
        pos = vsnprintf(tmp, sizeof(tmp), format, ap2);
        va_end(ap2);
        if (pos >= max_len) {
          ws_utf8_truncate(tmp, max_len - 1);
        }
        WS_UTF_8_CHECK(tmp, -1);
        ws_label_strcpy(col_item->col_buf, max_len, len, tmp, 0);
      }
    }
  }
}
