static int _idtfc3_settime(struct idtfc3 *idtfc3, const struct timespec64 *ts)
{
	int offset_ns, now_ns;
	unsigned int counter, sub_ns;
	int now;
	if (timespec64_valid(ts) == false) {
		dev_err(idtfc3->dev, "%s: invalid timespec", __func__);
		return -EINVAL;
	}
	now = idtfc3_read_subcounter(idtfc3);
	if (now < 0)
		return now;
	offset_ns = (idtfc3->sub_sync_count - now) * idtfc3->ns_per_counter;
	now_ns = timespec64_to_ns(ts);
	(void)ns2counters(idtfc3, offset_ns + now_ns, &sub_ns);
	counter = sub_ns / idtfc3->ns_per_counter;
	return idtfc3_timecounter_update(idtfc3, counter, now_ns);
}
