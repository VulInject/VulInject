sethostname (const char *name, size_t len)
{
  if (len > HOST_NAME_MAX)
    {
      errno = EINVAL;
      return -1;
    }
# ifdef __minix 
  {
    FILE *hostf;
    int r = 0;
    hostf = fopen ("/etc/hostname.file", "we");
    if (hostf == NULL)
      r = -1;
    else
      {
        fprintf (hostf, "%.*s\n", (int) len, name);
        if (ferror (hostf))
          {
            int saved_errno = errno;
            fclose (hostf);
            errno = saved_errno;
            r = -1;
          }
        else
          {
            if (fclose (hostf))
              r = -1;
          }
      }
    return r;
  }
# else
  errno = ENOSYS;
  return -1;
# endif
}
sethostname (const char *name, size_t len)
{
  char name_asciz[HOST_NAME_MAX + 1];
  char old_name[HOST_NAME_MAX + 1];
  DWORD old_name_len;
  if (len > HOST_NAME_MAX)
    {
      errno = EINVAL;
      return -1;
    }
  memcpy (name_asciz, name, len);
  name_asciz[len] = '\0';
  old_name_len = sizeof (old_name) - 1;
  if (! GetComputerNameEx (ComputerNamePhysicalNetBIOS,
                           old_name, &old_name_len))
    old_name_len = 0;
  if (! SetComputerNameEx (ComputerNamePhysicalNetBIOS, name_asciz))
    {
      errno = (GetLastError () == ERROR_ACCESS_DENIED ? EPERM : EINVAL);
      return -1;
    }
  if (! SetComputerNameEx (ComputerNamePhysicalDnsHostname, name_asciz))
    {
      errno = (GetLastError () == ERROR_ACCESS_DENIED ? EPERM : EINVAL);
      if (old_name_len > 0)
        {
          old_name[old_name_len] = '\0';
        }
      return -1;
    }
  return 0;
}
