add_mark(list_T *l, char_u *mname, pos_T *pos, int bufnr, char_u *fname)
{
    dict_T	*d;
    list_T	*lpos;
    if (pos->lnum <= 0)
	return OK;
    d = dict_alloc();
    if (d == NULL)
	return FAIL;
    if (list_append_dict(l, d) == FAIL)
    {
	dict_unref(d);
	return FAIL;
    }
    lpos = list_alloc();
    if (lpos == NULL)
	return FAIL;
    list_append_number(lpos, pos->lnum);
    list_append_number(lpos, pos->col + 1);
    list_append_number(lpos, pos->coladd);
    if (dict_add_string(d, "mark", mname) == FAIL
	    || dict_add_list(d, "pos", lpos) == FAIL
	    || (fname != NULL && dict_add_string(d, "file", fname) == FAIL))
	return FAIL;
    return OK;
}
