int xen_evtchn_set_port(uint16_t port)
{
    XenEvtchnState *s = xen_evtchn_singleton;
    XenEvtchnPort *p;
    int ret = -EINVAL;
    if (!s) {
        return -ENOTSUP;
    }
    if (!valid_port(port)) {
        return -EINVAL;
    }
    p = &s->port_table[port];
    /* QEMU has no business sending to anything but these */
    if (p->type == EVTCHNSTAT_virq ||
        (p->type == EVTCHNSTAT_interdomain && p->u.interdomain.to_qemu)) {
        set_port_pending(s, port);
        ret = 0;
    }
    qemu_mutex_unlock(&s->port_lock);
    return ret;
}
