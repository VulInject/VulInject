int pci_generic_config_write32(struct pci_bus *bus, unsigned int devfn,
			       int where, int size, unsigned int val)
{
	void __iomem *addr;
	int mask, tmp;
	addr = bus->ops->map_bus(bus, devfn, where & ~0x3);
	if (!addr)
		return PCIBIOS_DEVICE_NOT_FOUND;
	if (size == 4) {
		writel(val, addr);
		return PCIBIOS_SUCCESSFUL;
	}
	if (!bus->unsafe_warn) {
		dev_warn(&bus->dev, "%d-byte config write to %04x:%02x:%02x.%d offset %#x may corrupt adjacent RW1C bits\n",
			 size, pci_domain_nr(bus), bus->number,
			 PCI_SLOT(devfn), PCI_FUNC(devfn), where);
		bus->unsafe_warn = 1;
	}
	mask = ~(((1 << (size * 8)) - 1) << ((where & 0x3) * 8));
	tmp = readl(addr) & mask;
	tmp |= val << ((where & 0x3) * 8);
	writel(tmp, addr);
	return PCIBIOS_SUCCESSFUL;
}
