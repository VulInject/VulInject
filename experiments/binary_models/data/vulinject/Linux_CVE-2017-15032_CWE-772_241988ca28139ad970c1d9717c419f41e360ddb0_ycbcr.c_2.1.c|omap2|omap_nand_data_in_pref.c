static void omap_nand_data_in_pref(struct nand_chip *chip, void *buf,
				   unsigned int len, bool force_8bit)
{
	struct omap_nand_info *info = mtd_to_omap(nand_to_mtd(chip));
	unsigned int r_count = 0;
	int ret = 0;
	unsigned int *p = (unsigned int *)buf;
	unsigned int pref_len;
	if (force_8bit) {
		omap_nand_data_in(chip, buf, len, force_8bit);
		return;
	}
	pref_len = len - (len & 3);
	ret = omap_prefetch_enable(info->gpmc_cs,
			PREFETCH_FIFOTHRESHOLD_MAX, 0x0, pref_len, 0x0, info);
	if (ret) {
		omap_nand_data_in(chip, buf, len, false);
	} else {
		do {
			r_count = readl(info->reg.gpmc_prefetch_status);
			r_count = r_count >> 2;
			ioread32_rep(info->fifo, p, r_count);
			p += r_count;
			pref_len -= r_count << 2;
		} while (pref_len);
		omap_prefetch_reset(info->gpmc_cs, info);
		if (len & 3)
			omap_nand_data_in(chip, p, len & 3, false);
	}
}
