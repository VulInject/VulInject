check_scmudid_validity(opensafety_packet_info *packet, tvbuff_t *message_tvb)
{
    guint8      b_ID, spdoFlags, udidLen;
    GByteArray *scmUDID = NULL;
    packet->scm_udid_valid = FALSE;
    scmUDID = g_byte_array_new();
    if ( hex_str_to_bytes((local_scm_udid != NULL ? local_scm_udid : global_scm_udid), scmUDID, TRUE) && scmUDID->len == 6 )
    {
        packet->scm_udid_valid = TRUE;
        b_ID = tvb_get_guint8(message_tvb, packet->frame.subframe2 + 1) ^ (guint8)(scmUDID->data[OSS_FRAME_POS_ID]);
        if ( ( OSS_FRAME_ID_T(message_tvb, packet->frame.subframe1) ^ (b_ID & 0xFC)) != 0 )
            packet->scm_udid_valid = FALSE;
        if ( packet->msg_id == OPENSAFETY_MSG_SPDO_DATA_ONLY )
        {
            spdoFlags = ( tvb_get_guint8(message_tvb, packet->frame.subframe2 + 4 ) ^ scmUDID->data[4] ) ;
            spdoFlags = ( spdoFlags >> 2 ) & OPENSAFETY_SPDO_FEATURE_FLAGS;
            if ( ( spdoFlags & OPENSAFETY_SPDO_FEAT_40BIT_USED ) == OPENSAFETY_SPDO_FEAT_40BIT_USED )
                packet->scm_udid_valid = TRUE;
        }
        if ( packet->scm_udid_valid == TRUE )
            memcpy(packet->scm_udid, scmUDID->data, 6);
    }
    udidLen = scmUDID->len;
    return udidLen;
}
