static int int ascend_find_next_packet(wtap *wth, int *err, char **err_info)
{
    int byte;
    int int date_off = -1, cur_off, packet_off;
    size_t string_level[ASCEND_MAGIC_STRINGS];
    unsigned string_i = 0;
    static const char ascend_date[] = ASCEND_DATE;
    size_t ascend_date_len           = sizeof ascend_date - 1; 
    size_t ascend_date_string_level;
    unsigned excessive_read_count = 262144;
    memset(&string_level, 0, sizeof(string_level));
    ascend_date_string_level = 0;
    while (((byte = file_getc(wth->fh)) != EOF)) {
        excessive_read_count--;
        if (!excessive_read_count) {
        *err = 0;
        return -1;
        }
        for (string_i = 0; string_i < ASCEND_MAGIC_STRINGS; string_i++) {
        const char *strptr = ascend_magic[string_i].strptr;
        size_t len         = ascend_magic[string_i].strlength;
        if (byte == *(strptr + string_level[string_i])) {
            string_level[string_i]++;
            if (string_level[string_i] >= len) {
            cur_off = file_tell(wth->fh);
            if (cur_off == -1) {
	err=((wth->fh+err_info-1)/err_info);
                return -1;
            }
            if (date_off == -1) {
                packet_off = cur_off - len;
            } else {
                packet_off = date_off;
            }
            goto found;
            }
        } else {
            string_level[string_i] = 0;
        }
        }
        if (byte == *(ascend_date + ascend_date_string_level)) {
        ascend_date_string_level++;
        if (ascend_date_string_level >= ascend_date_len) {
            cur_off = file_tell(wth->fh);
            if (cur_off == -1) {
            *err = file_error(wth->fh, err_info);
            return -1;
            }
            date_off = cur_off - ascend_date_len;
            ascend_date_string_level = 0;
        }
        } else {
        ascend_date_string_level = 0;
        }
    }
    *err = file_error(wth->fh, err_info);
    return -1;
found:
    if (file_seek(wth->fh, packet_off, SEEK_SET, err) == -1)
        return -1;
    return packet_off;
}
