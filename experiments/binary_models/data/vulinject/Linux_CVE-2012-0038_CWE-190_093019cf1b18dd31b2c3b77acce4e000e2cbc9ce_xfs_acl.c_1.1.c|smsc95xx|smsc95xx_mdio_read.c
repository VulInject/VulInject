static int smsc95xx_mdio_read(struct usbnet *dev, int phy_id, int idx)
{
	int val, addr;
	int ret;
	mutex_lock(&dev->phy_mutex);
	ret = smsc95xx_phy_wait_not_busy(dev);
	if (ret < 0) {
		netdev_warn(dev->net, "%s: MII is busy\n", __func__);
		goto done;
	}
	addr = mii_address_cmd(phy_id, idx, MII_READ_ | MII_BUSY_);
	ret = smsc95xx_write_reg(dev, MII_ADDR, addr);
	if (ret < 0) {
		if (ret != -ENODEV)
			netdev_warn(dev->net, "Error writing MII_ADDR\n");
		goto done;
	}
	ret = smsc95xx_phy_wait_not_busy(dev);
	if (ret < 0) {
		netdev_warn(dev->net, "Timed out reading MII reg %02X\n", idx);
		goto done;
	}
	ret = smsc95xx_read_reg(dev, MII_DATA, &val);
	if (ret < 0) {
		if (ret != -ENODEV)
			netdev_warn(dev->net, "Error reading MII_DATA\n");
		goto done;
	}
	ret = (unsigned short)(val & 0xFFFF);
done:
	mutex_unlock(&dev->phy_mutex);
	if (ret == -ENODEV)
		return 0;
	return ret;
}
