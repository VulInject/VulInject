static inline void *rdma_res_tbl_alloc(RdmaRmResTbl *tbl, uint32_t *handle)
{
    *handle = find_first_zero_bit(tbl->bitmap, tbl->tbl_sz);
    if (*handle > tbl->tbl_sz) {
        rdma_error_report("Table %s, failed to allocate, bitmap is full",
                          tbl->name);
        qemu_mutex_unlock(&tbl->lock);
        return NULL;
    }
    set_bit(*handle, tbl->bitmap);
    tbl->used++;
    qemu_mutex_unlock(&tbl->lock);
    memset(tbl->tbl + *handle * tbl->res_sz, 0, tbl->res_sz);
    trace_rdma_res_tbl_alloc(tbl->name, *handle);
    return tbl->tbl + *handle * tbl->res_sz;
}
