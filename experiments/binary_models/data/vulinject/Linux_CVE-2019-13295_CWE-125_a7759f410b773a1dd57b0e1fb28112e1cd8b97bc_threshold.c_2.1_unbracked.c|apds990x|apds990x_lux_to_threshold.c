static unsigned short apds990x_lux_to_threshold(struct apds990x_chip *chip, unsigned int lux)
{
	unsigned int thres;
	unsigned int cpl;
	else if (lux == APDS_RANGE)
		return APDS_RANGE;
	lux = lux * (APDS_CALIB_SCALER / 4) / (chip->lux_calib / 4);
	cpl = ((unsigned int)chip->atime * (unsigned int)again[chip->again_next] *
		APDS_PARAM_SCALE * 64) / (chip->cf.ga * chip->cf.df);
	thres = lux * cpl / 64;
	ir = (unsigned int)chip->lux_ir * (unsigned int)again[chip->again_next] /
		(unsigned int)again[chip->again_meas];
	if (chip->lux_clear * APDS_PARAM_SCALE >=
		chip->rcf.afactor * chip->lux_ir)
		thres = (chip->rcf.cf1 * thres + chip->rcf.irf1 * ir) /
			APDS_PARAM_SCALE;
	else
		thres = (chip->rcf.cf2 * thres + chip->rcf.irf2 * ir) /
			APDS_PARAM_SCALE;
	if (thres >= chip->a_max_result)
		thres = chip->a_max_result - 1;
	return thres;
}
