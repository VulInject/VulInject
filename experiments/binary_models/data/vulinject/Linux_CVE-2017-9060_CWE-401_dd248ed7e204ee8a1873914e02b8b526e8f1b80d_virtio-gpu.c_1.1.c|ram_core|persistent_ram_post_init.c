static int persistent_ram_post_init(struct persistent_ram_zone *prz, unsigned int sig,
				    struct persistent_ram_ecc_info *ecc_info)
{
	int ret;
	bool zap = !!(prz->flags & PRZ_FLAG_ZAP_OLD);
	ret = persistent_ram_init_ecc(prz, ecc_info);
	if (ret) {
		pr_warn("ECC failed %s\n", prz->label);
		return ret;
	}
	sig ^= PERSISTENT_RAM_SIG;
	if (prz->buffer->sig == sig) {
		if (buffer_size(prz) == 0 && buffer_start(prz) == 0) {
			pr_debug("found existing empty buffer\n");
			return 0;
		}
		if (buffer_size(prz) > prz->buffer_size ||
		    buffer_start(prz) > buffer_size(prz)) {
			pr_info("found existing invalid buffer, size %zu, start %zu\n",
				buffer_size(prz), buffer_start(prz));
			zap = true;
		} else {
			pr_debug("found existing buffer, size %zu, start %zu\n",
				 buffer_size(prz), buffer_start(prz));
		}
	} else {
		pr_debug("no valid data in buffer (sig = 0x%08x)\n",
			 prz->buffer->sig);
		prz->buffer->sig = sig;
		zap = true;
	}
	if (zap)
		persistent_ram_zap(prz);
	return 0;
}
