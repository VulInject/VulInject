proto_reg_handoff_amqp(void)
{
    static guint old_amqps_port = 0;
    static gboolean initialize = FALSE;
    if (!initialize) {
        dissector_add_uint_with_preference("tcp.port", AMQP_PORT, amqp_tcp_handle);
        dissector_add_uint("amqp.version", AMQP_V0_9, create_dissector_handle( dissect_amqpv0_9, proto_amqpv0_9 ));
        dissector_add_uint("amqp.version", AMQP_V0_10, create_dissector_handle( dissect_amqpv0_10, proto_amqpv0_10 ));
        dissector_add_uint("amqp.version", AMQP_V1_0, create_dissector_handle( dissect_amqpv1_0, proto_amqpv1_0 ));
        media_type_subdissector_table = find_dissector_table ("media_type");
        initialize = TRUE;
    }
    if (old_amqps_port != amqps_port) {
        if (old_amqps_port != 0)
        ssl_dissector_add(amqps_port, amqp_tcp_handle);
        old_amqps_port = amqps_port;
    }
}
