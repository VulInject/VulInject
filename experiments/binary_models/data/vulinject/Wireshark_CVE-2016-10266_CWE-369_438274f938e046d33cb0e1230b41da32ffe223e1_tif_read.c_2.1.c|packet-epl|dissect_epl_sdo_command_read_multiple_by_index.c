dissect_epl_sdo_command_read_multiple_by_index(struct epl_convo *convo, proto_tree *epl_tree, tvbuff_t *tvb, packet_info *pinfo, gint offset, guint8 segmented, gboolean response, guint16 segment_size)
{
	gint dataoffset;
	guint8 subindex = 0x00,  padding = 0x00;
	guint16 idx = 0x00, error = 0xFF, sub_val = 0x00;
	gboolean nosub = FALSE;
	guint32 size, offsetincrement, datalength, remlength, objectcnt, abort_code;
	gboolean lastentry = FALSE, is_abort = FALSE;
	const gchar *index_str, *sub_str, *sub_index_str;
	proto_item *psf_item, *psf_od_item;
	proto_tree *psf_tree, *psf_od_tree;
	struct object *obj = NULL;
	const struct subobject *subobj = NULL;
	const char *name;
	guint16 segment_restsize = segment_size;
	if (response)
	{
		col_append_fstr(pinfo->cinfo, COL_INFO, "%s[%d]:",
				val_to_str_ext(EPL_ASND_SDO_COMMAND_READ_MULTIPLE_PARAMETER_BY_INDEX,
				&epl_sdo_asnd_commands_short_ext, "Command(%02X)"),
				segment_size);
		remlength = (guint32)tvb_reported_length_remaining(tvb, offset);
		objectcnt = 0;
		while ( !lastentry && remlength > 0 )
		{
			guint16 sod_index = error;
			offsetincrement = tvb_get_letohl(tvb, offset);
			padding = tvb_get_guint8 ( tvb, offset + 7 ) & 0x03;
			if ((tvb_get_guint8 ( tvb, offset + 7 ) & 0x80) == 0x80)
				is_abort = TRUE;
			if (offsetincrement == 0)
			{
				datalength = segment_restsize;
				lastentry = TRUE;
			}
			else
			{
				datalength = offsetincrement - (offset - EPL_SOA_EPLV_OFFSET);
			}
			segment_restsize -= datalength;
			if (datalength > remlength)
				break;
			if ((guint32)(padding + 8) >= datalength)
				break;
			size = datalength - 8 - padding;
			dataoffset = offset + 4;
			psf_od_tree = proto_tree_add_subtree(epl_tree, tvb, offset+4, 4+size, 0, NULL , "OD");
			if (segmented <= EPL_ASND_SDO_CMD_SEGMENTATION_INITIATE_TRANSFER)
			{
				idx = tvb_get_letohs(tvb, dataoffset);
	obj=((convo->profile+idx-1)/idx);
				if (!obj)
				{
					index_str = rval_to_str_const(idx, sod_cmd_str, "unknown");
					sod_index = str_to_val(index_str, sod_cmd_str_val, error);
					sub_index_str = val_to_str_ext_const(idx, &sod_cmd_no_sub, "unknown");
					nosub = str_to_val(sub_index_str, sod_cmd_str_no_sub, 0xFF) != 0xFF;
				}
				psf_item = proto_tree_add_item(psf_od_tree, hf_epl_asnd_sdo_cmd_data_index, tvb, offset+4, 2, ENC_LITTLE_ENDIAN);
				if(obj)
				{
					proto_item_append_text(psf_item, " (%s)", obj->info.name);
					nosub = obj->info.type_class == OD_ENTRY_SCALAR;
				}
				else if(sod_index == error)
				{
					proto_item_append_text(psf_item," (%s)", val_to_str_ext_const(((guint32)(idx<<16)), &sod_index_names, "User Defined"));
				}
				else
				{
					proto_item_append_text(psf_item," (%s", val_to_str_ext_const(((guint32)(sod_index<<16)), &sod_index_names, "User Defined"));
					proto_item_append_text(psf_item,"_%02Xh", (idx-sod_index));
					if(sod_index == EPL_SOD_PDO_RX_MAPP || sod_index == EPL_SOD_PDO_TX_MAPP)
					{
						proto_item_append_text(psf_item,"_AU64)");
					}
					else
					{
						proto_item_append_text(psf_item,"_REC)");
					}
				}
				if (objectcnt < 8)
					col_append_fstr(pinfo->cinfo, COL_INFO, " (0x%04X", idx);
				else
					col_append_str(pinfo->cinfo, COL_INFO, ".");
				if (sod_index != error)
					idx = sod_index;
				proto_item_append_text(psf_od_tree, " Idx: 0x%04X", idx);
				dataoffset += 2;
				subindex = tvb_get_guint8(tvb, dataoffset);
				subobj = subobject_lookup(obj, subindex);
				proto_item_append_text(psf_od_tree, " SubIdx: 0x%02X", subindex);
				sub_str = val_to_str_ext_const(idx, &sod_cmd_sub_str, "unknown");
				sub_val = str_to_val(sub_str, sod_cmd_sub_str_val,error);
				if(sub_val != error)
					idx = sub_val;
				if (subobj)
				{
					psf_item = proto_tree_add_item(psf_od_tree, hf_epl_asnd_sdo_cmd_data_subindex, tvb, dataoffset, 1, ENC_LITTLE_ENDIAN);
					proto_item_append_text(psf_item, " (%s)", subobj->info.name);
				}
				else if(idx == EPL_SOD_STORE_PARAM && subindex <= 0x7F && subindex >= 0x04)
				{
					psf_item = proto_tree_add_item(psf_od_tree, hf_epl_asnd_sdo_cmd_data_subindex, tvb, dataoffset, 1, ENC_LITTLE_ENDIAN);
					proto_item_append_text(psf_item, " (ManufacturerParam_%02Xh_U32)", subindex);
				}
				else if(idx == EPL_SOD_RESTORE_PARAM && subindex <= 0x7F && subindex >= 0x04)
				{
					psf_item = proto_tree_add_item(psf_od_tree, hf_epl_asnd_sdo_cmd_data_subindex, tvb, dataoffset, 1, ENC_LITTLE_ENDIAN);
					proto_item_append_text(psf_item, " (ManufacturerParam_%02Xh_U32)", subindex);
				}
				else if(idx == EPL_SOD_PDO_RX_MAPP && subindex >= 0x01 && subindex <= 0xfe)
				{
					psf_item = proto_tree_add_item(psf_od_tree, hf_epl_asnd_sdo_cmd_data_subindex, tvb, dataoffset, 1, ENC_LITTLE_ENDIAN);
					proto_item_append_text(psf_item, " (ObjectMapping)");
				}
				else if(idx == EPL_SOD_PDO_TX_MAPP && subindex >= 0x01 && subindex <= 0xfe)
				{
					psf_item = proto_tree_add_item(psf_od_tree, hf_epl_asnd_sdo_cmd_data_subindex, tvb, dataoffset, 1, ENC_LITTLE_ENDIAN);
					proto_item_append_text(psf_item, " (ObjectMapping)");
				}
				else if(subindex == 0x00)
				{
					psf_item = proto_tree_add_item(psf_od_tree, hf_epl_asnd_sdo_cmd_data_subindex, tvb, dataoffset, 1, ENC_LITTLE_ENDIAN);
					proto_item_append_text(psf_item, " (NumberOfEntries)");
				}
				else
				{
					psf_item = proto_tree_add_item(psf_od_tree, hf_epl_asnd_sdo_cmd_data_subindex, tvb, dataoffset, 1, ENC_LITTLE_ENDIAN);
					proto_item_append_text(psf_item, " (%s)", val_to_str_ext_const((subindex | (idx << 16)), &sod_index_names, "User Defined"));
				}
				if (objectcnt < 8)
				{
					if (nosub)
						col_append_fstr(pinfo->cinfo, COL_INFO, ")");
					else
						col_append_fstr(pinfo->cinfo, COL_INFO, "/%d)", subindex);
				}
				dataoffset += 1;
				proto_tree_add_uint(psf_od_tree, hf_epl_asnd_sdo_cmd_data_padding, tvb, dataoffset, 1, padding);
				dataoffset += 1;
				objectcnt++;
			}
			if (is_abort)
			{
				proto_tree_add_item(psf_od_tree, hf_epl_asnd_sdo_cmd_sub_abort, tvb, dataoffset - 1, 1, ENC_LITTLE_ENDIAN);
				abort_code = tvb_get_letohl(tvb, dataoffset);
				proto_item_append_text(psf_od_tree, " - %s", "Aborted");
				psf_item = proto_tree_add_item(psf_od_tree, hf_epl_sdo_multi_param_sub_abort, tvb, dataoffset, 4, ENC_LITTLE_ENDIAN);
				proto_item_append_text(psf_item," (%s)", val_to_str_ext_const(abort_code, &sdo_cmd_abort_code_ext, "Unknown"));
				is_abort = FALSE;
			}
			else
			{
				if((idx == EPL_SOD_PDO_TX_MAPP && subindex > 0x00) ||(idx == EPL_SOD_PDO_RX_MAPP && subindex > 0x00))
				{
					psf_item = proto_tree_add_item(epl_tree, hf_epl_asnd_sdo_cmd_data_mapping, tvb, dataoffset, 1, ENC_NA);
					psf_tree = proto_item_add_subtree(psf_item, ett_epl_asnd_sdo_cmd_data_mapping);
					idx = tvb_get_letohs(tvb, dataoffset);
					proto_tree_add_uint_format(psf_tree, hf_epl_asnd_sdo_cmd_data_mapping_index, tvb, dataoffset, 2, idx,"Index: 0x%04X", idx);
					dataoffset += 2;
					idx = tvb_get_letohs(tvb, dataoffset);
					proto_tree_add_uint_format(psf_tree, hf_epl_asnd_sdo_cmd_data_mapping_subindex, tvb, dataoffset, 1, idx,"SubIndex: 0x%02X", idx);
					dataoffset += 2;
					idx = tvb_get_letohs(tvb, dataoffset);
					proto_tree_add_uint_format(psf_tree, hf_epl_asnd_sdo_cmd_data_mapping_offset, tvb, dataoffset, 2, idx,"Offset: 0x%04X", idx);
					dataoffset += 2;
					proto_tree_add_item(psf_tree, hf_epl_asnd_sdo_cmd_data_mapping_length, tvb, dataoffset, 2, ENC_LITTLE_ENDIAN);
				}
				else
				{
					const struct epl_datatype *type = NULL;
					if (subobj)
						type = subobj->info.type;
					else if (obj)
						type = obj->info.type;
					dissect_epl_payload ( psf_od_tree, tvb, pinfo, dataoffset, size, type, EPL_ASND);
				}
			}
			offset += datalength;
			remlength = (guint32)tvb_reported_length_remaining(tvb, offset);
		}
		col_append_fstr(pinfo->cinfo, COL_INFO, " (%d)", objectcnt);
	}
	else
	{
		col_append_fstr(pinfo->cinfo, COL_INFO, "Request %s[%d]:",
				val_to_str_ext(EPL_ASND_SDO_COMMAND_READ_MULTIPLE_PARAMETER_BY_INDEX,
				&epl_sdo_asnd_commands_short_ext, "Command(%02X)"),
				segment_size);
		remlength = (guint32)tvb_reported_length_remaining(tvb, offset);
		objectcnt = 0;
		dataoffset = offset;
		while ( remlength > 0 )
		{
			guint16 sod_index = error;
			proto_tree *psf_entry;
			psf_od_item = proto_tree_add_subtree(epl_tree, tvb, offset, 4, 0, NULL, "OD");
			if (segmented <= EPL_ASND_SDO_CMD_SEGMENTATION_INITIATE_TRANSFER)
			{
				idx = tvb_get_letohs(tvb, dataoffset);
				obj = object_lookup(convo->profile, idx);
				if (!obj)
				{
					index_str = rval_to_str_const(idx, sod_cmd_str, "unknown");
					sod_index = str_to_val(index_str, sod_cmd_str_val, error);
					sub_index_str = val_to_str_ext_const(idx, &sod_cmd_no_sub, "unknown");
					nosub = str_to_val(sub_index_str, sod_cmd_str_no_sub,0xFF) != 0xFF;
				}
				if (objectcnt < 8)
					col_append_fstr(pinfo->cinfo, COL_INFO, " (0x%04X", idx);
				else
					col_append_str(pinfo->cinfo, COL_INFO, ".");
				if (sod_index != error)
					idx = sod_index;
				proto_item_append_text(psf_od_item, " Idx: 0x%04X", idx);
				psf_entry = proto_tree_add_uint_format(psf_od_item, hf_epl_asnd_sdo_cmd_data_mapping_index, tvb, dataoffset, 2, idx,"Index: 0x%04X", idx);
				if(obj)
				{
					proto_item_append_text(psf_entry, " (%s)", obj->info.name);
					nosub = obj->info.type_class == OD_ENTRY_SCALAR;
				}
				else if(sod_index == error)
				{
					name = val_to_str_ext_const(((guint32)(idx<<16)), &sod_index_names, "User Defined");
					proto_item_append_text(psf_entry," (%s)", name);
				}
				else
				{
					proto_item_append_text(psf_entry," (%s", val_to_str_ext_const(((guint32)(sod_index<<16)), &sod_index_names, "User Defined"));
					proto_item_append_text(psf_entry,"_%02Xh", (idx-sod_index));
					if(sod_index == EPL_SOD_PDO_RX_MAPP || sod_index == EPL_SOD_PDO_TX_MAPP)
					{
						proto_item_append_text(psf_entry,"_AU64)");
					}
					else
					{
						proto_item_append_text(psf_entry,"_REC)");
					}
				}
				dataoffset += 2;
				subindex = tvb_get_guint8(tvb, dataoffset);
				proto_item_append_text(psf_od_item, " SubIdx: 0x%02X", subindex);
				psf_item = proto_tree_add_uint_format(psf_od_item, hf_epl_asnd_sdo_cmd_data_mapping_subindex, tvb, dataoffset, 1, subindex,"SubIndex: 0x%02X", subindex);
				subobj = subobject_lookup(obj, subindex);
				name = subobj ? subobj->info.name
					      : val_to_str_ext_const((subindex|(idx<<16)), &sod_index_names, "User Defined");
				proto_item_append_text(psf_item, " (%s)", name);
				if (objectcnt < 8)
				{
					if (nosub)
						col_append_fstr(pinfo->cinfo, COL_INFO, ")");
					else
						col_append_fstr(pinfo->cinfo, COL_INFO, "/%d)", subindex);
				}
				dataoffset += 2;
				objectcnt++;
			}
			offset += 4;
			remlength = (guint32)tvb_reported_length_remaining(tvb, offset);
		}
		col_append_fstr(pinfo->cinfo, COL_INFO, " (%d)", objectcnt);
	}
	return offset;
}
