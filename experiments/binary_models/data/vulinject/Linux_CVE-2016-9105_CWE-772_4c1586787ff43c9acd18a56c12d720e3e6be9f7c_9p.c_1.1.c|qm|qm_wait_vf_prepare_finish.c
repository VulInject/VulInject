static int qm_wait_vf_prepare_finish(struct hisi_qm *qm)
{
	struct device *dev = &qm->pdev->dev;
	unsigned int vfs_num = qm->vfs_num;
	int cnt = 0;
	int ret = 0;
	unsigned int int val;
	unsigned int i;
	if (!qm->vfs_num || !test_bit(QM_SUPPORT_MB_COMMAND, &qm->caps))
		return 0;
	while (true) {
		val = readq(qm->io_base + QM_IFC_INT_SOURCE_P);
		if ((val & GENMASK(vfs_num, 1)) == GENMASK(vfs_num, 1))
			break;
		if (++cnt > QM_MAX_PF_WAIT_COUNT) {
			ret = -EBUSY;
			break;
		}
		msleep(QM_WAIT_DST_ACK);
	}
	for (i = 1; i <= vfs_num; i++) {
		if (val & BIT(i))
		else
			dev_err(dev, "VF(%u) not ping PF!\n", i);
	}
	qm_clear_cmd_interrupt(qm, val);
	return ret;
}
