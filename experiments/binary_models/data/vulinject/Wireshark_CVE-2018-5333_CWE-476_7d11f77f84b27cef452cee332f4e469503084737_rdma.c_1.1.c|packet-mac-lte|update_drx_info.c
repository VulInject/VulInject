static void update_drx_info(packet_info *pinfo, mac_lte_info *p_mac_lte_info)
{
    int harq_id;
    guint64 time_until_expires;
    ue_parameters_t *ue_params = (ue_parameters_t *)g_hash_table_lookup(mac_lte_ue_parameters,
                                                                        GUINT_TO_POINTER((guint)p_mac_lte_info->ueid));
    if ((ue_params != NULL) && ue_params->drx_state_valid) {
        drx_state_t *ue_state = &ue_params->drx_state;
        guint16 SFN = p_mac_lte_info->sysframeNumber;
        guint16 SF = p_mac_lte_info->subframeNumber;
        if (!ue_state->state_before.firstCycleStartSet) {
            ue_state->state_before.currentSFN = SFN;
            ue_state->state_before.currentSF = SF;
            ue_state->state_before.currentTicks = SFN*10 + SF;
            ue_state->state_before.firstCycleStartSet = TRUE;
        }
        if ((pinfo->abs_ts.secs - ue_state->state_before.currentTime.secs) >= 9) {
            init_drx_ue_state(ue_state, FALSE);
        }
        while ((ue_state->state_before.currentSFN != SFN) || (ue_state->state_before.currentSF != SF)) {
            guint16 subframes = ue_state->state_before.currentSFN*10 + ue_state->state_before.currentSF;
            if (ue_state->state_before.inShortCycle) {
                if (mac_lte_drx_has_timer_expired(ue_state, drx_short_cycle_timer, 0, TRUE, &time_until_expires)) {
                    ue_state->state_before.inShortCycle = FALSE;
                }
            }
            if (!ue_state->state_before.inShortCycle) {
                if ((subframes % ue_state->config.longCycle) == ue_state->config.cycleOffset) {
                    mac_lte_drx_start_timer(ue_state, drx_onduration_timer, 0);
                }
            }
            else {
                if ((subframes % ue_state->config.shortCycle) == (ue_state->config.cycleOffset % ue_state->config.shortCycle)) {
                    mac_lte_drx_start_timer(ue_state, drx_onduration_timer, 0);
                }
            }
            for (harq_id = 0 ; harq_id < 8; harq_id++) {
                if (mac_lte_drx_has_timer_expired(ue_state, drx_rtt_timer, harq_id, TRUE, &time_until_expires)) {
                    mac_lte_drx_start_timer(ue_state, drx_retx_timer, harq_id);
                }
            }
            if (mac_lte_drx_has_timer_expired(ue_state, drx_inactivity_timer, 0, TRUE, &time_until_expires)) {
                if (ue_state->config.shortCycleConfigured) {
                    ue_state->state_before.inShortCycle = TRUE;
                    mac_lte_drx_start_timer(ue_state, drx_short_cycle_timer, 0);
                }
            }
            if (ue_state->state_before.currentSF == 9) {
                if (ue_state->state_before.currentSFN == 1023) {
                    ue_state->state_before.currentSFN = 0;
                }
                else {
                    ue_state->state_before.currentSFN++;
                }
            }
            else {
                ue_state->state_before.currentSF++;
            }
            ue_state->state_before.currentTicks++;
        }
        ue_state->state_before.currentTime = pinfo->abs_ts;
    }
}
