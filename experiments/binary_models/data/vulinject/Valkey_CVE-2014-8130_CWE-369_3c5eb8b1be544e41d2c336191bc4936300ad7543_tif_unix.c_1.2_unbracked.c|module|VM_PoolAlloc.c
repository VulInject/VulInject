void *VM_PoolAlloc(ValkeyModuleCtx *ctx, size_t bytes) {
    ValkeyModulePoolAllocBlock *b = ctx->pa_head;
    size_t left = b ? b->size - b->used : 0;
    /* Fix alignment. */
    if (left >= bytes) {
        size_t alignment = VALKEYMODULE_POOL_ALLOC_ALIGN;
        while (bytes < alignment && alignment/2 >= bytes) alignment /= 2;
        if (b->used % alignment)
            b->used += alignment - (b->used % alignment);
        left = (b->used > b->size) ? 0 : b->size - b->used;
    }
    /* Create a new block if needed. */
    if (left < bytes) {
        size_t blocksize = VALKEYMODULE_POOL_ALLOC_MIN_SIZE;
        if (blocksize < bytes) blocksize = bytes;
        b = zmalloc(sizeof(*b) + blocksize);
        b->size = blocksize;
        b->used = 0;
        b->next = ctx->pa_head;
        ctx->pa_head = b;
    }
    char *retval = b->memory + b->used;
    b->used += bytes;
    return retval;
}
