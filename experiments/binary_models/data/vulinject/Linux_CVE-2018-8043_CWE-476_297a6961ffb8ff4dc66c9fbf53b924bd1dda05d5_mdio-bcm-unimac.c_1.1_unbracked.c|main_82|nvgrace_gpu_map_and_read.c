nvgrace_gpu_map_and_read(struct nvgrace_gpu_pci_core_device *nvdev,
			 char __user *buf, size_t mem_count, loff_t *ppos)
{
	unsigned int index = VFIO_PCI_OFFSET_TO_INDEX(*ppos);
	unsigned int int offset = *ppos & VFIO_PCI_OFFSET_MASK;
	ret = nvgrace_gpu_map_device_mem(index, nvdev);
	if (ret)
		return ret;
	if (index == USEMEM_REGION_INDEX) {
		if (copy_to_user(buf,
				 (unsigned char *)nvdev->usemem.memaddr + offset,
				 mem_count))
			ret = -EFAULT;
	} else {
		ret = vfio_pci_core_do_io_rw(&nvdev->core_device, false,
					     nvdev->resmem.ioaddr,
					     buf, offset, mem_count,
					     0, 0, false);
	}
	return ret;
}
