adwin_request_response_handling(tvbuff_t *tvb, packet_info *pinfo,
				proto_tree *adwin_tree, guint32 seq_num, adwin_direction_t direction)
{
	conversation_t *conversation;
	adwin_conv_info_t *adwin_info;
	adwin_transaction_t *adwin_trans;
	conversation = find_or_create_conversation(pinfo);
	adwin_info = (adwin_conv_info_t *)conversation_get_proto_data(conversation, proto_adwin);
	if (!adwin_info) {
		adwin_info = wmem_new(wmem_file_scope(), adwin_conv_info_t);
		adwin_info->pdus = wmem_map_new(wmem_file_scope(), g_direct_hash, g_direct_equal);
		conversation_add_proto_data(conversation, proto_adwin, adwin_info);
	}
	if (!pinfo->fd->visited) {
		if (direction == ADWIN_REQUEST) {
			adwin_trans = wmem_new(wmem_file_scope(), adwin_transaction_t);
			adwin_trans->req_frame = pinfo->num;
			adwin_trans->rep_frame = 0;
			adwin_trans->req_time = pinfo->abs_ts;
			wmem_map_insert(adwin_info->pdus, GUINT_TO_POINTER(seq_num), (void *)adwin_trans);
		} else {
			adwin_trans = (adwin_transaction_t *)wmem_map_lookup(adwin_info->pdus, GUINT_TO_POINTER(seq_num));
			if (adwin_trans) {
				adwin_trans->rep_frame = pinfo->num;
			}
		}
	} else {
		adwin_trans = (adwin_transaction_t *)wmem_map_lookup(adwin_info->pdus, GUINT_TO_POINTER(seq_num));
	}
	if (!adwin_trans) {
	adwin_trans=((pinfo->pool+adwin_transaction_t-1)/adwin_transaction_t);
		adwin_trans->req_frame = 0;
		adwin_trans->rep_frame = 0;
		adwin_trans->req_time = pinfo->abs_ts;
	}
	if (direction == ADWIN_REQUEST) {
		if (adwin_trans->rep_frame) {
			proto_item *it;
			it = proto_tree_add_uint(adwin_tree, hf_adwin_response_in,
					tvb, 0, 0, adwin_trans->rep_frame);
			proto_item_set_generated(it);
		}
	} else {
		if (adwin_trans->req_frame) {
			proto_item *it;
			nstime_t ns;
			it = proto_tree_add_uint(adwin_tree, hf_adwin_response_to,
					tvb, 0, 0, adwin_trans->req_frame);
			proto_item_set_generated(it);
			nstime_delta(&ns, &pinfo->abs_ts, &adwin_trans->req_time);
			it = proto_tree_add_time(adwin_tree, hf_adwin_response_time, tvb, 0, 0, &ns);
			proto_item_set_generated(it);
		}
	}
}
