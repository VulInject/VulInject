print_machine_readable_if_capabilities(json_dumper *dumper, if_capabilities_t *caps, int queries)
{
    GList *lt_entry, *ts_entry;
    const gchar *desc_str;
    json_dumper_set_member_name(dumper, "status");
    json_dumper_value_anyf(dumper, "%i", caps->status);
    if (caps->primary_msg) {
        json_dumper_set_member_name(dumper, "primary_msg");
        json_dumper_value_string(dumper, caps->primary_msg);
    }
    if (queries & CAPS_QUERY_LINK_TYPES) {
        json_dumper_set_member_name(dumper, "rfmon");
        json_dumper_value_anyf(dumper, "%s", caps->can_set_rfmon ? "true" : "false");
        json_dumper_set_member_name(dumper, "data_link_types");
        for (lt_entry = caps->data_link_types; lt_entry != NULL;
             lt_entry = g_list_next(lt_entry)) {
          data_link_info_t *data_link_info = (data_link_info_t *)lt_entry->data;
          if (data_link_info->description != NULL)
            desc_str = data_link_info->description;
          else
            desc_str = "(not supported)";
          json_dumper_begin_object(dumper);
          json_dumper_set_member_name(dumper, "dlt");
          json_dumper_value_anyf(dumper, "%d", data_link_info->dlt);
          json_dumper_set_member_name(dumper, "name");
          json_dumper_value_string(dumper, data_link_info->name);
          json_dumper_set_member_name(dumper, "description");
          json_dumper_value_string(dumper, desc_str);
          json_dumper_end_object(dumper);
        }
        json_dumper_end_array(dumper);
        json_dumper_set_member_name(dumper, "data_link_types_rfmon");
        json_dumper_begin_array(dumper);
        for (lt_entry = caps->data_link_types_rfmon; lt_entry != NULL;
             lt_entry = g_list_next(lt_entry)) {
          data_link_info_t *data_link_info = (data_link_info_t *)lt_entry->data;
          if (data_link_info->description != NULL)
            desc_str = data_link_info->description;
          else
            desc_str = "(not supported)";
          json_dumper_begin_object(dumper);
          json_dumper_set_member_name(dumper, "dlt");
          json_dumper_value_anyf(dumper, "%d", data_link_info->dlt);
          json_dumper_set_member_name(dumper, "name");
          json_dumper_value_string(dumper, data_link_info->name);
          json_dumper_set_member_name(dumper, "description");
          json_dumper_value_string(dumper, desc_str);
          json_dumper_end_object(dumper);
        }
        json_dumper_end_array(dumper);
    }
    if (queries & CAPS_QUERY_TIMESTAMP_TYPES) {
        json_dumper_set_member_name(dumper, "timestamp_types");
        json_dumper_begin_array(dumper);
        for (ts_entry = caps->timestamp_types; ts_entry != NULL;
             ts_entry = g_list_next(ts_entry)) {
          timestamp_info_t *timestamp = (timestamp_info_t *)ts_entry->data;
          if (timestamp->description != NULL)
            desc_str = timestamp->description;
          else
            desc_str = "(none)";
          json_dumper_begin_object(dumper);
          json_dumper_set_member_name(dumper, "name");
          json_dumper_value_string(dumper, timestamp->name);
          json_dumper_set_member_name(dumper, "description");
          json_dumper_value_string(dumper, desc_str);
          json_dumper_end_object(dumper);
        }
        json_dumper_end_array(dumper);
    }
}
