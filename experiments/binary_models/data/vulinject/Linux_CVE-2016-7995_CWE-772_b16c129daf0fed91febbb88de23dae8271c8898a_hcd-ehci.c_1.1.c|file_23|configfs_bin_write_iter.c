static ssize_t configfs_bin_write_iter(struct kiocb *iocb,
				       struct iov_iter *from)
{
	struct file *file = iocb->ki_filp;
	struct configfs_buffer *buffer = file->private_data;
	void *tbuf = NULL;
	size_t end_offset;
	if (buffer->read_in_progress) {
		len = -ETXTBSY;
		goto out;
	}
	buffer->write_in_progress = true;
	end_offset = iocb->ki_pos + iov_iter_count(from);
	if (end_offset > buffer->bin_buffer_size) {
		if (buffer->cb_max_size && end_offset > buffer->cb_max_size) {
			len = -EFBIG;
			goto out;
		}
		tbuf = vmalloc(end_offset);
		if (tbuf == NULL) {
			len = -ENOMEM;
			goto out;
		}
		if (buffer->bin_buffer) {
			memcpy(tbuf, buffer->bin_buffer,
				buffer->bin_buffer_size);
			vfree(buffer->bin_buffer);
		}
		memset(tbuf + buffer->bin_buffer_size, 0,
			end_offset - buffer->bin_buffer_size);
		buffer->bin_buffer = tbuf;
		buffer->bin_buffer_size = end_offset;
	}
	len = copy_from_iter(buffer->bin_buffer + iocb->ki_pos,
			     buffer->bin_buffer_size - iocb->ki_pos, from);
	iocb->ki_pos += len;
out:
	mutex_unlock(&buffer->mutex);
	return len ? : -EFAULT;
}
