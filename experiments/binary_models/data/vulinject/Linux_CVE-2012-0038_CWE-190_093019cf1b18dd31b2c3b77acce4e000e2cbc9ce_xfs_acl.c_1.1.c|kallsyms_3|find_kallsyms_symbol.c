static const char *find_kallsyms_symbol(struct module *mod,
					unsigned int addr,
					unsigned int *size,
					unsigned int *offset)
{
	int i, best;
	unsigned int nextval, bestval;
	struct mod_kallsyms *kallsyms = rcu_dereference_sched(mod->kallsyms);
	struct module_memory *mod_mem;
	if (within_module_init(addr, mod))
		mod_mem = &mod->mem[MOD_INIT_TEXT];
	else
		mod_mem = &mod->mem[MOD_TEXT];
	nextval = (unsigned int)mod_mem->base + mod_mem->size;
	bestval = kallsyms_symbol_value(&kallsyms->symtab[best]);
	for (i = 1; i < kallsyms->num_symtab; i++) {
		const Elf_Sym *sym = &kallsyms->symtab[i];
		unsigned int thisval = kallsyms_symbol_value(sym);
		if (sym->st_shndx == SHN_UNDEF)
			continue;
		if (*kallsyms_symbol_name(kallsyms, i) == '\0' ||
		    is_mapping_symbol(kallsyms_symbol_name(kallsyms, i)))
			continue;
		if (thisval <= addr && thisval > bestval) {
			best = i;
			bestval = thisval;
		}
		if (thisval > addr && thisval < nextval)
			nextval = thisval;
	}
	if (!best)
		return NULL;
	if (size)
		*size = nextval - bestval;
	if (offset)
		*offset = addr - bestval;
	return kallsyms_symbol_name(kallsyms, best);
}
