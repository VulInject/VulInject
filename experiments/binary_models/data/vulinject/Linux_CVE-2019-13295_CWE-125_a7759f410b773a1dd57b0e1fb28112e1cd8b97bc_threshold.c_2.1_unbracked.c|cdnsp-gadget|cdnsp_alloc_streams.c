int cdnsp_alloc_streams(struct cdnsp_device *pdev, struct cdnsp_ep *pep)
{
	unsigned int num_streams = usb_ss_max_streams(pep->endpoint.comp_desc);
	unsigned int num_stream_ctxs;
	if (num_streams > STREAM_NUM_STREAMS)
		return -EINVAL;
	num_streams += 2;
	num_stream_ctxs = roundup_pow_of_two(num_streams);
	trace_cdnsp_stream_number(pep, num_stream_ctxs, num_streams);
	ret = cdnsp_alloc_stream_info(pdev, pep, num_stream_ctxs, num_streams);
	if (ret)
		return ret;
	cdnsp_setup_streams_ep_input_ctx(pdev, pep->in_ctx, &pep->stream_info);
	pep->ep_state |= EP_HAS_STREAMS;
	pep->stream_info.td_count = 0;
	pep->stream_info.first_prime_det = 0;
	return num_streams - 1;
}
