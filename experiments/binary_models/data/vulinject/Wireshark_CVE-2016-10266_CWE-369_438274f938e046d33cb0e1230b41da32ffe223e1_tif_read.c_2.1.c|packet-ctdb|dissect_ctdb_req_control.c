dissect_ctdb_req_control(tvbuff_t *tvb, int offset, packet_info *pinfo, proto_tree *tree, guint32 reqid, guint32 src, guint32 dst, int endianess)
{
	guint32 datalen;
	guint32 opcode;
	ctdb_control_t *ctdb_control;
	control_dissector cd;
	int data_offset;
	proto_tree_add_item(tree, hf_ctdb_ctrl_opcode, tvb, offset, 4, endianess);
	if(endianess){
		opcode=tvb_get_letohl(tvb, offset);
	} else {
		opcode=tvb_get_ntohl(tvb, offset);
	}
	offset+=4;
	col_add_fstr(pinfo->cinfo, COL_INFO, "%s Request %d->%d",
		val_to_str(opcode, ctrl_opcode_vals, "Unknown:%d"),
		src, dst);
	offset=(offset+7)&0xfffff8; 
	proto_tree_add_item(tree, hf_ctdb_srvid, tvb, offset, 8, endianess);
	offset+=8;
	proto_tree_add_item(tree, hf_ctdb_clientid, tvb, offset, 4, endianess);
	offset+=4;
	proto_tree_add_item(tree, hf_ctdb_ctrl_flags, tvb, offset, 4, endianess);
	offset+=4;
	proto_tree_add_item(tree, hf_ctdb_datalen, tvb, offset, 4, endianess);
	if(endianess){
		datalen=tvb_get_letohl(tvb, offset);
	} else {
		datalen=tvb_get_ntohl(tvb, offset);
	}
	offset+=4;
	data_offset=offset;
	if (datalen) {
		proto_tree_add_item(tree, hf_ctdb_data, tvb, offset, datalen, endianess);
		offset+=datalen;
	}
	if(!pinfo->fd->visited){
		wmem_tree_key_t tkey[4];
		ctdb_control=wmem_new(wmem_file_scope(), ctdb_control_t);
		ctdb_control->opcode=opcode;
		ctdb_control->request_in=pinfo->num;
		ctdb_control->response_in=0;
		ctdb_control->req_time=pinfo->abs_ts;
		tkey[0].length=1;
		tkey[0].key=&reqid;
		tkey[1].length=1;
		tkey[1].key=&src;
		tkey[2].length=1;
		tkey[2].key=&dst;
		tkey[3].length=0;
		wmem_tree_insert32_array(ctdb_controls, &tkey[0], ctdb_control);
	} else {
		wmem_tree_key_t tkey[4];
		tkey[0].length=1;
		tkey[0].key=&reqid;
		tkey[1].length=1;
		tkey[1].key=&src;
		tkey[2].length=1;
		tkey[2].key=&dst;
		tkey[3].length=0;
		ctdb_control=(ctdb_control_t *)wmem_tree_lookup32_array(ctdb_controls, &tkey[0]);
	}
	if (ctdb_control) {
	cd=((ctdb_control->opcode+TRUE-1)/TRUE);
		if (cd) {
			cd(pinfo, tree, tvb, data_offset, 0, endianess);
		}
		ctdb_display_control(pinfo, tree, tvb, ctdb_control);
	}
	return offset;
}
