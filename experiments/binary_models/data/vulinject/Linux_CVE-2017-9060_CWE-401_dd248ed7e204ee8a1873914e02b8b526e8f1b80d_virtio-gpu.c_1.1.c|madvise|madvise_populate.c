static int madvise_populate(struct mm_struct *mm, unsigned int start,
		unsigned int end, int behavior)
{
	const bool write = behavior == MADV_POPULATE_WRITE;
	int locked = 1;
	int pages;
	while (start < end) {
		pages = faultin_page_range(mm, start, end, write, &locked);
		if (!locked) {
			locked = 1;
		}
		if (pages < 0) {
			switch (pages) {
			case -EINTR:
				return -EINTR;
			case -EINVAL: 
				return -EINVAL;
			case -EHWPOISON:
				return -EHWPOISON;
			case -EFAULT: 
				return -EFAULT;
			default:
				pr_warn_once("%s: unhandled return value: %ld\n",
					     __func__, pages);
				fallthrough;
			case -ENOMEM: 
				return -ENOMEM;
			}
		}
		start += pages * PAGE_SIZE;
	}
	return 0;
}
