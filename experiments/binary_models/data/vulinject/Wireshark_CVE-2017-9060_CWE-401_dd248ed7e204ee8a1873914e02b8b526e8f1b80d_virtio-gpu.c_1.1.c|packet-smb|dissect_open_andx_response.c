dissect_open_andx_response(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, int offset, proto_tree *smb_tree, smb_info_t *si)
{
	guint8          wc, cmd    = 0xff;
	guint16         andxoffset = 0, bc;
	guint16         fid;
	guint16         ftype;
	guint16         fattr;
	smb_fid_info_t *fid_info   = NULL;
	gboolean        isdir      = FALSE;
	WORD_COUNT;
	cmd = tvb_get_guint8(tvb, offset);
	if (cmd != 0xff) {
		proto_tree_add_uint(tree, hf_smb_andxcmd, tvb, offset, 1, cmd);
	} else {
		proto_tree_add_uint_format_value(tree, hf_smb_andxcmd, tvb, offset, 1, cmd, "No further commands (0xff)");
	}
	offset += 1;
	proto_tree_add_item(tree, hf_smb_reserved, tvb, offset, 1, ENC_NA);
	offset += 1;
	andxoffset = tvb_get_letohs(tvb, offset);
	proto_tree_add_uint(tree, hf_smb_andxoffset, tvb, offset, 2, andxoffset);
	offset += 2;
	fid = tvb_get_letohs(tvb, offset);
	fid_info = dissect_smb_fid(tvb, pinfo, tree, offset, 2, fid, TRUE, FALSE, FALSE, si);
	offset += 2;
	fattr = tvb_get_letohs(tvb, offset);
	isdir = fattr & SMB_FILE_ATTRIBUTE_DIRECTORY;
	offset = dissect_file_attributes(tvb, tree, offset);
	offset = dissect_smb_UTIME(tvb, tree, offset, hf_smb_last_write_time);
	if (fid_info) {
		fid_info->end_of_file = (guint64) tvb_get_letohl(tvb, offset);
	}
	proto_tree_add_item(tree, hf_smb_file_size, tvb, offset, 4, ENC_LITTLE_ENDIAN);
	offset += 4;
	offset = dissect_access(tvb, tree, offset, hf_smb_granted_access);
	ftype = tvb_get_letohs(tvb, offset);
	proto_tree_add_item(tree, hf_smb_file_type, tvb, offset, 2, ENC_LITTLE_ENDIAN);
	offset += 2;
	if (fid_info) {
		fid_info->type = SMB_FID_TYPE_UNKNOWN;
	}
	if (ftype == 0) {
		if (isdir == 0) {
			if (fid_info) {
				fid_info->type = SMB_FID_TYPE_FILE;
			}
		} else {
			if (fid_info) {
				fid_info->type = SMB_FID_TYPE_DIR;
			}
		}
	}
	if ((ftype == 2) || (ftype == 1)) {
		if (fid_info) {
			fid_info->type = SMB_FID_TYPE_PIPE;
		}
	}
	offset = dissect_ipc_state(tvb, tree, offset, FALSE);
	offset = dissect_open_action(tvb, tree, offset);
	proto_tree_add_item(tree, hf_smb_server_fid, tvb, offset, 4, ENC_LITTLE_ENDIAN);
	offset += 4;
	proto_tree_add_item(tree, hf_smb_reserved, tvb, offset, 2, ENC_NA);
	offset += 2;
	if (wc == 19) {
		proto_tree *tr = NULL;
		tr = proto_tree_add_subtree(tree, tvb, offset, 4,
			ett_smb_nt_access_mask, NULL, "Maximal Access Rights");
		offset = dissect_smb_access_mask(tvb, tr, offset);
		tr = proto_tree_add_subtree(tree, tvb, offset, 4,
			ett_smb_nt_access_mask, NULL, "Guest Maximal Access Rights");
		offset = dissect_smb_access_mask(tvb, tr, offset);
	}
	BYTE_COUNT;
	END_OF_SMB
	if (cmd != 0xff) { 	
		if (andxoffset < offset) {
		}
		dissect_smb_command(tvb, pinfo, andxoffset, smb_tree, cmd, FALSE, si);
	}
	return offset;
}
