glwthread_timedmutex_lock (glwthread_timedmutex_t *mutex)
{
  if (!mutex->guard.done)
    {
      if (InterlockedIncrement (&mutex->guard.started) == 0)
        {
          if (err != 0)
            {
              InterlockedDecrement (&mutex->guard.started);
              return err;
            }
        }
      else
        {
          InterlockedDecrement (&mutex->guard.started);
          while (!mutex->guard.done)
            Sleep (0);
        }
    }
  EnterCriticalSection (&mutex->lock);
  return 0;
}
