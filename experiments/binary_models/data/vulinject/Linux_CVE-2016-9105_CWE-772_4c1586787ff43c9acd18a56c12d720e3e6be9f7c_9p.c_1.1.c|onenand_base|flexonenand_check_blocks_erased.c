static int flexonenand_check_blocks_erased(struct mtd_info *mtd, int start, int end)
{
	struct onenand_chip *this = mtd->priv;
	int i, ret;
	int block;
	struct mtd_oob_ops ops = {
		.mode = MTD_OPS_PLACE_OOB,
		.ooboffs = 0,
		.ooblen	= mtd->oobsize,
		.datbuf	= NULL,
		.oobbuf	= this->oob_buf,
	};
	loff_t addr;
	printk(KERN_DEBUG "Check blocks from %d to %d\n", start, end);
	for (block = start; block <= end; block++) {
		if (onenand_block_isbad_nolock(mtd, addr, 0))
			continue;
		ret = onenand_read_oob_nolock(mtd, addr, &ops);
		if (ret)
			return ret;
		for (i = 0; i < mtd->oobsize; i++)
			if (this->oob_buf[i] != 0xff)
				break;
		if (i != mtd->oobsize) {
			printk(KERN_WARNING "%s: Block %d not erased.\n",
				__func__, block);
			return 1;
		}
	}
	return 0;
}
