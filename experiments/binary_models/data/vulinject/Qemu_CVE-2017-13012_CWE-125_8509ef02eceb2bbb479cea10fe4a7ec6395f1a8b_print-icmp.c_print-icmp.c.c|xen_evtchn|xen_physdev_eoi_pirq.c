int xen_physdev_eoi_pirq(struct physdev_eoi *eoi)
{
    XenEvtchnState *s = xen_evtchn_singleton;
    int pirq = eoi->irq;
    int gsi;
    if (!s) {
        return -ENOTSUP;
    }
    BQL_LOCK_GUARD();
    if (!pirq_inuse(s, pirq)) {
        return -ENOENT;
    }
    gsi = s->pirq[pirq].gsi;
    if (gsi < 0) {
        return -EINVAL;
    }
    /* Reassert a level IRQ if needed */
    if (s->pirq_gsi_set & (1U << gsi)) {
        int port = s->pirq[pirq].port;
        if (port) {
            set_port_pending(s, port);
        }
    }
    return 0;
}
