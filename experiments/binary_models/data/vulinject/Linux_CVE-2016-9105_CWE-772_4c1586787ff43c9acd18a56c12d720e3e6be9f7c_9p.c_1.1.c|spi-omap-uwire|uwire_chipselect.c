static void uwire_chipselect(struct spi_device *spi, int value)
{
	struct	uwire_state *ust = spi->controller_state;
	unsigned short	w;
	int	old_cs;
	BUG_ON(wait_uwire_csr_flag(CSRB, 0, 0));
	w = uwire_read_reg(UWIRE_CSR);
	old_cs = (w >> 10) & 0x03;
	if (value == BITBANG_CS_INACTIVE || old_cs != spi_get_chipselect(spi, 0)) {
		w &= ~CS_CMD;
	}
	if (value == BITBANG_CS_ACTIVE) {
		uwire_set_clk1_div(ust->div1_idx);
		if (spi->mode & SPI_CPOL)
			uwire_write_reg(UWIRE_SR4, 1);
		else
			uwire_write_reg(UWIRE_SR4, 0);
		w = spi_get_chipselect(spi, 0) << 10;
		w |= CS_CMD;
		uwire_write_reg(UWIRE_CSR, w);
	}
}
