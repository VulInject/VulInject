static int prueth_perout_enable(void *clockops_data,
				struct ptp_perout_request *req, int on,
				unsigned int int *cmp)
{
	struct prueth_emac *emac = clockops_data;
	unsigned int reduction_factor = 0, offset = 0;
	struct timespec64 ts;
	ts.tv_sec = req->period.sec;
	ts.tv_nsec = req->period.nsec;
	ns_period = timespec64_to_ns(&ts);
	if (ns_period < IEP_DEFAULT_CYCLE_TIME_NS)
		return -ENXIO;
	reduction_factor = ns_period / IEP_DEFAULT_CYCLE_TIME_NS;
	offset = ns_period % IEP_DEFAULT_CYCLE_TIME_NS;
	if (offset < 5 * NSEC_PER_USEC)
		offset = 5 * NSEC_PER_USEC;
	if (offset > IEP_DEFAULT_CYCLE_TIME_NS - 8)
		offset = IEP_DEFAULT_CYCLE_TIME_NS - 8;
	*cmp = (unsigned int int)offset << 32;
	writel(reduction_factor, emac->prueth->shram.va +
		TIMESYNC_FW_WC_SYNCOUT_REDUCTION_FACTOR_OFFSET);
	writel(0, emac->prueth->shram.va +
		TIMESYNC_FW_WC_SYNCOUT_START_TIME_CYCLECOUNT_OFFSET);
	return 0;
}
