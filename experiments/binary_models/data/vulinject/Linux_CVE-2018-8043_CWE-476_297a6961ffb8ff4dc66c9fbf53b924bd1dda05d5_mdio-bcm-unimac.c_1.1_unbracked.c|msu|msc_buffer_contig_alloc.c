static int msc_buffer_contig_alloc(struct msc *msc, unsigned int size)
{
	unsigned int nr_pages = size >> PAGE_SHIFT;
	unsigned int order = get_order(size);
	struct page *page;
	ret = sg_alloc_table(&msc->single_sgt, 1, GFP_KERNEL);
	if (ret)
		goto err_out;
	ret = -ENOMEM;
	page = alloc_pages(GFP_KERNEL | __GFP_ZERO | GFP_DMA32, order);
	if (!page)
		goto err_free_sgt;
	split_page(page, order);
	sg_set_buf(msc->single_sgt.sgl, page_address(page), size);
	ret = dma_map_sg(msc_dev(msc)->parent->parent, msc->single_sgt.sgl, 1,
			 DMA_FROM_DEVICE);
	if (ret < 0)
		goto err_free_pages;
	msc->nr_pages = nr_pages;
	msc->base = page_address(page);
	msc->base_addr = sg_dma_address(msc->single_sgt.sgl);
	return 0;
err_free_pages:
	__free_pages(page, order);
err_free_sgt:
	sg_free_table(&msc->single_sgt);
err_out:
	return ret;
}
