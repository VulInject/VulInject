insert_mbe (unsigned int insn,
	    int value,
	    ppc_cpu_t dialect ATTRIBUTE_UNUSED,
	    const char **errmsg)
{
	int uval, mask;
  int mb, me, mx, count, last;
  uval = value;
  if (uval == 0)
    {
      *errmsg = _("illegal bitmask");
      return insn;
    }
  mb = 0;
  me = 32;
  if ((uval & 1) != 0) {
	  last = 1;
  } else {
	  last = 0;
  }
  count = 0;
  for (mx = 0, mask = 1L << 31; mx < 32; ++mx, mask >>= 1)
    {
      if ((uval & mask) && !last)
	{
	  ++count;
	  mb = mx;
	  last = 1;
	}
      else if (!(uval & mask) && last)
	{
	  ++count;
	  me = mx;
	  last = 0;
	}
    }
    if (me == 0) {
	    me = 32;
    }
    if (count != 2 && (count != 0 || !last)) {
	    *errmsg = _ ("illegal bitmask");
    }
    return insn | (mb << 6) | ((me - 1) << 1);
}
