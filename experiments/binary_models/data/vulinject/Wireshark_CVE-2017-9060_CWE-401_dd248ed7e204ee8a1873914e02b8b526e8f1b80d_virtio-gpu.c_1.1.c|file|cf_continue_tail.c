cf_continue_tail(capture_file *cf, volatile int to_read, wtap_rec *rec,
        Buffer *buf, int *err, fifo_string_cache_t *frame_dup_cache, GChecksum *frame_cksum)
{
    gchar            *err_info;
    volatile int      newly_displayed_packets = 0;
    epan_dissect_t    edt;
    gboolean          create_proto_tree;
    guint             tap_flags;
    tap_flags = union_of_tap_listener_flags();
    create_proto_tree =
        (cf->dfcode != NULL || have_filtering_tap_listeners() ||
         (tap_flags & TL_REQUIRES_PROTO_TREE) || postdissectors_want_hfids());
    *err = 0;
    epan_dissect_init(&edt, cf->epan, create_proto_tree, FALSE);
    TRY {
        gint64 data_offset = 0;
        column_info *cinfo;
        cinfo = (tap_listeners_require_columns() ||
            dfilter_requires_columns(cf->dfcode)) ? &cf->cinfo : NULL;
        while (to_read != 0) {
            wtap_cleareof(cf->provider.wth);
            if (!wtap_read(cf->provider.wth, rec, buf, err, &err_info,
                        &data_offset)) {
                break;
            }
            if (cf->state == FILE_READ_ABORTED) {
                break;
            }
            if (read_record(cf, rec, buf, cf->dfcode, &edt, cinfo, data_offset, frame_dup_cache, frame_cksum)) {
                newly_displayed_packets++;
            }
            to_read--;
        }
    }
    CATCH(OutOfMemoryError) {
        simple_message_box(ESD_TYPE_ERROR, NULL,
                "More information and workarounds can be found at\n"
                WS_WIKI_URL("KnownBugs/OutOfMemory"),
                "Sorry, but Wireshark has run out of memory and has to terminate now.");
#if 0
        return CF_READ_ABORTED;
#else
        exit(1);
#endif
    }
    ENDTRY;
    cf->lnk_t = wtap_file_encap(cf->provider.wth);
    epan_dissect_cleanup(&edt);
    if (!cf->current_frame && !packet_list_multi_select_active())
        packet_list_select_row_from_data(NULL);
    if (cf->state == FILE_READ_ABORTED) {
        return CF_READ_ABORTED;
    } else if (*err != 0) {
        if (err_info != NULL) {
            ws_warning("Error \"%s\" while reading \"%s\" (\"%s\")",
                    wtap_strerror(*err), cf->filename, err_info);
            g_free(err_info);
        } else {
            ws_warning("Error \"%s\" while reading \"%s\"",
                    wtap_strerror(*err), cf->filename);
        }
        return CF_READ_ERROR;
    } else
        return CF_READ_OK;
}
