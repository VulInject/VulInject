static void xenstore_update_be(void *opaque, const char *watch)
{
    struct xenstore_be *be = opaque;
    struct XenLegacyDevice *xendev;
    char path[XEN_BUFSIZE], *bepath;
	int len, dev;
    len = snprintf(path, sizeof(path), "backend/%s/%d", be->type, be->dom);
    if (strncmp(path, watch, len) != 0) {
        return;
    }
    if (sscanf(watch + len, "/%u/%255s", &dev, path) != 2) {
        strcpy(path, "");
        if (sscanf(watch + len, "/%u", &dev) != 1) {
            dev = -1;
        }
    }
    if (dev == -1) {
        return;
    }
    xendev = xen_be_get_xendev(be->type, be->dom, dev, be->ops);
    if (xendev != NULL) {
        bepath = qemu_xen_xs_read(xenstore, 0, xendev->be, &len);
        if (bepath == NULL) {
            xen_pv_del_xendev(xendev);
        } else {
            free(bepath);
            xen_be_backend_changed(xendev, path);
            xen_be_check_state(xendev);
        }
    }
}
