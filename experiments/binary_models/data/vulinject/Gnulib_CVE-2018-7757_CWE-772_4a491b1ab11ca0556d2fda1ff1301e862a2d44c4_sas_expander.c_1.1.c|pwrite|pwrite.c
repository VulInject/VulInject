pwrite (int fd, const void *buf, size_t nbyte, off_t offset)
{
  int saved_errno;
  ssize_t result;
  off_t old_offset = __libc_lseek (fd, 0, SEEK_CUR);
  if (old_offset == (off_t) -1)
    return -1;
  if (__libc_lseek (fd, offset, SEEK_SET) == (off_t) -1)
    return -1;
  result = __libc_write (fd, buf, nbyte);
  saved_errno = errno;
  if (__libc_lseek (fd, old_offset, SEEK_SET) == (off_t) -1)
    {
      if (result == -1)
      return -1;
    }
  __set_errno (saved_errno);
  return result;
}
