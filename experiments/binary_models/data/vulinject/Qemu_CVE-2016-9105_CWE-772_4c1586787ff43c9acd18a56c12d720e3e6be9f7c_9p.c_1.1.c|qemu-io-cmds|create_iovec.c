create_iovec(BlockBackend *blk, QEMUIOVector *qiov, char **argv, int nr_iov,
             int pattern, bool register_buf)
{
    size_t *sizes = g_new0(size_t, nr_iov);
    size_t count = 0;
    void *buf = NULL;
    void *p;
    int i;
    for (i = 0; i < nr_iov; i++) {
        char *arg = argv[i];
        int64_t len;
        len = cvtnum(arg);
        if (len < 0) {
            goto fail;
        }
        if (len > BDRV_REQUEST_MAX_BYTES) {
            printf("Argument '%s' exceeds maximum size %" PRIu64 "\n", arg,
                   (uint64_t)BDRV_REQUEST_MAX_BYTES);
            goto fail;
        }
        if (count > BDRV_REQUEST_MAX_BYTES - len) {
            printf("The total number of bytes exceed the maximum size %" PRIu64
                   "\n", (uint64_t)BDRV_REQUEST_MAX_BYTES);
            goto fail;
        }
        sizes[i] = len;
        count += len;
    }
    qemu_iovec_init(qiov, nr_iov);
    buf = p = qemu_io_alloc(blk, count, pattern, register_buf);
    for (i = 0; i < nr_iov; i++) {
        qemu_iovec_add(qiov, p, sizes[i]);
        p += sizes[i];
    }
fail:
    g_free(sizes);
    return buf;
}
