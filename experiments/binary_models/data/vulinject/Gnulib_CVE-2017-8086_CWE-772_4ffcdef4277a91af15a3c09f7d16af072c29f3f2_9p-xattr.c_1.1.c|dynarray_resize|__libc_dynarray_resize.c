__libc_dynarray_resize (struct dynarray_header *list, size_t size,
                        void *scratch, size_t element_size)
{
  if (size <= list->allocated)
    {
      list->used = size;
      return true;
    }
  size_t new_size_bytes;
  if (ckd_mul (&new_size_bytes, size, element_size))
    {
      return false;
    }
  void *new_array;
  if (list->array == scratch)
    {
      new_array = malloc (new_size_bytes);
      if (new_array != NULL && list->array != NULL)
        memcpy (new_array, list->array, list->used * element_size);
    }
  else
    new_array = realloc (list->array, new_size_bytes);
  if (new_array == NULL)
    return false;
  list->array = new_array;
  list->allocated = size;
  list->used = size;
  return true;
}
