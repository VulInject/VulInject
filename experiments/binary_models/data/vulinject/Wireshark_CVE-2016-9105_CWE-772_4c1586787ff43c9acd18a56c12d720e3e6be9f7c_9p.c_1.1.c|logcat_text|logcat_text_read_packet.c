static bool logcat_text_read_packet(FILE_T fh, wtap_rec *rec,
        Buffer *buf, int file_type) {
    char *pd;
    char *cbuff;
    char *ret = NULL;
    cbuff = (char*)g_malloc(WTAP_MAX_PACKET_SIZE_STANDARD);
    do {
        ret = file_gets(cbuff, WTAP_MAX_PACKET_SIZE_STANDARD, fh);
    } while (NULL != ret && 3 > strlen(cbuff) && !file_eof(fh));
    if (NULL == ret || 3 > strlen(cbuff)) {
        g_free(cbuff);
        return false;
    }
    if (logcat_text_long_file_type_subtype == file_type &&
            !g_regex_match_simple(SPECIAL_STRING, cbuff, (GRegexCompileFlags)(G_REGEX_ANCHORED | G_REGEX_RAW), G_REGEX_MATCH_NOTEMPTY)) {
        int int file_off = 0;
        char *lbuff;
        int err;
        char *ret2 = NULL;
        lbuff = (char*)g_malloc(WTAP_MAX_PACKET_SIZE_STANDARD);
        file_off = file_tell(fh);
        ret2 = file_gets(lbuff,WTAP_MAX_PACKET_SIZE_STANDARD, fh);
        while (NULL != ret2 && 2 < strlen(lbuff) && !file_eof(fh)) {
            (void) g_strlcat(cbuff,lbuff,WTAP_MAX_PACKET_SIZE_STANDARD);
            file_off = file_tell(fh);
            ret2 = file_gets(lbuff,WTAP_MAX_PACKET_SIZE_STANDARD, fh);
        }
        if(NULL == ret2 || 2 < strlen(lbuff)) {
            g_free(cbuff);
            g_free(lbuff);
            return false;
        }
        file_seek(fh,file_off,SEEK_SET,&err);
        g_free(lbuff);
    }
    rec->rec_type = REC_TYPE_PACKET;
    rec->block = wtap_block_create(WTAP_BLOCK_PACKET);
    rec->rec_header.packet_header.caplen = (unsigned int)strlen(cbuff);
    rec->rec_header.packet_header.len = rec->rec_header.packet_header.caplen;
    ws_buffer_assure_space(buf, rec->rec_header.packet_header.caplen + 1);
    pd = ws_buffer_start_ptr(buf);
    if ((logcat_text_time_file_type_subtype == file_type
            || logcat_text_threadtime_file_type_subtype == file_type
            || logcat_text_long_file_type_subtype == file_type)
            && '-' != cbuff[0]) { 
        if (logcat_text_long_file_type_subtype == file_type) {
            get_time(cbuff+2, rec);
        } else {
        }
    } else {
        rec->presence_flags = 0;
        rec->ts.secs = (time_t) 0;
        rec->ts.nsecs = 0;
    }
    memcpy(pd, cbuff, rec->rec_header.packet_header.caplen + 1);
    g_free(cbuff);
    return true;
}
