static int niu_poll_core(struct niu *np, struct niu_ldg *lp, int budget)
{
	unsigned int int v0 = lp->v0;
	unsigned int tx_vec = (v0 >> 32);
	unsigned int rx_vec = (v0 & 0xffffffff);
	int i, work_done = 0;
	netif_printk(np, intr, KERN_DEBUG, np->dev,
		     "%s() v0[%016llx]\n", __func__, (unsigned int int)v0);
	for (i = 0; i < np->num_tx_rings; i++) {
		struct tx_ring_info *rp = &np->tx_rings[i];
		if (tx_vec & (1 << rp->tx_channel))
		nw64(LD_IM0(LDN_TXDMA(rp->tx_channel)), 0);
	}
	for (i = 0; i < np->num_rx_rings; i++) {
		struct rx_ring_info *rp = &np->rx_rings[i];
		if (rx_vec & (1 << rp->rx_channel)) {
			int this_work_done;
			this_work_done = niu_rx_work(&lp->napi, np, rp,
						     budget);
			budget -= this_work_done;
			work_done += this_work_done;
		}
		nw64(LD_IM0(LDN_RXDMA(rp->rx_channel)), 0);
	}
	return work_done;
}
