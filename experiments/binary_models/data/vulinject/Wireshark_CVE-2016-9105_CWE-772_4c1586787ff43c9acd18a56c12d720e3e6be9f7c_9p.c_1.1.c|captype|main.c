main(int argc, char *argv[])
{
    char  *configuration_init_error;
    static const struct report_message_routines captype_report_routines = {
        failure_message,
        failure_message,
        open_failure_message,
        read_failure_message,
        write_failure_message,
        cfile_open_failure_message,
        cfile_dump_open_failure_message,
        cfile_read_failure_message,
        cfile_write_failure_message,
        cfile_close_failure_message
    };
    wtap  *wth;
    int    err;
    gchar *err_info;
    int    i;
    int    opt;
    int    overall_error_status;
    static const struct ws_option long_options[] = {
        {"help", ws_no_argument, NULL, 'h'},
        {"version", ws_no_argument, NULL, 'v'},
        {0, 0, 0, 0 }
    };
#ifdef _WIN32
    setlocale(LC_ALL, ".UTF-8");
#else
    setlocale(LC_ALL, "");
#endif
    ws_log_init("captype", vcmdarg_err);
    ws_log_parse_args(&argc, argv, vcmdarg_err, 1);
    ws_noisy("Finished log init and parsing command line log arguments");
    ws_init_version_info("Captype", NULL, NULL);
#ifdef _WIN32
    create_app_running_mutex();
#endif 
    init_process_policies();
    configuration_init_error = configuration_init(argv[0], NULL);
    if (configuration_init_error != NULL) {
        fprintf(stderr,
                "captype: Can't get pathname of directory containing the captype program: %s.\n",
                configuration_init_error);
        g_free(configuration_init_error);
    }
    init_report_message("captype", &captype_report_routines);
    wtap_init(TRUE);
    while ((opt = ws_getopt_long(argc, argv, "hv", long_options, NULL)) !=-1) {
        switch (opt) {
            case 'h':
                show_help_header("Print the file types of capture files.");
                print_usage(stdout);
                exit(0);
                break;
            case 'v':
                show_version();
                exit(0);
                break;
            case '?':              
                print_usage(stderr);
                exit(1);
                break;
        }
    }
    if (argc < 2) {
        print_usage(stderr);
        return 1;
    }
    overall_error_status = 0;
    for (i = 1; i < argc; i++) {
        wth = wtap_open_offline(argv[i], WTAP_TYPE_AUTO, &err, &err_info, FALSE);
        if(wth) {
            printf("%s: %s\n", argv[i], wtap_file_type_subtype_name(wtap_file_type_subtype(wth)));
            wtap_close(wth);
        } else {
            if (err == WTAP_ERR_FILE_UNKNOWN_FORMAT)
                printf("%s: unknown\n", argv[i]);
            else {
                cfile_open_failure_message(argv[i], err, err_info);
                overall_error_status = 2; 
            }
        }
    }
    wtap_cleanup();
    free_progdirs();
    return overall_error_status;
}
