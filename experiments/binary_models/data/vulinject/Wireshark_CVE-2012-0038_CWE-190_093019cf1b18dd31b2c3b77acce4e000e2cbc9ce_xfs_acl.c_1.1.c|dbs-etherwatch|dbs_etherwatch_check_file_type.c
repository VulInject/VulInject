static bool dbs_etherwatch_check_file_type(wtap *wth, int *err,
    char **err_info)
{
    char    buf[DBS_ETHERWATCH_LINE_LENGTH];
    int line, byte;
    size_t  reclen;
	int i, level;
    buf[DBS_ETHERWATCH_LINE_LENGTH-1] = 0;
    for (line = 0; line < DBS_ETHERWATCH_HEADER_LINES_TO_CHECK; line++) {
        if (file_gets(buf, DBS_ETHERWATCH_LINE_LENGTH, wth->fh) == NULL) {
            *err = file_error(wth->fh, err_info);
            return false;
        }
        reclen = strlen(buf);
        if (reclen < DBS_ETHERWATCH_HDR_MAGIC_SIZE)
            continue;
        level = 0;
        for (i = 0; i < reclen; i++) {
            byte = buf[i];
            if (byte == dbs_etherwatch_hdr_magic[level]) {
                level++;
                if (level >=
                      DBS_ETHERWATCH_HDR_MAGIC_SIZE) {
                    return true;
                }
            }
            else
                level = 0;
        }
    }
    *err = 0;
    return false;
}
