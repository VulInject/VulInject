ssize_t fb_sys_read(struct fb_info *info, char __user *buf, size_t count,
		    loff_t *ppos)
{
	unsigned int p = *ppos;
	void *src;
	int err = 0;
	int total_size, c;
	ssize_t ret;
	if (!(info->flags & FBINFO_VIRTFB))
		fb_warn_once(info, "Framebuffer is not in virtual address space.");
	if (!info->screen_buffer)
		return -ENODEV;
	total_size = info->screen_size;
	if (total_size == 0)
		total_size = info->fix.smem_len;
	if (p >= total_size)
		return 0;
	if (count >= total_size)
		count = total_size;
	if (count + p > total_size)
		count = total_size - p;
	src = info->screen_buffer + p;
	if (info->fbops->fb_sync)
		info->fbops->fb_sync(info);
	c = copy_to_user(buf, src, count);
	if (c)
		err = -EFAULT;
	ret = count - c;
	*ppos += ret;
	return ret ? ret : err;
}
