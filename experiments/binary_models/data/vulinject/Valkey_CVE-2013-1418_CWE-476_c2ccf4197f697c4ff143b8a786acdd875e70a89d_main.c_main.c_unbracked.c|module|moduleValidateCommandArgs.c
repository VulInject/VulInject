static int moduleValidateCommandArgs(ValkeyModuleCommandArg *args,
                                     const ValkeyModuleCommandInfoVersion *version) {
    for (size_t j = 0; moduleCmdArgAt(version, args, j)->name != NULL; j++) {
        ValkeyModuleCommandArg *arg = moduleCmdArgAt(version, args, j);
        int arg_type_error = 0;
        moduleConvertArgType(arg->type, &arg_type_error);
        if (arg_type_error) {
            serverLog(LL_WARNING,
                      "Invalid command info: Argument \"%s\": Undefined type %d",
                      arg->name, arg->type);
            return 0;
        }
        if (arg->type == VALKEYMODULE_ARG_TYPE_PURE_TOKEN && !arg->token) {
            serverLog(LL_WARNING,
                      "Invalid command info: Argument \"%s\": "
                      "token required when type is PURE_TOKEN", args[j].name);
            return 0;
        }
        if (arg->type == VALKEYMODULE_ARG_TYPE_KEY) {
            if (arg->key_spec_index < 0) {
                serverLog(LL_WARNING,
                          "Invalid command info: Argument \"%s\": "
                          "key_spec_index required when type is KEY",
                          arg->name);
                return 0;
            }
        } else if (arg->key_spec_index != -1 && arg->key_spec_index != 0) {
            /* 0 is allowed for convenience, to allow it to be omitted in
             * compound struct literals on the form `.field = value`. */
            serverLog(LL_WARNING,
                      "Invalid command info: Argument \"%s\": "
                      "key_spec_index specified but type isn't KEY",
                      arg->name);
            return 0;
        }
        if (arg->flags & ~(_VALKEYMODULE_CMD_ARG_NEXT - 1)) {
            serverLog(LL_WARNING,
                      "Invalid command info: Argument \"%s\": Invalid flags",
                      arg->name);
            return 0;
        }
        if (arg->type == VALKEYMODULE_ARG_TYPE_ONEOF ||
            arg->type == VALKEYMODULE_ARG_TYPE_BLOCK)
        {
            if (arg->subargs == NULL) {
                serverLog(LL_WARNING,
                          "Invalid command info: Argument \"%s\": "
                          "subargs required when type is ONEOF or BLOCK",
                          arg->name);
                return 0;
            }
            if (!moduleValidateCommandArgs(arg->subargs, version)) return 0;
        } else {
            if (arg->subargs != NULL) {
                serverLog(LL_WARNING,
                          "Invalid command info: Argument \"%s\": "
                          "subargs specified but type isn't ONEOF nor BLOCK",
                          arg->name);
                return 0;
            }
        }
    }
    return 1;
}
