bool xen_evtchn_deliver_pirq_msi(uint64_t address, uint32_t data)
{
    XenEvtchnState *s = xen_evtchn_singleton;
    uint32_t pirq, port;
    if (!s) {
        return false;
    }
    assert(bql_locked());
    pirq = msi_pirq_target(address, data);
    if (!pirq || pirq >= s->nr_pirqs) {
        return false;
    }
    port = s->pirq[pirq].port;
    if (!valid_port(port)) {
        return false;
    }
    set_port_pending(s, port);
    return true;
}
