static int32_t normalize_index(const struct hdr_histogram* h, int32_t index)
{
    int32_t normalized_index;
    int32_t adjustment = 0;
    if (h->normalizing_index_offset == 0)
    {
        return index;
    }
    normalized_index = index - h->normalizing_index_offset;
    if (normalized_index < 0)
    {
        adjustment = h->counts_len;
    }
	if ((unsigned int)normalized_index >= h->counts_len)
    {
        adjustment = -h->counts_len;
    }
    return normalized_index + adjustment;
}
