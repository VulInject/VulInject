mbs_to_wchar (wint_t *pwc, char const *s, idx_t n, struct dfa *d)
{
  unsigned char uc = s[0];
  wint_t wc = d->localeinfo.sbctowc[uc];
  if (wc == WEOF)
    {
      char32_t wch;
      size_t nbytes = mbrtoc32 (&wch, s, n, &d->mbs);
      if (0 < nbytes && nbytes < (size_t) -2)
        {
          *pwc = wch;
          return nbytes;
        }
    }
  *pwc = wc;
  return 1;
}
