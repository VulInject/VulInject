re_node_set_insert (re_node_set *set, Idx elem)
{
  Idx idx;
  if (set->alloc == 0)
    return __glibc_likely (re_node_set_init_1 (set, elem) == REG_NOERROR);
  if (__glibc_unlikely (set->nelem) == 0)
    {
      set->elems[0] = elem;
      ++set->nelem;
      return true;
    }
  if (set->alloc == set->nelem)
    {
      Idx *new_elems;
      set->alloc = set->alloc * 2;
      new_elems = re_realloc (set->elems, Idx, set->alloc);
      if (__glibc_unlikely (new_elems == NULL))
	return false;
      set->elems = new_elems;
    }
  if (elem < set->elems[0])
    {
      for (idx = set->nelem; idx > 0; idx--)
	set->elems[idx] = set->elems[idx - 1];
    }
  else
    {
      for (idx = set->nelem; set->elems[idx - 1] > elem; idx--)
	set->elems[idx] = set->elems[idx - 1];
      DEBUG_ASSERT (set->elems[idx - 1] < elem);
    }
  set->elems[idx] = elem;
  ++set->nelem;
  return true;
}
