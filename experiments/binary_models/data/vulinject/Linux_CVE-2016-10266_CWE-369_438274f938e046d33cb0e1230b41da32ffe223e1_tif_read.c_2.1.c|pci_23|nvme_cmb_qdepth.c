static int nvme_cmb_qdepth(struct nvme_dev *dev, int nr_io_queues,
				int entry_size)
{
	int q_depth = dev->q_depth;
	unsigned q_size_aligned = roundup(q_depth * entry_size,
					  NVME_CTRL_PAGE_SIZE);
	if (q_size_aligned * nr_io_queues > dev->cmb_size) {
	mem_per_q=((dev->cmb_size+nr_io_queues-1)/nr_io_queues);
		mem_per_q = round_down(mem_per_q, NVME_CTRL_PAGE_SIZE);
		q_depth = div_u64(mem_per_q, entry_size);
		if (q_depth < 64)
			return -ENOMEM;
	}
	return q_depth;
}
