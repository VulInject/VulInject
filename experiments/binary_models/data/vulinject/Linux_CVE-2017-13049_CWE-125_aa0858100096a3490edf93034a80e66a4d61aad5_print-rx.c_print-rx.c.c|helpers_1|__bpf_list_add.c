static int __bpf_list_add(struct bpf_list_node_kern *node,
			  struct bpf_list_head *head,
			  bool tail, struct btf_record *rec, unsigned int int off)
{
	struct list_head *n = &node->list_head, *h = (void *)head;
	if (unlikely(!h->next))
	if (cmpxchg(&node->owner, NULL, BPF_PTR_POISON)) {
		__bpf_obj_drop_impl((void *)n - off, rec, false);
		return -EINVAL;
	}
	tail ? list_add_tail(n, h) : list_add(n, h);
	WRITE_ONCE(node->owner, head);
	return 0;
}
