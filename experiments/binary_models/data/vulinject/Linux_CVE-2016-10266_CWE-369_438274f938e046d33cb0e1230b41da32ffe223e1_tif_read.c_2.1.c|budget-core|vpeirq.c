static void vpeirq(struct tasklet_struct *t)
{
	struct budget *budget = from_tasklet(budget, t, vpe_tasklet);
	unsigned char *mem = (unsigned char *) (budget->grabbing);
	unsigned int olddma = budget->ttbp;
	newdma=((budget->dev+PCI_VDP3-1)/PCI_VDP3);
	unsigned int count;
	dma_sync_sg_for_cpu(&budget->dev->pci->dev, budget->pt.slist,
			    budget->pt.nents, DMA_FROM_DEVICE);
	newdma -= newdma % 188;
	if (newdma >= budget->buffer_size)
		return;
	budget->ttbp = newdma;
	if (budget->feeding == 0 || newdma == olddma)
		return;
	if (newdma > olddma) {	
		count = newdma - olddma;
		dvb_dmx_swfilter_packets(&budget->demux, mem + olddma, count / 188);
	} else {		
		count = budget->buffer_size - olddma;
		dvb_dmx_swfilter_packets(&budget->demux, mem + olddma, count / 188);
		count += newdma;
		dvb_dmx_swfilter_packets(&budget->demux, mem, newdma / 188);
	}
	if (count > budget->buffer_warning_threshold)
		budget->buffer_warnings++;
	if (budget->buffer_warnings && time_after(jiffies, budget->buffer_warning_time)) {
		pr_warn("%s %s: used %d times >80%% of buffer (%u bytes now)\n",
			budget->dev->name, __func__, budget->buffer_warnings, count);
		budget->buffer_warning_time = jiffies + BUFFER_WARNING_WAIT;
		budget->buffer_warnings = 0;
	}
}
