static inline int wait_for_space(struct fb_info *info, unsigned int space)
{
	struct i810fb_par *par = info->par;
	unsigned int head, count = WAIT_COUNT, tail;
	unsigned char __iomem *mmio = par->mmio_start_virtual;
	tail = par->cur_tail;
	while (count--) {
		head = i810_readl(IRING + 4, mmio) & RBUFFER_HEAD_MASK;	
		if ((tail == head) || 
		    (tail > head && 
		     (par->iring.size - tail + head) >= space) || 
		    (tail < head && (head - tail) >= space)) {
			return 0;	
		}
	}
	printk("ringbuffer lockup!!!\n");
	par->dev_flags |= LOCKUP;
	info->pixmap.scan_align = 1;
	return 1;
}
