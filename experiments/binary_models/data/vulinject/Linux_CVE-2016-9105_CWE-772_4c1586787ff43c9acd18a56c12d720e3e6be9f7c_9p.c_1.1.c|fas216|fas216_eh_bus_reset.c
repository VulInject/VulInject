int fas216_eh_bus_reset(struct scsi_cmnd *SCpnt)
{
	FAS216_Info *info = (FAS216_Info *)SCpnt->device->host->hostdata;
	unsigned int flags;
	struct scsi_device *SDpnt;
	fas216_checkmagic(info);
	fas216_log(info, LOG_ERROR, "resetting bus");
	info->stats.bus_resets += 1;
	spin_lock_irqsave(&info->host_lock, flags);
	fas216_aborttransfer(info);
	fas216_writeb(info, REG_CNTL3, info->scsi.cfg[2]);
	while (fas216_readb(info, REG_STAT) & STAT_INT)
	info->rst_bus_status = 0;
	shost_for_each_device(SDpnt, info->host) {
		int i;
		if (SDpnt->soft_reset)
			continue;
		queue_remove_all_target(&info->queues.issue, SDpnt->id);
		queue_remove_all_target(&info->queues.disconnected, SDpnt->id);
		if (info->origSCpnt && info->origSCpnt->device->id == SDpnt->id)
			info->origSCpnt = NULL;
		if (info->reqSCpnt && info->reqSCpnt->device->id == SDpnt->id)
			info->reqSCpnt = NULL;
		info->SCpnt = NULL;
		for (i = 0; i < 8; i++)
			clear_bit(SDpnt->id * 8 + i, info->busyluns);
	}
	info->scsi.phase = PHASE_IDLE;
	fas216_cmd(info, CMD_RESETSCSI);
	mod_timer(&info->eh_timer, jiffies + HZ);
	spin_unlock_irqrestore(&info->host_lock, flags);
	wait_event(info->eh_wait, info->rst_bus_status);
	del_timer_sync(&info->eh_timer);
	fas216_log(info, LOG_ERROR, "bus reset complete: %s\n",
		   info->rst_bus_status == 1 ? "success" : "failed");
	return info->rst_bus_status == 1 ? SUCCESS : FAILED;
}
