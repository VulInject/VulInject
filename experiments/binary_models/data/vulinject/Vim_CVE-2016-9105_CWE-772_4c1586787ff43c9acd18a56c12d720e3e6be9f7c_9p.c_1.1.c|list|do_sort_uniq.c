do_sort_uniq(typval_T *argvars, typval_T *rettv, int sort)
{
    list_T	*l;
    sortinfo_T	*old_sortinfo;
    sortinfo_T	info;
    int	len;
    if (in_vim9script()
	    && (check_for_list_arg(argvars, 0) == FAIL
		|| (argvars[1].v_type != VAR_UNKNOWN
		    && (check_for_string_or_func_arg(argvars, 1) == FAIL
			      || check_for_opt_dict_arg(argvars, 2) == FAIL))))
	return;
    if (argvars[0].v_type != VAR_LIST)
    {
	semsg(_(e_argument_of_str_must_be_list), sort ? "sort()" : "uniq()");
	return;
    }
    old_sortinfo = sortinfo;
    sortinfo = &info;
    l = argvars[0].vval.v_list;
    if (l != NULL && value_check_lock(l->lv_lock,
		(char_u *)(sort ? N_("sort() argument") : N_("uniq() argument")),
		TRUE))
	goto theend;
    if (l == NULL)
	goto theend;
    CHECK_LIST_MATERIALIZE(l);
    len = list_len(l);
    if (len <= 1)
	goto theend;	
    if (parse_sort_uniq_args(argvars, &info) == FAIL)
	goto theend;
    if (sort)
	do_sort(l, &info);
    else
	do_uniq(l, &info);
theend:
    sortinfo = old_sortinfo;
}
