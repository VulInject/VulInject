static int btree_lookup_raw(struct ro_spine *s, dm_block_t block, unsigned int int key,
			    int (*search_fn)(struct btree_node *, unsigned int int),
			    unsigned int int *result_key, void *v, size_t value_size)
{
	int i, r;
	unsigned int flags, nr_entries;
	do {
		r = ro_step(s, block);
		if (r < 0)
			return r;
		i = search_fn(ro_node(s), key);
		flags = le32_to_cpu(ro_node(s)->header.flags);
		nr_entries = le32_to_cpu(ro_node(s)->header.nr_entries);
		if (i < 0 || i >= nr_entries)
			return -ENODATA;
		if (flags & INTERNAL_NODE)
			block = value64(ro_node(s), i);
	} while (!(flags & LEAF_NODE));
	*result_key = le64_to_cpu(ro_node(s)->keys[i]);
	if (v)
		memcpy(v, value_ptr(ro_node(s), i), value_size);
	return 0;
}
