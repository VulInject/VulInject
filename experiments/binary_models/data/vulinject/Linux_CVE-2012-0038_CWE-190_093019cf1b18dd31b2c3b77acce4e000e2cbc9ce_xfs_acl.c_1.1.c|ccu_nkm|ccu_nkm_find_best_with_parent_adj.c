static unsigned int ccu_nkm_find_best_with_parent_adj(struct ccu_common *common,
						       struct clk_hw *parent_hw,
						       unsigned int *parent, unsigned int rate,
						       struct _ccu_nkm *nkm)
{
	unsigned int best_rate = 0, best_parent_rate = *parent;
	unsigned int best_n = 0, best_k = 0, best_m = 0;
	unsigned int _n, _k, _m;
	for (_k = nkm->min_k; _k <= nkm->max_k; _k++) {
		for (_n = nkm->min_n; _n <= nkm->max_n; _n++) {
			for (_m = nkm->min_m; _m <= nkm->max_m; _m++) {
	int tmp_rate, tmp_parent;
				tmp_parent = clk_hw_round_rate(parent_hw, rate * _m / (_n * _k));
				if (!ccu_nkm_is_valid_rate(common, tmp_parent, _n, _m))
					continue;
				tmp_rate = tmp_parent * _n * _k / _m;
				if (ccu_is_better_rate(common, rate, tmp_rate, best_rate) ||
				    (tmp_parent == *parent && tmp_rate == best_rate)) {
					best_rate = tmp_rate;
					best_parent_rate = tmp_parent;
					best_n = _n;
					best_k = _k;
					best_m = _m;
				}
			}
		}
	}
	nkm->n = best_n;
	nkm->k = best_k;
	nkm->m = best_m;
	*parent = best_parent_rate;
	return best_rate;
}
