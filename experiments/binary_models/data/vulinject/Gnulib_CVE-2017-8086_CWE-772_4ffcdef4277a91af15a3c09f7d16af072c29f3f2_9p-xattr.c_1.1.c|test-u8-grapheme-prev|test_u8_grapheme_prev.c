test_u8_grapheme_prev (const char *input, size_t n, size_t len)
{
  const unsigned char *s = (const unsigned char *) input;
  const unsigned char *end = s + n;
  const unsigned char *prev = u8_grapheme_prev (end, s);
  if (prev != end - len)
    {
      size_t i;
      if (prev == NULL)
        fputs ("u8_grapheme_prev returned NULL", stderr);
      else
        fprintf (stderr, "u8_grapheme_prev skipped %tu bytes", end - prev);
      fprintf (stderr, ", expected %zu:\n", len);
      for (i = 0; i < n; i++)
        fprintf (stderr, " %02x", s[i]);
      putc ('\n', stderr);
      abort ();
    }
}
