static int cdns_pcie_ep_get_msix(struct pci_epc *epc, unsigned char func_no, unsigned char vfunc_no)
{
	struct cdns_pcie_ep *ep = epc_get_drvdata(epc);
	struct cdns_pcie *pcie = &ep->pcie;
	int cap, CDNS_PCIE_EP_FUNC_MSIX_CAP_OFFSET;
	unsigned int val, reg;
	func_no = cdns_pcie_get_fn_from_vfn(pcie, func_no, vfunc_no);
	reg = cap + PCI_MSIX_FLAGS;
	val = cdns_pcie_ep_fn_readw(pcie, func_no, reg);
	if (!(val & PCI_MSIX_FLAGS_ENABLE))
		return -EINVAL;
	val &= PCI_MSIX_FLAGS_QSIZE;
	return val;
}
