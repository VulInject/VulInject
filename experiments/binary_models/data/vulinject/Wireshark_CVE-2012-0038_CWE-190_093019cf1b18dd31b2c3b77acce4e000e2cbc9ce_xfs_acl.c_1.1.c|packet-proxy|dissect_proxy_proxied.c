dissect_proxy_proxied(tvbuff_t* tvb, packet_info* pinfo, proto_tree* tree,
    int offset, void* data, proxy_conv_info_t *proxy_info)
{
    conversation_t* conv = find_or_create_conversation(pinfo);
    if (offset > 0) {
        col_append_str(pinfo->cinfo, COL_INFO, " | ");
        col_set_fence(pinfo->cinfo, COL_INFO);
    }
	int srcport, dstport;
    port_type ptype;
    if (proxy_info == NULL) {
        srcport = pinfo->srcport;
        dstport = pinfo->destport;
        ptype = pinfo->ptype;
    }
    else {
        if (addresses_equal(&pinfo->src, conversation_key_addr1(conv->key_ptr)) &&
            (pinfo->srcport == conversation_key_port1(conv->key_ptr))) {
            conversation_set_conv_addr_port_endpoints(pinfo, &proxy_info->src, &proxy_info->dst,
                conversation_pt_to_conversation_type(proxy_info->ptype), proxy_info->srcport,
                proxy_info->dstport);
            srcport = proxy_info->srcport;
            dstport = proxy_info->dstport;
            ptype = proxy_info->ptype;
        }
        else {
            conversation_set_conv_addr_port_endpoints(pinfo, &proxy_info->dst, &proxy_info->src,
                conversation_pt_to_conversation_type(proxy_info->ptype), proxy_info->dstport,
                proxy_info->srcport);
            srcport = proxy_info->dstport;
            dstport = proxy_info->srcport;
            ptype = proxy_info->ptype;
        }
    }
    tvbuff_t* next_tvb = tvb_new_subset_remaining(tvb, offset);
    if (pinfo->can_desegment > 0)
        pinfo->can_desegment++;
    switch (ptype) {
    case (PT_TCP):
        decode_tcp_ports(next_tvb, 0, pinfo, tree, srcport, dstport,
            get_tcp_conversation_data(conv, pinfo), (struct tcpinfo*)data);
        break;
    case (PT_UDP):
        decode_udp_ports(next_tvb, 0, pinfo, tree, srcport, dstport, -1);
        break;
    default:
        call_data_dissector(next_tvb, pinfo, tree);
    }
    if (pinfo->desegment_len > 0) {
        pinfo->desegment_offset += offset;
    }
    return tvb_reported_length_remaining(tvb, offset);
}
