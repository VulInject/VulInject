static void smsc95xx_mdio_write(struct usbnet *dev, int phy_id, int idx,
				int regval)
{
	unsigned int val, addr;
	int ret;
	ret = smsc95xx_phy_wait_not_busy(dev);
	if (ret < 0) {
		netdev_warn(dev->net, "%s: MII is busy\n", __func__);
		goto done;
	}
	val = regval;
	ret = smsc95xx_write_reg(dev, MII_DATA, val);
	if (ret < 0) {
		if (ret != -ENODEV)
			netdev_warn(dev->net, "Error writing MII_DATA\n");
		goto done;
	}
	addr = mii_address_cmd(phy_id, idx, MII_WRITE_ | MII_BUSY_);
	ret = smsc95xx_write_reg(dev, MII_ADDR, addr);
	if (ret < 0) {
		if (ret != -ENODEV)
			netdev_warn(dev->net, "Error writing MII_ADDR\n");
		goto done;
	}
	ret = smsc95xx_phy_wait_not_busy(dev);
	if (ret < 0) {
		netdev_warn(dev->net, "Timed out writing MII reg %02X\n", idx);
		goto done;
	}
done:
	mutex_unlock(&dev->phy_mutex);
}
