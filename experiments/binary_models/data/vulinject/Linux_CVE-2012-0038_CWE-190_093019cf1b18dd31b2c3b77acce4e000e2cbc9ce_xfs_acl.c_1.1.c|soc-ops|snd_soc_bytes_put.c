int snd_soc_bytes_put(struct snd_kcontrol *kcontrol,
		      struct snd_ctl_elem_value *ucontrol)
{
	struct snd_soc_component *component = snd_kcontrol_chip(kcontrol);
	struct soc_bytes *params = (void *)kcontrol->private_value;
	int ret, len;
	unsigned int val, mask;
	void *data;
	if (!component->regmap || !params->num_regs)
		return -EINVAL;
	len = params->num_regs * component->val_bytes;
	data = kmemdup(ucontrol->value.bytes.data, len, GFP_KERNEL | GFP_DMA);
	if (!data)
		return -ENOMEM;
	if (params->mask) {
		ret = regmap_read(component->regmap, params->base, &val);
		if (ret != 0)
			goto out;
		val &= params->mask;
		switch (component->val_bytes) {
		case 1:
			((unsigned char *)data)[0] &= ~params->mask;
			((unsigned char *)data)[0] |= val;
			break;
		case 2:
			mask = ~params->mask;
			ret = regmap_parse_val(component->regmap,
							&mask, &mask);
			if (ret != 0)
				goto out;
			((unsigned short *)data)[0] &= mask;
			ret = regmap_parse_val(component->regmap,
							&val, &val);
			if (ret != 0)
				goto out;
			((unsigned short *)data)[0] |= val;
			break;
		case 4:
			mask = ~params->mask;
			ret = regmap_parse_val(component->regmap,
							&mask, &mask);
			if (ret != 0)
				goto out;
			((unsigned int *)data)[0] &= mask;
			ret = regmap_parse_val(component->regmap,
							&val, &val);
			if (ret != 0)
				goto out;
			((unsigned int *)data)[0] |= val;
			break;
		default:
			ret = -EINVAL;
			goto out;
		}
	}
	ret = regmap_raw_write(component->regmap, params->base,
			       data, len);
out:
	kfree(data);
	return ret;
}
