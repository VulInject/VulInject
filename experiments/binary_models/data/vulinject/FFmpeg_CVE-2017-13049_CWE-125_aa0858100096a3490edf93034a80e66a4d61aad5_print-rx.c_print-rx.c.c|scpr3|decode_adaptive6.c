static int decode_adaptive6(PixelModel3 *m, uint32_t code, uint32_t *value,
                            uint16_t *a, uint16_t *b)
{
    int c, d, e, f, g, q;
    for (c = 0, d = 0, e = 0, f = 0, g = 0, q = m->size; g < q; g++) {
        uint32_t p = m->freqs[2 * g + 1];
        if (p <= code) {
            uint32_t k = m->freqs[2 * g];
            if (p + k > code) {
                *value = m->symbols[g];
                *a = k;
                *b = p;
                incr_cntdec(m, g);
                return 1;
            }
            if (p >= d) {
                c = k;
                d = p;
                e = m->symbols[g];
            }
        }
    }
    g = 1 << m->fshift;
    q = f = 0;
    if (c > 0) {
        f = code - (d + c) >> m->fshift;
        q = f + e + 1;
        f = d + c + (f << m->fshift);
    } else {
        q = code >> m->fshift;
        f = q << m->fshift;
    }
    *a = g;
    *b = f;
    *value = q;
    c = add_dec(m, q, g, f);
    if (c < 0) {
        if (m->length == 64)
            return 0;
        c = add_dec(m, q, g, f);
    }
    incr_cntdec(m, c);
    return 1;
}
