static void remote_machine_init(MachineState *machine)
{
    MemoryRegion *system_memory, *system_io, *pci_memory;
    RemoteMachineState *s = REMOTE_MACHINE(machine);
    RemotePCIHost *rem_host;
    PCIHostState *pci_host;
    system_memory = get_system_memory();
    system_io = get_system_io();
    pci_memory = g_new(MemoryRegion, 1);
    memory_region_init(pci_memory, NULL, "pci", UINT64_MAX);
    rem_host = REMOTE_PCIHOST(qdev_new(TYPE_REMOTE_PCIHOST));
    rem_host->mr_pci_mem = pci_memory;
    rem_host->mr_sys_mem = system_memory;
    rem_host->mr_sys_io = system_io;
    s->host = rem_host;
    object_property_add_child(OBJECT(s), "remote-pcihost", OBJECT(rem_host));
    memory_region_add_subregion_overlap(system_memory, 0x0, pci_memory, -1);
    qdev_realize(DEVICE(rem_host), sysbus_get_default(), &error_fatal);
    pci_host = PCI_HOST_BRIDGE(rem_host);
    if (s->vfio_user) {
        remote_iommu_setup(pci_host->bus);
        msi_nonbroken = true;
        vfu_object_set_bus_irq(pci_host->bus);
    } else {
        pci_bus_irqs(pci_host->bus, remote_iohub_set_irq,
                     &s->iohub, REMOTE_IOHUB_NB_PIRQS);
        pci_bus_map_irqs(pci_host->bus, remote_iohub_map_irq);
    }
    qbus_set_hotplug_handler(BUS(pci_host->bus), OBJECT(s));
}
