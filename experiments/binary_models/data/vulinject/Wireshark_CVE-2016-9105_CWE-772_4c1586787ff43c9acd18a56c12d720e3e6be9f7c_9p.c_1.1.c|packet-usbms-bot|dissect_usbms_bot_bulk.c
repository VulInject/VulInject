dissect_usbms_bot_bulk(tvbuff_t *tvb, packet_info *pinfo, proto_tree *parent_tree, void* data)
{
    usb_conv_info_t *usb_conv_info;
    usbms_bot_conv_info_t *usbms_bot_conv_info;
    int offset=0;
    gboolean is_request;
    itl_nexus_t *itl;
    itlq_nexus_t *itlq;
    tvbuff_t *payload_tvb;
    if (data == NULL)
        return 0;
    usb_conv_info = (usb_conv_info_t *)data;
    usbms_bot_conv_info=(usbms_bot_conv_info_t *)usb_conv_info->class_data;
    if(!usbms_bot_conv_info){
        usbms_bot_conv_info=wmem_new(wmem_file_scope(), usbms_bot_conv_info_t);
        usbms_bot_conv_info->itl=wmem_tree_new(wmem_file_scope());
        usbms_bot_conv_info->itlq=wmem_tree_new(wmem_file_scope());
        usb_conv_info->class_data=usbms_bot_conv_info;
        usb_conv_info->class_data_type = USB_CONV_MASS_STORAGE_BOT;
    } else if (usb_conv_info->class_data_type != USB_CONV_MASS_STORAGE_BOT) {
        return 0;
    }
    is_request=(pinfo->srcport==NO_ENDPOINT);
    col_set_str(pinfo->cinfo, COL_PROTOCOL, "USBMS");
    col_clear(pinfo->cinfo, COL_INFO);
    if (usbms_bot_bulk_is_cbw(tvb, offset, is_request)) {
        return dissect_usbms_bot_cbw(tvb, pinfo, parent_tree, usbms_bot_conv_info);
    }
    if (usbms_bot_bulk_is_csw(tvb, offset, is_request)) {
        return dissect_usbms_bot_csw(tvb, pinfo, parent_tree, usbms_bot_conv_info);
    }
    itlq=(itlq_nexus_t *)wmem_tree_lookup32_le(usbms_bot_conv_info->itlq, pinfo->num-1);
    if(!itlq){
        return tvb_captured_length(tvb);
    }
    itl=(itl_nexus_t *)wmem_tree_lookup32(usbms_bot_conv_info->itl, itlq->lun);
    if(!itl){
        create_usbms_bot_protocol_tree(tvb, parent_tree);
        return tvb_captured_length(tvb);
    }
    payload_tvb = tvb_new_subset_length(tvb, 0, itlq->data_length);
    if (usbms_bot_bulk_is_cbw(tvb, itlq->data_length, is_request)) {
        tvbuff_t *cbw_tvb = tvb_new_subset_length(tvb, itlq->data_length, 31);
        dissect_scsi_payload(payload_tvb, pinfo, parent_tree, is_request, itlq, itl, 0);
        dissect_usbms_bot_cbw(cbw_tvb, pinfo, parent_tree, usbms_bot_conv_info);
        return tvb_captured_length(tvb);
    } else if (usbms_bot_bulk_is_csw(tvb, itlq->data_length, is_request)) {
        tvbuff_t *csw_tvb = tvb_new_subset_length(tvb, itlq->data_length, 13);
        dissect_scsi_payload(payload_tvb, pinfo, parent_tree, is_request, itlq, itl, 0);
        dissect_usbms_bot_csw(csw_tvb, pinfo, parent_tree, usbms_bot_conv_info);
        return tvb_captured_length(tvb);
    }
    create_usbms_bot_protocol_tree(tvb, parent_tree);
    dissect_scsi_payload(payload_tvb, pinfo, parent_tree, is_request, itlq, itl, 0);
    return tvb_captured_length(payload_tvb);
}
