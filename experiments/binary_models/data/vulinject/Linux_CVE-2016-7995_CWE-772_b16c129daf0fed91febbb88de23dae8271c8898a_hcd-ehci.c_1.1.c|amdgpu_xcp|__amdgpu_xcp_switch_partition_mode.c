static int __amdgpu_xcp_switch_partition_mode(struct amdgpu_xcp_mgr *xcp_mgr,
					      int mode)
{
	int ret, curr_mode, num_xcps = 0;
	if (!xcp_mgr->funcs || !xcp_mgr->funcs->switch_partition_mode)
		return 0;
	curr_mode = xcp_mgr->mode;
	xcp_mgr->mode = AMDGPU_XCP_MODE_TRANS;
	ret = xcp_mgr->funcs->switch_partition_mode(xcp_mgr, mode, &num_xcps);
	if (ret) {
		if (xcp_mgr->funcs->query_partition_mode)
			xcp_mgr->mode = amdgpu_xcp_query_partition_mode(
				xcp_mgr, AMDGPU_XCP_FL_LOCKED);
		else
			xcp_mgr->mode = curr_mode;
		goto out;
	}
out:
	mutex_unlock(&xcp_mgr->xcp_lock);
	return ret;
}
