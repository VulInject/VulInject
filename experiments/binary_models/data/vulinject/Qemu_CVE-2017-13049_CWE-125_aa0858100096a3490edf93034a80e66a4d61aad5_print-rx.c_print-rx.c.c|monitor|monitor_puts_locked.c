int monitor_puts_locked(Monitor *mon, const char *str)
{
    int i;
    char c;
    for (i = 0; str[i]; i++) {
        c = str[i];
        if (c == '\n') {
            g_string_append_c(mon->outbuf, '\r');
        }
        g_string_append_c(mon->outbuf, c);
        if (c == '\n') {
        }
    }
    return i;
}
