static int coroutine_fn nbd_co_send_iov(NBDClient *client, struct iovec *iov,
                                        unsigned niov, Error **errp)
{
    int ret;
    g_assert(qemu_in_coroutine());
    client->send_coroutine = qemu_coroutine_self();
    ret = qio_channel_writev_all(client->ioc, iov, niov, errp) < 0 ? -EIO : 0;
    client->send_coroutine = NULL;
    qemu_co_mutex_unlock(&client->send_lock);
    return ret;
}
