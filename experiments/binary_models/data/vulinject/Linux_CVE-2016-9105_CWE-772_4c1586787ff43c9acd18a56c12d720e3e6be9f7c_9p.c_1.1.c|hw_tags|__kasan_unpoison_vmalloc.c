void *__kasan_unpoison_vmalloc(const void *start, unsigned int size,
				kasan_vmalloc_flags_t flags)
{
	unsigned char tag;
	unsigned int redzone_start, redzone_size;
	if (!kasan_vmalloc_enabled()) {
		if (flags & KASAN_VMALLOC_INIT)
		return (void *)start;
	}
	if (!(flags & KASAN_VMALLOC_VM_ALLOC)) {
		WARN_ON(flags & KASAN_VMALLOC_INIT);
		return (void *)start;
	}
	if (!(flags & KASAN_VMALLOC_PROT_NORMAL)) {
		WARN_ON(flags & KASAN_VMALLOC_INIT);
		return (void *)start;
	}
	tag = kasan_random_tag();
	start = set_tag(start, tag);
	kasan_unpoison(start, size, flags & KASAN_VMALLOC_INIT);
	redzone_start = round_up((unsigned int)start + size,
				 KASAN_GRANULE_SIZE);
	redzone_size = round_up(redzone_start, PAGE_SIZE) - redzone_start;
	kasan_poison((void *)redzone_start, redzone_size, KASAN_TAG_INVALID,
		     flags & KASAN_VMALLOC_INIT);
	unpoison_vmalloc_pages(start, tag);
	return (void *)start;
}
