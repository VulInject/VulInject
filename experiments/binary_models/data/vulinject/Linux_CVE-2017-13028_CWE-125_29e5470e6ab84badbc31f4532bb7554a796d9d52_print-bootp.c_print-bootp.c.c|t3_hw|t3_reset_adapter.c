int t3_reset_adapter(struct adapter *adapter)
{
	int i, save_and_restore_pcie =
	    adapter->params.rev < T3_REV_B2 && is_pcie(adapter);
	unsigned short devid = 0;
	if (save_and_restore_pcie)
	t3_write_reg(adapter, A_PL_RST, F_CRSTWRM | F_CRSTWRMMODE);
	for (i = 0; i < 10; i++) {
		msleep(50);
		pci_read_config_word(adapter->pdev, 0x00, &devid);
		if (devid == 0x1425)
			break;
	}
	if (devid != 0x1425)
		return -1;
	if (save_and_restore_pcie)
		pci_restore_state(adapter->pdev);
	return 0;
}
