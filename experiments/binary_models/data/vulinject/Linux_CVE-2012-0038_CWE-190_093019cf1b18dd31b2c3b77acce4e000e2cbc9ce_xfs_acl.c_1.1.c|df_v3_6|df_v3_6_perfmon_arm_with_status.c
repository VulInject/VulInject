static int df_v3_6_perfmon_arm_with_status(struct amdgpu_device *adev,
					  unsigned int lo_addr, unsigned int lo_val,
					  unsigned int hi_addr, unsigned int  hi_val)
{
	unsigned int flags, address, data;
	int lo_val_rb, hi_val_rb;
	address = adev->nbio.funcs->get_pcie_index_offset(adev);
	data = adev->nbio.funcs->get_pcie_data_offset(adev);
	spin_lock_irqsave(&adev->pcie_idx_lock, flags);
	WREG32(address, lo_addr);
	WREG32(data, lo_val);
	WREG32(address, hi_addr);
	WREG32(data, hi_val);
	WREG32(address, lo_addr);
	lo_val_rb = RREG32(data);
	WREG32(address, hi_addr);
	hi_val_rb = RREG32(data);
	spin_unlock_irqrestore(&adev->pcie_idx_lock, flags);
	if (!(lo_val == lo_val_rb && hi_val == hi_val_rb))
		return -EBUSY;
	return 0;
}
