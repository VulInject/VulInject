static void check_eeprom(struct NvRamType *eeprom, unsigned int io_port)
{
	unsigned short *w_eeprom = (unsigned short *)eeprom;
	unsigned short w_addr;
	unsigned short cksum;
	unsigned int d_addr;
	unsigned int *d_eeprom;
	cksum = 0;
	for (w_addr = 0, w_eeprom = (unsigned short *)eeprom; w_addr < 64;
	     w_addr++, w_eeprom++)
		cksum += *w_eeprom;
	if (cksum != 0x1234) {
		dprintkl(KERN_WARNING,
			"EEProm checksum error: using default values and options.\n");
		eeprom->sub_vendor_id[0] = (unsigned char)PCI_VENDOR_ID_TEKRAM;
		eeprom->sub_vendor_id[1] = (unsigned char)(PCI_VENDOR_ID_TEKRAM >> 8);
		eeprom->sub_sys_id[0] = (unsigned char)PCI_DEVICE_ID_TEKRAM_TRMS1040;
		eeprom->sub_sys_id[1] =
		    (unsigned char)(PCI_DEVICE_ID_TEKRAM_TRMS1040 >> 8);
		eeprom->sub_class = 0x00;
		eeprom->vendor_id[0] = (unsigned char)PCI_VENDOR_ID_TEKRAM;
		eeprom->vendor_id[1] = (unsigned char)(PCI_VENDOR_ID_TEKRAM >> 8);
		eeprom->device_id[0] = (unsigned char)PCI_DEVICE_ID_TEKRAM_TRMS1040;
		eeprom->device_id[1] =
		    (unsigned char)(PCI_DEVICE_ID_TEKRAM_TRMS1040 >> 8);
		eeprom->reserved = 0x00;
		for (d_addr = 0, d_eeprom = (unsigned int *)eeprom->target;
		     d_addr < 16; d_addr++, d_eeprom++)
			*d_eeprom = 0x00000077;	
		*d_eeprom++ = 0x04000F07;	
		*d_eeprom++ = 0x00000015;	
		for (d_addr = 0; d_addr < 12; d_addr++, d_eeprom++)
			*d_eeprom = 0x00;
		set_safe_settings();
		fix_settings();
		eeprom_override(eeprom);
		eeprom->cksum = 0x00;
		for (w_addr = 0, cksum = 0, w_eeprom = (unsigned short *)eeprom;
		     w_addr < 63; w_addr++, w_eeprom++)
			cksum += *w_eeprom;
		*w_eeprom = 0x1234 - cksum;
		trms1040_write_all(eeprom, io_port);
		eeprom->delay_time = cfg_data[CFG_RESET_DELAY].value;
	} else {
		set_safe_settings();
		eeprom_index_to_delay(eeprom);
		eeprom_override(eeprom);
	}
}
