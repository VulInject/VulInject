is_stdin_readable(void)
{
    DWORD	    mode, eventnum;
    struct _stat    st;
    HANDLE	    hstdin = (HANDLE)_get_osfhandle(fd);
    if (GetConsoleMode(hstdin, &mode))
	return GetNumberOfConsoleInputEvents(hstdin, &eventnum);
    return _fstat(fd, &st) == 0;
}
