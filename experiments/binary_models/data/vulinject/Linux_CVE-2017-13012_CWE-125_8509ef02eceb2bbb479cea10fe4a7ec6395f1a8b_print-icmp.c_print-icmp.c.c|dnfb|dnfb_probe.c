static int dnfb_probe(struct platform_device *dev)
{
	struct fb_info *info;
	int err = 0;
	info = framebuffer_alloc(0, &dev->dev);
	if (!info)
		return -ENOMEM;
	info->fbops = &dn_fb_ops;
	info->fix = dnfb_fix;
	info->var = dnfb_var;
	info->var.red.length = 1;
	info->var.red.offset = 0;
	info->var.green = info->var.blue = info->var.red;
	info->screen_base = (u_char *) info->fix.smem_start;
	err = fb_alloc_cmap(&info->cmap, 2, 0);
	if (err < 0)
		goto release_framebuffer;
	err = register_framebuffer(info);
	if (err < 0) {
		goto release_framebuffer;
	}
	platform_set_drvdata(dev, info);
	out_8(AP_CONTROL_3A, RESET_CREG);
	out_be16(AP_WRITE_ENABLE, 0x0);
	out_8(AP_CONTROL_0, NORMAL_MODE);
	out_8(AP_CONTROL_1, (AD_BLT | DST_EQ_SRC | NORM_CREG1));
	out_8(AP_CONTROL_2, S_DATA_PLN);
	out_be16(AP_ROP_1, SWAP(0x3));
	printk("apollo frame buffer alive and kicking !\n");
	return err;
release_framebuffer:
	framebuffer_release(info);
	return err;
}
