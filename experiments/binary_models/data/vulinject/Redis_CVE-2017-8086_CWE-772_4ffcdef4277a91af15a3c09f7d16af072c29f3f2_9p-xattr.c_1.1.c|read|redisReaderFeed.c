int redisReaderFeed(redisReader *r, const char *buf, size_t len) {
    hisds newbuf;
    /* Return early when this reader is in an erroneous state. */
    if (r->err)
        return REDIS_ERR;
    /* Copy the provided buffer. */
    if (buf != NULL && len >= 1) {
        /* Destroy internal buffer when it is empty and is quite large. */
        if (r->len == 0 && r->maxbuf != 0 && hi_sdsavail(r->buf) > r->maxbuf) {
            hi_sdsfree(r->buf);
            r->buf = hi_sdsempty();
            if (r->buf == 0) goto oom;
            r->pos = 0;
        }
        newbuf = hi_sdscatlen(r->buf,buf,len);
        if (newbuf == NULL) goto oom;
        r->buf = newbuf;
        r->len = hi_sdslen(r->buf);
    }
    return REDIS_OK;
oom:
    return REDIS_ERR;
}
