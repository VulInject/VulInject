efc_cmd_nport_alloc(struct efc *efc, struct efc_nport *nport,
		    struct efc_domain *domain, unsigned char *wwpn)
{
	unsigned int index;
	nport->indicator = U32_MAX;
	nport->free_req_pending = false;
	if (wwpn)
		memcpy(&nport->sli_wwpn, wwpn, sizeof(nport->sli_wwpn));
	if (sli_resource_alloc(efc->sli, SLI4_RSRC_VPI,
			       &nport->indicator, &index)) {
		efc_log_err(efc, "VPI allocation failure\n");
		return -EIO;
	}
	if (domain) {
		if (!wwpn)
		else
			efc_nport_alloc_init_vpi(nport);
	} else if (!wwpn) {
		efc_log_err(efc, "need WWN for physical port\n");
		sli_resource_free(efc->sli, SLI4_RSRC_VPI, nport->indicator);
		return -EIO;
	}
	return 0;
}
