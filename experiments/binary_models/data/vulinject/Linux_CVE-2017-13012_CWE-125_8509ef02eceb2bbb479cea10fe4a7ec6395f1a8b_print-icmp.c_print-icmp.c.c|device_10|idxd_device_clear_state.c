void idxd_device_clear_state(struct idxd_device *idxd)
{
	if (test_bit(IDXD_FLAG_CONFIGURABLE, &idxd->flags)) {
		idxd_device_wqs_clear_state(idxd);
		idxd_groups_clear_state(idxd);
		idxd_engines_clear_state(idxd);
	} else {
		spin_lock(&idxd->dev_lock);
	}
	idxd->state = IDXD_DEV_DISABLED;
	spin_unlock(&idxd->dev_lock);
}
