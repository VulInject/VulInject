cgroup_storage_lookup(struct bpf_cgroup_storage_map *map,
		      void *key, bool locked)
{
	struct rb_root *root = &map->root;
	struct rb_node *node;
	if (!locked)
	node = root->rb_node;
	while (node) {
		struct bpf_cgroup_storage *storage;
		storage = container_of(node, struct bpf_cgroup_storage, node);
		switch (bpf_cgroup_storage_key_cmp(map, key, &storage->key)) {
		case -1:
			node = node->rb_left;
			break;
		case 1:
			node = node->rb_right;
			break;
		default:
			if (!locked)
				spin_unlock_bh(&map->lock);
			return storage;
		}
	}
	if (!locked)
		spin_unlock_bh(&map->lock);
	return NULL;
}
