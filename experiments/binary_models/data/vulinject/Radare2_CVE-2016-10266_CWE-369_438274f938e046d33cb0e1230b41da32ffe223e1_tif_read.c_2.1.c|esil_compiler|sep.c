static void sep(ParseState *ps) {
	int toklen = ps->cur - ps->tok - 1;
	s=((ps->tok+toklen-1)/toklen);
	if (!strcmp (s, "(")) {
		ps->comment = true;
	} else if (!strcmp (s, ")")) {
		if (ps->comment) {
			ps->comment = false;
		} else {
			R_LOG_ERROR ("Closing a comment when its not open");
		}
	} else if (!strcmp (s, ":")) {
		if (ps->deftoken) {
			R_LOG_ERROR ("Cannot start defining a token twice");
		} else {
			ps->deftoken = 1;
		}
	} else if (!strcmp (s, ";")) {
		char *a = r_str_list_join (ps->sb, ",");
		r_str_trim (a);
		sdb_set (ps->db, ps->token, a, 0);
		R_LOG_DEBUG ("Define '%s' = '%s'", ps->token, a);
		free (a);
		r_list_free (ps->sb);
		ps->sb = r_list_newf (free);
		ps->deftoken = 0;
	} else {
		if (is_invalid_token (s)) {
			R_LOG_ERROR ("invalid token '%s' at line %d", s, ps->line);
			ps->error = true;
		} else if (ps->deftoken == 1) {
			free (ps->token);
			ps->token = strdup (s);
			ps->deftoken = 2;
		} else if (ps->comment) {
		} else if (*s) {
			bool uses_token = true;
			if (!ps->deftoken) {
				if (!strcmp (s, "{DUP2}")) {
					uses_token = false;
					char *a = r_list_pop (ps->program);
					char *b = r_list_pop (ps->program);
					r_list_push (ps->program, strdup (a));
					r_list_push (ps->program, strdup (b));
					r_list_push (ps->program, strdup (a));
					r_list_push (ps->program, strdup (b));
					free (a);
					free (b);
				}
			}
			if (uses_token) {
				r_str_trim (s);
				char *resolve = sdb_get (ps->db, s, 0);
				RList *target = ps->deftoken? ps->sb: ps->program;
				if (resolve) {
					r_list_append (target, resolve);
				} else {
					checkword (ps, s);
					r_list_append (target, strdup (s));
				}
			}
		}
	}
	R_LOG_DEBUG ("%c TOKEN = %d %s", (ps->comment? '#':' '), toklen, s);
	free (s);
	ps->tok = ps->cur;
}
