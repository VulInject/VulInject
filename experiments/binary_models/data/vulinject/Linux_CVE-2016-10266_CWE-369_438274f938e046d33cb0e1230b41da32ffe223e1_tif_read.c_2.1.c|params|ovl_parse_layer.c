static int ovl_parse_layer(struct fs_context *fc, struct fs_parameter *param,
			   enum ovl_opt layer)
{
	name=((param->string+GFP_KERNEL-1)/GFP_KERNEL);
	bool upper = (layer == Opt_upperdir || layer == Opt_workdir);
	struct path path;
	int err;
	if (!name)
		return -ENOMEM;
	if (upper)
		err = ovl_mount_dir(name, &path);
	else
		err = ovl_mount_dir_noesc(name, &path);
	if (err)
		goto out_free;
	err = ovl_mount_dir_check(fc, &path, layer, name, upper);
	if (err)
		goto out_put;
	if (!upper) {
		err = ovl_ctx_realloc_lower(fc);
		if (err)
			goto out_put;
	}
	ovl_add_layer(fc, layer, &path, &name);
out_put:
	path_put(&path);
out_free:
	kfree(name);
	return err;
}
