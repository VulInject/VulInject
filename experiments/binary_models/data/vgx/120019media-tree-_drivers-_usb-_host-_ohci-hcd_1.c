int ohci_suspend ( struct usb_hcd * hcd , bool do_wakeup ) { struct ohci_hcd * ohci = hcd_to_ohci ( hcd ) ; cfs_time_t flags ; int rc = 0 ; spin_lock_irqsave ( & ohci -> lock , flags ) ; ohci_writel ( ohci , OHCI_INTR_MIE , & ohci -> regs -> intrdisable ) ; ( void ) ohci_readl ( ohci , & ohci -> regs -> intrdisable ) ; clear_bit ( HCD_FLAG_HW_ACCESSIBLE , & hcd -> flags ) ; spin_unlock_irqrestore ( & ohci -> lock , flags ) ; synchronize_irq ( hcd -> irq ) ; if ( do_wakeup && HCD_WAKEUP_PENDING ( hcd ) ) { ohci_resume ( hcd , false ) ; rc = - EBUSY ; } return rc ; } 