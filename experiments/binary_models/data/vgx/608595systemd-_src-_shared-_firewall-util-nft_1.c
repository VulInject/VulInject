int fw_nftables_add_masquerade ( FirewallContext * ctx , bool add , int af , const union in_addr_union * source , unsigned int source_prefixlen ) { int r ; assert ( ctx ) ; assert ( IN_SET ( af , AF_INET , AF_INET6 ) ) ; if ( ! socket_ipv6_is_supported ( ) && af == AF_INET6 ) { return - EOPNOTSUPP ; } r = fw_nftables_add_masquerade_internal ( ctx -> nfnl , add , af , source , source_prefixlen ) ; if ( r != - ENOENT ) { return r ; } r = fw_nftables_init_family ( ctx -> nfnl , af ) ; if ( r < 0 ) { return r ; } return fw_nftables_add_masquerade_internal ( ctx -> nfnl , add , af , source , source_prefixlen ) ; } 