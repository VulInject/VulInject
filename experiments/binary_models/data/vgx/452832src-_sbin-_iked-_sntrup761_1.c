static void Decrypt ( small * r , const Fq * c , const small * f , const small * ginv ) { int cf [ p ] ; Fq cf3 [ p ] ; small e [ p ] ; small ev [ p ] ; int mask ; int i ; Rq_mult_small ( cf , c , f ) ; Rq_mult3 ( cf3 , cf ) ; R3_fromRq ( e , cf3 ) ; R3_mult ( ev , e , ginv ) ; mask = Weightw_mask ( ev ) ; for ( i = 0 ; i < w ; ++ i ) { r [ i ] = ( ( ev [ i ] ^ 1 ) & ~ mask ) ^ 1 ; } for ( i = w ; i < p ; ++ i ) { r [ i ] = ev [ i ] & ~ mask ; } } 