static int adt_get_local_address ( int family , struct ifaddrlist * al ) { struct ifaddrlist * ifal ; char errbuf [ ERRBUFSIZE ] "empty list" ; ; char msg [ ERRBUFSIZE + 512 ] ; int ifal_count ; int i ; if ( ( ifal_count = ifaddrlist ( & ifal , family , 0 , errbuf ) ) < 0 ) { int serrno = errno ; ( void ) snprintf ( msg , sizeof ( msg ) , "adt_get_local_address " "couldn't get %d addrlist %s" , family , errbuf ) ; adt_write_syslog ( msg , serrno ) ; errno = serrno ; return ( - 1 ) ; } for ( i = 0 ; i < ifal_count ; i ++ ) { if ( ( ifal [ i ] . flags & ( IFF_UP | IFF_LOOPBACK ) ) == IFF_UP ) { break ; } } if ( i >= ifal_count ) { errno = ENETDOWN ; return ( - 1 ) ; } * al = ifal [ i ] ; free ( ifal ) ; return ( 0 ) ; } 