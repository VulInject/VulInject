int secflags_parse ( const secflagset_t * defaults , const char * flags , secflagdelta_t * ret ) { char * flag ; char * s , * ss ; boolean_t current = B_FALSE ; bzero ( ret , sizeof ( * ret ) ) ; if ( ( ss = s = strdup ( flags ) ) == NULL ) { return ( - 1 ) ; } while ( ( flag = strsep ( & s , "," ) ) != NULL ) { secflag_t sf = 0 ; boolean_t del = B_FALSE ; if ( strcasecmp ( flag , "default" ) == 0 ) { if ( defaults != NULL ) { secflags_union ( & ret -> psd_add , defaults ) ; } else { errno = EINVAL ; return ( - 1 ) ; } continue ; } if ( strcasecmp ( flag , "all" ) == 0 ) { secflags_fullset ( & ret -> psd_add ) ; continue ; } if ( strcasecmp ( flag , "none" ) == 0 ) { secflags_fullset ( & ret -> psd_rem ) ; continue ; } if ( strcasecmp ( flag , "current" ) == 0 ) { current = B_TRUE ; continue ; } if ( ( flag [ 0 ] == '-' ) || ( flag [ 0 ] == '!' ) ) { flag ++ ; del = B_TRUE ; } if ( flag [ 0 ] == '+' ) { flag ++ ; } if ( ( secflag_by_name ( flag , & sf ) ) != B_TRUE ) { free ( ss ) ; errno = EINVAL ; return ( - 1 ) ; } if ( del ) { secflag_set ( & ( ret -> psd_rem ) , sf ) ; } else { secflag_set ( & ( ret -> psd_add ) , sf ) ; } } if ( ! current ) { secflags_copy ( & ret -> psd_assign , & ret -> psd_add ) ; secflags_difference ( & ret -> psd_assign , & ret -> psd_rem ) ; ret -> psd_ass_active = B_TRUE ; secflags_zero ( & ret -> psd_add ) ; secflags_zero ( & ret -> psd_rem ) ; } free ( ss ) ; return ( 0 ) ; } 