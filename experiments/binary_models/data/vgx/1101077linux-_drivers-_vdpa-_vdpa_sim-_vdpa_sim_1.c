static int vdpasim_set_group_asid ( struct vdpa_device * vdpa , unsigned int group , unsigned int asid ) { struct vdpasim * vdpasim = vdpa_to_sim ( vdpa ) ; struct vhost_iotlb * iommu ; int i ; if ( asid >= vdpasim -> dev_attr . nas ) { return - EINVAL ; } iommu = & vdpasim -> iommu [ asid ] ; spin_lock ( & vdpasim -> lock ) ; for ( i = 0 ; i < vdpasim -> dev_attr . nvqs ; i ++ ) { if ( vdpasim_get_vq_group ( vdpa , i ) == group ) { vringh_set_iotlb ( & vdpasim -> vqs [ i ] . vring , iommu , & vdpasim -> iommu_lock ) ; } } spin_unlock ( & vdpasim -> lock ) ; return 0 ; } 