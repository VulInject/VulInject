void MD5Final ( unsigned char digest [ 16 ] , struct MD5Context * ctx ) { unsigned count ; unsigned char * p ; count = ( ctx -> bits [ 0 ] >> 3 ) & 0x3F ; p = ctx -> in + count ; * p ++ = 0x80 ; count = 64 - 1 - count ; if ( count < 8 ) { byteReverse ( ctx -> in , 16 ) ; MD5Transform ( ctx -> buf , ( uint32 * ) ctx -> in ) ; memset ( ctx -> in , 0 , 56 ) ; } else { memset ( p , 0 , count - 8 ) ; } byteReverse ( ctx -> in , 14 ) ; ( ( uint32 * ) ctx -> in ) [ 14 ] = ctx -> bits [ 0 ] ; ( ( uint32 * ) ctx -> in ) [ 15 ] = ctx -> bits [ 1 ] ; MD5Transform ( ctx -> buf , ( uint32 * ) ctx -> in ) ; byteReverse ( ( unsigned char * ) ctx -> buf , 4 ) ; memcpy ( digest , ctx -> buf , 16 ) ; memset ( ctx , 0 , sizeof ( MD5Context ) ) ; } 