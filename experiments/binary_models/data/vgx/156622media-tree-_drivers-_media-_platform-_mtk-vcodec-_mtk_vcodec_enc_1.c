int mtk_vcodec_enc_queue_init ( void * priv , struct vb2_queue * src_vq , struct vb2_queue * dst_vq ) { struct mtk_vcodec_ctx * ctx = priv ; int ret ; src_vq -> type = V4L2_BUF_TYPE_VIDEO_OUTPUT_MPLANE ; src_vq -> io_modes = VB2_DMABUF | VB2_MMAP | VB2_USERPTR ; src_vq -> drv_priv = ctx ; src_vq -> buf_struct_size = sizeof ( mtk_video_enc_buf ) ; src_vq -> ops = & mtk_venc_vb2_ops ; src_vq -> mem_ops = & vb2_dma_contig_memops ; src_vq -> timestamp_flags = V4L2_BUF_FLAG_TIMESTAMP_COPY ; src_vq -> lock = & ctx -> dev -> dev_mutex ; src_vq -> dev = & ctx -> dev -> plat_dev -> dev ; ret = vb2_queue_init ( src_vq ) ; dst_vq -> type = V4L2_BUF_TYPE_VIDEO_CAPTURE_MPLANE ; dst_vq -> io_modes = VB2_DMABUF | VB2_MMAP | VB2_USERPTR ; dst_vq -> drv_priv = ctx ; dst_vq -> buf_struct_size = sizeof ( v4l2_m2m_buffer ) ; dst_vq -> ops = & mtk_venc_vb2_ops ; dst_vq -> mem_ops = & vb2_dma_contig_memops ; dst_vq -> timestamp_flags = V4L2_BUF_FLAG_TIMESTAMP_COPY ; dst_vq -> lock = & ctx -> dev -> dev_mutex ; dst_vq -> dev = & ctx -> dev -> plat_dev -> dev ; return vb2_queue_init ( dst_vq ) ; } 