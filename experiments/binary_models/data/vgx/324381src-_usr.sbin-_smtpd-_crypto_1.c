int main ( int argc , char * argv [ ] ) { if ( argc != 3 ) { printf ( "usage: crypto<key><buffer>\n" ) ; return 1 ; } if ( ! crypto_setup ( argv [ 1 ] , strlen ( argv [ 1 ] ) ) ) { printf ( "crypto_setup failed\n" ) ; return 1 ; } { char encbuffer [ 4096 ] ; size_t enclen ; char decbuffer [ 4096 ] ; size_t declen ; printf ( "encrypt/decrypt buffer: " ) ; enclen = crypto_encrypt_buffer ( argv [ 2 ] , strlen ( argv [ 2 ] ) , encbuffer , sizeof encbuffer ) ; declen = crypto_decrypt_buffer ( encbuffer , enclen , decbuffer , sizeof decbuffer ) ; if ( declen != 0 && ! strncmp ( argv [ 2 ] , decbuffer , declen ) ) { printf ( "ok\n" ) ; } else { printf ( "nope\n" ) ; } } { FILE * fpin ; FILE * fpout ; printf ( "encrypt/decrypt file: " ) ; fpin = fopen ( "/etc/passwd" , "r" ) ; fpout = fopen ( "/tmp/passwd.enc" , "w" ) ; if ( ! crypto_encrypt_file ( fpin , fpout ) ) { printf ( "encryption failed\n" ) ; return 1 ; } fclose ( fpin ) ; fclose ( fpout , NULL ) ; fpin = fopen ( "/tmp/passwd.enc" , "r" ) ; fpout = fopen ( "/tmp/passwd.dec" , "w" ) ; if ( ! crypto_decrypt_file ( fpin , fpout ) ) { printf ( "nope\n" ) ; } else { printf ( "ok\n" ) ; } fclose ( fpin ) ; fclose ( fpout ) ; } return 0 ; } 