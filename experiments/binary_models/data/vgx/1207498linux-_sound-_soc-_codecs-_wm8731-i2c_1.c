static int wm8731_i2c_probe ( struct i2c_client * i2c ) { struct wm8731_priv * wm8731 ; int ret ; wm8731 = devm_kzalloc ( & i2c -> dev , sizeof ( wm8731_priv ) , GFP_KERNEL ) ; i2c_set_clientdata ( i2c , wm8731 ) ; wm8731 -> regmap = devm_regmap_init_i2c ( i2c , & wm8731_regmap ) ; if ( IS_ERR ( wm8731 -> regmap ) ) { ret = PTR_ERR ( wm8731 -> regmap ) ; dev_err ( & i2c -> dev , "Failed to allocate register map: %d\n" , ret ) ; return ret ; } return wm8731_init ( & i2c -> dev , wm8731 ) ; } static const struct i2c_device_id wm8731_i2c_id [ ] { { "wm8731" 0 } { } } ; ; 