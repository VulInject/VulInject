int phy_led_triggers_register ( struct phy_device * phy ) { int i , err ; unsigned int speeds [ 50 ] ; phy -> phy_num_led_triggers = phy_supported_speeds ( phy , speeds , ARRAY_SIZE ( speeds ) ) ; phy -> phy_led_triggers = devm_kzalloc ( & phy -> mdio . dev , sizeof ( phy_led_trigger ) * phy -> phy_num_led_triggers , GFP_KERNEL ) ; if ( ! phy -> phy_led_triggers ) { err = - ENOMEM ; out_clear } for ( i = 0 ; i < phy -> phy_num_led_triggers ; i ++ ) { err = phy_led_trigger_register ( phy , & phy -> phy_led_triggers [ i ] , speeds [ i ] ) ; if ( err ) { out_unreg } } phy -> last_triggered = NULL ; phy_led_trigger_change_speed ( phy ) ; return 0 ; out_unreg while ( i -- ) { phy_led_trigger_unregister ( & phy -> phy_led_triggers [ i ] ) ; } devm_kfree ( & phy -> mdio . dev , phy -> phy_led_triggers ) ; out_clear phy -> phy_num_led_triggers = 0 ; return err ; } 