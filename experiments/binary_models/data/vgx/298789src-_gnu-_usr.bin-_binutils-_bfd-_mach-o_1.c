bfd_mach_o_make_bfd_section ( , ) bfd * abfd ; bfd_mach_o_section * section ; { asection * bfdsec ; char * sname ; const char * prefix = "LC_SEGMENT" ; unsigned int snamelen ; snamelen = strlen ( prefix ) + 1 + strlen ( section -> segname ) + 1 + strlen ( section -> sectname ) + 1 ; sname = ( char * ) bfd_alloc ( abfd , snamelen ) ; if ( sname == NULL ) { return NULL ; } sprintf ( sname , "%s.%s.%s" , prefix , section -> segname , section -> sectname ) ; bfdsec = bfd_make_section_anyway ( abfd , sname ) ; bfdsec -> vma = section -> addr ; bfdsec -> lma = section -> addr ; bfdsec -> _raw_size = section -> size ; bfdsec -> filepos = section -> offset ; bfdsec -> alignment_power = section -> align ; if ( section -> flags & BFD_MACH_O_S_ZEROFILL ) { bfdsec -> flags = SEC_ALLOC ; } else { bfdsec -> flags = SEC_HAS_CONTENTS | SEC_LOAD | SEC_ALLOC | SEC_CODE ; } return bfdsec ; } 