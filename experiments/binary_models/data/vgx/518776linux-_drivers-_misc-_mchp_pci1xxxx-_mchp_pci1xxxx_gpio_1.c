static int pci1xxxx_gpio_setup ( struct pci1xxxx_gpio * priv , int irq ) { struct gpio_chip * gchip = & priv -> gpio ; struct gpio_irq_chip * girq ; int retval ; gchip -> label = dev_name ( & priv -> aux_dev -> dev ) ; gchip -> parent = & priv -> aux_dev -> dev ; gchip -> owner = THIS_MODULE ; gchip -> direction_input = pci1xxxx_gpio_direction_input ; gchip -> direction_output = pci1xxxx_gpio_direction_output ; gchip -> get_direction = pci1xxxx_gpio_get_direction ; gchip -> get = pci1xxxx_gpio_get ; gchip -> set = pci1xxxx_gpio_set ; gchip -> set_config = pci1xxxx_gpio_set_config ; gchip -> dbg_show = NULL ; gchip -> base = - 1 ; gchip -> ngpio = PCI1XXXX_NR_PINS ; gchip -> can_sleep = false ; retval = devm_request_threaded_irq ( & priv -> aux_dev -> dev , irq , NULL , pci1xxxx_gpio_irq_handler , IRQF_ONESHOT , "PCI1xxxxGPIO" , priv ) ; girq = & priv -> gpio . irq ; girq -> chip = & pci1xxxx_gpio_irqchip ; girq -> parent_handler = NULL ; girq -> num_parents = 0 ; girq -> parents = NULL ; girq -> default_type = IRQ_TYPE_NONE ; girq -> handler = handle_bad_irq ; return 0 ; } 