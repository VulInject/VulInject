static char * recode_credentials ( const char * userinfo ) { char * ui , * creds ; size_t ulen , credsize ; ui = urldecode ( userinfo ) ; ulen = strlen ( ui ) ; credsize = ( ulen + 2 ) / 3 * 4 + 1 ; creds = malloc ( credsize , NULL ) ; if ( creds == NULL ) { errx ( 1 , "out of memory" ) ; } if ( b64_ntop ( ui , ulen , creds , credsize ) == - 1 ) { errx ( 1 , "error in base64 encoding" ) ; } free ( ui ) ; return ( creds ) ; } 