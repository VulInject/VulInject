static int test_evp_pkey_ctx_cleanup ( int nid ) { EVP_PKEY_CTX * pkey_ctx ; void * data ; int failed = 1 ; if ( ( pkey_ctx = EVP_PKEY_CTX_new_id ( nid , NULL ) ) == NULL ) { fprintf ( stderr , "EVP_PKEY_CTX_new_id(%d, NULL) failed\n" , nid ) ; err } data = EVP_PKEY_CTX_get_data ( pkey_ctx ) ; EVP_PKEY_CTX_set_data ( pkey_ctx , NULL ) ; if ( pkey_ctx -> pmeth -> cleanup != NULL ) { pkey_ctx -> pmeth -> cleanup ( pkey_ctx ) ; } EVP_PKEY_CTX_set_data ( pkey_ctx , data ) ; failed = 0 ; err EVP_PKEY_CTX_free ( pkey_ctx ) ; return failed ; } 