int sshsig_check_allowed_keys ( const char * path , const struct sshkey * sign_key , const char * principal , const char * sig_namespace , uint64_t verify_time ) { FILE * f = NULL ; char * line = NULL ; size_t linesize = 0 ; u_long linenum = 0 ; int r = SSH_ERR_INTERNAL_ERROR , oerrno ; if ( ( f = fopen ( path , "r" ) ) == NULL ) { oerrno = errno ; error ( "Unable to open allowed keys file \"%s\": %s" , path , strerror ( errno ) ) ; errno = oerrno ; return SSH_ERR_SYSTEM_ERROR ; } while ( getline ( & line , & linesize , f ) != - 1 ) { linenum ++ ; r = check_allowed_keys_line ( path , linenum , line , sign_key , principal , sig_namespace , verify_time , NULL ) ; line = NULL ; linesize = 0 ; if ( r == SSH_ERR_KEY_NOT_FOUND ) { continue ; } if ( r == 0 ) { fclose ( f ) ; return 0 ; } else { break ; } } fclose ( f ) ; free ( line ) ; return r == 0 ?SSH_ERR_KEY_NOT_FOUND : r ; } 