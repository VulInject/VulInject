int ssl_print_tmp_key ( BIO * out , SSL * s ) { const char * cname ; EVP_PKEY * pkey ; EC_KEY * ec ; const EC_GROUP * group ; int nid ; if ( ! SSL_get_server_tmp_key ( s , & pkey ) ) { return 0 ; } BIO_puts ( out , "Server Temp Key: " ) ; switch ( EVP_PKEY_id ( pkey ) ) { case EVP_PKEY_DH : BIO_printf ( out , "DH, %d bits\n" , EVP_PKEY_bits ( pkey ) ) ; break ; case EVP_PKEY_EC : if ( ( ec = EVP_PKEY_get0_EC_KEY ( pkey ) ) == NULL ) { err } if ( ( group = EC_KEY_get0_group ( ec ) ) == NULL ) { err } nid = EC_GROUP_get_curve_name ( group ) ; if ( ( cname = EC_curve_nid2nist ( nid ) ) == NULL ) { cname = OBJ_nid2sn ( nid ) ; } BIO_printf ( out , "ECDH, %s, %d bits\n" , cname , EVP_PKEY_bits ( pkey ) ) ; break ; default : BIO_printf ( out , "%s, %d bits\n" , OBJ_nid2sn ( EVP_PKEY_id ( pkey ) ) , EVP_PKEY_bits ( pkey ) ) ; } err return 1 ; } 