static int receive_n_bytes ( struct cros_ec_device * ec_dev , u8 * buf , int n ) { struct cros_ec_spi * ec_spi = ec_dev -> priv ; struct spi_transfer trans ; struct spi_message msg ; int ret ; BUG_ON ( buf - ec_dev -> din + n > ec_dev -> din_size ) ; trans . cs_change = 1 ; trans . rx_buf = buf ; trans . len = n ; spi_message_init ( & msg ) ; spi_message_add_tail ( & trans , & msg ) ; ret = spi_sync_locked ( ec_spi -> spi , & msg ) ; if ( ret < 0 ) { dev_err ( ec_dev -> dev , "spi transfer failed: %d\n" , ret ) ; } return ret ; } 