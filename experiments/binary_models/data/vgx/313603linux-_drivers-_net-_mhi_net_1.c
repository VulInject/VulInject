static netdev_tx_t mhi_ndo_xmit ( struct sk_buff * skb , struct net_device * ndev ) { struct mhi_net_dev * mhi_netdev = netdev_priv ( ndev ) ; struct mhi_device * mdev = mhi_netdev -> mdev ; int err ; err = mhi_queue_skb ( mdev , DMA_TO_DEVICE , skb , skb -> len , MHI_EOT ) ; if ( unlikely ( err ) ) { net_err_ratelimited ( "%s: Failed to queue TX buf (%d)\n" , ndev -> name , err ) ; exit_drop } if ( mhi_queue_is_full ( mdev , DMA_TO_DEVICE ) ) { netif_stop_queue ( ndev ) ; } return NETDEV_TX_OK ; exit_drop u64_stats_update_begin ( & mhi_netdev -> stats . tx_syncp ) ; u64_stats_inc ( & mhi_netdev -> stats . tx_dropped ) ; u64_stats_update_end ( & mhi_netdev -> stats . tx_syncp ) ; return NETDEV_TX_OK ; } 