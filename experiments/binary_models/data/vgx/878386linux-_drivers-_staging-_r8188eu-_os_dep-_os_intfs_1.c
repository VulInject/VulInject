int netdev_close ( struct net_device * pnetdev ) { struct adapter * padapter = ( adapter * ) rtw_netdev_priv ( pnetdev ) ; struct dvobj_priv * dvobj = adapter_to_dvobj ( padapter ) ; padapter -> net_closed = true ; if ( padapter -> pwrctrlpriv . rf_pwrstate == rf_on ) { if ( pnetdev ) { if ( ! rtw_netif_queue_stopped ( pnetdev ) ) { netif_tx_stop_all_queues ( pnetdev ) ; } } LeaveAllPowerSaveMode ( padapter ) ; rtw_disassoc_cmd ( padapter , 500 , false ) ; rtw_indicate_disconnect ( padapter ) ; rtw_free_assoc_resources ( padapter , 1 ) ; rtw_free_network_queue ( padapter , true ) ; rtw_led_control ( padapter , LED_CTL_POWER_OFF ) ; } nat25_db_cleanup ( padapter ) ; rtw_p2p_enable ( padapter , P2P_ROLE_DISABLE ) ; dvobj -> firmware . data = NULL ; return 0 ; } 