static void bfq_bfqq_save_state ( struct bfq_queue * bfqq ) { struct bfq_io_cq * bic = bfqq -> bic ; unsigned int a_idx = bfqq -> actuator_idx ; struct bfq_iocq_bfqq_data * bfqq_data = & bic -> bfqq_data [ a_idx ] ; bfqq_data -> saved_last_serv_time_ns = bfqq -> last_serv_time_ns ; bfqq_data -> saved_inject_limit = bfqq -> inject_limit ; bfqq_data -> saved_decrease_time_jif = bfqq -> decrease_time_jif ; bfqq_data -> saved_weight = bfqq -> entity . orig_weight ; bfqq_data -> saved_ttime = bfqq -> ttime ; bfqq_data -> saved_has_short_ttime = bfq_bfqq_has_short_ttime ( bfqq ) ; bfqq_data -> saved_IO_bound = bfq_bfqq_IO_bound ( bfqq ) ; bfqq_data -> saved_io_start_time = bfqq -> io_start_time ; bfqq_data -> saved_tot_idle_time = bfqq -> tot_idle_time ; bfqq_data -> saved_in_large_burst = bfq_bfqq_in_large_burst ( bfqq ) ; bfqq_data -> was_in_burst_list = ! hlist_unhashed ( & bfqq -> burst_list_node ) ; if ( unlikely ( bfq_bfqq_just_created ( bfqq ) && ! bfq_bfqq_in_large_burst ( bfqq ) && bfqq -> bfqd -> low_latency ) ) { bfqq_data -> saved_wr_coeff = bfqq -> bfqd -> bfq_wr_coeff ; bfqq_data -> saved_wr_start_at_switch_to_srt = bfq_smallest_from_now ( ) ; bfqq_data -> saved_wr_cur_max_time = bfq_wr_duration ( bfqq -> bfqd ) ; bfqq_data -> saved_last_wr_start_finish = jiffies ; } else { bfqq_data -> saved_wr_coeff = bfqq -> wr_coeff ; bfqq_data -> saved_wr_start_at_switch_to_srt = bfqq -> wr_start_at_switch_to_srt ; bfqq_data -> saved_service_from_wr = bfqq -> service_from_wr ; bfqq_data -> saved_last_wr_start_finish = bfqq -> last_wr_start_finish ; bfqq_data -> saved_wr_cur_max_time = bfqq -> wr_cur_max_time ; } } 