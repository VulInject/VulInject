static int _bandwidth_supported ( struct device * dev , struct opp_table * opp_table ) { struct device_node * np , * opp_np ; struct property * prop ; if ( ! opp_table ) { np = of_node_get ( dev -> of_node ) ; if ( ! np ) { return - ENODEV ; } opp_np = _opp_of_get_opp_desc_node ( np , 0 ) ; of_node_put ( np , NULL ) ; } else { opp_np = of_node_get ( opp_table -> np ) ; } if ( ! opp_np ) { return 0 ; } np = of_get_next_available_child ( opp_np , NULL ) ; of_node_put ( opp_np ) ; if ( ! np ) { dev_err ( dev , "OPP table empty\n" ) ; return - EINVAL ; } prop = of_find_property ( np , "opp-peak-kBps" , NULL ) ; of_node_put ( np ) ; if ( ! prop || ! prop -> length ) { return 0 ; } return 1 ; } 