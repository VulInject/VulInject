static void GMatrixEdit_MouseEvent ( GMatrixEdit * gme , GEvent * event ) { int r = event -> u . mouse . y / ( gme -> fh + gme -> vpad ) + gme -> off_top ; int x = event -> u . mouse . x + gme -> off_left ; int c , i ; if ( gme -> edit_active && event -> type == et_mousemove ) { return ; } for ( c = 0 ; c < gme -> cols ; ++ c ) { if ( x >= gme -> col_data [ c ] . x && x <= gme -> col_data [ c ] . x + gme -> col_data [ c ] . width ) { break ; } } if ( event -> type == et_mousemove && gme -> reportmousemove != NULL ) { ( gme -> reportmousemove ) ( & gme -> g , r , c ) ; return ; } if ( gme -> edit_active ) { if ( ( r = GME_FinishEditPreserve ( gme , r ) ) == - 1 ) { return ; } } if ( event -> type == et_mousedown ) { GMatrixEdit_StartSubGadgets ( gme , r , c , event ) ; } if ( event -> type == et_mousemove ) { if ( c < gme -> cols && gme -> col_data [ c ] . me_type == me_stringchoicetrans && gme -> col_data [ c ] . enum_vals != NULL && r < gme -> rows ) { char * str = gme -> data [ r * gme -> cols + c ] . u . md_str ; GMenuItem * enums = gme -> col_data [ c ] . enum_vals ; for ( i = 0 ; enums [ i ] . ti . text != NULL || enums [ i ] . ti . line ; ++ i ) { if ( enums [ i ] . ti . userdata != NULL && strcmp ( enums [ i ] . ti . userdata , str ) == 0 ) { if ( enums [ i ] . ti . text_is_1byte ) { GGadgetPreparePopup8 ( gme -> nested , ( char * ) enums [ i ] . ti . text ) ; } else { GGadgetPreparePopup ( gme -> nested , enums [ i ] . ti . text ) ; } break ; } } } if ( c < gme -> cols && gme -> col_data [ c ] . me_type == me_stringchoicetag && gme -> col_data [ c ] . enum_vals != NULL && r < gme -> rows ) { char * str = gme -> data [ r * gme -> cols + c ] . u . md_str , buf [ 8 ] ; GMenuItem * enums = gme -> col_data [ c ] . enum_vals ; for ( i = 0 ; enums [ i ] . ti . text != NULL || enums [ i ] . ti . line ; ++ i ) { buf [ 0 ] = ( ( intptr_t ) enums [ i ] . ti . userdata ) >> 24 ; buf [ 1 ] = ( ( intptr_t ) enums [ i ] . ti . userdata ) >> 16 ; buf [ 2 ] = ( ( intptr_t ) enums [ i ] . ti . userdata ) >> 8 ; buf [ 3 ] = ( ( intptr_t ) enums [ i ] . ti . userdata ) & 0xff ; buf [ 4 ] = '\0' ; if ( enums [ i ] . ti . userdata != NULL && strcmp ( buf , str ) == 0 ) { if ( enums [ i ] . ti . text_is_1byte ) { GGadgetPreparePopup8 ( gme -> nested , ( char * ) enums [ i ] . ti . text ) ; } else { GGadgetPreparePopup ( gme -> nested , enums [ i ] . ti . text ) ; } break ; } } } if ( gme -> g . popup_msg != NULL ) { GGadgetPreparePopup ( gme -> nested , gme -> g . popup_msg ) ; } } } 