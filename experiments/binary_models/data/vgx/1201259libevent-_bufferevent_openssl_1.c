static int bio_bufferevent_write ( BIO * b , const char * in , int inlen ) { struct bufferevent * bufev = BIO_get_data ( b ) ; struct evbuffer * output ; size_t outlen ; BIO_clear_retry_flags ( b ) ; if ( ! BIO_get_data ( b ) ) { return - 1 ; } output = bufferevent_get_output ( bufev ) ; outlen = evbuffer_get_length ( output ) ; if ( bufev -> wm_write . high && bufev -> wm_write . high <= ( outlen + inlen ) ) { if ( bufev -> wm_write . high <= outlen ) { return - 1 ; } inlen = bufev -> wm_write . high - outlen ; } EVUTIL_ASSERT ( inlen > 0 ) ; evbuffer_add ( output , in , inlen ) ; return inlen ; } 