static void * dma_direct_alloc_coherent ( struct device * dev , size_t size , dma_addr_t * dma_handle , gfp_t flag , unsigned long attrs ) { return consistent_alloc ( flag , size , dma_handle ) ; void * ret ; struct page * page ; int node = dev_to_node ( dev ) ; flag &= ~ ( __GFP_HIGHMEM ) ; page = alloc_pages_node ( node , flag , get_order ( size ) ) ; if ( page == NULL ) { return NULL ; } ret = page_address ( page ) ; * dma_handle = virt_to_phys ( ret ) ; return ret ; } 