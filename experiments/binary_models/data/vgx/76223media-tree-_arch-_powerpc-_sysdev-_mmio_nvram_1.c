static ssize_t mmio_nvram_read ( char * buf , size_t count , loff_t * index ) { unsigned long flags ; if ( * index + count > mmio_nvram_len ) { count = mmio_nvram_len - * index ; } spin_lock_irqsave ( & mmio_nvram_lock , flags ) ; memcpy_fromio ( buf , mmio_nvram_start + * index , count ) ; spin_unlock_irqrestore ( & mmio_nvram_lock , flags ) ; * index += count ; return count ; } 