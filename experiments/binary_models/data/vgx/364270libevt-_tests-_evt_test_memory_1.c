static void * * evt_test_real_realloc ( void * , size_t ) NULL ; int evt_test_malloc_attempts_before_fail = - 1 ; int evt_test_memcpy_attempts_before_fail = - 1 ; int evt_test_memset_attempts_before_fail = - 1 ; int evt_test_realloc_attempts_before_fail = - 1 ; void * malloc ( size_t size ) { void * ptr = NULL ; if ( evt_test_real_malloc == NULL ) { evt_test_real_malloc = dlsym ( RTLD_NEXT , "malloc" ) ; } if ( evt_test_malloc_attempts_before_fail == 0 ) { evt_test_malloc_attempts_before_fail = - 1 ; return ( NULL ) ; } if ( evt_test_malloc_attempts_before_fail > 0 ) { evt_test_malloc_attempts_before_fail -- ; } ptr = evt_test_real_malloc ( size , NULL ) ; return ( ptr ) ; } 