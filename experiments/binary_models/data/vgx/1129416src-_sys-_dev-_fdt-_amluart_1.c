int amluartioctl ( dev_t dev , u_long cmd , caddr_t data , int flag , struct proc * p ) { struct amluart_softc * sc = amluart_sc ( dev ) ; struct tty * tp ; int error ; if ( sc == NULL ) { return ENODEV ; } tp = sc -> sc_tty ; if ( tp == NULL ) { return ENXIO ; } error = ( * linesw [ tp -> t_line ] . l_ioctl ) ( tp , cmd , data , flag , p ) ; error = ttioctl ( tp , cmd , data , flag , p ) ; if ( error >= 0 ) { return error ; } switch ( cmd ) { case TIOCSBRK : case TIOCCBRK : case TIOCSDTR : case TIOCCDTR : case TIOCMSET : case TIOCMBIS : case TIOCMBIC : case TIOCMGET : case TIOCGFLAGS : break ; case TIOCSFLAGS : error = suser ( p ) ; if ( error != 0 ) { return EPERM ; } break ; default : return ENOTTY ; } return 0 ; } 