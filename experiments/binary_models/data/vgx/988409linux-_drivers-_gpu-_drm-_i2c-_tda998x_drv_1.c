static int tda998x_connector_get_modes ( struct drm_connector * connector ) { struct tda998x_priv * priv = conn_to_tda998x_priv ( connector ) ; struct edid * edid ; int n ; if ( tda998x_edid_delay_wait ( priv ) ) { return 0 ; } if ( priv -> rev == TDA19988 ) { reg_clear ( priv , REG_TX4 , TX4_PD_RAM ) ; } edid = drm_do_get_edid ( connector , read_edid_block , priv ) ; if ( priv -> rev == TDA19988 ) { reg_set ( priv , REG_TX4 , TX4_PD_RAM ) ; } if ( ! edid ) { dev_warn ( & priv -> hdmi -> dev , "failed to read EDID\n" ) ; return 0 ; } drm_connector_update_edid_property ( connector , edid ) ; cec_notifier_set_phys_addr_from_edid ( priv -> cec_notify , edid ) ; mutex_lock ( & priv -> audio_mutex ) ; n = drm_add_edid_modes ( connector , edid ) ; priv -> sink_has_audio = drm_detect_monitor_audio ( edid ) ; mutex_unlock ( & priv -> audio_mutex ) ; return n ; } 