static int mlxsw_sp_fid_family_register ( struct mlxsw_sp * mlxsw_sp , const struct mlxsw_sp_fid_family * tmpl ) { u16 nr_fids = tmpl -> end_index - tmpl -> start_index + 1 ; struct mlxsw_sp_fid_family * fid_family ; int err ; fid_family = kmemdup ( tmpl , sizeof ( * fid_family ) , GFP_KERNEL ) ; fid_family -> mlxsw_sp = mlxsw_sp ; INIT_LIST_HEAD ( & fid_family -> fids_list ) ; fid_family -> fids_bitmap = bitmap_zalloc ( nr_fids , GFP_KERNEL ) ; if ( ! fid_family -> fids_bitmap ) { err = - ENOMEM ; err_alloc_fids_bitmap } if ( fid_family -> flood_tables ) { err = mlxsw_sp_fid_flood_tables_init ( fid_family ) ; if ( err ) { err_fid_flood_tables_init } } mlxsw_sp -> fid_core -> fid_family_arr [ tmpl -> type ] = fid_family ; return 0 ; err_fid_flood_tables_init bitmap_free ( fid_family -> fids_bitmap ) ; err_alloc_fids_bitmap kfree ( fid_family ) ; return err ; } 