static int proc_dodebug ( struct ctl_table * table , int write , void * buffer , size_t * lenp , loff_t * ppos ) { char tmpbuf [ 20 ] , * s = NULL ; char * p ; unsigned int value ; size_t left , len ; if ( ( * ppos && ! write ) || ! * lenp ) { * lenp = 0 ; return 0 ; } left = * lenp ; if ( write ) { p = buffer ; while ( left && isspace ( * p ) ) { left -- ; p ++ ; } if ( ! left ) { done } memcpy ( tmpbuf , p , left ) ; tmpbuf [ left ] = '\0' ; value = simple_strtol ( tmpbuf , & s , 0 ) ; if ( s ) { left -= ( s - tmpbuf ) ; if ( left && ! isspace ( * s ) ) { return - EINVAL ; } while ( left && isspace ( * s ) ) { left -- ; s ++ ; } } else { left = 0 ; } * ( unsigned int * ) table -> data = value ; if ( strcmp ( table -> procname , "rpc_debug" ) == 0 ) { rpc_show_tasks ( & init_net ) ; } } else { len = sprintf ( tmpbuf , "0x%04x" , * ( unsigned int * ) table -> data ) ; if ( len > left ) { len = left ; } memcpy ( buffer , tmpbuf , len ) ; if ( ( left -= len ) > 0 ) { * ( ( char * ) buffer + len ) = '\n' ; left -- ; } } done * lenp -= left ; * ppos += * lenp ; return 0 ; } static struct ctl_table debug_table [ ] { { . procname = "rpc_debug" . data = & rpc_debug . maxlen = sizeof ( int ) . mode = 0644 . proc_handler = proc_dodebug } { . procname = "nfs_debug" . data = & nfs_debug . maxlen = sizeof ( int ) . mode = 0644 . proc_handler = proc_dodebug } { . procname = "nfsd_debug" . data = & nfsd_debug . maxlen = sizeof ( int ) . mode = 0644 . proc_handler = proc_dodebug } { . procname = "nlm_debug" . data = & nlm_debug . maxlen = sizeof ( int ) . mode = 0644 . proc_handler = proc_dodebug } { . procname = "transports" . maxlen = 256 . mode = 0444 . proc_handler = proc_do_xprt } { } } ; ; 