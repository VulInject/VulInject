static int sdhci_esdhc_imx_remove ( struct platform_device * pdev ) { struct sdhci_host * host = platform_get_drvdata ( pdev ) ; struct sdhci_pltfm_host * pltfm_host = sdhci_priv ( host ) ; struct pltfm_imx_data * imx_data = sdhci_pltfm_priv ( pltfm_host ) ; int dead ; pm_runtime_get_sync ( & pdev -> dev ) ; dead = ( readl ( host -> ioaddr + SDHCI_INT_STATUS ) == 0xffffffff ) ; pm_runtime_disable ( & pdev -> dev ) ; pm_runtime_put_noidle ( & pdev -> dev ) ; sdhci_remove_host ( host , dead ) ; clk_disable_unprepare ( imx_data -> clk_per , NULL ) ; clk_disable_unprepare ( imx_data -> clk_ipg ) ; clk_disable_unprepare ( imx_data -> clk_ahb ) ; if ( imx_data -> socdata -> flags & ESDHC_FLAG_PMQOS ) { cpu_latency_qos_remove_request ( & imx_data -> pm_qos_req ) ; } sdhci_pltfm_free ( pdev ) ; return 0 ; } 