static nscd_rc_t getparams ( int search_fnum , nss_db_initf_t initf , nscd_nsw_params_t * params ) { nscd_rc_t rc = NSCD_SUCCESS ; nss_db_params_t * p ; int j ; char * dbn ; const char * n ; char * me = "getparams" ; p = & params -> p ; * initf ( p ) ; params -> dbi = - 1 ; params -> cfgdbi = - 1 ; params -> compati = - 1 ; params -> dnsi = - 1 ; n = p -> name ; for ( j = 0 ; j < NSCD_NUM_DB ; j ++ ) { dbn = NSCD_NSW_DB_NAME ( j ) ; if ( * n != * dbn ) { continue ; } if ( strcmp ( n , dbn ) == 0 ) { params -> dbi = j ; if ( * n != 'h' && * n != 'i' && * n != 's' && * n != 'a' ) { break ; } if ( strcmp ( n , NSS_DBNAM_HOSTS ) == 0 && search_fnum == NSS_DBOP_HOSTS_BYNAME ) { params -> dnsi = 0 ; } if ( strcmp ( n , NSS_DBNAM_IPNODES ) == 0 && search_fnum == NSS_DBOP_IPNODES_BYNAME ) { params -> dnsi = 1 ; } if ( strcmp ( n , NSS_DBNAM_SHADOW ) == 0 ) { params -> privdb = 1 ; } break ; } } if ( p -> config_name != NULL ) { n = p -> config_name ; for ( j = 0 ; j < NSCD_NUM_DB ; j ++ ) { dbn = NSCD_NSW_DB_NAME ( j ) ; if ( * n == * dbn ) { if ( strcmp ( n , dbn ) == 0 ) { params -> cfgdbi = j ; break ; } } } } if ( params -> cfgdbi != - 1 ) { if ( strstr ( p -> config_name , "_compat" ) != NULL ) { n = p -> name ; for ( j = params -> cfgdbi ; j < NSCD_NUM_DB ; j ++ ) { dbn = NSCD_NSW_DB_NAME ( j ) ; if ( * n == * dbn ) { if ( strcmp ( n , dbn ) == 0 ) { params -> compati = j ; break ; } } } } } if ( params -> dbi == - 1 ) { _NSCD_LOG ( NSCD_LOG_SWITCH_ENGINE , NSCD_LOG_LEVEL_DEBUG ) ( me , "unsupported database: %s\n" , p -> name ) ; return ( NSCD_CFG_UNSUPPORTED_SWITCH_DB ) ; } return ( rc ) ; } 