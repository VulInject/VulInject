void __pack_quadruple ( unpacked * pu , quadruple * px , enum fp_direction_type rd , fp_exception_field_type * ex ) { quadruple_equivalence kluge ; int e ; e = 0 ; kluge . f . msw . sign = pu -> sign ; switch ( pu -> fpclass ) { case fp_zero : kluge . f . msw . exponent = 0 ; kluge . f . msw . significand = 0 ; kluge . f . significand3 = 0 ; kluge . f . significand4 = 0 ; break ; case fp_infinity : infinity kluge . f . msw . exponent = 0x7fff ; kluge . f . msw . significand = 0 ; kluge . f . significand2 = 0 ; kluge . f . significand3 = 0 ; kluge . f . significand4 = 0 ; break ; case fp_quiet : kluge . f . msw . exponent = 0x7fff ; __fp_rightshift ( pu , 15 ) ; kluge . f . msw . significand = 0x8000 | ( 0xffff & pu -> significand [ 0 ] ) ; kluge . f . significand2 = pu -> significand [ 1 ] ; kluge . f . significand3 = pu -> significand [ 2 ] ; kluge . f . significand4 = pu -> significand [ 3 ] ; break ; case fp_normal : __fp_rightshift ( pu , 15 ) ; pu -> exponent += QUAD_BIAS ; if ( pu -> exponent <= 0 ) { __fp_rightshift ( pu , 1 - pu -> exponent ) ; round ( pu , 4 , rd , & e ) ; if ( pu -> significand [ 0 ] == 0x10000 ) { kluge . f . msw . exponent = 1 ; kluge . f . msw . significand = 0 ; kluge . f . significand2 = 0 ; kluge . f . significand3 = 0 ; kluge . f . significand4 = 0 ; e |= ( 1 << fp_underflow ) ; ret } if ( e & ( 1 << fp_inexact ) ) { e |= ( 1 << fp_underflow ) ; } kluge . f . msw . exponent = 0 ; kluge . f . msw . significand = 0xffff & pu -> significand [ 0 ] ; kluge . f . significand2 = pu -> significand [ 1 ] ; kluge . f . significand3 = pu -> significand [ 2 ] ; kluge . f . significand4 = pu -> significand [ 3 ] ; ret } round ( pu , 4 , rd , & e ) ; if ( pu -> significand [ 0 ] == 0x20000 ) { pu -> significand [ 0 ] = 0x10000 ; pu -> exponent += 1 ; } if ( pu -> exponent >= 0x7fff ) { e |= ( 1 << fp_overflow ) | ( 1 << fp_inexact ) ; if ( overflow_to_infinity ( pu -> sign , rd ) ) { infinity } kluge . f . msw . exponent = 0x7ffe ; kluge . f . msw . significand = 0xffff ; kluge . f . significand2 = 0xffffffff ; kluge . f . significand3 = 0xffffffff ; kluge . f . significand4 = 0xffffffff ; ret } kluge . f . msw . exponent = pu -> exponent ; kluge . f . msw . significand = pu -> significand [ 0 ] & 0xffff ; kluge . f . significand2 = pu -> significand [ 1 ] ; kluge . f . significand3 = pu -> significand [ 2 ] ; kluge . f . significand4 = pu -> significand [ 3 ] ; break ; } ret * px = kluge . x ; * ex = ( fp_exception_field_type ) e ; } 