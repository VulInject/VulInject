int sgsbbc_iosram_switchfrom ( struct sbbc_softstate * softsp ) { struct sbbc_softstate * sp ; int rv = DDI_FAILURE ; int new_instance ; mutex_enter ( & chosen_lock ) ; ASSERT ( sgsbbc_instances ) ; for ( sp = sgsbbc_instances ; sp != NULL ; sp = sp -> next ) { if ( softsp == sp ) { continue ; } if ( sp -> sbbc_state & SBBC_STATE_DETACH ) { continue ; } break ; } if ( sp == NULL ) { rv = DDI_FAILURE ; } else { new_instance = ddi_get_instance ( sp -> dip ) ; rv = iosram_switch_tunnel ( new_instance , NULL ) ; if ( rv == DDI_SUCCESS ) { sp -> iosram = master_iosram ; } } mutex_exit ( & chosen_lock ) ; return ( rv ) ; } 