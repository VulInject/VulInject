static int power5_get_constraint ( u64 event , unsigned long * maskp , unsigned long * valp , u64 event_config1 __maybe_unused ) { int pmc , byte , unit , sh ; int bit , fmask ; unsigned long mask = 0 , value = 0 ; int grp = - 1 ; pmc = ( event >> PM_PMC_SH ) & PM_PMC_MSK ; if ( pmc ) { sh = ( pmc - 1 ) * 2 ; mask |= 2 << sh ; value |= 1 << sh ; if ( pmc <= 4 ) { grp = ( pmc - 1 ) >> 1 ; } if ( event != 0x500009 && event != 0x600005 ) { return - 1 ; } } if ( event & PM_BUSEVENT_MSK ) { unit = ( event >> PM_UNIT_SH ) & PM_UNIT_MSK ; if ( unit > PM_LASTUNIT ) { return - 1 ; } if ( unit == PM_ISU0_ALT ) { unit = PM_ISU0 ; } mask |= unit_cons [ unit ] [ 0 ] ; value |= unit_cons [ unit ] [ 1 ] ; byte = ( event >> PM_BYTE_SH ) & PM_BYTE_MSK ; if ( byte >= 4 ) { if ( unit != PM_LSU1 ) { return - 1 ; } ++ unit ; byte &= 3 ; } if ( unit == PM_GRS ) { bit = event & 7 ; fmask = ( bit == 6 ) ?7 : 3 ; sh = grsel_shift [ bit ] ; mask |= ( unsigned long ) fmask << sh ; value |= ( unsigned long ) ( ( event >> PM_GRS_SH ) & fmask ) << sh ; } if ( ! pmc ) { grp = byte & 1 ; } mask |= 0xfUL << ( 24 - 4 * byte ) ; value |= ( unsigned long ) unit << ( 24 - 4 * byte ) ; } if ( grp == 0 ) { mask |= 0x200000000ul ; value |= 0x080000000ul ; } if ( grp == 1 ) { mask |= 0x40000000ul ; value |= 0x10000000ul ; } if ( pmc < 5 ) { mask |= 0x8000000000000ul ; value |= 0x1000000000000ul ; } * maskp = mask ; * valp = value ; return 0 ; } 