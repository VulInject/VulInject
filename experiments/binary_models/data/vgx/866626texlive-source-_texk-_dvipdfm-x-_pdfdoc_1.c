pdf_doc_close_catalog ( ) { pdf_obj * tmp ; if ( p -> root . viewerpref ) { tmp = pdf_lookup_dict ( p -> root . dict , "ViewerPreferences" ) ; if ( ! tmp ) { pdf_add_dict ( p -> root . dict , pdf_new_name ( "ViewerPreferences" ) , pdf_ref_obj ( p -> root . viewerpref ) ) ; } if ( PDF_OBJ_DICTTYPE ( tmp ) ) { pdf_merge_dict ( p -> root . viewerpref , tmp ) ; pdf_add_dict ( p -> root . dict , pdf_new_name ( "ViewerPreferences" ) , pdf_ref_obj ( p -> root . viewerpref ) ) ; } else { WARN ( "Could not modify ViewerPreferences." ) ; } pdf_release_obj ( p -> root . viewerpref ) ; p -> root . viewerpref = NULL ; } if ( p -> root . pagelabels ) { tmp = pdf_lookup_dict ( p -> root . dict , "PageLabels" ) ; if ( ! tmp ) { tmp = pdf_new_dict ( ) ; pdf_add_dict ( tmp , pdf_new_name ( "Nums" ) , pdf_link_obj ( p -> root . pagelabels ) ) ; pdf_add_dict ( p -> root . dict , pdf_new_name ( "PageLabels" ) , pdf_ref_obj ( tmp ) ) ; pdf_release_obj ( tmp ) ; } else { WARN ( "Could not modify PageLabels." ) ; } pdf_release_obj ( p -> root . pagelabels ) ; p -> root . pagelabels = NULL ; } pdf_add_dict ( p -> root . dict , pdf_new_name ( "Type" ) , pdf_new_name ( "Catalog" ) ) ; p -> root . dict = NULL ; return ; } 