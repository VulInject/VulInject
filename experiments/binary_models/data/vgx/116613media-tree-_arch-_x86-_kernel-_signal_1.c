static int restore_sigcontext ( struct pt_regs * regs , struct sigcontext __user * sc , unsigned long uc_flags ) { unsigned long buf_val ; void __user * buf ; unsigned int tmpflags ; unsigned int err = 0 ; current -> restart_block . fn = do_no_restart_syscall ; get_user_try { set_user_gs ( regs , GET_SEG ( gs ) ) ; COPY_SEG ( fs ) ; COPY_SEG ( es ) ; COPY_SEG ( ds ) ; COPY ( di , NULL ) ; COPY ( si ) ; COPY ( bp ) ; COPY ( sp ) ; COPY ( bx ) ; COPY ( dx ) ; COPY ( cx ) ; COPY ( ip ) ; COPY ( ax ) ; COPY ( r8 ) ; COPY ( r9 ) ; COPY ( r10 ) ; COPY ( r11 ) ; COPY ( r12 ) ; COPY ( r13 ) ; COPY ( r14 ) ; COPY ( r15 ) ; COPY_SEG_CPL3 ( cs ) ; COPY_SEG_CPL3 ( ss ) ; if ( unlikely ( ! ( uc_flags & UC_STRICT_RESTORE_SS ) && user_64bit_mode ( regs ) ) ) { force_valid_ss ( regs ) ; } get_user_ex ( tmpflags , & sc -> flags ) ; regs -> flags = ( regs -> flags & ~ FIX_EFLAGS ) | ( tmpflags & FIX_EFLAGS ) ; regs -> orig_ax = - 1 ; get_user_ex ( buf_val , & sc -> fpstate ) ; buf = ( void __user * ) buf_val ; } get_user_catch ( err ) ; err |= fpu__restore_sig ( buf , IS_ENABLED ( CONFIG_X86_32 ) ) ; force_iret ( ) ; return err ; } 