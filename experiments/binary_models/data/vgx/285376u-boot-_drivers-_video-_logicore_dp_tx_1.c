static int training_state_channel_equalization ( struct udevice * dev ) { struct dp_tx * dp_tx = dev_get_priv ( dev ) ; int status ; u32 delay_us ; u32 iteration_count = 0 ; delay_us = get_training_delay ( dev , TS_CHANNEL_EQUALIZATION ) ; if ( dp_tx -> dpcd_rx_caps [ DPCD_MAX_LANE_COUNT ] & DPCD_TPS3_SUPPORT_MASK ) { status = set_training_pattern ( dev , TRAINING_PATTERN_SET_TP3 ) ; } else { status = set_training_pattern ( dev , TRAINING_PATTERN_SET_TP2 ) ; } if ( status ) { return TS_FAILURE ; } while ( iteration_count < 5 ) { udelay ( delay_us ) ; status = get_lane_status_adj_reqs ( dev ) ; if ( status ) { return TS_FAILURE ; } status = check_clock_recovery ( dev , dp_tx -> link_config . lane_count ) ; if ( status ) { break ; } status = check_channel_equalization ( dev , dp_tx -> link_config . lane_count ) ; status = adj_vswing_preemp ( dev ) ; if ( status ) { return TS_FAILURE ; } iteration_count ++ ; } return TS_ADJUST_LINK_RATE ; } 