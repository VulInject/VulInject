static int _change_user_name ( mysql_conn_t * mysql_conn , slurmdb_user_rec_t * user ) { int rc = SLURM_SUCCESS ; char * query = NULL ; ListIterator itr = NULL ; char * cluster_name = NULL ; xassert ( user -> old_name ) ; xassert ( user -> name ) ; slurm_rwlock_rdlock ( & as_mysql_cluster_list_lock ) ; itr = list_iterator_create ( as_mysql_cluster_list ) ; while ( ( cluster_name = list_next ( itr ) ) ) { xstrfmtcat ( query , "update \"%s_%s\" set user='%s' " "where user='%s';" , cluster_name , assoc_table , user -> name , user -> old_name ) ; xstrfmtcat ( query , "update \"%s_%s\" set user='%s' " "where user='%s';" , cluster_name , wckey_table , user -> name , user -> old_name ) ; } list_iterator_destroy ( itr ) ; slurm_rwlock_unlock ( & as_mysql_cluster_list_lock ) ; xstrfmtcat ( query , "update %s set user='%s' where user='%s';" , acct_coord_table , user -> name , user -> old_name ) ; DB_DEBUG ( DB_ASSOC , mysql_conn -> conn , "query\n%s" , query ) ; rc = mysql_db_query ( mysql_conn , query ) ; if ( rc != SLURM_SUCCESS ) { reset_mysql_conn ( mysql_conn ) ; } return rc ; } 