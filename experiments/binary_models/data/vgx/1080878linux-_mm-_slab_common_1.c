void kmem_cache_destroy ( struct kmem_cache * s ) { int refcnt ; bool rcu_set ; cpus_read_lock ( ) ; mutex_lock ( & slab_mutex ) ; rcu_set = s -> flags & SLAB_TYPESAFE_BY_RCU ; refcnt = -- s -> refcount ; if ( refcnt ) { out_unlock } WARN ( shutdown_cache ( s ) , "%s %s: Slab cache still has objects when called from %pS" , __func__ , s -> name , ( void * ) _RET_IP_ ) ; out_unlock mutex_unlock ( & slab_mutex ) ; cpus_read_unlock ( ) ; if ( ! refcnt && ! rcu_set ) { kmem_cache_release ( s ) ; } } 