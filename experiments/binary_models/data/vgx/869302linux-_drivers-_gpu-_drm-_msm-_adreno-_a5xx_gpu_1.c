static int a5xx_ucode_init ( struct msm_gpu * gpu ) { struct adreno_gpu * adreno_gpu = to_adreno_gpu ( gpu ) ; struct a5xx_gpu * a5xx_gpu = to_a5xx_gpu ( adreno_gpu ) ; int ret ; if ( ! a5xx_gpu -> pm4_bo ) { a5xx_gpu -> pm4_bo = adreno_fw_create_bo ( gpu , adreno_gpu -> fw [ ADRENO_FW_PM4 ] , & a5xx_gpu -> pm4_iova ) ; if ( IS_ERR ( a5xx_gpu -> pm4_bo ) ) { ret = PTR_ERR ( a5xx_gpu -> pm4_bo ) ; DRM_DEV_ERROR ( gpu -> dev -> dev , "could not allocate PM4: %d\n" , ret ) ; return ret ; } msm_gem_object_set_name ( a5xx_gpu -> pm4_bo , "pm4fw" ) ; } if ( ! a5xx_gpu -> pfp_bo ) { a5xx_gpu -> pfp_bo = adreno_fw_create_bo ( gpu , adreno_gpu -> fw [ ADRENO_FW_PFP ] , & a5xx_gpu -> pfp_iova ) ; if ( IS_ERR ( a5xx_gpu -> pfp_bo ) ) { ret = PTR_ERR ( a5xx_gpu -> pfp_bo ) ; a5xx_gpu -> pfp_bo = NULL ; DRM_DEV_ERROR ( gpu -> dev -> dev , "could not allocate PFP: %d\n" , ret ) ; return ret ; } msm_gem_object_set_name ( a5xx_gpu -> pfp_bo , "pfpfw" ) ; a5xx_ucode_check_version ( a5xx_gpu , a5xx_gpu -> pfp_bo ) ; } gpu_write64 ( gpu , REG_A5XX_CP_ME_INSTR_BASE_LO , a5xx_gpu -> pm4_iova ) ; gpu_write64 ( gpu , REG_A5XX_CP_PFP_INSTR_BASE_LO , a5xx_gpu -> pfp_iova ) ; return 0 ; } 