main ( int argc , char * * argv ) { int c ; const char * valid_symbols ; enum demangling_styles style = auto_demangling ; program_name = argv [ 0 ] ; xmalloc_set_program_name ( program_name ) ; expandargv ( & argc , & argv ) ; while ( ( c = getopt_long ( argc , argv , "_hinps:tv" , long_options , ( int * ) 0 ) ) != EOF ) { switch ( c ) { case '?' : usage ( stderr , 1 ) ; break ; case 'h' : usage ( stdout , 0 ) ; case 'n' : strip_underscore = 0 ; break ; case 'p' : flags &= ~ DMGL_PARAMS ; break ; case 't' : flags |= DMGL_TYPES ; break ; case 'i' : flags &= ~ DMGL_VERBOSE ; break ; case 'v' : print_version ( "c++filt" ) ; return 0 ; case '_' : strip_underscore = 1 ; break ; case 's' : style = cplus_demangle_name_to_style ( optarg ) ; if ( style == unknown_demangling ) { fprintf ( stderr , "%s: unknown demangling style `%s'\n" , program_name , optarg ) ; return 1 ; } cplus_demangle_set_style ( style ) ; break ; } } if ( optind < argc ) { for ( ; optind < argc ; optind ++ ) { demangle_it ( argv [ optind ] ) ; putchar ( '\n' ) ; } return 0 ; } switch ( current_demangling_style ) { case gnu_demangling : case lucid_demangling : case arm_demangling : case java_demangling : case edg_demangling : case gnat_demangling : case gnu_v3_demangling : case auto_demangling : valid_symbols = standard_symbol_characters ( ) ; break ; case hp_demangling : valid_symbols = hp_symbol_characters ( ) ; break ; default : fatal ( "Internal error: no symbol alphabet for current style" ) ; } for ( ; ; ) { static char mbuffer [ 32767 ] ; unsigned i = 0 ; c = getchar ( ) ; while ( c != EOF && ( ISALNUM ( c ) || strchr ( valid_symbols , c ) ) ) { if ( i >= sizeof ( mbuffer ) - 1 ) { break ; } mbuffer [ i ++ ] = c ; c = getchar ( ) ; } if ( i > 0 ) { demangle_it ( mbuffer ) ; } if ( c == EOF ) { break ; } putchar ( c ) ; if ( c == '\n' ) { fflush ( stdout ) ; } } fflush ( stdout ) ; return 0 ; } 