static int vega12_setup_default_dpm_tables ( struct pp_hwmgr * hwmgr ) { struct vega12_hwmgr * data = ( vega12_hwmgr * ) ( hwmgr -> backend ) ; struct vega12_single_dpm_table * dpm_table ; int ret = 0 ; dpm_table = & ( data -> dpm_table . soc_table ) ; if ( data -> smu_features [ GNLD_DPM_SOCCLK ] . enabled ) { ret = vega12_setup_single_dpm_table ( hwmgr , dpm_table , PPCLK_SOCCLK ) ; PP_ASSERT_WITH_CODE ( , "[SetupDefaultDpmTable] failed to get socclk dpm levels!" , ) } else { dpm_table -> count = 1 ; dpm_table -> dpm_levels [ 0 ] . value = data -> vbios_boot_state . soc_clock / 100 ; } vega12_init_dpm_state ( & ( dpm_table -> dpm_state ) ) ; dpm_table = & ( data -> dpm_table . gfx_table ) ; if ( data -> smu_features [ GNLD_DPM_GFXCLK ] . enabled ) { ret = vega12_setup_single_dpm_table ( hwmgr , dpm_table , PPCLK_GFXCLK ) ; PP_ASSERT_WITH_CODE ( , "[SetupDefaultDpmTable] failed to get gfxclk dpm levels!" , ) } else { dpm_table -> count = 1 ; dpm_table -> dpm_levels [ 0 ] . value = data -> vbios_boot_state . gfx_clock / 100 ; } vega12_init_dpm_state ( & ( dpm_table -> dpm_state ) ) ; dpm_table = & ( data -> dpm_table . mem_table ) ; if ( data -> smu_features [ GNLD_DPM_UCLK ] . enabled ) { ret = vega12_setup_single_dpm_table ( hwmgr , dpm_table , PPCLK_UCLK ) ; PP_ASSERT_WITH_CODE ( , "[SetupDefaultDpmTable] failed to get memclk dpm levels!" , ) } else { dpm_table -> count = 1 ; dpm_table -> dpm_levels [ 0 ] . value = data -> vbios_boot_state . mem_clock / 100 ; } vega12_init_dpm_state ( & ( dpm_table -> dpm_state ) ) ; dpm_table = & ( data -> dpm_table . eclk_table ) ; if ( data -> smu_features [ GNLD_DPM_VCE ] . enabled ) { ret = vega12_setup_single_dpm_table ( hwmgr , dpm_table , PPCLK_ECLK ) ; PP_ASSERT_WITH_CODE ( , "[SetupDefaultDpmTable] failed to get eclk dpm levels!" , ) } else { dpm_table -> count = 1 ; dpm_table -> dpm_levels [ 0 ] . value = data -> vbios_boot_state . eclock / 100 ; } vega12_init_dpm_state ( & ( dpm_table -> dpm_state ) ) ; dpm_table = & ( data -> dpm_table . vclk_table ) ; if ( data -> smu_features [ GNLD_DPM_UVD ] . enabled ) { ret = vega12_setup_single_dpm_table ( hwmgr , dpm_table , PPCLK_VCLK ) ; PP_ASSERT_WITH_CODE ( , "[SetupDefaultDpmTable] failed to get vclk dpm levels!" , ) } else { dpm_table -> count = 1 ; dpm_table -> dpm_levels [ 0 ] . value = data -> vbios_boot_state . vclock / 100 ; } vega12_init_dpm_state ( & ( dpm_table -> dpm_state ) ) ; dpm_table = & ( data -> dpm_table . dclk_table ) ; if ( data -> smu_features [ GNLD_DPM_UVD ] . enabled ) { ret = vega12_setup_single_dpm_table ( hwmgr , dpm_table , PPCLK_DCLK ) ; PP_ASSERT_WITH_CODE ( , "[SetupDefaultDpmTable] failed to get dclk dpm levels!" , ) } else { dpm_table -> count = 1 ; dpm_table -> dpm_levels [ 0 ] . value = data -> vbios_boot_state . dclock / 100 ; } vega12_init_dpm_state ( & ( dpm_table -> dpm_state ) ) ; dpm_table = & ( data -> dpm_table . dcef_table ) ; if ( data -> smu_features [ GNLD_DPM_DCEFCLK ] . enabled ) { ret = vega12_setup_single_dpm_table ( hwmgr , dpm_table , PPCLK_DCEFCLK ) ; PP_ASSERT_WITH_CODE ( , "[SetupDefaultDpmTable] failed to get dcefclk dpm levels!" , ) } else { dpm_table -> count = 1 ; dpm_table -> dpm_levels [ 0 ] . value = data -> vbios_boot_state . dcef_clock / 100 ; } vega12_init_dpm_state ( & ( dpm_table -> dpm_state ) ) ; dpm_table = & ( data -> dpm_table . pixel_table ) ; if ( data -> smu_features [ GNLD_DPM_DCEFCLK ] . enabled ) { ret = vega12_setup_single_dpm_table ( hwmgr , dpm_table , PPCLK_PIXCLK ) ; PP_ASSERT_WITH_CODE ( , "[SetupDefaultDpmTable] failed to get pixclk dpm levels!" , ) } else { dpm_table -> count = 0 ; } vega12_init_dpm_state ( & ( dpm_table -> dpm_state ) ) ; dpm_table = & ( data -> dpm_table . display_table ) ; if ( data -> smu_features [ GNLD_DPM_DCEFCLK ] . enabled ) { ret = vega12_setup_single_dpm_table ( hwmgr , dpm_table , PPCLK_DISPCLK ) ; PP_ASSERT_WITH_CODE ( , "[SetupDefaultDpmTable] failed to get dispclk dpm levels!" , ) } else { dpm_table -> count = 0 ; } vega12_init_dpm_state ( & ( dpm_table -> dpm_state ) ) ; dpm_table = & ( data -> dpm_table . phy_table ) ; if ( data -> smu_features [ GNLD_DPM_DCEFCLK ] . enabled ) { ret = vega12_setup_single_dpm_table ( hwmgr , dpm_table , PPCLK_PHYCLK ) ; PP_ASSERT_WITH_CODE ( , "[SetupDefaultDpmTable] failed to get phyclk dpm levels!" , ) } else { dpm_table -> count = 0 ; } vega12_init_dpm_state ( & ( dpm_table -> dpm_state ) ) ; memcpy ( & ( data -> golden_dpm_table ) , & ( data -> dpm_table ) , sizeof ( vega12_dpm_table ) ) ; return 0 ; } 