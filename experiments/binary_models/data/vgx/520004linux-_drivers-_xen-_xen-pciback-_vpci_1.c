static void __xen_pcibk_release_devices ( struct xen_pcibk_device * pdev ) { int slot ; struct vpci_dev_data * vpci_dev = pdev -> pci_dev_data ; for ( slot = 0 ; slot < PCI_SLOT_MAX ; slot ++ ) { struct pci_dev_entry * e , * tmp ; list_for_each_entry_safe ( , , , ) { struct pci_dev * dev = e -> dev ; list_del ( & e -> list ) ; device_lock ( & dev -> dev ) ; pcistub_put_pci_dev ( dev ) ; device_unlock ( & dev -> dev ) ; } } kfree ( vpci_dev ) ; pdev -> pci_dev_data = NULL ; } 