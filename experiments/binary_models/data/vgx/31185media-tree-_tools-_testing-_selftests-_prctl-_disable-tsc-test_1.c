int main ( void ) { int tsc_val = 0 ; signal ( SIGSEGV , sigsegv_cb ) ; printf ( "rdtsc() == %llu\n" , ( unsigned long long ) rdtsc ( ) ) ; printf ( "prctl(PR_GET_TSC,&tsc_val); " ) ; fflush ( stdout , NULL ) ; if ( prctl ( PR_GET_TSC , & tsc_val ) == - 1 ) { perror ( "prctl" ) ; } printf ( "tsc_val == %s\n" , tsc_names [ tsc_val ] ) ; printf ( "rdtsc() == %llu\n" , ( unsigned long long ) rdtsc ( ) ) ; printf ( "prctl(PR_SET_TSC, PR_TSC_ENABLE)\n" ) ; fflush ( stdout ) ; if ( prctl ( PR_SET_TSC , PR_TSC_ENABLE ) == - 1 ) { perror ( "prctl" ) ; } printf ( "rdtsc() == %llu\n" , ( unsigned long long ) rdtsc ( ) ) ; printf ( "prctl(PR_SET_TSC, PR_TSC_SIGSEGV)\n" ) ; fflush ( stdout ) ; if ( prctl ( PR_SET_TSC , PR_TSC_SIGSEGV ) == - 1 ) { perror ( "prctl" ) ; } printf ( "rdtsc() == " ) ; fflush ( stdout ) ; printf ( "%llu\n" , ( unsigned long long ) rdtsc ( ) ) ; fflush ( stdout ) ; exit ( EXIT_SUCCESS ) ; } 