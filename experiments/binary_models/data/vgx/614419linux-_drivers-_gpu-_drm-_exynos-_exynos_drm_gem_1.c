static struct exynos_drm_gem * exynos_drm_gem_init ( struct drm_device * dev , unsigned long size ) { struct exynos_drm_gem * exynos_gem ; struct drm_gem_object * obj ; int ret ; exynos_gem = kmalloc ( sizeof ( * exynos_gem ) , GFP_KERNEL ) ; if ( ! exynos_gem ) { return ERR_PTR ( - ENOMEM ) ; } exynos_gem -> size = size ; obj = & exynos_gem -> base ; obj -> funcs = & exynos_drm_gem_object_funcs ; ret = drm_gem_object_init ( dev , obj , size ) ; if ( ret < 0 ) { DRM_DEV_ERROR ( dev -> dev , "failed to initialize gem object\n" ) ; kfree ( exynos_gem ) ; return ERR_PTR ( ret ) ; } ret = drm_gem_create_mmap_offset ( obj ) ; if ( ret < 0 ) { drm_gem_object_release ( obj ) ; kfree ( exynos_gem ) ; return ERR_PTR ( ret ) ; } DRM_DEV_DEBUG_KMS ( dev -> dev , "created file object = %pK\n" , obj -> filp ) ; return exynos_gem ; } 