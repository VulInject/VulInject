static void emac_tx_q_descs_free ( struct emac_adapter * adpt ) { struct emac_tx_queue * tx_q = & adpt -> tx_q ; unsigned int i ; size_t size ; if ( ! tx_q -> tpd . tpbuff ) { return ; } for ( i = 0 ; i < tx_q -> tpd . count ; i ++ ) { struct emac_buffer * tpbuf = GET_TPD_BUFFER ( tx_q , i ) ; if ( tpbuf -> dma_addr ) { dma_unmap_single ( adpt -> netdev -> dev . parent , tpbuf -> dma_addr , tpbuf -> length , DMA_TO_DEVICE ) ; tpbuf -> dma_addr = 0 ; } if ( tpbuf -> skb ) { tpbuf -> skb = NULL ; } } size = sizeof ( emac_buffer ) * tx_q -> tpd . count ; memset ( tx_q -> tpd . tpbuff , 0 , size ) ; memset ( tx_q -> tpd . v_addr , 0 , tx_q -> tpd . size ) ; tx_q -> tpd . consume_idx = 0 ; tx_q -> tpd . produce_idx = 0 ; } 