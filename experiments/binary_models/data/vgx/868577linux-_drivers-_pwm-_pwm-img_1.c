static int img_pwm_resume ( struct device * dev ) { struct img_pwm_chip * imgchip = dev_get_drvdata ( dev ) ; int ret ; int i ; ret = img_pwm_runtime_resume ( dev ) ; for ( i = 0 ; i < imgchip -> chip . npwm ; i ++ ) { img_pwm_writel ( imgchip , PWM_CH_CFG ( i ) , imgchip -> suspend_ch_cfg [ i ] ) ; } img_pwm_writel ( imgchip , PWM_CTRL_CFG , imgchip -> suspend_ctrl_cfg ) ; for ( i = 0 ; i < imgchip -> chip . npwm ; i ++ ) { if ( imgchip -> suspend_ctrl_cfg & BIT ( i ) ) { regmap_clear_bits ( imgchip -> periph_regs , PERIP_PWM_PDM_CONTROL , PERIP_PWM_PDM_CONTROL_CH_MASK << PERIP_PWM_PDM_CONTROL_CH_SHIFT ( i ) ) ; } } if ( pm_runtime_status_suspended ( dev ) ) { img_pwm_runtime_suspend ( dev ) ; } return 0 ; } 