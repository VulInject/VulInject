static int ps3vram_notifier_wait ( struct ps3_system_bus_device * dev , unsigned int timeout_ms ) { struct ps3vram_priv * priv = ps3_system_bus_get_drvdata ( dev ) ; u32 __iomem * notify = ps3vram_get_notifier ( priv -> reports , NOTIFIER ) ; cfs_time_t timeout ; for ( timeout = 20 ; timeout ; timeout -- ) { if ( ! ioread32be ( notify + 3 ) ) { return 0 ; } udelay ( 10 ) ; } timeout = jiffies + msecs_to_jiffies ( timeout_ms ) ; { if ( ! ioread32be ( notify + 3 ) ) { return 0 ; } msleep ( 1 ) ; } time_before ( jiffies , timeout ) ; return - ETIMEDOUT ; } 