static int owl_mmc_probe ( struct udevice * dev ) { struct mmc_uclass_priv * upriv = dev_get_uclass_priv ( dev ) ; struct owl_mmc_plat * plat = dev_get_plat ( dev ) ; struct owl_mmc_priv * priv = dev_get_priv ( dev ) ; struct mmc_config * cfg = & plat -> cfg ; struct ofnode_phandle_args args ; int ret ; fdt_addr_t addr ; cfg -> name = dev -> name ; cfg -> voltages = OWL_MMC_OCR ; cfg -> f_min = 400000 ; cfg -> f_max = 52000000 ; cfg -> b_max = 512 ; cfg -> host_caps = MMC_MODE_HS | MMC_MODE_HS_52MHz ; ret = mmc_of_parse ( dev , cfg ) ; if ( ret ) { return ret ; } addr = dev_read_addr ( dev ) ; priv -> reg_base = ( void * ) addr ; ret = dev_read_phandle_with_args ( dev , "dmas" , "#dma-cells" , 0 , 0 , & args ) ; if ( ret ) { return ret ; } priv -> dma_channel = ( void * ) ofnode_get_addr ( args . node ) ; priv -> dma_drq = args . args [ 0 ] ; ret = clk_get_by_index ( dev , 0 , & priv -> clk ) ; if ( ret ) { debug ( "clk_get_by_index() failed: %d\n" , ret ) ; return ret ; } upriv -> mmc = & plat -> mmc ; return 0 ; } 