static inline int fai_add_entry ( struct addrinfo * * result , void * addr , int port , const struct addrinfo * , template ) { struct addrinfo * n = malloc ( sizeof ( addrinfo ) ) ; if ( n == 0 ) { return EAI_MEMORY ; } if ( -> ai_family != AF_INET && ) ai_family return EAI_FAMILY ; * n = * ; if ( -> ai_family == AF_INET ) { struct sockaddr_in * sin4 ; sin4 = malloc ( sizeof ( sockaddr_in ) ) ; if ( sin4 == 0 ) { return EAI_MEMORY ; } n -> ai_addr = ( sockaddr * ) sin4 ; sin4 -> sin_family = AF_INET ; sin4 -> sin_addr = * ( in_addr * ) addr ; sin4 -> sin_port = port ; } if ( -> ai_family == AF_INET6 ) { struct sockaddr_in6 * sin6 ; sin6 = malloc ( sizeof ( sockaddr_in6 ) ) ; if ( sin6 == 0 ) { return EAI_MEMORY ; } memset ( sin6 , 0 , sizeof ( sockaddr_in6 ) ) ; n -> ai_addr = ( sockaddr * ) sin6 ; sin6 -> sin6_family = AF_INET6 ; sin6 -> sin6_addr = * ( in6_addr * ) addr ; sin6 -> sin6_port = port ; } n -> ai_next = * result ; * result = n ; return 0 ; } 