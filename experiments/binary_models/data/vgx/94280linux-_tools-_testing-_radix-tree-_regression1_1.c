void regression1_test ( void ) { int nr_threads ; int i ; long arg ; printv ( 1 , "running regression test 1, should finish in under a minute\n" ) ; nr_threads = 2 ; pthread_barrier_init ( & worker_barrier , NULL , nr_threads ) ; threads = malloc ( nr_threads * sizeof ( pthread_t * ) ) ; for ( i = 0 ; i < nr_threads ; i ++ ) { arg = i ; if ( pthread_create ( & threads [ i ] , NULL , regression1_fn , ( void * ) arg ) ) { perror ( "pthread_create" ) ; exit ( 1 ) ; } } for ( i = 0 ; i < nr_threads ; i ++ ) { if ( pthread_join ( threads [ i ] , NULL ) ) { perror ( "pthread_join" ) ; exit ( 1 ) ; } } printv ( 1 , "regression test 1, done\n" ) ; } 