static int vnt_int_report_rate ( struct vnt_private * priv , u8 pkt_no , u8 tsr ) { struct vnt_usb_send_context * context ; struct ieee80211_tx_info * info ; struct ieee80211_rate * rate ; u8 tx_retry = ( tsr & 0xf0 ) >> 4 ; s8 idx ; if ( pkt_no >= priv -> num_tx_context ) { return - EINVAL ; } context = priv -> tx_context [ pkt_no ] ; info = IEEE80211_SKB_CB ( context -> skb ) ; idx = info -> control . rates [ 0 ] . idx ; if ( context -> fb_option && ! ( tsr & ( TSR_TMO | TSR_RETRYTMO ) ) ) { u8 tx_rate ; u8 retry = tx_retry ; rate = ieee80211_get_tx_rate ( priv -> hw , info ) ; tx_rate = rate -> hw_value - RATE_18M ; if ( retry > 4 ) { retry = 4 ; } if ( context -> fb_option == AUTO_FB_0 ) { tx_rate = fallback_rate0 [ tx_rate ] [ retry ] ; } if ( context -> fb_option == AUTO_FB_1 ) { tx_rate = fallback_rate1 [ tx_rate ] [ retry ] ; } if ( info -> band == NL80211_BAND_5GHZ ) { idx = tx_rate - RATE_6M ; } else { idx = tx_rate ; } } ieee80211_tx_info_clear_status ( info ) ; info -> status . rates [ 0 ] . count = tx_retry ; if ( ! ( tsr & ( TSR_TMO | TSR_RETRYTMO ) ) ) { info -> status . rates [ 0 ] . idx = idx ; info -> flags |= IEEE80211_TX_STAT_ACK ; } ieee80211_tx_status_irqsafe ( priv -> hw , context -> skb ) ; context -> in_use = false ; return 0 ; } 