static int slip_open ( void * data ) { struct slip_data * pri = data ; char version_buf [ sizeof ( "nnnnn\0" ) ] ; char gate_buf [ sizeof ( "nnn.nnn.nnn.nnn\0" ) ] ; char * argv [ ] { "uml_net" version_buf "slip" "up" gate_buf NULL } ; ; int sfd , mfd , err ; err = get_pty ( ) ; if ( err < 0 ) { printk ( UM_KERN_ERR "slip-open : Failed to open pty, err = %d\n" , - err ) ; out } mfd = err ; err = open ( ptsname ( mfd ) , O_RDWR , 0 ) ; if ( err < 0 ) { printk ( UM_KERN_ERR "Couldn't open tty for slip line, " "err = %d\n" , - err ) ; out_close } sfd = err ; err = set_up_tty ( sfd ) ; if ( err ) { out_close2 } pri -> slave = sfd ; pri -> slip . esc = 0 ; if ( pri -> gate_addr != NULL ) { sprintf ( version_buf , "%d" , UML_NET_VERSION ) ; strcpy ( gate_buf , pri -> gate_addr ) ; err = slip_tramp ( argv , sfd ) ; if ( err < 0 ) { printk ( UM_KERN_ERR "slip_tramp failed - err = %d\n" , - err ) ; out_close2 } err = os_get_ifname ( pri -> slave , pri -> name ) ; if ( err < 0 ) { printk ( UM_KERN_ERR "get_ifname failed, err = %d\n" , - err ) ; out_close2 } iter_addresses ( pri -> dev , open_addr , pri -> name ) ; } else { err = os_set_slip ( sfd ) ; if ( err < 0 ) { printk ( UM_KERN_ERR "Failed to set slip discipline " "encapsulation - err = %d\n" , - err ) ; out_close2 } } return mfd ; out_close2 close ( sfd ) ; out_close close ( mfd ) ; out return err ; } 