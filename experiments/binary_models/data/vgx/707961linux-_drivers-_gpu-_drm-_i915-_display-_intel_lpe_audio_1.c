void intel_lpe_audio_notify ( struct drm_i915_private * dev_priv , enum pipe pipe , enum port port , const void * eld , int ls_clock , bool dp_output ) { unsigned long irqflags ; struct intel_hdmi_lpe_audio_pdata * pdata ; struct intel_hdmi_lpe_audio_port_pdata * ppdata ; u32 audio_enable ; if ( ! HAS_LPE_AUDIO ( dev_priv ) ) { return ; } pdata = dev_get_platdata ( & dev_priv -> display . audio . lpe . platdev -> dev ) ; ppdata = & pdata -> port [ port - PORT_B ] ; spin_lock_irqsave ( & pdata -> lpe_audio_slock , irqflags ) ; audio_enable = intel_de_read ( dev_priv , VLV_AUD_PORT_EN_DBG ( port ) ) ; if ( eld != NULL ) { memcpy ( ppdata -> eld , eld , HDMI_MAX_ELD_BYTES ) ; ppdata -> pipe = pipe ; ppdata -> ls_clock = ls_clock ; ppdata -> dp_output = dp_output ; intel_de_write ( dev_priv , VLV_AUD_PORT_EN_DBG ( port ) , audio_enable & ~ VLV_AMP_MUTE ) ; } else { ppdata -> pipe = - 1 ; ppdata -> ls_clock = 0 ; ppdata -> dp_output = false ; intel_de_write ( dev_priv , VLV_AUD_PORT_EN_DBG ( port ) , audio_enable | VLV_AMP_MUTE ) ; } if ( pdata -> notify_audio_lpe ) { pdata -> notify_audio_lpe ( dev_priv -> display . audio . lpe . platdev , port - PORT_B ) ; } spin_unlock_irqrestore ( & pdata -> lpe_audio_slock , irqflags ) ; } 