int arch_dup_task_struct ( struct task_struct * dst , struct task_struct * src ) { if ( current -> mm ) { fpsimd_preserve_current_state ( ) ; } * dst = * src ; BUILD_BUG_ON ( ! IS_ENABLED ( CONFIG_THREAD_INFO_IN_TASK ) ) ; dst -> thread . sve_state = NULL ; clear_tsk_thread_flag ( dst , TIF_SVE ) ; if ( thread_za_enabled ( & src -> thread ) ) { dst -> thread . sve_state = kzalloc ( sve_state_size ( src ) , GFP_KERNEL ) ; dst -> thread . sme_state = kmemdup ( src -> thread . sme_state , sme_state_size ( src ) , GFP_KERNEL ) ; if ( ! dst -> thread . sme_state ) { kfree ( dst -> thread . sve_state ) ; dst -> thread . sve_state = NULL ; return - ENOMEM ; } } else { dst -> thread . sme_state = NULL ; clear_tsk_thread_flag ( dst , TIF_SME ) ; } dst -> thread . fp_type = FP_STATE_FPSIMD ; clear_tsk_thread_flag ( dst , TIF_MTE_ASYNC_FAULT ) ; return 0 ; } 