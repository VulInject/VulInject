int do_close ( struct sftp_conn * conn , const u_char * handle , u_int handle_len ) { u_int id , status ; struct sshbuf * msg ; int r ; if ( ( msg = sshbuf_new ( ) ) == NULL ) { fatal_f ( "sshbuf_new failed" ) ; } id = conn -> msg_id ++ ; if ( ( r = sshbuf_put_u8 ( msg , SSH2_FXP_CLOSE ) ) != 0 || ( r = sshbuf_put_u32 ( msg , id ) ) != 0 || ( r = sshbuf_put_string ( msg , handle , handle_len ) ) != 0 ) { fatal_fr ( r , "parse" ) ; } send_msg ( conn , msg ) ; debug3 ( "Sent message SSH2_FXP_CLOSE I:%u" , id ) ; status = get_status ( conn , id ) ; if ( status != SSH2_FX_OK ) { error ( "close remote: %s" , fx2txt ( status ) ) ; } return status == SSH2_FX_OK ?0 : - 1 ; } 