static uint32_t ql_get_basedev_len ( ql_adapter_state_t * ha , uint32_t * basedev_len , uint32_t * port_index ) { int dev_off ; int32_t port_off ; int8_t * devstr ; QL_PRINT_3 ( CE_CONT , "(%d): started\n" , ha -> instance ) ; if ( ha -> devpath == NULL ) { return ( ( uint32_t ) - 1 ) ; } dev_off = ( int32_t ) ( strlen ( ha -> devpath ) - 1 ) ; port_off = - 1 ; while ( ( dev_off >= 0 ) && ( ha -> devpath [ dev_off ] != '@' ) ) { if ( ha -> devpath [ dev_off ] == ',' ) { port_off = dev_off + 1 ; } dev_off -- ; } if ( dev_off < 0 ) { EL ( ha , "Invalid device path '%s'. Cannot get basedev\n" , ha -> devpath ) ; return ( ( uint32_t ) - 1 ) ; } if ( port_off == - 1 ) { * port_index = 0 ; * basedev_len = ( uint32_t ) strlen ( ha -> devpath ) ; } else { devstr = ha -> devpath + port_off ; * port_index = stoi ( & devstr ) ; if ( * port_index == 0 ) { EL ( ha , "Invalid device path '%s'. Cannot get " "port_index\n" , ha -> devpath ) ; return ( ( uint32_t ) - 1 ) ; } * basedev_len = ( uint32_t ) ( port_off - 1 ) ; } QL_PRINT_3 ( CE_CONT , "(%d): done\n" , ha -> instance ) ; return ( 0 ) ; } 