static int mtty_get_region_info ( struct mdev_state * mdev_state , struct vfio_region_info * region_info , u16 * cap_type_id , void * * cap_type ) { int size = 0 ; u32 bar_index ; bar_index = region_info -> index ; if ( bar_index >= VFIO_PCI_NUM_REGIONS ) { return - EINVAL ; } mutex_lock ( & mdev_state -> ops_lock ) ; switch ( bar_index ) { case VFIO_PCI_CONFIG_REGION_INDEX : size = MTTY_CONFIG_SPACE_SIZE ; break ; case VFIO_PCI_BAR0_REGION_INDEX : size = MTTY_IO_BAR_SIZE ; break ; case VFIO_PCI_BAR1_REGION_INDEX : if ( mdev_state -> nr_ports == 2 ) { size = MTTY_IO_BAR_SIZE ; } break ; default : size = 0 ; break ; } mdev_state -> region_info [ bar_index ] . size = size ; mdev_state -> region_info [ bar_index ] . vfio_offset = MTTY_VFIO_PCI_INDEX_TO_OFFSET ( bar_index ) ; region_info -> size = size ; region_info -> offset = MTTY_VFIO_PCI_INDEX_TO_OFFSET ( bar_index ) ; region_info -> flags = VFIO_REGION_INFO_FLAG_READ | VFIO_REGION_INFO_FLAG_WRITE ; mutex_unlock ( & mdev_state -> ops_lock ) ; return 0 ; } 