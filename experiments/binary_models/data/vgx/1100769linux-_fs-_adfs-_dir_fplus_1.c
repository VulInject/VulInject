static int adfs_fplus_getnext ( struct adfs_dir * dir , struct object_info * obj ) { struct adfs_bigdirheader * h = dir -> bighead ; struct adfs_bigdirentry bde ; int offset ; int ret ; if ( dir -> pos >= le32_to_cpu ( h -> bigdirentries ) ) { return - ENOENT ; } offset = adfs_fplus_offset ( h , dir -> pos ) ; ret = adfs_dir_copyfrom ( & bde , dir , offset , sizeof ( adfs_bigdirentry ) ) ; if ( ret ) { return ret ; } obj -> loadaddr = le32_to_cpu ( bde . bigdirload ) ; obj -> execaddr = le32_to_cpu ( bde . bigdirexec ) ; obj -> size = le32_to_cpu ( bde . bigdirlen ) ; obj -> indaddr = le32_to_cpu ( bde . bigdirindaddr ) ; obj -> attr = le32_to_cpu ( bde . bigdirattr ) ; obj -> name_len = le32_to_cpu ( bde . bigdirobnamelen ) ; offset = adfs_fplus_offset ( h , le32_to_cpu ( h -> bigdirentries ) ) ; offset += le32_to_cpu ( bde . bigdirobnameptr ) ; ret = adfs_dir_copyfrom ( obj -> name , dir , offset , obj -> name_len ) ; if ( ret ) { return ret ; } adfs_object_fixup ( dir , obj ) ; dir -> pos += 1 ; return 0 ; } 