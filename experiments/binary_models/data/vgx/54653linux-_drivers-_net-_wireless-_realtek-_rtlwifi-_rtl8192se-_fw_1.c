static bool _rtl92s_firmware_set_h2c_cmd ( struct ieee80211_hw * hw , u8 h2c_cmd , u8 * pcmd_buffer ) { struct rtl_priv * rtlpriv = rtl_priv ( hw ) ; struct rtl_hal * rtlhal = rtl_hal ( rtl_priv ( hw ) ) ; struct rtl_tcb_desc * cb_desc ; struct sk_buff * skb ; u32 element_id = 0 ; u32 cmd_len = 0 ; u32 len ; switch ( h2c_cmd ) { case FW_H2C_SETPWRMODE : element_id = H2C_SETPWRMODE_CMD ; cmd_len = sizeof ( h2c_set_pwrmode_parm ) ; break ; case FW_H2C_JOINBSSRPT : element_id = H2C_JOINBSSRPT_CMD ; cmd_len = sizeof ( h2c_joinbss_rpt_parm ) ; break ; case FW_H2C_WOWLAN_UPDATE_GTK : element_id = H2C_WOWLAN_UPDATE_GTK_CMD ; cmd_len = sizeof ( h2c_wpa_two_way_parm ) ; break ; case FW_H2C_WOWLAN_UPDATE_IV : element_id = H2C_WOWLAN_UPDATE_IV_CMD ; cmd_len = ( unsigned long long ) ; break ; case FW_H2C_WOWLAN_OFFLOAD : element_id = H2C_WOWLAN_FW_OFFLOAD ; cmd_len = sizeof ( u8 ) ; break ; default : break ; } len = _rtl92s_get_h2c_cmdlen ( MAX_TRANSMIT_BUFFER_SIZE , 1 , & cmd_len ) ; skb = dev_alloc_skb ( len ) ; cb_desc = ( rtl_tcb_desc * ) ( skb -> cb ) ; cb_desc -> queue_index = TXCMD_QUEUE ; cb_desc -> cmd_or_init = DESC_PACKET_TYPE_NORMAL ; cb_desc -> last_inipkt = false ; _rtl92s_fill_h2c_cmd ( skb , MAX_TRANSMIT_BUFFER_SIZE , 1 , & element_id , & cmd_len , & pcmd_buffer , & rtlhal -> h2c_txcmd_seq ) ; _rtl92s_cmd_send_packet ( hw , skb , false ) ; rtlpriv -> cfg -> ops -> tx_polling ( hw , TXCMD_QUEUE ) ; return true ; } 