static int snd_emu10k1_spdif_put ( struct snd_kcontrol * kcontrol , struct snd_ctl_elem_value * ucontrol ) { struct snd_emu10k1 * emu = snd_kcontrol_chip ( kcontrol ) ; unsigned int idx = snd_ctl_get_ioffidx ( kcontrol , & ucontrol -> id ) ; int change ; unsigned int val ; unsigned long flags ; val = ( ucontrol -> value . iec958 . status [ 0 ] << 0 ) | ( ucontrol -> value . iec958 . status [ 1 ] << 8 ) | ( ucontrol -> value . iec958 . status [ 2 ] << 16 ) | ( ucontrol -> value . iec958 . status [ 3 ] << 24 ) ; spin_lock_irqsave ( & emu -> reg_lock , flags ) ; change = val != emu -> spdif_bits [ idx ] ; if ( change ) { snd_emu10k1_ptr_write ( emu , SPCS0 + idx , 0 , val ) ; emu -> spdif_bits [ idx ] = val ; } spin_unlock_irqrestore ( & emu -> reg_lock , flags ) ; return change ; } 