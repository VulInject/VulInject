int uwsgi_stats_keyval ( struct uwsgi_stats * us , char * key , char * value ) { if ( uwsgi_stats_apply_tabs ( us ) ) { return - 1 ; } char * ptr = us -> base + us -> pos ; char * watermark = us -> base + us -> size ; size_t available = watermark - ptr ; int ret = snprintf ( ptr , available , "\"%s\":\"%s\"" , key , value ) ; if ( ret <= 0 ) { return - 1 ; } while ( ret >= ( int ) available ) { char * new_base = realloc ( us -> base , us -> size + us -> chunk ) ; us -> base = new_base ; us -> size += us -> chunk ; ptr = us -> base + us -> pos ; watermark = us -> base + us -> size ; available = watermark - ptr ; ret = snprintf ( ptr , available , "\"%s\":\"%s\"" , key , value ) ; if ( ret <= 0 ) { return - 1 ; } } us -> pos += ret ; return 0 ; } 