static void TestNormCoverage ( ) { UChar input [ 1000 ] , expect [ 1000 ] , output [ 1000 ] ; UErrorCode errorCode ; int32_t i , length , inLength , expectLength , hangulPrefixLength , preflightLength ; inLength = 0 ; input [ inLength ++ ] = HANGUL_KIYEOK ; input [ inLength ++ ] = HANGUL_WEO ; input [ inLength ++ ] = HANGUL_KIYEOK_SIOS ; input [ inLength ++ ] = HANGUL_KIYEOK ; input [ inLength ++ ] = HANGUL_WEO ; input [ inLength ++ ] = HANGUL_K_KIYEOK_SIOS ; input [ inLength ++ ] = HANGUL_KIYEOK ; input [ inLength ++ ] = HANGUL_K_WEO ; input [ inLength ++ ] = HANGUL_KIYEOK_SIOS ; input [ inLength ++ ] = HANGUL_KIYEOK ; input [ inLength ++ ] = HANGUL_K_WEO ; input [ inLength ++ ] = HANGUL_K_KIYEOK_SIOS ; input [ inLength ++ ] = HANGUL_K_KIYEOK ; input [ inLength ++ ] = HANGUL_WEO ; input [ inLength ++ ] = HANGUL_KIYEOK_SIOS ; input [ inLength ++ ] = HANGUL_K_KIYEOK ; input [ inLength ++ ] = HANGUL_WEO ; input [ inLength ++ ] = HANGUL_K_KIYEOK_SIOS ; input [ inLength ++ ] = HANGUL_K_KIYEOK ; input [ inLength ++ ] = HANGUL_K_WEO ; input [ inLength ++ ] = HANGUL_KIYEOK_SIOS ; input [ inLength ++ ] = HANGUL_K_KIYEOK ; input [ inLength ++ ] = HANGUL_K_WEO ; input [ inLength ++ ] = HANGUL_K_KIYEOK_SIOS ; input [ inLength ++ ] = HANGUL_AC00 ; input [ inLength ++ ] = HANGUL_KIYEOK_SIOS ; input [ inLength ++ ] = HANGUL_AC00 ; input [ inLength ++ ] = HANGUL_K_KIYEOK_SIOS ; input [ inLength ++ ] = HANGUL_K_KIYEOK ; input [ inLength ++ ] = HANGUL_K_WEO ; hangulPrefixLength = inLength ; input [ inLength ++ ] = U16_LEAD ( MUSICAL_HALF_NOTE ) ; input [ inLength ++ ] = U16_TRAIL ( MUSICAL_HALF_NOTE ) ; for ( i = 0 ; i < 200 ; ++ i ) { input [ inLength ++ ] = U16_LEAD ( MUSICAL_STACCATO ) ; input [ inLength ++ ] = U16_TRAIL ( MUSICAL_STACCATO ) ; input [ inLength ++ ] = U16_LEAD ( MUSICAL_STEM ) ; input [ inLength ++ ] = U16_TRAIL ( MUSICAL_STEM ) ; } input [ inLength ++ ] = HANGUL_K_KIYEOK ; input [ inLength ++ ] = HANGUL_K_KIYEOK_SIOS ; if ( UNORM_NO != unorm_quickCheck ( input , inLength , UNORM_NFD , & errorCode ) || U_FAILURE ( errorCode ) ) { log_data_err ( "error unorm_quickCheck(long input, UNORM_NFD)!=NO (%s) - (Are you missing data?)\n" , u_errorName ( errorCode ) ) ; } errorCode = U_ZERO_ERROR ; if ( UNORM_NO != unorm_quickCheck ( input , inLength , UNORM_NFKD , & errorCode ) || U_FAILURE ( errorCode ) ) { log_data_err ( "error unorm_quickCheck(long input, UNORM_NFKD)!=NO (%s) - (Are you missing data?)\n" , u_errorName ( errorCode ) ) ; } errorCode = U_ZERO_ERROR ; if ( UNORM_NO != unorm_quickCheck ( input , inLength , UNORM_NFC , & errorCode ) || U_FAILURE ( errorCode ) ) { log_data_err ( "error unorm_quickCheck(long input, UNORM_NFC)!=NO (%s) - (Are you missing data?)\n" , u_errorName ( errorCode ) ) ; } errorCode = U_ZERO_ERROR ; if ( UNORM_NO != unorm_quickCheck ( input , inLength , UNORM_NFKC , & errorCode ) || U_FAILURE ( errorCode ) ) { log_data_err ( "error unorm_quickCheck(long input, UNORM_NFKC)!=NO (%s) - (Are you missing data?)\n" , u_errorName ( errorCode ) ) ; } errorCode = U_ZERO_ERROR ; if ( UNORM_NO != unorm_quickCheck ( input , inLength , UNORM_FCD , & errorCode ) || U_FAILURE ( errorCode ) ) { log_data_err ( "error unorm_quickCheck(long input, UNORM_FCD)!=NO (%s) - (Are you missing data?)\n" , u_errorName ( errorCode ) ) ; } expectLength = 0 ; expect [ expectLength ++ ] = HANGUL_SYLLABLE ; expect [ expectLength ++ ] = HANGUL_SYLLABLE ; expect [ expectLength ++ ] = HANGUL_SYLLABLE ; expect [ expectLength ++ ] = HANGUL_SYLLABLE ; expect [ expectLength ++ ] = HANGUL_SYLLABLE ; expect [ expectLength ++ ] = HANGUL_SYLLABLE ; expect [ expectLength ++ ] = HANGUL_SYLLABLE ; expect [ expectLength ++ ] = HANGUL_SYLLABLE ; expect [ expectLength ++ ] = HANGUL_AC00 + 3 ; expect [ expectLength ++ ] = HANGUL_AC00 + 3 ; expect [ expectLength ++ ] = HANGUL_AC00 + 14 * 28 ; expect [ expectLength ++ ] = U16_LEAD ( MUSICAL_VOID_NOTEHEAD ) ; expect [ expectLength ++ ] = U16_TRAIL ( MUSICAL_VOID_NOTEHEAD ) ; expect [ expectLength ++ ] = U16_LEAD ( MUSICAL_STEM ) ; expect [ expectLength ++ ] = U16_TRAIL ( MUSICAL_STEM ) ; for ( i = 0 ; i < 200 ; ++ i ) { expect [ expectLength ++ ] = U16_LEAD ( MUSICAL_STEM ) ; expect [ expectLength ++ ] = U16_TRAIL ( MUSICAL_STEM ) ; } for ( i = 0 ; i < 200 ; ++ i ) { expect [ expectLength ++ ] = U16_LEAD ( MUSICAL_STACCATO ) ; expect [ expectLength ++ ] = U16_TRAIL ( MUSICAL_STACCATO ) ; } expect [ expectLength ++ ] = HANGUL_KIYEOK ; expect [ expectLength ++ ] = HANGUL_KIYEOK_SIOS ; errorCode = U_ZERO_ERROR ; preflightLength = unorm_normalize ( input , inLength , UNORM_NFKC , 0 , output , 100 , & errorCode ) ; if ( errorCode != U_BUFFER_OVERFLOW_ERROR ) { log_data_err ( "error unorm_normalize(long input, output too short, UNORM_NFKC) did not overflow but %s - (Are you missing data?)\n" , u_errorName ( errorCode ) ) ; } errorCode = U_ZERO_ERROR ; length = unorm_normalize ( input , inLength , UNORM_NFKC , 0 , output , UPRV_LENGTHOF ( output ) , & errorCode ) ; if ( U_FAILURE ( errorCode ) ) { log_data_err ( "error unorm_normalize(long input, UNORM_NFKC) failed with %s - (Are you missing data?)\n" , u_errorName ( errorCode ) ) ; } if ( length != expectLength || u_memcmp ( output , expect , length ) != 0 ) { log_err ( "error unorm_normalize(long input, UNORM_NFKC) produced wrong result\n" ) ; for ( i = 0 ; i < length ; ++ i ) { if ( output [ i ] != expect [ i ] ) { log_err ( "    NFKC[%d]==U+%04lx expected U+%04lx\n" , i , output [ i ] , expect [ i ] ) ; break ; } } } if ( length != preflightLength ) { log_err ( "error unorm_normalize(long input, UNORM_NFKC)==%ld but preflightLength==%ld\n" , length , preflightLength ) ; } u_memcpy ( expect , input , hangulPrefixLength ) ; expectLength = hangulPrefixLength ; expect [ expectLength ++ ] = U16_LEAD ( MUSICAL_VOID_NOTEHEAD ) ; expect [ expectLength ++ ] = U16_TRAIL ( MUSICAL_VOID_NOTEHEAD ) ; expect [ expectLength ++ ] = U16_LEAD ( MUSICAL_STEM ) ; expect [ expectLength ++ ] = U16_TRAIL ( MUSICAL_STEM ) ; for ( i = 0 ; i < 200 ; ++ i ) { expect [ expectLength ++ ] = U16_LEAD ( MUSICAL_STEM ) ; expect [ expectLength ++ ] = U16_TRAIL ( MUSICAL_STEM ) ; } for ( i = 0 ; i < 200 ; ++ i ) { expect [ expectLength ++ ] = U16_LEAD ( MUSICAL_STACCATO ) ; expect [ expectLength ++ ] = U16_TRAIL ( MUSICAL_STACCATO ) ; } expect [ expectLength ++ ] = HANGUL_K_KIYEOK ; expect [ expectLength ++ ] = HANGUL_K_KIYEOK_SIOS ; errorCode = U_ZERO_ERROR ; length = unorm_normalize ( input , inLength , UNORM_FCD , 0 , output , UPRV_LENGTHOF ( output ) , & errorCode ) ; if ( U_FAILURE ( errorCode ) ) { log_data_err ( "error unorm_normalize(long input, UNORM_FCD) failed with %s - (Are you missing data?)\n" , u_errorName ( errorCode ) ) ; } if ( length != expectLength || u_memcmp ( output , expect , length ) != 0 ) { log_err ( "error unorm_normalize(long input, UNORM_FCD) produced wrong result\n" ) ; for ( i = 0 ; i < length ; ++ i ) { if ( output [ i ] != expect [ i ] ) { log_err ( "    FCD[%d]==U+%04lx expected U+%04lx\n" , i , output [ i ] , expect [ i ] ) ; break ; } } } } 