static int cstatfs ( struct vfs * , struct statfs32 * , int ) int statfs32 ( char * fname , struct statfs32 * sbp , int32_t len , int32_t fstyp ) { vnode_t * vp ; int error ; int estale_retry = 0 ; lookup if ( error = lookupname ( fname , UIO_USERSPACE , FOLLOW , NULLVPP , & vp ) ) { if ( ( error == ESTALE ) && fs_need_estale_retry ( estale_retry ++ ) ) { lookup } return ( set_errno ( error ) ) ; } if ( fstyp != 0 ) { error = EINVAL ; } else { error = cstatfs ( vp -> v_vfsp , sbp , len ) ; } VN_RELE ( vp , NULL ) ; if ( error ) { if ( ( error == ESTALE ) && fs_need_estale_retry ( estale_retry ++ ) ) { lookup } return ( set_errno ( error ) ) ; } return ( 0 ) ; } 