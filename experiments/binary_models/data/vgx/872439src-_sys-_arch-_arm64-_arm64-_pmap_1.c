int pmap_rollover_asid ( pmap_t pm ) { struct cpu_info * ci ; CPU_INFO_ITERATOR cii ; int asid , bit ; SCHED_ASSERT_LOCKED ( ) ; MUTEX_ASSERT_LOCKED ( & pmap_asid_mtx ) ; pmap_asid_gen += PMAP_MAX_NASID ; pmap_asid [ 0 ] |= ( 3U << 0 ) ; CPU_INFO_FOREACH ( , ) { asid = ci -> ci_curpm -> pm_asid & PMAP_ASID_MASK ; ci -> ci_curpm -> pm_asid = asid | pmap_asid_gen ; bit = ( asid & ( 32 - 1 ) ) ; pmap_asid [ asid / 32 ] |= ( 3U << bit ) ; } cpu_tlb_flush ( ) ; if ( ( pm -> pm_asid & ~ PMAP_ASID_MASK ) == pmap_asid_gen ) { return pm -> pm_asid & PMAP_ASID_MASK ; } return pmap_find_asid ( pm ) ; } 