static int add_hostent ( struct pvt * pvt , char * bp , char * * hap , struct addrinfo * ai ) { int addrlen ; char * addrp ; const char * * tap ; char * obp = bp ; switch ( ai -> ai_addr -> sa_family ) { case AF_INET6 : addrlen = IN6ADDRSZ ; addrp = ( char * ) & ( ( sockaddr_in6 * ) ai -> ai_addr ) -> sin6_addr ; break ; case AF_INET : addrlen = INADDRSZ ; addrp = ( char * ) & ( ( sockaddr_in * ) ai -> ai_addr ) -> sin_addr ; break ; default : return ( - 1 ) ; } bp = ( char * ) ( ( ( u_long ) bp + ( sizeof ( align ) - 1 ) ) & ~ ( sizeof ( align ) - 1 ) ) ; if ( hap >= & pvt -> h_addr_ptrs [ MAXADDRS ] ) { return ( 0 ) ; } for ( tap = ( const char * * ) pvt -> h_addr_ptrs ; * tap != NULL ; tap ++ ) { if ( memcmp ( * tap , addrp , addrlen ) == 0 ) { break ; } } if ( * tap != NULL ) { return ( 0 ) ; } memcpy ( * hap = bp , addrp , addrlen ) ; return ( ( bp + addrlen ) - obp ) ; } 