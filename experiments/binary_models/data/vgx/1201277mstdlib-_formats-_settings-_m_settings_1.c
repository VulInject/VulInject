M_settings_access_t M_settings_access ( const M_settings_t * settings ) { char * name ; M_settings_access_t access = M_SETTINGS_ACCESS_NONE ; name = M_strdup ( settings -> filename ) ; if ( M_fs_perms_can_access ( name , 0 ) == M_FS_ERROR_SUCCESS ) { access |= M_SETTINGS_ACCESS_EXISTS ; } if ( M_fs_perms_can_access ( name , M_FS_FILE_MODE_READ ) == M_FS_ERROR_SUCCESS ) { access |= M_SETTINGS_ACCESS_READ ; } while ( ! M_str_isempty ( name ) && * name != '.' && M_fs_perms_can_access ( name , 0 ) != M_FS_ERROR_SUCCESS ) { char * dname = M_fs_path_dirname ( name , M_FS_SYSTEM_AUTO ) ; M_free ( name ) ; name = dname ; } if ( M_fs_perms_can_access ( name , M_FS_FILE_MODE_WRITE ) == M_FS_ERROR_SUCCESS ) { access |= M_SETTINGS_ACCESS_WRITE ; } M_free ( name ) ; return access ; } 