static int _reverse_proxy_handle_plist_cmd ( reverse_proxy_client_t client ) { plist_t dict ; reverse_proxy_error_t err ; err = reverse_proxy_receive_plist ( client , & dict ) ; if ( err != REVERSE_PROXY_E_SUCCESS ) { _reverse_proxy_log ( client , "ERROR: Unable to receive plist command, error" , err ) ; return - 1 ; } plist_t node = plist_dict_get_item ( dict , "Command" ) ; if ( ! node || ( plist_get_node_type ( node ) != PLIST_STRING ) ) { _reverse_proxy_log ( client , "ERROR: No 'Command' in reply" , err ) ; plist_free ( dict ) ; return - 1 ; } char * command = NULL ; plist_get_string_val ( node , & command ) ; plist_free ( dict ) ; if ( ! command ) { _reverse_proxy_log ( client , "ERROR: Empty 'Command' string" ) ; return - 1 ; } if ( ! strcmp ( command , "Ping" ) ) { _reverse_proxy_log ( client , "Received Ping command, replying with Pong" ) ; dict = plist_new_dict ( ) ; plist_dict_set_item ( dict , "Pong" , plist_new_bool ( 1 ) ) ; err = reverse_proxy_send_plist ( client , dict ) ; plist_free ( dict ) ; if ( err ) { _reverse_proxy_log ( client , "ERROR: Unable to send Ping command reply" ) ; return - 1 ; } } else { _reverse_proxy_log ( client , "WARNING: Received unhandled plist command '%s'" , command ) ; free ( command ) ; return - 1 ; } free ( command ) ; return 0 ; } 