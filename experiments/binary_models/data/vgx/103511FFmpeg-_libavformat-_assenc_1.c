static void insert_dialogue ( ASSContext * ass , DialogueLine * dialogue ) { DialogueLine * cur , * next = NULL , * prev = NULL ; if ( ass -> last_added_dialogue ) { for ( cur = ass -> last_added_dialogue ; cur ; cur = cur -> next ) { prev = cur ; next = cur -> next ; } } if ( ! prev ) { next = ass -> dialogue_cache ; for ( cur = next ; cur != ass -> last_added_dialogue ; cur = cur -> next ) { if ( cur -> readorder > dialogue -> readorder ) { break ; } prev = cur ; next = cur -> next ; } } if ( prev ) { prev -> next = dialogue ; dialogue -> prev = prev ; } else { dialogue -> prev = ass -> dialogue_cache ; ass -> dialogue_cache = dialogue ; } if ( next ) { next -> prev = dialogue ; dialogue -> next = next ; } ass -> cache_size ++ ; ass -> last_added_dialogue = dialogue ; } 