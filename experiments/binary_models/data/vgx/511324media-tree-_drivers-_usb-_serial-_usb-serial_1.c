static void serial_cleanup ( struct tty_struct * tty ) { struct usb_serial_port * port = tty -> driver_data ; struct usb_serial * serial ; struct module * owner ; dev_dbg ( tty -> dev , "%s\n" , __func__ ) ; tty -> driver_data = NULL ; serial = port -> serial ; owner = serial -> type -> driver . owner ; mutex_lock ( & serial -> disc_mutex ) ; if ( ! serial -> disconnected ) { usb_autopm_put_interface ( serial -> interface ) ; } mutex_unlock ( & serial -> disc_mutex ) ; usb_serial_put ( serial ) ; module_put ( owner ) ; } 