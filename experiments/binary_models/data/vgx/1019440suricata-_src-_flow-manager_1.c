void FlowManagerThreadSpawn ( void ) { intmax_t setting = 1 ; ( void ) ConfGetInt ( "flow.managers" , & setting ) ; if ( setting ( 1 || setting ) 1024 ) { FatalError ( "invalid flow.managers setting %" PRIdMAX , setting ) ; } flowmgr_number = ( uint32_t ) setting ; SCCtrlCondInit ( & flow_manager_ctrl_cond ) ; SCCtrlMutexInit ( & flow_manager_ctrl_mutex , NULL ) ; SCLogConfig ( "using %u flow manager threads" , flowmgr_number ) ; StatsRegisterGlobalCounter ( "flow.memuse" , FlowGetMemuse ) ; for ( uint32_t u = 0 ; u < flowmgr_number ; u ++ ) { char name [ TM_THREAD_NAME_MAX ] ; snprintf ( name , sizeof ( name ) , "%s#%02u" , thread_name_flow_mgr , u + 1 ) ; ThreadVars * tv_flowmgr = TmThreadCreateMgmtThreadByName ( name , "FlowManager" , 0 ) ; BUG_ON ( tv_flowmgr == NULL ) ; if ( tv_flowmgr == NULL ) { FatalError ( "flow manager thread creation failed" ) ; } if ( TmThreadSpawn ( tv_flowmgr ) != TM_ECODE_OK ) { FatalError ( "flow manager thread spawn failed" ) ; } } return ; } FlowRecyclerThreadData_ { void * output_thread_data ; uint16_t counter_flows ; uint16_t counter_queue_avg ; uint16_t counter_queue_max ; uint16_t counter_flow_active ; uint16_t counter_tcp_active_sessions ; FlowEndCounters fec ; } FlowRecyclerThreadData 