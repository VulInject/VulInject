static int omap_hsmmc_enable_supply ( struct mmc_host * mmc ) { int ret ; struct omap_hsmmc_host * host = mmc_priv ( mmc ) ; struct mmc_ios * ios = & mmc -> ios ; if ( mmc -> supply . vmmc ) { ret = mmc_regulator_set_ocr ( mmc , mmc -> supply . vmmc , ios -> vdd ) ; } if ( mmc -> supply . vqmmc && ! host -> vqmmc_enabled ) { ret = regulator_enable ( mmc -> supply . vqmmc ) ; if ( ret ) { dev_err ( mmc_dev ( mmc ) , "vmmc_aux reg enable failed\n" ) ; err_vqmmc } host -> vqmmc_enabled = 1 ; } return 0 ; err_vqmmc if ( mmc -> supply . vmmc ) { mmc_regulator_set_ocr ( mmc , mmc -> supply . vmmc , 0 ) ; } return ret ; } 