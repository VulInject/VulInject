static int pdo_odbc_utf82ucs2 ( pdo_stmt_t * stmt , int is_unicode , const char * buf , zend_ulong buflen , zend_ulong * outlen ) { if ( is_unicode && buflen ) { pdo_odbc_stmt * S = ( pdo_odbc_stmt * ) stmt -> driver_data ; DWORD ret ; ret = MultiByteToWideChar ( CP_UTF8 , 0 , buf , buflen , NULL , 0 ) ; ret *= sizeof ( WCHAR ) ; if ( S -> convbufsize <= ret ) { S -> convbufsize = ret + sizeof ( WCHAR ) ; S -> convbuf = erealloc ( S -> convbuf , S -> convbufsize ) ; } ret = MultiByteToWideChar ( CP_UTF8 , 0 , buf , buflen , ( LPWSTR ) S -> convbuf , S -> convbufsize / sizeof ( WCHAR ) ) ; if ( ret == 0 ) { return PDO_ODBC_CONV_FAIL ; } ret *= sizeof ( WCHAR ) ; * outlen = ret ; return PDO_ODBC_CONV_OK ; } return PDO_ODBC_CONV_NOT_REQUIRED ; } 