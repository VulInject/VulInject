static int vsc8584_config_init ( struct phy_device * phydev ) { struct vsc8531_private * vsc8531 = phydev -> priv ; int ret , i ; u16 val ; phydev -> mdix_ctrl = ETH_TP_MDI_AUTO ; phy_lock_mdio_bus ( phydev ) ; if ( phy_package_init_once ( phydev ) ) { WARN_ON ( phydev -> drv -> phy_id_mask & 0xf ) ; switch ( phydev -> phy_id & phydev -> drv -> phy_id_mask ) { case PHY_ID_VSC8504 : case PHY_ID_VSC8552 : case PHY_ID_VSC8572 : case PHY_ID_VSC8574 : ret = vsc8574_config_pre_init ( phydev ) ; if ( ret ) { err } ret = vsc8574_config_host_serdes ( phydev ) ; if ( ret ) { err } break ; case PHY_ID_VSC856X : case PHY_ID_VSC8575 : case PHY_ID_VSC8582 : case PHY_ID_VSC8584 : ret = vsc8584_config_pre_init ( phydev ) ; if ( ret ) { err } ret = vsc8584_config_host_serdes ( phydev ) ; if ( ret ) { err } vsc85xx_coma_mode_release ( phydev ) ; break ; default : ret = - EINVAL ; break ; } if ( ret ) { err } } phy_unlock_mdio_bus ( phydev ) ; ret = vsc8584_macsec_init ( phydev ) ; ret = vsc8584_ptp_init ( phydev ) ; if ( ret ) { return ret ; } val = phy_read ( phydev , MSCC_PHY_EXT_PHY_CNTL_1 ) ; val &= ~ ( MEDIA_OP_MODE_MASK | VSC8584_MAC_IF_SELECTION_MASK ) ; val |= ( MEDIA_OP_MODE_COPPER << MEDIA_OP_MODE_POS ) | ( VSC8584_MAC_IF_SELECTION_SGMII << VSC8584_MAC_IF_SELECTION_POS ) ; ret = phy_write ( phydev , MSCC_PHY_EXT_PHY_CNTL_1 , val ) ; if ( ret ) { return ret ; } if ( phy_interface_is_rgmii ( phydev ) ) { ret = vsc85xx_rgmii_set_skews ( phydev , VSC8572_RGMII_CNTL , VSC8572_RGMII_RX_DELAY_MASK , VSC8572_RGMII_TX_DELAY_MASK ) ; if ( ret ) { return ret ; } } ret = genphy_soft_reset ( phydev ) ; if ( ret ) { return ret ; } for ( i = 0 ; i < vsc8531 -> nleds ; i ++ ) { ret = vsc85xx_led_cntl_set ( phydev , i , vsc8531 -> leds_mode [ i ] ) ; if ( ret ) { return ret ; } } return 0 ; err phy_unlock_mdio_bus ( phydev ) ; return ret ; } 