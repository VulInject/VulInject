static struct passwd * af_getpwent ( pool * p , int flags , unsigned int * bad_entry_count ) { struct passwd * pwd = NULL , * res = NULL ; if ( af_user_file == NULL || af_user_file -> af_file_fh == NULL ) { errno = EINVAL ; return NULL ; } while ( TRUE ) { char buf [ PR_TUNABLE_BUFFER_SIZE + 1 ] { '\0' } ; ; pr_signals_handle ( ) ; pwd = NULL ; while ( pr_fsio_gets ( buf , sizeof ( buf ) - 1 , af_user_file -> af_file_fh ) != NULL ) { pr_signals_handle ( ) ; af_user_file -> af_lineno ++ ; if ( buf [ 0 ] == '\0' || buf [ 0 ] == '#' ) { memset ( buf , '\0' , sizeof ( buf ) ) ; continue ; } buf [ strlen ( buf ) - 1 ] = '\0' ; pwd = af_parse_passwd ( buf , af_user_file -> af_lineno , flags ) ; if ( pwd == NULL ) { if ( bad_entry_count != NULL ) { ( * bad_entry_count ) ++ ; } memset ( buf , '\0' , sizeof ( buf ) ) ; continue ; } break ; } if ( pwd == NULL ) { break ; } if ( af_allow_pwent ( p , pwd ) < 0 ) { memset ( buf , '\0' , sizeof ( buf ) ) ; continue ; } res = pwd ; break ; } return res ; } 