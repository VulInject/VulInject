static void cmd_txsettings ( CMD_ARGS ) { struct stream * s , * s2 ; struct http * hp ; char * p ; uint32_t val = 0 ; struct frame f ; char buf [ 512 ] ; char * cursor = buf ; CAST_OBJ_NOTNULL ( s , priv , STREAM_MAGIC ) ; CAST_OBJ_NOTNULL ( hp , s -> hp , HTTP_MAGIC ) ; INIT_FRAME ( f , SETTINGS , 0 , s -> id , 0 ) ; f . data = buf ; AZ ( pthread_mutex_lock ( & hp -> mtx ) ) ; while ( * ++ av ) { if ( ! strcmp ( * av , "-push" ) ) { ++ av ; vbe16enc ( cursor , 0x2 ) ; cursor += sizeof ( uint16_t ) ; if ( ! strcmp ( * av , "false" ) ) { vbe32enc ( cursor , 0 ) ; } if ( ! strcmp ( * av , "true" ) ) { vbe32enc ( cursor , 1 ) ; } else { vtc_fatal ( vl , "Push parameter is either " "\"true\" or \"false\", not %s" , * av ) ; } cursor += sizeof ( uint32_t ) ; f . size += 6 ; } if ( ! strcmp ( * av , "-hdrtbl" ) ) { PUT_KV ( av , vl , hdrtbl , val , 0x1 ) ; assert ( HPK_ResizeTbl ( s -> hp -> decctx , val ) != hpk_err ) ; } if ( ! strcmp ( * av , "-maxstreams" ) ) { PUT_KV ( av , vl , maxstreams , val , 0x3 ) ; } if ( ! strcmp ( * av , "-winsize" ) ) { PUT_KV ( av , vl , winsize , val , 0x4 ) ; VTAILQ_FOREACH ( , , ) s2 -> win_self += ( val - hp -> h2_win_self -> init ) ; hp -> h2_win_self -> init = val ; } if ( ! strcmp ( * av , "-framesize" ) ) { PUT_KV ( av , vl , framesize , val , 0x5 ) ; } if ( ! strcmp ( * av , "-hdrsize" ) ) { PUT_KV ( av , vl , hdrsize , val , 0x6 ) ; } if ( ! strcmp ( * av , "-ack" ) ) { f . flags |= 1 ; } else { break ; } } if ( * av != NULL ) { vtc_fatal ( vl , "Unknown txsettings spec: %s\n" , * av ) ; } AN ( s -> hp ) ; write_frame ( s , & f , 0 ) ; AZ ( pthread_mutex_unlock ( & hp -> mtx ) ) ; } 