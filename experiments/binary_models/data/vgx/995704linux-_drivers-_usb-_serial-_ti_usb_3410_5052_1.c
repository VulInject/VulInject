static void ti_close ( struct usb_serial_port * port ) { struct ti_device * tdev ; struct ti_port * tport ; int status ; unsigned long flags ; tdev = usb_get_serial_data ( port -> serial ) ; tport = usb_get_serial_port_data ( port ) ; tport -> tp_is_open = 0 ; usb_kill_urb ( port -> read_urb , NULL ) ; usb_kill_urb ( port -> write_urb ) ; tport -> tp_write_urb_in_use = 0 ; spin_lock_irqsave ( & tport -> tp_lock , flags ) ; kfifo_reset_out ( & port -> write_fifo ) ; spin_unlock_irqrestore ( & tport -> tp_lock , flags ) ; status = ti_port_cmd_out ( port , TI_CLOSE_PORT , 0 , NULL , 0 ) ; if ( status ) { dev_err ( & port -> dev , "%s - cannot send close port command, %d\n" , __func__ , status ) ; } mutex_lock ( & tdev -> td_open_close_lock ) ; -- tdev -> td_open_port_count ; if ( tdev -> td_open_port_count == 0 ) { usb_kill_urb ( port -> serial -> port [ 0 ] -> interrupt_in_urb ) ; } mutex_unlock ( & tdev -> td_open_close_lock ) ; } 