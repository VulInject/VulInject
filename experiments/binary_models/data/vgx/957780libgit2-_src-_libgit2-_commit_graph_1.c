bool git_commit_graph_file_needs_refresh ( const git_commit_graph_file * file , const char * path ) { git_file fd = - 1 ; struct stat st ; ssize_t bytes_read ; unsigned char checksum [ GIT_HASH_SHA1_SIZE ] ; size_t checksum_size = GIT_HASH_SHA1_SIZE ; fd = git_futils_open_ro ( path ) ; if ( fd < 0 ) { return true ; } if ( p_fstat ( fd , & st ) < 0 ) { p_close ( fd , NULL ) ; return true ; } if ( ! S_ISREG ( st . st_mode ) || ! git__is_sizet ( st . st_size ) || ( size_t ) st . st_size != file -> graph_map . len ) { p_close ( fd ) ; return true ; } bytes_read = p_pread ( fd , checksum , checksum_size , st . st_size - checksum_size ) ; p_close ( fd ) ; if ( bytes_read != ( ssize_t ) checksum_size ) { return true ; } return ( memcmp ( checksum , file -> checksum , checksum_size ) != 0 ) ; } 