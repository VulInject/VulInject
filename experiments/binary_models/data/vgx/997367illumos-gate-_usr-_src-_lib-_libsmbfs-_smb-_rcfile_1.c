int smb_open_rcfile ( char * home ) { char * fn ; int len , error = 0 ; mutex_lock ( & rcfile_mutex ) ; smb_rc = NULL ; fn = SMB_CFG_FILE ; error = rc_open ( fn , & smb_rc ) ; fn = "(sharectl get smbfs)" ; error = rc_open_sharectl ( & smb_rc ) ; if ( error != 0 && error != ENOENT ) { fprintf ( stderr , dgettext ( TEXT_DOMAIN , "Can't open %s: %s\n" ) , fn , strerror ( errno ) ) ; } if ( smb_debug ) { dump_props ( fn ) ; } if ( home ) { len = strlen ( home ) + 20 ; fn = malloc ( len ) ; snprintf ( fn , len , "%s/.nsmbrc" , home ) ; home_nsmbrc = 1 ; error = rc_merge ( fn , & smb_rc ) ; if ( error != 0 && error != ENOENT ) { fprintf ( stderr , dgettext ( TEXT_DOMAIN , "Can't open %s: %s\n" ) , fn , strerror ( errno ) ) ; } home_nsmbrc = 0 ; if ( smb_debug ) { dump_props ( fn ) ; } } if ( smb_rc == NULL ) { error = ENOENT ; } else { error = 0 ; } mutex_unlock ( & rcfile_mutex ) ; return ( error ) ; } 