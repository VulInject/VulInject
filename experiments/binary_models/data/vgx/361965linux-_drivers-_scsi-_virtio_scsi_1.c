static void virtscsi_handle_param_change ( struct virtio_scsi * vscsi , struct virtio_scsi_event * event ) { struct scsi_device * sdev ; struct Scsi_Host * shost = virtio_scsi_host ( vscsi -> vdev ) ; unsigned int target = event -> lun [ 1 ] ; int lun = ( event -> lun [ 2 ] << 8 ) | event -> lun [ 3 ] ; u8 asc = virtio32_to_cpu ( vscsi -> vdev , event -> reason ) & 255 ; u8 ascq = virtio32_to_cpu ( vscsi -> vdev , event -> reason ) >> 8 ; sdev = scsi_device_lookup ( shost , 0 , target , lun ) ; if ( ! sdev ) { pr_err ( "SCSI device %d 0 %d %d not found\n" , shost -> host_no , target , lun ) ; return ; } if ( asc == 0x2a && ( ascq == 0x00 || ascq == 0x01 || ascq == 0x09 ) ) { scsi_rescan_device ( & sdev -> sdev_gendev ) ; } scsi_device_put ( sdev ) ; } 