int carp_demote_init ( char * group , int force ) { struct carpgroup * c ; int level ; if ( ( c = carp_group_find ( group ) ) == NULL ) { if ( ( c = calloc ( 1 , sizeof ( carpgroup ) ) ) == NULL ) { log_warn ( "carp_demote_init calloc" ) ; return ( - 1 ) ; } if ( ( c -> group = strdup ( group ) ) == NULL ) { log_warn ( "carp_demote_init strdup" ) ; return ( - 1 ) ; } if ( ( level = carp_demote_get ( group ) ) == - 1 ) { free ( c -> group ) ; free ( c ) ; return ( - 1 ) ; } if ( level > 0 || force ) { c -> do_demote = 1 ; } TAILQ_INSERT_TAIL ( & carpgroups , c , entry ) ; } return ( 0 ) ; } 