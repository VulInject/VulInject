static netdev_tx_t ksdazzle_hard_xmit ( struct sk_buff * skb , struct net_device * netdev ) { struct ksdazzle_cb * kingsun ; unsigned int wraplen ; int ret = 0 ; netif_stop_queue ( netdev ) ; SKB_LINEAR_ASSERT ( skb , NULL ) ; kingsun = netdev_priv ( netdev ) ; spin_lock ( & kingsun -> lock ) ; kingsun -> new_speed = irda_get_next_speed ( skb ) ; wraplen = async_wrap_skb ( skb , kingsun -> tx_buf_clear , KINGSUN_SND_FIFO_SIZE ) ; kingsun -> tx_buf_clear_used = wraplen ; if ( ( ret = ksdazzle_submit_tx_fragment ( kingsun ) ) != 0 ) { dev_err ( & kingsun -> usbdev -> dev , "ksdazzle_hard_xmit: failed tx_urb submit: %d\n" , ret ) ; switch ( ret ) { case - ENODEV : case - EPIPE : break ; default : netdev -> stats . tx_errors ++ ; netif_start_queue ( netdev ) ; } } else { netdev -> stats . tx_packets ++ ; netdev -> stats . tx_bytes += skb -> len ; } dev_kfree_skb ( skb ) ; spin_unlock ( & kingsun -> lock ) ; return NETDEV_TX_OK ; } 