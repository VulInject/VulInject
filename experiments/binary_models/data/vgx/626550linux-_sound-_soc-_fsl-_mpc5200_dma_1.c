static int psc_dma_close ( struct snd_soc_component * component , struct snd_pcm_substream * substream ) { struct snd_soc_pcm_runtime * rtd = asoc_substream_to_rtd ( substream ) ; struct psc_dma * psc_dma = snd_soc_dai_get_drvdata ( asoc_rtd_to_cpu ( rtd , 0 ) ) ; struct psc_dma_stream * s ; dev_dbg ( psc_dma -> dev , "psc_dma_close(substream=%p)\n" , substream ) ; if ( substream -> pstr -> stream == SNDRV_PCM_STREAM_CAPTURE ) { s = & psc_dma -> capture ; } else { s = & psc_dma -> playback ; } if ( ! psc_dma -> playback . active && ! psc_dma -> capture . active ) { out_be16 ( & psc_dma -> psc_regs -> isr_imr . imr , psc_dma -> imr ) ; out_8 ( & psc_dma -> psc_regs -> command , 4 << 4 ) ; } return 0 ; } 