static uint32_t emlxs_rpi_state ( emlxs_port_t * port , RPIobj_t * rpip , uint16_t state , uint16_t reason , uint32_t explain , void * arg1 ) { uint32_t rval = 0 ; if ( ( rpip -> state == state ) && ( reason != FCF_REASON_REENTER ) ) { EMLXS_MSGF ( EMLXS_CONTEXT , & emlxs_fcf_error_msg , "rpi_state:%d %s:%s:0x%x arg=%p. State not changed.<" , rpip -> RPI , emlxs_rpi_state_xlate ( rpip -> state ) , emlxs_fcf_reason_xlate ( reason ) , explain , arg1 ) ; return ( 1 ) ; } if ( ! reason ) { EMLXS_MSGF ( EMLXS_CONTEXT , & emlxs_fcf_state_msg , "rpi_state:%d %s-->%s arg=%p" , rpip -> RPI , emlxs_rpi_state_xlate ( rpip -> state ) , emlxs_rpi_state_xlate ( state ) , arg1 ) ; } if ( reason == FCF_REASON_EVENT ) { EMLXS_MSGF ( EMLXS_CONTEXT , & emlxs_fcf_state_msg , "rpi_state:%d %s-->%s:%s:%s arg=%p" , rpip -> RPI , emlxs_rpi_state_xlate ( rpip -> state ) , emlxs_rpi_state_xlate ( state ) , emlxs_fcf_reason_xlate ( reason ) , emlxs_fcf_event_xlate ( explain ) , arg1 ) ; } if ( explain ) { EMLXS_MSGF ( EMLXS_CONTEXT , & emlxs_fcf_state_msg , "rpi_state:%d %s-->%s:%s:0x%x arg=%p" , rpip -> RPI , emlxs_rpi_state_xlate ( rpip -> state ) , emlxs_rpi_state_xlate ( state ) , emlxs_fcf_reason_xlate ( reason ) , explain , arg1 ) ; } else { EMLXS_MSGF ( EMLXS_CONTEXT , & emlxs_fcf_state_msg , "rpi_state:%d %s-->%s:%s arg=%p" , rpip -> RPI , emlxs_rpi_state_xlate ( rpip -> state ) , emlxs_rpi_state_xlate ( state ) , emlxs_fcf_reason_xlate ( reason ) , arg1 ) ; } rpip -> prev_state = rpip -> state ; rpip -> prev_reason = rpip -> reason ; rpip -> state = state ; rpip -> reason = reason ; rval = emlxs_rpi_action ( port , rpip , FCF_EVENT_STATE_ENTER , arg1 ) ; return ( rval ) ; } 