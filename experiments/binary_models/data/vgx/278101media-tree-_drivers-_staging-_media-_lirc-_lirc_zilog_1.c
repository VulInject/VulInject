static int send_boot_data ( struct IR_tx * tx ) { int ret , i ; int buf [ 4 ] ; ret = send_data_block ( tx , tx_data -> boot_data ) ; if ( ret != 0 ) { return ret ; } buf [ 0 ] = 0x00 ; buf [ 1 ] = 0x20 ; ret = i2c_master_send ( tx -> c , buf , 2 ) ; if ( ret != 2 ) { dev_err ( tx -> ir -> l . dev , "i2c_master_send failed with %d\n" , ret ) ; return ret < 0 ?ret : - EFAULT ; } for ( i = 0 ; i < 10 ; i ++ ) { ret = i2c_master_send ( tx -> c , buf , 1 ) ; if ( ret == 1 ) { break ; } udelay ( 100 ) ; } if ( ret != 1 ) { dev_err ( tx -> ir -> l . dev , "i2c_master_send failed with %d\n" , ret ) ; return ret < 0 ?ret : - EFAULT ; } ret = i2c_master_recv ( tx -> c , buf , 4 ) ; if ( ret != 4 ) { dev_err ( tx -> ir -> l . dev , "i2c_master_recv failed with %d\n" , ret ) ; return 0 ; } if ( ( buf [ 0 ] != 0x80 ) && ( buf [ 0 ] != 0xa0 ) ) { dev_err ( tx -> ir -> l . dev , "unexpected IR TX init response: %02x\n" , buf [ 0 ] ) ; return 0 ; } dev_notice ( tx -> ir -> l . dev , "Zilog/Hauppauge IR blaster firmware version %d.%d.%d loaded\n" , buf [ 1 ] , buf [ 2 ] , buf [ 3 ] ) ; return 0 ; } 