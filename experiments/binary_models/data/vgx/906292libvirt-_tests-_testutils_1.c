int virTestDifferenceBin ( FILE * stream , const char * expect , const char * actual , size_t length ) { size_t start = 0 , end = length ; int i ; if ( ! virTestGetDebug ( ) ) { return 0 ; } if ( virTestGetDebug ( ) < 2 ) { for ( i = 0 ; i < length ; i ++ ) { if ( expect [ i ] != actual [ i ] ) { start = i ; break ; } } for ( i = ( length - 1 ) ; i >= 0 ; i -- ) { if ( expect [ i ] != actual [ i ] ) { end = i ; break ; } } } start -= ( start % 4 ) ; end += 4 - ( end % 4 ) ; if ( end >= length ) { end = length - 1 ; } fprintf ( stream , "\nExpect [ Region %d-%d" , ( int ) start , ( int ) end ) ; for ( i = start ; i < end ; i ++ ) { if ( ( i % 4 ) == 0 ) { fprintf ( stream , "\n    " ) ; } fprintf ( stream , "0x%02x, " , ( ( int ) expect [ i ] ) & 0xff ) ; } fprintf ( stream , "]\n" ) ; fprintf ( stream , "Actual [ Region %d-%d" , ( int ) start , ( int ) end ) ; for ( i = start ; i < end ; i ++ ) { if ( ( i % 4 ) == 0 ) { fprintf ( stream , "\n    " ) ; } fprintf ( stream , "0x%02x, " , ( ( int ) actual [ i ] ) & 0xff ) ; } fprintf ( stream , "]\n" ) ; fprintf ( stream , "                                                                      ... " ) ; return 0 ; } 