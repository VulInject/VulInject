static int pm860x_dac_event ( struct snd_soc_dapm_widget * w , struct snd_kcontrol * kcontrol , int event ) { struct snd_soc_component * component = snd_soc_dapm_to_component ( w -> dapm ) ; int dac = 0 ; int data ; if ( ! strcmp ( w -> name , "Left DAC" ) ) { dac = DAC_LEFT ; } if ( ! strcmp ( w -> name , "Right DAC" ) ) { dac = DAC_RIGHT ; } switch ( event ) { case SND_SOC_DAPM_PRE_PMU : if ( dac ) { dac |= MODULATOR ; snd_soc_component_update_bits ( component , PM860X_DAC_OFFSET , DAC_MUTE , DAC_MUTE ) ; snd_soc_component_update_bits ( component , PM860X_EAR_CTRL_2 , RSYNC_CHANGE , RSYNC_CHANGE ) ; snd_soc_component_update_bits ( component , PM860X_DAC_EN_2 , dac , dac ) ; } break ; case SND_SOC_DAPM_PRE_PMD : if ( dac ) { snd_soc_component_update_bits ( component , PM860X_DAC_OFFSET , DAC_MUTE , DAC_MUTE ) ; snd_soc_component_update_bits ( component , PM860X_EAR_CTRL_2 , RSYNC_CHANGE , RSYNC_CHANGE ) ; data = snd_soc_component_read ( component , PM860X_DAC_EN_2 ) ; data &= ~ dac ; if ( ! ( data & ( DAC_LEFT | DAC_RIGHT ) ) ) { data &= ~ MODULATOR ; } snd_soc_component_write ( component , PM860X_DAC_EN_2 , data ) ; } break ; } return 0 ; } 