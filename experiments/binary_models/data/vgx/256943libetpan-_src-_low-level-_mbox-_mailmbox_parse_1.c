static inline int mailmbox_fields_parse ( char * str , size_t length , size_t * indx , uint32_t * puid , size_t * phlen ) { int cur_token ; int r ; size_t hlen ; uint32_t uid ; int end ; cur_token = * indx ; end = FALSE ; uid = 0 ; while ( ! end ) { size_t begin ; begin = cur_token ; r = mailimf_ignore_field_parse ( str , length , & cur_token ) ; switch ( r ) { case MAILIMF_NO_ERROR : if ( str [ begin ] == 'X' ) { if ( strncasecmp ( str + begin , UID_HEADER , strlen ( UID_HEADER ) ) == 0 ) { begin += strlen ( UID_HEADER ) ; while ( str [ begin ] == ' ' ) { begin ++ ; } uid = ( uint32_t ) strtoul ( str + begin , NULL , 10 ) ; } } break ; case MAILIMF_ERROR_PARSE : default : end = TRUE ; break ; } } hlen = cur_token - * indx ; * phlen = hlen ; * puid = uid ; * indx = cur_token ; return MAILMBOX_NO_ERROR ; } 