static char * evaluate_by_udev ( const char * token , const char * value , int uevent ) { char dev [ PATH_MAX ] ; char * path = NULL ; size_t len ; struct stat st ; DBG ( EVALUATE , ul_debug ( "evaluating by udev %s=%s" , token , value ) ) ; if ( ! strcmp ( token , "UUID" ) ) { strcpy ( dev , _PATH_DEV_BYUUID "/" ) ; } if ( ! strcmp ( token , "LABEL" ) ) { strcpy ( dev , _PATH_DEV_BYLABEL "/" ) ; } if ( ! strcmp ( token , "PARTLABEL" ) ) { strcpy ( dev , _PATH_DEV_BYPARTLABEL "/" ) ; } if ( ! strcmp ( token , "PARTUUID" ) ) { strcpy ( dev , _PATH_DEV_BYPARTUUID "/" ) ; } if ( ! strcmp ( token , "ID" ) ) { strcpy ( dev , _PATH_DEV_BYID "/" ) ; } else { DBG ( EVALUATE , ul_debug ( "unsupported token %s" , token ) ) ; return NULL ; } len = strlen ( dev ) ; if ( blkid_encode_string ( value , & dev [ len ] , sizeof ( dev ) - len ) != 0 ) { return NULL ; } DBG ( EVALUATE , ul_debug ( "expected udev link: %s" , dev ) ) ; if ( stat ( dev , & st ) ) { failed } if ( ! S_ISBLK ( st . st_mode ) ) { return NULL ; } path = canonicalize_path ( dev ) ; if ( ! path ) { return NULL ; } if ( verify_tag ( path , token , value ) ) { failed } return path ; failed DBG ( EVALUATE , ul_debug ( "failed to evaluate by udev" ) ) ; if ( uevent && path ) { blkid_send_uevent ( path , "change" ) ; } return NULL ; } 