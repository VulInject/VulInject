static int rc5t583_gpio_probe ( struct platform_device * pdev ) { struct rc5t583 * rc5t583 = dev_get_drvdata ( pdev -> dev . parent ) ; struct rc5t583_platform_data * pdata = dev_get_platdata ( rc5t583 -> dev ) ; struct rc5t583_gpio * rc5t583_gpio ; rc5t583_gpio = devm_kzalloc ( & pdev -> dev , sizeof ( * rc5t583_gpio ) , GFP_KERNEL ) ; rc5t583_gpio -> gpio_chip . label = "gpio-rc5t583" , rc5t583_gpio -> gpio_chip . owner = THIS_MODULE , rc5t583_gpio -> gpio_chip . free = rc5t583_gpio_free , rc5t583_gpio -> gpio_chip . direction_input = rc5t583_gpio_dir_input , rc5t583_gpio -> gpio_chip . direction_output = rc5t583_gpio_dir_output , rc5t583_gpio -> gpio_chip . set = rc5t583_gpio_set , rc5t583_gpio -> gpio_chip . get = rc5t583_gpio_get , rc5t583_gpio -> gpio_chip . to_irq = rc5t583_gpio_to_irq , rc5t583_gpio -> gpio_chip . ngpio = RC5T583_MAX_GPIO , rc5t583_gpio -> gpio_chip . can_sleep = true , rc5t583_gpio -> gpio_chip . parent = & pdev -> dev ; rc5t583_gpio -> gpio_chip . base = - 1 ; rc5t583_gpio -> rc5t583 = rc5t583 ; if ( pdata && pdata -> gpio_base ) { rc5t583_gpio -> gpio_chip . base = pdata -> gpio_base ; } platform_set_drvdata ( pdev , rc5t583_gpio ) ; return devm_gpiochip_add_data ( & pdev -> dev , & rc5t583_gpio -> gpio_chip , rc5t583_gpio ) ; } static struct platform_driver rc5t583_gpio_driver = { . driver = { . name = "rc5t583-gpio" } . probe = rc5t583_gpio_probe } ; 