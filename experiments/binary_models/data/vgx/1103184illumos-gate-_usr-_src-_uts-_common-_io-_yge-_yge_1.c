static int yge_txrx_dma_alloc ( yge_port_t * port ) { uint32_t bufsz ; int rv ; int i ; yge_buf_t * b ; bufsz = port -> p_mtu ; rv = yge_alloc_ring ( port , NULL , & port -> p_tx_ring , YGE_TX_RING_CNT ) ; b = port -> p_tx_buf ; for ( i = 0 ; i < YGE_TX_RING_CNT ; i ++ ) { rv = yge_alloc_buf ( port , b , bufsz , DDI_DMA_STREAMING | DDI_DMA_WRITE ) ; if ( rv != DDI_SUCCESS ) { return ( DDI_FAILURE ) ; } b ++ ; } rv = yge_alloc_ring ( port , NULL , & port -> p_rx_ring , YGE_RX_RING_CNT ) ; if ( rv != DDI_SUCCESS ) { return ( DDI_FAILURE ) ; } b = port -> p_rx_buf ; for ( i = 0 ; i < YGE_RX_RING_CNT ; i ++ ) { rv = yge_alloc_buf ( port , b , bufsz , DDI_DMA_STREAMING | DDI_DMA_READ ) ; if ( rv != DDI_SUCCESS ) { return ( DDI_FAILURE ) ; } b ++ ; } return ( DDI_SUCCESS ) ; } 