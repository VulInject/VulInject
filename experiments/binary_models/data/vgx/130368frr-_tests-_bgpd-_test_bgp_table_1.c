static void check_lookup_result ( struct bgp_dest * match , va_list arglist ) { char * prefix_str ; struct prefix * prefixes = NULL ; int prefix_count = 0 ; while ( ( prefix_str = va_arg ( arglist , char * ) ) ) { ++ prefix_count ; prefixes = realloc ( prefixes , sizeof ( * prefixes ) * prefix_count ) ; if ( str2prefix ( prefix_str , & prefixes [ prefix_count - 1 ] ) <= 0 ) { assert ( 0 ) ; } } assert ( ( prefix_count == 0 && ! match ) || prefix_count > 0 ) ; if ( ! match ) { return ; } struct bgp_dest * dest = match ; while ( ( dest = bgp_route_next_until ( dest , match ) ) ) { const struct prefix * dest_p = bgp_dest_get_prefix ( dest ) ; if ( bgp_dest_has_bgp_path_info_data ( dest ) && ! prefix_in_array ( dest_p , prefixes , prefix_count ) ) { printf ( "prefix %pFX was not expected!\n" , dest_p ) ; assert ( 0 ) ; } } } 