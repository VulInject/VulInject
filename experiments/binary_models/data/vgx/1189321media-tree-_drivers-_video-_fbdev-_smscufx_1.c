static int ufx_alloc_urb_list ( struct ufx_data * dev , int count , size_t size ) static void ufx_free_urb_list ( struct ufx_data * dev ) static int ufx_reg_read ( struct ufx_data * dev , u32 index , u32 * data ) { u32 * buf = kmalloc ( 4 , GFP_KERNEL ) ; int ret ; BUG_ON ( ! dev ) ; if ( ! buf ) { return - ENOMEM ; } ret = usb_control_msg ( dev -> udev , usb_rcvctrlpipe ( dev -> udev , 0 ) , USB_VENDOR_REQUEST_READ_REGISTER , USB_DIR_IN | USB_TYPE_VENDOR | USB_RECIP_DEVICE , 00 , index , buf , 4 , USB_CTRL_GET_TIMEOUT ) ; le32_to_cpus ( buf ) ; * data = * buf ; if ( unlikely ( ret < 0 ) ) { pr_warn ( "Failed to read register index 0x%08x\n" , index ) ; } return ret ; } 