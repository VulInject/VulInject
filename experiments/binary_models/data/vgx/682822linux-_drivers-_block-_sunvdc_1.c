static void vdc_port_remove ( struct vio_dev * vdev ) { struct vdc_port * port = dev_get_drvdata ( & vdev -> dev ) ; if ( port ) { blk_mq_stop_hw_queues ( port -> disk -> queue ) ; flush_work ( & port -> ldc_reset_work ) ; cancel_delayed_work_sync ( & port -> ldc_reset_timer_work ) ; del_timer_sync ( & port -> vio . timer ) ; del_gendisk ( port -> disk ) ; put_disk ( port -> disk ) ; blk_mq_free_tag_set ( & port -> tag_set ) ; vdc_free_tx_ring ( port ) ; vio_ldc_free ( & port -> vio ) ; dev_set_drvdata ( & vdev -> dev , NULL ) ; } } 