static int stage_new_files ( git_index * * out , git_tree * parent_tree , git_tree * tree ) { git_iterator * iterators [ 2 ] { NULL NULL } ; ; git_iterator_options iterator_options = GIT_ITERATOR_OPTIONS_INIT ; git_index * index = NULL ; int error ; if ( ( error = git_index_new ( & index ) ) < 0 || ( error = git_iterator_for_tree ( & iterators [ 0 ] , parent_tree , & iterator_options ) ) < 0 || ( error = git_iterator_for_tree ( & iterators [ 1 ] , tree , & iterator_options ) ) < 0 ) { done } error = git_iterator_walk ( iterators , 2 , stage_new_file , index ) ; done if ( error < 0 ) { git_index_free ( index ) ; } else { * out = index ; } git_iterator_free ( iterators [ 1 ] ) ; return error ; } 