static struct pse_control * pse_control_get_internal ( struct pse_controller_dev * pcdev , unsigned int index ) { struct pse_control * psec ; lockdep_assert_held ( & pse_list_mutex ) ; list_for_each_entry ( , , ) { if ( psec -> id == index ) { kref_get ( & psec -> refcnt ) ; return psec ; } } psec = kzalloc ( sizeof ( * psec ) , GFP_KERNEL ) ; if ( ! psec ) { return ERR_PTR ( - ENOMEM ) ; } if ( ! try_module_get ( pcdev -> owner ) ) { return ERR_PTR ( - ENODEV ) ; } psec -> pcdev = pcdev ; list_add ( & psec -> list , & pcdev -> pse_control_head ) ; psec -> id = index ; kref_init ( & psec -> refcnt ) ; return psec ; } 