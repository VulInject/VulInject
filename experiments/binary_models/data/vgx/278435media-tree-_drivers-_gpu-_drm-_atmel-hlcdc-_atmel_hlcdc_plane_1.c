static void atmel_hlcdc_plane_reset ( struct drm_plane * p ) { struct atmel_hlcdc_plane_state * state ; if ( p -> state ) { state = drm_plane_state_to_atmel_hlcdc_plane_state ( p -> state ) ; if ( state -> base . fb ) { drm_framebuffer_unreference ( state -> base . fb ) ; } p -> state = NULL ; } state = kzalloc ( sizeof ( * state ) , GFP_KERNEL ) ; if ( state ) { if ( atmel_hlcdc_plane_alloc_dscrs ( p , state ) ) { kfree ( state ) ; dev_err ( p -> dev -> dev , "Failed to allocate initial plane state\n" ) ; return ; } state -> alpha = 255 ; p -> state = & state -> base ; p -> state -> plane = p ; } } 