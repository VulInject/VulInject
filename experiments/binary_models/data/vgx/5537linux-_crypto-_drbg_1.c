static int drbg_fips_continuous_test ( struct drbg_state * drbg , const unsigned char * entropy ) { unsigned short entropylen = drbg_sec_strength ( drbg -> core -> flags ) ; int ret ; if ( ! IS_ENABLED ( CONFIG_CRYPTO_FIPS ) ) { return 0 ; } if ( list_empty ( & drbg -> test_data . list ) ) { return 0 ; } if ( ! fips_enabled ) { return 0 ; } if ( ! drbg -> fips_primed ) { memcpy ( drbg -> prev , entropy , entropylen ) ; drbg -> fips_primed = true ; return - EAGAIN ; } ret = memcmp ( drbg -> prev , entropy , entropylen ) ; if ( ! ret ) { panic ( "DRBG continuous self test failed\n" ) ; } memcpy ( drbg -> prev , entropy , entropylen ) ; return 0 ; } 