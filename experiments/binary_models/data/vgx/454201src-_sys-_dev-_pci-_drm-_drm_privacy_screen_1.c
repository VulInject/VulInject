struct drm_privacy_screen * drm_privacy_screen_register ( struct device * parent , const struct drm_privacy_screen_ops * ops , void * data ) { struct drm_privacy_screen * priv ; int ret ; priv = kzalloc ( sizeof ( * priv ) , GFP_KERNEL ) ; mutex_init ( & priv -> lock ) ; BLOCKING_INIT_NOTIFIER_HEAD ( & priv -> notifier_head ) ; priv -> dev . class = drm_class ; priv -> dev . type = & drm_privacy_screen_type ; priv -> dev . parent = parent ; priv -> dev . release = drm_privacy_screen_device_release ; dev_set_name ( & priv -> dev , "privacy_screen-%s" , dev_name ( parent ) ) ; priv -> drvdata = data ; priv -> ops = ops ; priv -> ops -> get_hw_state ( priv ) ; ret = device_register ( & priv -> dev ) ; if ( ret ) { put_device ( & priv -> dev ) ; return ERR_PTR ( ret ) ; } mutex_lock ( & drm_privacy_screen_devs_lock ) ; list_add ( & priv -> list , & drm_privacy_screen_devs ) ; mutex_unlock ( & drm_privacy_screen_devs_lock ) ; return priv ; } 