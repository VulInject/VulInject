void i40evf_set_rss_key ( struct i40evf_adapter * adapter ) { struct i40e_virtchnl_rss_key * vrk ; int len ; if ( adapter -> current_op != I40E_VIRTCHNL_OP_UNKNOWN ) { dev_err ( & adapter -> pdev -> dev , "Cannot set RSS key, command %d pending\n" , adapter -> current_op ) ; return ; } len = sizeof ( i40e_virtchnl_rss_key ) + ( adapter -> rss_key_size * sizeof ( u8 ) ) - 1 ; vrk = kzalloc ( len , GFP_KERNEL ) ; if ( ! vrk ) { return ; } vrk -> vsi_id = adapter -> vsi . id ; vrk -> key_len = adapter -> rss_key_size ; memcpy ( vrk -> key , adapter -> rss_key , adapter -> rss_key_size ) ; adapter -> current_op = I40E_VIRTCHNL_OP_CONFIG_RSS_KEY ; adapter -> aq_required &= ~ I40EVF_FLAG_AQ_SET_RSS_KEY ; i40evf_send_pf_msg ( adapter , I40E_VIRTCHNL_OP_CONFIG_RSS_KEY , ( u8 * ) vrk , len ) ; } 