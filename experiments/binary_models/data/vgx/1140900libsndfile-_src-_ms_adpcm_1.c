static sf_count_t msadpcm_write_i ( SF_PRIVATE * psf , const int * ptr , sf_count_t len ) { MSADPCM_PRIVATE * pms ; BUF_UNION ubuf ; short * sptr ; int k , bufferlen , writecount , count ; sf_count_t total = 0 ; pms = ( MSADPCM_PRIVATE * ) psf -> codec_data ; sptr = ubuf . sbuf ; bufferlen = ARRAY_LEN ( ubuf . sbuf ) ; while ( len > 0 ) { writecount = ( len >= bufferlen ) ?bufferlen : ( int ) len ; for ( k = 0 ; k < writecount ; k ++ ) { sptr [ k ] = ptr [ total + k ] >> 16 ; } count = ( int ) msadpcm_write_block ( psf , pms , sptr , writecount ) ; total += count ; len -= writecount ; if ( count != writecount ) { break ; } } return total ; } 