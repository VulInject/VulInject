static struct dma_async_tx_descriptor * milbeaut_hdmac_prep_slave_sg ( struct dma_chan * chan , struct scatterlist * sgl , unsigned int sg_len , enum dma_transfer_direction direction , unsigned long flags , void * context ) { struct virt_dma_chan * vc = to_virt_chan ( chan ) ; struct milbeaut_hdmac_desc * md ; int i ; if ( ! is_slave_direction ( direction ) ) { return NULL ; } md = kzalloc ( sizeof ( * md ) , GFP_NOWAIT ) ; if ( ! md ) { return NULL ; } md -> sgl = kcalloc ( sg_len , sizeof ( * sgl ) , GFP_NOWAIT ) ; if ( ! md -> sgl ) { return NULL ; } for ( i = 0 ; i < sg_len ; i ++ ) { md -> sgl [ i ] = sgl [ i ] ; } md -> sg_len = sg_len ; md -> dir = direction ; return vchan_tx_prep ( vc , & md -> vd , flags ) ; } 