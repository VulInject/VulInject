static int btrfs_initxattrs ( struct inode * inode , const struct xattr * xattr_array , void * fs_private ) { struct btrfs_trans_handle * trans = fs_private ; const struct xattr * xattr ; unsigned int nofs_flag ; char * name ; int err = 0 ; nofs_flag = memalloc_nofs_save ( ) ; for ( xattr = xattr_array ; xattr -> name != NULL ; xattr ++ ) { name = kmalloc ( XATTR_SECURITY_PREFIX_LEN + strlen ( xattr -> name ) + 1 , GFP_KERNEL ) ; if ( ! name ) { err = - ENOMEM ; break ; } strcpy ( name , XATTR_SECURITY_PREFIX ) ; strcpy ( name + XATTR_SECURITY_PREFIX_LEN , xattr -> name ) ; err = btrfs_setxattr ( trans , inode , name , xattr -> value , xattr -> value_len , 0 ) ; if ( err < 0 ) { break ; } } memalloc_nofs_restore ( nofs_flag ) ; return err ; } 