void preen_addunit ( void * cookie , char * dname , int * cf ( ) , void * datap , uint_t unit ) { int drvid ; struct driver * dp ; struct onedev * devp ; struct rawdev * rdp = ( rawdev * ) cookie ; dp = NULL ; for ( drvid = 0 ; drvid < ndrivers ; drvid ++ ) { if ( strcmp ( dlist [ drvid ] . name , dname ) == 0 ) { dp = & dlist [ drvid ] ; break ; } } if ( dp == NULL ) { if ( cf == NULL ) { cf = chooseone ; } drvid = alloc_driver ( dname , cf , datap ) ; dp = & dlist [ drvid ] ; } for ( devp = rdp -> alldevs ; devp != NULL ; devp = devp -> nxtdev ) { if ( devp -> drvid == drvid ) { break ; } } if ( devp == NULL ) { devp = alloc_dev ( drvid , NULL ) ; devp -> nxtdev = rdp -> alldevs ; rdp -> alldevs = devp ; } addunit ( devp , unit ) ; } 