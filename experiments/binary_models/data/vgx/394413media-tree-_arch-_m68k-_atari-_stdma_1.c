static int stdma_locked ; static irq_handler_t stdma_isr ; static void * stdma_isr_data ; static DECLARE_WAIT_QUEUE_HEAD ( stdma_wait ) ; static irqreturn_t stdma_int ( int irq , void * dummy ) int stdma_try_lock ( irq_handler_t handler , void * data ) { unsigned long flags ; local_irq_save ( flags ) ; if ( stdma_locked ) { local_irq_restore ( flags , NULL ) ; return 0 ; } stdma_locked = 1 ; stdma_isr = handler ; stdma_isr_data = data ; local_irq_restore ( flags ) ; return 1 ; } 