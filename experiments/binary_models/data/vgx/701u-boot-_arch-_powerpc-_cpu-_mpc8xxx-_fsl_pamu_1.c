int pamu_init ( void ) { u32 base_addr = CFG_SYS_PAMU_ADDR ; struct ccsr_pamu * regs ; u32 i = 0 ; u64 ppaact_phys , ppaact_lim , ppaact_size ; u64 spaact_phys , spaact_lim , spaact_size ; ppaact_size = sizeof ( paace ) * NUM_PPAACT_ENTRIES ; spaact_size = sizeof ( paace ) * NUM_SPAACT_ENTRIES ; ppaact = ( void * ) CFG_SPL_PPAACT_ADDR ; ppaact = memalign ( PAMU_TABLE_ALIGNMENT , ppaact_size ) ; if ( ! ppaact ) { return - 1 ; } memset ( ppaact , 0 , ppaact_size ) ; sec = ( void * ) CFG_SPL_SPAACT_ADDR ; sec = memalign ( PAMU_TABLE_ALIGNMENT , spaact_size ) ; if ( ! sec ) { return - 1 ; } ppaact_phys = virt_to_phys ( ( void * ) ppaact ) ; ppaact_lim = ppaact_phys + ppaact_size ; spaact_phys = ( uint64_t ) virt_to_phys ( ( void * ) sec ) ; spaact_lim = spaact_phys + spaact_size ; for ( i = 0 ; i < CFG_NUM_PAMU ; i ++ ) { regs = ( ccsr_pamu * ) base_addr ; out_be32 ( & regs -> ppbah , ppaact_phys >> 32 ) ; out_be32 ( & regs -> ppbal , ( uint32_t ) ppaact_phys ) ; out_be32 ( & regs -> pplah , ( ppaact_lim ) >> 32 ) ; out_be32 ( & regs -> pplal , ( uint32_t ) ppaact_lim ) ; if ( sec != NULL ) { out_be32 ( & regs -> spbah , spaact_phys >> 32 ) ; out_be32 ( & regs -> spbal , ( uint32_t ) spaact_phys ) ; out_be32 ( & regs -> splah , spaact_lim >> 32 ) ; out_be32 ( & regs -> splal , ( uint32_t ) spaact_lim ) ; } sync ( ) ; base_addr += PAMU_OFFSET ; } return 0 ; } 