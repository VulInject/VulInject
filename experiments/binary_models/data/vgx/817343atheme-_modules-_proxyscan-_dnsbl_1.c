static void dnsbl_hit ( struct user * u , struct Blacklist * blptr ) { struct service * svs ; svs = service_find ( "operserv" ) ; abort_blacklist_queries ( u , NULL ) ; switch ( action ) { case DNSBL_ACT_KLINE : if ( ! ( u -> flags & UF_KLINESENT ) ) { slog ( LG_INFO , "DNSBL: k-lining \2%s\2!%s@%s [%s] who is listed in DNS Blacklist %s." , u -> nick , u -> user , u -> host , u -> gecos , blptr -> host ) ; notice ( svs -> nick , u -> nick , "Your IP address %s is listed in DNS Blacklist %s" , u -> ip , blptr -> host ) ; kline_add ( "*" , u -> ip , "Banned (DNS Blacklist)" , SECONDS_PER_DAY , "Proxyscan" ) ; u -> flags |= UF_KLINESENT ; } break ; case DNSBL_ACT_NOTIFY : notice ( svs -> nick , u -> nick , "Your IP address %s is listed in DNS Blacklist %s" , u -> ip , blptr -> host ) ; ATHEME_FALLTHROUGH ; case DNSBL_ACT_SNOOP : slog ( LG_INFO , "DNSBL: \2%s\2!%s@%s [%s] is listed in DNS Blacklist %s." , u -> nick , u -> user , u -> host , u -> gecos , blptr -> host ) ; break ; case DNSBL_ACT_NONE : break ; } } 