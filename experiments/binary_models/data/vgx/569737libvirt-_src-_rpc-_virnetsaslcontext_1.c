int virNetSASLSessionClientStart ( virNetSASLSession * sasl , const char * mechlist , sasl_interact_t * * prompt_need , const char * * clientout , size_t * clientoutlen , const char * * mech ) { unsigned outlen = 0 ; int err ; int ret = - 1 ; VIR_DEBUG ( "sasl=%p mechlist=%s prompt_need=%p clientout=%p clientoutlen=%p mech=%p" , sasl , mechlist , prompt_need , clientout , clientoutlen , mech ) ; virObjectLock ( sasl , NULL ) ; err = sasl_client_start ( sasl -> conn , mechlist , prompt_need , clientout , & outlen , mech ) ; * clientoutlen = outlen ; switch ( err ) { case SASL_OK : if ( virNetSASLSessionUpdateBufSize ( sasl ) < 0 ) { cleanup } ret = VIR_NET_SASL_COMPLETE ; break ; case SASL_CONTINUE : ret = VIR_NET_SASL_CONTINUE ; break ; case SASL_INTERACT : ret = VIR_NET_SASL_INTERACT ; break ; default : virReportError ( VIR_ERR_AUTH_FAILED , _ ( "Failed to start SASL negotiation: %d (%s)" ) , err , sasl_errdetail ( sasl -> conn ) ) ; break ; } cleanup virObjectUnlock ( sasl ) ; return ret ; } 