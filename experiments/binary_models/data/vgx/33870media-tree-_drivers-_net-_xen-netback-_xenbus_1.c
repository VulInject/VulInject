static void xen_net_read_rate ( struct xenbus_device * dev , unsigned long * bytes , unsigned long * usec ) { char * s , * e ; unsigned long b , u ; char * ratestr ; * bytes = ~ 0UL ; * usec = 0 ; ratestr = xenbus_read ( XBT_NIL , dev -> nodename , "rate" , NULL ) ; if ( IS_ERR ( ratestr ) ) { return ; } s = ratestr ; b = simple_strtoul ( s , & e , 10 ) ; if ( ( s == e ) || ( * e != ',' ) ) { fail } s = e + 1 ; u = simple_strtoul ( s , & e , 10 ) ; if ( ( s == e ) || ( * e != '\0' ) ) { fail } * bytes = b ; * usec = u ; return ; fail pr_warn ( "Failed to parse network rate limit. Traffic unlimited.\n" ) ; kfree ( ratestr ) ; } 