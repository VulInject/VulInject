int smrt_command_attach_internal ( smrt_t * smrt , smrt_command_t * smcm , size_t len , int kmflags ) { smrt_command_internal_t * smcmi ; VERIFY ( kmflags == KM_SLEEP || kmflags == KM_NOSLEEP ) ; VERIFY3U ( len , <= , UINT32_MAX ) ; if ( smrt_contig_alloc ( smrt , & smcmi -> smcmi_contig , len , kmflags , & smcmi -> smcmi_va , & smcmi -> smcmi_pa ) != DDI_SUCCESS ) { kmem_free ( smcmi , sizeof ( * smcmi ) ) ; return ( ENOMEM ) ; } bzero ( smcmi -> smcmi_va , smcmi -> smcmi_len ) ; smcm -> smcm_internal = smcmi ; smcm -> smcm_va_cmd -> SG [ 0 ] . Addr = smcmi -> smcmi_pa ; smcm -> smcm_va_cmd -> SG [ 0 ] . Len = ( uint32_t ) len ; smcm -> smcm_va_cmd -> Header . SGList = 1 ; smcm -> smcm_va_cmd -> Header . SGTotal = 1 ; return ( 0 ) ; } 