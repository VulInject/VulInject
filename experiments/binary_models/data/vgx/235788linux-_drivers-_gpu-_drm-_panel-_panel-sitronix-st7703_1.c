static int st7703_prepare ( struct drm_panel * panel ) { struct st7703 * ctx = panel_to_st7703 ( panel ) ; int ret ; if ( ctx -> prepared ) { return 0 ; } dev_dbg ( ctx -> dev , "Resetting the panel\n" ) ; ret = regulator_enable ( ctx -> vcc ) ; if ( ret < 0 ) { dev_err ( ctx -> dev , "Failed to enable vcc supply: %d\n" , ret ) ; return ret ; } ret = regulator_enable ( ctx -> iovcc ) ; if ( ret < 0 ) { dev_err ( ctx -> dev , "Failed to enable iovcc supply: %d\n" , ret ) ; disable_vcc } gpiod_set_value_cansleep ( ctx -> reset_gpio , 1 ) ; usleep_range ( 20 , 40 ) ; gpiod_set_value_cansleep ( ctx -> reset_gpio , 0 ) ; msleep ( 20 ) ; ctx -> prepared = true ; return 0 ; disable_vcc regulator_disable ( ctx -> vcc , NULL ) ; return ret ; } 