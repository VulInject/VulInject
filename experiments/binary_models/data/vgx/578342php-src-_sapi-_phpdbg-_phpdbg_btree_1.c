phpdbg_btree_result * phpdbg_btree_find_closest ( phpdbg_btree * tree , zend_ulong idx ) { phpdbg_btree_branch * branch = tree -> branch ; int i = tree -> depth - 1 , last_superior_i = - 1 ; { if ( ( idx >> i ) % 2 == 0 ) { if ( branch -> branches [ 0 ] ) { CHOOSE_BRANCH ( 0 ) ; } else { if ( last_superior_i == - 1 ) { return NULL ; } branch = tree -> branch ; i = tree -> depth - 1 ; { CHOOSE_BRANCH ( ( idx >> i ) % 2 == 1 && branch -> branches [ 1 ] ) ; } -- i > last_superior_i ; CHOOSE_BRANCH ( 0 ) ; while ( i -- ) { CHOOSE_BRANCH ( branch -> branches [ 1 ] ) ; } break ; } } else { if ( branch -> branches [ 1 ] ) { if ( branch -> branches [ 0 ] ) { last_superior_i = i ; } CHOOSE_BRANCH ( 1 ) ; } else { CHOOSE_BRANCH ( 0 ) ; while ( i -- ) { CHOOSE_BRANCH ( branch -> branches [ 1 ] ) ; } break ; } } } i -- ; return & branch -> result ; } 