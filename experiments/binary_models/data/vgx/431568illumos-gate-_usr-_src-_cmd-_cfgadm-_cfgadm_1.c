static cfga_err_t setup_prefilter ( post_filter_t * post_filtp , char * * prefilt_optpp ) { int len ; const char * clopt = PREFILT_CLASS_STR ; int idx ; * prefilt_optpp = NULL ; for ( idx = 0 ; idx < N_FIELDS ; idx ++ ) { if ( strcmp ( all_fields [ idx ] . name , PREFILT_CLASS_STR ) == 0 ) { break ; } } if ( idx >= N_FIELDS || post_filtp -> match_type_p [ idx ] != CFGA_MATCH_EXACT ) { return ( CFGA_OK ) ; } len = strlen ( clopt ) + strlen ( post_filtp -> ldata . ap_class ) + 1 ; if ( ( * prefilt_optpp = config_calloc_check ( 1 , len ) ) == NULL ) { return ( CFGA_LIB_ERROR ) ; } ( void ) strcpy ( * prefilt_optpp , clopt ) ; ( void ) strcat ( * prefilt_optpp , post_filtp -> ldata . ap_class ) ; post_filtp -> match_type_p [ idx ] = CFGA_MATCH_NOFILTER ; if ( all_fields [ idx ] . set_filter != NULL ) { ( void ) all_fields [ idx ] . set_filter ( & post_filtp -> ldata , "" ) ; } return ( CFGA_OK ) ; } 