static void vioscsi_start ( vioscsi_softc_t * sc , vioscsi_request_t * req ) { vioscsi_cmd_req_t * cmd = & req -> vr_req -> cmd ; req -> vr_done = 0 ; req -> vr_expired = 0 ; cmd -> lun [ 0 ] = 1 ; cmd -> lun [ 1 ] = req -> vr_target ; cmd -> lun [ 2 ] = 0x40 | ( ( req -> vr_lun >> 8 ) & 0xff ) ; cmd -> lun [ 3 ] = req -> vr_lun & 0xff ; cmd -> lun [ 4 ] = 0 ; cmd -> lun [ 5 ] = 0 ; cmd -> lun [ 6 ] = 0 ; cmd -> lun [ 7 ] = 0 ; cmd -> tag = ( uint64_t ) req ; cmd -> prio = 0 ; cmd -> task_attr = req -> vr_task_attr ; virtio_dma_sync ( req -> vr_dma , DDI_DMA_SYNC_FORDEV ) ; if ( req -> vr_poll ) { virtio_chain_submit ( req -> vr_vic , B_TRUE ) ; vioscsi_poll ( sc , req ) ; } else { virtio_chain_submit ( req -> vr_vic , B_TRUE ) ; } } 