static int __sgx_encl_add_page ( struct sgx_encl * encl , struct sgx_encl_page * encl_page , struct sgx_epc_page * epc_page , struct sgx_secinfo * secinfo , unsigned long src ) { struct sgx_pageinfo pginfo ; struct vm_area_struct * vma ; struct page * src_page ; int ret ; vma = find_vma ( current -> mm , src ) ; if ( ! vma ) { return - EFAULT ; } ret = get_user_pages ( src , 1 , 0 , & src_page , NULL ) ; if ( ret < 1 ) { return - EFAULT ; } pginfo . secs = ( unsigned long ) sgx_get_epc_virt_addr ( encl -> secs . epc_page ) ; pginfo . addr = encl_page -> desc & PAGE_MASK ; pginfo . metadata = ( unsigned long ) secinfo ; pginfo . contents = ( unsigned long ) kmap_local_page ( src_page ) ; ret = __eadd ( & pginfo , sgx_get_epc_virt_addr ( epc_page ) ) ; kunmap_local ( ( void * ) pginfo . contents ) ; put_page ( src_page ) ; return ret ?- EIO : 0 ; } 