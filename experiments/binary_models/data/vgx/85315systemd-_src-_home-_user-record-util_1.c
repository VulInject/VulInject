int user_record_test_recovery_key ( UserRecord * h , UserRecord * secret ) { int r ; assert ( h ) ; if ( h -> n_recovery_key == 0 ) { return - ENXIO ; } STRV_FOREACH ( , ) { for ( size_t j = 0 ; j < h -> n_recovery_key ; j ++ ) { _cleanup_ ( ) char * mangled = NULL ; const char * p ; if ( streq ( h -> recovery_key [ j ] . type , "modhex64" ) ) { r = normalize_recovery_key ( * i , & mangled ) ; if ( r < 0 ) { return r ; } p = mangled ; } else { p = * i ; } r = test_password_one ( h -> recovery_key [ j ] . hashed_password , p ) ; if ( r < 0 ) { return r ; } if ( r > 0 ) { return 0 ; } } } return - ENOKEY ; } 