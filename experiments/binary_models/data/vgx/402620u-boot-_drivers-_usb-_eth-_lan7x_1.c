static int lan7x_read_eeprom ( struct usb_device * udev , u32 offset , u32 length , u8 * data ) { u32 val ; int i , ret ; ret = lan7x_eeprom_confirm_not_busy ( udev ) ; for ( i = 0 ; i < length ; i ++ ) { val = E2P_CMD_EPC_BUSY | E2P_CMD_EPC_CMD_READ | ( offset & E2P_CMD_EPC_ADDR_MASK ) ; lan7x_write_reg ( udev , E2P_CMD , val ) ; ret = lan7x_wait_eeprom ( udev ) ; if ( ret ) { return ret ; } lan7x_read_reg ( udev , E2P_DATA , & val ) ; data [ i ] = val & 0xFF ; offset ++ ; } return ret ; } 