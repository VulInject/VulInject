static krb5_error_code open_db ( krb5_context context , krb5_db2_context * dbc , int flags , int mode , DB * * db_out ) { char * fname = NULL ; DB * db ; BTREEINFO bti ; HASHINFO hashi ; bti . flags = 0 ; bti . cachesize = 0 ; bti . psize = 4096 ; bti . lorder = 0 ; bti . minkeypage = 0 ; bti . compare = NULL ; bti . prefix = NULL ; * db_out = NULL ; if ( ctx_dbsuffix ( dbc , SUFFIX_DB , & fname ) != 0 ) { return ENOMEM ; } hashi . bsize = 4096 ; hashi . cachesize = 0 ; hashi . ffactor = 40 ; hashi . hash = NULL ; hashi . lorder = 0 ; hashi . nelem = 1 ; db = dbopen ( fname , flags , mode , dbc -> hashfirst ?DB_HASH : DB_BTREE , dbc -> hashfirst ?( void * ) & hashi : ( void * ) & bti ) ; if ( db == NULL && IS_EFTYPE ( errno ) ) { db = dbopen ( fname , flags , mode , dbc -> hashfirst ?DB_BTREE : DB_HASH , dbc -> hashfirst ?( void * ) & bti : ( void * ) & hashi ) ; if ( db != NULL ) { dbc -> hashfirst = ! dbc -> hashfirst ; } } if ( db != NULL && dbc -> hashfirst ) { dbc -> unlockiter = FALSE ; } if ( db == NULL ) { k5_prependmsg ( context , errno , _ ( "Cannot open DB2 database '%s'" ) , fname ) ; } * db_out = db ; return ( db == NULL ) ?errno : 0 ; } 