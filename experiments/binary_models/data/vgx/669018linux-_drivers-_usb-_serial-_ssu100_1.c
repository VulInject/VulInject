static void ssu100_update_msr ( struct usb_serial_port * port , u8 msr ) { struct ssu100_port_private * priv = usb_get_serial_port_data ( port ) ; cfs_time_t flags ; spin_lock_irqsave ( & priv -> status_lock , flags ) ; priv -> shadowMSR = msr ; spin_unlock_irqrestore ( & priv -> status_lock , flags ) ; if ( msr & UART_MSR_ANY_DELTA ) { if ( msr & UART_MSR_DCTS ) { port -> icount . cts ++ ; } if ( msr & UART_MSR_DDSR ) { port -> icount . dsr ++ ; } if ( msr & UART_MSR_DDCD ) { port -> icount . dcd ++ ; } if ( msr & UART_MSR_TERI ) { port -> icount . rng ++ ; } wake_up_interruptible ( & port -> port . delta_msr_wait ) ; } } 