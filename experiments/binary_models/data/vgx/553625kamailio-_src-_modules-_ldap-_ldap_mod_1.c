static int ldap_result_check_fixup ( void * * param , int param_no ) { struct ldap_result_check_params * lp ; struct subst_expr * se ; str subst ; str s ; char * arg_str , * check_str ; int arg_str_len ; if ( param_no == 1 ) { arg_str = ( char * ) * param ; arg_str_len = strlen ( arg_str ) ; if ( ( check_str = strchr ( arg_str , '/' ) ) == 0 ) { LM_ERR ( "invalid first argument [%s] (no '/' found)\n" , arg_str ) ; return E_UNSPEC ; } * ( check_str ++ ) = 0 ; lp = ( ldap_result_check_params * ) pkg_malloc ( sizeof ( ldap_result_check_params ) ) ; if ( lp == NULL ) { LM_ERR ( "no memory\n" ) ; return E_OUT_OF_MEM ; } lp -> ldap_attr_name . s = arg_str ; lp -> ldap_attr_name . len = strlen ( arg_str ) ; if ( lp -> ldap_attr_name . len + 1 == arg_str_len ) { lp -> check_str_elem_p = 0 ; } else { s . s = check_str ; s . len = strlen ( s . s ) ; if ( pv_parse_format ( & s , & ( lp -> check_str_elem_p ) ) < 0 ) { LM_ERR ( "pv_parse_format failed\n" ) ; pkg_free ( lp ) ; return E_OUT_OF_MEM ; } } * param = ( void * ) lp ; } if ( param_no == 2 ) { subst . s = * param ; subst . len = strlen ( * param ) ; se = subst_parser ( & subst ) ; if ( se == 0 ) { LM_ERR ( "bad subst re [%s]\n" , ( char * ) * param ) ; return E_BAD_RE ; } * param = ( void * ) se ; } return 0 ; } 