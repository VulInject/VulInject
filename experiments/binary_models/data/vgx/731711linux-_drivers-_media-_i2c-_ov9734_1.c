static int ov9734_probe ( struct i2c_client * client ) { struct ov9734 * ov9734 ; int ret ; ret = ov9734_check_hwcfg ( & client -> dev ) ; if ( ret ) { dev_err ( & client -> dev , "failed to check HW configuration: %d" , ret ) ; return ret ; } ov9734 = devm_kzalloc ( & client -> dev , sizeof ( * ov9734 ) , GFP_KERNEL ) ; if ( ! ov9734 ) { return - ENOMEM ; } v4l2_i2c_subdev_init ( & ov9734 -> sd , client , & ov9734_subdev_ops ) ; ret = ov9734_identify_module ( ov9734 ) ; if ( ret ) { dev_err ( & client -> dev , "failed to find sensor: %d" , ret ) ; return ret ; } ov9734 -> cur_mode = & supported_modes [ 0 ] ; ret = ov9734_init_controls ( ov9734 ) ; if ( ret ) { dev_err ( & client -> dev , "failed to init controls: %d" , ret ) ; probe_error_v4l2_ctrl_handler_free } ov9734 -> sd . internal_ops = & ov9734_internal_ops ; ov9734 -> sd . flags |= V4L2_SUBDEV_FL_HAS_DEVNODE ; ov9734 -> sd . entity . ops = & ov9734_subdev_entity_ops ; ov9734 -> sd . entity . function = MEDIA_ENT_F_CAM_SENSOR ; ov9734 -> pad . flags = MEDIA_PAD_FL_SOURCE ; ret = media_entity_pads_init ( & ov9734 -> sd . entity , 1 , & ov9734 -> pad ) ; if ( ret ) { dev_err ( & client -> dev , "failed to init entity pads: %d" , ret ) ; probe_error_v4l2_ctrl_handler_free } ret = v4l2_async_register_subdev_sensor ( & ov9734 -> sd ) ; if ( ret < 0 ) { dev_err ( & client -> dev , "failed to register V4L2 subdev: %d" , ret ) ; probe_error_media_entity_cleanup } pm_runtime_set_active ( & client -> dev ) ; pm_runtime_enable ( & client -> dev ) ; pm_runtime_idle ( & client -> dev ) ; return 0 ; probe_error_media_entity_cleanup media_entity_cleanup ( & ov9734 -> sd . entity ) ; probe_error_v4l2_ctrl_handler_free v4l2_ctrl_handler_free ( ov9734 -> sd . ctrl_handler ) ; mutex_destroy ( & ov9734 -> mutex ) ; return ret ; } 