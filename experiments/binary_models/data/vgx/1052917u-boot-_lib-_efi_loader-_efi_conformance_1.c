ecpt_size = num_entries * sizeof ( efi_guid_t ) + sizeof ( efi_conformance_profiles_table ) ; ret = efi_allocate_pool ( EFI_BOOT_SERVICES_DATA , ecpt_size , ( void * * ) & ecpt ) ; if ( ret != EFI_SUCCESS ) { log_err ( "Out of memory\n" ) ; return ret ; } if ( CONFIG_IS_ENABLED ( EFI_EBBR_2_1_CONFORMANCE ) ) { guidcpy ( & ecpt -> conformance_profiles [ num_entries ++ ] , & efi_ebbr_2_1_guid ) ; } ecpt -> version = EFI_CONFORMANCE_PROFILES_TABLE_VERSION ; ecpt -> number_of_profiles = num_entries ; ret = efi_install_configuration_table ( & efi_ecpt_guid , ( void * ) ecpt ) ; if ( ret != EFI_SUCCESS ) { log_err ( "Failed to install ECPT\n" ) ; return ret ; } log_debug ( "ECPT created\n" ) ; return EFI_SUCCESS ; 