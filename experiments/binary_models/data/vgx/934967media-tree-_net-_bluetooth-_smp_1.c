bool smp_irk_matches ( struct hci_dev * hdev , const u8 irk [ 16 ] , const bdaddr_t * bdaddr ) { struct l2cap_chan * chan = hdev -> smp_data ; struct smp_dev * smp ; int hash [ 3 ] ; int err ; if ( ! chan || ! chan -> data ) { return false ; } smp = chan -> data ; BT_DBG ( "RPA %pMR IRK %*phN" , bdaddr , 16 , irk ) ; err = smp_ah ( smp -> tfm_aes , irk , & bdaddr -> b [ 3 ] , hash ) ; if ( err ) { return false ; } return ! memcmp ( bdaddr -> b , hash , 3 ) ; } 