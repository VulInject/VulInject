const char * M_xml_xpath_text_first ( M_xml_node_t * node , const char * search ) { M_xml_node_t * * matches = NULL ; M_xml_node_t * match ; const char * text = NULL ; size_t num_matches = 0 ; size_t num_children ; int i ; matches = M_xml_xpath ( node , search , M_XML_READER_NONE , & num_matches ) ; if ( matches != NULL && num_matches > 0 ) { match = matches [ 0 ] ; if ( M_xml_node_type ( match ) == M_XML_NODE_TYPE_TEXT ) { text = M_xml_node_text ( match ) ; } num_children = M_xml_node_num_children ( match ) ; for ( i = 0 ; i < num_children ; i ++ ) { if ( M_xml_node_type ( M_xml_node_child ( match , i ) ) == M_XML_NODE_TYPE_TEXT ) { text = M_xml_node_text ( M_xml_node_child ( match , i ) ) ; break ; } } } M_free ( matches ) ; if ( text == NULL && num_matches > 0 ) { text = "" ; } return text ; } 