MOCK_IMPL ( , , ) { int r ; if ( ! len && ! ( zlib < 0 ) ) { return ; } if ( ! connection_may_write_to_buf ( conn ) ) { return ; } if ( zlib ) { dir_connection_t * dir_conn = TO_DIR_CONN ( conn ) ; int done = zlib < 0 ; CONN_LOG_PROTECT ( conn , r = buf_add_compress ( conn -> outbuf , dir_conn -> compress_state , string , len , done ) ) ; } else { CONN_LOG_PROTECT ( conn , r = buf_add ( conn -> outbuf , string , len ) ) ; } if ( r < 0 ) { connection_write_to_buf_failed ( conn , NULL ) ; return ; } connection_write_to_buf_commit ( conn ) ; } 