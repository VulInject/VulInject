static rsRetVal smsg_to_json ( GList * list , instanceData * pData ) { GList * it = list ; struct json_object * json ; struct json_object * jval ; DEFiRet ; json = json_object_new_object ( ) ; if ( json == NULL ) { ABORT_FINALIZE ( RS_RET_ERR ) ; } for ( ; it ; it = it -> next ) { int key_len = ( ( result_t * ) it -> data ) -> key_len ; char * key = ( char * ) malloc ( key_len + 1 ) ; snprintf ( key , key_len + 1 , "%.*s" , key_len , ( ( result_t * ) it -> data ) -> key ) ; int value_len = ( ( result_t * ) it -> data ) -> value_len ; char * value = ( char * ) malloc ( value_len + 1 ) ; snprintf ( value , value_len + 1 , "%.*s" , value_len , ( ( result_t * ) it -> data ) -> value ) ; jval = json_object_new_string ( value ) ; json_object_object_add ( json , key , jval ) ; free ( key ) ; } msgAddJSON ( pData -> pmsg , ( uchar * ) pData -> pszTarget , json , 0 , 0 ) ; finalize_it RETiRet ; } 