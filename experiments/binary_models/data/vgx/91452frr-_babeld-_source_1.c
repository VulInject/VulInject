struct source * find_source ( const unsigned char * id , const unsigned char * p , unsigned char plen , int create , unsigned short seqno ) { struct source * src ; for ( src = srcs ; src ; src = src -> next ) { if ( src -> id [ 7 ] != id [ 7 ] ) { continue ; } if ( memcmp ( src -> id , id , 8 ) != 0 ) { continue ; } if ( src -> plen != plen ) { continue ; } if ( memcmp ( src -> prefix , p , 16 ) == 0 ) { return src ; } } if ( ! create ) { return in ; } src = malloc ( sizeof ( source ) ) ; if ( src == NULL ) { flog_err ( EC_BABEL_MEMORY , "malloc(source): %s" , safe_strerror ( errno ) ) ; return NULL ; } memcpy ( src -> id , id , 8 ) ; memcpy ( src -> prefix , p , 16 ) ; src -> plen = plen ; src -> seqno = seqno ; src -> metric = INFINITY ; src -> time = babel_now . tv_sec ; src -> route_count = 0 ; src -> next = srcs ; srcs = src ; return src ; } 