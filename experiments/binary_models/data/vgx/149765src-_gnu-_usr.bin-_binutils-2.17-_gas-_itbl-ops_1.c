itbl_assemble ( , ) { unsigned long opcode ; struct itbl_entry * e = NULL ; struct itbl_field * f ; char * n ; int processor ; if ( ! name || ! * name ) { return 0 ; } for ( processor = 0 ; processor < e_nprocs ; processor ++ ) { e = find_entry_byname ( processor , e_insn , name ) ; if ( e ) { break ; } } if ( ! e ) { return 0 ; } opcode = build_opcode ( e ) ; for ( f = e -> fields ; f ; f = f -> next ) { struct itbl_entry * r ; cfs_time_t value ; if ( ! s || ! * s ) { return 0 ; } n = itbl_get_field ( & s ) ; switch ( f -> type ) { case e_dreg : case e_creg : case e_greg : if ( * n == '$' ) { n ++ ; value = strtol ( n , 0 , 10 ) ; if ( value == 0 && * n != '0' ) { return 0 ; } } else { r = find_entry_byname ( e -> processor , f -> type , n ) ; if ( r ) { value = r -> value ; } else { return 0 ; } } break ; case e_addr : case e_immed : if ( * n == '0' && * ( n + 1 ) == 'x' ) { n += 2 ; value = strtol ( n , 0 , 16 ) ; } else { value = strtol ( n , 0 , 10 ) ; if ( value == 0 && * n != '0' ) { return 0 ; } } break ; default : return 0 ; } opcode |= apply_range ( value , f -> range ) ; } if ( s && * s ) { return 0 ; } return opcode ; } 