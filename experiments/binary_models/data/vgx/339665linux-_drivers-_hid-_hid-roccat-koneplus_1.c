static ssize_t koneplus_sysfs_set_actual_profile ( struct device * dev , struct device_attribute * attr , char const * buf , size_t size ) { struct koneplus_device * koneplus ; struct usb_device * usb_dev ; unsigned long profile ; int retval ; struct koneplus_roccat_report roccat_report ; dev = dev -> parent -> parent ; koneplus = hid_get_drvdata ( dev_get_drvdata ( dev ) ) ; usb_dev = interface_to_usbdev ( to_usb_interface ( dev ) ) ; retval = kstrtoul ( buf , 10 , & profile ) ; if ( retval ) { return retval ; } mutex_lock ( & koneplus -> koneplus_lock ) ; retval = koneplus_set_actual_profile ( usb_dev , profile ) ; if ( retval ) { mutex_unlock ( & koneplus -> koneplus_lock ) ; return retval ; } koneplus_profile_activated ( koneplus , profile ) ; roccat_report . type = KONEPLUS_MOUSE_REPORT_BUTTON_TYPE_PROFILE ; roccat_report . data1 = profile + 1 ; roccat_report . data2 = 0 ; roccat_report . profile = profile + 1 ; roccat_report_event ( koneplus -> chrdev_minor , ( uint8_t const * ) & roccat_report ) ; mutex_unlock ( & koneplus -> koneplus_lock ) ; return size ; } 