int imx_media_init_mbus_fmt ( struct v4l2_mbus_framefmt * mbus , u32 width , u32 height , u32 code , u32 field , const struct imx_media_pixfmt * * cc ) { const struct imx_media_pixfmt * lcc ; mbus -> width = width ; mbus -> height = height ; mbus -> field = field ; if ( code == 0 ) { imx_media_enum_mbus_formats ( & code , 0 , PIXFMT_SEL_YUV ) ; } lcc = imx_media_find_mbus_format ( code , PIXFMT_SEL_ANY ) ; if ( ! lcc ) { lcc = imx_media_find_ipu_format ( code , PIXFMT_SEL_YUV_RGB ) ; } mbus -> code = code ; mbus -> colorspace = V4L2_COLORSPACE_SRGB ; mbus -> xfer_func = V4L2_MAP_XFER_FUNC_DEFAULT ( mbus -> colorspace ) ; mbus -> ycbcr_enc = V4L2_MAP_YCBCR_ENC_DEFAULT ( mbus -> colorspace ) ; mbus -> quantization = V4L2_MAP_QUANTIZATION_DEFAULT ( lcc -> cs == IPUV3_COLORSPACE_RGB , mbus -> colorspace , mbus -> ycbcr_enc ) ; if ( cc ) { * cc = lcc ; } return 0 ; } 