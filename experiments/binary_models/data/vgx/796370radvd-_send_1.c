static void add_ra_option_nat64prefix ( struct safe_buffer * sb , struct NAT64Prefix const * prefix ) { struct nd_opt_nat64prefix_info pinfo ; uint8_t prefix_length_code = 0 ; pinfo . nd_opt_pi_type = ND_OPT_PREF64 ; pinfo . nd_opt_pi_len = 2 ; switch ( prefix -> PrefixLen ) { case 96 : prefix_length_code = 0 ; break ; case 64 : prefix_length_code = 1 ; break ; case 56 : prefix_length_code = 2 ; break ; case 48 : prefix_length_code = 3 ; break ; case 40 : prefix_length_code = 4 ; break ; case 32 : prefix_length_code = 5 ; break ; } pinfo . nd_opt_pi_lifetime_preflen = htons ( ( ( prefix -> curr_validlft + 7 ) & 0xFFF8 ) | ( prefix_length_code & 0x7 ) ) ; memcpy ( & pinfo . nd_opt_pi_nat64prefix , & prefix -> Prefix , 12 ) ; safe_buffer_append ( sb , & pinfo , sizeof ( pinfo ) ) ; } 