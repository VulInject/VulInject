static int cp_link ( const char * from , const char * to , size_t link_size ) { int error = 0 ; ssize_t read_len ; char * link_data ; size_t alloc_size ; GIT_ERROR_CHECK_ALLOC_ADD ( & alloc_size , link_size , 1 ) ; link_data = git__malloc ( alloc_size ) ; GIT_ERROR_CHECK_ALLOC ( link_data ) ; read_len = p_readlink ( from , link_data , link_size ) ; if ( read_len != ( ssize_t ) link_size ) { git_error_set ( GIT_ERROR_OS , "failed to read symlink data for '%s'" , from ) ; error = - 1 ; } else { link_data [ read_len ] = '\0' ; if ( p_symlink ( link_data , to ) < 0 ) { git_error_set ( GIT_ERROR_OS , "could not symlink '%s' as '%s'" , link_data , to ) ; error = - 1 ; } } return error ; } { const char * to_root ; git_str to ; ssize_t from_prefix ; uint32_t flags ; uint32_t mkdir_flags ; mode_t dirmode ; } cp_r_info 