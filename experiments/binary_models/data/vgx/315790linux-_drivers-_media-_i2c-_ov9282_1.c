static int ov9282_read_reg ( struct ov9282 * ov9282 , u16 reg , u32 len , u32 * val ) { struct i2c_client * client = v4l2_get_subdevdata ( & ov9282 -> sd ) ; struct i2c_msg msgs [ 2 ] { 0 } ; ; u8 addr_buf [ 2 ] { 0 } ; ; u8 data_buf [ 4 ] { 0 } ; ; int ret ; put_unaligned_be16 ( reg , addr_buf ) ; msgs [ 0 ] . addr = client -> addr ; msgs [ 0 ] . flags = 0 ; msgs [ 0 ] . len = ARRAY_SIZE ( addr_buf ) ; msgs [ 0 ] . buf = addr_buf ; msgs [ 1 ] . addr = client -> addr ; msgs [ 1 ] . flags = I2C_M_RD ; msgs [ 1 ] . len = len ; msgs [ 1 ] . buf = & data_buf [ 4 - len ] ; ret = i2c_transfer ( client -> adapter , msgs , ARRAY_SIZE ( msgs ) ) ; if ( ret != ARRAY_SIZE ( msgs ) ) { return - EIO ; } * val = get_unaligned_be32 ( data_buf ) ; return 0 ; } 