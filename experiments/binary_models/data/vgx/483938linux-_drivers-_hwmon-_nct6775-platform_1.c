static int nct6775_platform_probe ( struct platform_device * pdev ) { struct device * dev = & pdev -> dev ; struct nct6775_sio_data * sio_data = dev_get_platdata ( dev ) ; struct nct6775_data * data ; struct resource * res ; const struct regmap_config * regmapcfg ; if ( sio_data -> access == access_direct ) { res = platform_get_resource ( pdev , IORESOURCE_IO , 0 ) ; if ( ! devm_request_region ( & pdev -> dev , res -> start , IOREGION_LENGTH , DRVNAME ) ) { return - EBUSY ; } } data = devm_kzalloc ( & pdev -> dev , sizeof ( * data ) , GFP_KERNEL ) ; if ( ! data ) { return - ENOMEM ; } data -> kind = sio_data -> kind ; data -> sioreg = sio_data -> sioreg ; if ( sio_data -> access == access_direct ) { data -> addr = res -> start ; regmapcfg = & nct6775_regmap_config ; } else { regmapcfg = & nct6775_wmi_regmap_config ; } platform_set_drvdata ( pdev , data ) ; data -> driver_data = sio_data ; return nct6775_probe ( & pdev -> dev , data , regmapcfg ) ; } 