int mmc_app_cmd ( struct mmc_host * host , struct mmc_card * card ) { int err ; struct mmc_command cmd = { } ; if ( WARN_ON ( card && card -> host != host ) ) { return - EINVAL ; } cmd . opcode = MMC_APP_CMD ; if ( card ) { cmd . arg = card -> rca << 16 ; cmd . flags = MMC_RSP_SPI_R1 | MMC_RSP_R1 | MMC_CMD_AC ; } else { cmd . flags = MMC_RSP_SPI_R1 | MMC_RSP_R1 | MMC_CMD_BCR ; } err = mmc_wait_for_cmd ( host , & cmd , 0 ) ; if ( err ) { return err ; } if ( ! mmc_host_is_spi ( host ) && ! ( cmd . resp [ 0 ] & R1_APP_CMD ) ) { return - EOPNOTSUPP ; } return 0 ; } 