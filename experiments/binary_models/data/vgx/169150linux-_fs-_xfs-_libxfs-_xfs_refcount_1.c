int xfs_refcount_get_rec ( struct xfs_btree_cur * cur , struct xfs_refcount_irec * irec , int * stat ) { struct xfs_mount * mp = cur -> bc_mp ; struct xfs_perag * pag = cur -> bc_ag . pag ; union xfs_btree_rec * rec ; int error ; error = xfs_btree_get_rec ( cur , & rec , stat ) ; xfs_refcount_btrec_to_irec ( rec , irec ) ; if ( irec -> rc_blockcount == 0 || irec -> rc_blockcount > MAXREFCEXTLEN ) { out_bad_rec } if ( ! xfs_refcount_check_domain ( irec ) ) { out_bad_rec } if ( ! xfs_verify_agbext ( pag , irec -> rc_startblock , irec -> rc_blockcount ) ) { out_bad_rec } if ( irec -> rc_refcount == 0 || irec -> rc_refcount > MAXREFCOUNT ) { out_bad_rec } trace_xfs_refcount_get ( cur -> bc_mp , pag -> pag_agno , irec ) ; return 0 ; out_bad_rec xfs_warn ( mp , "Refcount BTree record corruption in AG %d detected!" , pag -> pag_agno ) ; xfs_warn ( mp , "Start block 0x%x, block count 0x%x, references 0x%x" , irec -> rc_startblock , irec -> rc_blockcount , irec -> rc_refcount ) ; return - EFSCORRUPTED ; } 