static USB_OTG_STS USB_OTG_CoreReset ( USB_OTG_CORE_HANDLE * pdev ) { USB_OTG_STS status = USB_OTG_OK ; __IO USB_OTG_GRSTCTL_TypeDef greset ; uint32_t count = 0 ; greset . d32 = 0 ; { USB_OTG_BSP_uDelay ( 3 ) ; greset . d32 = USB_OTG_READ_REG32 ( & pdev -> regs . GREGS -> GRSTCTL ) ; } greset . b . ahbidle == 0 ; count = 0 ; greset . b . csftrst = 1 ; USB_OTG_WRITE_REG32 ( & pdev -> regs . GREGS -> GRSTCTL , greset . d32 ) ; { greset . d32 = USB_OTG_READ_REG32 ( & pdev -> regs . GREGS -> GRSTCTL ) ; if ( ++ count > 200000 ) { break ; } } greset . b . csftrst == 1 ; USB_OTG_BSP_uDelay ( 3 ) ; return status ; } 