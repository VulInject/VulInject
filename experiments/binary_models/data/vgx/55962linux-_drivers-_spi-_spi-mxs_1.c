static int mxs_spi_remove ( struct platform_device * pdev ) { struct spi_master * master ; struct mxs_spi * spi ; struct mxs_ssp * ssp ; master = platform_get_drvdata ( pdev ) ; spi = spi_master_get_devdata ( master , NULL ) ; ssp = & spi -> ssp ; pm_runtime_disable ( & pdev -> dev ) ; if ( ! pm_runtime_status_suspended ( & pdev -> dev ) ) { mxs_spi_runtime_suspend ( & pdev -> dev ) ; } dma_release_channel ( ssp -> dmach ) ; return 0 ; } 