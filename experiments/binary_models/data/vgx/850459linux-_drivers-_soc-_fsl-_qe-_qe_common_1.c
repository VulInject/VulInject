void cpm_muram_free ( s32 offset ) { unsigned long flags ; int size ; struct muram_block * tmp ; size = 0 ; spin_lock_irqsave ( & cpm_muram_lock , flags ) ; list_for_each_entry ( , , ) { if ( tmp -> start == offset ) { size = tmp -> size ; list_del ( & tmp -> head ) ; kfree ( tmp ) ; break ; } } gen_pool_free ( muram_pool , offset + GENPOOL_OFFSET , size ) ; spin_unlock_irqrestore ( & cpm_muram_lock , flags ) ; } 