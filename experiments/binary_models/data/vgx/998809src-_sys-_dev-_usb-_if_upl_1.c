int upl_newbuf ( struct upl_softc * sc , struct upl_chain * c , struct mbuf * m ) { struct mbuf * m_new = NULL ; DPRINTFN ( 8 , ( "%s: %s: enter\n" , sc -> sc_dev . dv_xname , __func__ ) ) ; if ( m == NULL ) { MGETHDR ( m_new , M_DONTWAIT , MT_DATA ) ; if ( m_new == NULL ) { printf ( "%s: no memory for rx list " "-- packet dropped!\n" , sc -> sc_dev . dv_xname ) ; return ( ENOBUFS ) ; } MCLGET ( m_new , M_DONTWAIT ) ; if ( ! ( m_new -> m_flags & M_EXT ) ) { printf ( "%s: no memory for rx list " "-- packet dropped!\n" , sc -> sc_dev . dv_xname ) ; return ( ENOBUFS ) ; } m_new -> m_len = m_new -> m_pkthdr . len = MCLBYTES ; } else { m_new = m ; m_new -> m_len = m_new -> m_pkthdr . len = MCLBYTES ; m_new -> m_data = m_new -> m_ext . ext_buf ; } c -> upl_mbuf = m_new ; return ( 0 ) ; } 