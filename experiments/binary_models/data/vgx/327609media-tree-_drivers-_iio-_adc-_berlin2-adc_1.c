static irqreturn_t berlin2_adc_irq ( int irq , void * private ) { struct berlin2_adc_priv * priv = iio_priv ( private ) ; int val ; regmap_read ( priv -> regmap , BERLIN2_SM_ADC_STATUS , & val ) ; if ( val & BERLIN2_SM_ADC_STATUS_DATA_RDY_MASK ) { regmap_read ( priv -> regmap , BERLIN2_SM_ADC_DATA , & priv -> data ) ; priv -> data &= BERLIN2_SM_ADC_MASK ; val &= ~ BERLIN2_SM_ADC_STATUS_DATA_RDY_MASK ; regmap_write ( priv -> regmap , BERLIN2_SM_ADC_STATUS , val ) ; priv -> data_available = true ; wake_up_interruptible ( & priv -> wq ) ; } return IRQ_HANDLED ; } 