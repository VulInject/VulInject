static int ctrls_handle_get ( pr_ctrls_t * ctrl , int reqargc , char * * reqargv ) { if ( reqargc == 0 || reqargv == NULL ) { pr_ctrls_add_response ( ctrl , "get: missing required parameters" ) ; return PR_CTRLS_STATUS_WRONG_PARAMETERS ; } if ( strcmp ( reqargv [ 0 ] , "config" ) == 0 ) { if ( reqargc >= 2 ) { register int i = 0 ; for ( i = 1 ; i < reqargc ; i ++ ) { config_rec * c = NULL ; c = find_config ( main_server -> conf , CONF_PARAM , reqargv [ i ] , FALSE ) ; if ( c != NULL ) { pr_ctrls_add_response ( ctrl , "%s: not retrievable" , reqargv [ i ] ) ; } else { pr_ctrls_add_response ( ctrl , "%s: directive not found" , reqargv [ i ] ) ; } } } else { pr_ctrls_add_response ( ctrl , "%s: missing parameters" , reqargv [ 0 ] ) ; return PR_CTRLS_STATUS_WRONG_PARAMETERS ; } } if ( strcmp ( reqargv [ 0 ] , "directives" ) == 0 ) { conftable * conftab ; int stash_idx = - 1 ; int stash_hash = 0 ; if ( reqargc != 1 ) { pr_ctrls_add_response ( ctrl , "%s: wrong number of parameters" , reqargv [ 0 ] ) ; return PR_CTRLS_STATUS_WRONG_PARAMETERS ; } conftab = pr_stash_get_symbol2 ( PR_SYM_CONF , NULL , NULL , & stash_idx , & stash_hash ) ; while ( stash_idx != - 1 ) { pr_signals_handle ( ) ; if ( conftab != NULL ) { pr_ctrls_add_response ( ctrl , "%s (mod_%s.c)" , conftab -> directive , conftab -> m -> name ) ; } else { stash_idx ++ ; } conftab = pr_stash_get_symbol2 ( PR_SYM_CONF , NULL , conftab , & stash_idx , & stash_hash ) ; } qsort ( ctrl -> ctrls_cb_resps -> elts , ctrl -> ctrls_cb_resps -> nelts , sizeof ( char * ) , respcmp ) ; } else { pr_ctrls_add_response ( ctrl , "unknown get type requested: '%s'" , reqargv [ 0 ] ) ; return PR_CTRLS_STATUS_UNSUPPORTED_OPERATION ; } return PR_CTRLS_STATUS_OK ; } 