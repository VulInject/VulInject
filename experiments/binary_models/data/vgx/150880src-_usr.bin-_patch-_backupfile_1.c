char * find_backup_file_name ( const char * file ) { char * dir , * base_versions , * tmp_file ; int highest_backup ; tmp_file = strdup ( file ) ; if ( tmp_file == NULL ) { return NULL ; } base_versions = concat ( basename ( tmp_file ) , ".~" ) ; free ( tmp_file ) ; if ( base_versions == NULL ) { return NULL ; } tmp_file = strdup ( file ) ; if ( tmp_file == NULL ) { free ( base_versions ) ; return NULL ; } dir = dirname ( tmp_file ) ; if ( dir == NULL ) { free ( base_versions ) ; free ( tmp_file ) ; return NULL ; } highest_backup = max_backup_version ( base_versions , dir ) ; free ( base_versions ) ; free ( tmp_file ) ; if ( backup_type == numbered_existing && highest_backup == 0 ) { return concat ( file , simple_backup_suffix ) ; } return make_version_name ( file , highest_backup + 1 ) ; } 