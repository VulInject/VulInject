static int ospf6_show_summary_address ( struct vty * vty , struct ospf6 * ospf6 , json_object * json , bool uj , const char * detail ) { struct route_node * rn ; static const char header [ ] "Summary-address       Metric-type     Metric     Tag         External_Rt_count\n" ; ; json_object * json_vrf = NULL ; if ( ! uj ) { ospf6_show_vrf_name ( vty , ospf6 , json_vrf ) ; vty_out ( vty , "aggregation delay interval :%u(in seconds)\n\n" , ospf6 -> aggr_delay_interval ) ; vty_out ( vty , "%s\n" , header ) ; } else { json_vrf = json_object_new_object ( ) ; ospf6_show_vrf_name ( vty , ospf6 , json_vrf ) ; json_object_int_add ( json_vrf , "aggregationDelayInterval" , ospf6 -> aggr_delay_interval ) ; } for ( rn = route_top ( ospf6 -> rt_aggr_tbl ) ; rn ; rn = route_next ( rn ) ) { struct ospf6_external_aggr_rt * aggr = rn -> info ; json_object * json_aggr = NULL ; char buf [ PREFIX2STR_BUFFER ] ; prefix2str ( & aggr -> p , buf , sizeof ( buf ) ) ; if ( uj ) { json_aggr = json_object_new_object ( ) ; json_object_object_add ( json_vrf , buf , json_aggr ) ; json_object_string_add ( json_aggr , "summaryAddress" , buf ) ; json_object_string_add ( json_aggr , "metricType" , ( aggr -> mtype == DEFAULT_METRIC_TYPE ) ?"E2" : "E1" ) ; json_object_int_add ( json_aggr , "Metric" , ( aggr -> metric != - 1 ) ?aggr -> metric : DEFAULT_DEFAULT_METRIC ) ; json_object_int_add ( json_aggr , "Tag" , aggr -> tag ) ; json_object_int_add ( json_aggr , "externalRouteCount" , OSPF6_EXTERNAL_RT_COUNT ( aggr ) ) ; if ( OSPF6_EXTERNAL_RT_COUNT ( aggr ) && detail ) { json_object_int_add ( json_aggr , "ID" , aggr -> id ) ; json_object_int_add ( json_aggr , "Flags" , aggr -> aggrflags ) ; hash_walk ( aggr -> match_extnl_hash , ospf6_print_json_external_routes_walkcb , json_aggr ) ; } } else { vty_out ( vty , "%-22s" , buf ) ; ( aggr -> mtype == DEFAULT_METRIC_TYPE ) ?vty_out ( vty , "%-16s" , "E2" ) : vty_out ( vty , "%-16s" , "E1" ) ; vty_out ( vty , "%-11d" , ( aggr -> metric != - 1 ) ?aggr -> metric : DEFAULT_DEFAULT_METRIC ) ; vty_out ( vty , "%-12u" , aggr -> tag ) ; vty_out ( vty , "%-5ld\n" , OSPF6_EXTERNAL_RT_COUNT ( aggr ) ) ; if ( OSPF6_EXTERNAL_RT_COUNT ( aggr ) && detail ) { vty_out ( vty , "Matched External routes:\n" ) ; hash_walk ( aggr -> match_extnl_hash , ospf6_print_vty_external_routes_walkcb , vty ) ; vty_out ( vty , "\n" ) ; } vty_out ( vty , "\n" ) ; } } if ( uj ) { json_object_object_add ( json , ospf6 -> name , json_vrf ) ; } return CMD_SUCCESS ; } 