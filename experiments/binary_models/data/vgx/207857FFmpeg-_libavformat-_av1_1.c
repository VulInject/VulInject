int ff_av1_filter_obus_buf ( const uint8_t * in , uint8_t * * out , int * size , int * offset ) { FFIOContext pb ; uint8_t * buf ; int len , off , ret ; len = ret = av1_filter_obus ( NULL , in , * size , & off ) ; if ( ret < 0 ) { return ret ; } if ( off >= 0 ) { * out = ( uint8_t * ) in ; * size = len ; * offset = off ; return 0 ; } buf = av_malloc ( len + AV_INPUT_BUFFER_PADDING_SIZE ) ; ffio_init_context ( & pb , buf , len , 1 , NULL , NULL , NULL , NULL ) ; ret = av1_filter_obus ( & pb . pub , in , * size , NULL ) ; av_assert1 ( ret == len ) ; memset ( buf + len , 0 , AV_INPUT_BUFFER_PADDING_SIZE ) ; * out = buf ; * size = len ; * offset = 0 ; return 0 ; } 