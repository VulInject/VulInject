int bus_space_map ( bus_space_tag_t t , bus_addr_t bpa , bus_size_t size , int flags , bus_space_handle_t * bshp ) { int error ; if ( bpa < POWERPC_BUS_TAG_BASE ( t ) ) { bpa += POWERPC_BUS_TAG_BASE ( t ) ; } if ( ( error = extent_alloc_region ( devio_ex , bpa , size , EX_NOWAIT | ( ppc_malloc_ok ?EX_MALLOCOK : 0 ) ) ) ) { return error ; } if ( ( error = bus_mem_add_mapping ( bpa , size , flags , bshp ) ) ) { if ( extent_free ( devio_ex , bpa , size , EX_NOWAIT | ( ppc_malloc_ok ?EX_MALLOCOK : 0 ) ) ) { printf ( "bus_space_map: pa 0x%lx, size 0x%lx\n" , bpa , size ) ; printf ( "bus_space_map: can't free region\n" ) ; } } return error ; } 