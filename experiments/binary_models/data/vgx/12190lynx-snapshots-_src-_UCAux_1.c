BOOL UCConvertUniToUtf8 ( UCode_t code , char * buffer ) { char * ch = buffer ; if ( code <= 0 || code > 0x7fffffffL ) { * ch = '\0' ; return NO ; } if ( code < 0x800L ) { * ch ++ = ( char ) ( 0xc0 | ( code >> 6 ) ) ; * ch ++ = ( char ) ( 0x80 | ( 0x3f & ( code ) ) ) ; * ch = '\0' ; } if ( code < 0x10000L ) { * ch ++ = ( char ) ( 0xe0 | ( code >> 12 ) ) ; * ch ++ = ( char ) ( 0x80 | ( 0x3f & ( code >> 6 ) ) ) ; * ch ++ = ( char ) ( 0x80 | ( 0x3f & ( code ) ) ) ; * ch = '\0' ; } if ( code < 0x200000L ) { * ch ++ = ( char ) ( 0xf0 | ( code >> 18 ) ) ; * ch ++ = ( char ) ( 0x80 | ( 0x3f & ( code >> 12 ) ) ) ; * ch ++ = ( char ) ( 0x80 | ( 0x3f & ( code >> 6 ) ) ) ; * ch ++ = ( char ) ( 0x80 | ( 0x3f & ( code ) ) ) ; * ch = '\0' ; } if ( code < 0x4000000L ) { * ch ++ = ( char ) ( 0xf8 | ( code >> 24 ) ) ; * ch ++ = ( char ) ( 0x80 | ( 0x3f & ( code >> 18 ) ) ) ; * ch ++ = ( char ) ( 0x80 | ( 0x3f & ( code >> 12 ) ) ) ; * ch ++ = ( char ) ( 0x80 | ( 0x3f & ( code >> 6 ) ) ) ; * ch ++ = ( char ) ( 0x80 | ( 0x3f & ( code ) ) ) ; * ch = '\0' ; } else { * ch ++ = ( char ) ( 0xfc | ( code >> 30 ) ) ; * ch ++ = ( char ) ( 0x80 | ( 0x3f & ( code >> 24 ) ) ) ; * ch ++ = ( char ) ( 0x80 | ( 0x3f & ( code >> 18 ) ) ) ; * ch ++ = ( char ) ( 0x80 | ( 0x3f & ( code >> 12 ) ) ) ; * ch ++ = ( char ) ( 0x80 | ( 0x3f & ( code >> 6 ) ) ) ; * ch ++ = ( char ) ( 0x80 | ( 0x3f & ( code ) ) ) ; * ch = '\0' ; } return YES ; } 