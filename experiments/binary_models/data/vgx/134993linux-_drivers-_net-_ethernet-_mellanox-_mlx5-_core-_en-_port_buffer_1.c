static int update_buffer_lossy ( struct mlx5_core_dev * mdev , unsigned int max_mtu , u8 pfc_en , u8 * buffer , u32 xoff , u16 port_buff_cell_sz , struct mlx5e_port_buffer * port_buffer , bool * change ) { bool changed = false ; u8 lossy_count ; u8 prio_count ; u8 lossy ; int prio ; int err ; int i ; for ( i = 0 ; i < MLX5E_MAX_BUFFER ; i ++ ) { prio_count = 0 ; lossy_count = 0 ; for ( prio = 0 ; prio < MLX5E_MAX_PRIORITY ; prio ++ ) { if ( buffer [ prio ] != i ) { continue ; } prio_count ++ ; lossy_count += ! ( pfc_en & ( 1 << prio ) ) ; } if ( lossy_count == prio_count ) { lossy = 1 ; } else { lossy = 0 ; } if ( lossy != port_buffer -> buffer [ i ] . lossy ) { port_buffer -> buffer [ i ] . lossy = lossy ; changed = true ; } } if ( changed ) { err = port_update_pool_cfg ( mdev , port_buffer ) ; err = update_xoff_threshold ( port_buffer , xoff , max_mtu , port_buff_cell_sz ) ; if ( err ) { return err ; } * change = true ; } return 0 ; } 