static int reserve_map ( struct device * dev , struct pinctrl_map * * map , unsigned int * reserved_maps , unsigned int * num_maps , unsigned int reserve ) { unsigned int old_num = * reserved_maps ; unsigned int new_num = * num_maps + reserve ; struct pinctrl_map * new_map ; new_map = krealloc ( * map , sizeof ( * new_map ) * new_num , GFP_KERNEL ) ; if ( ! new_map ) { dev_err ( dev , "krealloc(map) failed\n" ) ; return - ENOMEM ; } memset ( new_map + old_num , 0 , ( new_num - old_num ) * sizeof ( * new_map ) ) ; * map = new_map ; * reserved_maps = new_num ; return 0 ; } 