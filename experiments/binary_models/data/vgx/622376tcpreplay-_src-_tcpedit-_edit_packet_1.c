static uint32_t remap_ipv4 ( tcpedit_t * tcpedit , tcpr_cidr_t * cidr , const uint32_t original ) { uint32_t ipaddr = 0 , network = 0 , mask = 0 , result = 0 ; assert ( tcpedit ) ; if ( cidr -> family != AF_INET ) { return 0 ; } if ( tcpedit -> skip_broadcast && ! is_unicast_ipv4 ( tcpedit , original ) ) { return original ; } mask = 0xffffffff ; mask = mask << ( 32 - cidr -> masklen ) ; network = htonl ( cidr -> u . network ) & mask ; mask = mask ^ 0xffffffff ; ipaddr = ntohl ( original ) & mask ; result = network ^ ipaddr ; return ( htonl ( result ) ) ; } 