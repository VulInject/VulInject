static int single_request ( struct udevice * dev , int pin , int flags ) { struct single_priv * priv = dev_get_priv ( dev ) ; struct single_pdata * pdata = dev_get_plat ( dev ) ; struct single_gpiofunc_range * frange = NULL ; struct list_head * pos , * tmp ; phys_addr_t reg ; int mux_bytes ; u32 data ; if ( ! pdata -> mask ) { return - ENOTSUPP ; } list_for_each_safe ( , , ) { frange = list_entry ( pos , single_gpiofunc_range , node ) ; if ( ( pin >= frange -> offset + frange -> npins ) || pin < frange -> offset ) { continue ; } mux_bytes = pdata -> width / BITS_PER_BYTE ; reg = pdata -> base + pin * mux_bytes ; data = single_read ( dev , reg ) ; data &= ~ pdata -> mask ; data |= frange -> gpiofunc ; single_write ( dev , data , reg ) ; break ; } return 0 ; } 