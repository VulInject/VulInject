static int nvkm_fault_oneinit_buffer ( struct nvkm_fault * fault , int id ) { struct nvkm_subdev * subdev = & fault -> subdev ; struct nvkm_device * device = subdev -> device ; struct nvkm_fault_buffer * buffer ; int ret ; buffer -> fault = fault ; buffer -> id = id ; fault -> func -> buffer . info ( buffer ) ; fault -> buffer [ id ] = buffer ; nvkm_debug ( subdev , "buffer %d: %d entries\n" , id , buffer -> entries ) ; ret = nvkm_memory_new ( device , NVKM_MEM_TARGET_INST , buffer -> entries * fault -> func -> buffer . entry_size , 0x1000 , true , & buffer -> mem ) ; if ( ret ) { return ret ; } buffer -> addr = fault -> func -> buffer . pin ( buffer ) ; if ( buffer -> addr == ~ 0ULL ) { return - EFAULT ; } return 0 ; } 