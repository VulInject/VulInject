static size_t create_nodes_from_config ( void ) { icmap_iter_t iter ; char tmp_key [ ICMAP_KEYNAME_MAXLEN ] ; uint32_t node_pos ; uint32_t nodeid ; const char * iter_key ; int res ; pid_t pid ; int ret = 0 ; init_partitions ( ) ; iter = icmap_iter_init ( "nodelist.node." ) ; while ( ( iter_key = icmap_iter_next ( iter , NULL , NULL ) ) != NULL ) { res = sscanf ( iter_key , "nodelist.node.%u.%s" , & node_pos , tmp_key ) ; if ( res != 2 ) { continue ; } if ( strcmp ( tmp_key , "ring0_addr" ) != 0 ) { continue ; } snprintf ( tmp_key , ICMAP_KEYNAME_MAXLEN , "nodelist.node.%u.nodeid" , node_pos ) ; if ( icmap_get_uint32 ( tmp_key , & nodeid ) == CS_OK ) { pid = create_node ( nodeid , 0 ) ; if ( pid == ( pid_t ) - 1 ) { fprintf ( stderr , "ERR: nodeid " CS_PRI_NODE_ID " could not be spawned\n" , nodeid ) ; exit ( 1 ) ; } ret ++ ; } } icmap_iter_finalize ( iter ) ; return ret ; } 