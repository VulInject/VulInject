static DEFINE_SPINLOCK ( irqbits_lock ) ; static int irqbits ; | ( 1 << SIGUSR1 ) | ( 1 << SIGUSR2 ) | ( 1 << SIGIO ) | ( 1 << SIGURG ) | ( 1 << SIGUNUSED ) ; static irqreturn_t irq_handler ( int intno , void * dev_id ) { int irq_bit ; unsigned long flags ; spin_lock_irqsave ( & irqbits_lock , flags ) ; irq_bit = 1 << intno ; if ( ( irqbits & irq_bit ) || ! vm86_irqs [ intno ] . tsk ) { out } irqbits |= irq_bit ; if ( vm86_irqs [ intno ] . sig ) { send_sig ( vm86_irqs [ intno ] . sig , vm86_irqs [ intno ] . tsk , 1 ) ; } disable_irq_nosync ( intno , NULL ) ; spin_unlock_irqrestore ( & irqbits_lock , flags ) ; return IRQ_HANDLED ; out spin_unlock_irqrestore ( & irqbits_lock , flags ) ; return IRQ_NONE ; } 