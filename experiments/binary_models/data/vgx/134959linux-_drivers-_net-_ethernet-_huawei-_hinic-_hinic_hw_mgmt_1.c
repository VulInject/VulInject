static void mgmt_recv_msg_handler ( struct hinic_pf_to_mgmt * pf_to_mgmt , struct hinic_recv_msg * recv_msg ) { struct hinic_mgmt_msg_handle_work * mgmt_work = NULL ; mgmt_work = kzalloc ( sizeof ( * mgmt_work ) , GFP_KERNEL ) ; if ( ! mgmt_work ) { return ; } if ( recv_msg -> msg_len ) { mgmt_work -> msg = kzalloc ( recv_msg -> msg_len , GFP_KERNEL ) ; if ( ! mgmt_work -> msg ) { return ; } } mgmt_work -> pf_to_mgmt = pf_to_mgmt ; mgmt_work -> msg_len = recv_msg -> msg_len ; memcpy ( mgmt_work -> msg , recv_msg -> msg , recv_msg -> msg_len ) ; mgmt_work -> msg_id = recv_msg -> msg_id ; mgmt_work -> mod = recv_msg -> mod ; mgmt_work -> cmd = recv_msg -> cmd ; mgmt_work -> async_mgmt_to_pf = recv_msg -> async_mgmt_to_pf ; INIT_WORK ( & mgmt_work -> work , recv_mgmt_msg_work_handler ) ; queue_work ( pf_to_mgmt -> workq , & mgmt_work -> work ) ; } 