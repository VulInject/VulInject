static int npcm750_eth_start ( struct udevice * dev ) { struct eth_pdata * pdata = dev_get_plat ( dev ) ; struct npcm750_eth_dev * priv = dev_get_priv ( dev ) ; struct emc_regs * reg = priv -> emc_regs_p ; u8 * enetaddr = pdata -> enetaddr ; int ret ; writel ( readl ( & reg -> mcmdr ) & ~ MCMDR_TXON & ~ MCMDR_RXON , & reg -> mcmdr ) ; writel ( readl ( & reg -> mcmdr ) | MCMDR_SWR , & reg -> mcmdr ) ; { ret = readl ( & reg -> mcmdr ) ; } ret & MCMDR_SWR ; npcm750_rx_descs_init ( priv ) ; npcm750_tx_descs_init ( priv ) ; npcm750_set_cam ( priv , priv -> idx , enetaddr ) ; npcm750_set_global_maccmd ( priv ) ; npcm750_set_fifo_threshold ( priv , NULL ) ; ret = phy_startup ( priv -> phydev ) ; if ( ret ) { printf ( "Could not initialize PHY\n" ) ; return ret ; } npcm750_adjust_link ( reg , priv -> phydev ) ; writel ( readl ( & reg -> mcmdr ) | MCMDR_TXON | MCMDR_RXON , & reg -> mcmdr ) ; return 0 ; } 