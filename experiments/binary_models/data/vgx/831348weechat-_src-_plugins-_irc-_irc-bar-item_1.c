irc_bar_item_tls_version ( , , , , , ) { char buf [ 128 ] ; struct t_irc_server * server ; gnutls_protocol_t version ; const char * color ; ( void ) pointer ; ( void ) data ; ( void ) item ; ( void ) window ; ( void ) extra_info ; if ( ! buffer ) { return in ; } irc_buffer_get_server_and_channel ( buffer , & server , NULL ) ; if ( server && server -> is_connected ) { if ( server -> ssl_connected ) { version = gnutls_protocol_get_version ( server -> gnutls_sess ) ; switch ( version ) { case GNUTLS_TLS1_3 : color = IRC_COLOR_ITEM_TLS_VERSION_OK ; break ; case GNUTLS_TLS1_2 : color = IRC_COLOR_ITEM_TLS_VERSION_DEPRECATED ; break ; default : color = IRC_COLOR_ITEM_TLS_VERSION_INSECURE ; } snprintf ( buf , sizeof ( buf ) , "%s%s" , color , gnutls_protocol_get_name ( version ) ) ; return strdup ( buf ) ; } else { snprintf ( buf , sizeof ( buf ) , "%s%s" , IRC_COLOR_ITEM_TLS_VERSION_INSECURE , _ ( "cleartext" ) ) ; return strdup ( buf ) ; } } return NULL ; } 