static krb5_error_code krb5_rc_io_store ( krb5_context context , struct file_data * t , krb5_donot_replay * rep ) { int clientlen , serverlen , len ; char * buf , * ptr ; krb5_error_code ret ; clientlen = strlen ( rep -> client ) + 1 ; serverlen = strlen ( rep -> server ) + 1 ; len = sizeof ( clientlen ) + clientlen + sizeof ( serverlen ) + serverlen + sizeof ( rep -> cusec ) + sizeof ( rep -> ctime ) ; buf = malloc ( len ) ; if ( buf == 0 ) { return KRB5_RC_MALLOC ; } ptr = buf ; memcpy ( ptr , & clientlen , sizeof ( clientlen ) ) ; ptr += sizeof ( clientlen ) ; memcpy ( ptr , rep -> client , clientlen ) ; ptr += clientlen ; memcpy ( ptr , & serverlen , sizeof ( serverlen ) ) ; ptr += sizeof ( serverlen ) ; memcpy ( ptr , rep -> server , serverlen ) ; ptr += serverlen ; memcpy ( ptr , & rep -> cusec , sizeof ( rep -> cusec ) ) ; ptr += sizeof ( rep -> cusec ) ; memcpy ( ptr , & rep -> ctime , sizeof ( rep -> ctime ) ) ; ptr += sizeof ( rep -> ctime ) ; ret = krb5_rc_io_write ( context , & t -> d , buf , len ) ; return ret ; } 