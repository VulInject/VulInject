static int wm8523_set_bias_level ( struct snd_soc_component * component , enum snd_soc_bias_level level ) { struct wm8523_priv * wm8523 = snd_soc_component_get_drvdata ( component ) ; int ret ; switch ( level ) { case SND_SOC_BIAS_ON : break ; case SND_SOC_BIAS_PREPARE : snd_soc_component_update_bits ( component , WM8523_PSCTRL1 , WM8523_SYS_ENA_MASK , 3 ) ; break ; case SND_SOC_BIAS_STANDBY : if ( snd_soc_component_get_bias_level ( component ) == SND_SOC_BIAS_OFF ) { ret = regulator_bulk_enable ( ARRAY_SIZE ( wm8523 -> supplies ) , wm8523 -> supplies ) ; if ( ret != 0 ) { dev_err ( component -> dev , "Failed to enable supplies: %d\n" , ret ) ; return ret ; } regcache_sync ( wm8523 -> regmap , NULL ) ; snd_soc_component_update_bits ( component , WM8523_PSCTRL1 , WM8523_SYS_ENA_MASK , 1 ) ; msleep ( 100 ) ; } snd_soc_component_update_bits ( component , WM8523_PSCTRL1 , WM8523_SYS_ENA_MASK , 2 ) ; break ; case SND_SOC_BIAS_OFF : snd_soc_component_update_bits ( component , WM8523_PSCTRL1 , WM8523_SYS_ENA_MASK , 0 ) ; msleep ( 100 ) ; regulator_bulk_disable ( ARRAY_SIZE ( wm8523 -> supplies ) , wm8523 -> supplies ) ; break ; } return 0 ; } 