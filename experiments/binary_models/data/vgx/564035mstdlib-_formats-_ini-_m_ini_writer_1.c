static char * M_ini_writer_tree_to_string ( const M_ini_t * ini , const M_ini_settings_t * info ) { M_buf_t * buf ; M_ini_element_t * elem ; const char * sect_name = NULL ; const char * kv_name ; char * int_key ; const char * key ; size_t len ; size_t i ; M_ini_element_type_t type ; buf = M_buf_create ( ) ; len = M_ini_elements_len ( ini -> elements ) ; for ( i = 0 ; i < len ; i ++ ) { elem = M_ini_elements_at ( ini -> elements , i ) ; type = M_ini_element_get_type ( elem ) ; kv_name = NULL ; int_key = NULL ; key = NULL ; if ( type == M_INI_ELEMENT_TYPE_SECTION ) { sect_name = M_ini_element_section_get_name ( elem ) ; } if ( type == M_INI_ELEMENT_TYPE_KV ) { kv_name = M_ini_element_kv_get_key ( elem ) ; } if ( type == M_INI_ELEMENT_TYPE_SECTION || type == M_INI_ELEMENT_TYPE_KV ) { int_key = M_ini_full_key ( sect_name , kv_name ) ; key = M_hash_dict_get_direct ( ini -> key_lookup , int_key ) ; } M_ini_writer_write_element ( elem , key , info , buf ) ; if ( type == M_INI_ELEMENT_TYPE_SECTION ) { M_ini_writer_write_section ( sect_name , M_hash_strvp_get_direct ( ini -> sections , sect_name ) , info , ini -> key_lookup , buf ) ; } } return M_buf_finish_str ( buf , NULL ) ; } 