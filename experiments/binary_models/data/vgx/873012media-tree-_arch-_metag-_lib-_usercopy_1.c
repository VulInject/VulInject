unsigned long raw_copy_from_user ( void * pdst , const void __user * psrc , unsigned long n ) { register char * dst asm ( "A0.2" ) pdst ; ; register const char __user * src asm ( "A1.2" ) psrc ; ; unsigned long retn = 0 ; if ( n == 0 ) { return 0 ; } if ( ( unsigned long ) src & 1 ) { __asm_copy_from_user_1 ( dst , src , retn ) ; n -- ; } if ( ( unsigned long ) dst & 1 ) { while ( n > 0 ) { __asm_copy_from_user_1 ( dst , src , retn ) ; n -- ; if ( retn ) { return retn + n ; } } } if ( ( ( unsigned long ) src & 2 ) && n >= 2 ) { __asm_copy_from_user_2 ( dst , src , retn ) ; n -= 2 ; if ( retn ) { return retn + n ; } } if ( ( unsigned long ) dst & 2 ) { while ( n >= 2 ) { __asm_copy_from_user_2 ( dst , src , retn ) ; n -= 2 ; if ( retn ) { return retn + n ; } } } if ( ! ( ( ( unsigned long ) src | ( unsigned long ) dst ) & 7 ) ) { if ( n >= RAPF_MIN_BUF_SIZE ) { __asm_copy_from_user_64bit_rapf_loop ( dst , src , retn , n , "64cuz" ) ; } while ( n >= 8 ) { __asm_copy_from_user_8x64 ( dst , src , retn ) ; n -= 8 ; if ( retn ) { return retn + n ; } } } if ( n >= RAPF_MIN_BUF_SIZE ) { __asm_copy_from_user_32bit_rapf_loop ( dst , src , retn , n , "32cuz" ) ; } if ( ! ( ( ( unsigned long ) src | ( unsigned long ) dst ) & 7 ) ) { while ( n >= 8 ) { __asm_copy_from_user_8x64 ( dst , src , retn ) ; n -= 8 ; if ( retn ) { return retn + n ; } } } while ( n >= 4 ) { __asm_copy_from_user_4 ( dst , src , retn ) ; n -= 4 ; if ( retn ) { return retn + n ; } } switch ( n ) { case 0 : break ; case 1 : __asm_copy_from_user_1 ( dst , src , retn ) ; break ; case 2 : __asm_copy_from_user_2 ( dst , src , retn ) ; break ; case 3 : __asm_copy_from_user_3 ( dst , src , retn ) ; break ; } return retn ; } 