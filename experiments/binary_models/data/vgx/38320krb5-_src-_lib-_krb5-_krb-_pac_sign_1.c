static krb5_error_code k5_insert_checksum ( krb5_context context , krb5_pac pac , krb5_ui_4 type , const krb5_keyblock * key , krb5_cksumtype * cksumtype ) { krb5_error_code ret ; size_t len ; krb5_data cksumdata ; ret = krb5int_c_mandatory_cksumtype ( context , key -> enctype , cksumtype ) ; if ( ret != 0 ) { return ret ; } ret = krb5_c_checksum_length ( context , * cksumtype , & len ) ; if ( ret != 0 ) { return ret ; } ret = k5_pac_locate_buffer ( context , pac , type , & cksumdata ) ; if ( ret == 0 ) { if ( cksumdata . length != PAC_SIGNATURE_DATA_LENGTH + len ) { return ERANGE ; } } else { cksumdata . length = PAC_SIGNATURE_DATA_LENGTH + len ; cksumdata . data = NULL ; ret = k5_pac_add_buffer ( context , pac , type , & cksumdata , TRUE , & cksumdata ) ; if ( ret != 0 ) { return ret ; } } store_32_le ( ( krb5_ui_4 ) * cksumtype , cksumdata . data ) ; return 0 ; } 