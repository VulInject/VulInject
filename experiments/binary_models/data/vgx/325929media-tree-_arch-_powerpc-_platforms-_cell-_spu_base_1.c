static int spu_request_irqs ( struct spu * spu ) { int ret = 0 ; if ( spu -> irqs [ 0 ] ) { sprintf ( spu -> irq_c0 , "spe%02d.0" , spu -> number ) ; ret = request_irq ( spu -> irqs [ 0 ] , spu_irq_class_0 , 0 , spu -> irq_c0 , spu ) ; if ( ret ) { bail0 } } if ( spu -> irqs [ 1 ] ) { snprintf ( spu -> irq_c1 , sizeof ( spu -> irq_c1 ) , "spe%02d.1" , spu -> number ) ; ret = request_irq ( spu -> irqs [ 1 ] , spu_irq_class_1 , 0 , spu -> irq_c1 , spu ) ; if ( ret ) { bail1 } } if ( spu -> irqs [ 2 ] ) { snprintf ( spu -> irq_c2 , sizeof ( spu -> irq_c2 ) , "spe%02d.2" , spu -> number ) ; ret = request_irq ( spu -> irqs [ 2 ] , spu_irq_class_2 , 0 , spu -> irq_c2 , spu ) ; if ( ret ) { bail2 } } return 0 ; bail2 if ( spu -> irqs [ 1 ] ) { free_irq ( spu -> irqs [ 1 ] , spu ) ; } bail1 if ( spu -> irqs [ 0 ] ) { free_irq ( spu -> irqs [ 0 ] , spu ) ; } bail0 return ret ; } 