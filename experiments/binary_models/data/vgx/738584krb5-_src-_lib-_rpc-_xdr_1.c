bool_t xdr_string ( XDR * xdrs , char * * cpp , u_int maxsize ) { char * sp = * cpp ; u_int size ; u_int nodesize ; switch ( xdrs -> x_op ) { case XDR_FREE : if ( sp == NULL ) { return ( TRUE ) ; } case XDR_ENCODE : size = strlen ( sp ) ; break ; case XDR_DECODE : break ; } if ( ! xdr_u_int ( xdrs , & size ) ) { return ( FALSE ) ; } nodesize = size + 1 ; switch ( xdrs -> x_op ) { case XDR_DECODE : if ( nodesize == 0 ) { return ( TRUE ) ; } if ( sp == NULL ) { * cpp = sp = ( char * ) mem_alloc ( nodesize ) ; } if ( sp == NULL ) { ( void ) fprintf ( stderr , "xdr_string: out of memory\n" ) ; return ( FALSE ) ; } sp [ size ] = 0 ; case XDR_ENCODE : return ( xdr_opaque ( xdrs , sp , size ) ) ; case XDR_FREE : mem_free ( sp , nodesize ) ; * cpp = NULL ; return ( TRUE ) ; } return ( FALSE ) ; } 