static int netdev_bridge_post_create_message ( NetDev * netdev , sd_netlink_message * req ) { Bridge * b ; int r ; assert_se ( b = BRIDGE ( netdev ) ) ; r = sd_netlink_message_open_container ( req , IFLA_LINKINFO ) ; r = sd_netlink_message_open_container_union ( req , IFLA_INFO_DATA , netdev_kind_to_string ( netdev -> kind ) ) ; if ( r < 0 ) { return r ; } if ( b -> forward_delay != USEC_INFINITY ) { r = sd_netlink_message_append_u32 ( req , IFLA_BR_FORWARD_DELAY , usec_to_jiffies ( b -> forward_delay ) ) ; if ( r < 0 ) { return r ; } } if ( b -> hello_time > 0 ) { r = sd_netlink_message_append_u32 ( req , IFLA_BR_HELLO_TIME , usec_to_jiffies ( b -> hello_time ) ) ; if ( r < 0 ) { return r ; } } if ( b -> max_age > 0 ) { r = sd_netlink_message_append_u32 ( req , IFLA_BR_MAX_AGE , usec_to_jiffies ( b -> max_age ) ) ; if ( r < 0 ) { return r ; } } if ( b -> ageing_time != USEC_INFINITY ) { r = sd_netlink_message_append_u32 ( req , IFLA_BR_AGEING_TIME , usec_to_jiffies ( b -> ageing_time ) ) ; if ( r < 0 ) { return r ; } } if ( b -> priority > 0 ) { r = sd_netlink_message_append_u16 ( req , IFLA_BR_PRIORITY , b -> priority ) ; if ( r < 0 ) { return r ; } } if ( b -> group_fwd_mask > 0 ) { r = sd_netlink_message_append_u16 ( req , IFLA_BR_GROUP_FWD_MASK , b -> group_fwd_mask ) ; if ( r < 0 ) { return r ; } } if ( b -> default_pvid != VLANID_INVALID ) { r = sd_netlink_message_append_u16 ( req , IFLA_BR_VLAN_DEFAULT_PVID , b -> default_pvid ) ; if ( r < 0 ) { return r ; } } if ( b -> mcast_querier >= 0 ) { r = sd_netlink_message_append_u8 ( req , IFLA_BR_MCAST_QUERIER , b -> mcast_querier ) ; if ( r < 0 ) { return r ; } } if ( b -> mcast_snooping >= 0 ) { r = sd_netlink_message_append_u8 ( req , IFLA_BR_MCAST_SNOOPING , b -> mcast_snooping ) ; if ( r < 0 ) { return r ; } } if ( b -> vlan_filtering >= 0 ) { r = sd_netlink_message_append_u8 ( req , IFLA_BR_VLAN_FILTERING , b -> vlan_filtering ) ; if ( r < 0 ) { return r ; } } if ( b -> vlan_protocol >= 0 ) { r = sd_netlink_message_append_u16 ( req , IFLA_BR_VLAN_PROTOCOL , htobe16 ( b -> vlan_protocol ) ) ; if ( r < 0 ) { return r ; } } if ( b -> stp >= 0 ) { r = sd_netlink_message_append_u32 ( req , IFLA_BR_STP_STATE , b -> stp ) ; if ( r < 0 ) { return r ; } } if ( b -> igmp_version > 0 ) { r = sd_netlink_message_append_u8 ( req , IFLA_BR_MCAST_IGMP_VERSION , b -> igmp_version ) ; if ( r < 0 ) { return r ; } } r = sd_netlink_message_close_container ( req ) ; if ( r < 0 ) { return r ; } r = sd_netlink_message_close_container ( req ) ; if ( r < 0 ) { return r ; } return 0 ; } 