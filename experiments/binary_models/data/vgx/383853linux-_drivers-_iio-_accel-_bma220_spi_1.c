static int bma220_read_raw ( struct iio_dev * indio_dev , struct iio_chan_spec const * chan , int * val , int * val2 , long mask ) { int ret ; u8 range_idx ; struct bma220_data * data = iio_priv ( indio_dev ) ; switch ( mask ) { case IIO_CHAN_INFO_RAW : ret = bma220_read_reg ( data -> spi_device , chan -> address ) ; * val = sign_extend32 ( ret >> chan -> scan_type . shift , chan -> scan_type . realbits - 1 ) ; return IIO_VAL_INT ; case IIO_CHAN_INFO_SCALE : ret = bma220_read_reg ( data -> spi_device , BMA220_REG_RANGE ) ; if ( ret < 0 ) { return ret ; } range_idx = ret & BMA220_RANGE_MASK ; * val = bma220_scale_table [ range_idx ] [ 0 ] ; * val2 = bma220_scale_table [ range_idx ] [ 1 ] ; return IIO_VAL_INT_PLUS_MICRO ; } return - EINVAL ; } 