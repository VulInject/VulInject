static const char * aux_upvalue ( StkId fi , int n , TValue * * val , CClosure * * owner , UpVal * * uv ) { switch ( ttype ( fi ) ) { case LUA_TCCL : { CClosure * f = clCvalue ( fi ) ; if ( ! ( 1 <= n && n <= f -> nupvalues ) ) { return in ; } * val = & f -> upvalue [ n - 1 ] ; if ( owner ) { * owner = f ; } return "" ; } case LUA_TLCL : { LClosure * f = clLvalue ( fi ) ; TString * name ; Proto * p = f -> p ; if ( ! ( 1 <= n && n <= p -> sizeupvalues ) ) { return NULL ; } * val = f -> upvals [ n - 1 ] -> v ; if ( uv ) { * uv = f -> upvals [ n - 1 ] ; } name = p -> upvalues [ n - 1 ] . name ; return ( name == NULL ) ?"(*no name)" : getstr ( name ) ; } default : return NULL ; } } 