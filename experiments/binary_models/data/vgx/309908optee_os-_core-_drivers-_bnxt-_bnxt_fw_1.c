TEE_Result bnxt_load_fw ( int chip_type ) { uint32_t size = 0 ; uintptr_t dst = 0 ; uintptr_t src = 0 ; struct bnxt_images_info bnxt_src_image_info ; vaddr_t sec_mem_dest = ( vaddr_t ) phys_to_virt ( BNXT_BUFFER_SEC_MEM , MEM_AREA_RAM_SEC , 1 ) ; memset ( & bnxt_src_image_info , 0 , sizeof ( bnxt_images_info ) ) ; if ( get_bnxt_images_info ( & bnxt_src_image_info , chip_type , sec_mem_dest ) != BNXT_SUCCESS ) { return TEE_ERROR_ITEM_NOT_FOUND ; } bnxt_handshake_clear ( ) ; bnxt_kong_halt ( ) ; bnxt_chimp_halt ( ) ; src = ( uintptr_t ) bnxt_src_image_info . bnxt_cfg_vaddr ; dst = ( uintptr_t ) BNXT_CONFIG_NS3_DEST ; size = bnxt_src_image_info . bnxt_cfg_len ; size = size / sizeof ( uint32_t ) ; memcpy32_helper ( src , dst , size , INC_SRC_ADDR ) ; src = ( uintptr_t ) bnxt_src_image_info . bnxt_bspd_cfg_vaddr ; size = bnxt_src_image_info . bnxt_bspd_cfg_len ; dst = ( uintptr_t ) BNXT_CONFIG_NS3_BSPD_DEST ; size = size / sizeof ( uint32_t ) ; memcpy32_helper ( src , dst , size , INC_SRC_ADDR ) ; bnxt_crash_config ( ( uintptr_t ) BNXT_CRASH_DUMP_INFO_NS3_BASE , BNXT_CRASH_SEC_MEM , BNXT_CRASH_LEN ) ; bnxt_load ( bnxt_src_image_info . bnxt_fw_vaddr , NULL ) ; return TEE_SUCCESS ; } 