ASN1_OCTET_STRING * PKCS12_item_i2d_encrypt ( X509_ALGOR * algor , const ASN1_ITEM * it , const char * pass , int passlen , void * obj , int zbuf ) { ASN1_OCTET_STRING * oct ; unsigned char * in = NULL ; int inlen ; if ( ! ( oct = ASN1_OCTET_STRING_new ( ) ) ) { PKCS12error ( ERR_R_MALLOC_FAILURE , NULL ) ; return NULL ; } inlen = ASN1_item_i2d ( obj , & in , it ) ; if ( ! in ) { PKCS12error ( PKCS12_R_ENCODE_ERROR ) ; err } if ( ! PKCS12_pbe_crypt ( algor , pass , passlen , in , inlen , & oct -> data , & oct -> length , 1 ) ) { PKCS12error ( PKCS12_R_ENCRYPT_ERROR ) ; err } if ( zbuf ) { explicit_bzero ( in , inlen ) ; } free ( in ) ; return oct ; err free ( in ) ; ASN1_OCTET_STRING_free ( oct ) ; return NULL ; } 