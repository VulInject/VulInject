struct net_device * __init ne_probe ( int unit ) { int this_dev ; struct net_device * dev ; this_dev = 0 ; while ( ( pdev_ne [ this_dev ] && platform_get_drvdata ( pdev_ne [ this_dev ] ) ) || io [ this_dev ] ) { if ( ++ this_dev == MAX_NE_CARDS ) { return ERR_PTR ( - ENOMEM ) ; } } dev = alloc_eip_netdev ( ) ; if ( ! dev ) { return ERR_PTR ( - ENOMEM ) ; } sprintf ( dev -> name , "eth%d" , unit ) ; netdev_boot_setup_check ( dev ) ; io [ this_dev ] = dev -> base_addr ; irq [ this_dev ] = dev -> irq ; bad [ this_dev ] = dev -> mem_end ; ne_add_devices ( ) ; for ( this_dev = 0 ; this_dev < MAX_NE_CARDS ; this_dev ++ ) { if ( pdev_ne [ this_dev ] ) { dev = platform_get_drvdata ( pdev_ne [ this_dev ] ) ; if ( dev ) { return dev ; } } } return ERR_PTR ( - ENODEV ) ; } 