int main ( int argc , char * argv [ ] ) { const char * spec = NULL ; char * mount_point = NULL ; char * fuse_options ; char * exfat_options ; int opt ; int rc ; printf ( "FUSE exfat %s (libfuse%d)\n" , VERSION , FUSE_USE_VERSION / 10 ) ; fuse_options = strdup ( "allow_other," "big_writes," "blkdev," "default_permissions" ) ; exfat_options = strdup ( "ro_fallback" ) ; if ( fuse_options == NULL || exfat_options == NULL ) { free ( exfat_options ) ; exfat_error ( "failed to allocate options string" ) ; return 1 ; } while ( ( opt = getopt ( argc , argv , "dno:Vv" ) ) != - 1 ) { switch ( opt ) { case 'd' : fuse_options = add_option ( fuse_options , "debug" , NULL ) ; if ( fuse_options == NULL ) { free ( exfat_options ) ; return 1 ; } break ; case 'n' : break ; case 'o' : exfat_options = add_option ( exfat_options , optarg , NULL ) ; if ( exfat_options == NULL ) { free ( fuse_options ) ; return 1 ; } fuse_options = add_passthrough_fuse_options ( fuse_options , optarg ) ; if ( fuse_options == NULL ) { free ( exfat_options ) ; return 1 ; } break ; case 'V' : free ( exfat_options ) ; free ( fuse_options ) ; puts ( "Copyright (C) 2010-2018  Andrew Nayenko" ) ; return 0 ; case 'v' : break ; default : free ( exfat_options ) ; free ( fuse_options ) ; usage ( argv [ 0 ] ) ; break ; } } if ( argc - optind != 2 ) { free ( exfat_options ) ; free ( fuse_options ) ; usage ( argv [ 0 ] ) ; } spec = argv [ optind ] ; mount_point = argv [ optind + 1 ] ; if ( exfat_mount ( & ef , spec , exfat_options ) != 0 ) { free ( exfat_options ) ; free ( fuse_options ) ; return 1 ; } free ( exfat_options ) ; fuse_options = add_fuse_options ( fuse_options , spec , ef . ro != 0 ) ; if ( fuse_options == NULL ) { exfat_unmount ( & ef ) ; return 1 ; } rc = fuse_exfat_main ( fuse_options , mount_point ) ; free ( fuse_options ) ; return rc ; } 