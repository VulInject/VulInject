static struct mlxsw_afa_policer * mlxsw_afa_policer_create ( struct mlxsw_afa * mlxsw_afa , u32 fa_index , u64 rate_bytes_ps , u32 burst , struct netlink_ext_ack * extack ) { struct mlxsw_afa_policer * policer ; int err ; policer = kzalloc ( sizeof ( * policer ) , GFP_KERNEL ) ; err = mlxsw_afa -> ops -> policer_add ( mlxsw_afa -> ops_priv , rate_bytes_ps , burst , & policer -> policer_index , extack ) ; if ( err ) { err_policer_add } refcount_set ( & policer -> ref_count , 1 ) ; policer -> fa_index = fa_index ; err = rhashtable_insert_fast ( & mlxsw_afa -> policer_ht , & policer -> ht_node , mlxsw_afa_policer_ht_params ) ; if ( err ) { err_rhashtable_insert } list_add_tail ( & policer -> list , & mlxsw_afa -> policer_list ) ; return policer ; err_rhashtable_insert mlxsw_afa -> ops -> policer_del ( mlxsw_afa -> ops_priv , policer -> policer_index ) ; err_policer_add kfree ( policer ) ; return ERR_PTR ( err ) ; } 