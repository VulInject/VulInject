int fts_close ( FTS * sp ) { FTSENT * freep , * p ; int rfd , error = 0 ; if ( sp -> fts_cur ) { for ( p = sp -> fts_cur ; p -> fts_level >= FTS_ROOTLEVEL ; ) { freep = p ; p = p -> fts_link ?p -> fts_link : p -> fts_parent ; } free ( p ) ; } rfd = ISSET ( FTS_NOCHDIR ) ?- 1 : sp -> fts_rfd ; if ( sp -> fts_child ) { fts_lfree ( sp -> fts_child ) ; } free ( sp -> fts_array ) ; free ( sp -> fts_path ) ; free ( sp ) ; if ( rfd != - 1 ) { int saved_errno ; error = fchdir ( rfd ) ; saved_errno = errno ; ( void ) close ( rfd ) ; errno = saved_errno ; } return ( error ) ; } 