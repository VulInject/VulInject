static int usbdux_pwm_start ( struct comedi_device * dev , struct comedi_subdevice * s ) { struct usbdux_private * devpriv = dev -> private ; int ret = 0 ; mutex_lock ( & devpriv -> mut ) ; if ( devpriv -> pwm_cmd_running ) { pwm_start_exit } devpriv -> dux_commands [ 1 ] = devpriv -> pwm_delay ; ret = send_dux_commands ( dev , USBDUX_CMD_PWM_ON ) ; if ( ret < 0 ) { pwm_start_exit } devpriv -> pwm_cmd_running = 1 ; ret = usbduxsub_submit_pwm_urbs ( dev ) ; if ( ret < 0 ) { devpriv -> pwm_cmd_running = 0 ; } pwm_start_exit mutex_unlock ( & devpriv -> mut ) ; return ret ; } 