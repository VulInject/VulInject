static int nouveau_gart_manager_new ( struct ttm_mem_type_manager * man , struct ttm_buffer_object * bo , const struct ttm_place * place , struct ttm_mem_reg * reg ) { struct nouveau_drm * drm = nouveau_bdev ( bo -> bdev ) ; struct nouveau_bo * nvbo = nouveau_bo ( bo ) ; struct nvkm_mem * node ; node = kzalloc ( sizeof ( * node ) , GFP_KERNEL ) ; node -> page_shift = 12 ; switch ( drm -> client . device . info . family ) { case NV_DEVICE_INFO_V0_TNT : case NV_DEVICE_INFO_V0_CELSIUS : case NV_DEVICE_INFO_V0_KELVIN : case NV_DEVICE_INFO_V0_RANKINE : case NV_DEVICE_INFO_V0_CURIE : break ; case NV_DEVICE_INFO_V0_TESLA : if ( drm -> client . device . info . chipset != 0x50 ) { node -> memtype = ( nvbo -> tile_flags & 0x7f00 ) >> 8 ; } break ; case NV_DEVICE_INFO_V0_FERMI : case NV_DEVICE_INFO_V0_KEPLER : case NV_DEVICE_INFO_V0_MAXWELL : case NV_DEVICE_INFO_V0_PASCAL : node -> memtype = ( nvbo -> tile_flags & 0xff00 ) >> 8 ; break ; default : NV_WARN ( drm , "%s: unhandled family type %x\n" , __func__ , drm -> client . device . info . family ) ; break ; } reg -> mm_node = node ; reg -> start = 0 ; return 0 ; } 