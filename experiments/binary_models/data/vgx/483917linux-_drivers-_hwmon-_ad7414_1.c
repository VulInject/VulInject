static struct ad7414_data * ad7414_update_device ( struct device * dev ) { struct ad7414_data * data = dev_get_drvdata ( dev ) ; struct i2c_client * client = data -> client ; mutex_lock ( & data -> lock ) ; if ( time_after ( jiffies , data -> next_update ) || ! data -> valid ) { int value , i ; dev_dbg ( & client -> dev , "starting ad7414 update\n" ) ; value = ad7414_read ( client , AD7414_REG_TEMP ) ; if ( value < 0 ) { dev_dbg ( & client -> dev , "AD7414_REG_TEMP err %d\n" , value ) ; } else { data -> temp_input = value ; } for ( i = 0 ; i < ARRAY_SIZE ( AD7414_REG_LIMIT ) ; ++ i ) { value = ad7414_read ( client , AD7414_REG_LIMIT [ i ] ) ; if ( value < 0 ) { dev_dbg ( & client -> dev , "AD7414 reg %d err %d\n" , AD7414_REG_LIMIT [ i ] , value ) ; } else { data -> temps [ i ] = value ; } } data -> next_update = jiffies + HZ + HZ / 2 ; } mutex_unlock ( & data -> lock ) ; return data ; } 