void amdgpu_fence_driver_sw_fini ( struct amdgpu_device * adev ) { unsigned int i , j ; for ( i = 0 ; i < AMDGPU_MAX_RINGS ; i ++ ) { struct amdgpu_ring * ring = adev -> rings [ i ] ; if ( ! ring || ! ring -> fence_drv . initialized ) { continue ; } if ( ring -> sched . ops ) { drm_sched_fini ( & ring -> sched ) ; } for ( j = 0 ; j <= ring -> fence_drv . num_fences_mask ; ++ j ) { dma_fence_put ( ring -> fence_drv . fences [ j ] ) ; } kfree ( ring -> fence_drv . fences ) ; ring -> fence_drv . initialized = false ; } } 