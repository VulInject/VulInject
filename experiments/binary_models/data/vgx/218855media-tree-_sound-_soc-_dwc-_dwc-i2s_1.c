static int dw_configure_dai_by_dt ( struct dw_i2s_dev * dev , struct snd_soc_dai_driver * dw_i2s_dai , struct resource * res ) { u32 comp1 = i2s_read_reg ( dev -> i2s_base , I2S_COMP_PARAM_1 ) ; u32 comp2 = i2s_read_reg ( dev -> i2s_base , I2S_COMP_PARAM_2 ) ; u32 fifo_depth = 1 << ( 1 + COMP1_FIFO_DEPTH_GLOBAL ( comp1 ) ) ; u32 idx = COMP1_APB_DATA_WIDTH ( comp1 ) ; u32 idx2 ; int ret ; ret = dw_configure_dai ( dev , dw_i2s_dai , SNDRV_PCM_RATE_8000_192000 ) ; if ( ret < 0 ) { return ret ; } if ( COMP1_TX_ENABLED ( comp1 ) ) { idx2 = COMP1_TX_WORDSIZE_0 ( comp1 ) ; dev -> capability |= DWC_I2S_PLAY ; dev -> play_dma_data . dt . addr = res -> start + I2S_TXDMA ; dev -> play_dma_data . dt . addr_width = bus_widths [ idx ] ; dev -> play_dma_data . dt . fifo_size = fifo_depth * ( fifo_width [ idx2 ] ) >> 8 ; dev -> play_dma_data . dt . maxburst = 16 ; } if ( COMP1_RX_ENABLED ( comp1 ) ) { idx2 = COMP2_RX_WORDSIZE_0 ( comp2 ) ; dev -> capability |= DWC_I2S_RECORD ; dev -> capture_dma_data . dt . addr = res -> start + I2S_RXDMA ; dev -> capture_dma_data . dt . addr_width = bus_widths [ idx ] ; dev -> capture_dma_data . dt . fifo_size = fifo_depth * ( fifo_width [ idx2 ] >> 8 ) ; dev -> capture_dma_data . dt . maxburst = 16 ; } return 0 ; } 