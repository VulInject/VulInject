int isci_host_init ( struct isci_host * ihost ) { int i , err ; enum sci_status status ; spin_lock_irq ( & ihost -> scic_lock ) ; status = sci_controller_construct ( ihost , scu_base ( ihost ) , smu_base ( ihost ) ) ; spin_unlock_irq ( & ihost -> scic_lock ) ; if ( status != SCI_SUCCESS ) { dev_err ( & ihost -> pdev -> dev , "%s: sci_controller_construct failed - status = %x\n" , __func__ , status ) ; return - ENODEV ; } spin_lock_irq ( & ihost -> scic_lock ) ; status = sci_controller_initialize ( ihost ) ; spin_unlock_irq ( & ihost -> scic_lock ) ; if ( status != SCI_SUCCESS ) { dev_warn ( & ihost -> pdev -> dev , "%s: sci_controller_initialize failed -" " status = 0x%x\n" , __func__ , status ) ; return - ENODEV ; } err = sci_controller_mem_init ( ihost ) ; writel ( 1 , & ihost -> scu_registers -> peg0 . sgpio . interface_control ) ; for ( i = 0 ; i < isci_gpio_count ( ihost ) ; i ++ ) { writel ( SGPIO_HW_CONTROL , & ihost -> scu_registers -> peg0 . sgpio . output_data_select [ i ] ) ; } writel ( 0 , & ihost -> scu_registers -> peg0 . sgpio . vendor_specific_code ) ; return 0 ; } 