int jfs_fileattr_set ( struct mnt_idmap * idmap , struct dentry * dentry , struct fileattr * fa ) { struct inode * inode = d_inode ( dentry ) ; struct jfs_inode_info * jfs_inode = JFS_IP ( inode ) ; unsigned int flags ; if ( d_is_special ( dentry ) ) { return - ENOTTY ; } if ( fileattr_has_fsx ( fa ) ) { return - EOPNOTSUPP ; } flags = jfs_map_ext2 ( fa -> flags , 1 ) ; if ( ! S_ISDIR ( inode -> i_mode ) ) { flags &= ~ JFS_DIRSYNC_FL ; } if ( IS_NOQUOTA ( inode ) ) { return - EPERM ; } flags = flags & JFS_FL_USER_MODIFIABLE ; flags |= jfs_inode -> mode2 & ~ JFS_FL_USER_MODIFIABLE ; jfs_inode -> mode2 = flags ; jfs_set_inode_flags ( inode ) ; inode -> i_ctime = current_time ( inode ) ; mark_inode_dirty ( inode , NULL ) ; return 0 ; } 