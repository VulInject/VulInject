static int ael_i2c_rd ( struct cphy * phy , int dev_addr , int word_addr ) { int i , err ; unsigned int stat , data ; err = t3_mdio_write ( phy , MDIO_MMD_PMAPMD , AEL_I2C_CTRL , ( dev_addr << 8 ) | ( 1 << 8 ) | word_addr ) ; for ( i = 0 ; i < 200 ; i ++ ) { msleep ( 1 ) ; err = t3_mdio_read ( phy , MDIO_MMD_PMAPMD , AEL_I2C_STAT , & stat ) ; if ( err ) { return err ; } if ( ( stat & 3 ) == 1 ) { err = t3_mdio_read ( phy , MDIO_MMD_PMAPMD , AEL_I2C_DATA , & data ) ; if ( err ) { return err ; } return data >> 8 ; } } CH_WARN ( phy -> adapter , "PHY %u i2c read of dev.addr %#x.%#x timed out\n" , phy -> mdio . prtad , dev_addr , word_addr ) ; return - ETIMEDOUT ; } 