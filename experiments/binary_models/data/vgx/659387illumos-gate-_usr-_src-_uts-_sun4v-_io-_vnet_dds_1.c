void vdds_mod_init ( void ) { int i ; int rv ; uint64_t minor = 0 ; for ( i = 0 ; i < ( sizeof ( niu_hsvc ) / sizeof ( hsvc_info_t ) ) ; i ++ ) { rv = hsvc_register ( & niu_hsvc [ i ] , & minor ) ; if ( rv == 0 ) { if ( minor == niu_hsvc [ i ] . hsvc_minor ) { vdds_hv_hio_capable = B_TRUE ; niu_hsvc_index = i ; break ; } else { ( void ) hsvc_unregister ( & niu_hsvc [ i ] ) ; } } } mutex_init ( & vdds_dev_lock , MUTEX_DRIVER , NULL ) ; DBG2 ( NULL , "HV HIO capable=%d ver(%ld.%ld)" , vdds_hv_hio_capable , ( niu_hsvc_index == - 1 ) ?0 : niu_hsvc [ niu_hsvc_index ] . hsvc_major , minor ) ; } 