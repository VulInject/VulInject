int tc_src_l3 ( struct __sk_buff * skb ) { __u16 proto = skb -> protocol ; if ( bpf_skb_store_bytes ( skb , 0 , & src_mac , ETH_ALEN , 0 ) != 0 ) { return TC_ACT_SHOT ; } if ( bpf_skb_store_bytes ( skb , ETH_ALEN , & dst_mac , ETH_ALEN , 0 ) != 0 ) { return TC_ACT_SHOT ; } if ( bpf_skb_store_bytes ( skb , ETH_ALEN + ETH_ALEN , & proto , sizeof ( __u16 ) , 0 ) != 0 ) { return TC_ACT_SHOT ; } return bpf_redirect_peer ( IFINDEX_DST , 0 ) ; } 