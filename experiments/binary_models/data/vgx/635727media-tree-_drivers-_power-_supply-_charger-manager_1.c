static bool is_full_charged ( struct charger_manager * cm ) { struct charger_desc * desc = cm -> desc ; union power_supply_propval val ; struct power_supply * fuel_gauge ; bool is_full = false ; int ret = 0 ; int uV ; fuel_gauge = power_supply_get_by_name ( cm -> desc -> psy_fuel_gauge ) ; if ( ! fuel_gauge ) { return false ; } if ( desc -> fullbatt_full_capacity > 0 ) { val . intval = 0 ; ret = power_supply_get_property ( fuel_gauge , POWER_SUPPLY_PROP_CHARGE_FULL , & val ) ; if ( ! ret && val . intval > desc -> fullbatt_full_capacity ) { is_full = true ; out } } if ( desc -> fullbatt_uV > 0 ) { ret = get_batt_uV ( cm , & uV ) ; if ( ! ret && uV >= desc -> fullbatt_uV ) { is_full = true ; out } } if ( desc -> fullbatt_soc > 0 ) { val . intval = 0 ; ret = power_supply_get_property ( fuel_gauge , POWER_SUPPLY_PROP_CAPACITY , & val ) ; if ( ! ret && val . intval >= desc -> fullbatt_soc ) { is_full = true ; out } } out power_supply_put ( fuel_gauge ) ; return is_full ; } 