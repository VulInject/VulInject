static int etnaviv_pdev_probe ( struct platform_device * pdev ) { struct device * dev = & pdev -> dev ; struct device_node * first_node = NULL ; struct component_match * match = NULL ; if ( ! dev -> platform_data ) { struct device_node * core_node ; for_each_compatible_node ( , , "vivante,gc" ) { if ( ! first_node ) { first_node = core_node ; } drm_of_component_match_add ( & pdev -> dev , & match , component_compare_of , core_node ) ; } } else { char * * names = dev -> platform_data ; unsigned i ; for ( i = 0 ; names [ i ] ; i ++ ) { component_match_add ( dev , & match , component_compare_dev_name , names [ i ] ) ; } } if ( dma_set_mask ( & pdev -> dev , DMA_BIT_MASK ( 40 ) ) || dma_set_coherent_mask ( & pdev -> dev , DMA_BIT_MASK ( 32 ) ) ) { dev_dbg ( & pdev -> dev , "No suitable DMA available\n" ) ; return - ENODEV ; } if ( first_node ) { of_dma_configure ( & pdev -> dev , first_node , true ) ; } return component_master_add_with_match ( dev , & etnaviv_master_ops , match ) ; } 