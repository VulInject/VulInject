static int loongson_pci_ecam_init ( struct pci_config_window * cfg ) { struct device * dev = cfg -> parent ; struct loongson_pci * priv ; struct loongson_pci_data * data ; priv = devm_kzalloc ( dev , sizeof ( * priv ) , GFP_KERNEL ) ; if ( ! priv ) { return - ENOMEM ; } data = devm_kzalloc ( dev , sizeof ( * data ) , GFP_KERNEL ) ; cfg -> priv = priv ; data -> flags = FLAG_CFG1 | FLAG_DEV_HIDDEN ; priv -> data = data ; priv -> cfg1_base = cfg -> win - ( cfg -> busr . start << 16 ) ; return 0 ; } 