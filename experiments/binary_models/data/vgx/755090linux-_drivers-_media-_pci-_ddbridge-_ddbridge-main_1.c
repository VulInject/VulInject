static int ddb_irq_init ( struct ddb * dev ) { int stat ; int irq_flag = IRQF_SHARED ; ddbwritel ( dev , 0x00000000 , INTERRUPT_ENABLE ) ; ddbwritel ( dev , 0x00000000 , MSI1_ENABLE ) ; ddbwritel ( dev , 0x00000000 , MSI2_ENABLE ) ; ddbwritel ( dev , 0x00000000 , MSI3_ENABLE ) ; ddbwritel ( dev , 0x00000000 , MSI4_ENABLE ) ; ddbwritel ( dev , 0x00000000 , MSI5_ENABLE ) ; ddbwritel ( dev , 0x00000000 , MSI6_ENABLE ) ; ddbwritel ( dev , 0x00000000 , MSI7_ENABLE ) ; ddb_irq_msi ( dev , 2 ) ; if ( dev -> msi ) { irq_flag = 0 ; } if ( dev -> msi == 2 ) { stat = request_irq ( pci_irq_vector ( dev -> pdev , 0 ) , ddb_irq_handler0 , irq_flag , "ddbridge" , ( void * ) dev ) ; stat = request_irq ( pci_irq_vector ( dev -> pdev , 1 ) , ddb_irq_handler1 , irq_flag , "ddbridge" , ( void * ) dev ) ; if ( stat < 0 ) { free_irq ( pci_irq_vector ( dev -> pdev , 0 ) , dev ) ; return stat ; } } else { stat = request_irq ( pci_irq_vector ( dev -> pdev , 0 ) , ddb_irq_handler , irq_flag , "ddbridge" , ( void * ) dev ) ; if ( stat < 0 ) { return stat ; } } if ( dev -> msi == 2 ) { ddbwritel ( dev , 0x0fffff00 , INTERRUPT_ENABLE ) ; ddbwritel ( dev , 0x0000000f , MSI1_ENABLE ) ; } else { ddbwritel ( dev , 0x0fffff0f , INTERRUPT_ENABLE ) ; ddbwritel ( dev , 0x00000000 , MSI1_ENABLE ) ; } return stat ; } 