static BOOL PackageConnectLookup ( HANDLE * pLogonHandle , ULONG * pPackageId ) { LSA_STRING Name ; NTSTATUS Status ; Status = LsaConnectUntrusted ( pLogonHandle ) ; if ( FAILED ( Status ) ) { ShowLsaError ( "LsaConnectUntrusted" , Status ) ; return FALSE ; } Name . Buffer = MICROSOFT_KERBEROS_NAME_A ; Name . Length = strlen ( Name . Buffer , NULL ) ; Name . MaximumLength = Name . Length + 1 ; Status = LsaLookupAuthenticationPackage ( * pLogonHandle , & Name , pPackageId ) ; if ( FAILED ( Status ) ) { ShowLsaError ( "LsaLookupAuthenticationPackage" , Status ) ; return FALSE ; } return TRUE ; } 