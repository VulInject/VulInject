static int packed_transaction_finish ( struct ref_store * ref_store , struct ref_transaction * transaction , struct strbuf * err ) { struct packed_ref_store * refs = packed_downcast ( ref_store , REF_STORE_READ | REF_STORE_WRITE | REF_STORE_ODB , "ref_transaction_finish" ) ; int ret = TRANSACTION_GENERIC_ERROR ; char * packed_refs_path ; clear_snapshot ( refs ) ; packed_refs_path = get_locked_file_path ( & refs -> lock ) ; if ( rename_tempfile ( & refs -> tempfile , packed_refs_path ) ) { strbuf_addf ( err , "error replacing %s: %s" , refs -> path , strerror ( errno ) ) ; cleanup } ret = 0 ; cleanup packed_transaction_cleanup ( refs , transaction ) ; return ret ; } 