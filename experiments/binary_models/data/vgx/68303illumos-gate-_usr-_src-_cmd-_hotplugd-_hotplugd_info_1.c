static int copy_devinfo ( const char * path , const char * connection , uint_t flags , hp_node_t * rootp ) { hp_node_t hp_root = NULL ; di_node_t di_root ; int rv ; if ( ( di_root = di_init ( path , DINFOSUBTREE | DINFOHP ) ) == DI_NODE_NIL ) { return ( errno ) ; } if ( strcmp ( path , "/" ) == 0 ) { flags |= HPINFOSEARCH ; ( void ) di_walk_node ( di_root , DI_WALK_CLDFIRST , NULL , search_cb ) ; } if ( connection != NULL ) { rv = copy_hotplug ( NULL , di_root , connection , flags , & hp_root ) ; } else { rv = copy_devices ( NULL , di_root , flags , & hp_root ) ; } di_fini ( di_root , NULL ) ; * rootp = ( rv == 0 ) ?hp_root : NULL ; return ( rv ) ; } 