void appl_agentx_get ( struct appl_backend * backend , int32_t transactionid , int32_t requestid , const char * ctx , struct appl_varbind * vblist ) { struct appl_agentx_session * session = backend -> ab_cookie ; struct ax_ostring * context , string ; struct appl_varbind * vb ; struct ax_searchrange * srl ; size_t i , j , nsr ; for ( nsr = 0 , vb = vblist ; vb != NULL ; vb = vb -> av_next ) { nsr ++ ; } if ( ( srl = calloc ( nsr , sizeof ( * srl ) ) ) == NULL ) { log_warn ( NULL ) ; appl_response ( backend , requestid , APPL_ERROR_GENERR , 1 , vblist ) ; return ; } for ( i = 0 , vb = vblist ; i < nsr ; i ++ , vb = vb -> av_next ) { srl [ i ] . asr_start . aoi_include = vb -> av_include ; srl [ i ] . asr_start . aoi_idlen = vb -> av_oid . bo_n ; for ( j = 0 ; j < vb -> av_oid . bo_n ; j ++ ) { srl [ i ] . asr_start . aoi_id [ j ] = vb -> av_oid . bo_id [ j ] ; } srl [ i ] . asr_stop . aoi_include = 0 ; srl [ i ] . asr_stop . aoi_idlen = 0 ; } if ( ( context = appl_agentx_string2ostring ( ctx , & string ) ) == NULL ) { if ( errno != 0 ) { log_warn ( "Failed to convert context" ) ; appl_response ( backend , requestid , APPL_ERROR_GENERR , 1 , vblist ) ; return ; } } session -> sess_conn -> conn_ax -> ax_byteorder = session -> sess_byteorder ; if ( ax_get ( session -> sess_conn -> conn_ax , session -> sess_id , transactionid , requestid , context , srl , nsr ) == - 1 ) { appl_response ( backend , requestid , APPL_ERROR_GENERR , 1 , vblist ) ; } else { appl_agentx_send ( - 1 , EV_WRITE , session -> sess_conn ) ; } free ( srl ) ; if ( context != NULL ) { free ( context -> aos_string ) ; } } 