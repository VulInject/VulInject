static struct datagram * smb_netbios_datagram_getq ( struct datagram * datagram ) { struct datagram * prev = 0 ; ( void ) mutex_lock ( & smb_dgq_mtx ) ; for ( prev = smb_datagram_queue . forw ; prev != ( datagram * ) ( ( uintptr_t ) & smb_datagram_queue ) ; prev = prev -> forw ) { if ( prev -> src . addr_list . sin . sin_addr . s_addr == datagram -> src . addr_list . sin . sin_addr . s_addr ) { QUEUE_CLIP ( prev ) ; ( void ) mutex_unlock ( & smb_dgq_mtx ) ; bcopy ( datagram -> data , & prev -> data [ prev -> data_length ] , datagram -> data_length ) ; prev -> data_length += datagram -> data_length ; return ( prev ) ; } } ( void ) mutex_unlock ( & smb_dgq_mtx ) ; return ( 0 ) ; } 