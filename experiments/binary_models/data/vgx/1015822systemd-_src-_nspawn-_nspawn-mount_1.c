int tmpfs_patch_options ( const char * options , uid_t uid_shift , const char * selinux_apifs_context , char * * ret ) { _cleanup_free_ char * buf = NULL ; assert ( ret ) ; if ( options ) { buf = strdup ( options ) ; } if ( uid_shift != UID_INVALID ) { if ( strextendf_with_separator ( & buf , "," , "uid=" UID_FMT ",gid=" UID_FMT , uid_shift , uid_shift ) < 0 ) { return - ENOMEM ; } } if ( selinux_apifs_context ) { if ( strextendf_with_separator ( & buf , "," , "context=\"%s\"" , selinux_apifs_context ) < 0 ) { return - ENOMEM ; } } * ret = TAKE_PTR ( buf ) ; return ! ! * ret ; } 