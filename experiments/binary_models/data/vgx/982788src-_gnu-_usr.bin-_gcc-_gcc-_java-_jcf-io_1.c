ZipFile * DEFUN ( opendir_in_zip , ( zipfile , is_system ) , const char * zipfile AND int is_system ) ( ZipFile * zipf , char magic [ 4 ] , int fd , ( zipf = SeenZipFiles zipf != NULL zipf = zipf -> next ) { if ( strcmp ( zipf -> name , zipfile ) == 0 ) { return zipf ; } } zipf = ALLOC ( sizeof ( ZipFile ) + strlen ( zipfile ) + 1 ) , zipf -> next = SeenZipFiles , zipf -> name = ( char * ) ( zipf + 1 ) , strcpy ( zipf -> name , zipfile ) , SeenZipFiles = zipf , fd = open ( zipfile , O_RDONLY | O_BINARY ) , zipf -> fd = fd , ( fd < 0 ) { zipf -> count = 0 zipf -> dir_size = 0 zipf -> central_directory = NULL } else { jcf_dependency_add_file ( zipfile , is_system ) } ; ) ; if ( read ( fd , magic , 4 ) != 4 || GET_u4 ( magic ) != ( JCF_u4 ) ZIPMAGIC ) { return NULL ; } lseek ( fd , 0L , SEEK_SET ) ; if ( read_zip_archive ( zipf ) != 0 ) { return in ; } zipf ; 