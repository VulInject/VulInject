static struct dtpm * dtpm_setup_virtual ( const struct dtpm_node * hierarchy , struct dtpm * parent ) { struct dtpm * dtpm ; int ret ; dtpm = kzalloc ( sizeof ( * dtpm ) , GFP_KERNEL ) ; if ( ! dtpm ) { return ERR_PTR ( - ENOMEM ) ; } dtpm_init ( dtpm , NULL ) ; ret = dtpm_register ( hierarchy -> name , dtpm , parent ) ; if ( ret ) { pr_err ( "Failed to register dtpm node '%s': %d\n" , hierarchy -> name , ret ) ; return ERR_PTR ( ret ) ; } return dtpm ; } 