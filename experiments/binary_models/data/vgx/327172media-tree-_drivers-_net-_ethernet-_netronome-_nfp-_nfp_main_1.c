static int nfp_nsp_init ( struct pci_dev * pdev , struct nfp_pf * pf ) { struct nfp_nsp_identify * nspi ; struct nfp_nsp * nsp ; int err ; nsp = nfp_nsp_open ( pf -> cpp ) ; if ( IS_ERR ( nsp ) ) { err = PTR_ERR ( nsp ) ; dev_err ( & pdev -> dev , "Failed to access the NSP: %d\n" , err ) ; return err ; } err = nfp_nsp_wait ( nsp ) ; if ( err < 0 ) { exit_close_nsp } pf -> eth_tbl = __nfp_eth_read_ports ( pf -> cpp , nsp ) ; nspi = __nfp_nsp_identify ( nsp ) ; if ( nspi ) { dev_info ( & pdev -> dev , "BSP: %s\n" , nspi -> version ) ; kfree ( nspi ) ; } err = nfp_fw_load ( pdev , pf , nsp ) ; if ( err < 0 ) { dev_err ( & pdev -> dev , "Failed to load FW\n" ) ; exit_close_nsp } pf -> fw_loaded = ! ! err ; err = 0 ; exit_close_nsp nfp_nsp_close ( nsp ) ; return err ; } 