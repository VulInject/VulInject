static unsigned long sigpage_addr ( const struct mm_struct * mm , unsigned int npages ) { unsigned long offset ; unsigned long first ; unsigned long last ; unsigned long addr ; unsigned int slots ; first = PAGE_ALIGN ( mm -> start_stack ) ; last = TASK_SIZE - ( npages << PAGE_SHIFT ) ; if ( first > last ) { return 0 ; } slots = ( ( last - first ) >> PAGE_SHIFT ) + 1 ; offset = get_random_u32_below ( slots ) ; addr = first + ( offset << PAGE_SHIFT ) ; return addr ; } 