krb5_boolean authorized_principal ( context , p , auth_etype ) krb5_context context ; krb5_principal p ; krb5_enctype auth_etype ; { char * name , * ptr ; char buf [ 1024 ] ; krb5_error_code retval ; FILE * acl_file ; int end ; krb5_enctype acl_etype ; retval = krb5_unparse_name ( context , p , & name ) ; if ( retval ) { return FALSE ; } acl_file = fopen ( acl_file_name , "r" ) ; if ( ! acl_file ) { return FALSE ; } while ( ! feof ( acl_file ) ) { if ( ! fgets ( buf , sizeof ( buf ) , acl_file ) ) { break ; } end = strlen ( buf ) - 1 ; if ( buf [ end ] == '\n' ) { buf [ end ] = '\0' ; } if ( ! strncmp ( name , buf , strlen ( name ) ) ) { ptr = buf + strlen ( name ) ; if ( * ptr && ! isspace ( ( int ) * ptr ) ) { continue ; } for ( ; * ptr && isspace ( ( int ) * ptr ) ; ptr ++ ) { } if ( ( * ptr ) && ( ( retval = krb5_string_to_enctype ( ptr , & acl_etype ) ) || ( acl_etype != auth_etype ) ) ) { continue ; } fclose ( acl_file ) ; return TRUE ; } } free ( name ) ; fclose ( acl_file ) ; return FALSE ; } 