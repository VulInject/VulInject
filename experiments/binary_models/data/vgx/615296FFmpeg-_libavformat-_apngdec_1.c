static int append_extradata ( AVCodecParameters * par , AVIOContext * pb , int len ) { int previous_size = par -> extradata_size ; int new_size , ret ; uint8_t * new_extradata ; if ( len > INT_MAX - AV_INPUT_BUFFER_PADDING_SIZE - previous_size ) { return AVERROR_INVALIDDATA ; } new_size = previous_size + len ; new_extradata = av_realloc ( par -> extradata , new_size + AV_INPUT_BUFFER_PADDING_SIZE ) ; if ( ! new_extradata ) { return AVERROR ( ENOMEM ) ; } par -> extradata = new_extradata ; par -> extradata_size = new_size ; if ( ( ret = ffio_read_size ( pb , par -> extradata + previous_size , len ) ) < 0 ) { return ret ; } return previous_size ; } 