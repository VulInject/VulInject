static int get_frame_rate_at_max_stretch_100hz ( struct dc_state * context ) { struct dc_crtc_timing * timing = NULL ; uint32_t sec_per_100_lines ; uint32_t max_v_blank ; uint32_t curr_v_blank ; uint32_t v_stretch_max ; uint32_t stretched_frame_pix_cnt ; uint32_t scaled_stretched_frame_pix_cnt ; uint32_t scaled_refresh_rate ; timing = & context -> streams [ 0 ] -> timing ; if ( timing == NULL ) { return 0 ; } sec_per_100_lines = timing -> pix_clk_100hz / timing -> h_total + 1 ; max_v_blank = sec_per_100_lines / V_SCALE + 1 ; curr_v_blank = timing -> v_total - timing -> v_addressable ; v_stretch_max = ( max_v_blank > curr_v_blank ) ?( max_v_blank - curr_v_blank ) : ( 0 ) ; stretched_frame_pix_cnt = ( v_stretch_max + timing -> v_total ) * timing -> h_total ; scaled_stretched_frame_pix_cnt = stretched_frame_pix_cnt / 10000 ; scaled_refresh_rate = ( timing -> pix_clk_100hz ) / scaled_stretched_frame_pix_cnt + 1 ; return scaled_refresh_rate ; } 