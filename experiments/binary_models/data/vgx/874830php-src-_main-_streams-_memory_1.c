static int php_stream_memory_set_option ( php_stream * stream , int option , int value , void * ptrparam ) { php_stream_memory_data * ms = ( php_stream_memory_data * ) stream -> abstract ; size_t newsize ; switch ( option ) { case PHP_STREAM_OPTION_TRUNCATE_API : switch ( value ) { case PHP_STREAM_TRUNCATE_SUPPORTED : return PHP_STREAM_OPTION_RETURN_OK ; case PHP_STREAM_TRUNCATE_SET_SIZE : if ( ms -> mode & TEMP_STREAM_READONLY ) { return PHP_STREAM_OPTION_RETURN_ERR ; } newsize = * ( size_t * ) ptrparam ; if ( newsize <= ZSTR_LEN ( ms -> data ) ) { ms -> data = zend_string_truncate ( ms -> data , newsize , 0 ) ; if ( newsize < ms -> fpos ) { ms -> fpos = newsize ; } } else { size_t old_size = ZSTR_LEN ( ms -> data ) ; ms -> data = zend_string_realloc ( ms -> data , newsize , 0 ) ; } return PHP_STREAM_OPTION_RETURN_OK ; } } return PHP_STREAM_OPTION_RETURN_NOTIMPL ; } PHPAPI const php_stream_ops php_stream_memory_ops = { php_stream_memory_write php_stream_memory_read php_stream_memory_close php_stream_memory_flush "MEMORY" php_stream_memory_seek php_stream_memory_cast php_stream_memory_stat php_stream_memory_set_option } ; 