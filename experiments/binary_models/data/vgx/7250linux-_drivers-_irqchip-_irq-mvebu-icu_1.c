static int mvebu_icu_subset_probe ( struct platform_device * pdev ) { struct mvebu_icu_msi_data * msi_data ; struct device_node * msi_parent_dn ; struct device * dev = & pdev -> dev ; struct irq_domain * irq_domain ; msi_data = devm_kzalloc ( dev , sizeof ( * msi_data ) , GFP_KERNEL ) ; if ( static_branch_unlikely ( & legacy_bindings ) ) { msi_data -> icu = dev_get_drvdata ( dev ) ; msi_data -> subset_data = & mvebu_icu_nsr_subset_data ; } else { msi_data -> icu = dev_get_drvdata ( dev -> parent ) ; msi_data -> subset_data = of_device_get_match_data ( dev ) ; } dev -> msi . domain = of_msi_get_domain ( dev , dev -> of_node , DOMAIN_BUS_PLATFORM_MSI ) ; if ( ! dev -> msi . domain ) { return - EPROBE_DEFER ; } msi_parent_dn = irq_domain_get_of_node ( dev -> msi . domain ) ; if ( ! msi_parent_dn ) { return - ENODEV ; } irq_domain = platform_msi_create_device_tree_domain ( dev , ICU_MAX_IRQS , mvebu_icu_write_msg , & mvebu_icu_domain_ops , msi_data ) ; if ( ! irq_domain ) { dev_err ( dev , "Failed to create ICU MSI domain\n" ) ; return - ENOMEM ; } return 0 ; } 