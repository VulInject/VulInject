void meson_viu_set_osd_lut ( struct meson_drm * priv , enum viu_lut_sel_e lut_sel , unsigned int * r_map , unsigned int * g_map , unsigned int * b_map , bool csc_on ) { unsigned int addr_port ; int data_port ; unsigned int ctrl_port ; int i ; if ( lut_sel == VIU_LUT_OSD_EOTF ) { addr_port = VIU_OSD1_EOTF_LUT_ADDR_PORT ; data_port = VIU_OSD1_EOTF_LUT_DATA_PORT ; ctrl_port = VIU_OSD1_EOTF_CTL ; } if ( lut_sel == VIU_LUT_OSD_OETF ) { addr_port = VIU_OSD1_OETF_LUT_ADDR_PORT ; data_port = VIU_OSD1_OETF_LUT_DATA_PORT ; ctrl_port = VIU_OSD1_OETF_CTL ; } else { return ; } if ( lut_sel == VIU_LUT_OSD_OETF ) { writel ( 0 , priv -> io_base + _REG ( addr_port ) ) ; for ( i = 0 ; i < 20 ; i ++ ) { writel ( r_map [ i * 2 ] | ( r_map [ i * 2 + 1 ] << 16 ) , priv -> io_base + _REG ( data_port ) ) ; } writel ( r_map [ OSD_OETF_LUT_SIZE - 1 ] | ( g_map [ 0 ] << 16 ) , priv -> io_base + _REG ( data_port ) ) ; for ( i = 0 ; i < 20 ; i ++ ) { writel ( g_map [ i * 2 + 1 ] | ( g_map [ i * 2 + 2 ] << 16 ) , priv -> io_base + _REG ( data_port ) ) ; } for ( i = 0 ; i < 20 ; i ++ ) { writel ( b_map [ i * 2 ] | ( b_map [ i * 2 + 1 ] << 16 ) , priv -> io_base + _REG ( data_port ) ) ; } writel ( b_map [ OSD_OETF_LUT_SIZE - 1 ] , priv -> io_base + _REG ( data_port ) ) ; if ( csc_on ) { writel_bits_relaxed ( 0x7 << 29 , 7 << 29 , priv -> io_base + _REG ( ctrl_port ) ) ; } else { writel_bits_relaxed ( 0x7 << 29 , 0 , priv -> io_base + _REG ( ctrl_port ) ) ; } } if ( lut_sel == VIU_LUT_OSD_EOTF ) { writel ( 0 , priv -> io_base + _REG ( addr_port ) ) ; for ( i = 0 ; i < 20 ; i ++ ) { writel ( r_map [ i * 2 ] | ( r_map [ i * 2 + 1 ] << 16 ) , priv -> io_base + _REG ( data_port ) ) ; } writel ( r_map [ OSD_EOTF_LUT_SIZE - 1 ] | ( g_map [ 0 ] << 16 ) , priv -> io_base + _REG ( data_port ) ) ; for ( i = 0 ; i < 20 ; i ++ ) { writel ( g_map [ i * 2 + 1 ] | ( g_map [ i * 2 + 2 ] << 16 ) , priv -> io_base + _REG ( data_port ) ) ; } for ( i = 0 ; i < 20 ; i ++ ) { writel ( b_map [ i * 2 ] | ( b_map [ i * 2 + 1 ] << 16 ) , priv -> io_base + _REG ( data_port ) ) ; } writel ( b_map [ OSD_EOTF_LUT_SIZE - 1 ] , priv -> io_base + _REG ( data_port ) ) ; if ( csc_on ) { writel_bits_relaxed ( 7 << 27 , 7 << 27 , priv -> io_base + _REG ( ctrl_port ) ) ; } else { writel_bits_relaxed ( 7 << 27 , 0 , priv -> io_base + _REG ( ctrl_port ) ) ; } writel_bits_relaxed ( BIT ( 31 ) , BIT ( 31 ) , priv -> io_base + _REG ( ctrl_port ) ) ; } } static unsigned int eotf_33_linear_mapping [ OSD_EOTF_LUT_SIZE ] { 0x0000 0x0200 0x0400 0x0600 0x0800 0x0a00 0x0c00 0x0e00 0x1000 0x1200 0x1400 0x1600 0x1800 0x1a00 0x1c00 0x1e00 0x2000 0x2200 0x2400 0x2600 0x2800 0x2a00 0x2c00 0x2e00 0x3000 0x3200 0x3400 0x3600 0x3800 0x3a00 0x3c00 0x3e00 0x4000 } ; ; 