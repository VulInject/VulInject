static int ebt_ip6_mt_check ( const struct xt_mtchk_param * par ) { const struct ebt_entry * e = par -> entryinfo ; struct ebt_ip6_info * info = par -> matchinfo ; if ( e -> ethproto != htons ( ETH_P_IPV6 ) || e -> invflags & EBT_IPROTO ) { return - EINVAL ; } if ( info -> bitmask & ( EBT_IP6_DPORT | EBT_IP6_SPORT ) ) { if ( info -> invflags & EBT_IP6_PROTO ) { return - EINVAL ; } if ( info -> protocol != IPPROTO_TCP && info -> protocol != IPPROTO_UDP && info -> protocol != IPPROTO_UDPLITE && info -> protocol != IPPROTO_SCTP && info -> protocol != IPPROTO_DCCP ) { return - EINVAL ; } } if ( info -> bitmask & EBT_IP6_DPORT && info -> dport [ 0 ] > info -> dport [ 1 ] ) { return - EINVAL ; } if ( info -> bitmask & EBT_IP6_SPORT && info -> sport [ 0 ] > info -> sport [ 1 ] ) { return - EINVAL ; } if ( info -> bitmask & EBT_IP6_ICMP6 ) { if ( ( info -> invflags & EBT_IP6_PROTO ) || info -> protocol != IPPROTO_ICMPV6 ) { return - EINVAL ; } if ( info -> icmpv6_type [ 0 ] > info -> icmpv6_type [ 1 ] || info -> icmpv6_code [ 0 ] > info -> icmpv6_code [ 1 ] ) { return - EINVAL ; } } return 0 ; } 