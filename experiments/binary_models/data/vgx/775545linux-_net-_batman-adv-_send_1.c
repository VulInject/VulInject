bool batadv_send_skb_prepare_unicast_4addr ( struct batadv_priv * bat_priv , struct sk_buff * skb , struct batadv_orig_node * orig , int packet_subtype ) { struct batadv_hard_iface * primary_if ; struct batadv_unicast_4addr_packet * uc_4addr_packet ; bool ret = false ; primary_if = batadv_primary_if_get_selected ( bat_priv ) ; if ( ! primary_if ) { out } if ( ! batadv_send_skb_push_fill_unicast ( skb , sizeof ( * uc_4addr_packet ) , orig ) ) { out } uc_4addr_packet = ( batadv_unicast_4addr_packet * ) skb -> data ; uc_4addr_packet -> u . packet_type = BATADV_UNICAST_4ADDR ; ether_addr_copy ( uc_4addr_packet -> src , primary_if -> net_dev -> dev_addr ) ; uc_4addr_packet -> subtype = packet_subtype ; uc_4addr_packet -> reserved = 0 ; ret = true ; out batadv_hardif_put ( primary_if , NULL ) ; return ret ; } 