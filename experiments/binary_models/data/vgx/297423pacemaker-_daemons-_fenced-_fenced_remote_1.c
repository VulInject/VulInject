static peer_device_info_t * find_best_peer ( const char * device , remote_fencing_op_t * op , enum find_best_peer_options options ) { GList * iter = NULL ; gboolean verified_devices_only = ( options & FIND_PEER_VERIFIED_ONLY ) ?TRUE : FALSE ; if ( ! device && pcmk_is_set ( op -> call_options , st_opt_topology ) ) { return NULL ; } for ( iter = op -> query_results ; iter != NULL ; iter = iter -> next ) { peer_device_info_t * peer = iter -> data ; crm_trace ( "Testing result from %s targeting %s with %d device%s: %d %x" , peer -> host , op -> target , peer -> ndevices , pcmk__plural_s ( peer -> ndevices ) , peer -> tried , options ) ; if ( ( options & FIND_PEER_TARGET_ONLY ) && ! pcmk__str_eq ( peer -> host , op -> target , pcmk__str_casei ) ) { continue ; } if ( pcmk_is_set ( op -> call_options , st_opt_topology ) ) { if ( grab_peer_device ( op , peer , device , verified_devices_only ) ) { return peer ; } } if ( ! peer -> tried && count_peer_devices ( op , peer , verified_devices_only , fenced_support_flag ( op -> action ) ) ) { crm_trace ( "Simple fencing" ) ; return peer ; } } return NULL ; } 