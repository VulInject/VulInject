int i915_gem_object_unbind ( struct drm_i915_gem_object * obj ) { struct i915_vma * vma ; LIST_HEAD ( still_in_list ) ; int ret ; lockdep_assert_held ( & obj -> base . dev -> struct_mutex ) ; ret = i915_gem_object_wait ( obj , I915_WAIT_INTERRUPTIBLE | I915_WAIT_LOCKED | I915_WAIT_ALL , MAX_SCHEDULE_TIMEOUT , NULL ) ; i915_gem_retire_requests ( to_i915 ( obj -> base . dev ) ) ; while ( ( vma = list_first_entry_or_null ( & obj -> vma_list , i915_vma , obj_link ) ) ) { list_move_tail ( & vma -> obj_link , & still_in_list ) ; ret = i915_vma_unbind ( vma ) ; if ( ret ) { break ; } } list_splice ( & still_in_list , & obj -> vma_list ) ; return ret ; } 