static int igt_cpu_check ( struct drm_i915_gem_object * obj , u32 dword , u32 val ) { unsigned long n = obj -> base . size >> PAGE_SHIFT ; u32 * ptr ; int err ; err = i915_gem_object_wait ( obj , 0 , MAX_SCHEDULE_TIMEOUT ) ; ptr = i915_gem_object_pin_map ( obj , I915_MAP_WC ) ; if ( IS_ERR ( ptr ) ) { return PTR_ERR ( ptr ) ; } ptr += dword ; while ( n -- ) { if ( * ptr != val ) { pr_err ( "base[%u]=%08x, val=%08x\n" , dword , * ptr , val ) ; err = - EINVAL ; break ; } ptr += PAGE_SIZE / sizeof ( * ptr ) ; } i915_gem_object_unpin_map ( obj ) ; return err ; } 