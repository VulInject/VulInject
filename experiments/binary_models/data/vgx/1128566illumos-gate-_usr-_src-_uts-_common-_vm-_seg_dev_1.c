int devmap_unload ( devmap_cookie_t dhc , offset_t offset , size_t len ) { register devmap_handle_t * dhp = ( devmap_handle_t * ) dhc ; caddr_t addr ; ulong_t size ; ssize_t soff ; TRACE_3 ( TR_FAC_DEVMAP , TR_DEVMAP_UNLOAD , "devmap_unload:start dhp=%p offset=%llx len=%lx" , ( void * ) dhp , offset , len ) ; DEBUGF ( 7 , ( CE_CONT , "devmap_unload: dhp %p offset %llx len %lx\n" , ( void * ) dhp , offset , len ) ) ; soff = ( ssize_t ) ( offset - dhp -> dh_uoff ) ; soff = round_down_p2 ( soff , PAGESIZE ) ; len = round_up_p2 ( len , PAGESIZE ) ; if ( len == 0 ) { size = dhp -> dh_len - soff ; } else { size = len ; if ( ( soff + size ) > dhp -> dh_len ) { return ( FC_MAKE_ERR ( EINVAL ) ) ; } } addr = ( caddr_t ) ( soff + dhp -> dh_uvaddr ) ; if ( dhp -> dh_flags & DEVMAP_FLAG_LARGE ) { hat_unload ( dhp -> dh_seg -> s_as -> a_hat , dhp -> dh_uvaddr , dhp -> dh_len , HAT_UNLOAD | HAT_UNLOAD_OTHER ) ; } else { hat_unload ( dhp -> dh_seg -> s_as -> a_hat , addr , size , HAT_UNLOAD | HAT_UNLOAD_OTHER ) ; } return ( 0 ) ; } 