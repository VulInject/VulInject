long BufFileAppend ( BufFile * target , BufFile * source ) { long startBlock = target -> numFiles * BUFFILE_SEG_SIZE ; int newNumFiles = target -> numFiles + source -> numFiles ; int i ; Assert ( target -> fileset != NULL ) ; Assert ( source -> readOnly , NULL ) ; Assert ( ! source -> dirty ) ; Assert ( source -> fileset != NULL ) ; if ( target -> resowner != source -> resowner ) { elog ( ERROR , "could not append BufFile with non-matching resource owner" ) ; } target -> files = ( File * ) repalloc ( target -> files , sizeof ( File ) * newNumFiles ) ; for ( i = target -> numFiles ; i < newNumFiles ; i ++ ) { target -> files [ i ] = source -> files [ i - target -> numFiles ] ; } target -> numFiles = newNumFiles ; return startBlock ; } 