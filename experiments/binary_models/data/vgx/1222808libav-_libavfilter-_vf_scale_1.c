static int filter_frame ( AVFilterLink * link , AVFrame * in ) { ScaleContext * scale = link -> dst -> priv ; AVFilterLink * outlink = link -> dst -> outputs [ 0 ] ; AVFrame * out ; const AVPixFmtDescriptor * desc = av_pix_fmt_desc_get ( link -> format ) ; if ( ! scale -> sws ) { return ff_filter_frame ( outlink , in ) ; } scale -> hsub = desc -> log2_chroma_w ; scale -> vsub = desc -> log2_chroma_h ; out = ff_get_video_buffer ( outlink , outlink -> w , outlink -> h ) ; if ( ! out ) { return AVERROR ( ENOMEM ) ; } av_frame_copy_props ( out , in ) ; out -> width = outlink -> w ; out -> height = outlink -> h ; av_reduce ( & out -> sample_aspect_ratio . num , & out -> sample_aspect_ratio . den , ( int64_t ) in -> sample_aspect_ratio . num * outlink -> h * link -> w , ( int64_t ) in -> sample_aspect_ratio . den * outlink -> w * link -> h , INT_MAX ) ; sws_scale ( scale -> sws , in -> data , in -> linesize , 0 , in -> height , out -> data , out -> linesize ) ; av_frame_free ( & in ) ; return ff_filter_frame ( outlink , out ) ; } static const AVOption options [ ] { { "w" "Output video width" OFFSET ( w_expr ) AV_OPT_TYPE_STRING { . str = "iw" } . flags = FLAGS } { "h" "Output video height" OFFSET ( h_expr ) AV_OPT_TYPE_STRING { . str = "ih" } . flags = FLAGS } { "flags" "Flags to pass to libswscale" OFFSET ( flags_str ) AV_OPT_TYPE_STRING { . str = "bilinear" } . flags = FLAGS } { "param0" "Scaler param 0" OFFSET ( param [ 0 ] ) AV_OPT_TYPE_DOUBLE { . dbl = SWS_PARAM_DEFAULT } INT_MIN INT_MAX FLAGS } { "param1" "Scaler param 1" OFFSET ( param [ 1 ] ) AV_OPT_TYPE_DOUBLE { . dbl = SWS_PARAM_DEFAULT } INT_MIN INT_MAX FLAGS } { NULL } } ; ; 