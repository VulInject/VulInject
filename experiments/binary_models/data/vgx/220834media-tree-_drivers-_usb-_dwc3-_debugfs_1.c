static int dwc3_mode_show ( struct seq_file * s , void * unused ) { struct dwc3 * dwc = s -> private ; cfs_time_t flags ; u32 reg ; spin_lock_irqsave ( & dwc -> lock , flags ) ; reg = dwc3_readl ( dwc -> regs , DWC3_GCTL ) ; spin_unlock_irqrestore ( & dwc -> lock , flags ) ; switch ( DWC3_GCTL_PRTCAP ( reg ) ) { case DWC3_GCTL_PRTCAP_HOST : seq_printf ( s , "host\n" ) ; break ; case DWC3_GCTL_PRTCAP_DEVICE : seq_printf ( s , "device\n" ) ; break ; case DWC3_GCTL_PRTCAP_OTG : seq_printf ( s , "otg\n" ) ; break ; default : seq_printf ( s , "UNKNOWN %08x\n" , DWC3_GCTL_PRTCAP ( reg ) ) ; } return 0 ; } 