static int nt35510_power_on ( struct nt35510 * nt ) { struct mipi_dsi_device * dsi = to_mipi_dsi_device ( nt -> dev ) ; int ret ; ret = regulator_bulk_enable ( ARRAY_SIZE ( nt -> supplies ) , nt -> supplies ) ; if ( ret < 0 ) { dev_err ( nt -> dev , "unable to enable regulators\n" ) ; return ret ; } if ( nt -> reset_gpio ) { gpiod_set_value ( nt -> reset_gpio , 1 ) ; usleep_range ( 20 , 1000 ) ; gpiod_set_value ( nt -> reset_gpio , 0 ) ; usleep_range ( 120000 , 140000 ) ; } ret = nt35510_send_long ( nt , dsi , MCS_CMD_MTP_READ_PARAM , ARRAY_SIZE ( nt35510_mauc_mtp_read_param ) , nt35510_mauc_mtp_read_param ) ; ret = nt35510_send_long ( nt , dsi , MCS_CMD_MTP_READ_SETTING , ARRAY_SIZE ( nt35510_mauc_mtp_read_setting ) , nt35510_mauc_mtp_read_setting ) ; if ( ret ) { return ret ; } nt35510_read_id ( nt ) ; ret = nt35510_send_long ( nt , dsi , MCS_CMD_MAUCCTR , ARRAY_SIZE ( nt35510_mauc_select_page_1 ) , nt35510_mauc_select_page_1 ) ; if ( ret ) { return ret ; } ret = nt35510_setup_power ( nt ) ; if ( ret ) { return ret ; } ret = nt35510_send_long ( nt , dsi , NT35510_P1_SET_GAMMA_RED_POS , NT35510_P1_GAMMA_LEN , nt -> conf -> gamma_corr_pos_r ) ; if ( ret ) { return ret ; } ret = nt35510_send_long ( nt , dsi , NT35510_P1_SET_GAMMA_GREEN_POS , NT35510_P1_GAMMA_LEN , nt -> conf -> gamma_corr_pos_g ) ; if ( ret ) { return ret ; } ret = nt35510_send_long ( nt , dsi , NT35510_P1_SET_GAMMA_BLUE_POS , NT35510_P1_GAMMA_LEN , nt -> conf -> gamma_corr_pos_b ) ; if ( ret ) { return ret ; } ret = nt35510_send_long ( nt , dsi , NT35510_P1_SET_GAMMA_RED_NEG , NT35510_P1_GAMMA_LEN , nt -> conf -> gamma_corr_neg_r ) ; if ( ret ) { return ret ; } ret = nt35510_send_long ( nt , dsi , NT35510_P1_SET_GAMMA_GREEN_NEG , NT35510_P1_GAMMA_LEN , nt -> conf -> gamma_corr_neg_g ) ; if ( ret ) { return ret ; } ret = nt35510_send_long ( nt , dsi , NT35510_P1_SET_GAMMA_BLUE_NEG , NT35510_P1_GAMMA_LEN , nt -> conf -> gamma_corr_neg_b ) ; if ( ret ) { return ret ; } ret = nt35510_send_long ( nt , dsi , MCS_CMD_MAUCCTR , ARRAY_SIZE ( nt35510_mauc_select_page_0 ) , nt35510_mauc_select_page_0 ) ; if ( ret ) { return ret ; } ret = nt35510_setup_display ( nt ) ; if ( ret ) { return ret ; } return 0 ; } 