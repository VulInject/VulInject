static void qla4xxx_wait_for_ip_configuration ( struct scsi_qla_host * ha ) { uint32_t idx = 0 ; uint32_t ip_idx [ IP_ADDR_COUNT ] { 0 1 2 3 } ; ; uint32_t sts [ MBOX_REG_COUNT ] ; uint32_t ip_state ; cfs_time_t wtime ; int ret ; wtime = jiffies + ( HZ * IP_CONFIG_TOV ) ; { for ( idx = 0 ; idx < IP_ADDR_COUNT ; idx ++ ) { if ( ip_idx [ idx ] == - 1 ) { continue ; } ret = qla4xxx_get_ip_state ( ha , 0 , ip_idx [ idx ] , sts ) ; if ( ret == QLA_ERROR ) { ip_idx [ idx ] = - 1 ; continue ; } ip_state = ( sts [ 1 ] & IP_STATE_MASK ) >> IP_STATE_SHIFT ; DEBUG2 ( ql4_printk ( KERN_INFO , ha , "Waiting for IP state for idx = %d, state = 0x%x\n" , ip_idx [ idx ] , ip_state ) ) ; if ( ip_state == IP_ADDRSTATE_UNCONFIGURED || ip_state == IP_ADDRSTATE_INVALID || ip_state == IP_ADDRSTATE_PREFERRED || ip_state == IP_ADDRSTATE_DEPRICATED || ip_state == IP_ADDRSTATE_DISABLING ) { ip_idx [ idx ] = - 1 ; } } if ( ( ip_idx [ 0 ] == - 1 ) && ( ip_idx [ 1 ] == - 1 ) && ( ip_idx [ 2 ] == - 1 ) && ( ip_idx [ 3 ] == - 1 ) ) { break ; } schedule_timeout_uninterruptible ( HZ ) ; } time_after ( wtime , jiffies ) ; } 