static int __init exiu_dt_init ( struct device_node * node , struct device_node * parent ) { struct irq_domain * parent_domain , * domain ; struct exiu_irq_data * data ; struct resource res ; if ( ! parent ) { pr_err ( "%pOF: no parent, giving up\n" , node ) ; return - ENODEV ; } parent_domain = irq_find_host ( parent ) ; if ( ! parent_domain ) { pr_err ( "%pOF: unable to obtain parent domain\n" , node ) ; return - ENXIO ; } if ( of_address_to_resource ( node , 0 , & res ) ) { pr_err ( "%pOF: failed to parse memory resource\n" , node ) ; return - ENXIO ; } data = exiu_init ( of_node_to_fwnode ( node ) , & res ) ; if ( IS_ERR ( data ) ) { return PTR_ERR ( data ) ; } domain = irq_domain_add_hierarchy ( parent_domain , 0 , NUM_IRQS , node , & exiu_domain_ops , data ) ; if ( ! domain ) { pr_err ( "%pOF: failed to allocate domain\n" , node ) ; out_unmap } pr_info ( "%pOF: %d interrupts forwarded to %pOF\n" , node , NUM_IRQS , parent ) ; return 0 ; out_unmap iounmap ( data -> base ) ; return - ENOMEM ; } 