static int mds_sessions_show ( struct seq_file * s , void * ptr ) { struct ceph_fs_client * fsc = s -> private ; struct ceph_mds_client * mdsc = fsc -> mdsc ; struct ceph_auth_client * ac = fsc -> client -> monc . auth ; struct ceph_options * opt = fsc -> client -> options ; int mds = - 1 ; seq_printf ( s , "global_id %llu\n" , ac -> global_id ) ; seq_printf ( s , "name \"%s\"\n" , opt -> name ?opt -> name : "" ) ; for ( mds = 0 ; mds < mdsc -> max_sessions ; mds ++ ) { struct ceph_mds_session * session = __ceph_lookup_mds_session ( mdsc , mds ) ; if ( ! session ) { continue ; } mutex_unlock ( & mdsc -> mutex ) ; seq_printf ( s , "mds.%d %s\n" , session -> s_mds , ceph_session_state_name ( session -> s_state ) ) ; ceph_put_mds_session ( session ) ; mutex_lock ( & mdsc -> mutex ) ; } mutex_unlock ( & mdsc -> mutex ) ; return 0 ; } 