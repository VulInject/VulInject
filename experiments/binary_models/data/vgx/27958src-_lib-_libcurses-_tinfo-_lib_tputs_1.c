NCURSES_EXPORT ( ) tputs ( , , ) { bool always_delay ; bool normal_delay ; int number ; int trailpad ; char addrbuf [ 32 ] ; if ( USE_TRACEF ( TRACE_TPUTS ) ) { if ( outc == _nc_outch ) { ( void ) strlcpy ( addrbuf , "_nc_outch" , sizeof ( addrbuf ) ) ; } else { ( void ) snprintf ( addrbuf , sizeof ( addrbuf ) , "%p" , outc ) ; } if ( _nc_tputs_trace ) { _tracef ( "tputs(%s = %s, %d, %s) called" , _nc_tputs_trace , _nc_visbuf ( string ) , affcnt , addrbuf ) ; } else { _tracef ( "tputs(%s, %d, %s) called" , _nc_visbuf ( string ) , affcnt , addrbuf ) ; } TPUTS_TRACE ( NULL , NULL ) ; _nc_unlock_global ( tracef ) ; } if ( ! VALID_STRING ( string ) ) { return ERR ; } if ( cur_term == 0 ) { always_delay = FALSE ; normal_delay = TRUE ; } else { always_delay = ( string == bell ) || ( string == flash_screen ) ; normal_delay = ! xon_xoff && padding_baud_rate && ! GetNoPadding ( SP ) && ( _nc_baudrate ( ospeed ) >= padding_baud_rate ) ; } trailpad = 0 ; if ( isdigit ( UChar ( * string ) ) ) { while ( isdigit ( UChar ( * string ) ) ) { trailpad = trailpad * 10 + ( * string - '0' ) ; string ++ ; } trailpad *= 10 ; if ( * string == '.' ) { string ++ ; if ( isdigit ( UChar ( * string ) ) ) { trailpad += ( * string - '0' ) ; string ++ ; } while ( isdigit ( UChar ( * string ) ) ) { string ++ ; } } if ( * string == '*' ) { trailpad *= affcnt ; string ++ ; } } my_outch = outc ; while ( * string ) { if ( * string != '$' ) { * outc ( * string ) ; } else { string ++ ; if ( * string != '<' ) { * outc ( '$' ) ; if ( * string ) { * outc ( * string ) ; } } else { bool mandatory ; string ++ ; if ( ( ! isdigit ( UChar ( * string ) ) && * string != '.' ) || ! strchr ( string , '>' ) ) { * outc ( '$' ) ; * outc ( '<' ) ; continue ; } number = 0 ; while ( isdigit ( UChar ( * string ) ) ) { number = number * 10 + ( * string - '0' ) ; string ++ ; } number *= 10 ; if ( * string == '.' ) { string ++ ; if ( isdigit ( UChar ( * string ) ) ) { number += ( * string - '0' ) ; string ++ ; } while ( isdigit ( UChar ( * string ) ) ) { string ++ ; } } mandatory = FALSE ; while ( * string == '*' || * string == '/' ) { if ( * string == '*' ) { number *= affcnt ; string ++ ; } else { mandatory = TRUE ; string ++ ; } } if ( number > 0 && ( always_delay || normal_delay || mandatory ) ) { delay_output ( number / 10 ) ; } } } if ( * string == '\0' ) { break ; } string ++ ; } if ( trailpad > 0 && ( always_delay || normal_delay ) ) { delay_output ( trailpad / 10 ) ; } my_outch = _nc_outch ; return OK ; } 