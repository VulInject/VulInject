static int lp55xx_init_led ( struct lp55xx_led * led , struct lp55xx_chip * chip , int chan ) { struct lp55xx_platform_data * pdata = chip -> pdata ; struct lp55xx_device_config * cfg = chip -> cfg ; struct device * dev = & chip -> cl -> dev ; char name [ 32 ] ; int ret ; int max_channel = cfg -> max_channel ; if ( chan >= max_channel ) { dev_err ( dev , "invalid channel: %d / %d\n" , chan , max_channel ) ; return - EINVAL ; } if ( pdata -> led_config [ chan ] . led_current == 0 ) { return 0 ; } led -> led_current = pdata -> led_config [ chan ] . led_current ; led -> max_current = pdata -> led_config [ chan ] . max_current ; led -> chan_nr = pdata -> led_config [ chan ] . chan_nr ; led -> cdev . default_trigger = pdata -> led_config [ chan ] . default_trigger ; if ( led -> chan_nr >= max_channel ) { dev_err ( dev , "Use channel numbers between 0 and %d\n" , max_channel - 1 ) ; return - EINVAL ; } led -> cdev . brightness_set_blocking = lp55xx_set_brightness ; led -> cdev . groups = lp55xx_led_groups ; if ( pdata -> led_config [ chan ] . name ) { led -> cdev . name = pdata -> led_config [ chan ] . name ; } else { sprintf ( name , "%s:channel%d" , pdata -> label ?: chip -> cl -> name , chan ) ; led -> cdev . name = name ; } ret = led_classdev_register ( dev , & led -> cdev ) ; if ( ret ) { dev_err ( dev , "led register err: %d\n" , ret ) ; return ret ; } return 0 ; } 