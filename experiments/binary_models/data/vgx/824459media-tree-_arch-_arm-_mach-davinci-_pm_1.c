int __init davinci_pm_init ( void ) { int ret ; ret = davinci_cfg_reg ( DA850_RTC_ALARM ) ; pm_config . ddr2_ctlr_base = da8xx_get_mem_ctlr ( ) ; pm_config . deepsleep_reg = DA8XX_SYSCFG1_VIRT ( DA8XX_DEEPSLEEP_REG ) ; pm_config . cpupll_reg_base = ioremap ( DA8XX_PLL0_BASE , SZ_4K ) ; if ( ! pm_config . cpupll_reg_base ) { return - ENOMEM ; } pm_config . ddrpll_reg_base = ioremap ( DA850_PLL1_BASE , SZ_4K ) ; if ( ! pm_config . ddrpll_reg_base ) { ret = - ENOMEM ; no_ddrpll_mem } pm_config . ddrpsc_reg_base = ioremap ( DA8XX_PSC1_BASE , SZ_4K ) ; if ( ! pm_config . ddrpsc_reg_base ) { ret = - ENOMEM ; no_ddrpsc_mem } davinci_sram_suspend = sram_alloc ( davinci_cpu_suspend_sz , NULL ) ; if ( ! davinci_sram_suspend ) { pr_err ( "PM: cannot allocate SRAM memory\n" ) ; return - ENOMEM ; } davinci_sram_push ( davinci_sram_suspend , davinci_cpu_suspend , davinci_cpu_suspend_sz ) ; suspend_set_ops ( & davinci_pm_ops ) ; no_ddrpsc_mem iounmap ( pm_config . ddrpll_reg_base ) ; no_ddrpll_mem iounmap ( pm_config . cpupll_reg_base ) ; return ret ; } 