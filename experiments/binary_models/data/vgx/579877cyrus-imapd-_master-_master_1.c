static int parse_inet_listen ( const char * listen , char * * hostp , char * * portp ) { const char * cp ; * portp = NULL ; * hostp = NULL ; if ( listen [ 0 ] == '[' ) { cp = strrchr ( listen , ']' ) ; cp ++ ; if ( * cp == ':' ) { if ( ! cp [ 1 ] ) { return - 1 ; } * hostp = xstrndup ( listen + 1 , ( cp - listen - 2 ) ) ; * portp = xstrdup ( cp + 1 ) ; return 0 ; } if ( ! * cp ) { * hostp = xstrndup ( listen + 1 , ( cp - listen - 2 ) ) ; return 0 ; } return - 1 ; } cp = strrchr ( listen , ':' ) ; if ( cp ) { if ( ! cp [ 1 ] ) { return - 1 ; } * hostp = xstrndup ( listen , ( cp - listen ) ) ; * portp = xstrdup ( cp + 1 ) ; return 0 ; } * portp = xstrdup ( listen ) ; return 0 ; } 