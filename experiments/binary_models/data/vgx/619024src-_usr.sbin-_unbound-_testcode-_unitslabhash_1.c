static void test_long_table ( struct slabhash * table ) { testdata_type * ref [ HASHTESTMAX * 100 ] ; size_t i ; if ( 0 ) { slabhash_status ( table , "unit test" , 1 ) ; } srandom ( 48 ) ; for ( i = 0 ; i < 1000 ; i ++ ) { if ( i == 500 ) { slabhash_clear ( table ) ; memset ( ref , 0 , sizeof ( ref ) ) ; continue ; } switch ( random ( ) % 4 ) { case 0 : case 3 : testadd ( table , ref ) ; break ; case 1 : testremove ( table , ref ) ; break ; case 2 : testlookup ( table , ref ) ; break ; default : unit_assert ( 0 ) ; } if ( 0 ) { slabhash_status ( table , "unit test" , 1 ) ; } check_table ( table ) ; } for ( i = 0 ; i < 1000 ; i ++ ) { switch ( random ( ) % 4 ) { case 0 : case 3 : testadd_unlim ( table , ref ) ; break ; case 1 : testremove_unlim ( table , ref ) ; break ; case 2 : testlookup_unlim ( table , ref ) ; break ; default : unit_assert ( 0 ) ; } if ( 0 ) { slabhash_status ( table , "unlim" , 1 ) ; } check_table ( table ) ; } } 