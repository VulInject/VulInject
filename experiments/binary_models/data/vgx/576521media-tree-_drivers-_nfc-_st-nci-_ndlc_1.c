static void llt_ndlc_sm_work ( struct work_struct * work ) { struct llt_ndlc * ndlc = container_of ( work , llt_ndlc , sm_work ) ; llt_ndlc_send_queue ( ndlc , NULL ) ; llt_ndlc_rcv_queue ( ndlc ) ; if ( ndlc -> t1_active && timer_pending ( & ndlc -> t1_timer ) == 0 ) { pr_debug ( "Handle T1(recv SUPERVISOR) elapsed (T1 now inactive)\n" ) ; ndlc -> t1_active = false ; llt_ndlc_requeue_data_pending ( ndlc ) ; llt_ndlc_send_queue ( ndlc ) ; } if ( ndlc -> t2_active && timer_pending ( & ndlc -> t2_timer ) == 0 ) { pr_debug ( "Handle T2(recv DATA) elapsed (T2 now inactive)\n" ) ; ndlc -> t2_active = false ; ndlc -> t1_active = false ; del_timer_sync ( & ndlc -> t1_timer ) ; del_timer_sync ( & ndlc -> t2_timer ) ; ndlc_close ( ndlc ) ; ndlc -> hard_fault = - EREMOTEIO ; } } 