static struct drm_plane_state * omap_plane_atomic_duplicate_state ( struct drm_plane * plane ) { struct omap_plane_state * state ; struct omap_plane_state * copy ; if ( WARN_ON ( ! plane -> state ) ) { return in ; } state = to_omap_plane_state ( plane -> state ) ; copy = kmemdup ( state , sizeof ( * state ) , GFP_KERNEL ) ; if ( copy == NULL ) { return NULL ; } __drm_atomic_helper_plane_duplicate_state ( plane , & copy -> base ) ; return & copy -> base ; } 