static int nv50_dac_create ( struct drm_connector * connector , struct dcb_output * dcbe ) { struct nouveau_drm * drm = nouveau_drm ( connector -> dev ) ; struct nvkm_i2c * i2c = nvxx_i2c ( & drm -> client . device ) ; struct nvkm_i2c_bus * bus ; struct nouveau_encoder * nv_encoder ; struct drm_encoder * encoder ; int type = DRM_MODE_ENCODER_DAC ; nv_encoder = kzalloc ( sizeof ( * nv_encoder ) , GFP_KERNEL ) ; nv_encoder -> dcb = dcbe ; nv_encoder -> or = ffs ( dcbe -> or ) - 1 ; bus = nvkm_i2c_bus_find ( i2c , dcbe -> i2c_index ) ; if ( bus ) { nv_encoder -> i2c = & bus -> i2c ; } encoder = to_drm_encoder ( nv_encoder ) ; encoder -> possible_crtcs = dcbe -> heads ; encoder -> possible_clones = 0 ; drm_encoder_init ( connector -> dev , encoder , & nv50_dac_func , type , "dac-%04x-%04x" , dcbe -> hasht , dcbe -> hashm ) ; drm_encoder_helper_add ( encoder , & nv50_dac_help ) ; drm_mode_connector_attach_encoder ( connector , encoder ) ; return 0 ; } 