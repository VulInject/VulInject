static void awaylog_close ( void ) { const char * fname ; LOG_REC * log ; fname = settings_get_str ( "awaylog_file" ) ; if ( * fname == '\0' ) { return ; } log = log_find ( fname ) ; if ( log == NULL || log -> handle == - 1 ) { return ; } if ( awaylog == log ) { awaylog = NULL ; } write_buffer_flush ( ) ; signal_emit ( "awaylog show" , 3 , log , GINT_TO_POINTER ( away_msgs ) , GINT_TO_POINTER ( away_filepos ) ) ; log_close ( log , NULL ) ; } 