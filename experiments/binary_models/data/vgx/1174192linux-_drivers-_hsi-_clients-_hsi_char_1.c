static int hsc_tx_set ( struct hsi_client * cl , struct hsc_tx_config * txc ) { struct hsi_config tmp ; int ret ; if ( ( txc -> mode != HSI_MODE_STREAM ) && ( txc -> mode != HSI_MODE_FRAME ) ) { return - EINVAL ; } if ( ( txc -> channels == 0 ) || ( txc -> channels > HSC_DEVS ) ) { return - EINVAL ; } if ( ( txc -> arb_mode != HSI_ARB_RR ) && ( txc -> arb_mode != HSI_ARB_PRIO ) ) { return - EINVAL ; } tmp = cl -> tx_cfg ; cl -> tx_cfg . mode = txc -> mode ; cl -> tx_cfg . num_hw_channels = txc -> channels ; cl -> tx_cfg . speed = txc -> speed ; cl -> tx_cfg . arb_mode = txc -> arb_mode ; ret = hsi_setup ( cl ) ; if ( ret < 0 ) { cl -> tx_cfg = tmp ; return ret ; } return ret ; } 