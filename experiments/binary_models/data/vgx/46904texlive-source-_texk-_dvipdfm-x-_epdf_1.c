get_page_content ( , ) { pdf_obj * contents , * content_new ; contents = pdf_deref_obj ( pdf_lookup_dict ( page , "Contents" ) ) ; if ( ! contents ) { return in ; } if ( PDF_OBJ_NULLTYPE ( contents ) ) { pdf_release_obj ( contents ) ; contents = pdf_new_stream ( 0 ) ; } if ( PDF_OBJ_ARRAYTYPE ( contents ) ) { pdf_obj * content_seg ; int i ; content_new = pdf_new_stream ( STREAM_COMPRESS ) ; for ( i = 0 ; i < pdf_array_length ( contents ) ; i ++ ) { content_seg = pdf_deref_obj ( pdf_get_array ( contents , i ) ) ; if ( ! content_seg ) { WARN ( "Could not read page content stream." ) ; pdf_release_obj ( content_new ) ; pdf_release_obj ( contents ) ; return NULL ; } if ( PDF_OBJ_STREAMTYPE ( content_seg ) ) { pdf_concat_stream ( content_new , content_seg ) ; } if ( ! PDF_OBJ_NULLTYPE ( content_seg ) ) { WARN ( "Page content not a stream object. Broken PDF file?" ) ; pdf_release_obj ( content_seg ) ; pdf_release_obj ( content_new ) ; pdf_release_obj ( contents ) ; return NULL ; } pdf_release_obj ( content_seg ) ; } pdf_release_obj ( contents ) ; contents = content_new ; } else { if ( ! PDF_OBJ_STREAMTYPE ( contents ) ) { WARN ( "Page content not a stream object. Broken PDF file?" ) ; pdf_release_obj ( contents ) ; return NULL ; } content_new = pdf_new_stream ( STREAM_COMPRESS ) ; pdf_concat_stream ( content_new , contents ) ; pdf_release_obj ( contents ) ; contents = content_new ; } return contents ; } 