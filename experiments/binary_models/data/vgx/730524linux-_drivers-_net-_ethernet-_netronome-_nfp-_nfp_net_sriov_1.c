int nfp_app_set_vf_link_state ( struct net_device * netdev , int vf , int link_state ) { struct nfp_app * app = nfp_app_from_netdev ( netdev ) ; unsigned int vf_offset ; u8 vf_ctrl ; int err ; err = nfp_net_sriov_check ( app , vf , NFP_NET_VF_CFG_MB_CAP_LINK_STATE , "link_state" , true ) ; switch ( link_state ) { case IFLA_VF_LINK_STATE_AUTO : case IFLA_VF_LINK_STATE_ENABLE : case IFLA_VF_LINK_STATE_DISABLE : break ; default : return - EINVAL ; } vf_offset = NFP_NET_VF_CFG_MB_SZ + vf * NFP_NET_VF_CFG_SZ + NFP_NET_VF_CFG_CTRL ; vf_ctrl = readb ( app -> pf -> vfcfg_tbl2 + vf_offset ) ; vf_ctrl &= ~ NFP_NET_VF_CFG_CTRL_LINK_STATE ; vf_ctrl |= FIELD_PREP ( NFP_NET_VF_CFG_CTRL_LINK_STATE , link_state ) ; writeb ( vf_ctrl , app -> pf -> vfcfg_tbl2 + vf_offset ) ; return nfp_net_sriov_update ( app , vf , NFP_NET_VF_CFG_MB_UPD_LINK_STATE , "link state" ) ; } 