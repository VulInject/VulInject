int qed_dcbx_config_params ( struct qed_hwfn * p_hwfn , struct qed_ptt * p_ptt , struct qed_dcbx_set * params , bool hw_commit ) { struct dcbx_local_params local_admin ; struct qed_dcbx_mib_meta_data data ; u32 resp = 0 , param = 0 ; int rc = 0 ; if ( ! hw_commit ) { memcpy ( & p_hwfn -> p_dcbx_info -> set , params , sizeof ( qed_dcbx_set ) ) ; return 0 ; } memset ( & p_hwfn -> p_dcbx_info -> set , 0 , sizeof ( p_hwfn -> p_dcbx_info -> set ) ) ; qed_dcbx_set_local_params ( p_hwfn , & local_admin , params ) ; data . addr = p_hwfn -> mcp_info -> port_addr + offsetof ( public_port , local_admin_dcbx_mib ) ; data . local_admin = & local_admin ; data . size = sizeof ( dcbx_local_params ) ; qed_memcpy_to ( p_hwfn , p_ptt , data . addr , data . local_admin , data . size ) ; rc = qed_mcp_cmd ( p_hwfn , p_ptt , DRV_MSG_CODE_SET_DCBX , 1 << DRV_MB_PARAM_LLDP_SEND_SHIFT , & resp , & param ) ; if ( rc ) { DP_NOTICE ( p_hwfn , "Failed to send DCBX update request\n" ) ; } return rc ; } 