extern int as_mysql_get_modified_lfts ( mysql_conn_t * mysql_conn , char * cluster_name , uint32_t start_lft ) { MYSQL_RES * result = NULL ; MYSQL_ROW row ; char * query = xstrdup_printf ( "select id_assoc, lft from \"%s_%s\" where lft>%u " "&&deleted = 0" , cluster_name , assoc_table , start_lft ) ; DB_DEBUG ( DB_ASSOC , mysql_conn -> conn , "query\n%s" , query ) ; if ( ! ( result = mysql_db_query_ret ( mysql_conn , query , 0 ) ) ) { error ( "couldn't query the database for modified lfts" ) ; return SLURM_ERROR ; } xfree ( query ) ; while ( ( row = mysql_fetch_row ( result ) ) ) { slurmdb_assoc_rec_t * assoc = xmalloc ( sizeof ( slurmdb_assoc_rec_t ) ) ; slurmdb_init_assoc_rec ( assoc , 0 ) ; assoc -> id = slurm_atoul ( row [ 0 ] ) ; assoc -> lft = slurm_atoul ( row [ 1 ] ) ; assoc -> cluster = xstrdup ( cluster_name ) ; if ( addto_update_list ( mysql_conn -> update_list , SLURMDB_MODIFY_ASSOC , assoc ) != SLURM_SUCCESS ) { slurmdb_destroy_assoc_rec ( assoc ) ; } } mysql_free_result ( result ) ; return SLURM_SUCCESS ; } 