int exofs_set_link ( struct inode * dir , struct exofs_dir_entry * de , struct page * page , struct inode * inode ) { loff_t pos = page_offset ( page ) + ( char * ) de - ( char * ) page_address ( page ) ; unsigned len = le16_to_cpu ( de -> rec_len ) ; int err ; lock_page ( page , NULL ) ; err = exofs_write_begin ( NULL , page -> mapping , pos , len , 0 , & page , NULL ) ; if ( err ) { EXOFS_ERR ( "exofs_set_link: exofs_write_begin FAILED =>%d\n" , err ) ; } de -> inode_no = cpu_to_le64 ( inode -> i_ino ) ; exofs_set_de_type ( de , inode ) ; if ( likely ( ! err ) ) { err = exofs_commit_chunk ( page , pos , len ) ; } exofs_put_page ( page ) ; dir -> i_mtime = dir -> i_ctime = current_time ( dir ) ; mark_inode_dirty ( dir ) ; return err ; } 