static int amdgpu_cgs_gmap_gpu_mem ( struct cgs_device * cgs_device , cgs_handle_t handle , uint64_t * mcaddr ) { int r ; u64 min_offset , max_offset ; struct amdgpu_bo * obj = ( amdgpu_bo * ) handle ; WARN_ON_ONCE ( obj -> placement . num_placement > 1 ) ; min_offset = obj -> placements [ 0 ] . fpfn << PAGE_SHIFT ; max_offset = obj -> placements [ 0 ] . lpfn << PAGE_SHIFT ; r = amdgpu_bo_reserve ( obj , true ) ; if ( unlikely ( r != 0 ) ) { return r ; } r = amdgpu_bo_pin_restricted ( obj , obj -> prefered_domains , min_offset , max_offset , mcaddr ) ; amdgpu_bo_unreserve ( obj , NULL ) ; return r ; } 