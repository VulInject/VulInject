SQLRETURN SQLNativeSql ( SQLHDBC hdbc , SQLCHAR * szSqlStrIn , SQLINTEGER cbSqlStrIn , SQLCHAR * szSqlStr , SQLINTEGER cbSqlStrMax , SQLINTEGER * pcbSqlStr ) { static char * const func = "SQLNativeSql" ; int len = 0 ; char * ptr ; ConnectionClass * conn = ( ConnectionClass * ) hdbc ; RETCODE result ; mylog ( "%s: entering...cbSqlStrIn=%d\n" , func , cbSqlStrIn ) ; ptr = ( cbSqlStrIn == 0 ) ?"" : make_string ( ( char * ) szSqlStrIn , cbSqlStrIn , NULL ) ; if ( ! ptr ) { CC_set_error ( conn , CONN_NO_MEMORY_ERROR , "No memory available to store native sql string" ) ; CC_log_error ( func , "" , conn ) ; return SQL_ERROR ; } result = SQL_SUCCESS ; len = strlen ( ptr ) ; if ( szSqlStr ) { strncpy_null ( ( char * ) szSqlStr , ptr , cbSqlStrMax ) ; if ( len >= cbSqlStrMax ) { result = SQL_SUCCESS_WITH_INFO ; CC_set_error ( conn , STMT_TRUNCATED , "The buffer was too small for the result." ) ; } } if ( pcbSqlStr ) { * pcbSqlStr = len ; } return result ; } 