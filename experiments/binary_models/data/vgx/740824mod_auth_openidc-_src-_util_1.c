const char * oidc_get_current_url_host ( request_rec * r , const apr_byte_t x_forwarded_headers ) { const char * host_str = NULL ; char * p ; char * i = NULL ; if ( x_forwarded_headers & OIDC_HDR_FORWARDED ) { host_str = oidc_util_hdr_forwarded_get ( r , "host" ) ; } if ( x_forwarded_headers & OIDC_HDR_X_FORWARDED_HOST ) { host_str = oidc_util_hdr_in_x_forwarded_host_get ( r ) ; } if ( host_str == NULL ) { host_str = oidc_util_hdr_in_host_get ( r ) ; } if ( host_str ) { host_str = apr_pstrdup ( r -> pool , host_str ) ; if ( host_str [ 0 ] == '[' ) { i = strchr ( host_str , ']' ) ; p = strchr ( i , OIDC_CHAR_COLON ) ; } else { p = strchr ( host_str , OIDC_CHAR_COLON ) ; } if ( p != NULL ) { * p = '\0' ; } } else { host_str = ap_get_server_name ( r ) ; } return host_str ; } 