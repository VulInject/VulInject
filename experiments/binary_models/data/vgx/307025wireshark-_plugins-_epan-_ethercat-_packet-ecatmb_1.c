static void SoeFormatter ( tvbuff_t * tvb , gint offset , char * szText , gint nMax , guint soe_length ) { ETHERCAT_SOE_HEADER soe ; char tmp [ 50 ] ; char elm [ 50 ] ; init_soe_header ( & soe , tvb , offset ) ; offset += ETHERCAT_SOE_HEADER_LEN ; if ( ! soe . anSoeHeaderControlUnion . v . Error ) { if ( ! soe . anSoeHeaderControlUnion . v . InComplete ) { SoEIdToString ( tmp , soe . anSoeHeaderDataUnion . IDN , sizeof ( tmp ) - 1 ) ; elm [ 0 ] = '\0' ; if ( soe . anSoeHeaderControlUnion . v . DataState ) { ( void ) g_strlcat ( elm , "D" , 50 ) ; } if ( soe . anSoeHeaderControlUnion . v . Name ) { ( void ) g_strlcat ( elm , "N" , 50 ) ; } if ( soe . anSoeHeaderControlUnion . v . Attribute ) { ( void ) g_strlcat ( elm , "A" , 50 ) ; } if ( soe . anSoeHeaderControlUnion . v . Unit ) { ( void ) g_strlcat ( elm , "U" , 50 ) ; } if ( soe . anSoeHeaderControlUnion . v . Min ) { ( void ) g_strlcat ( elm , "I" , 50 ) ; } if ( soe . anSoeHeaderControlUnion . v . Max ) { ( void ) g_strlcat ( elm , "X" , 50 ) ; } if ( soe . anSoeHeaderControlUnion . v . Value ) { ( void ) g_strlcat ( elm , "V" , 50 ) ; } switch ( soe . anSoeHeaderControlUnion . v . OpCode ) { case ECAT_SOE_OPCODE_RRQ : snprintf ( szText , nMax , "SoE: RRQ (%s, '%s')" , tmp , elm ) ; break ; case ECAT_SOE_OPCODE_RRS : snprintf ( szText , nMax , "SoE: RRS (%s, '%s') : %u Bytes" , tmp , elm , ( guint ) ( soe_length - ETHERCAT_SOE_HEADER_LEN ) ) ; break ; case ECAT_SOE_OPCODE_WRS : snprintf ( szText , nMax , "SoE: WRS (%s, '%s')" , tmp , elm ) ; break ; case ECAT_SOE_OPCODE_WRQ : snprintf ( szText , nMax , "SoE: WRQ (%s, '%s') : %u Bytes" , tmp , elm , ( guint ) ( soe_length - ETHERCAT_SOE_HEADER_LEN ) ) ; break ; case ECAT_SOE_OPCODE_NFC : snprintf ( szText , nMax , "SoE: NFC (%s, '%s') : %u Bytes" , tmp , elm , ( guint ) ( soe_length - ETHERCAT_SOE_HEADER_LEN ) ) ; break ; case 6 : snprintf ( szText , nMax , "SoE: EMGCY" ) ; break ; default : snprintf ( szText , nMax , "SoE:" ) ; } } else { snprintf ( szText , nMax , "SoE: FragmentsLeft %d" , soe . anSoeHeaderDataUnion . FragmentsLeft ) ; } } else { snprintf ( szText , nMax , "SoE: Error %04x" , tvb_get_letohs ( tvb , offset ) ) ; } } 