papi_status_t hold_release_job ( papi_service_t handle , char * printer , int32_t job_id , int flag ) { papi_status_t status ; service_t * svc = handle ; REQUEST * r = NULL ; char * file ; char * dest ; if ( ( svc == NULL ) || ( printer == NULL ) || ( job_id < 0 ) ) { return ( PAPI_BAD_ARGUMENT ) ; } if ( ( status = authorized ( svc , job_id ) ) != PAPI_OK ) { return ( status ) ; } dest = printer_name_from_uri_id ( printer , job_id ) ; status = lpsched_start_change ( svc , dest , job_id , & file ) ; if ( ( r = getrequest ( file ) ) != NULL ) { r -> actions &= ~ ACT_RESUME ; switch ( flag ) { case 0 : r -> actions |= ACT_HOLD ; break ; case 1 : r -> actions |= ACT_RESUME ; break ; case 2 : r -> actions |= ACT_IMMEDIATE ; break ; } if ( putrequest ( file , r ) < 0 ) { detailed_error ( svc , gettext ( "failed to write job: %s: %s" ) , file , strerror ( errno ) ) ; freerequest ( r ) ; return ( PAPI_DEVICE_ERROR ) ; } freerequest ( r ) ; } else { detailed_error ( svc , gettext ( "failed to read job: %s: %s" ) , file , strerror ( errno ) ) ; return ( PAPI_DEVICE_ERROR ) ; } status = lpsched_end_change ( svc , dest , job_id ) ; return ( status ) ; } 