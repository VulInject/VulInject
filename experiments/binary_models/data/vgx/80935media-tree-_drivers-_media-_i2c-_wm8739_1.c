static int wm8739_probe ( struct i2c_client * client , const struct i2c_device_id * id ) { struct wm8739_state * state ; struct v4l2_subdev * sd ; v4l_info ( client , "chip found @ 0x%x (%s)\n" , client -> addr << 1 , client -> adapter -> name ) ; state = devm_kzalloc ( & client -> dev , sizeof ( * state ) , GFP_KERNEL ) ; if ( state == NULL ) { return - ENOMEM ; } sd = & state -> sd ; v4l2_i2c_subdev_init ( sd , client , & wm8739_ops ) ; v4l2_ctrl_handler_init ( & state -> hdl , 2 ) ; state -> volume = v4l2_ctrl_new_std ( & state -> hdl , & wm8739_ctrl_ops , V4L2_CID_AUDIO_VOLUME , 0 , 65535 , 65535 / 100 , 50736 ) ; state -> mute = v4l2_ctrl_new_std ( & state -> hdl , & wm8739_ctrl_ops , V4L2_CID_AUDIO_MUTE , 0 , 1 , 1 , 0 ) ; state -> balance = v4l2_ctrl_new_std ( & state -> hdl , & wm8739_ctrl_ops , V4L2_CID_AUDIO_BALANCE , 0 , 65535 , 65535 / 100 , 32768 ) ; sd -> ctrl_handler = & state -> hdl ; if ( state -> hdl . error ) { int err = state -> hdl . error ; v4l2_ctrl_handler_free ( & state -> hdl ) ; return err ; } v4l2_ctrl_cluster ( 3 , & state -> volume ) ; state -> clock_freq = 48000 ; wm8739_write ( sd , R15 , 0x00 ) ; wm8739_write ( sd , R5 , 0x000 ) ; wm8739_write ( sd , R6 , 0x000 ) ; wm8739_write ( sd , R7 , 0x049 ) ; wm8739_write ( sd , R8 , 0x000 ) ; wm8739_write ( sd , R9 , 0x001 ) ; v4l2_ctrl_handler_setup ( & state -> hdl ) ; return 0 ; } 