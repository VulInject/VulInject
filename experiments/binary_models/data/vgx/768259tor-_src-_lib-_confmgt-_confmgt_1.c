int config_assign ( const config_mgr_t * mgr , void * options , config_line_t * list , unsigned config_assign_flags , char * * msg ) { config_line_t * p ; bitarray_t * options_seen ; const int n_options = config_count_options ( mgr ) ; const unsigned clear_first = config_assign_flags & CAL_CLEAR_FIRST ; const unsigned use_defaults = config_assign_flags & CAL_USE_DEFAULTS ; CONFIG_CHECK ( mgr , options ) ; for ( p = list ; p ; p = p -> next ) { const char * full = config_expand_abbrev ( mgr , p -> key , 0 , 1 ) ; if ( strcmp ( full , p -> key ) ) { tor_free ( p -> key ) ; p -> key = tor_strdup ( full ) ; } } if ( clear_first ) { for ( p = list ; p ; p = p -> next ) { config_reset_line ( mgr , options , p -> key , use_defaults ) ; } } options_seen = bitarray_init_zero ( n_options ) ; while ( list ) { int r ; if ( ( r = config_assign_line ( mgr , options , list , config_assign_flags , options_seen , msg ) ) ) { return r ; } list = list -> next ; } bitarray_free ( options_seen ) ; config_mark_lists_fragile ( mgr , options ) ; return 0 ; } 