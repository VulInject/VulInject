int opts_save ( SCR * sp , FILE * fp ) { OPTLIST const * op ; int ch , cnt ; char * p ; for ( op = optlist ; op -> name != NULL ; ++ op ) { cnt = op - optlist ; switch ( op -> type ) { case OPT_0BOOL : case OPT_1BOOL : if ( O_ISSET ( sp , cnt ) ) { ( void ) fprintf ( fp , "set %s\n" , op -> name ) ; } else { ( void ) fprintf ( fp , "set no%s\n" , op -> name ) ; } break ; case OPT_NUM : ( void ) fprintf ( fp , "set %s=%-3ld\n" , op -> name , O_VAL ( sp , cnt ) ) ; break ; case OPT_STR : if ( O_STR ( sp , cnt ) == NULL ) { break ; } ( void ) fprintf ( fp , "set " ) ; for ( p = op -> name ; ( ch = * p ) != '\0' ; ++ p ) { if ( isblank ( ch ) || ch == '\\' ) { ( void ) putc ( '\\' , fp ) ; } ( void ) putc ( ch , fp ) ; } ( void ) putc ( '=' , fp ) ; for ( p = O_STR ( sp , cnt ) ; ( ch = * p ) != '\0' ; ++ p ) { if ( isblank ( ch ) || ch == '\\' ) { ( void ) putc ( '\\' , fp ) ; } ( void ) putc ( ch , fp ) ; } ( void ) putc ( '\n' , fp ) ; break ; } if ( ferror ( fp ) ) { msgq ( sp , M_SYSERR , NULL ) ; return ( 1 ) ; } } return ( 0 ) ; } 