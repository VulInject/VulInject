static SplineFont * FindFamilyStyleKerns ( SplineFont * into , EncMap * map , FOND * fondlist , char * filename ) { char * name ; int style ; FOND * fond ; int i , j ; int ch1 , ch2 , offset ; KernPair * kp ; SplineChar * sc1 , * sc2 ; fond = PickFOND ( fondlist , filename , & name , & style ) ; if ( fond == NULL || into == NULL ) { return ( NULL ) ; } for ( i = 0 ; i < fond -> stylekerncnt ; ++ i ) { if ( fond -> stylekerns [ i ] . style == style ) { break ; } } if ( i == fond -> stylekerncnt ) { LogError ( _ ( "No kerning table for %s\n" ) , name ) ; return ( NULL ) ; } for ( j = 0 ; j < fond -> stylekerns [ i ] . kernpairs ; ++ j ) { ch1 = fond -> stylekerns [ i ] . kerns [ j ] . ch1 ; ch2 = fond -> stylekerns [ i ] . kerns [ j ] . ch2 ; offset = ( fond -> stylekerns [ i ] . kerns [ j ] . offset * ( into -> ascent + into -> descent ) + ( 1 << 11 ) ) >> 12 ; sc1 = SFMakeChar ( into , map , ch1 ) ; sc2 = SFMakeChar ( into , map , ch2 ) ; for ( kp = sc1 -> kerns ; kp != NULL ; kp = kp -> next ) { if ( kp -> sc == sc2 ) { break ; } } if ( kp == NULL ) { uint32 script ; kp = chunkalloc ( sizeof ( KernPair ) ) ; kp -> sc = sc2 ; kp -> next = sc1 -> kerns ; sc1 -> kerns = kp ; script = SCScriptFromUnicode ( sc1 ) ; if ( script == DEFAULT_SCRIPT ) { script = SCScriptFromUnicode ( sc2 ) ; } kp -> subtable = SFSubTableFindOrMake ( sc1 -> parent , CHR ( 'k' , 'e' , 'r' , 'n' ) , script , gpos_pair ) ; } kp -> off = offset ; } return ( into ) ; } 