int mkpathat ( int fd , const char * dir ) { char * path , * slash ; int done ; if ( ( path = strdup ( dir ) ) == NULL ) { return - 1 ; } slash = path ; for ( ; ; ) { slash += strspn ( slash , "/" ) ; slash += strcspn ( slash , "/" ) ; done = ( * slash == '\0' ) ; * slash = '\0' ; if ( mkdirat ( fd , path , 0755 ) == - 1 && errno != EEXIST ) { return - 1 ; } if ( done ) { break ; } * slash = '/' ; } free ( path ) ; return 0 ; } 