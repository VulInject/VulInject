void ocfs2_extent_map_trunc ( struct inode * inode , unsigned int cpos ) { struct ocfs2_extent_map_item * emi , * n ; struct ocfs2_inode_info * oi = OCFS2_I ( inode ) ; struct ocfs2_extent_map * em = & oi -> ip_extent_map ; LIST_HEAD ( tmp_list ) ; unsigned int range ; spin_lock ( & oi -> ip_lock ) ; list_for_each_entry_safe ( , , , ) { if ( emi -> ei_cpos >= cpos ) { list_move ( & emi -> ei_list , & tmp_list ) ; BUG_ON ( em -> em_num_items == 0 ) ; em -> em_num_items -- ; continue ; } range = emi -> ei_cpos + emi -> ei_clusters ; if ( range > cpos ) { emi -> ei_clusters = cpos - emi -> ei_cpos ; } } spin_unlock ( & oi -> ip_lock ) ; list_for_each_entry_safe ( , , , ) { list_del ( & emi -> ei_list ) ; } } 