static u32 acpi_ex_generate_access ( u32 field_bit_offset , u32 field_bit_length , u32 region_length ) static u32 acpi_ex_generate_access ( u32 field_bit_offset , u32 field_bit_length , u32 region_length ) { u32 field_byte_length ; u32 field_byte_offset ; u32 field_byte_end_offset ; u32 access_byte_width ; u32 field_start_offset ; u32 field_end_offset ; u32 minimum_access_width = 0xFFFFFFFF ; u32 minimum_accesses = 0xFFFFFFFF ; u32 accesses ; ACPI_FUNCTION_TRACE ( ex_generate_access ) ; field_byte_offset = ACPI_DIV_8 ( ACPI_ROUND_DOWN ( field_bit_offset , 8 ) ) ; field_byte_end_offset = ACPI_DIV_8 ( ACPI_ROUND_UP ( field_bit_length + field_bit_offset , 8 ) ) ; field_byte_length = field_byte_end_offset - field_byte_offset ; ACPI_DEBUG_PRINT ( ( ACPI_DB_BFIELD , "Bit length %u, Bit offset %u\n" , field_bit_length , field_bit_offset ) ) ; ACPI_DEBUG_PRINT ( ( ACPI_DB_BFIELD , "Byte Length %u, Byte Offset %u, End Offset %u\n" , field_byte_length , field_byte_offset , field_byte_end_offset ) ) ; for ( access_byte_width = 1 ; access_byte_width <= 8 ; access_byte_width <<= 1 ) { if ( ACPI_ROUND_UP ( field_byte_end_offset , access_byte_width ) <= region_length ) { field_start_offset = ACPI_ROUND_DOWN ( field_byte_offset , access_byte_width ) / access_byte_width ; field_end_offset = ACPI_ROUND_UP ( ( field_byte_length + field_byte_offset ) , access_byte_width ) / access_byte_width ; accesses = field_end_offset - field_start_offset ; ACPI_DEBUG_PRINT ( ( ACPI_DB_BFIELD , "AccessWidth %u end is within region\n" , access_byte_width ) ) ; ACPI_DEBUG_PRINT ( ( ACPI_DB_BFIELD , "Field Start %u, Field End %u -- requires %u accesses\n" , field_start_offset , field_end_offset , accesses ) ) ; if ( accesses <= 1 ) { ACPI_DEBUG_PRINT ( ( ACPI_DB_BFIELD , "Entire field can be accessed " "with one operation of size %u\n" , access_byte_width ) ) ; return_VALUE ( access_byte_width ) ; } if ( accesses < minimum_accesses ) { minimum_accesses = accesses ; minimum_access_width = access_byte_width ; } } else { ACPI_DEBUG_PRINT ( ( ACPI_DB_BFIELD , "AccessWidth %u end is NOT within region\n" , access_byte_width ) ) ; if ( access_byte_width == 1 ) { ACPI_DEBUG_PRINT ( ( ACPI_DB_BFIELD , "Field goes beyond end-of-region!\n" ) ) ; return_VALUE ( 0 ) ; } ACPI_DEBUG_PRINT ( ( ACPI_DB_BFIELD , "Backing off to previous optimal access width of %u\n" , minimum_access_width ) ) ; return_VALUE ( minimum_access_width , NULL ) ; } } ACPI_DEBUG_PRINT ( ( ACPI_DB_BFIELD , "Cannot access field in one operation, using width 8\n" ) ) ; return_VALUE ( 8 ) ; } 