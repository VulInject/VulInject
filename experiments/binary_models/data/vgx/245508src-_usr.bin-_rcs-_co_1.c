static int checkout_file_has_diffs ( RCSFILE * rfp , RCSNUM * frev , const char * dst ) { char * tempfile ; BUF * bp ; int ret ; tempfile = NULL ; if ( ( bp = rcs_getrev ( rfp , frev ) ) == NULL ) { warnx ( "failed to load revision" ) ; return ( D_ERROR ) ; } if ( ( bp = rcs_kwexp_buf ( bp , rfp , frev ) ) == NULL ) { warnx ( "failed to expand tags" ) ; return ( D_ERROR ) ; } ( void ) xasprintf ( & tempfile , "%s/diff.XXXXXXXXXX" , rcs_tmpdir ) ; buf_write_stmp ( bp , tempfile ) ; buf_empty ( bp ) ; diff_format = D_RCSDIFF ; ret = diffreg ( dst , tempfile , bp , D_FORCEASCII ) ; buf_free ( bp ) ; unlink ( tempfile ) ; return ( ret ) ; } 