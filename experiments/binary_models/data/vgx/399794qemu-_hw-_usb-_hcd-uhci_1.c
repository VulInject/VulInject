static void uhci_reset ( DeviceState * dev ) { PCIDevice * d = PCI_DEVICE ( dev ) ; UHCIState * s = UHCI ( d ) ; uint8_t * pci_conf ; int i ; UHCIPort * port ; trace_usb_uhci_reset ( ) ; pci_conf = s -> dev . config ; pci_conf [ 0x6a ] = 0x01 ; pci_conf [ 0x6b ] = 0x00 ; s -> cmd = 0 ; s -> status2 = 0 ; s -> intr = 0 ; s -> fl_base_addr = 0 ; s -> sof_timing = 64 ; for ( i = 0 ; i < NB_PORTS ; i ++ ) { port = & s -> ports [ i ] ; port -> ctrl = 0x0080 ; if ( port -> port . dev && port -> port . dev -> attached ) { usb_port_reset ( & port -> port ) ; } } uhci_async_cancel_all ( s ) ; qemu_bh_cancel ( s -> bh ) ; uhci_update_irq ( s ) ; } 