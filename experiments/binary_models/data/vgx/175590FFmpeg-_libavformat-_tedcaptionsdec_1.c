static int parse_string ( AVIOContext * pb , int * cur_byte , AVBPrint * bp , int full ) { int ret ; ret = expect_byte ( pb , cur_byte , '"' ) ; if ( ret < 0 ) { return ret ; } while ( * cur_byte > 0 && * cur_byte != '"' ) { if ( * cur_byte == '\\' ) { next_byte ( pb , cur_byte ) ; if ( ( * cur_byte | 32 ) == 'u' ) { unsigned chr = 0 , i ; for ( i = 0 ; i < 4 ; i ++ ) { next_byte ( pb , cur_byte ) ; if ( ! HEX_DIGIT_TEST ( * cur_byte ) ) { return ERR_CODE ( * cur_byte ) ; } chr = chr * 16 + HEX_DIGIT_VAL ( * cur_byte ) ; } av_bprint_utf8 ( bp , chr ) ; } else { av_bprint_chars ( bp , * cur_byte , 1 ) ; } } else { av_bprint_chars ( bp , * cur_byte , 1 ) ; } next_byte ( pb , cur_byte ) ; } ret = expect_byte ( pb , cur_byte , '"' ) ; if ( ret < 0 ) { return ret ; } if ( full && ! av_bprint_is_complete ( bp ) ) { return AVERROR ( ENOMEM ) ; } return 0 ; } 