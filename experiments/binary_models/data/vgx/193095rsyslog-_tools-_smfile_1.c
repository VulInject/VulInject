MODULE_TYPE_NOKEEP STRGEN_NAME ( "RSYSLOG_FileFormat" ) DEF_SMOD_STATIC_DATA BEGINstrgen int iBuf ; uchar * pTimeStamp ; size_t lenTimeStamp ; uchar * pHOSTNAME ; size_t lenHOSTNAME ; uchar * pTAG ; int lenTAG ; uchar * pMSG ; size_t lenMSG ; int lenTotal ; CODESTARTstrgen pTimeStamp = ( uchar * ) getTimeReported ( pMsg , tplFmtRFC3339Date ) ; lenTimeStamp = ustrlen ( pTimeStamp ) ; pHOSTNAME = ( uchar * ) getHOSTNAME ( pMsg ) ; lenHOSTNAME = getHOSTNAMELen ( pMsg ) ; getTAG ( pMsg , & pTAG , & lenTAG , LOCK_MUTEX ) ; pMSG = getMSG ( pMsg ) ; lenMSG = getMSGLen ( pMsg ) ; lenTotal = lenTimeStamp + 1 + lenHOSTNAME + 1 + lenTAG + lenMSG + 2 ; if ( pMSG [ 0 ] != ' ' ) { ++ lenTotal ; } if ( lenTotal >= iparam -> lenBuf ) { CHKiRet ( ExtendBuf ( iparam , lenTotal ) ) ; } memcpy ( iparam -> param , pTimeStamp , lenTimeStamp ) ; iBuf = lenTimeStamp ; iparam -> param [ iBuf ++ ] = ' ' ; memcpy ( iparam -> param + iBuf , pHOSTNAME , lenHOSTNAME ) ; iBuf += lenHOSTNAME ; iparam -> param [ iBuf ++ ] = ' ' ; memcpy ( iparam -> param + iBuf , pTAG , lenTAG ) ; iBuf += lenTAG ; if ( pMSG [ 0 ] != ' ' ) { iparam -> param [ iBuf ++ ] = ' ' ; } memcpy ( iparam -> param + iBuf , pMSG , lenMSG ) ; iBuf += lenMSG ; iparam -> param [ iBuf ++ ] = '\n' ; iparam -> param [ iBuf ] = '\0' ; iparam -> lenStr = lenTotal - 1 ; finalize_it ENDstrgen BEGINmodExit CODESTARTmodExit ENDmodExit BEGINqueryEtryPt CODESTARTqueryEtryPt CODEqueryEtryPt_STD_SMOD_QUERIES ENDqueryEtryPt BEGINmodInit ( smfile ) CODESTARTmodInit * ipIFVersProvided = CURR_MOD_IF_VERSION ; CODEmodInit_QueryRegCFSLineHdlr dbgprintf ( "rsyslog standard file format strgen init called, compiled with version %s\n" , VERSION ) ; ENDmodInit 