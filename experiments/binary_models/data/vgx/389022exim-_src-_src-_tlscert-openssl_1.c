uschar * tls_cert_signature ( void * cert , uschar * mod ) { uschar * cp = NULL ; BIO * bp = BIO_new ( BIO_s_mem ( ) ) ; if ( X509_print_ex ( bp , ( X509 * ) cert , 0 , X509_FLAG_NO_HEADER | X509_FLAG_NO_VERSION | X509_FLAG_NO_SERIAL | X509_FLAG_NO_SIGNAME | X509_FLAG_NO_ISSUER | X509_FLAG_NO_VALIDITY | X509_FLAG_NO_SUBJECT | X509_FLAG_NO_PUBKEY | X509_FLAG_NO_EXTENSIONS | X509_FLAG_NO_AUX ) == 1 ) { long len = BIO_get_mem_data ( bp , & cp ) ; gstring * g = NULL ; while ( * cp && * cp != '\n' ) { cp ++ ; len -- ; } if ( * cp ) { cp ++ ; len -- ; } if ( Ustrncmp ( cp , "    Signature Value:\n" , 21 ) == 0 ) { cp += 21 ; len -= 21 ; } for ( ; len -- && * cp ; cp ++ ) { if ( Ustrchr ( "0123456789abcdef:" , * cp ) ) { g = string_catn ( g , cp , 1 ) ; } } cp = string_from_gstring ( g ) ; } BIO_free ( bp ) ; return cp ; } 