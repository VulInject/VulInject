static int i2s_pll_clk_probe ( struct platform_device * pdev ) { struct device * dev = & pdev -> dev ; struct device_node * node = dev -> of_node ; const char * clk_name ; const char * parent_name ; struct clk * clk ; struct i2s_pll_clk * pll_clk ; struct clk_init_data init ; pll_clk = devm_kzalloc ( dev , sizeof ( * pll_clk ) , GFP_KERNEL ) ; if ( ! pll_clk ) { return - ENOMEM ; } pll_clk -> base = devm_platform_ioremap_resource ( pdev , 0 ) ; if ( IS_ERR ( pll_clk -> base ) ) { return PTR_ERR ( pll_clk -> base ) ; } clk_name = node -> name ; init . name = clk_name ; init . ops = & i2s_pll_ops ; parent_name = of_clk_get_parent_name ( node , 0 ) ; init . parent_names = & parent_name ; init . num_parents = 1 ; pll_clk -> hw . init = & init ; pll_clk -> dev = dev ; clk = devm_clk_register ( dev , & pll_clk -> hw ) ; if ( IS_ERR ( clk ) ) { dev_err ( dev , "failed to register %s clock (%ld)\n" , clk_name , PTR_ERR ( clk ) ) ; return PTR_ERR ( clk ) ; } return of_clk_add_provider ( node , of_clk_src_simple_get , clk ) ; } 