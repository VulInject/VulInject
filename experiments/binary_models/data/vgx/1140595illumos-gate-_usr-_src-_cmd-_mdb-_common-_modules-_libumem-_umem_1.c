static int umem_init_walkers ( uintptr_t addr , const umem_cache_t * c , int * sizes ) { mdb_walker_t w ; char descr [ 64 ] ; char name [ 64 ] ; int i ; ( void ) mdb_snprintf ( descr , sizeof ( descr ) , "walk the %s cache" , c -> cache_name ) ; w . walk_name = c -> cache_name ; w . walk_descr = descr ; w . walk_init = umem_walk_init ; w . walk_step = umem_walk_step ; w . walk_fini = umem_walk_fini ; w . walk_init_arg = ( void * ) addr ; if ( mdb_add_walker ( & w ) == - 1 ) { mdb_warn ( "failed to add %s walker" , c -> cache_name ) ; } for ( i = 0 ; sizes [ i ] != 0 ; i ++ ) { if ( sizes [ i ] == c -> cache_bufsize ) { break ; } } if ( sizes [ i ] == 0 ) { mdb_warn ( "cache %s is cached per-thread, but could not find " "size in umem_alloc_sizes\n" , c -> cache_name ) ; return ( WALK_NEXT ) ; } if ( i >= NTMEMBASE ) { mdb_warn ( "index for %s (%d) exceeds root slots (%d)\n" , c -> cache_name , i , NTMEMBASE ) ; return ( WALK_NEXT ) ; } ( void ) mdb_snprintf ( name , sizeof ( name ) , "umem_ptc_%d" , c -> cache_bufsize ) ; ( void ) mdb_snprintf ( descr , sizeof ( descr ) , "walk the per-thread cache for %s" , c -> cache_name ) ; w . walk_name = name ; w . walk_descr = descr ; w . walk_init = umem_ptc_walk_init ; w . walk_step = umem_ptc_walk_step ; w . walk_fini = NULL ; w . walk_init_arg = ( void * ) offsetof ( ulwp_t , ul_tmem . tm_roots [ i ] ) ; if ( mdb_add_walker ( & w ) == - 1 ) { mdb_warn ( "failed to add %s walker" , w . walk_name ) ; } return ( WALK_NEXT ) ; } 