BOOL XTSAesTest ( PCRYPTO_INFO ci ) { unsigned __int8 p [ ENCRYPTION_DATA_UNIT_SIZE ] ; UINT64_STRUCT dataUnitNo ; int i ; for ( i = 0 ; i < XTS_TEST_COUNT ; i ++ ) { ci -> ea = EAGetByName ( L"AES" ) ; ci -> mode = XTS ; if ( EAInit ( ci -> ea , XTS_vectors [ i ] . key1 , ci -> ks ) != ERR_SUCCESS ) { return FALSE ; } if ( ! EAInitMode ( ci , XTS_vectors [ i ] . key2 ) ) { return FALSE ; } memcpy ( p , XTS_vectors [ i ] . plaintext , sizeof ( p ) ) ; dataUnitNo . Value = BE64 ( * ( ( unsigned __int64 * ) XTS_vectors [ i ] . dataUnitNo ) ) ; EncryptBufferXTS ( p , sizeof ( p ) , & dataUnitNo , XTS_vectors [ i ] . blockNo , ( unsigned char * ) ( ci -> ks ) , ( unsigned char * ) ci -> ks2 , AES ) ; if ( memcmp ( XTS_vectors [ i ] . ciphertext , p , sizeof ( p ) ) != 0 ) { return FALSE ; } } return TRUE ; } 