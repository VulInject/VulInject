void bootfs_construct ( bootfs_t * bfs ) { uint_t id = 0 ; char paddr [ 64 ] , psize [ 64 ] , pname [ 64 ] , * mname ; dev_info_t * root ; uint64_t size , addr ; int ret ; bootfs_mkroot ( bfs ) ; root = ddi_root_node ( ) ; for ( ; ; ) { if ( snprintf ( paddr , sizeof ( paddr ) , "module-addr-%d" , id ) > sizeof ( paddr ) ) { break ; } if ( snprintf ( psize , sizeof ( paddr ) , "module-size-%d" , id ) > sizeof ( paddr ) ) { break ; } if ( snprintf ( pname , sizeof ( paddr ) , "module-name-%d" , id ) > sizeof ( paddr ) ) { break ; } addr = ( uint64_t ) ddi_prop_get_int64 ( DDI_DEV_T_ANY , root , DDI_PROP_DONTPASS , paddr , 0 ) ; if ( addr == 0 || addr == DDI_PROP_NOT_FOUND ) { break ; } size = ( uint64_t ) ddi_prop_get_int64 ( DDI_DEV_T_ANY , root , DDI_PROP_DONTPASS , psize , 0 ) ; if ( size == 0 || size == DDI_PROP_NOT_FOUND ) { break ; } if ( ddi_prop_lookup_string ( DDI_DEV_T_ANY , root , DDI_PROP_DONTPASS , pname , & mname ) != DDI_PROP_SUCCESS ) { break ; } ret = bootfs_construct_entry ( bfs , addr , size , mname ) ; if ( ret == EINVAL ) { bfs -> bfs_stat . bfss_ndiscards . value . ui32 ++ ; } if ( ret == EEXIST ) { bfs -> bfs_stat . bfss_ndups . value . ui32 ++ ; } ddi_prop_free ( mname ) ; id ++ ; } } 