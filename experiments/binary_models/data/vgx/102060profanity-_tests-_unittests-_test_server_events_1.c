void console_shows_online_presence_when_set_online ( void * * state ) { prefs_set_string ( PREF_STATUSES_CONSOLE , "online" ) ; plugins_init ( ) ; roster_create ( ) ; roster_process_pending_presence ( ) ; char * barejid = "test1@server" ; roster_add ( barejid , "bob" , "both" , FALSE ) ; Resource * resource = resource_new ( "resource" , RESOURCE_ONLINE , NULL , 10 ) ; expect_memory ( ui_contact_online , barejid , barejid , sizeof ( barejid ) ) ; expect_memory ( ui_contact_online , resource , resource , sizeof ( resource ) ) ; expect_value ( ui_contact_online , last_activity , NULL ) ; sv_ev_contact_online ( barejid , resource , NULL , NULL ) ; roster_destroy ( ) ; plugins_shutdown ( ) ; } 