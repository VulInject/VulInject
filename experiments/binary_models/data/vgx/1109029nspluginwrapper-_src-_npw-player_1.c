np_stream_new ( , ) { CURL * handle = curl_easy_init ( ) ; if ( handle == NULL ) { return NULL ; } curl_easy_setopt ( handle , CURLOPT_URL , url ) ; curl_easy_setopt ( handle , CURLOPT_NOSIGNAL , 1 ) ; curl_easy_setopt ( handle , CURLOPT_WRITEFUNCTION , on_stream_read_nothing_cb ) ; curl_easy_setopt ( handle , CURLOPT_FILETIME , 1 ) ; curl_easy_setopt ( handle , CURLOPT_TIMECONDITION , CURL_TIMECOND_LASTMOD ) ; if ( uri_type_from_url ( url ) == URI_TYPE_HTTP ) { curl_easy_setopt ( handle , CURLOPT_FOLLOWLOCATION , 1 ) ; } curl_easy_perform ( handle ) ; int size ; if ( curl_easy_getinfo ( handle , CURLINFO_CONTENT_LENGTH_DOWNLOAD , & size ) != CURLE_OK ) { size = 0 ; } long lastmod ; if ( curl_easy_getinfo ( handle , CURLINFO_FILETIME , & lastmod ) != CURLE_OK || lastmod == - 1 ) { lastmod = 0 ; } curl_easy_cleanup ( handle ) ; NPStream * np_stream = g_new0 ( NPStream , 1 ) ; if ( np_stream == NULL ) { return NULL ; } np_stream -> url = g_strdup ( url ) ; np_stream -> end = size ; np_stream -> lastmodified = lastmod ; np_stream -> notifyData = notify_data ; return np_stream ; } 