static int addr4_resolve ( struct sockaddr * src_sock , const struct sockaddr * dst_sock , struct rdma_dev_addr * addr , struct rtable * * prt ) { struct sockaddr_in * src_in = ( sockaddr_in * ) src_sock ; const struct sockaddr_in * dst_in = ( const sockaddr_in * ) dst_sock ; __be32 src_ip = src_in -> sin_addr . s_addr ; __be32 dst_ip = dst_in -> sin_addr . s_addr ; struct rtable * rt ; struct flowi4 fl4 ; int ret ; fl4 . daddr = dst_ip ; fl4 . saddr = src_ip ; fl4 . flowi4_oif = addr -> bound_dev_if ; rt = ip_route_output_key ( addr -> net , & fl4 ) ; ret = PTR_ERR_OR_ZERO ( rt ) ; if ( ret ) { return ret ; } src_in -> sin_addr . s_addr = fl4 . saddr ; addr -> hoplimit = ip4_dst_hoplimit ( & rt -> dst ) ; * prt = rt ; return 0 ; } 