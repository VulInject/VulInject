as_reserve ( , ) { if ( state -> s + n > state -> theend ) { int off = state -> s - state -> str ; unsigned char * tmp ; if ( state -> max_sz && state -> sz >= state -> max_sz ) { return 1 ; } state -> sz = max ( state -> sz * 2 , state -> sz + n ) ; if ( state -> max_sz ) { state -> sz = min ( state -> sz , state -> max_sz ) ; } tmp = realloc ( state -> str , state -> sz ) ; state -> str = tmp ; state -> s = state -> str + off ; state -> theend = state -> str + state -> sz - 1 ; } return 0 ; } 