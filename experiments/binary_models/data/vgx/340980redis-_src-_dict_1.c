dictEntry * dictGetRandomKey ( dict * d ) { dictEntry * he , * orighe ; unsigned long h ; int listlen , listele ; if ( dictSize ( d ) == 0 ) { return NULL ; } if ( dictIsRehashing ( d ) ) { _dictRehashStep ( d ) ; } if ( dictIsRehashing ( d ) ) { cfs_time_t s0 = DICTHT_SIZE ( d -> ht_size_exp [ 0 ] ) ; { h = d -> rehashidx + ( randomULong ( ) % ( dictSlots ( d ) - d -> rehashidx ) ) ; he = ( h >= s0 ) ?d -> ht_table [ 1 ] [ h - s0 ] : d -> ht_table [ 0 ] [ h ] ; } he == NULL ; } else { unsigned long m = DICTHT_SIZE_MASK ( d -> ht_size_exp [ 0 ] ) ; { h = randomULong ( ) & m ; he = d -> ht_table [ 0 ] [ h ] ; } he == NULL ; } listlen = 0 ; orighe = he ; while ( he ) { he = dictGetNext ( he ) ; listlen ++ ; } listele = random ( ) % listlen ; he = orighe ; while ( listele -- ) { he = dictGetNext ( he ) ; } return he ; } 