zr36050_control ( , , , ) { struct zr36050 * ptr = ( zr36050 * ) codec -> data ; int * ival = ( int * ) data ; dprintk ( 2 , "%s: control %d call with %d byte\n" , ptr -> name , type , size ) ; switch ( type ) { case CODEC_G_STATUS : zr36050_read_status1 ( ptr ) ; * ival = ptr -> status1 ; break ; case CODEC_G_CODEC_MODE : if ( size != sizeof ( int ) ) { return - EFAULT ; } * ival = CODEC_MODE_BJPG ; break ; case CODEC_S_CODEC_MODE : if ( size != sizeof ( int ) ) { return - EFAULT ; } if ( * ival != CODEC_MODE_BJPG ) { return - EINVAL ; } return 0 ; case CODEC_G_VFE : case CODEC_S_VFE : return 0 ; case CODEC_S_MMAP : return - ENXIO ; case CODEC_G_JPEG_TDS_BYTE : if ( size != sizeof ( int ) ) { return - EFAULT ; } * ival = ptr -> total_code_vol ; break ; case CODEC_S_JPEG_TDS_BYTE : if ( size != sizeof ( int ) ) { return - EFAULT ; } ptr -> total_code_vol = * ival ; ptr -> real_code_vol = ( ptr -> total_code_vol * 6 ) >> 3 ; break ; case CODEC_G_JPEG_SCALE : if ( size != sizeof ( int ) ) { return - EFAULT ; } * ival = zr36050_read_scalefactor ( ptr ) ; break ; case CODEC_S_JPEG_SCALE : if ( size != sizeof ( int ) ) { return - EFAULT ; } ptr -> scalefact = * ival ; break ; case CODEC_G_JPEG_APP_DATA : { struct jpeg_app_marker * app = data ; if ( size != sizeof ( jpeg_app_marker ) ) { return - EFAULT ; } * app = ptr -> app ; break ; } case CODEC_S_JPEG_APP_DATA : { struct jpeg_app_marker * app = data ; if ( size != sizeof ( jpeg_app_marker ) ) { return - EFAULT ; } ptr -> app = * app ; break ; } case CODEC_G_JPEG_COM_DATA : { struct jpeg_com_marker * com = data ; if ( size != sizeof ( jpeg_com_marker ) ) { return - EFAULT ; } * com = ptr -> com ; break ; } case CODEC_S_JPEG_COM_DATA : { struct jpeg_com_marker * com = data ; if ( size != sizeof ( jpeg_com_marker ) ) { return - EFAULT ; } ptr -> com = * com ; break ; } default : return - EINVAL ; } return size ; } 