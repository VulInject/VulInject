static void conn_writecb ( struct bufferevent * , void * ) static void conn_eventcb ( struct bufferevent * , short , void * ) static void signal_cb ( evutil_socket_t , short , void * ) int main ( int argc , char * * argv ) { struct event_base * base ; struct evconnlistener * listener ; struct event * signal_event ; struct sockaddr_in sin ; WSADATA wsa_data ; WSAStartup ( 0x0201 , & wsa_data ) ; base = event_base_new ( ) ; if ( ! base ) { fprintf ( stderr , "Could not initialize libevent!\n" ) ; return 1 ; } sin . sin_family = AF_INET ; sin . sin_port = htons ( PORT ) ; listener = evconnlistener_new_bind ( base , listener_cb , ( void * ) base , LEV_OPT_REUSEABLE | LEV_OPT_CLOSE_ON_FREE , - 1 , ( sockaddr * ) & sin , sizeof ( sin ) ) ; if ( ! listener ) { fprintf ( stderr , "Could not create a listener!\n" ) ; return 1 ; } signal_event = evsignal_new ( base , SIGINT , signal_cb , ( void * ) base ) ; if ( ! signal_event || event_add ( signal_event , NULL ) < 0 ) { fprintf ( stderr , "Could not create/add a signal event!\n" ) ; return 1 ; } event_base_dispatch ( base ) ; evconnlistener_free ( listener ) ; event_free ( signal_event ) ; event_base_free ( base ) ; printf ( "done\n" ) ; return 0 ; } 