static int handle_log_entry ( ses_log_monitor_t * slmp , nvpair_t * entry , expander_t * expander , char * format_time , FILE * fp ) { nvlist_t * entry_data ; char * log_entry ; char * severity ; int severityValue = 0 ; char * code ; char * class_sev ; uint64_t ena ; int rval = 0 ; if ( ( rval = nvpair_value_nvlist ( entry , & entry_data ) ) != 0 ) { fmd_hdl_debug ( slmp -> slt_hdl , "Unable to retrieve entry" ) ; return ( rval ) ; } if ( ( rval = nvlist_lookup_string ( entry_data , ENTRY_SEVERITY , & severity ) ) == 0 ) { severityValue = atoi ( severity ) ; if ( severityValue >= slmp -> slt_severity ) { if ( ( rval = nvlist_lookup_string ( entry_data , ENTRY_CODE , & code ) ) != 0 ) { fmd_hdl_debug ( slmp -> slt_hdl , "Error retrieving code: %d" , rval ) ; return ( rval ) ; } ( void ) check_code ( slmp , expander -> fmri , expander -> slt_pid , atoi ( code ) ) ; class_sev = error_type ( severityValue ) ; if ( class_sev == NULL ) { fmd_hdl_debug ( slmp -> slt_hdl , "log severity %d mapped to NULL" , severity ) ; return ( INVALID_SEVERITY ) ; } ena = fmd_event_ena_create ( slmp -> slt_hdl ) ; slt_post_ereport ( slmp -> slt_hdl , slmp -> slt_xprt , class_sev , ena , expander -> fmri , entry_data ) ; } } else { fmd_hdl_debug ( slmp -> slt_hdl , "Unable to pull severity from the entry." ) ; return ( rval ) ; } if ( fp ) { if ( ( rval = nvlist_lookup_string ( entry_data , ENTRY_LOG , & log_entry ) ) == 0 ) { ( void ) fprintf ( fp , "%s %s\n" , format_time , log_entry ) ; } else { fmd_hdl_debug ( slmp -> slt_hdl , "Unable to pull log from the entry." ) ; } } return ( rval ) ; } 