static int stk8ba50_write_raw ( struct iio_dev * indio_dev , struct iio_chan_spec const * chan , int val , int val2 , long mask ) { int ret ; int i ; int index = - 1 ; struct stk8ba50_data * data = iio_priv ( indio_dev ) ; switch ( mask ) { case IIO_CHAN_INFO_SCALE : if ( val != 0 ) { return - EINVAL ; } for ( i = 0 ; i < ARRAY_SIZE ( stk8ba50_scale_table ) ; i ++ ) { if ( val2 == stk8ba50_scale_table [ i ] . scale_val ) { index = i ; break ; } } ret = i2c_smbus_write_byte_data ( data -> client , STK8BA50_REG_RANGE , stk8ba50_scale_table [ index ] . reg_val ) ; if ( ret < 0 ) { dev_err ( & data -> client -> dev , "failed to set measurement range\n" ) ; } else { data -> range = index ; } return ret ; case IIO_CHAN_INFO_SAMP_FREQ : for ( i = 0 ; i < ARRAY_SIZE ( stk8ba50_samp_freq_table ) ; i ++ ) { if ( val == stk8ba50_samp_freq_table [ i ] . samp_freq ) { index = i ; break ; } } if ( index < 0 ) { return - EINVAL ; } ret = i2c_smbus_write_byte_data ( data -> client , STK8BA50_REG_BWSEL , stk8ba50_samp_freq_table [ index ] . reg_val ) ; if ( ret < 0 ) { dev_err ( & data -> client -> dev , "failed to set sampling rate\n" ) ; } else { data -> sample_rate_idx = index ; } return ret ; } return - EINVAL ; } 