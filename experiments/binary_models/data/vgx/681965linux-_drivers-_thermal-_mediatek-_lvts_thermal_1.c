static int lvts_debugfs_init ( struct device * dev , struct lvts_domain * lvts_td ) { struct debugfs_regset32 * regset ; struct lvts_ctrl * lvts_ctrl ; struct dentry * dentry ; char name [ 64 ] ; int i ; lvts_td -> dom_dentry = debugfs_create_dir ( dev_name ( dev ) , NULL ) ; if ( ! lvts_td -> dom_dentry ) { return 0 ; } for ( i = 0 ; i < lvts_td -> num_lvts_ctrl ; i ++ ) { lvts_ctrl = & lvts_td -> lvts_ctrl [ i ] ; sprintf ( name , "controller%d" , i ) ; dentry = debugfs_create_dir ( name , lvts_td -> dom_dentry ) ; if ( ! dentry ) { continue ; } regset = devm_kzalloc ( dev , sizeof ( * regset ) , GFP_KERNEL ) ; regset -> base = lvts_ctrl -> base ; regset -> regs = lvts_regs ; regset -> nregs = ARRAY_SIZE ( lvts_regs ) ; debugfs_create_regset32 ( "registers" , 0400 , dentry , regset ) ; } return 0 ; } 