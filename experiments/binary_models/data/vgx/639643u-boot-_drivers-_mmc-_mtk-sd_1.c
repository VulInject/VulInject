static int msdc_start_data ( struct msdc_host * host , struct mmc_data * data ) { u32 size ; int ret ; if ( data -> flags == MMC_DATA_WRITE ) { host -> last_data_write = 1 ; } size = data -> blocks * data -> blocksize ; if ( data -> flags == MMC_DATA_WRITE ) { ret = msdc_pio_write ( host , ( const u8 * ) data -> src , size ) ; } else { ret = msdc_pio_read ( host , ( u8 * ) data -> dest , size ) ; } if ( ret ) { msdc_reset_hw ( host , NULL ) ; msdc_fifo_clr ( host ) ; } return ret ; } 