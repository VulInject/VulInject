static netdev_tx_t myri10ge_sw_tso ( struct sk_buff * skb , struct net_device * dev ) { struct sk_buff * segs , * curr ; struct myri10ge_priv * mgp = netdev_priv ( dev ) ; struct myri10ge_slice_state * ss ; netdev_tx_t status ; segs = skb_gso_segment ( skb , dev -> features & ~ NETIF_F_TSO6 ) ; if ( IS_ERR ( segs ) ) { drop } while ( segs ) { curr = segs ; segs = segs -> next ; curr -> next = NULL ; status = myri10ge_xmit ( curr , dev ) ; if ( status != 0 ) { dev_kfree_skb_any ( curr ) ; if ( segs != NULL ) { curr = segs ; segs = segs -> next ; curr -> next = NULL ; } drop } } dev_kfree_skb_any ( skb ) ; return NETDEV_TX_OK ; drop ss = & mgp -> ss [ skb_get_queue_mapping ( skb ) ] ; dev_kfree_skb_any ( skb ) ; ss -> stats . tx_dropped += 1 ; return NETDEV_TX_OK ; } 