int ceph_print_client_options ( struct seq_file * m , struct ceph_client * client , bool show_all ) { struct ceph_options * opt = client -> options ; size_t pos = m -> count ; struct rb_node * n ; if ( opt -> name ) { seq_puts ( m , "name=" ) ; seq_escape ( m , opt -> name , ", \t\n\\" ) ; seq_putc ( m , ',' ) ; } if ( opt -> key ) { seq_puts ( m , "secret=<hidden>," ) ; } if ( ! RB_EMPTY_ROOT ( & opt -> crush_locs ) ) { seq_puts ( m , "crush_location=" ) ; for ( n = rb_first ( & opt -> crush_locs ) ; ; ) { struct crush_loc_node * loc = rb_entry ( n , crush_loc_node , cl_node ) ; seq_printf ( m , "%s:%s" , loc -> cl_loc . cl_type_name , loc -> cl_loc . cl_name ) ; n = rb_next ( n ) ; seq_putc ( m , '|' ) ; } seq_putc ( m , ',' ) ; } if ( opt -> read_from_replica == CEPH_OSD_FLAG_BALANCE_READS ) { seq_puts ( m , "read_from_replica=balance," ) ; } if ( opt -> read_from_replica == CEPH_OSD_FLAG_LOCALIZE_READS ) { seq_puts ( m , "read_from_replica=localize," ) ; } if ( opt -> con_modes [ 0 ] != CEPH_CON_MODE_UNKNOWN ) { if ( opt -> con_modes [ 0 ] == CEPH_CON_MODE_CRC && opt -> con_modes [ 1 ] == CEPH_CON_MODE_UNKNOWN ) { seq_puts ( m , "ms_mode=crc," ) ; } if ( opt -> con_modes [ 0 ] == CEPH_CON_MODE_SECURE && opt -> con_modes [ 1 ] == CEPH_CON_MODE_UNKNOWN ) { seq_puts ( m , "ms_mode=secure," ) ; } if ( opt -> con_modes [ 0 ] == CEPH_CON_MODE_CRC && opt -> con_modes [ 1 ] == CEPH_CON_MODE_SECURE ) { seq_puts ( m , "ms_mode=prefer-crc," ) ; } if ( opt -> con_modes [ 0 ] == CEPH_CON_MODE_SECURE && opt -> con_modes [ 1 ] == CEPH_CON_MODE_CRC ) { seq_puts ( m , "ms_mode=prefer-secure," ) ; } } if ( opt -> flags & CEPH_OPT_FSID ) { seq_printf ( m , "fsid=%pU," , & opt -> fsid ) ; } if ( opt -> flags & CEPH_OPT_NOSHARE ) { seq_puts ( m , "noshare," ) ; } if ( opt -> flags & CEPH_OPT_NOCRC ) { seq_puts ( m , "nocrc," ) ; } if ( opt -> flags & CEPH_OPT_NOMSGSIGN ) { seq_puts ( m , "nocephx_sign_messages," ) ; } if ( ( opt -> flags & CEPH_OPT_TCP_NODELAY ) == 0 ) { seq_puts ( m , "notcp_nodelay," ) ; } if ( show_all && ( opt -> flags & CEPH_OPT_ABORT_ON_FULL ) ) { seq_puts ( m , "abort_on_full," ) ; } if ( opt -> flags & CEPH_OPT_RXBOUNCE ) { seq_puts ( m , "rxbounce," ) ; } if ( opt -> mount_timeout != CEPH_MOUNT_TIMEOUT_DEFAULT ) { seq_printf ( m , "mount_timeout=%d," , jiffies_to_msecs ( opt -> mount_timeout ) / 1000 ) ; } if ( opt -> osd_idle_ttl != CEPH_OSD_IDLE_TTL_DEFAULT ) { seq_printf ( m , "osd_idle_ttl=%d," , jiffies_to_msecs ( opt -> osd_idle_ttl ) / 1000 ) ; } if ( opt -> osd_keepalive_timeout != CEPH_OSD_KEEPALIVE_DEFAULT ) { seq_printf ( m , "osdkeepalivetimeout=%d," , jiffies_to_msecs ( opt -> osd_keepalive_timeout ) / 1000 ) ; } if ( opt -> osd_request_timeout != CEPH_OSD_REQUEST_TIMEOUT_DEFAULT ) { seq_printf ( m , "osd_request_timeout=%d," , jiffies_to_msecs ( opt -> osd_request_timeout ) / 1000 ) ; } if ( m -> count != pos ) { m -> count -- ; } return 0 ; } 