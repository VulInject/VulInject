static int bma180_read_raw ( struct iio_dev * indio_dev , struct iio_chan_spec const * chan , int * val , int * val2 , long mask ) { struct bma180_data * data = iio_priv ( indio_dev ) ; int ret ; switch ( mask ) { case IIO_CHAN_INFO_RAW : ret = iio_device_claim_direct_mode ( indio_dev ) ; mutex_lock ( & data -> mutex ) ; ret = bma180_get_data_reg ( data , chan -> scan_index ) ; mutex_unlock ( & data -> mutex ) ; iio_device_release_direct_mode ( indio_dev ) ; if ( ret < 0 ) { return ret ; } if ( chan -> scan_type . sign == 's' ) { * val = sign_extend32 ( ret >> chan -> scan_type . shift , chan -> scan_type . realbits - 1 ) ; } else { * val = ret ; } return IIO_VAL_INT ; case IIO_CHAN_INFO_LOW_PASS_FILTER_3DB_FREQUENCY : * val = data -> bw ; return IIO_VAL_INT ; case IIO_CHAN_INFO_SCALE : switch ( chan -> type ) { case IIO_ACCEL : * val = 0 ; * val2 = data -> scale ; return IIO_VAL_INT_PLUS_MICRO ; case IIO_TEMP : * val = 500 ; return IIO_VAL_INT ; default : return - EINVAL ; } case IIO_CHAN_INFO_OFFSET : * val = data -> part_info -> temp_offset ; return IIO_VAL_INT ; default : return - EINVAL ; } } 