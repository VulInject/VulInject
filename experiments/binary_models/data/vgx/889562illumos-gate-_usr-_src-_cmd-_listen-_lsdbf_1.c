unsigned scan_dbf ( path ) char * path ; { register unsigned int size = 0 ; register int n ; register FILE * dbfilep ; char buf [ DBFLINESZ ] ; register char * p = buf ; char * svc_code_p ; int flags ; char * cmd_line_p ; char * module_p ; char * id_p ; char * res1_p ; char * res2_p ; char * res3_p ; int sflags ; int prognum ; int vernum ; char * private_p ; extern int errno ; DEBUG ( ( 9 , "In scan_dbf.  Scanning data base file %s." , path ) ) ; if ( ! ( dbfilep = fopen ( path , "r" ) ) ) { DEBUG ( ( 9 , "errorno = %d" , errno ) ) ; logmessage ( dbfopenmsg ) ; return ( - 1 ) ; } { n = rd_dbf_line ( dbfilep , p , & svc_code_p , & flags , & id_p , & res1_p , & res2_p , & res3_p , & private_p , & prognum , & vernum , & module_p , & sflags , & cmd_line_p , SUPPRESS ) ; if ( n == - 1 ) { fclose ( dbfilep ) ; return ( - 1 ) ; } size += ( unsigned ) n ; if ( n ) { ++ Dbfentries ; } } n ; fclose ( dbfilep ) ; return ( size ) ; } int rd_dbf_line ( fp , bp , svc_code_p , flags_p , id_p , res1_p , res2_p , res3_p , private_p , prognum , vernum , module_p , sflags , cmd_line_p , mflag ) FILE * fp ; register char * bp ; char * * svc_code_p ; int * flags_p ; char * * id_p ; char * * res1_p ; char * * res2_p ; char * * res3_p ; char * * private_p ; int * prognum ; int * vernum ; char * * module_p ; int * sflags ; char * * cmd_line_p ; int mflag ; { register int length ; register char * p ; { ++ Dbflineno ; length = 0 ; if ( ! fgets ( bp , DBFLINESZ , fp ) ) { if ( ferror ( fp ) ) { sprintf ( bp , dbfrderror , Dbflineno ) ; logmessage ( bp ) ; return ( - 1 ) ; } sprintf ( bp , dbfunknown , Dbflineno ) ; logmessage ( bp ) ; return ( - 1 ) ; } if ( * ( bp + strlen ( bp ) - 1 ) != '\n' ) { sprintf ( bp , dbfbadlmsg , Dbflineno ) ; logmessage ( bp ) ; return ( - 1 ) ; } * ( bp + strlen ( bp ) - 1 ) = ( char ) 0 ; if ( strlen ( bp ) && ( p = strchr ( bp , DBFCOMMENT ) ) ) { * p = ( char ) 0 ; } if ( ! strlen ( bp ) ) { continue ; } p = bp + strlen ( bp ) - 1 ; while ( ( p != bp ) && ( isspace ( * p ) ) ) { * p = ( char ) 0 ; -- p ; } while ( * bp ) { if ( isspace ( * bp ) ) { ++ bp ; } else { break ; } } if ( strlen ( bp ) ) { if ( ! ( length = scan_line ( bp , svc_code_p , flags_p , id_p , res1_p , res2_p , res3_p , private_p , prognum , vernum , module_p , sflags , cmd_line_p , mflag ) ) ) { DEBUG ( ( 1 , "rd_dbf_line line %d, error while scanning entry" , Dbflineno ) ) ; sprintf ( bp , dbfbadlmsg , Dbflineno ) ; logmessage ( bp ) ; return ( - 1 ) ; } } } ! length ; DEBUG ( ( 5 , "rd_dbf_line: line: %d,cmd line len: %d" , Dbflineno , length + 1 ) ) ; return ( length + 1 ) ; } 