static irqreturn_t tcs3414_trigger_handler ( int irq , void * p ) { struct iio_poll_func * pf = p ; struct iio_dev * indio_dev = pf -> indio_dev ; struct tcs3414_data * data = iio_priv ( indio_dev ) ; int i , j = 0 ; for_each_set_bit ( , , ) { int ret = i2c_smbus_read_word_data ( data -> client , TCS3414_DATA_GREEN + 2 * i ) ; if ( ret < 0 ) { done } data -> scan . chans [ j ++ ] = ret ; } iio_push_to_buffers_with_timestamp ( indio_dev , & data -> scan , iio_get_time_ns ( indio_dev ) ) ; done iio_trigger_notify_done ( indio_dev -> trig , NULL ) ; return IRQ_HANDLED ; } 