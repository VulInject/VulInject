static int __init msi_wmi_init ( void ) { int err ; int i ; for ( i = 0 ; i < ARRAY_SIZE ( event_wmis ) ; i ++ ) { err = msi_wmi_input_setup ( ) ; if ( err ) { pr_err ( "Unable to setup input device\n" ) ; return err ; } err = wmi_install_notify_handler ( event_wmis [ i ] . guid , msi_wmi_notify , NULL ) ; if ( ACPI_FAILURE ( err ) ) { pr_err ( "Unable to setup WMI notify handler\n" ) ; err_free_input } pr_debug ( "Event handler installed\n" ) ; event_wmi = & event_wmis [ i ] ; break ; } if ( wmi_has_guid ( MSIWMI_BIOS_GUID ) && acpi_video_get_backlight_type ( ) == acpi_backlight_vendor ) { err = msi_wmi_backlight_setup ( ) ; if ( err ) { pr_err ( "Unable to setup backlight device\n" ) ; err_uninstall_handler } pr_debug ( "Backlight device created\n" ) ; } if ( ! event_wmi && ! backlight ) { pr_err ( "This machine doesn't have neither MSI-hotkeys nor backlight through WMI\n" ) ; return - ENODEV ; } return 0 ; err_uninstall_handler if ( event_wmi ) { wmi_remove_notify_handler ( event_wmi -> guid ) ; } err_free_input if ( event_wmi ) { input_unregister_device ( msi_wmi_input_dev ) ; } return err ; } 