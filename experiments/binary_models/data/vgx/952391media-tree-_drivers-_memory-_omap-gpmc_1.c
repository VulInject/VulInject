int gpmc_cs_program_settings ( int cs , struct gpmc_settings * p ) { int config1 ; if ( ( ! p -> device_width ) || ( p -> device_width > GPMC_DEVWIDTH_16BIT ) ) { pr_err ( "%s: invalid width %d!" , __func__ , p -> device_width ) ; return - EINVAL ; } if ( p -> device_nand && p -> mux_add_data ) { pr_err ( "%s: invalid configuration!\n" , __func__ ) ; return - EINVAL ; } if ( ( p -> mux_add_data > GPMC_MUX_AD ) || ( ( p -> mux_add_data == GPMC_MUX_AAD ) && ! ( gpmc_capability & GPMC_HAS_MUX_AAD ) ) ) { pr_err ( "%s: invalid multiplex configuration!\n" , __func__ ) ; return - EINVAL ; } if ( p -> burst_read || p -> burst_write ) { switch ( p -> burst_len ) { case GPMC_BURST_4 : case GPMC_BURST_8 : case GPMC_BURST_16 : break ; default : pr_err ( "%s: invalid page/burst-length (%d)\n" , __func__ , p -> burst_len ) ; return - EINVAL ; } } if ( p -> wait_pin > gpmc_nr_waitpins ) { pr_err ( "%s: invalid wait-pin (%d)\n" , __func__ , p -> wait_pin ) ; return - EINVAL ; } config1 = GPMC_CONFIG1_DEVICESIZE ( ( p -> device_width - 1 ) ) ; if ( p -> sync_read ) { config1 |= GPMC_CONFIG1_READTYPE_SYNC ; } if ( p -> sync_write ) { config1 |= GPMC_CONFIG1_WRITETYPE_SYNC ; } if ( p -> wait_on_read ) { config1 |= GPMC_CONFIG1_WAIT_READ_MON ; } if ( p -> wait_on_write ) { config1 |= GPMC_CONFIG1_WAIT_WRITE_MON ; } if ( p -> wait_on_read || p -> wait_on_write ) { config1 |= GPMC_CONFIG1_WAIT_PIN_SEL ( p -> wait_pin ) ; } if ( p -> device_nand ) { config1 |= GPMC_CONFIG1_DEVICETYPE ( GPMC_DEVICETYPE_NAND ) ; } if ( p -> mux_add_data ) { config1 |= GPMC_CONFIG1_MUXTYPE ( p -> mux_add_data ) ; } if ( p -> burst_read ) { config1 |= GPMC_CONFIG1_READMULTIPLE_SUPP ; } if ( p -> burst_write ) { config1 |= GPMC_CONFIG1_WRITEMULTIPLE_SUPP ; } if ( p -> burst_read || p -> burst_write ) { config1 |= GPMC_CONFIG1_PAGE_LEN ( p -> burst_len >> 3 ) ; config1 |= p -> burst_wrap ?GPMC_CONFIG1_WRAPBURST_SUPP : 0 ; } gpmc_cs_write_reg ( cs , GPMC_CS_CONFIG1 , config1 ) ; return 0 ; } 