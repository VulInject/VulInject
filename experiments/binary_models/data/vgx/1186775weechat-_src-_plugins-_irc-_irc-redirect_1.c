irc_redirect_stop ( , ) { struct t_hashtable * hashtable ; char signal_name [ 1024 ] , str_int [ 64 ] ; redirect -> current_count ++ ; if ( error || ( redirect -> current_count > redirect -> count ) ) { hashtable = weechat_hashtable_new ( 32 , WEECHAT_HASHTABLE_STRING , WEECHAT_HASHTABLE_STRING , NULL , NULL ) ; if ( hashtable ) { weechat_hashtable_set ( hashtable , "error" , ( error ) ?( char * ) error : "" ) ; weechat_hashtable_set ( hashtable , "output" , ( redirect -> output ) ?redirect -> output : "" ) ; snprintf ( str_int , sizeof ( str_int ) , "%d" , redirect -> output_size ) ; weechat_hashtable_set ( hashtable , "output_size" , str_int ) ; weechat_hashtable_set ( hashtable , "server" , redirect -> server -> name ) ; weechat_hashtable_set ( hashtable , "pattern" , redirect -> pattern ) ; weechat_hashtable_set ( hashtable , "signal" , redirect -> signal ) ; weechat_hashtable_set ( hashtable , "command" , redirect -> command ) ; } sprintf ( signal_name , "irc_redirection_%s_%s" , redirect -> signal , redirect -> pattern ) ; ( void ) weechat_hook_hsignal_send ( signal_name , hashtable ) ; if ( hashtable ) { weechat_hashtable_free ( hashtable ) ; } irc_redirect_free ( redirect ) ; } else { redirect -> cmd_start_received = 0 ; redirect -> cmd_stop_received = 0 ; } } 