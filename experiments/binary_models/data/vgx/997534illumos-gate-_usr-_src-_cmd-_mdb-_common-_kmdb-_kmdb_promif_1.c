ssize_t kmdb_prom_write ( const void * bufp , size_t len , struct termios * tio ) { caddr_t buf = ( caddr_t ) bufp ; size_t left = len ; char * nl = "\r\n" ; char * c ; kmdb_prom_check_interrupt ( ) ; while ( ( c = strnchr ( buf , '\n' , left ) ) != NULL ) { if ( c != buf ) { size_t sz = ( size_t ) ( c - buf ) ; ( void ) kmdb_prom_writer ( buf , sz ) ; left -= sz ; } buf = c + 1 ; left -- ; ( void ) kmdb_prom_writer ( nl , 2 ) ; } if ( * buf != '\0' ) { ( void ) kmdb_prom_writer ( buf , left ) ; } return ( len ) ; } 