static bool ath_paprd_send_frame ( struct ath_softc * sc , struct sk_buff * skb , int chain ) { struct ieee80211_hw * hw = sc -> hw ; struct ieee80211_tx_info * tx_info = IEEE80211_SKB_CB ( skb ) ; struct ath_hw * ah = sc -> sc_ah ; struct ath_common * common = ath9k_hw_common ( ah ) ; struct ath_tx_control txctl ; unsigned long time_left ; memset ( & txctl , 0 , sizeof ( txctl ) ) ; txctl . txq = sc -> tx . txq_map [ IEEE80211_AC_BE ] ; memset ( tx_info , 0 , sizeof ( * tx_info ) ) ; tx_info -> band = sc -> cur_chandef . chan -> band ; tx_info -> flags |= IEEE80211_TX_CTL_NO_ACK ; tx_info -> control . rates [ 0 ] . idx = 0 ; tx_info -> control . rates [ 0 ] . count = 1 ; tx_info -> control . rates [ 0 ] . flags = IEEE80211_TX_RC_MCS ; tx_info -> control . rates [ 1 ] . idx = - 1 ; init_completion ( & sc -> paprd_complete ) ; txctl . paprd = BIT ( chain ) ; if ( ath_tx_start ( hw , skb , & txctl ) != 0 ) { ath_dbg ( common , CALIBRATE , "PAPRD TX failed\n" ) ; return false ; } time_left = wait_for_completion_timeout ( & sc -> paprd_complete , msecs_to_jiffies ( ATH_PAPRD_TIMEOUT ) ) ; if ( ! time_left ) { ath_dbg ( common , CALIBRATE , "Timeout waiting for paprd training on TX chain %d\n" , chain ) ; } return ! ! time_left ; } 