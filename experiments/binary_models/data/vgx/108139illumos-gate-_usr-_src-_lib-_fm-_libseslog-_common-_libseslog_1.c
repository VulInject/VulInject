static int read_log ( int sg_fd , unsigned char * resp , int mx_resp_len ) { int res , ret ; unsigned char logsCmdBlk [ CDB_GROUP1 ] { SCMD_LOG_SENSE_G1 0 0 0 0 0 0 0 0 0 } ; ; unsigned char sense_b [ SENSE_BUFF_LEN ] ; struct uscsi_cmd uscsi ; if ( mx_resp_len > 0xffff ) { return ( - 1 ) ; } logsCmdBlk [ 2 ] = 0x47 ; logsCmdBlk [ 3 ] = 0 ; logsCmdBlk [ 5 ] = 0 ; logsCmdBlk [ 6 ] = 0 ; logsCmdBlk [ 7 ] = ( unsigned char ) ( ( mx_resp_len >> 8 ) & 0xff ) ; logsCmdBlk [ 8 ] = ( unsigned char ) ( mx_resp_len & 0xff ) ; construct_scsi_pt_obj ( & uscsi ) ; set_scsi_pt_cdb ( & uscsi , logsCmdBlk , sizeof ( logsCmdBlk ) ) ; set_scsi_pt_sense ( & uscsi , sense_b , sizeof ( sense_b ) ) ; set_scsi_pt_data_in ( & uscsi , resp , mx_resp_len ) ; res = do_scsi_pt ( & uscsi , sg_fd , DEF_PT_TIMEOUT ) ; if ( res ) { ret = res ; } else { ret = uscsi . uscsi_status ; } return ( ret ) ; } 