int main ( int argc , char * * argv ) { if ( argc != 2 ) { printf ( "usage: %s /usr/include/linux/capability.h\n" , argv [ 0 ] ) ; return 1 ; } FILE * fp = fopen ( argv [ 1 ] , "r" ) ; if ( ! fp ) { fprintf ( stderr , "Error: cannot open file\n" ) ; return 1 ; } char buf [ BUFMAX ] ; while ( fgets ( buf , BUFMAX , fp ) ) { char * start = buf ; while ( * start == ' ' || * start == '\t' ) { start ++ ; } char * end = strchr ( start , '\n' ) ; if ( end ) { * end = '\0' ; } if ( strncmp ( start , "#define CAP_" , 12 ) == 0 ) { if ( strstr ( start , "CAP_LAST_CAP" ) ) { break ; } char * ptr1 = start + 8 ; char * ptr2 = ptr1 ; while ( * ptr2 == ' ' || * ptr2 == '\t' ) { ptr2 ++ ; } while ( * ptr2 != ' ' && * ptr2 != '\t' ) { ptr2 ++ ; } * ptr2 = '\0' ; ptr2 = strdup ( ptr1 ) ; assert ( ptr2 ) ; ptr2 += 4 ; char * ptr3 = ptr2 ; while ( * ptr3 != '\0' ) { * ptr3 = tolower ( * ptr3 ) ; ptr3 ++ ; } printf ( "#ifdef %s\n" , ptr1 ) ; printf ( "\t{\"%s\", %s },\n" , ptr2 , ptr1 ) ; printf ( "#endif\n" ) ; } } fclose ( fp , NULL ) ; return 0 ; } 