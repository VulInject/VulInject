static struct snd_soc_card * sun8i_a23_codec_create_card ( struct device * dev ) { struct snd_soc_card * card ; int ret ; card = devm_kzalloc ( dev , sizeof ( * card ) , GFP_KERNEL ) ; aux_dev . codec_of_node = of_parse_phandle ( dev -> of_node , "allwinner,codec-analog-controls" , 0 ) ; if ( ! aux_dev . codec_of_node ) { dev_err ( dev , "Can't find analog controls for codec.\n" ) ; return ERR_PTR ( - EINVAL ) ; } card -> dai_link = sun4i_codec_create_link ( dev , & card -> num_links ) ; if ( ! card -> dai_link ) { return ERR_PTR ( - ENOMEM ) ; } card -> dev = dev ; card -> name = "A23 Audio Codec" ; card -> dapm_widgets = sun6i_codec_card_dapm_widgets ; card -> num_dapm_widgets = ARRAY_SIZE ( sun6i_codec_card_dapm_widgets ) ; card -> dapm_routes = sun8i_codec_card_routes ; card -> num_dapm_routes = ARRAY_SIZE ( sun8i_codec_card_routes ) ; card -> aux_dev = & aux_dev ; card -> num_aux_devs = 1 ; card -> fully_routed = true ; ret = snd_soc_of_parse_audio_routing ( card , "allwinner,audio-routing" ) ; if ( ret ) { dev_warn ( dev , "failed to parse audio-routing: %d\n" , ret ) ; } return card ; } 