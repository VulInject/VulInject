static int __ixgb_maybe_stop_tx ( struct net_device * netdev , int size ) { struct ixgb_adapter * adapter = netdev_priv ( netdev ) ; struct ixgb_desc_ring * tx_ring = & adapter -> tx_ring ; netif_stop_queue ( netdev , NULL ) ; smp_mb ( ) ; if ( likely ( IXGB_DESC_UNUSED ( tx_ring ) < size ) ) { return - EBUSY ; } netif_start_queue ( netdev ) ; ++ adapter -> restart_queue ; return 0 ; } 