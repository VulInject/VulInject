int usb_lowlevel_init ( int index , enum usb_init_type init , void * * controller ) { memset ( & gohci , 0 , sizeof ( ohci_t ) ) ; if ( ( __u32 ) & ghcca [ 0 ] & 0xff ) { err ( "HCCA not aligned!!" ) ; return - 1 ; } gohci . hcca = & ghcca [ 0 ] ; info ( "aligned ghcca %p" , gohci . hcca ) ; gohci . disabled = 1 ; gohci . sleeping = 0 ; gohci . irq = - 1 ; gohci . regs = ( ohci_regs * ) CFG_SYS_USB_OHCI_REGS_BASE ; gohci . flags = 0 ; gohci . slot_name = CONFIG_SYS_USB_OHCI_SLOT_NAME ; if ( hc_reset ( & gohci ) < 0 ) { hc_release_ohci ( & gohci ) ; err ( "can't reset usb-%s" , gohci . slot_name ) ; return - 1 ; } if ( hc_start ( & gohci ) < 0 ) { err ( "can't start usb-%s" , gohci . slot_name ) ; hc_release_ohci ( & gohci ) ; return - 1 ; } ohci_dump ( & gohci , 1 ) ; ohci_mdelay ( 1 ) ; ohci_inited = 1 ; return 0 ; } 