struct rtentry * in_pcbrtentry ( struct inpcb * inp ) { struct route * ro ; ro = & inp -> inp_route ; if ( ! rtisvalid ( ro -> ro_rt ) ) { rtfree ( ro -> ro_rt ) ; ro -> ro_rt = NULL ; } if ( ro -> ro_rt == NULL ) { memset ( ro , 0 , sizeof ( route ) ) ; switch ( sotopf ( inp -> inp_socket ) ) { case PF_INET6 : if ( IN6_IS_ADDR_UNSPECIFIED ( & inp -> inp_faddr6 ) ) { break ; } ro -> ro_dst . sa_family = AF_INET6 ; ro -> ro_dst . sa_len = sizeof ( sockaddr_in6 ) ; satosin6 ( & ro -> ro_dst ) -> sin6_addr = inp -> inp_faddr6 ; ro -> ro_tableid = inp -> inp_rtableid ; ro -> ro_rt = rtalloc_mpath ( & ro -> ro_dst , & inp -> inp_laddr6 . s6_addr32 [ 0 ] , ro -> ro_tableid ) ; break ; case PF_INET : if ( inp -> inp_faddr . s_addr == INADDR_ANY ) { break ; } ro -> ro_dst . sa_family = AF_INET ; ro -> ro_dst . sa_len = sizeof ( sockaddr_in ) ; satosin ( & ro -> ro_dst ) -> sin_addr = inp -> inp_faddr ; ro -> ro_tableid = inp -> inp_rtableid ; ro -> ro_rt = rtalloc_mpath ( & ro -> ro_dst , & inp -> inp_laddr . s_addr , ro -> ro_tableid ) ; break ; } } return ( ro -> ro_rt ) ; } 