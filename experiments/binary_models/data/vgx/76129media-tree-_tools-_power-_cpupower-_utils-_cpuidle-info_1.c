int cmd_idle_info ( int argc , char * * argv ) { extern char * optarg ; extern int optind , opterr , optopt ; int ret = 0 , cont = 1 , output_param = 0 , verbose = 1 ; int cpu = 0 ; { ret = getopt_long ( argc , argv , "os" , info_opts , NULL ) ; if ( ret == - 1 ) { break ; } switch ( ret ) { case '?' : output_param = '?' ; cont = 0 ; break ; case 's' : verbose = 0 ; break ; case - 1 : cont = 0 ; break ; case 'o' : if ( output_param ) { output_param = - 1 ; cont = 0 ; break ; } output_param = ret ; break ; } } cont ; switch ( output_param ) { case - 1 : printf ( _ ( "You can't specify more than one " "output-specific argument\n" ) ) ; cpuidle_exit ( EXIT_FAILURE ) ; case '?' : printf ( _ ( "invalid or unknown argument\n" ) ) ; cpuidle_exit ( EXIT_FAILURE ) ; } if ( bitmask_isallclear ( cpus_chosen ) ) { bitmask_setbit ( cpus_chosen , 0 ) ; } if ( output_param == 0 ) { cpuidle_general_output ( ) ; } for ( cpu = bitmask_first ( cpus_chosen ) ; cpu <= bitmask_last ( cpus_chosen ) ; cpu ++ ) { if ( ! bitmask_isbitset ( cpus_chosen , cpu ) ) { continue ; } printf ( _ ( "analyzing CPU %d:\n" ) , cpu ) ; if ( sysfs_is_cpu_online ( cpu ) != 1 ) { printf ( _ ( " *is offline\n" ) ) ; printf ( "\n" ) ; continue ; } switch ( output_param ) { case 'o' : proc_cpuidle_cpu_output ( cpu ) ; break ; case 0 : printf ( "\n" ) ; cpuidle_cpu_output ( cpu , verbose ) ; break ; } printf ( "\n" ) ; } return EXIT_SUCCESS ; } 