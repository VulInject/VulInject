static int k3_r5f_start ( struct udevice * dev ) { struct k3_r5f_core * core = dev_get_priv ( dev ) ; struct k3_r5f_cluster * cluster = core -> cluster ; int ret , c ; dev_dbg ( dev , "%s\n" , __func__ ) ; ret = k3_r5f_core_sanity_check ( core ) ; ret = k3_r5f_proc_request ( core ) ; if ( ret ) { return ret ; } if ( cluster -> mode == CLUSTER_MODE_LOCKSTEP ) { if ( is_primary_core ( core ) ) { for ( c = NR_CORES - 1 ; c >= 0 ; c -- ) { ret = k3_r5f_core_run ( cluster -> cores [ c ] ) ; if ( ret ) { unroll_core_run } } } else { dev_err ( dev , "Invalid op: Trying to start secondary core %d in lockstep mode\n" , core -> tsp . proc_id ) ; ret = - EINVAL ; proc_release } } else { ret = k3_r5f_core_run ( core ) ; if ( ret ) { proc_release } } core -> in_use = true ; k3_r5f_proc_release ( core ) ; return 0 ; unroll_core_run while ( c < NR_CORES ) { k3_r5f_core_halt ( cluster -> cores [ c ] ) ; c ++ ; } proc_release k3_r5f_proc_release ( core ) ; return ret ; } 