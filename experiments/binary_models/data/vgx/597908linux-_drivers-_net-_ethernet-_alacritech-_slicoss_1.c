static int slic_poll ( struct napi_struct * napi , int todo ) { struct slic_device * sdev = container_of ( napi , slic_device , napi ) ; struct slic_shmem * sm = & sdev -> shmem ; struct slic_shmem_data * sm_data = sm -> shmem_data ; u32 isr = le32_to_cpu ( sm_data -> isr ) ; int done = 0 ; slic_handle_irq ( sdev , isr , todo , & done ) ; if ( done < todo ) { napi_complete_done ( napi , done ) ; sm_data -> isr = 0 ; wmb ( ) ; slic_write ( sdev , SLIC_REG_ISR , 0 ) ; slic_flush_write ( sdev , NULL ) ; } return done ; } 