static M_sql_error_t M_sql_connpool_stop ( M_sql_connpool_t * pool ) { M_sql_conn_t * conn ; if ( M_queue_len ( pool -> pool_primary . used_conns ) || pool -> pool_primary . num_waiters || pool -> pool_primary . new_conns || M_queue_len ( pool -> pool_readonly . used_conns ) || pool -> pool_readonly . num_waiters || pool -> pool_readonly . new_conns ) { M_thread_mutex_unlock ( pool -> lock ) ; return M_SQL_ERROR_INUSE ; } while ( ( conn = M_llist_take_node ( M_llist_first ( pool -> pool_primary . conns ) ) ) != NULL ) { M_sql_conn_destroy ( conn , M_TRUE ) ; } while ( ( conn = M_llist_take_node ( M_llist_first ( pool -> pool_readonly . conns ) ) ) != NULL ) { M_sql_conn_destroy ( conn , M_TRUE ) ; } pool -> started = M_FALSE ; M_thread_mutex_unlock ( pool -> lock ) ; return M_SQL_ERROR_SUCCESS ; } 