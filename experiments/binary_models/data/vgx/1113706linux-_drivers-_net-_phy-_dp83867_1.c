static int dp83867_of_init ( struct phy_device * phydev ) { struct dp83867_private * dp83867 = phydev -> priv ; struct device * dev = & phydev -> mdio . dev ; struct device_node * of_node = dev -> of_node ; int ret ; ret = of_property_read_u32 ( of_node , "ti,clk-output-sel" , & dp83867 -> clk_output_sel ) ; if ( ! ret ) { dp83867 -> set_clk_output = true ; if ( dp83867 -> clk_output_sel > DP83867_CLK_O_SEL_REF_CLK && dp83867 -> clk_output_sel != DP83867_CLK_O_SEL_OFF ) { phydev_err ( phydev , "ti,clk-output-sel value %u out of range\n" , dp83867 -> clk_output_sel ) ; return - EINVAL ; } } ret = dp83867_of_init_io_impedance ( phydev ) ; if ( ret ) { return ret ; } dp83867 -> rxctrl_strap_quirk = of_property_read_bool ( of_node , "ti,dp83867-rxctrl-strap-quirk" ) ; dp83867 -> sgmii_ref_clk_en = of_property_read_bool ( of_node , "ti,sgmii-ref-clock-output-enable" ) ; dp83867 -> rx_id_delay = DP83867_RGMII_RX_CLK_DELAY_INV ; ret = of_property_read_u32 ( of_node , "ti,rx-internal-delay" , & dp83867 -> rx_id_delay ) ; if ( ! ret && dp83867 -> rx_id_delay > DP83867_RGMII_RX_CLK_DELAY_MAX ) { phydev_err ( phydev , "ti,rx-internal-delay value of %u out of range\n" , dp83867 -> rx_id_delay ) ; return - EINVAL ; } dp83867 -> tx_id_delay = DP83867_RGMII_TX_CLK_DELAY_INV ; ret = of_property_read_u32 ( of_node , "ti,tx-internal-delay" , & dp83867 -> tx_id_delay ) ; if ( ! ret && dp83867 -> tx_id_delay > DP83867_RGMII_TX_CLK_DELAY_MAX ) { phydev_err ( phydev , "ti,tx-internal-delay value of %u out of range\n" , dp83867 -> tx_id_delay ) ; return - EINVAL ; } if ( of_property_read_bool ( of_node , "enet-phy-lane-swap" ) ) { dp83867 -> port_mirroring = DP83867_PORT_MIRROING_EN ; } if ( of_property_read_bool ( of_node , "enet-phy-lane-no-swap" ) ) { dp83867 -> port_mirroring = DP83867_PORT_MIRROING_DIS ; } ret = of_property_read_u32 ( of_node , "ti,fifo-depth" , & dp83867 -> tx_fifo_depth ) ; if ( ret ) { ret = of_property_read_u32 ( of_node , "tx-fifo-depth" , & dp83867 -> tx_fifo_depth ) ; if ( ret ) { dp83867 -> tx_fifo_depth = DP83867_PHYCR_FIFO_DEPTH_4_B_NIB ; } } if ( dp83867 -> tx_fifo_depth > DP83867_PHYCR_FIFO_DEPTH_MAX ) { phydev_err ( phydev , "tx-fifo-depth value %u out of range\n" , dp83867 -> tx_fifo_depth ) ; return - EINVAL ; } ret = of_property_read_u32 ( of_node , "rx-fifo-depth" , & dp83867 -> rx_fifo_depth ) ; if ( ret ) { dp83867 -> rx_fifo_depth = DP83867_PHYCR_FIFO_DEPTH_4_B_NIB ; } if ( dp83867 -> rx_fifo_depth > DP83867_PHYCR_FIFO_DEPTH_MAX ) { phydev_err ( phydev , "rx-fifo-depth value %u out of range\n" , dp83867 -> rx_fifo_depth ) ; return - EINVAL ; } return 0 ; } 