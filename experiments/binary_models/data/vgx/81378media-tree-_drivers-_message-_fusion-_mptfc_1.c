static int mptfc_qcmd ( struct Scsi_Host * shost , struct scsi_cmnd * SCpnt ) { struct mptfc_rport_info * ri ; struct fc_rport * rport = starget_to_rport ( scsi_target ( SCpnt -> device ) ) ; int err ; VirtDevice * vdevice = SCpnt -> device -> hostdata ; if ( ! vdevice || ! vdevice -> vtarget ) { SCpnt -> result = DID_NO_CONNECT << 16 ; SCpnt -> scsi_done ( SCpnt , NULL ) ; return 0 ; } err = fc_remote_port_chkready ( rport ) ; if ( unlikely ( err ) ) { SCpnt -> result = err ; SCpnt -> scsi_done ( SCpnt ) ; return 0 ; } ri = * ( ( mptfc_rport_info * * ) rport -> dd_data ) ; if ( unlikely ( ! ri ) ) { SCpnt -> result = DID_IMM_RETRY << 16 ; SCpnt -> scsi_done ( SCpnt ) ; return 0 ; } return mptscsih_qcmd ( SCpnt ) ; } 