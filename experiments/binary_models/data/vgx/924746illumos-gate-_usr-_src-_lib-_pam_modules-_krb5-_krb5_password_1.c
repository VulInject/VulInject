static void set_ccname ( pam_handle_t * pamh , krb5_module_data_t * kmd , int login_result , int debug ) { int result ; if ( debug ) { __pam_log ( LOG_AUTH | LOG_DEBUG , "PAM-KRB5 (password): password: finalize" " ccname env, login_result =%d, env ='%s'" , login_result , kmd -> env ?kmd -> env : "<null>" ) ; } if ( kmd -> env ) { if ( login_result == PAM_SUCCESS ) { if ( ( result = pam_putenv ( pamh , kmd -> env ) ) != PAM_SUCCESS ) { __pam_log ( LOG_AUTH | LOG_ERR , "PAM-KRB5 (password):" " pam_putenv failed: result: %d" , result ) ; cleanupccname } } else { cleanupccname krb5_unsetenv ( KRB5_ENV_CCNAME ) ; free ( kmd -> env ) ; } } } 