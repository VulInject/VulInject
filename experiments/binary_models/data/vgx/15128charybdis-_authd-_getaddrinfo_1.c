static struct rb_addrinfo * get_ai ( const struct rb_addrinfo * pai , const struct afd * afd , const char * addr ) { char * p ; struct rb_addrinfo * ai ; ai = ( rb_addrinfo * ) rb_malloc ( sizeof ( rb_addrinfo ) + ( afd -> a_socklen ) ) ; if ( ai == NULL ) { return NULL ; } memcpy ( ai , pai , sizeof ( rb_addrinfo ) ) ; ai -> ai_addr = ( sockaddr * ) ( void * ) ( ai + 1 ) ; ai -> ai_addrlen = afd -> a_socklen ; ai -> ai_addr -> sa_family = ai -> ai_family = afd -> a_af ; p = ( char * ) ( void * ) ( ai -> ai_addr ) ; memcpy ( p + afd -> a_off , addr , ( size_t ) afd -> a_addrlen ) ; return ai ; } 