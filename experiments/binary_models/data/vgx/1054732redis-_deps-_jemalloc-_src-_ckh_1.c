static bool ckh_evict_reloc_insert ( ckh_t * ckh , size_t argbucket , void const * * argkey , void const * * argdata ) { const void * key , * data , * tkey , * tdata ; ckhc_t * cell ; size_t hashes [ 2 ] , bucket , tbucket ; unsigned i ; bucket = argbucket ; key = * argkey ; data = * argdata ; while ( true ) { i = prng_lg_range_u64 ( & ckh -> prng_state , LG_CKH_BUCKET_CELLS ) ; cell = & ckh -> tab [ ( bucket << LG_CKH_BUCKET_CELLS ) + i ] ; assert ( cell -> key != NULL ) ; tkey = cell -> key ; tdata = cell -> data ; cell -> key = key ; cell -> data = data ; key = tkey ; data = tdata ; ckh -> nrelocs ++ ; ckh -> hash ( key , hashes ) ; tbucket = hashes [ 1 ] & ( ( ZU ( 1 ) << ckh -> lg_curbuckets ) - 1 ) ; if ( tbucket == bucket ) { tbucket = hashes [ 0 ] & ( ( ZU ( 1 ) << ckh -> lg_curbuckets ) - 1 ) ; } if ( tbucket == argbucket ) { * argkey = key ; * argdata = data ; return true ; } bucket = tbucket ; if ( ! ckh_try_bucket_insert ( ckh , bucket , key , data ) ) { return false ; } } } 