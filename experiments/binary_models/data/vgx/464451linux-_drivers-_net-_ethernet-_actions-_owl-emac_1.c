static int owl_emac_mdio_read ( struct mii_bus * bus , int addr , int regnum ) { struct owl_emac_priv * priv = bus -> priv ; u32 data , tmp ; int ret ; data = OWL_EMAC_BIT_MAC_CSR10_SB ; data |= OWL_EMAC_VAL_MAC_CSR10_OPCODE_RD << OWL_EMAC_OFF_MAC_CSR10_OPCODE ; tmp = addr << OWL_EMAC_OFF_MAC_CSR10_PHYADD ; data |= tmp & OWL_EMAC_MSK_MAC_CSR10_PHYADD ; tmp = regnum << OWL_EMAC_OFF_MAC_CSR10_REGADD ; data |= tmp & OWL_EMAC_MSK_MAC_CSR10_REGADD ; owl_emac_reg_write ( priv , OWL_EMAC_REG_MAC_CSR10 , data ) ; ret = owl_emac_mdio_wait ( priv ) ; data = owl_emac_reg_read ( priv , OWL_EMAC_REG_MAC_CSR10 ) ; data &= OWL_EMAC_MSK_MAC_CSR10_DATA ; return data ; } 