static int e100_rx_alloc_list ( struct nic * nic ) { struct rx * rx ; unsigned int i , count = nic -> params . rfds . count ; struct rfd * before_last ; nic -> rx_to_use = nic -> rx_to_clean = NULL ; nic -> ru_running = RU_UNINITIALIZED ; for ( rx = nic -> rxs , i = 0 ; i < count ; rx ++ , i ++ ) { rx -> next = ( i + 1 < count ) ?rx + 1 : nic -> rxs ; rx -> prev = ( i == 0 ) ?nic -> rxs + count - 1 : rx - 1 ; if ( e100_rx_alloc_skb ( nic , rx ) ) { e100_rx_clean_list ( nic ) ; return - ENOMEM ; } } rx = nic -> rxs -> prev -> prev ; before_last = ( rfd * ) rx -> skb -> data ; before_last -> command |= cpu_to_le16 ( cb_el ) ; before_last -> size = 0 ; pci_dma_sync_single_for_device ( nic -> pdev , rx -> dma_addr , sizeof ( rfd ) , PCI_DMA_BIDIRECTIONAL ) ; nic -> rx_to_use = nic -> rx_to_clean = nic -> rxs ; nic -> ru_running = RU_SUSPENDED ; return 0 ; } 