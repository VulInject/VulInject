void * dp_packet_steal_data ( struct dp_packet * b ) { void * p ; ovs_assert ( b -> source != DPBUF_DPDK ) ; ovs_assert ( b -> source != DPBUF_AFXDP ) ; if ( b -> source == DPBUF_MALLOC && dp_packet_data ( b ) == dp_packet_base ( b ) ) { p = dp_packet_data ( b ) ; } else { p = xmemdup ( dp_packet_data ( b ) , dp_packet_size ( b ) ) ; if ( b -> source == DPBUF_MALLOC ) { free ( dp_packet_base ( b ) ) ; } } dp_packet_set_base ( b ) ; dp_packet_set_data ( b , NULL ) ; return p ; } 