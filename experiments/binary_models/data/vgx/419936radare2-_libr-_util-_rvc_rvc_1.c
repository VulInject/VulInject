R_API RList * branches_rvc ( Rvc * rvc ) { if ( ! rvc_repo_exists ( rvc -> path ) ) { R_LOG_ERROR ( "No valid repo in %s" , rvc -> path ) ; return NULL ; } RList * ret = r_list_new ( ) ; if ( ! ret ) { return NULL ; } SdbList * keys = sdb_foreach_list ( rvc -> db , false ) ; if ( ! keys ) { return NULL ; } SdbListIter * i ; SdbKv * kv ; ls_foreach ( , , ) { size_t bplen = r_str_len_utf8 ( BPREFIX ) ; if ( r_str_cmp ( ( char * ) kv -> base . key , BPREFIX , bplen ) ) { continue ; } if ( ! r_list_append ( ret , r_str_new ( ( char * ) kv -> base . key + bplen ) ) && ! ret -> head -> data ) { r_list_free ( ret ) ; ret = NULL ; break ; } } ls_free ( keys ) ; return ret ; } 