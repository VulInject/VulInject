static void adjust_data_dir ( void ) { char filename [ MAXPGPATH ] ; char * my_exec_path , * cmd ; FILE * fd ; if ( pg_config == NULL ) { return ; } snprintf ( filename , sizeof ( filename ) , "%s/postgresql.conf" , pg_config ) ; if ( ( fd = fopen ( filename , "r" ) ) == NULL ) { return ; } fclose ( fd ) ; snprintf ( filename , sizeof ( filename ) , "%s/PG_VERSION" , pg_config ) ; if ( ( fd = fopen ( filename , "r" ) ) != NULL ) { fclose ( fd ) ; return ; } if ( exec_path == NULL ) { my_exec_path = find_other_exec_or_die ( argv0 , "postgres" , PG_BACKEND_VERSIONSTR ) ; } else { my_exec_path = pg_strdup ( exec_path ) ; } cmd = psprintf ( "\"%s\" -C data_directory %s%s" , my_exec_path , pgdata_opt ?pgdata_opt : "" , post_opts ?post_opts : "" ) ; fflush ( NULL ) ; fd = popen ( cmd , "r" ) ; if ( fd == NULL || fgets ( filename , sizeof ( filename ) , fd ) == NULL || pclose ( fd ) != 0 ) { write_stderr ( _ ( "%s: could not determine the data directory using command \"%s\"\n" ) , progname , cmd ) ; exit ( 1 ) ; } free ( my_exec_path ) ; ( void ) pg_strip_crlf ( filename ) ; pg_data = pg_strdup ( filename ) ; canonicalize_path ( pg_data ) ; } 