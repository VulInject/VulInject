static int st_rtc_set_alarm ( struct device * dev , struct rtc_wkalrm * t ) { struct st_rtc * rtc = dev_get_drvdata ( dev ) ; struct rtc_time now ; unsigned long now_secs ; unsigned long alarm_secs ; unsigned long long lpa ; st_rtc_read_time ( dev , & now ) ; rtc_tm_to_time ( & now , & now_secs ) ; rtc_tm_to_time ( & t -> time , & alarm_secs ) ; memcpy ( & rtc -> alarm , t , sizeof ( rtc_wkalrm ) ) ; alarm_secs -= now_secs ; lpa = ( unsigned long long ) alarm_secs * rtc -> clkrate ; st_rtc_set_hw_alarm ( rtc , lpa >> 32 , lpa ) ; st_rtc_alarm_irq_enable ( dev , t -> enabled ) ; return 0 ; } 