Time_t tmxscan ( const char * s , char * * e , const char * format , char * * f , Time_t t , long flags ) { register char * v ; register char * * p ; char * q ; char * r ; Time_t x ; static int initialized ; static char * * datemask ; tmlocale ( ) ; if ( ! format || ! * format ) { if ( ! initialized ) { register Sfio_t * sp ; register int n ; off_t m ; initialized = 1 ; if ( ( v = getenv ( "DATEMSK" ) ) && * v && ( sp = sfopen ( NiL , v , "r" ) ) ) { for ( n = 1 ; sfgetr ( sp , '\n' , 0 ) ; n ++ ) { } m = sfseek ( sp , 0L , SEEK_CUR ) ; if ( p = newof ( 0 , char * , n , m ) ) { sfseek ( sp , 0L , SEEK_SET ) ; v = ( char * ) ( p + n ) ; if ( sfread ( sp , v , m ) != m ) { p = 0 ; } else { datemask = p ; v [ m ] = 0 ; while ( * v ) { * p ++ = v ; if ( ! ( v = strchr ( v , '\n' ) ) ) { break ; } * v ++ = 0 ; } * p = 0 ; } } } } if ( p = datemask ) { while ( v = * p ++ ) { x = scan ( s , & q , v , & r , t , flags ) ; if ( ! * q && ! * r ) { if ( e ) { * e = q ; } if ( f ) { * f = r ; } return x ; } } } if ( f ) { * f = ( char * ) format ; } if ( format ) { return tmxdate ( s , e , t ) ; } if ( e ) { * e = ( char * ) s ; } return 0 ; } return scan ( s , e , format , f , t , flags ) ; } 