static char * read_splashfile ( char * filename , gsize * file_sizep , int * file_typep ) { GError * err = NULL ; gchar * content ; int file_type ; unsigned int filehead ; int bmp_bpp ; if ( ! g_file_get_contents ( filename , & content , file_sizep , & err ) ) { error_report ( "failed to read splash file '%s': %s" , filename , err -> message ) ; g_error_free ( err ) ; return NULL ; } if ( * file_sizep < 30 ) { error } filehead = lduw_le_p ( content ) ; if ( filehead == 0xd8ff ) { file_type = JPG_FILE ; } if ( filehead == 0x4d42 ) { file_type = BMP_FILE ; } else { error } if ( file_type == BMP_FILE ) { bmp_bpp = lduw_le_p ( & content [ 28 ] ) ; if ( bmp_bpp != 24 ) { error } } * file_typep = file_type ; return content ; error error_report ( "splash file '%s' format not recognized; must be JPEG " "or 24 bit BMP" , filename ) ; return NULL ; } 