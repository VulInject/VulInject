const char * cupsGetDefault2 ( http_t * http ) { ipp_t * request , * response ; ipp_attribute_t * attr ; _cups_globals_t * cg = _cupsGlobals ( ) ; if ( _cupsUserDefault ( cg -> def_printer , sizeof ( cg -> def_printer ) ) ) { return ( cg -> def_printer ) ; } if ( ! http ) { if ( ( http = _cupsConnect ( ) ) == NULL ) { return ( NULL ) ; } } request = ippNewRequest ( IPP_OP_CUPS_GET_DEFAULT ) ; if ( ( response = cupsDoRequest ( http , request , "/" ) ) != NULL ) { if ( ( attr = ippFindAttribute ( response , "printer-name" , IPP_TAG_NAME ) ) != NULL ) { strlcpy ( cg -> def_printer , attr -> values [ 0 ] . string . text , sizeof ( cg -> def_printer ) ) ; ippDelete ( response , NULL ) ; return ( cg -> def_printer ) ; } ippDelete ( response ) ; } return ( NULL ) ; } 