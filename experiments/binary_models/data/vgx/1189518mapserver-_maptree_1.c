static int treeNodeTrim ( treeNodeObj * node ) { int i ; for ( i = 0 ; i < node -> numsubnodes ; i ++ ) { if ( treeNodeTrim ( node -> subnode [ i ] ) ) { destroyTreeNode ( node -> subnode [ i ] ) ; node -> subnode [ i ] = node -> subnode [ node -> numsubnodes - 1 ] ; node -> numsubnodes -- ; i -- ; } } if ( node -> numsubnodes == 1 && node -> numshapes == 0 ) { treeNodeObj * psSubNode = node -> subnode [ 0 ] ; memcpy ( & node -> rect , & psSubNode -> rect , sizeof ( psSubNode -> rect ) ) ; node -> numshapes = psSubNode -> numshapes ; assert ( node -> ids == NULL ) ; node -> ids = psSubNode -> ids ; node -> numsubnodes = psSubNode -> numsubnodes ; for ( i = 0 ; i < psSubNode -> numsubnodes ; i ++ ) { node -> subnode [ i ] = psSubNode -> subnode [ i ] ; } } return ( node -> numsubnodes == 0 && node -> numshapes == 0 ) ; } 