static char * lxclock_name ( const char * p , const char * n ) { __do_free char * dest = NULL , * rundir = NULL ; int ret ; size_t len ; len = STRLITERALLEN ( "/lxc/lock/" ) + strlen ( n ) + strlen ( p ) + 3 ; rundir = get_rundir ( ) ; if ( ! rundir ) { return NULL ; } len += strlen ( rundir ) ; dest = malloc ( len ) ; if ( ! dest ) { return NULL ; } ret = strnprintf ( dest , len , "%s/lxc/lock/%s" , rundir , p ) ; if ( ret < 0 ) { return NULL ; } ret = mkdir_p ( dest , 0755 ) ; if ( ret < 0 ) { return NULL ; } ret = strnprintf ( dest , len , "%s/lxc/lock/%s/.%s" , rundir , p , n ) ; if ( ret < 0 ) { return NULL ; } return move_ptr ( dest ) ; } 