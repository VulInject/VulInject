int register_lte_tty_device ( struct tty_dev * tty_dev , struct device * device ) { struct gdm * gdm ; int i ; int j ; for ( i = 0 ; i < TTY_MAX_COUNT ; i ++ ) { gdm = kmalloc ( sizeof ( * gdm ) , GFP_KERNEL ) ; if ( ! gdm ) { return - ENOMEM ; } mutex_lock ( & gdm_table_lock ) ; for ( j = 0 ; j < GDM_TTY_MINOR ; j ++ ) { if ( ! gdm_table [ i ] [ j ] ) { break ; } } if ( j == GDM_TTY_MINOR ) { mutex_unlock ( & gdm_table_lock ) ; return - EINVAL ; } gdm_table [ i ] [ j ] = gdm ; mutex_unlock ( & gdm_table_lock ) ; tty_dev -> gdm [ i ] = gdm ; tty_port_init ( & gdm -> port ) ; gdm -> port . ops = & gdm_port_ops ; gdm -> index = i ; gdm -> minor = j ; gdm -> tty_dev = tty_dev ; tty_port_register_device ( & gdm -> port , gdm_driver [ i ] , gdm -> minor , device ) ; } for ( i = 0 ; i < MAX_ISSUE_NUM ; i ++ ) { gdm_tty_recv ( gdm , gdm_tty_recv_complete ) ; } return 0 ; } 