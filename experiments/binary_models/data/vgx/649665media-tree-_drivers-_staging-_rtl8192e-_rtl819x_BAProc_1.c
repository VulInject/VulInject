static struct sk_buff * rtllib_DELBA ( struct rtllib_device * ieee , u8 * dst , struct ba_record * pBA , enum tr_select TxRxSelect , u16 ReasonCode ) { union delba_param_set DelbaParamSet ; struct sk_buff * skb = NULL ; struct rtllib_hdr_3addr * Delba = NULL ; u8 * tag = NULL ; u16 len = 6 + ieee -> tx_headroom ; if ( net_ratelimit ( ) ) { netdev_dbg ( ieee -> dev , "%s(): ReasonCode(%d) sentd to: %pM\n" , __func__ , ReasonCode , dst ) ; } memset ( & DelbaParamSet , 0 , 2 ) ; DelbaParamSet . field . Initiator = ( TxRxSelect == TX_DIR ) ?1 : 0 ; DelbaParamSet . field . TID = pBA -> BaParamSet . field . TID ; skb = dev_alloc_skb ( len + sizeof ( rtllib_hdr_3addr ) ) ; if ( ! skb ) { return in ; } skb_reserve ( skb , ieee -> tx_headroom ) ; Delba = ( rtllib_hdr_3addr * ) skb_put ( skb , sizeof ( rtllib_hdr_3addr ) ) ; ether_addr_copy ( Delba -> addr1 , dst ) ; ether_addr_copy ( Delba -> addr2 , ieee -> dev -> dev_addr ) ; ether_addr_copy ( Delba -> addr3 , ieee -> current_network . bssid ) ; Delba -> frame_ctl = cpu_to_le16 ( RTLLIB_STYPE_MANAGE_ACT ) ; tag = ( u8 * ) skb_put ( skb , 6 ) ; * tag ++ = ACT_CAT_BA ; * tag ++ = ACT_DELBA ; put_unaligned_le16 ( DelbaParamSet . shortData , tag ) ; tag += 2 ; put_unaligned_le16 ( ReasonCode , tag ) ; tag += 2 ; print_hex_dump_bytes ( "rtllib_DELBA(): " , DUMP_PREFIX_NONE , skb -> data , skb -> len ) ; return skb ; } 