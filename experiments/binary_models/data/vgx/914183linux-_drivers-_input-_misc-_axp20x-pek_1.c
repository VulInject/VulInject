static int axp20x_pek_probe ( struct platform_device * pdev ) { struct axp20x_pek * axp20x_pek ; const struct platform_device_id * match = platform_get_device_id ( pdev ) ; int error ; if ( ! match ) { dev_err ( & pdev -> dev , "Failed to get platform_device_id\n" ) ; return - EINVAL ; } axp20x_pek = devm_kzalloc ( & pdev -> dev , sizeof ( axp20x_pek ) , GFP_KERNEL ) ; axp20x_pek -> axp20x = dev_get_drvdata ( pdev -> dev . parent ) ; if ( axp20x_pek_should_register_input ( axp20x_pek ) ) { error = axp20x_pek_probe_input_device ( axp20x_pek , pdev ) ; if ( error ) { return error ; } } axp20x_pek -> info = ( axp20x_info * ) match -> driver_data ; platform_set_drvdata ( pdev , axp20x_pek ) ; return 0 ; } 