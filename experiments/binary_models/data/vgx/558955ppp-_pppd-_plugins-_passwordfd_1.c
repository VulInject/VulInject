static int pwfd_passwd ( char * user , char * passwd ) { int readgood , red ; if ( passwdfd == - 1 ) { return - 1 ; } if ( passwdfd == - 2 ) { strcpy ( passwd , save_passwd ) ; return 1 ; } readgood = 0 ; { red = read ( passwdfd , passwd + readgood , MAXSECRETLEN - 1 - readgood ) ; if ( red == 0 ) { break ; } if ( red < 0 ) { error ( "Can't read secret from fd\n" ) ; readgood = - 1 ; break ; } readgood += red ; } readgood < MAXSECRETLEN - 1 ; close ( passwdfd ) ; if ( readgood < 0 ) { return 0 ; } passwd [ readgood ] = 0 ; strcpy ( save_passwd , passwd ) ; passwdfd = - 2 ; return 1 ; } 