int auditme ( au_kcontext_t * kctx , struct t_audit_data * tad , au_state_t estate ) { int flag = 0 ; au_mask_t amask ; const auditinfo_addr_t * ainfo ; ainfo = crgetauinfo ( CRED ( ) ) ; amask = ainfo -> ai_mask ; if ( amask . as_success & estate || amask . as_failure & estate ) { flag = 1 ; } if ( ( tad -> tad_scid == SYS_putmsg ) || ( tad -> tad_scid == SYS_getmsg ) ) { estate = kctx -> auk_ets [ AUE_SOCKCONNECT ] | kctx -> auk_ets [ AUE_SOCKACCEPT ] | kctx -> auk_ets [ AUE_SOCKSEND ] | kctx -> auk_ets [ AUE_SOCKRECEIVE ] ; if ( amask . as_success & estate || amask . as_failure & estate ) { flag = 1 ; } } if ( tad -> tad_scid == SYS_execve && getpflags ( PRIV_PFEXEC , CRED ( ) ) != 0 ) { estate = kctx -> auk_ets [ AUE_PFEXEC ] ; if ( amask . as_success & estate || amask . as_failure & estate ) { flag = 1 ; } } return ( flag ) ; } 