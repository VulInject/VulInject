static int amd_pmu_get_msr ( struct kvm_vcpu * vcpu , struct msr_data * msr_info ) { struct kvm_pmu * pmu = vcpu_to_pmu ( vcpu ) ; struct kvm_pmc * pmc ; u32 msr = msr_info -> index ; pmc = get_gp_pmc_amd ( pmu , msr , PMU_TYPE_COUNTER ) ; if ( pmc ) { msr_info -> data = pmc_read_counter ( pmc , NULL ) ; return 0 ; } pmc = get_gp_pmc_amd ( pmu , msr , PMU_TYPE_EVNTSEL ) ; if ( pmc ) { msr_info -> data = pmc -> eventsel ; return 0 ; } return 1 ; } 