bool_t xdr_READDIR3vres ( XDR * xdrs , READDIR3vres * objp ) { dirent64_t * dp ; uint_t entries_size ; int outcount = 0 ; if ( xdrs -> x_op != XDR_DECODE ) { return ( FALSE ) ; } if ( ! xdr_enum ( xdrs , ( enum_t * ) & objp -> status ) ) { return ( FALSE ) ; } if ( ! xdr_post_op_vattr ( xdrs , & objp -> dir_attributes ) ) { return ( FALSE ) ; } if ( objp -> status != NFS3_OK ) { return ( TRUE ) ; } if ( ! xdr_u_longlong_t ( xdrs , & objp -> cookieverf ) ) { return ( FALSE ) ; } entries_size = objp -> entries_size ; dp = objp -> entries ; for ( ; ; ) { uint_t this_reclen ; bool_t valid ; uint_t namlen ; ino64_t fileid ; if ( ! XDR_GETINT32 ( xdrs , ( int32_t * ) & valid ) ) { return ( FALSE ) ; } if ( ! valid ) { if ( ! XDR_GETINT32 ( xdrs , ( int32_t * ) & objp -> eof ) ) { return ( FALSE ) ; } break ; } if ( ! xdr_u_longlong_t ( xdrs , ( u_longlong_t * ) & fileid ) ) { return ( FALSE ) ; } if ( ! XDR_GETINT32 ( xdrs , ( int32_t * ) & namlen ) ) { return ( FALSE ) ; } this_reclen = DIRENT64_RECLEN ( namlen ) ; if ( ( outcount + this_reclen ) > entries_size ) { objp -> eof = FALSE ; break ; } dp -> d_reclen = this_reclen ; dp -> d_ino = fileid ; if ( ! xdr_opaque ( xdrs , dp -> d_name , namlen ) ) { return ( FALSE ) ; } bzero ( & dp -> d_name [ namlen ] , DIRENT64_NAMELEN ( this_reclen ) - namlen ) ; if ( ! xdr_u_longlong_t ( xdrs , ( u_longlong_t * ) & dp -> d_off ) ) { return ( FALSE ) ; } objp -> loff = dp -> d_off ; outcount += this_reclen ; dp = ( dirent64_t * ) ( ( intptr_t ) dp + this_reclen ) ; } objp -> size = outcount ; return ( TRUE ) ; } 