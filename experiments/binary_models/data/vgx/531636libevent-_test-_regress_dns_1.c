static void test_set_option ( void * arg ) { struct basic_test_data * data = arg ; struct evdns_base * dns_base ; size_t i ; const char * int_options [ ] { "ndots" "ndots:" "max-timeouts" "max-timeouts:" "max-inflight" "max-inflight:" "attempts" "attempts:" "randomize-case" "randomize-case:" "so-rcvbuf" "so-rcvbuf:" "so-sndbuf" "so-sndbuf:" } ; ; const char * timeval_options [ ] { "timeout" "timeout:" "getaddrinfo-allow-skew" "getaddrinfo-allow-skew:" "initial-probe-timeout" "initial-probe-timeout:" } ; ; const char * addr_port_options [ ] { "bind-to" "bind-to:" } ; ; const char * options_without_values [ ] { "use-vc" "use-vc:" "ignore-tc" "ignore-tc:" } ; ; dns_base = evdns_base_new ( data -> base , 0 ) ; for ( i = 0 ; i < ARRAY_SIZE ( int_options ) ; ++ i ) { tt_assert ( SUCCESS == evdns_base_set_option ( dns_base , int_options [ i ] , "0" ) ) ; tt_assert ( SUCCESS == evdns_base_set_option ( dns_base , int_options [ i ] , "1" ) ) ; tt_assert ( SUCCESS == evdns_base_set_option ( dns_base , int_options [ i ] , "10000" ) ) ; tt_assert ( FAIL == evdns_base_set_option ( dns_base , int_options [ i ] , "foo" ) ) ; tt_assert ( FAIL == evdns_base_set_option ( dns_base , int_options [ i ] , "3.14" ) ) ; } for ( i = 0 ; i < ARRAY_SIZE ( timeval_options ) ; ++ i ) { tt_assert ( SUCCESS == evdns_base_set_option ( dns_base , timeval_options [ i ] , "1" ) ) ; tt_assert ( SUCCESS == evdns_base_set_option ( dns_base , timeval_options [ i ] , "0.001" ) ) ; tt_assert ( SUCCESS == evdns_base_set_option ( dns_base , timeval_options [ i ] , "3.14" ) ) ; tt_assert ( SUCCESS == evdns_base_set_option ( dns_base , timeval_options [ i ] , "10000" ) ) ; tt_assert ( FAIL == evdns_base_set_option ( dns_base , timeval_options [ i ] , "0" ) ) ; tt_assert ( FAIL == evdns_base_set_option ( dns_base , timeval_options [ i ] , "foo" ) ) ; } for ( i = 0 ; i < ARRAY_SIZE ( addr_port_options ) ; ++ i ) { tt_assert ( SUCCESS == evdns_base_set_option ( dns_base , addr_port_options [ i ] , "8.8.8.8:80" ) ) ; tt_assert ( SUCCESS == evdns_base_set_option ( dns_base , addr_port_options [ i ] , "1.2.3.4" ) ) ; tt_assert ( SUCCESS == evdns_base_set_option ( dns_base , addr_port_options [ i ] , "::1:82" ) ) ; tt_assert ( SUCCESS == evdns_base_set_option ( dns_base , addr_port_options [ i ] , "3::4" ) ) ; tt_assert ( FAIL == evdns_base_set_option ( dns_base , addr_port_options [ i ] , "3.14" ) ) ; tt_assert ( FAIL == evdns_base_set_option ( dns_base , addr_port_options [ i ] , "foo" ) ) ; } for ( i = 0 ; i < ARRAY_SIZE ( options_without_values ) ; ++ i ) { tt_assert ( SUCCESS == evdns_base_set_option ( dns_base , options_without_values [ i ] , NULL ) ) ; tt_assert ( SUCCESS == evdns_base_set_option ( dns_base , options_without_values [ i ] , "" ) ) ; tt_assert ( FAIL == evdns_base_set_option ( dns_base , options_without_values [ i ] , "1" ) ) ; tt_assert ( FAIL == evdns_base_set_option ( dns_base , options_without_values [ i ] , "foo" ) ) ; } end if ( dns_base ) { evdns_base_free ( dns_base , 0 ) ; } } 