int vboxsf_nlscpy ( struct vboxsf_sbi * sbi , char * name , size_t name_bound_len , const unsigned char * utf8_name , size_t utf8_len ) { const char * in ; char * out ; size_t out_len ; size_t out_bound_len ; size_t in_bound_len ; in = utf8_name ; in_bound_len = utf8_len ; out = name ; out_len = 0 ; out_bound_len = name_bound_len - 1 ; while ( in_bound_len ) { int nb ; unicode_t uni ; nb = utf8_to_utf32 ( in , in_bound_len , & uni ) ; in += nb ; in_bound_len -= nb ; nb = sbi -> nls -> uni2char ( uni , out , out_bound_len ) ; if ( nb < 0 ) { return nb ; } out += nb ; out_bound_len -= nb ; out_len += nb ; } * out = 0 ; return 0 ; } 