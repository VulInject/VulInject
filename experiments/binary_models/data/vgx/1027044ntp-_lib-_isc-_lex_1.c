static inline isc_result_t new_source ( isc_lex_t * lex , isc_boolean_t is_file , isc_boolean_t need_close , void * input , const char * name ) { inputsource * source ; isc_result_t result ; source = isc_mem_get ( lex -> mctx , sizeof ( * source ) ) ; if ( source == NULL ) { return ( ISC_R_NOMEMORY ) ; } source -> result = ISC_R_SUCCESS ; source -> is_file = is_file ; source -> need_close = need_close ; source -> at_eof = ISC_FALSE ; source -> input = input ; source -> name = isc_mem_strdup ( lex -> mctx , name ) ; if ( source -> name == NULL ) { isc_mem_put ( lex -> mctx , source , sizeof ( * source ) ) ; return ( ISC_R_NOMEMORY ) ; } result = isc_buffer_allocate ( lex -> mctx , & source -> pushback , lex -> max_token ) ; if ( result != ISC_R_SUCCESS ) { isc_mem_free ( lex -> mctx , source -> name ) ; isc_mem_put ( lex -> mctx , source , sizeof ( * source ) ) ; return ( result ) ; } source -> ignored = 0 ; source -> line = 1 ; ISC_LIST_INITANDPREPEND ( lex -> sources , source , link ) ; return ( ISC_R_SUCCESS ) ; } 