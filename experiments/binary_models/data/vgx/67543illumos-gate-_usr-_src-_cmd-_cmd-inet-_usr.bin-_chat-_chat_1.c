void terminate ( status ) int status ; { static int terminating = 0 ; if ( terminating ) { exit ( status ) ; } terminating = 1 ; echo_stderr ( - 1 ) ; if ( report_gathering ) { int c , rep_len ; rep_len = strlen ( report_buffer ) ; while ( rep_len + 1 <= sizeof ( report_buffer ) ) { alarm ( 1 ) ; c = get_char ( ) ; alarm ( 0 ) ; if ( c < 0 || iscntrl ( c ) ) { break ; } report_buffer [ rep_len ] = c ; ++ rep_len ; } report_buffer [ rep_len ] = 0 ; fprintf ( report_fp , "chat:  %s\n" , report_buffer ) ; } if ( report_file != ( char * ) 0 && report_fp != ( FILE * ) NULL ) { if ( verbose ) { fprintf ( report_fp , "Closing \"%s\".\n" , report_file ) ; } fclose ( report_fp , NULL ) ; report_fp = ( FILE * ) NULL ; } if ( have_tty_parameters ) { if ( set_term_param ( & saved_tty_parameters ) < 0 ) { fatal ( 2 , "Can't restore terminal parameters: %m" ) ; } } exit ( status ) ; } 