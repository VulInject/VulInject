static int client_likes_consensus ( const struct consensus_cache_entry_t * ent , const char * want_url ) { smartlist_t * voters = smartlist_new ( ) ; int need_at_least ; int have = 0 ; if ( consensus_cache_entry_get_voter_id_digests ( ent , voters ) != 0 ) { return 1 ; } smartlist_t * want_authorities = smartlist_new ( ) ; dir_split_resource_into_fingerprints ( want_url , want_authorities , NULL , 0 ) ; need_at_least = smartlist_len ( want_authorities ) / 2 + 1 ; SMARTLIST_FOREACH_BEGIN ( , , ) { SMARTLIST_FOREACH_BEGIN ( , , ) { if ( ! strcasecmpstart ( digest , want_digest ) ) { have ++ ; break ; } } SMARTLIST_FOREACH_END ( digest ) ; if ( have >= need_at_least ) { break ; } } SMARTLIST_FOREACH_END ( want_digest ) ; SMARTLIST_FOREACH ( want_authorities , char * , d , tor_free ( d ) ) ; smartlist_free ( want_authorities ) ; SMARTLIST_FOREACH ( voters , char * , cp , tor_free ( cp ) ) ; smartlist_free ( voters ) ; return ( have >= need_at_least ) ; } 