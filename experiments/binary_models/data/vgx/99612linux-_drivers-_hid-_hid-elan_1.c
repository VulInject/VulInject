static int elan_probe ( struct hid_device * hdev , const struct hid_device_id * id ) { int ret ; struct elan_drvdata * drvdata ; drvdata = devm_kzalloc ( & hdev -> dev , sizeof ( * drvdata ) , GFP_KERNEL ) ; hid_set_drvdata ( hdev , drvdata ) ; ret = hid_parse ( hdev ) ; if ( ret ) { hid_err ( hdev , "Hid Parse failed\n" ) ; return ret ; } ret = hid_hw_start ( hdev , HID_CONNECT_DEFAULT ) ; if ( ret ) { hid_err ( hdev , "Hid hw start failed\n" ) ; return ret ; } if ( is_not_elan_touchpad ( hdev ) ) { return 0 ; } if ( ! drvdata -> input ) { hid_err ( hdev , "Input device is not registered\n" ) ; ret = - ENAVAIL ; err } ret = elan_start_multitouch ( hdev ) ; if ( ret ) { err } if ( id -> driver_data & ELAN_HAS_LED ) { ret = elan_init_mute_led ( hdev ) ; if ( ret ) { err } } return 0 ; err hid_hw_stop ( hdev ) ; return ret ; } 