static void orinoco_send_assocreqie_wevent ( struct orinoco_private * priv ) { struct net_device * dev = priv -> ndev ; struct hermes * hw = & priv -> hw ; union iwreq_data wrqu ; int err ; u8 buf [ 88 ] ; u8 * ie ; err = hw -> ops -> read_ltv ( hw , USER_BAP , HERMES_RID_CURRENT_ASSOC_REQ_INFO , sizeof ( buf ) , NULL , & buf ) ; if ( err != 0 ) { return ; } ie = orinoco_get_wpa_ie ( buf , sizeof ( buf ) ) ; if ( ie ) { int rem = sizeof ( buf ) - ( ie - & buf [ 0 ] ) ; wrqu . data . length = ie [ 1 ] + 2 ; if ( wrqu . data . length > rem ) { wrqu . data . length = rem ; } if ( wrqu . data . length ) { wireless_send_event ( dev , IWEVASSOCREQIE , & wrqu , ie ) ; } } } 