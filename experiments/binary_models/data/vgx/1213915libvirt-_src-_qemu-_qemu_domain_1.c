static int qemuDomainDefNamespaceParseOverrideProperties ( qemuDomainXmlNsOverrideProperty * props , xmlNodePtr * propnodes , size_t npropnodes ) { int i ; for ( i = 0 ; i < npropnodes ; i ++ ) { qemuDomainXmlNsOverrideProperty * prop = props + i ; unsigned long long ull ; long long ll ; bool b ; if ( ! ( prop -> name = virXMLPropString ( propnodes [ i ] , "name" ) ) ) { virReportError ( VIR_ERR_XML_ERROR , "%s" , _ ( "missing 'name' attribute for qemu:property" ) ) ; return - 1 ; } if ( STREQ ( prop -> name , "id" ) ) { virReportError ( VIR_ERR_XML_ERROR , "%s" , _ ( "property with name 'id' can't be overridden" ) ) ; return - 1 ; } if ( virXMLPropEnum ( propnodes [ i ] , "type" , qemuDomainXmlNsOverrideTypeFromString , VIR_XML_PROP_REQUIRED | VIR_XML_PROP_NONZERO , & prop -> type ) < 0 ) { return - 1 ; } if ( ! ( prop -> value = virXMLPropString ( propnodes [ i ] , "value" ) ) ) { if ( prop -> type != QEMU_DOMAIN_XML_NS_OVERRIDE_REMOVE ) { virReportError ( VIR_ERR_XML_ERROR , "%s" , _ ( "missing 'value' attribute for 'qemu:property'" ) ) ; return - 1 ; } } switch ( prop -> type ) { case QEMU_DOMAIN_XML_NS_OVERRIDE_STRING : prop -> json = virJSONValueNewString ( g_strdup ( prop -> value ) ) ; break ; case QEMU_DOMAIN_XML_NS_OVERRIDE_SIGNED : if ( virStrToLong_ll ( prop -> value , NULL , 10 , & ll ) < 0 ) { virReportError ( VIR_ERR_XML_ERROR , _ ( "invalid value '%s' of 'value' attribute of 'qemu:property'" ) , prop -> value ) ; return - 1 ; } prop -> json = virJSONValueNewNumberLong ( ll ) ; break ; case QEMU_DOMAIN_XML_NS_OVERRIDE_UNSIGNED : if ( virStrToLong_ullp ( prop -> value , NULL , 10 , & ull ) < 0 ) { virReportError ( VIR_ERR_XML_ERROR , _ ( "invalid value '%s' of 'value' attribute of 'qemu:property'" ) , prop -> value ) ; return - 1 ; } prop -> json = virJSONValueNewNumberUlong ( ull ) ; break ; case QEMU_DOMAIN_XML_NS_OVERRIDE_BOOL : if ( STRNEQ ( prop -> value , "true" ) && STRNEQ ( prop -> value , "false" ) ) { virReportError ( VIR_ERR_XML_ERROR , _ ( "invalid value '%s' of 'value' attribute of 'qemu:property'" ) , prop -> value ) ; return - 1 ; } b = STREQ ( prop -> value , "true" ) ; prop -> json = virJSONValueNewBoolean ( b ) ; break ; case QEMU_DOMAIN_XML_NS_OVERRIDE_REMOVE : if ( prop -> value ) { virReportError ( VIR_ERR_XML_ERROR , "%s" , _ ( "setting 'value' attribute of 'qemu:property' doesn't make sense with 'remove' type" ) ) ; return - 1 ; } break ; case QEMU_DOMAIN_XML_NS_OVERRIDE_NONE : case QEMU_DOMAIN_XML_NS_OVERRIDE_LAST : virReportEnumRangeError ( qemuDomainXmlNsOverrideType , prop -> type ) ; return - 1 ; } } return 0 ; } 