int cedrus_queue_init ( void * priv , struct vb2_queue * src_vq , struct vb2_queue * dst_vq ) { struct cedrus_ctx * ctx = priv ; int ret ; src_vq -> type = V4L2_BUF_TYPE_VIDEO_OUTPUT ; src_vq -> io_modes = VB2_MMAP | VB2_DMABUF ; src_vq -> drv_priv = ctx ; src_vq -> buf_struct_size = sizeof ( cedrus_buffer ) ; src_vq -> ops = & cedrus_qops ; src_vq -> mem_ops = & vb2_dma_contig_memops ; src_vq -> timestamp_flags = V4L2_BUF_FLAG_TIMESTAMP_COPY ; src_vq -> lock = & ctx -> dev -> dev_mutex ; src_vq -> dev = ctx -> dev -> dev ; src_vq -> supports_requests = true ; src_vq -> requires_requests = true ; ret = vb2_queue_init ( src_vq ) ; dst_vq -> type = V4L2_BUF_TYPE_VIDEO_CAPTURE ; dst_vq -> io_modes = VB2_MMAP | VB2_DMABUF ; dst_vq -> drv_priv = ctx ; dst_vq -> buf_struct_size = sizeof ( cedrus_buffer ) ; dst_vq -> ops = & cedrus_qops ; dst_vq -> mem_ops = & vb2_dma_contig_memops ; dst_vq -> timestamp_flags = V4L2_BUF_FLAG_TIMESTAMP_COPY ; dst_vq -> lock = & ctx -> dev -> dev_mutex ; dst_vq -> dev = ctx -> dev -> dev ; return vb2_queue_init ( dst_vq ) ; } 