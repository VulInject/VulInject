static void DrawMultitextured ( shaderCommands_t * input , int stage ) { shaderStage_t * pStage ; pStage = tess . xstages [ stage ] ; if ( tess . shader -> noFog && pStage -> isFogged ) { R_FogOn ( ) ; } if ( tess . shader -> noFog && ! pStage -> isFogged ) { R_FogOff ( ) ; } if ( backEnd . projection2D ) { R_FogOff ( ) ; } else { R_FogOn ( ) ; } GL_State ( pStage -> stateBits ) ; if ( backEnd . viewParms . isPortal ) { qglPolygonMode ( GL_FRONT_AND_BACK , GL_FILL ) ; } GL_SelectTexture ( 0 ) ; qglTexCoordPointer ( 2 , GL_FLOAT , 0 , input -> svars . texcoords [ 0 ] ) ; R_BindAnimatedImage ( & pStage -> bundle [ 0 ] ) ; GL_SelectTexture ( 1 ) ; qglEnable ( GL_TEXTURE_2D , NULL ) ; qglEnableClientState ( GL_TEXTURE_COORD_ARRAY ) ; if ( r_lightmap -> integer ) { GL_TexEnv ( GL_REPLACE ) ; } else { GL_TexEnv ( tess . shader -> multitextureEnv ) ; } qglTexCoordPointer ( 2 , GL_FLOAT , 0 , input -> svars . texcoords [ 1 ] ) ; R_BindAnimatedImage ( & pStage -> bundle [ 1 ] ) ; R_DrawElements ( input -> numIndexes , input -> indexes ) ; qglDisable ( GL_TEXTURE_2D ) ; GL_SelectTexture ( 0 ) ; } 