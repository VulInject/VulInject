static int uea_boot ( struct uea_softc * sc , struct usb_interface * intf ) { struct intr_pkt * intr ; int ret = - ENOMEM ; int size ; uea_enters ( INS_TO_USBDEV ( sc ) ) ; if ( UEA_CHIP_VERSION ( sc ) == EAGLE_IV ) { size = E4_INTR_PKT_SIZE ; sc -> dispatch_cmv = uea_dispatch_cmv_e4 ; sc -> schedule_load_page = uea_schedule_load_page_e4 ; sc -> stat = uea_stat_e4 ; sc -> send_cmvs = uea_send_cmvs_e4 ; INIT_WORK ( & sc -> task , uea_load_page_e4 ) ; } else { size = E1_INTR_PKT_SIZE ; sc -> dispatch_cmv = uea_dispatch_cmv_e1 ; sc -> schedule_load_page = uea_schedule_load_page_e1 ; sc -> stat = uea_stat_e1 ; sc -> send_cmvs = uea_send_cmvs_e1 ; INIT_WORK ( & sc -> task , uea_load_page_e1 ) ; } init_waitqueue_head ( & sc -> sync_q ) ; if ( UEA_CHIP_VERSION ( sc ) == ADI930 ) { load_XILINX_firmware ( sc ) ; } if ( intf -> cur_altsetting -> desc . bNumEndpoints < 1 ) { ret = - ENODEV ; err0 } intr = kmalloc ( size , GFP_KERNEL ) ; if ( ! intr ) { err0 } sc -> urb_int = usb_alloc_urb ( 0 , GFP_KERNEL ) ; if ( ! sc -> urb_int ) { err1 } usb_fill_int_urb ( sc -> urb_int , sc -> usb_dev , usb_rcvintpipe ( sc -> usb_dev , UEA_INTR_PIPE ) , intr , size , uea_intr , sc , intf -> cur_altsetting -> endpoint [ 0 ] . desc . bInterval ) ; ret = usb_submit_urb ( sc -> urb_int , GFP_KERNEL ) ; if ( ret < 0 ) { uea_err ( INS_TO_USBDEV ( sc ) , "urb submission failed with error %d\n" , ret ) ; err1 } sc -> kthread = kthread_create ( uea_kthread , sc , "ueagle-atm" ) ; if ( IS_ERR ( sc -> kthread ) ) { uea_err ( INS_TO_USBDEV ( sc ) , "failed to create thread\n" ) ; ret = PTR_ERR ( sc -> kthread ) ; err2 } uea_leaves ( INS_TO_USBDEV ( sc ) ) ; return 0 ; err2 usb_kill_urb ( sc -> urb_int ) ; err1 usb_free_urb ( sc -> urb_int ) ; sc -> urb_int = NULL ; err0 uea_leaves ( INS_TO_USBDEV ( sc ) ) ; return ret ; } 