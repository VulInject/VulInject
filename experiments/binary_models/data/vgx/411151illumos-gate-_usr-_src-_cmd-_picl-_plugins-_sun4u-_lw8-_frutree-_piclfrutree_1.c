static void update_disk_node ( struct lw8_disk * diskp ) { picl_nodehdl_t slotndh ; picl_nodehdl_t diskndh ; picl_nodehdl_t devhdl ; picl_prophdl_t tblhdl ; int err ; char path [ MAXPATHLEN ] ; char * fruname = diskp -> d_fruname ; sprintf_buf2 ( path , CHASSIS_LOC_PATH , fruname ) ; if ( ptree_get_node_by_path ( path , & slotndh ) != PICL_SUCCESS ) { return ; } diskndh = find_child_by_name ( slotndh , fruname ) ; err = ptree_get_node_by_path ( diskp -> d_plat_path , & devhdl ) ; if ( err == PICL_SUCCESS ) { err = ptree_create_and_add_node ( slotndh , fruname , PICL_CLASS_FRU , & diskndh ) ; if ( err != PICL_SUCCESS ) { syslog ( LOG_ERR , ADD_NODE_FAIL , fruname , err ) ; return ; } err = create_table ( diskndh , & tblhdl , PICL_PROP_DEVICES ) ; if ( err != PICL_SUCCESS ) { return ; } err = create_table_entry ( tblhdl , devhdl , PICL_CLASS_BLOCK ) ; if ( err != PICL_SUCCESS ) { return ; } err = add_prop_ref ( devhdl , diskndh , PICL_REFPROP_FRU_PARENT ) ; if ( err != PICL_SUCCESS ) { return ; } } else { if ( diskndh == 0 ) { return ; } err = ptree_delete_node ( diskndh ) ; if ( err != PICL_SUCCESS ) { return ; } ( void ) ptree_destroy_node ( diskndh ) ; } } 