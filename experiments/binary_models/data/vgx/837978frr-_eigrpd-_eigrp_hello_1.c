static struct eigrp_neighbor * eigrp_hello_parameter_decode ( struct eigrp_neighbor * nbr , struct eigrp_tlv_hdr_type * tlv ) { struct eigrp * eigrp = nbr -> ei -> eigrp ; struct TLV_Parameter_Type * param = ( TLV_Parameter_Type * ) tlv ; if ( tlv -> length < sizeof ( TLV_Parameter_Type ) ) { return NULL ; } nbr -> K1 = param -> K1 ; nbr -> K2 = param -> K2 ; nbr -> K3 = param -> K3 ; nbr -> K4 = param -> K4 ; nbr -> K5 = param -> K5 ; nbr -> K6 = param -> K6 ; nbr -> v_holddown = ntohs ( param -> hold_time ) ; if ( ( eigrp -> k_values [ 0 ] == nbr -> K1 ) && ( eigrp -> k_values [ 1 ] == nbr -> K2 ) && ( eigrp -> k_values [ 2 ] == nbr -> K3 ) && ( eigrp -> k_values [ 3 ] == nbr -> K4 ) && ( eigrp -> k_values [ 4 ] == nbr -> K5 ) ) { if ( eigrp_nbr_state_get ( nbr ) == EIGRP_NEIGHBOR_DOWN ) { zlog_info ( "Neighbor %pI4 (%s) is pending: new adjacency" , & nbr -> src , ifindex2ifname ( nbr -> ei -> ifp -> ifindex , eigrp -> vrf_id ) ) ; eigrp_hello_send ( nbr -> ei , EIGRP_HELLO_NORMAL , NULL ) ; eigrp_update_send_init ( nbr ) ; eigrp_nbr_state_set ( nbr , EIGRP_NEIGHBOR_PENDING ) ; } } else { if ( eigrp_nbr_state_get ( nbr ) != EIGRP_NEIGHBOR_DOWN ) { if ( ( param -> K1 & param -> K2 & param -> K3 & param -> K4 & param -> K5 ) == 255 ) { zlog_info ( "Neighbor %pI4 (%s) is down: Interface PEER-TERMINATION received" , & nbr -> src , ifindex2ifname ( nbr -> ei -> ifp -> ifindex , eigrp -> vrf_id ) ) ; eigrp_nbr_delete ( nbr , NULL ) ; return NULL ; } else { zlog_info ( "Neighbor %pI4 (%s) going down: Kvalue mismatch" , & nbr -> src , ifindex2ifname ( nbr -> ei -> ifp -> ifindex , eigrp -> vrf_id ) ) ; eigrp_nbr_state_set ( nbr , EIGRP_NEIGHBOR_DOWN ) ; } } } return nbr ; } 