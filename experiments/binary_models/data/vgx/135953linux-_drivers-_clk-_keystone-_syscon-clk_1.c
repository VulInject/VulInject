static struct clk_hw * ti_syscon_gate_clk_register ( struct device * dev , struct regmap * regmap , const struct ti_syscon_gate_clk_data * data ) { struct ti_syscon_gate_clk_priv * priv ; struct clk_init_data init ; int ret ; priv = devm_kzalloc ( dev , sizeof ( * priv ) , GFP_KERNEL ) ; init . name = data -> name ; init . ops = & ti_syscon_gate_clk_ops ; init . parent_names = NULL ; init . num_parents = 0 ; init . flags = 0 ; priv -> regmap = regmap ; priv -> reg = data -> offset ; priv -> idx = BIT ( data -> bit_idx ) ; priv -> hw . init = & init ; ret = devm_clk_hw_register ( dev , & priv -> hw ) ; if ( ret ) { return ERR_PTR ( ret ) ; } return & priv -> hw ; } 