static int test_addr_acq_recv_request ( size_t size , DHCPMessage * request ) { uint16_t udp_check = 0 ; uint8_t * msg_bytes = ( uint8_t * ) request ; int res ; res = dhcp_option_parse ( request , size , check_options , NULL , NULL ) ; assert_se ( res == DHCP_REQUEST ) ; assert_se ( xid == request -> xid ) ; assert_se ( msg_bytes [ size - 1 ] == SD_DHCP_OPTION_END ) ; if ( verbose ) { printf ( "  recv DHCP Request  0x%08x\n" , be32toh ( xid ) ) ; } memcpy ( & test_addr_acq_ack [ 26 ] , & udp_check , sizeof ( udp_check ) ) ; memcpy ( & test_addr_acq_ack [ 32 ] , & xid , sizeof ( xid ) ) ; memcpy ( & test_addr_acq_ack [ 56 ] , hw_addr . bytes , hw_addr . length ) ; res = write ( test_fd [ 1 ] , test_addr_acq_ack , sizeof ( test_addr_acq_ack ) ) ; assert_se ( res == sizeof ( test_addr_acq_ack ) ) ; if ( verbose ) { printf ( "  send DHCP Ack\n" ) ; } return 0 ; } 