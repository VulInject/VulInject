struct vm_struct * remove_vm_area ( const void * addr ) { struct vmap_area * va ; might_sleep ( ) ; va = find_vmap_area ( ( unsigned long ) addr ) ; if ( va && va -> flags & VM_VM_AREA ) { struct vm_struct * vm = va -> vm ; spin_lock ( & vmap_area_lock ) ; va -> vm = NULL ; va -> flags &= ~ VM_VM_AREA ; spin_unlock ( & vmap_area_lock ) ; vmap_debug_free_range ( va -> va_start , va -> va_end ) ; free_unmap_vmap_area ( va ) ; return vm ; } return NULL ; } 