int number ( char * * ptr , int * num ) { char holder [ 80 ] ; int i ; char * str = * ptr ; while ( isdigit ( * str ) && ( unsigned int ) ( i + 1 ) < sizeof holder ) { holder [ i ++ ] = * str ++ ; } if ( i == 0 ) { return ( 1 ) ; } holder [ i ] = '\0' ; if ( ( i = atoi ( holder ) ) <= 0 ) { return ( - 1 ) ; } * ptr = str ; * num = i ; return ( 0 ) ; } int property ( char * * ptr , char * * prop ) { char * str = * ptr ; char * dest = * prop ; int i = 0 ; while ( isalnum ( * str ) || * str == '-' || * str == '.' || * str == '=' || * str == '_' ) { dest [ i ++ ] = * str ++ ; } dest [ i ] = '\0' ; if ( * str == '/' ) { { str ++ ; } isdigit ( * str ) ; } * ptr = str ; return ( 0 ) ; } int proplist ( char * * str , std :: vector ( prop ) & plist , int * node_req , int * gpu_req , int * mic_req ) { char name_storage [ 80 ] ; char * pname ; char * pequal ; * node_req = 1 ; pname = name_storage ; * pname = '\0' ; for ( ; ; ) { if ( property ( str , & pname ) ) { return ( 1 ) ; } if ( * pname == '\0' ) { break ; } if ( ( pequal = strchr ( pname , ( int ) '=' ) ) != NULL ) { * pequal = '\0' ; if ( strcmp ( pname , "ppn" ) == 0 ) { pequal ++ ; if ( ( number ( & pequal , node_req ) != 0 ) || ( * pequal != '\0' ) ) { return ( 1 ) ; } } if ( strcmp ( pname , "mics" ) == 0 ) { pequal ++ ; if ( ( number ( & pequal , mic_req ) != PBSE_NONE ) || ( * pequal != '\0' ) ) { return ( 1 ) ; } } if ( strcmp ( pname , "gpus" ) == 0 ) { pequal ++ ; if ( ( number ( & pequal , gpu_req ) != 0 ) || ( * pequal != '\0' ) ) { return ( 1 ) ; } } else { return ( 1 ) ; } } else { prop p ( pname ) ; plist . push_back ( p ) ; } if ( * * str != ':' ) { break ; } ( * str ) ++ ; } return ( PBSE_NONE ) ; } 