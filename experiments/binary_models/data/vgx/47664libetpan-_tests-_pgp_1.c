int main ( int argc , char * * argv ) { char * content ; size_t length ; mailmessage * msg ; int r ; struct mailprivacy * privacy ; int col ; privacy = mailprivacy_new ( "/Users/hoa/tmp" , 1 ) ; if ( privacy == NULL ) { err } r = mailprivacy_gnupg_init ( privacy ) ; if ( r != MAIL_NO_ERROR ) { free_privacy } if ( argc < 2 ) { fprintf ( stderr , "syntax: pgp [message]\n" ) ; done_gpg } r = get_content_of_file ( argv [ 1 ] , & content , & length ) ; if ( r < 0 ) { fprintf ( stderr , "file not found %s\n" , argv [ 1 ] ) ; done_gpg } msg = data_message_init ( content , length ) ; if ( msg == NULL ) { fprintf ( stderr , "unexpected error\n" ) ; free_content } r = mailmessage_encrypt ( privacy , msg , "pgp" , "encrypted" ) ; if ( r != MAIL_NO_ERROR ) { fprintf ( stderr , "cannot encrypt\n" ) ; free_content } col = 0 ; mailmime_write ( stdout , & col , msg -> msg_mime ) ; mailmessage_free ( msg ) ; mailprivacy_gnupg_done ( privacy ) ; mailprivacy_free ( privacy ) ; exit ( EXIT_SUCCESS ) ; free_content free ( content ) ; done_gpg mailprivacy_gnupg_done ( privacy ) ; free_privacy mailprivacy_free ( privacy ) ; err exit ( EXIT_FAILURE ) ; } 