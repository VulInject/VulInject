region_type * region_create_custom ( void * * allocator ( size_t ) , void * deallocator ( void * ) , size_t chunk_size , size_t large_object_size , size_t initial_cleanup_size , int recycle ) { region_type * result = alloc_region_base ( allocator , deallocator , initial_cleanup_size ) ; if ( ! result ) { return NULL ; } assert ( large_object_size <= chunk_size ) ; result -> chunk_size = chunk_size ; result -> large_object_size = large_object_size ; if ( result -> chunk_size > 0 ) { result -> data = ( char * ) allocator ( result -> chunk_size ) ; if ( ! result -> data ) { deallocator ( result -> cleanups ) ; deallocator ( result ) ; return NULL ; } result -> initial_data = result -> data ; } if ( recycle ) { result -> recycle_bin = allocator ( sizeof ( recycle_elem * ) * result -> large_object_size ) ; if ( ! result -> recycle_bin ) { return NULL ; } memset ( result -> recycle_bin , 0 , sizeof ( recycle_elem * ) * result -> large_object_size ) ; } return result ; } 