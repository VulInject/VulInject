OM_uint32 generic_gss_oid_to_str ( minor_status , oid , oid_str ) OM_uint32 * minor_status ; const gss_OID oid ; gss_buffer_t oid_str ; { char numstr [ 128 ] ; OM_uint32 number ; int numshift ; OM_uint32 string_length ; OM_uint32 i ; unsigned char * cp ; char * bp ; if ( minor_status != NULL ) { * minor_status = 0 ; } if ( oid_str != GSS_C_NO_BUFFER ) { oid_str -> length = 0 ; oid_str -> value = NULL ; } if ( oid == GSS_C_NO_OID || oid -> length == 0 || oid -> elements == NULL ) { return ( GSS_S_CALL_INACCESSIBLE_READ ) ; } if ( oid_str == GSS_C_NO_BUFFER ) { return ( GSS_S_CALL_INACCESSIBLE_WRITE ) ; } string_length = 0 ; numshift = 0 ; cp = ( unsigned char * ) oid -> elements ; number = ( OM_uint32 ) cp [ 0 ] ; ( void ) sprintf ( numstr , "%d " , number / 40 ) ; string_length += strlen ( numstr ) ; ( void ) sprintf ( numstr , "%d " , number % 40 ) ; string_length += strlen ( numstr ) ; for ( i = 1 ; i < oid -> length ; i ++ ) { if ( ( OM_uint32 ) ( numshift + 7 ) < ( sizeof ( OM_uint32 ) * 8 ) ) { number = ( number << 7 ) | ( cp [ i ] & 0x7f ) ; numshift += 7 ; } else { return ( GSS_S_FAILURE ) ; } if ( ( cp [ i ] & 0x80 ) == 0 ) { ( void ) sprintf ( numstr , "%d " , number ) ; string_length += strlen ( numstr ) ; number = 0 ; numshift = 0 ; } } string_length += 4 ; if ( ( bp = ( char * ) malloc ( string_length ) ) ) { ( void ) strcpy ( bp , "{ " ) ; number = ( OM_uint32 ) cp [ 0 ] ; ( void ) sprintf ( numstr , "%d " , number / 40 ) ; ( void ) strcat ( bp , numstr ) ; ( void ) sprintf ( numstr , "%d " , number % 40 ) ; ( void ) strcat ( bp , numstr ) ; number = 0 ; cp = ( unsigned char * ) oid -> elements ; for ( i = 1 ; i < oid -> length ; i ++ ) { number = ( number << 7 ) | ( cp [ i ] & 0x7f ) ; if ( ( cp [ i ] & 0x80 ) == 0 ) { ( void ) sprintf ( numstr , "%d " , number ) ; ( void ) strcat ( bp , numstr ) ; number = 0 ; } } ( void ) strcat ( bp , "}" ) ; oid_str -> length = strlen ( bp ) + 1 ; oid_str -> value = ( void * ) bp ; return ( GSS_S_COMPLETE ) ; } return ( GSS_S_FAILURE ) ; } 