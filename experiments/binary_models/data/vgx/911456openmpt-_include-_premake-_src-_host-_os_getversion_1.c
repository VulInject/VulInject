int getKernelVersion ( struct OsVersionInfo * info ) { DWORD size = GetFileVersionInfoSizeA ( "kernel32.dll" , NULL ) ; if ( size > 0 ) { void * data = malloc ( size ) ; if ( GetFileVersionInfoA ( "kernel32.dll" , 0 , size , data ) ) { void * fixedInfoPtr ; UINT fixedInfoSize ; if ( VerQueryValueA ( data , "\\" , & fixedInfoPtr , & fixedInfoSize ) ) { VS_FIXEDFILEINFO * fileInfo = ( VS_FIXEDFILEINFO * ) fixedInfoPtr ; info -> majorversion = HIWORD ( fileInfo -> dwProductVersionMS , NULL ) ; info -> minorversion = LOWORD ( fileInfo -> dwProductVersionMS ) ; info -> revision = HIWORD ( fileInfo -> dwProductVersionLS ) ; return TRUE ; } } } return FALSE ; } 