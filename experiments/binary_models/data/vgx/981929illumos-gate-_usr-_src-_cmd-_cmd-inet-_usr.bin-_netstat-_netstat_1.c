static void tcp_report ( const mib_item_t * item ) { int jtemp = 0 ; boolean_t print_hdr_once_v4 = B_TRUE ; boolean_t print_hdr_once_v6 = B_TRUE ; mib2_tcpConnEntry_t * tp ; mib2_tcp6ConnEntry_t * tp6 ; mib2_transportMLPEntry_t * * v4_attrs , * * v6_attrs , * * v4a , * * v6a ; mib2_transportMLPEntry_t * aptr ; mib2_socketInfoEntry_t * * v4_info , * * v6_info , * * v4i , * * v6i ; mib2_socketInfoEntry_t * iptr ; if ( ! protocol_selected ( IPPROTO_TCP ) ) { return ; } v4_attrs = family_selected ( AF_INET ) && RSECflag ?gather_attrs ( item , MIB2_TCP , MIB2_TCP_CONN , tcpConnEntrySize ) : NULL ; v6_attrs = family_selected ( AF_INET6 ) && RSECflag ?gather_attrs ( item , MIB2_TCP6 , MIB2_TCP6_CONN , tcp6ConnEntrySize ) : NULL ; v4_info = Uflag && family_selected ( AF_INET ) ?gather_info ( item , MIB2_TCP , MIB2_TCP_CONN , tcpConnEntrySize ) : NULL ; v6_info = Uflag && family_selected ( AF_INET6 ) ?gather_info ( item , MIB2_TCP6 , MIB2_TCP6_CONN , tcp6ConnEntrySize ) : NULL ; v4a = v4_attrs ; v6a = v6_attrs ; v4i = v4_info ; v6i = v6_info ; for ( ; item != NULL ; item = item -> next_item ) { if ( Xflag ) { ( void ) printf ( "[%4d] Group = %d, mib_id = %d, " "length = %d, valp = 0x%p\n" , jtemp ++ , item -> group , item -> mib_id , item -> length , item -> valp ) ; } if ( ! ( ( item -> group == MIB2_TCP && item -> mib_id == MIB2_TCP_CONN ) || ( item -> group == MIB2_TCP6 && item -> mib_id == MIB2_TCP6_CONN ) ) ) { continue ; } if ( item -> group == MIB2_TCP && ! family_selected ( AF_INET ) ) { continue ; } if ( item -> group == MIB2_TCP6 && ! family_selected ( AF_INET6 ) ) { continue ; } if ( item -> group == MIB2_TCP ) { for ( tp = ( mib2_tcpConnEntry_t * ) item -> valp ; ( char * ) tp < ( char * ) item -> valp + item -> length ; tp = ( mib2_tcpConnEntry_t * ) ( ( char * ) tp + tcpConnEntrySize ) ) { aptr = v4a == NULL ?NULL : * v4a ++ ; iptr = v4i == NULL ?NULL : * v4i ++ ; print_hdr_once_v4 = tcp_report_item_v4 ( tp , print_hdr_once_v4 , aptr , iptr ) ; } } else { for ( tp6 = ( mib2_tcp6ConnEntry_t * ) item -> valp ; ( char * ) tp6 < ( char * ) item -> valp + item -> length ; tp6 = ( mib2_tcp6ConnEntry_t * ) ( ( char * ) tp6 + tcp6ConnEntrySize ) ) { aptr = v6a == NULL ?NULL : * v6a ++ ; iptr = v6i == NULL ?NULL : * v6i ++ ; print_hdr_once_v6 = tcp_report_item_v6 ( tp6 , print_hdr_once_v6 , aptr , iptr ) ; } } } ( void ) fflush ( stdout ) ; free ( v4_attrs ) ; free ( v6_attrs ) ; free ( v6_info ) ; } 