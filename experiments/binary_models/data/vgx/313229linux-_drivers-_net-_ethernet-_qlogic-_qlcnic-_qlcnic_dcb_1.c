static int qlcnic_dcb_cee_peer_get_pfc ( struct net_device * netdev , struct cee_pfc * pfc ) { struct qlcnic_adapter * adapter = netdev_priv ( netdev ) ; struct qlcnic_dcb_cfg * cfg = adapter -> dcb -> cfg ; struct qlcnic_dcb_tc_cfg * tc ; struct qlcnic_dcb_cee * peer ; u8 i , setting , prio ; pfc -> pfc_en = 0 ; if ( ! test_bit ( QLCNIC_DCB_STATE , & adapter -> dcb -> state ) ) { return 0 ; } peer = & cfg -> type [ QLC_DCB_PEER_IDX ] ; for ( i = 0 ; i < QLC_DCB_MAX_TC ; i ++ ) { tc = & peer -> tc_cfg [ i ] ; prio = qlcnic_dcb_prio_count ( tc -> up_tc_map ) ; qlcnic_dcb_get_pfc_cfg ( netdev , prio , & setting ) ; if ( setting ) { pfc -> pfc_en |= QLC_DCB_GET_MAP ( i ) ; } } pfc -> tcs_supported = cfg -> capability . max_pfc_tc ; return 0 ; } 