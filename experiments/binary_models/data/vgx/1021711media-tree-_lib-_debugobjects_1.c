void debug_object_active_state ( void * addr , struct debug_obj_descr * descr , unsigned int expect , unsigned int next ) { struct debug_bucket * db ; struct debug_obj * obj ; unsigned long flags ; db = get_bucket ( ( unsigned long ) addr ) ; raw_spin_lock_irqsave ( & db -> lock , flags ) ; obj = lookup_object ( addr , db ) ; if ( obj ) { switch ( obj -> state ) { case ODEBUG_STATE_ACTIVE : if ( obj -> astate == expect ) { obj -> astate = next ; } else { debug_print_object ( obj , "active_state" ) ; } break ; default : debug_print_object ( obj , "active_state" ) ; break ; } } else { struct debug_obj o = { . object = addr . state = ODEBUG_STATE_NOTAVAILABLE . descr = descr } ; debug_print_object ( & o , "active_state" ) ; } raw_spin_unlock_irqrestore ( & db -> lock , flags ) ; } 