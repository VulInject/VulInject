int ft_board_setup ( void * blob , struct bd_info * bd ) { int i ; u16 mc_memory_bank = 0 ; u64 * base ; u64 * size ; int mc_memory_base = 0 ; u64 mc_memory_size = 0 ; u16 total_memory_banks ; debug ( "%s blob=0x%p\n" , __func__ , blob ) ; ft_cpu_setup ( blob , bd ) ; fdt_fixup_mc_ddr ( & mc_memory_base , & mc_memory_size ) ; if ( mc_memory_base != 0 ) { mc_memory_bank ++ ; } total_memory_banks = CONFIG_NR_DRAM_BANKS + mc_memory_bank ; base = calloc ( total_memory_banks , sizeof ( u64 ) ) ; size = calloc ( total_memory_banks , sizeof ( u64 ) ) ; for ( i = 0 ; i < CONFIG_NR_DRAM_BANKS ; i ++ ) { base [ i ] = gd -> bd -> bi_dram [ i ] . start ; size [ i ] = gd -> bd -> bi_dram [ i ] . size ; if ( IS_ENABLED ( CONFIG_RESV_RAM ) && RESV_MEM_IN_BANK ( i ) ) { size [ i ] = gd -> arch . resv_ram - base [ i ] ; } } if ( mc_memory_base != 0 ) { for ( i = 0 ; i <= total_memory_banks ; i ++ ) { if ( base [ i ] == 0 && size [ i ] == 0 ) { base [ i ] = mc_memory_base ; size [ i ] = mc_memory_size ; break ; } } } fdt_fixup_memory_banks ( blob , base , size , total_memory_banks ) ; fdt_fsl_mc_fixup_iommu_map_entry ( blob ) ; if ( IS_ENABLED ( CONFIG_FSL_MC_ENET ) ) { fdt_fixup_board_enet ( blob ) ; } fdt_fixup_icid ( blob ) ; return 0 ; } 