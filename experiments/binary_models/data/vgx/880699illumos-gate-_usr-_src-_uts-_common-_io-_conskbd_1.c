static void conskbd_mux_dequeue_msg ( conskbd_pending_msg_t * msg ) { conskbd_pending_msg_t * prev ; conskbd_pending_msg_t * p ; mutex_enter ( & conskbd_msgq_lock ) ; prev = conskbd_msg_queue ; for ( p = prev ; p && p != msg ; p = p -> kpm_next ) { prev = p ; } ASSERT ( p && p == msg ) ; if ( prev == p ) { conskbd_msg_queue = msg -> kpm_next ; } else { prev -> kpm_next = p -> kpm_next ; } mutex_exit ( & conskbd_msgq_lock ) ; } 