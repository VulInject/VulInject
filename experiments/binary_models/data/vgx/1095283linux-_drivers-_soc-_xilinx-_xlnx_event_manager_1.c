static int xlnx_event_manager_remove ( struct platform_device * pdev ) { int i ; struct registered_event_data * eve_data ; struct hlist_node * tmp ; int ret ; struct agent_cb * cb_pos ; struct agent_cb * cb_next ; hash_for_each_safe ( , , , , ) { list_for_each_entry_safe ( , , , ) { list_del_init ( & cb_pos -> list ) ; } hash_del ( & eve_data -> hentry ) ; kfree ( eve_data ) ; } ret = zynqmp_pm_register_sgi ( 0 , 1 ) ; if ( ret ) { dev_err ( & pdev -> dev , "SGI unregistration over TF-A failed with %d\n" , ret ) ; } xlnx_event_cleanup_sgi ( pdev ) ; event_manager_availability = - EACCES ; return ret ; } 