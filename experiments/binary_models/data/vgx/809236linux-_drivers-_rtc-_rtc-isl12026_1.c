static int isl12026_rtc_set_time ( struct device * dev , struct rtc_time * tm ) { struct i2c_client * client = to_i2c_client ( dev ) ; int ret ; u8 op [ 10 ] ; struct i2c_msg msg = { . addr = client -> addr . flags = 0 . len = sizeof ( op ) . buf = op } ; ret = isl12026_arm_write ( client ) ; op [ 0 ] = 0 ; op [ 1 ] = ISL12026_REG_SC ; op [ 2 ] = bin2bcd ( tm -> tm_sec ) ; op [ 3 ] = bin2bcd ( tm -> tm_min ) ; op [ 4 ] = bin2bcd ( tm -> tm_hour ) | ISL12026_REG_HR_MIL ; op [ 5 ] = bin2bcd ( tm -> tm_mday ) ; op [ 6 ] = bin2bcd ( tm -> tm_mon + 1 ) ; op [ 7 ] = bin2bcd ( tm -> tm_year % 100 ) ; op [ 8 ] = bin2bcd ( tm -> tm_wday & 7 ) ; op [ 9 ] = bin2bcd ( tm -> tm_year >= 100 ?20 : 19 ) ; ret = i2c_transfer ( client -> adapter , & msg , 1 ) ; if ( ret != 1 ) { dev_err ( & client -> dev , "write error CCR, ret=%d\n" , ret ) ; ret = ret < 0 ?ret : - EIO ; out } ret = isl12026_disarm_write ( client ) ; out return ret ; } 