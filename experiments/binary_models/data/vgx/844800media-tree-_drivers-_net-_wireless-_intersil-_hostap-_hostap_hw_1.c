static void prism2_transmit_cb ( struct net_device * dev , long context , u16 resp0 , u16 res ) { struct hostap_interface * iface ; local_info_t * local ; int idx = ( int ) context ; iface = netdev_priv ( dev ) ; local = iface -> local ; if ( res ) { printk ( KERN_DEBUG "%s: prism2_transmit_cb - res=0x%02x\n" , dev -> name , res ) ; return ; } if ( idx < 0 || idx >= PRISM2_TXFID_COUNT ) { printk ( KERN_DEBUG "%s: prism2_transmit_cb called with invalid " "idx=%d\n" , dev -> name , idx ) ; return ; } if ( ! test_and_clear_bit ( HOSTAP_BITS_TRANSMIT , & local -> bits ) ) { printk ( KERN_DEBUG "%s: driver bug: prism2_transmit_cb called " "with no pending transmit\n" , dev -> name ) ; } if ( netif_queue_stopped ( dev ) ) { netif_wake_queue ( dev ) ; } spin_lock ( & local -> txfidlock ) ; local -> intransmitfid [ idx ] = resp0 ; PDEBUG ( DEBUG_FID , "%s: prism2_transmit_cb: txfid[%d]=0x%04x, " "resp0=0x%04x, transmit_txfid=0x%04x\n" , dev -> name , idx , local -> txfid [ idx ] , resp0 , local -> intransmitfid [ local -> next_txfid ] ) ; idx ++ ; if ( idx >= PRISM2_TXFID_COUNT ) { idx = 0 ; } local -> next_txfid = idx ; { if ( local -> intransmitfid [ idx ] == PRISM2_TXFID_EMPTY ) { spin_unlock ( & local -> txfidlock ) ; return ; } idx ++ ; if ( idx >= PRISM2_TXFID_COUNT ) { idx = 0 ; } } idx != local -> next_txfid ; spin_unlock ( & local -> txfidlock ) ; netif_stop_queue ( dev , NULL ) ; } 