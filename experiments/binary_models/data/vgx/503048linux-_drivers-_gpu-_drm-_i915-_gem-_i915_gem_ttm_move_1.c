static void __memcpy_work ( struct work_struct * work ) { struct i915_ttm_memcpy_work * copy_work = container_of ( work , typeof ( * copy_work ) , work ) ; struct i915_ttm_memcpy_arg * arg = & copy_work -> arg ; bool cookie ; if ( ! copy_work -> memcpy_allowed ) { struct intel_gt * gt ; unsigned int id ; for_each_gt ( , , ) intel_gt_set_wedged ( gt ) ; } cookie = dma_fence_begin_signalling ( ) ; if ( copy_work -> memcpy_allowed ) { i915_ttm_move_memcpy ( arg ) ; } else { copy_work -> obj -> mm . unknown_state = true ; } dma_fence_end_signalling ( cookie ) ; dma_fence_signal ( & copy_work -> fence ) ; i915_gem_object_put ( copy_work -> obj ) ; dma_fence_put ( & copy_work -> fence ) ; } 