int ext4fs_read_inode ( struct ext2_data * data , int ino , struct ext2_inode * inode ) { struct ext2_block_group * blkgrp ; struct ext2_sblock * sblock = & data -> sblock ; struct ext_filesystem * fs = get_fs ( ) ; int log2blksz = get_fs ( ) -> dev_desc -> log2blksz ; int inodes_per_block , status ; long int blkno ; unsigned int blkoff ; blkgrp = zalloc ( get_fs ( ) -> gdsize ) ; if ( ! blkgrp ) { return 0 ; } ino -- ; if ( le32_to_cpu ( sblock -> inodes_per_group ) == 0 || fs -> inodesz == 0 ) { return 0 ; } status = ext4fs_blockgroup ( data , ino / le32_to_cpu ( sblock -> inodes_per_group ) , blkgrp ) ; if ( status == 0 ) { free ( blkgrp ) ; return 0 ; } inodes_per_block = EXT2_BLOCK_SIZE ( data ) / fs -> inodesz ; if ( inodes_per_block == 0 ) { free ( blkgrp ) ; return 0 ; } blkno = ext4fs_bg_get_inode_table_id ( blkgrp , fs ) + ( ino % le32_to_cpu ( sblock -> inodes_per_group ) ) / inodes_per_block ; blkoff = ( ino % inodes_per_block ) * fs -> inodesz ; free ( blkgrp ) ; status = ext4fs_devread ( ( lbaint_t ) blkno << ( LOG2_BLOCK_SIZE ( data ) - log2blksz ) , blkoff , sizeof ( ext2_inode ) , ( char * ) inode ) ; if ( status == 0 ) { return 0 ; } return 1 ; } 