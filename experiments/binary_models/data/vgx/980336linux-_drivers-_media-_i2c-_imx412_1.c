static int imx412_update_exp_gain ( struct imx412 * imx412 , u32 exposure , u32 gain ) { u32 lpfr , shutter ; int ret ; lpfr = imx412 -> vblank + imx412 -> cur_mode -> height ; shutter = lpfr - exposure ; dev_dbg ( imx412 -> dev , "Set exp %u, analog gain %u, shutter %u, lpfr %u" , exposure , gain , shutter , lpfr ) ; ret = imx412_write_reg ( imx412 , IMX412_REG_HOLD , 1 , 1 ) ; ret = imx412_write_reg ( imx412 , IMX412_REG_LPFR , 2 , lpfr ) ; if ( ret ) { error_release_group_hold } ret = imx412_write_reg ( imx412 , IMX412_REG_EXPOSURE_CIT , 2 , shutter ) ; if ( ret ) { error_release_group_hold } ret = imx412_write_reg ( imx412 , IMX412_REG_AGAIN , 2 , gain ) ; error_release_group_hold imx412_write_reg ( imx412 , IMX412_REG_HOLD , 1 , 0 ) ; return ret ; } 