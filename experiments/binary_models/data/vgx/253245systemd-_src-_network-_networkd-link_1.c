static int link_update_master ( Link * link , sd_netlink_message * message ) { int master_ifindex , r ; assert ( link ) ; assert ( message ) ; r = sd_netlink_message_read_u32 ( message , IFLA_MASTER , ( uint32_t * ) & master_ifindex ) ; if ( r == - ENODATA ) { return 0 ; } if ( r < 0 ) { return log_link_debug_errno ( link , r , "rtnl: failed to read master ifindex: %m" ) ; } if ( master_ifindex == link -> ifindex ) { master_ifindex = 0 ; } if ( master_ifindex == link -> master_ifindex ) { return 0 ; } if ( link -> master_ifindex == 0 ) { log_link_debug ( link , "Attached to master interface: %i" , master_ifindex ) ; } if ( master_ifindex == 0 ) { log_link_debug ( link , "Detached from master interface: %i" , link -> master_ifindex ) ; } else { log_link_debug ( link , "Master interface changed: %i %s %i" , link -> master_ifindex , special_glyph ( SPECIAL_GLYPH_ARROW_RIGHT ) , master_ifindex ) ; } link_drop_from_master ( link , NULL ) ; link -> master_ifindex = master_ifindex ; r = link_append_to_master ( link ) ; if ( r < 0 ) { return log_link_debug_errno ( link , r , "Failed to append link to master: %m" ) ; } return 0 ; } 