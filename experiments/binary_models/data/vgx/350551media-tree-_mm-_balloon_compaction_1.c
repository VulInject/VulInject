struct page * balloon_page_enqueue ( struct balloon_dev_info * b_dev_info ) { unsigned long flags ; struct page * page = alloc_page ( balloon_mapping_gfp_mask ( ) | __GFP_NOMEMALLOC | __GFP_NORETRY ) ; if ( ! page ) { return in ; } BUG_ON ( ! trylock_page ( page ) ) ; spin_lock_irqsave ( & b_dev_info -> pages_lock , flags ) ; balloon_page_insert ( b_dev_info , page ) ; __count_vm_event ( BALLOON_INFLATE ) ; spin_unlock_irqrestore ( & b_dev_info -> pages_lock , flags ) ; unlock_page ( page ) ; return page ; } 