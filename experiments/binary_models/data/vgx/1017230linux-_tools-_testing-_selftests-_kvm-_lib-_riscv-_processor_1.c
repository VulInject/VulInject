void riscv_vcpu_mmu_setup ( struct kvm_vcpu * vcpu ) { struct kvm_vm * vm = vcpu -> vm ; cfs_time_t satp ; switch ( vm -> mode ) { case VM_MODE_P52V48_4K : case VM_MODE_P48V48_4K : case VM_MODE_P40V48_4K : break ; default : TEST_FAIL ( "Unknown guest mode, mode: 0x%x" , vm -> mode ) ; } satp = ( vm -> pgd >> PGTBL_PAGE_SIZE_SHIFT ) & SATP_PPN ; satp |= SATP_MODE_48 ; vcpu_set_reg ( vcpu , RISCV_CSR_REG ( satp ) , satp ) ; } 