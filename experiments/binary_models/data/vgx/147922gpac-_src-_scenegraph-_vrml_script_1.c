void Script_PreDestroy ( GF_Node * node , void * eff , Bool is_destroy ) { GF_ScriptPriv * priv ; if ( ! is_destroy ) { return ; } priv = ( GF_ScriptPriv * ) node -> sgprivate -> UserPrivate ; if ( priv -> JS_PreDestroy ) { priv -> JS_PreDestroy ( node ) ; } while ( gf_list_count ( priv -> fields ) ) { GF_ScriptField * field = ( GF_ScriptField * ) gf_list_get ( priv -> fields , 0 ) ; gf_list_rem ( priv -> fields , 0 ) ; if ( field -> pField ) { switch ( field -> fieldType ) { case GF_SG_VRML_SFNODE : gf_node_unregister ( ( GF_Node * ) field -> pField , node ) ; break ; case GF_SG_VRML_MFNODE : gf_node_unregister_children ( node , ( GF_ChildNodeItem * ) field -> pField ) ; break ; default : gf_sg_vrml_field_pointer_del ( field -> pField , field -> fieldType ) ; break ; } } if ( field -> name ) { gf_free ( field -> name ) ; } gf_free ( field ) ; } gf_list_del ( priv -> fields , NULL ) ; gf_free ( priv ) ; } 