static int userauth_pubkey ( struct ssh * ssh ) { Authctxt * authctxt = ( Authctxt * ) ssh -> authctxt ; Identity * id ; int sent = 0 ; char * ident ; while ( ( id = TAILQ_FIRST ( & authctxt -> keys ) ) ) { if ( id -> tried ++ ) { return ( 0 ) ; } TAILQ_REMOVE ( & authctxt -> keys , id , next ) ; TAILQ_INSERT_TAIL ( & authctxt -> keys , id , next ) ; if ( id -> key != NULL ) { if ( id -> key != NULL ) { ident = format_identity ( id ) ; debug ( "Offering public key: %s" , ident ) ; sent = send_pubkey_test ( ssh , id ) ; } } else { debug ( "Trying private key: %s" , id -> filename ) ; id -> key = load_identity_file ( id ) ; if ( id -> key != NULL ) { if ( id -> key != NULL ) { id -> isprivate = 1 ; sent = sign_and_send_pubkey ( ssh , id ) ; } sshkey_free ( id -> key ) ; id -> key = NULL ; id -> isprivate = 0 ; } } if ( sent ) { return ( sent ) ; } } return ( 0 ) ; } 