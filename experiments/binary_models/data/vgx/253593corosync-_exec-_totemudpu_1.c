int totemudpu_finalize ( void * udpu_context ) { struct totemudpu_instance * instance = ( totemudpu_instance * ) udpu_context ; int res = 0 ; if ( instance -> token_socket > 0 ) { qb_loop_poll_del ( instance -> totemudpu_poll_handle , instance -> token_socket ) ; close ( instance -> token_socket ) ; } if ( instance -> local_loop_sock [ 0 ] > 0 ) { qb_loop_poll_del ( instance -> totemudpu_poll_handle , instance -> local_loop_sock [ 0 ] ) ; close ( instance -> local_loop_sock [ 0 ] ) ; close ( instance -> local_loop_sock [ 1 ] ) ; } totemudpu_stop_merge_detect_timeout ( instance , NULL ) ; return ( res ) ; } 