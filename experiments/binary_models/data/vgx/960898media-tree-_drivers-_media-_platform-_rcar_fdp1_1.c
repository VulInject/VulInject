static void fdp1_m2m_device_run ( void * priv ) { struct fdp1_ctx * ctx = priv ; struct fdp1_dev * fdp1 = ctx -> fdp1 ; struct vb2_v4l2_buffer * src_vb ; struct fdp1_buffer * buf ; unsigned int i ; dprintk ( fdp1 , "+\n" ) ; ctx -> translen = 0 ; src_vb = v4l2_m2m_src_buf_remove ( ctx -> fh . m2m_ctx ) ; buf = to_fdp1_buffer ( src_vb ) ; for ( i = 0 ; i < buf -> num_fields ; i ++ ) { struct fdp1_field_buffer * fbuf = & buf -> fields [ i ] ; fdp1_queue_field ( ctx , fbuf ) ; dprintk ( fdp1 , "Queued Buffer [%d] last_field:%d\n" , i , fbuf -> last_field ) ; } while ( fdp1_prepare_job ( ctx ) ) { } if ( ctx -> translen == 0 ) { dprintk ( fdp1 , "No jobs were processed. M2M action complete\n" ) ; v4l2_m2m_job_finish ( fdp1 -> m2m_dev , ctx -> fh . m2m_ctx ) ; return ; } fdp1_device_process ( ctx , NULL ) ; } 