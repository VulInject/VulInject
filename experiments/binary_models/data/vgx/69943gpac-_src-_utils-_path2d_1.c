GF_Err gf_path_close ( GF_Path * gp ) { Fixed diff ; GF_Point2D start , end ; if ( gp -> n_contours <= 1 ) { start = gp -> points [ 0 ] ; } else { start = gp -> points [ gp -> contours [ gp -> n_contours - 2 ] + 1 ] ; } end = gp -> points [ gp -> n_points - 1 ] ; end . x -= start . x ; end . y -= start . y ; diff = gf_mulfix ( end . x , end . x ) + gf_mulfix ( end . y , end . y ) ; if ( ABS ( diff ) > FIX_ONE / 1000 ) { GF_Err e = gf_path_add_line_to ( gp , start . x , start . y ) ; if ( e ) { return e ; } } gp -> tags [ gp -> n_points - 1 ] = GF_PATH_CLOSE ; return GF_OK ; } 