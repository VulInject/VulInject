static int bnx2i_process_login_resp ( struct iscsi_session * session , struct bnx2i_conn * bnx2i_conn , struct cqe * cqe ) { struct iscsi_conn * conn = bnx2i_conn -> cls_conn -> dd_data ; struct iscsi_task * task ; struct bnx2i_login_response * login ; struct iscsi_login_rsp * resp_hdr ; int pld_len ; int pad_len ; login = ( bnx2i_login_response * ) cqe ; spin_lock ( & session -> back_lock ) ; task = iscsi_itt_to_task ( conn , login -> itt & ISCSI_LOGIN_RESPONSE_INDEX ) ; if ( ! task ) { done } resp_hdr = ( iscsi_login_rsp * ) & bnx2i_conn -> gen_pdu . resp_hdr ; resp_hdr -> opcode = login -> op_code ; resp_hdr -> flags = login -> response_flags ; resp_hdr -> max_version = login -> version_max ; resp_hdr -> active_version = login -> version_active ; resp_hdr -> hlength = 0 ; hton24 ( resp_hdr -> dlength , login -> data_length ) ; memcpy ( resp_hdr -> isid , & login -> isid_lo , 6 ) ; resp_hdr -> tsih = cpu_to_be16 ( login -> tsih ) ; resp_hdr -> itt = task -> hdr -> itt ; resp_hdr -> statsn = cpu_to_be32 ( login -> stat_sn ) ; resp_hdr -> exp_cmdsn = cpu_to_be32 ( login -> exp_cmd_sn ) ; resp_hdr -> max_cmdsn = cpu_to_be32 ( login -> max_cmd_sn ) ; resp_hdr -> status_class = login -> status_class ; resp_hdr -> status_detail = login -> status_detail ; pld_len = login -> data_length ; bnx2i_conn -> gen_pdu . resp_wr_ptr = bnx2i_conn -> gen_pdu . resp_buf + pld_len ; pad_len = 0 ; if ( pld_len & 0x3 ) { pad_len = 4 - ( pld_len % 4 ) ; } if ( pad_len ) { int i = 0 ; for ( i = 0 ; i < pad_len ; i ++ ) { bnx2i_conn -> gen_pdu . resp_wr_ptr [ 0 ] = 0 ; bnx2i_conn -> gen_pdu . resp_wr_ptr ++ ; } } __iscsi_complete_pdu ( conn , ( iscsi_hdr * ) resp_hdr , bnx2i_conn -> gen_pdu . resp_buf , bnx2i_conn -> gen_pdu . resp_wr_ptr - bnx2i_conn -> gen_pdu . resp_buf ) ; done spin_unlock ( & session -> back_lock ) ; return 0 ; } 