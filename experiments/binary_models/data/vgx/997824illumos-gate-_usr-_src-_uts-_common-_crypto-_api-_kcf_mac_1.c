int crypto_mac_verify_prov ( crypto_provider_t provider , crypto_session_id_t sid , crypto_mechanism_t * mech , crypto_data_t * data , crypto_key_t * key , crypto_ctx_template_t tmpl , crypto_data_t * mac , crypto_call_req_t * crq ) { kcf_req_params_t params ; kcf_provider_desc_t * pd = provider ; kcf_provider_desc_t * real_provider = pd ; int rv ; ASSERT ( KCF_PROV_REFHELD ( pd ) ) ; if ( pd -> pd_prov_type == CRYPTO_LOGICAL_PROVIDER ) { rv = kcf_get_hardware_provider ( mech -> cm_type , key , CRYPTO_MECH_INVALID , NULL , pd , & real_provider , CRYPTO_FG_MAC_ATOMIC ) ; } KCF_WRAP_MAC_OPS_PARAMS ( & params , KCF_OP_MAC_VERIFY_ATOMIC , sid , mech , key , data , mac , tmpl ) ; rv = kcf_submit_request ( real_provider , NULL , crq , & params , B_FALSE ) ; if ( pd -> pd_prov_type == CRYPTO_LOGICAL_PROVIDER ) { KCF_PROV_REFRELE ( real_provider ) ; } return ( rv ) ; } 