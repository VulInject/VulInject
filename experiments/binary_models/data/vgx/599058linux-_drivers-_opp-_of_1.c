static int opp_parse_supplies ( struct dev_pm_opp * opp , struct device * dev , struct opp_table * opp_table ) { u32 * microvolt , * microamp , * microwatt ; int ret = 0 , i , j ; bool triplet ; microvolt = opp_parse_microvolt ( opp , dev , opp_table , & triplet ) ; if ( IS_ERR ( microvolt ) ) { return PTR_ERR ( microvolt ) ; } microamp = _parse_named_prop ( opp , dev , opp_table , "microamp" , NULL ) ; if ( IS_ERR ( microamp ) ) { ret = PTR_ERR ( microamp ) ; free_microvolt } microwatt = _parse_named_prop ( opp , dev , opp_table , "microwatt" , NULL ) ; if ( IS_ERR ( microwatt ) ) { ret = PTR_ERR ( microwatt ) ; free_microamp } if ( unlikely ( opp_table -> regulator_count == - 1 ) ) { return 0 ; } for ( i = 0 , j = 0 ; i < opp_table -> regulator_count ; i ++ ) { if ( microvolt ) { opp -> supplies [ i ] . u_volt = microvolt [ j ++ ] ; if ( triplet ) { opp -> supplies [ i ] . u_volt_min = microvolt [ j ++ ] ; opp -> supplies [ i ] . u_volt_max = microvolt [ j ++ ] ; } else { opp -> supplies [ i ] . u_volt_min = opp -> supplies [ i ] . u_volt ; opp -> supplies [ i ] . u_volt_max = opp -> supplies [ i ] . u_volt ; } } if ( microamp ) { opp -> supplies [ i ] . u_amp = microamp [ i ] ; } if ( microwatt ) { opp -> supplies [ i ] . u_watt = microwatt [ i ] ; } } kfree ( microwatt ) ; free_microamp kfree ( microamp ) ; free_microvolt kfree ( microvolt ) ; return ret ; } 