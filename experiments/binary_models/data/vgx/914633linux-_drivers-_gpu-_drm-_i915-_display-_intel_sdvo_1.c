static void intel_sdvo_get_dtd_from_mode ( struct intel_sdvo_dtd * dtd , const struct drm_display_mode * mode ) { u16 width , height ; u16 h_blank_len , h_sync_len , v_blank_len , v_sync_len ; u16 h_sync_offset , v_sync_offset ; int mode_clock ; width = mode -> hdisplay ; height = mode -> vdisplay ; h_blank_len = mode -> htotal - mode -> hdisplay ; h_sync_len = mode -> hsync_end - mode -> hsync_start ; v_blank_len = mode -> vtotal - mode -> vdisplay ; v_sync_len = mode -> vsync_end - mode -> vsync_start ; h_sync_offset = mode -> hsync_start - mode -> hdisplay ; v_sync_offset = mode -> vsync_start - mode -> vdisplay ; mode_clock = mode -> clock ; mode_clock /= 10 ; dtd -> part1 . clock = mode_clock ; dtd -> part1 . h_active = width & 0xff ; dtd -> part1 . h_blank = h_blank_len & 0xff ; dtd -> part1 . h_high = ( ( ( width >> 8 ) & 0xf ) << 4 ) | ( ( h_blank_len >> 8 ) & 0xf ) ; dtd -> part1 . v_active = height & 0xff ; dtd -> part1 . v_blank = v_blank_len & 0xff ; dtd -> part1 . v_high = ( ( ( height >> 8 ) & 0xf ) << 4 ) | ( ( v_blank_len >> 8 ) & 0xf ) ; dtd -> part2 . h_sync_off = h_sync_offset & 0xff ; dtd -> part2 . h_sync_width = h_sync_len & 0xff ; dtd -> part2 . v_sync_off_width = ( v_sync_offset & 0xf ) << 4 | ( v_sync_len & 0xf ) ; dtd -> part2 . sync_off_width_high = ( ( h_sync_offset & 0x300 ) >> 2 ) | ( ( h_sync_len & 0x300 ) >> 4 ) | ( ( v_sync_offset & 0x30 ) >> 2 ) | ( ( v_sync_len & 0x30 ) >> 4 ) ; dtd -> part2 . dtd_flags = 0x18 ; if ( mode -> flags & DRM_MODE_FLAG_INTERLACE ) { dtd -> part2 . dtd_flags |= DTD_FLAG_INTERLACE ; } if ( mode -> flags & DRM_MODE_FLAG_PHSYNC ) { dtd -> part2 . dtd_flags |= DTD_FLAG_HSYNC_POSITIVE ; } if ( mode -> flags & DRM_MODE_FLAG_PVSYNC ) { dtd -> part2 . dtd_flags |= DTD_FLAG_VSYNC_POSITIVE ; } dtd -> part2 . v_sync_off_high = v_sync_offset & 0xc0 ; } 