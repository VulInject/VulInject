int smb_config_setstr ( smb_cfg_id_t id , char * value ) { smb_scfhandle_t * handle ; smb_cfg_param_t * cfg ; int rc = SMBD_SMF_OK ; boolean_t protected ; char * tmp = NULL ; char * pg ; cfg = smb_config_getent ( id ) ; assert ( cfg -> sc_type == SCF_TYPE_ASTRING ) ; if ( id == SMB_CI_ADS_SITE ) { return ( smb_config_set_idmap_site_name ( value ) ) ; } if ( id == SMB_CI_DOMAIN_SRV ) { return ( smb_config_set_idmap_preferred_dc ( value ) ) ; } protected = B_FALSE ; switch ( cfg -> sc_flags ) { case SMB_CF_PROTECTED : protected = B_TRUE ; pg = SMBD_PROTECTED_PG_NAME ; break ; case SMB_CF_EXEC : pg = SMBD_EXEC_PG_NAME ; break ; default : pg = SMBD_PG_NAME ; break ; } handle = smb_smf_scf_init ( SMBD_FMRI_PREFIX ) ; if ( handle == NULL ) { return ( SMBD_SMF_SYSTEM_ERR ) ; } rc = smb_smf_create_service_pgroup ( handle , pg ) ; if ( rc == SMBD_SMF_OK ) { rc = smb_smf_start_transaction ( handle ) ; } if ( rc != SMBD_SMF_OK ) { smb_smf_scf_fini ( handle ) ; return ( rc ) ; } if ( protected && value && ( * value != '\0' ) ) { if ( ( tmp = smb_base64_encode ( value ) ) == NULL ) { ( void ) smb_smf_end_transaction ( handle ) ; smb_smf_scf_fini ( handle ) ; return ( SMBD_SMF_NO_MEMORY ) ; } value = tmp ; } rc = smb_smf_set_string_property ( handle , cfg -> sc_name , value ) ; ( void ) smb_smf_end_transaction ( handle ) ; smb_smf_scf_fini ( handle ) ; return ( rc ) ; } 