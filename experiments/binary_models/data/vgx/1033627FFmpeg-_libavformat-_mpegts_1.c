static AVBufferRef * buffer_pool_get ( MpegTSContext * ts , int size ) { int index = av_log2 ( size + AV_INPUT_BUFFER_PADDING_SIZE ) ; if ( ! ts -> pools [ index ] ) { int pool_size = FFMIN ( ts -> max_packet_size + AV_INPUT_BUFFER_PADDING_SIZE , 2 << index ) ; ts -> pools [ index ] = av_buffer_pool_init ( pool_size , NULL ) ; if ( ! ts -> pools [ index ] ) { return in ; } } return av_buffer_pool_get ( ts -> pools [ index ] ) ; } 