static int si2157_load_firmware ( struct dvb_frontend * fe , const char * fw_name ) { struct i2c_client * client = fe -> tuner_priv ; const struct firmware * fw ; int ret , len , remaining ; struct si2157_cmd cmd ; ret = firmware_request_nowarn ( & fw , fw_name , & client -> dev ) ; if ( ret ) { return ret ; } if ( fw -> size % 17 != 0 ) { dev_err ( & client -> dev , "firmware file '%s' is invalid\n" , fw_name ) ; ret = - EINVAL ; err_release_firmware } dev_info ( & client -> dev , "downloading firmware from file '%s'\n" , fw_name ) ; for ( remaining = fw -> size ; remaining > 0 ; remaining -= 17 ) { len = fw -> data [ fw -> size - remaining ] ; if ( len > SI2157_ARGLEN ) { dev_err ( & client -> dev , "Bad firmware length\n" ) ; ret = - EINVAL ; err_release_firmware } memcpy ( cmd . args , & fw -> data [ ( fw -> size - remaining ) + 1 ] , len ) ; cmd . wlen = len ; ret = si2157_cmd_execute ( client , & cmd ) ; if ( ret ) { dev_err ( & client -> dev , "firmware download failed %d\n" , ret ) ; err_release_firmware } } err_release_firmware release_firmware ( fw ) ; return ret ; } 