static gboolean makernote_olympus_imageprocessing ( RAWFILE * rawfile , guint base , guint offset , RSMetadata * meta ) { gushort number_of_entries ; struct IFD ifd ; gushort ushort_temp1 , ushort_temp2 ; if ( ! raw_get_ushort ( rawfile , offset , & number_of_entries ) ) { return FALSE ; } offset += 2 ; while ( number_of_entries -- ) { read_ifd ( rawfile , offset , & ifd ) ; offset += 12 ; switch ( ifd . tag ) { case 0x0100 : if ( ifd . count == 2 ) { raw_get_ushort ( rawfile , ifd . offset , & ushort_temp1 ) ; raw_get_ushort ( rawfile , ifd . offset + 2 , & ushort_temp2 ) ; } if ( ifd . count == 4 ) { raw_get_ushort ( rawfile , ifd . offset + base , & ushort_temp1 ) ; raw_get_ushort ( rawfile , ifd . offset + base + 2 , & ushort_temp2 ) ; } meta -> cam_mul [ 0 ] = ( gdouble ) ushort_temp1 / 256.0 ; meta -> cam_mul [ 2 ] = ( gdouble ) ushort_temp2 / 256.0 ; rs_metadata_normalize_wb ( meta ) ; break ; } } return TRUE ; } 