static void process_header ( struct connection * cptr , char * line ) { struct httpddata * hd ; char * p ; hd = cptr -> userdata ; p = strchr ( line , ':' ) ; * p = '\0' ; p ++ ; while ( * p == ' ' ) { p ++ ; } if ( ! strcasecmp ( line , "Connection" ) ) { p = strtok ( p , ", \t" ) ; while ( p != NULL ) { if ( ! strcasecmp ( p , "close" ) ) { slog ( LG_DEBUG , "process_header(): Connection: close requested by fd %d" , cptr -> fd ) ; hd -> connection_close = true ; } p = strtok ( NULL , ", \t" ) ; } } if ( ! strcasecmp ( line , "Content-Length" ) ) { hd -> length = atoi ( p ) ; } if ( ! strcasecmp ( line , "Content-Type" ) ) { p = strtok ( p , "; \t" ) ; hd -> correct_content_type = p != NULL && ( ! strcasecmp ( p , "text/xml" ) || ! strcasecmp ( p , "application/json" ) ) ; } if ( ! strcasecmp ( line , "Expect" ) ) { hd -> expect_100_continue = ! strcasecmp ( p , "100-continue" ) ; } } 