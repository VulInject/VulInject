static struct RString * str_init_shared ( mrb_state * mrb , const struct RString * orig , struct RString * s , mrb_shared_string * shared ) { if ( shared ) { shared -> refcnt ++ ; } else { shared = ( mrb_shared_string * ) mrb_malloc ( mrb , sizeof ( mrb_shared_string ) ) ; shared -> ptr = orig -> as . heap . ptr ; shared -> capa = orig -> as . heap . aux . capa ; } s -> as . heap . ptr = orig -> as . heap . ptr ; s -> as . heap . len = orig -> as . heap . len ; s -> as . heap . aux . shared = shared ; RSTR_SET_TYPE_FLAG ( s , SHARED ) ; return s ; } 