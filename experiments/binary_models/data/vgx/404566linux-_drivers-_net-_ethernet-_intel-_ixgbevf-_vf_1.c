int ixgbevf_get_reta_locked ( struct ixgbe_hw * hw , u32 * reta , int num_rx_queues ) { int err , i , j ; u32 msgbuf [ IXGBE_VFMAILBOX_SIZE ] ; u32 * hw_reta = & msgbuf [ 1 ] ; u32 mask = 0 ; int dwords = IXGBEVF_82599_RETA_SIZE / 16 ; switch ( hw -> api_version ) { case ixgbe_mbox_api_15 : case ixgbe_mbox_api_14 : case ixgbe_mbox_api_13 : case ixgbe_mbox_api_12 : if ( hw -> mac . type < ixgbe_mac_X550_vf ) { break ; } fallthrough ; default : return - EOPNOTSUPP ; } msgbuf [ 0 ] = IXGBE_VF_GET_RETA ; err = ixgbevf_write_mbx ( hw , msgbuf , 1 ) ; err = ixgbevf_poll_mbx ( hw , msgbuf , dwords + 1 ) ; if ( err ) { return err ; } msgbuf [ 0 ] &= ~ IXGBE_VT_MSGTYPE_CTS ; if ( msgbuf [ 0 ] == ( IXGBE_VF_GET_RETA | IXGBE_VT_MSGTYPE_FAILURE ) ) { return - EPERM ; } if ( msgbuf [ 0 ] != ( IXGBE_VF_GET_RETA | IXGBE_VT_MSGTYPE_SUCCESS ) ) { return IXGBE_ERR_MBX ; } if ( num_rx_queues > 1 ) { mask = 0x1 ; } for ( i = 0 ; i < dwords ; i ++ ) { for ( j = 0 ; j < 16 ; j ++ ) { reta [ i * 16 + j ] = ( hw_reta [ i ] >> ( 2 * j ) ) & mask ; } } return 0 ; } 