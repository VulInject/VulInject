static int env_ext4_save_buffer ( env_t * env_new ) { struct blk_desc * dev_desc = NULL ; struct disk_partition info ; int dev , part ; int err ; const char * ifname = env_ext4_get_intf ( ) ; const char * dev_and_part = env_ext4_get_dev_part ( ) ; part = blk_get_device_part_str ( ifname , dev_and_part , & dev_desc , & info , 1 ) ; dev = dev_desc -> devnum ; ext4fs_set_blk_dev ( dev_desc , & info ) ; if ( ! ext4fs_mount ( info . size ) ) { printf ( "\n** Unable to use %s %s for saveenv **\n" , ifname , dev_and_part ) ; return 1 ; } err = ext4fs_write ( CONFIG_ENV_EXT4_FILE , ( void * ) env_new , sizeof ( env_t ) , FILETYPE_REG ) ; ext4fs_close ( ) ; if ( err == - 1 ) { printf ( "\n** Unable to write \"%s\" from %s%d:%d **\n" , CONFIG_ENV_EXT4_FILE , ifname , dev , part ) ; return 1 ; } return 0 ; } 