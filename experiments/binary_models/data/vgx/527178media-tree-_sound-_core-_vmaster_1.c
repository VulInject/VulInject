static int slave_init ( struct link_slave * slave ) { struct snd_ctl_elem_info * uinfo ; int err ; if ( slave -> info . count ) { if ( slave -> flags & SND_CTL_SLAVE_NEED_UPDATE ) { return slave_update ( slave ) ; } return 0 ; } uinfo = kmalloc ( sizeof ( * uinfo ) , GFP_KERNEL ) ; if ( ! uinfo ) { return - ENOMEM ; } uinfo -> id = slave -> slave . id ; err = slave -> slave . info ( & slave -> slave , uinfo ) ; if ( err < 0 ) { return err ; } slave -> info . type = uinfo -> type ; slave -> info . count = uinfo -> count ; if ( slave -> info . count > 2 || ( slave -> info . type != SNDRV_CTL_ELEM_TYPE_INTEGER && slave -> info . type != SNDRV_CTL_ELEM_TYPE_BOOLEAN ) ) { pr_err ( "ALSA: vmaster: invalid slave element\n" ) ; kfree ( uinfo ) ; return - EINVAL ; } slave -> info . min_val = uinfo -> value . integer . min ; slave -> info . max_val = uinfo -> value . integer . max ; kfree ( uinfo ) ; return slave_update ( slave ) ; } 