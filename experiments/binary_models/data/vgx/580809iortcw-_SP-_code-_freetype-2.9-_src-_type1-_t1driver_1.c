static FT_Error t1_get_glyph_name ( T1_Face face , FT_UInt glyph_index , FT_Pointer buffer , FT_UInt buffer_max ) { FT_STRCPYN ( buffer , face -> type1 . glyph_names [ glyph_index ] , buffer_max ) ; return FT_Err_Ok ; } static FT_UInt t1_get_name_index ( T1_Face face , FT_String * glyph_name ) { FT_Int i ; for ( i = 0 ; i < face -> type1 . num_glyphs ; i ++ ) { FT_String * gname = face -> type1 . glyph_names [ i ] ; if ( ! ft_strcmp ( glyph_name , gname ) ) { return ( FT_UInt ) i ; } } return 0 ; } static const FT_Service_GlyphDictRec t1_service_glyph_dict = { ( FT_GlyphDict_GetNameFunc ) t1_get_glyph_name ( FT_GlyphDict_NameIndexFunc ) t1_get_name_index } ; static const char * t1_get_ps_name ( T1_Face face ) { return ( const char * ) face -> type1 . font_name ; } static const FT_Service_PsFontNameRec t1_service_ps_name = { ( FT_PsName_GetFunc ) t1_get_ps_name } ; static const FT_Service_MultiMastersRec t1_service_multi_masters = { ( FT_Get_MM_Func ) T1_Get_Multi_Master ( FT_Set_MM_Design_Func ) T1_Set_MM_Design ( FT_Set_MM_Blend_Func ) T1_Set_MM_Blend ( FT_Get_MM_Blend_Func ) T1_Get_MM_Blend ( FT_Get_MM_Var_Func ) T1_Get_MM_Var ( FT_Set_Var_Design_Func ) T1_Set_Var_Design ( FT_Get_Var_Design_Func ) T1_Get_Var_Design ( FT_Set_Instance_Func ) T1_Reset_MM_Blend ( FT_Get_Var_Blend_Func ) NULL ( FT_Done_Blend_Func ) T1_Done_Blend } ; static FT_Error t1_ps_get_font_info ( FT_Face face , PS_FontInfoRec * afont_info ) { * afont_info = ( ( T1_Face ) face ) -> type1 . font_info ; return FT_Err_Ok ; } static FT_Error t1_ps_get_font_extra ( FT_Face face , PS_FontExtraRec * afont_extra ) { * afont_extra = ( ( T1_Face ) face ) -> type1 . font_extra ; return FT_Err_Ok ; } static FT_Int t1_ps_has_glyph_names ( FT_Face face ) { FT_UNUSED ( face , NULL ) ; return 1 ; } static FT_Error t1_ps_get_font_private ( FT_Face face , PS_PrivateRec * afont_private ) { * afont_private = ( ( T1_Face ) face ) -> type1 . private_dict ; return FT_Err_Ok ; } static FT_Long t1_ps_get_font_value ( FT_Face face , PS_Dict_Keys key , FT_UInt idx , void * value , FT_Long value_len_ ) { FT_ULong retval = 0 ; FT_ULong value_len = value_len_ < 0 ?0 : ( FT_ULong ) value_len_ ; T1_Face t1face = ( T1_Face ) face ; T1_Font type1 = & t1face -> type1 ; switch ( key ) { case PS_DICT_FONT_TYPE : retval = sizeof ( type1 -> font_type ) ; if ( value && value_len >= retval ) { * ( ( FT_Byte * ) value ) = type1 -> font_type ; } break ; case PS_DICT_FONT_MATRIX : if ( idx < sizeof ( type1 -> font_matrix ) / sizeof ( type1 -> font_matrix . xx ) ) { FT_Fixed val = 0 ; retval = sizeof ( val ) ; if ( value && value_len >= retval ) { switch ( idx ) { case 0 : val = type1 -> font_matrix . xx ; break ; case 1 : val = type1 -> font_matrix . xy ; break ; case 2 : val = type1 -> font_matrix . yx ; break ; case 3 : val = type1 -> font_matrix . yy ; break ; } * ( ( FT_Fixed * ) value ) = val ; } } break ; case PS_DICT_FONT_BBOX : if ( idx < sizeof ( type1 -> font_bbox ) / sizeof ( type1 -> font_bbox . xMin ) ) { FT_Fixed val = 0 ; retval = sizeof ( val ) ; if ( value && value_len >= retval ) { switch ( idx ) { case 0 : val = type1 -> font_bbox . xMin ; break ; case 1 : val = type1 -> font_bbox . yMin ; break ; case 2 : val = type1 -> font_bbox . xMax ; break ; case 3 : val = type1 -> font_bbox . yMax ; break ; } * ( ( FT_Fixed * ) value ) = val ; } } break ; case PS_DICT_PAINT_TYPE : retval = sizeof ( type1 -> paint_type ) ; if ( value && value_len >= retval ) { * ( ( FT_Byte * ) value ) = type1 -> paint_type ; } break ; case PS_DICT_FONT_NAME : retval = ft_strlen ( type1 -> font_name ) + 1 ; if ( value && value_len >= retval ) { ft_memcpy ( value , ( void * ) ( type1 -> font_name ) , retval ) ; } break ; case PS_DICT_UNIQUE_ID : retval = sizeof ( type1 -> private_dict . unique_id ) ; if ( value && value_len >= retval ) { * ( ( FT_Int * ) value ) = type1 -> private_dict . unique_id ; } break ; case PS_DICT_NUM_CHAR_STRINGS : retval = sizeof ( type1 -> num_glyphs ) ; if ( value && value_len >= retval ) { * ( ( FT_Int * ) value ) = type1 -> num_glyphs ; } break ; case PS_DICT_CHAR_STRING_KEY : if ( idx < ( FT_UInt ) type1 -> num_glyphs ) { retval = ft_strlen ( type1 -> glyph_names [ idx ] ) + 1 ; if ( value && value_len >= retval ) { ft_memcpy ( value , ( void * ) ( type1 -> glyph_names [ idx ] ) , retval ) ; ( ( FT_Char * ) value ) [ retval - 1 ] = ( FT_Char ) '\0' ; } } break ; case PS_DICT_CHAR_STRING : if ( idx < ( FT_UInt ) type1 -> num_glyphs ) { retval = type1 -> charstrings_len [ idx ] + 1 ; if ( value && value_len >= retval ) { ft_memcpy ( value , ( void * ) ( type1 -> charstrings [ idx ] ) , retval - 1 ) ; ( ( FT_Char * ) value ) [ retval - 1 ] = ( FT_Char ) '\0' ; } } break ; case PS_DICT_ENCODING_TYPE : retval = sizeof ( type1 -> encoding_type ) ; if ( value && value_len >= retval ) { * ( ( T1_EncodingType * ) value ) = type1 -> encoding_type ; } break ; case PS_DICT_ENCODING_ENTRY : if ( type1 -> encoding_type == T1_ENCODING_TYPE_ARRAY && idx < ( FT_UInt ) type1 -> encoding . num_chars ) { retval = ft_strlen ( type1 -> encoding . char_name [ idx ] ) + 1 ; if ( value && value_len >= retval ) { ft_memcpy ( value , ( void * ) ( type1 -> encoding . char_name [ idx ] ) , retval - 1 ) ; ( ( FT_Char * ) value ) [ retval - 1 ] = ( FT_Char ) '\0' ; } } break ; case PS_DICT_NUM_SUBRS : retval = sizeof ( type1 -> num_subrs ) ; if ( value && value_len >= retval ) { * ( ( FT_Int * ) value ) = type1 -> num_subrs ; } break ; case PS_DICT_SUBR : { FT_Bool ok = 0 ; if ( type1 -> subrs_hash ) { size_t * val = ft_hash_num_lookup ( ( FT_Int ) idx , type1 -> subrs_hash ) ; if ( val ) { idx = * val ; ok = 1 ; } } else { if ( idx < ( FT_UInt ) type1 -> num_subrs ) { ok = 1 ; } } if ( ok ) { retval = type1 -> subrs_len [ idx ] + 1 ; if ( value && value_len >= retval ) { ft_memcpy ( value , ( void * ) ( type1 -> subrs [ idx ] ) , retval - 1 ) ; ( ( FT_Char * ) value ) [ retval - 1 ] = ( FT_Char ) '\0' ; } } } break ; case PS_DICT_STD_HW : retval = sizeof ( type1 -> private_dict . standard_width [ 0 ] ) ; if ( value && value_len >= retval ) { } } } 