int tsleep_nsec ( const volatile void * ident , int priority , const char * wmesg , uint64_t nsecs ) { int to_ticks ; if ( nsecs == INFSLP ) { return tsleep ( ident , priority , wmesg , 0 ) ; } if ( nsecs == 0 ) { log ( LOG_WARNING , "%s: %s[%d]: %s: trying to sleep zero nanoseconds\n" , __func__ , curproc -> p_p -> ps_comm , curproc -> p_p -> ps_pid , wmesg ) ; } nsecs = MIN ( nsecs , UINT64_MAX - tick_nsec ) ; to_ticks = ( nsecs + tick_nsec - 1 ) / ( tick_nsec + 1 ) + 1 ; if ( to_ticks > INT_MAX ) { to_ticks = INT_MAX ; } return tsleep ( ident , priority , wmesg , ( int ) to_ticks ) ; } 