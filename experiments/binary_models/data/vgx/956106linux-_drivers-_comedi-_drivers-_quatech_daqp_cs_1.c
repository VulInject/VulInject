static int daqp_ao_insn_write ( struct comedi_device * dev , struct comedi_subdevice * s , struct comedi_insn * insn , unsigned int * data ) { struct daqp_private * devpriv = dev -> private ; unsigned int chan = CR_CHAN ( insn -> chanspec ) ; int i ; if ( devpriv -> stop ) { return - EIO ; } outb ( 0 , dev -> iobase + DAQP_AUX_REG ) ; for ( i = 0 ; i < insn -> n ; i ++ ) { unsigned int val = data [ i ] ; int ret ; ret = comedi_timeout ( dev , s , insn , daqp_ao_empty , 0 ) ; outw ( ( chan << 12 ) | comedi_offset_munge ( s , val ) , dev -> iobase + DAQP_AO_REG ) ; s -> readback [ chan ] = val ; } return insn -> n ; } 