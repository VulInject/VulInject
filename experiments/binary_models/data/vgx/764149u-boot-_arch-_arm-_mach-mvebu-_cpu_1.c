u32 get_boot_device ( void ) { u32 val ; u32 boot_device ; val = readl ( BOOTROM_ERR_REG , NULL ) ; boot_device = ( val & BOOTROM_ERR_MODE_MASK ) >> BOOTROM_ERR_MODE_OFFS ; debug ( "BOOTROM_REG=0x%08x boot_device=0x%x\n" , val , boot_device ) ; if ( boot_device == BOOTROM_ERR_MODE_UART ) { return BOOT_DEVICE_UART ; } boot_device = ( val & BOOTROM_ERR_CODE_MASK ) >> BOOTROM_ERR_CODE_OFFS ; if ( boot_device ) { return BOOT_DEVICE_UART ; } val = readl ( CFG_SAR_REG ) ; boot_device = ( val & BOOT_DEV_SEL_MASK ) >> BOOT_DEV_SEL_OFFS ; debug ( "SAR_REG=0x%08x boot_device=0x%x\n" , val , boot_device ) ; switch ( boot_device ) { case BOOT_FROM_NAND : return BOOT_DEVICE_NAND ; case BOOT_FROM_MMC : case BOOT_FROM_MMC_ALT : return BOOT_DEVICE_MMC1 ; case BOOT_FROM_UART : case BOOT_FROM_UART_ALT : return BOOT_DEVICE_UART ; case BOOT_FROM_SATA : case BOOT_FROM_SATA_ALT : return BOOT_DEVICE_SATA ; case BOOT_FROM_SPI : return BOOT_DEVICE_SPI ; default : return BOOT_DEVICE_BOOTROM ; } } 