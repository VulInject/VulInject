static struct nd_pfn * nd_pfn_alloc ( struct nd_region * nd_region ) { struct nd_pfn * nd_pfn ; struct device * dev ; nd_pfn = kmalloc ( sizeof ( * nd_pfn ) , GFP_KERNEL ) ; if ( ! nd_pfn ) { return NULL ; } nd_pfn -> id = ida_simple_get ( & nd_region -> pfn_ida , 0 , 0 , GFP_KERNEL ) ; if ( nd_pfn -> id < 0 ) { kfree ( nd_pfn ) ; return NULL ; } dev = & nd_pfn -> dev ; dev_set_name ( dev , "pfn%d.%d" , nd_region -> id , nd_pfn -> id ) ; dev -> type = & nd_pfn_device_type ; dev -> parent = & nd_region -> dev ; return nd_pfn ; } 