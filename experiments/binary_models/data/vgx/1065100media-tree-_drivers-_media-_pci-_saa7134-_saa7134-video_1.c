( saa7134_vb2_buffer_queue ) ; int saa7134_vb2_start_streaming ( struct vb2_queue * vq , unsigned int count ) { struct saa7134_dmaqueue * dmaq = vq -> drv_priv ; struct saa7134_dev * dev = dmaq -> dev ; if ( card_is_empress ( dev ) && vb2_is_busy ( & dev -> empress_vbq ) && dmaq == & dev -> video_q && dev -> fmt -> planar ) { struct saa7134_buf * buf , * tmp ; list_for_each_entry_safe ( , , , ) { list_del ( & buf -> entry ) ; vb2_buffer_done ( & buf -> vb2 . vb2_buf , VB2_BUF_STATE_QUEUED ) ; } if ( dmaq -> curr ) { vb2_buffer_done ( & dmaq -> curr -> vb2 . vb2_buf , VB2_BUF_STATE_QUEUED ) ; } return - EBUSY ; } if ( ( dmaq == & dev -> video_q && ! vb2_is_streaming ( & dev -> vbi_vbq ) ) || ( dmaq == & dev -> vbi_q && ! vb2_is_streaming ( & dev -> video_vbq ) ) ) { pm_qos_add_request ( & dev -> qos_request , PM_QOS_CPU_DMA_LATENCY , 20 ) ; } dmaq -> seq_nr = 0 ; return 0 ; } 