int pim_static_del ( struct pim_instance * pim , struct interface * iif , struct interface * oif , pim_addr group , pim_addr source ) { struct listnode * node = NULL ; struct listnode * nextnode = NULL ; struct static_route * s_route = NULL ; struct pim_interface * pim_iif = iif ?iif -> info : 0 ; struct pim_interface * pim_oif = oif ?oif -> info : 0 ; ifindex_t iif_index = pim_iif ?pim_iif -> mroute_vif_index : 0 ; ifindex_t oif_index = pim_oif ?pim_oif -> mroute_vif_index : 0 ; if ( ! iif_index || ! oif_index ) { zlog_warn ( "%s %s: Unable to remove static route: Invalid interface index(iif=%d,oif=%d)" , __FILE__ , __func__ , iif_index , oif_index ) ; return - 2 ; } for ( ALL_LIST_ELEMENTS ( pim -> static_routes , node , nextnode , s_route ) ; ) { if ( s_route -> iif == iif_index && ! pim_addr_cmp ( s_route -> group , group ) && ! pim_addr_cmp ( s_route -> source , source ) && s_route -> oif_ttls [ oif_index ] ) { oil_if_set ( & s_route -> c_oil , oif_index , 0 ) ; -- s_route -> c_oil . oil_ref_count ; if ( s_route -> c_oil . oil_ref_count <= 0 ?pim_mroute_del ( & s_route -> c_oil , __func__ ) : pim_static_mroute_add ( & s_route -> c_oil , __func__ ) ) { zlog_warn ( "%s %s: Unable to remove static route(iif=%d,oif=%d,group=%pPAs,source=%pPAs)" , __FILE__ , __func__ , iif_index , oif_index , & group , & source ) ; s_route -> oif_ttls [ oif_index ] = 1 ; oil_if_set ( & s_route -> c_oil , oif_index , 1 ) ; ++ s_route -> c_oil . oil_ref_count ; return - 1 ; } s_route -> c_oil . oif_creation [ oif_index ] = 0 ; if ( s_route -> c_oil . oil_ref_count <= 0 ) { listnode_delete ( pim -> static_routes , s_route ) ; pim_static_route_free ( s_route ) ; } if ( PIM_DEBUG_STATIC ) { zlog_debug ( "%s: Static route removed(iif=%d,oif=%d,group=%pPAs,source=%pPAs)" , __func__ , iif_index , oif_index , & group , & source ) ; } break ; } } if ( ! node ) { zlog_warn ( "%s %s: Unable to remove static route: Route does not exist(iif=%d,oif=%d,group=%pPAs,source=%pPAs)" , __FILE__ , __func__ , iif_index , oif_index , & group , & source ) ; return - 3 ; } return 0 ; } 