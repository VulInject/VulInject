static long ioctl_file_clone ( struct file * dst_file , unsigned long srcfd , u64 off , u64 olen , u64 destoff ) { struct fd src_file = fdget ( srcfd ) ; loff_t cloned ; int ret ; cloned = vfs_clone_file_range ( src_file . file , off , dst_file , destoff , olen , 0 ) ; if ( cloned < 0 ) { ret = cloned ; } if ( olen && cloned != olen ) { ret = - EINVAL ; } else { ret = 0 ; } fdput ( src_file ) ; return ret ; } 