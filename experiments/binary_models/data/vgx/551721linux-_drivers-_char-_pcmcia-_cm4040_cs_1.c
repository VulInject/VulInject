static int __init cm4040_init ( void ) { int rc ; cmx_class = class_create ( THIS_MODULE , "cardman_4040" ) ; if ( IS_ERR ( cmx_class ) ) { return PTR_ERR ( cmx_class ) ; } major = register_chrdev ( 0 , DEVICE_NAME , & reader_fops ) ; if ( major < 0 ) { printk ( ": could not get major number\n" ) return major ; } rc = pcmcia_register_driver ( & reader_driver ) ; if ( rc < 0 ) { unregister_chrdev ( major , DEVICE_NAME ) ; class_destroy ( cmx_class ) ; return rc ; } return 0 ; } 