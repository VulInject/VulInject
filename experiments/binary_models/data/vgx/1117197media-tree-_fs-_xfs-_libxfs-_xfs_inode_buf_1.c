static void xfs_inode_buf_verify ( struct xfs_buf * bp , bool readahead ) { struct xfs_mount * mp = bp -> b_target -> bt_mount ; int i ; int ni ; ni = XFS_BB_TO_FSB ( mp , bp -> b_length ) * mp -> m_sb . sb_inopblock ; for ( i = 0 ; i < ni ; i ++ ) { int di_ok ; xfs_dinode_t * dip ; dip = xfs_buf_offset ( bp , ( i << mp -> m_sb . sb_inodelog ) ) ; di_ok = dip -> di_magic == cpu_to_be16 ( XFS_DINODE_MAGIC ) && xfs_dinode_good_version ( mp , dip -> di_version ) ; if ( unlikely ( XFS_TEST_ERROR ( ! di_ok , mp , XFS_ERRTAG_ITOBP_INOTOBP , XFS_RANDOM_ITOBP_INOTOBP ) ) ) { if ( readahead ) { bp -> b_flags &= ~ XBF_DONE ; xfs_buf_ioerror ( bp , - EIO ) ; return ; } xfs_buf_ioerror ( bp , - EFSCORRUPTED ) ; xfs_verifier_error ( bp , NULL ) ; xfs_alert ( mp , "bad inode magic/vsn daddr %lld #%d (magic=%x)" , ( unsigned long long ) bp -> b_bn , i , be16_to_cpu ( dip -> di_magic ) ) ; } } xfs_inobp_check ( mp , bp ) ; } 