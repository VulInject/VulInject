handle_swi ( ) { argsin args [ 3 ] ; char * buf ; int len ; int count = 0 ; int swino = get_word ( ) ; int type = get_byte ( ) ; while ( type != 0 ) { switch ( type & 0x3 ) { case ABYTE : args [ count ] . n = get_byte ( ) ; break ; case AWORD : args [ count ] . n = get_word ( ) ; break ; case ASTRING : len = get_byte ( ) ; if ( len > 32 ) { if ( len == 255 ) { len = get_word ( ) ; } buf = alloca ( len , NULL ) ; remote_rdp_xfer_inferior_memory ( get_word ( ) , buf , len , 0 , 0 , 0 ) ; } else { int i ; buf = alloca ( len + 1 ) ; for ( i = 0 ; i < len ; i ++ ) { buf [ i ] = get_byte ( ) ; } buf [ i ] = 0 ; } args [ count ] . n = len ; args [ count ] . s = buf ; break ; default : error ( "Unimplemented SWI argument" ) ; } type = type >> 2 ; count ++ ; } if ( exec_swi ( swino , args ) ) { send_rdp ( "bbw-" , RDP_OSOpReply , RDP_OSOpWord , args [ 0 ] . n ) ; } else { send_rdp ( "bb-" , RDP_OSOpReply , RDP_OSOpNothing ) ; } } 