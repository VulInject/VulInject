void asgnsamples ( void ) { int j ; UNIT ccnt ; double time ; unsigned long pcl , pch ; unsigned long i ; unsigned long overlap ; unsigned long svalue0 , svalue1 ; scale = highpc - lowpc ; scale /= nsamples ; alignentries ( ) ; for ( i = 0 , j = 1 ; i < nsamples ; i ++ ) { ccnt = samples [ i ] ; pcl = lowpc + ( unsigned long ) ( scale * i ) ; pch = lowpc + ( unsigned long ) ( scale * ( i + 1 ) ) ; time = ccnt ; if ( debug & SAMPLEDEBUG ) { printf ( "[asgnsamples] pcl 0x%lx pch 0x%lx ccnt %d\n" , pcl , pch , ccnt ) ; } totime += time ; for ( j = j - 1 ; j < nname ; j ++ ) { svalue0 = nl [ j ] . svalue ; svalue1 = nl [ j + 1 ] . svalue ; if ( pch < svalue0 ) { break ; } if ( pcl >= svalue1 ) { continue ; } overlap = min ( pch , svalue1 ) - max ( pcl , svalue0 ) ; if ( overlap > 0 ) { if ( debug & SAMPLEDEBUG ) { printf ( "[asgnsamples] (0x%lx->0x%lx-0x%lx) %s gets %f ticks %ld overlap\n" , nl [ j ] . value / sizeof ( UNIT ) , svalue0 , svalue1 , nl [ j ] . name , overlap * time / scale , overlap ) ; } nl [ j ] . time += overlap * time / scale ; } } } if ( debug & SAMPLEDEBUG ) { printf ( "[asgnsamples] totime %f\n" , totime ) ; } } 