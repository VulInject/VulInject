void smrt_write_message_common ( smrt_command_t * smcm , uint8_t type , int timeout_secs ) { switch ( type ) { case CISS_MSG_ABORT : case CISS_MSG_RESET : case CISS_MSG_NOP : break ; default : panic ( "unknown message type" ) ; } smcm -> smcm_va_cmd -> Request . Type . Type = CISS_TYPE_MSG ; smcm -> smcm_va_cmd -> Request . Type . Attribute = CISS_ATTR_HEADOFQUEUE ; smcm -> smcm_va_cmd -> Request . Type . Direction = CISS_XFER_NONE ; smcm -> smcm_va_cmd -> Request . Timeout = LE_16 ( timeout_secs , NULL ) ; smcm -> smcm_va_cmd -> Request . CDBLen = CISS_CDBLEN ; smcm -> smcm_va_cmd -> Request . CDB [ 0 ] = type ; } 