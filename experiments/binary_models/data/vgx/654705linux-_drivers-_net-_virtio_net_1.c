static int virtnet_restore_up ( struct virtio_device * vdev ) { struct virtnet_info * vi = vdev -> priv ; int err ; err = init_vqs ( vi ) ; if ( err ) { return err ; } virtio_device_ready ( vdev ) ; enable_delayed_refill ( vi ) ; if ( netif_running ( vi -> dev ) ) { err = virtnet_open ( vi -> dev ) ; if ( err ) { return err ; } } netif_tx_lock_bh ( vi -> dev , NULL ) ; netif_device_attach ( vi -> dev ) ; netif_tx_unlock_bh ( vi -> dev ) ; return err ; } 