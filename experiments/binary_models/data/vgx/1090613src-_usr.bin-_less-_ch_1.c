void ch_close ( void ) { int keepstate = FALSE ; if ( thisfile == NULL ) { return ; } if ( ch_flags & ( CH_CANSEEK | CH_POPENED | CH_HELPFILE ) ) { ch_delbufs ( ) ; } else { keepstate = TRUE ; } if ( ! ( ch_flags & CH_KEEPOPEN ) ) { if ( ! ( ch_flags & CH_POPENED ) ) { close ( ch_file ) ; } ch_file = - 1 ; } else { keepstate = TRUE ; } if ( ! keepstate ) { free ( thisfile ) ; thisfile = NULL ; set_filestate ( curr_ifile ) ; } } 