static void handle_received_packet ( struct ipw_hardware * hw , const union nl_packet * packet , unsigned short len ) { unsigned int protocol = packet -> hdr . protocol ; int address = packet -> hdr . address ; unsigned int header_length ; const unsigned char * data ; unsigned int data_len ; int is_last = packet -> hdr . packet_rank & NL_LAST_PACKET ; if ( packet -> hdr . packet_rank & NL_FIRST_PACKET ) { header_length = NL_FIRST_PACKET_HEADER_SIZE ; } else { header_length = NL_FOLLOWING_PACKET_HEADER_SIZE ; } data = packet -> rawpkt + header_length ; data_len = len - header_length ; switch ( protocol ) { case TL_PROTOCOLID_COM_DATA : case TL_PROTOCOLID_COM_CTRL : queue_received_packet ( hw , protocol , address , data , data_len , is_last ) ; break ; case TL_PROTOCOLID_SETUP : handle_received_SETUP_packet ( hw , address , data , data_len , is_last ) ; break ; } } 