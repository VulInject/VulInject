struct pim_upstream * pim_upstream_keep_alive_timer_proc ( struct pim_upstream * up ) { struct pim_instance * pim ; pim = up -> channel_oil -> pim ; if ( PIM_UPSTREAM_FLAG_TEST_DISABLE_KAT_EXPIRY ( up -> flags ) ) { pim_upstream_keep_alive_timer_start ( up , pim -> keep_alive_time ) ; return up ; } if ( I_am_RP ( pim , up -> sg . grp ) ) { } pim_msdp_sa_local_del ( pim , & up -> sg ) ; pim_upstream_update_join_desired ( pim , up ) ; if ( PIM_UPSTREAM_FLAG_TEST_SRC_STREAM ( up -> flags ) ) { pim_upstream_fhr_kat_expiry ( pim , up ) ; if ( PIM_DEBUG_PIM_TRACE ) { zlog_debug ( "kat expired on %s[%s]; remove stream reference" , up -> sg_str , pim -> vrf -> name ) ; } PIM_UPSTREAM_FLAG_UNSET_SRC_STREAM ( up -> flags ) ; if ( ! pim_upstream_del ( pim , up , __func__ ) ) { return in ; } } if ( PIM_UPSTREAM_FLAG_TEST_SRC_NOCACHE ( up -> flags ) ) { PIM_UPSTREAM_FLAG_UNSET_SRC_NOCACHE ( up -> flags ) ; if ( ! pim_upstream_del ( pim , up , __func__ ) ) { return NULL ; } } if ( PIM_UPSTREAM_FLAG_TEST_SRC_LHR ( up -> flags ) ) { struct pim_upstream * parent = up -> parent ; PIM_UPSTREAM_FLAG_UNSET_SRC_LHR ( up -> flags ) ; up = pim_upstream_del ( pim , up , __func__ ) ; if ( parent ) { pim_jp_agg_single_upstream_send ( & parent -> rpf , parent , true ) ; } } return up ; } 