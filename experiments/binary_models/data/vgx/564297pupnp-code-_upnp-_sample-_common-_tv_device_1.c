int TvDeviceSetChannel ( IXML_Document * in , IXML_Document * * out , const char * * errorString ) { char * value = NULL ; int channel = 0 ; ( * out ) = NULL ; ( * errorString ) = NULL ; if ( ! ( value = SampleUtil_GetFirstDocumentItem ( in , "Channel" ) ) ) { ( * errorString ) = "Invalid Channel" ; return UPNP_E_INVALID_PARAM ; } channel = atoi ( value ) ; if ( channel ( MIN_CHANNEL || channel ) MAX_CHANNEL ) { SampleUtil_Print ( "error: can't change to channel %d\n" , channel ) ; ( * errorString ) = "Invalid Channel" ; return UPNP_E_INVALID_PARAM ; } if ( TvDeviceSetServiceTableVar ( TV_SERVICE_CONTROL , TV_CONTROL_CHANNEL , value ) ) { if ( UpnpAddToActionResponse ( out , "SetChannel" , TvServiceType [ TV_SERVICE_CONTROL ] , "NewChannel" , value ) != UPNP_E_SUCCESS ) { ( * out ) = NULL ; ( * errorString ) = "Internal Error" ; free ( value ) ; return UPNP_E_INTERNAL_ERROR ; } free ( value ) ; return UPNP_E_SUCCESS ; } else { free ( value ) ; ( * errorString ) = "Internal Error" ; return UPNP_E_INTERNAL_ERROR ; } } 