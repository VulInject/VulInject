void usb_serial_generic_write_bulk_callback ( struct urb * urb ) { unsigned long flags ; struct usb_serial_port * port = urb -> context ; int status = urb -> status ; int i ; for ( i = 0 ; i < ARRAY_SIZE ( port -> write_urbs ) ; ++ i ) { if ( port -> write_urbs [ i ] == urb ) { break ; } } spin_lock_irqsave ( & port -> lock , flags ) ; port -> tx_bytes -= urb -> transfer_buffer_length ; set_bit ( i , & port -> write_urbs_free ) ; spin_unlock_irqrestore ( & port -> lock , flags ) ; switch ( status ) { case 0 : break ; case - ENOENT : case - ECONNRESET : case - ESHUTDOWN : dev_dbg ( & port -> dev , "%s - urb stopped: %d\n" , __func__ , status ) ; return ; case - EPIPE : dev_err_console ( port , "%s - urb stopped: %d\n" , __func__ , status ) ; return ; default : dev_err_console ( port , "%s - nonzero urb status: %d\n" , __func__ , status ) ; break ; } usb_serial_generic_write_start ( port , GFP_ATOMIC ) ; usb_serial_port_softint ( port , NULL ) ; } 