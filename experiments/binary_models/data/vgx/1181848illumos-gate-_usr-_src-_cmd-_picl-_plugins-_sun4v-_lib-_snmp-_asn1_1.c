uchar_t * asn_build_length ( uchar_t * buf , size_t * bufsz_p , size_t length ) { if ( length < 0x80 ) { buf [ 0 ] = ( uchar_t ) length ; ( * bufsz_p ) -- ; return ( buf + 1 ) ; } if ( length <= 0xFF ) { if ( * bufsz_p < 2 ) { return ( NULL ) ; } buf [ 0 ] = ( uchar_t ) ( ASN_LONG_LEN | 0x01 ) ; buf [ 1 ] = ( uchar_t ) length ; * bufsz_p -= 2 ; return ( buf + 2 ) ; } else { if ( * bufsz_p < 3 ) { return ( NULL ) ; } buf [ 0 ] = ( uchar_t ) ( ASN_LONG_LEN | 0x02 ) ; buf [ 1 ] = ( uchar_t ) ( ( length >> 8 ) & 0xff ) ; buf [ 2 ] = ( uchar_t ) ( length & 0xff ) ; * bufsz_p -= 3 ; return ( buf + 3 ) ; } } 