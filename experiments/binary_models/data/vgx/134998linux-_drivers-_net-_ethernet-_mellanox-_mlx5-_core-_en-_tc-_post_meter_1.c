static int mlx5e_post_meter_rate_create ( struct mlx5e_priv * priv , enum mlx5_flow_namespace_type ns_type , struct mlx5e_post_act * post_act , struct mlx5_fc * act_counter , struct mlx5_fc * drop_counter , struct mlx5e_post_meter_priv * post_meter , struct mlx5_flow_attr * green_attr , struct mlx5_flow_attr * red_attr ) { struct mlx5_flow_table * ft ; int err ; post_meter -> type = MLX5E_POST_METER_RATE ; ft = mlx5e_post_meter_table_create ( priv , ns_type ) ; if ( IS_ERR ( ft ) ) { err = PTR_ERR ( ft ) ; mlx5_core_warn ( priv -> mdev , "Failed to create post_meter table\n" ) ; err_ft } post_meter -> rate_steering_table . ft = ft ; err = mlx5e_post_meter_rate_fg_create ( priv , post_meter ) ; if ( err ) { err_fg } err = mlx5e_post_meter_rate_rules_create ( priv , post_meter , post_act , act_counter , drop_counter , green_attr , red_attr ) ; if ( err ) { err_rules } return 0 ; err_rules err_fg mlx5e_post_meter_rate_table_destroy ( post_meter ) ; err_ft return err ; } 