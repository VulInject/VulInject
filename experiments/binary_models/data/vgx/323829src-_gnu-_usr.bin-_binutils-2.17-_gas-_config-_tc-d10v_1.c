get_operands ( ) { char * p = input_line_pointer ; int numops = 0 ; int post = 0 ; int uses_at = 0 ; while ( * p ) { while ( * p == ' ' || * p == '\t' || * p == ',' ) { p ++ ; } if ( * p == 0 || * p == '\n' || * p == '\r' ) { break ; } if ( * p == '@' ) { uses_at = 1 ; p ++ ; exp [ numops ] . X_op = O_absent ; if ( * p == '(' ) { p ++ ; exp [ numops ] . X_add_number = OPERAND_ATPAR ; } if ( * p == '-' ) { p ++ ; exp [ numops ] . X_add_number = OPERAND_ATMINUS ; } else { exp [ numops ] . X_add_number = OPERAND_ATSIGN ; if ( * p == '+' ) { numops ++ ; exp [ numops ] . X_op = O_absent ; exp [ numops ] . X_add_number = OPERAND_PLUS ; p ++ ; } post = postfix ( p ) ; } numops ++ ; continue ; } if ( * p == ')' ) { p ++ ; continue ; } input_line_pointer = p ; if ( ! register_name ( & exp [ numops ] ) ) { if ( uses_at ) { int save = do_not_ignore_hash ; do_not_ignore_hash = 1 ; expression ( & exp [ numops ] ) ; do_not_ignore_hash = save ; } else { expression ( & exp [ numops ] ) ; } } if ( strncasecmp ( input_line_pointer , "@word" , 5 ) == 0 ) { input_line_pointer += 5 ; if ( exp [ numops ] . X_op == O_register ) { exp [ numops ] . X_op = O_symbol ; exp [ numops ] . X_add_symbol = symbol_find_or_make ( ( char * ) exp [ numops ] . X_op_symbol ) ; } if ( * input_line_pointer == '-' || * input_line_pointer == '+' ) { expressionS new_exp ; expression ( & new_exp ) ; exp [ numops ] . X_add_number = new_exp . X_add_number ; } { expressionS new_exp ; new_exp . X_add_number = AT_WORD_RIGHT_SHIFT ; new_exp . X_op = O_constant ; new_exp . X_unsigned = 1 ; exp [ numops ] . X_op_symbol = make_expr_symbol ( & new_exp ) ; exp [ numops ] . X_op = O_right_shift ; } know ( AT_WORD_P ( & exp [ numops ] ) ) ; } if ( exp [ numops ] . X_op == O_illegal ) { as_bad ( _ ( "illegal operand" ) ) ; } if ( exp [ numops ] . X_op == O_absent ) { as_bad ( _ ( "missing operand" ) ) ; } numops ++ ; p = input_line_pointer ; } switch ( post ) { case - 1 : exp [ numops ] . X_op = O_absent ; exp [ numops ++ ] . X_add_number = OPERAND_MINUS ; break ; case 1 : exp [ numops ] . X_op = O_absent ; exp [ numops ++ ] . X_add_number = OPERAND_PLUS ; break ; } exp [ numops ] . X_op = 0 ; return numops ; } 