struct clk_hw * s10_register_pll ( const struct stratix10_pll_clock * clks , void __iomem * reg ) { struct clk_hw * hw_clk ; struct socfpga_pll * pll_clk ; struct clk_init_data init ; const char * name = clks -> name ; int ret ; pll_clk = kzalloc ( sizeof ( * pll_clk ) , GFP_KERNEL ) ; if ( WARN_ON ( ! pll_clk ) ) { return NULL ; } pll_clk -> hw . reg = reg + clks -> offset ; if ( streq ( name , SOCFPGA_BOOT_CLK ) ) { init . ops = & clk_boot_ops ; } else { init . ops = & clk_pll_ops ; } init . name = name ; init . flags = clks -> flags ; init . num_parents = clks -> num_parents ; init . parent_names = NULL ; init . parent_data = clks -> parent_data ; pll_clk -> hw . hw . init = & init ; pll_clk -> hw . bit_idx = SOCFPGA_PLL_POWER ; hw_clk = & pll_clk -> hw . hw ; ret = clk_hw_register ( NULL , hw_clk ) ; if ( ret ) { return ERR_PTR ( ret ) ; } return hw_clk ; } 