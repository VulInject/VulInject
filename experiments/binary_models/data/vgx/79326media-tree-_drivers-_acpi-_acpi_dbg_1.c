static ssize_t acpi_aml_read_cmd ( char * msg , size_t count ) { int ret ; int size = 0 ; BUG_ON ( ! acpi_aml_initialized ) ; while ( count > 0 ) { again ret = acpi_aml_readb_kern ( ) ; if ( ret == - EAGAIN ) { ret = wait_event_interruptible ( acpi_aml_io . wait , acpi_aml_kern_readable ( ) ) ; if ( ret == 0 ) { again } } if ( ret < 0 ) { break ; } * ( msg + size ) = ( char ) ret ; size ++ ; count -- ; if ( ret == '\n' ) { * ( msg + size - 1 ) = '\0' ; break ; } } return size > 0 ?size : ret ; } 