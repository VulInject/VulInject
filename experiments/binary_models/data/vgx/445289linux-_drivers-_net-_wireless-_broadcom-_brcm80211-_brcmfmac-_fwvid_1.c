int brcmf_fwvid_unregister_vendor ( enum brcmf_fwvendor fwvid , struct module * mod ) { struct brcmf_bus * bus , * tmp ; if ( WARN_ON ( fwvid_list [ fwvid ] . vmod != mod ) ) { return - ENOENT ; } mutex_lock ( & fwvid_list_lock ) ; list_for_each_entry_safe ( , , , ) { mutex_unlock ( & fwvid_list_lock ) ; brcmf_dbg ( INFO , "mod=%s: removing %s\n" , fwvid_list [ fwvid ] . name , dev_name ( bus -> dev ) ) ; brcmf_bus_remove ( bus ) ; mutex_lock ( & fwvid_list_lock ) ; } fwvid_list [ fwvid ] . vmod = NULL ; fwvid_list [ fwvid ] . vops = NULL ; reinit_completion ( & fwvid_list [ fwvid ] . reg_done ) ; brcmf_dbg ( TRACE , "mod=%s: exit\n" , fwvid_list [ fwvid ] . name ) ; mutex_unlock ( & fwvid_list_lock ) ; return 0 ; } 