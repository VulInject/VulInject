static int mv64xxx_i2c_xfer_core ( struct i2c_adapter * adap , struct i2c_msg msgs [ ] , int num ) { struct mv64xxx_i2c_data * drv_data = i2c_get_adapdata ( adap ) ; int rc , ret = num ; rc = pm_runtime_resume_and_get ( & adap -> dev ) ; BUG_ON ( drv_data -> msgs != NULL ) ; drv_data -> msgs = msgs ; drv_data -> num_msgs = num ; if ( mv64xxx_i2c_can_offload ( drv_data ) && ! drv_data -> atomic ) { rc = mv64xxx_i2c_offload_xfer ( drv_data ) ; } else { rc = mv64xxx_i2c_execute_msg ( drv_data , & msgs [ 0 ] , num == 1 ) ; } if ( rc < 0 ) { ret = rc ; } drv_data -> num_msgs = 0 ; drv_data -> msgs = NULL ; pm_runtime_mark_last_busy ( & adap -> dev ) ; pm_runtime_put_autosuspend ( & adap -> dev ) ; return ret ; } 