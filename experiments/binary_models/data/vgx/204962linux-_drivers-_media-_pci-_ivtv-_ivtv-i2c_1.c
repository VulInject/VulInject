static int ivtv_i2c_new_ir ( struct ivtv * itv , u32 hw , const char * type , u8 addr ) { struct i2c_board_info info ; struct i2c_adapter * adap = & itv -> i2c_adap ; struct IR_i2c_init_data * init_data = & itv -> ir_i2c_init_data ; unsigned short addr_list [ 2 ] { addr I2C_CLIENT_END } ; ; if ( itv -> hw_flags & IVTV_HW_IR_ANY ) { return - 1 ; } switch ( hw ) { case IVTV_HW_I2C_IR_RX_AVER : init_data -> ir_codes = RC_MAP_AVERMEDIA_CARDBUS ; init_data -> internal_get_key_func = IR_KBD_GET_KEY_AVERMEDIA_CARDBUS ; init_data -> type = RC_PROTO_BIT_OTHER ; init_data -> name = "AVerMedia AVerTV card" ; break ; case IVTV_HW_I2C_IR_RX_HAUP_EXT : case IVTV_HW_I2C_IR_RX_HAUP_INT : init_data -> ir_codes = RC_MAP_HAUPPAUGE ; init_data -> internal_get_key_func = IR_KBD_GET_KEY_HAUP ; init_data -> type = RC_PROTO_BIT_RC5 ; init_data -> name = itv -> card_name ; break ; case IVTV_HW_Z8F0811_IR_HAUP : init_data -> ir_codes = RC_MAP_HAUPPAUGE ; init_data -> internal_get_key_func = IR_KBD_GET_KEY_HAUP_XVR ; init_data -> type = RC_PROTO_BIT_RC5 | RC_PROTO_BIT_RC6_MCE | RC_PROTO_BIT_RC6_6A_32 ; init_data -> name = itv -> card_name ; break ; case IVTV_HW_I2C_IR_RX_ADAPTEC : init_data -> get_key = get_key_adaptec ; init_data -> name = itv -> card_name ; init_data -> ir_codes = RC_MAP_EMPTY ; init_data -> type = RC_PROTO_BIT_UNKNOWN ; break ; } info . platform_data = init_data ; strscpy ( info . type , type , I2C_NAME_SIZE ) ; return IS_ERR ( i2c_new_scanned_device ( adap , & info , addr_list , NULL ) ) ?- 1 : 0 ; } 