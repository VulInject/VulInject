static void vgatext_init ( struct gfxp_fb_softc * softc ) { union gfx_console * console = softc -> console ; bitmap_data_t * font_data ; int atr_mode ; short width , height ; int i ; atr_mode = vga_get_atr ( & console -> vga . regs , VGA_ATR_MODE ) ; if ( atr_mode & VGA_ATR_MODE_GRAPH ) { vgatext_set_text ( softc ) ; } atr_mode = vga_get_atr ( & console -> vga . regs , VGA_ATR_MODE ) ; atr_mode &= ~ VGA_ATR_MODE_BLINK ; atr_mode &= ~ VGA_ATR_MODE_9WIDE ; vga_set_atr ( & console -> vga . regs , VGA_ATR_MODE , atr_mode ) ; vga_set_atr ( & console -> vga . regs , VGA_ATR_BDR_CLR , vga_get_atr ( & console -> vga . regs , pc_brt_white ) ) ; vga_set_atr ( & console -> vga . regs , VGA_ATR_BDR_CLR , vga_get_atr ( & console -> vga . regs , pc_black ) ) ; width = VGA_TEXT_COLS ; height = VGA_TEXT_ROWS ; font_data = set_font ( & height , & width , 16 * height + BORDER_PIXELS , 8 * width + BORDER_PIXELS ) ; for ( i = 0 ; i < VFNT_MAPS ; i ++ ) { console -> vga . font . vf_map [ i ] = font_data -> font -> vf_map [ i ] ; console -> vga . font . vf_map_count [ i ] = font_data -> font -> vf_map_count [ i ] ; } console -> vga . font . vf_bytes = font_data -> font -> vf_bytes ; console -> vga . font . vf_width = font_data -> font -> vf_width ; console -> vga . font . vf_height = font_data -> font -> vf_height ; vgatext_setfont ( softc ) ; } 