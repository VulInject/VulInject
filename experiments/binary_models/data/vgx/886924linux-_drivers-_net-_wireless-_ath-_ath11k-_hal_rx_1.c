void ath11k_hal_reo_qdesc_setup ( void * vaddr , int tid , u32 ba_window_size , u32 start_seq , enum hal_pn_type type ) { struct hal_rx_reo_queue * qdesc = ( hal_rx_reo_queue * ) vaddr ; struct hal_rx_reo_queue_ext * ext_desc ; ath11k_hal_reo_set_desc_hdr ( & qdesc -> desc_hdr , HAL_DESC_REO_OWNED , HAL_DESC_REO_QUEUE_DESC , REO_QUEUE_DESC_MAGIC_DEBUG_PATTERN_0 ) ; qdesc -> rx_queue_num = FIELD_PREP ( HAL_RX_REO_QUEUE_RX_QUEUE_NUMBER , tid ) ; qdesc -> info0 = FIELD_PREP ( HAL_RX_REO_QUEUE_INFO0_VLD , 1 ) | FIELD_PREP ( HAL_RX_REO_QUEUE_INFO0_ASSOC_LNK_DESC_COUNTER , 1 ) | FIELD_PREP ( HAL_RX_REO_QUEUE_INFO0_AC , ath11k_tid_to_ac ( tid ) ) ; if ( ba_window_size < 1 ) { ba_window_size = 1 ; } if ( ba_window_size == 1 && tid != HAL_DESC_REO_NON_QOS_TID ) { ba_window_size ++ ; } if ( ba_window_size == 1 ) { qdesc -> info0 |= FIELD_PREP ( HAL_RX_REO_QUEUE_INFO0_RETRY , 1 ) ; } qdesc -> info0 |= FIELD_PREP ( HAL_RX_REO_QUEUE_INFO0_BA_WINDOW_SIZE , ba_window_size - 1 ) ; switch ( type ) { case HAL_PN_TYPE_NONE : case HAL_PN_TYPE_WAPI_EVEN : case HAL_PN_TYPE_WAPI_UNEVEN : break ; case HAL_PN_TYPE_WPA : qdesc -> info0 |= FIELD_PREP ( HAL_RX_REO_QUEUE_INFO0_PN_CHECK , 1 ) | FIELD_PREP ( HAL_RX_REO_QUEUE_INFO0_PN_SIZE , HAL_RX_REO_QUEUE_PN_SIZE_48 ) ; break ; } qdesc -> info0 |= FIELD_PREP ( HAL_RX_REO_QUEUE_INFO0_IGNORE_AMPDU_FLG , 1 ) ; qdesc -> info1 |= FIELD_PREP ( HAL_RX_REO_QUEUE_INFO1_SVLD , 0 ) ; if ( start_seq <= 0xfff ) { qdesc -> info1 = FIELD_PREP ( HAL_RX_REO_QUEUE_INFO1_SSN , start_seq ) ; } if ( tid == HAL_DESC_REO_NON_QOS_TID ) { return ; } ext_desc = qdesc -> ext_desc ; memset ( ext_desc , 0 , sizeof ( * ext_desc ) ) ; ath11k_hal_reo_set_desc_hdr ( & ext_desc -> desc_hdr , HAL_DESC_REO_OWNED , HAL_DESC_REO_QUEUE_EXT_DESC , REO_QUEUE_DESC_MAGIC_DEBUG_PATTERN_1 ) ; ext_desc ++ ; memset ( ext_desc , 0 , sizeof ( * ext_desc ) ) ; ath11k_hal_reo_set_desc_hdr ( & ext_desc -> desc_hdr , HAL_DESC_REO_OWNED , HAL_DESC_REO_QUEUE_EXT_DESC , REO_QUEUE_DESC_MAGIC_DEBUG_PATTERN_2 ) ; ext_desc ++ ; memset ( ext_desc , 0 , sizeof ( * ext_desc ) ) ; ath11k_hal_reo_set_desc_hdr ( & ext_desc -> desc_hdr , HAL_DESC_REO_OWNED , HAL_DESC_REO_QUEUE_EXT_DESC , REO_QUEUE_DESC_MAGIC_DEBUG_PATTERN_3 ) ; } 