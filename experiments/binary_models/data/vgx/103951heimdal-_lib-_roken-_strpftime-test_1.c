int main ( int argc , char * * argv ) { int i , j ; int ret = 0 ; for ( i = 0 ; i < sizeof ( tests ) / sizeof ( tests [ 0 ] ) ; ++ i ) { struct tm * tm ; tm = gmtime ( & tests [ i ] . t ) ; for ( j = 0 ; tests [ i ] . vals [ j ] . format != NULL ; ++ j ) { char buf [ 128 ] ; size_t len ; struct tm tm2 ; char * ptr ; len = strftime ( buf , sizeof ( buf ) , tests [ i ] . vals [ j ] . format , tm ) ; if ( len != strlen ( buf ) ) { printf ( "length of strftime(\"%s\") = %lu (\"%s\")\n" , tests [ i ] . vals [ j ] . format , ( unsigned long ) len , buf ) ; ++ ret ; continue ; } if ( strcmp ( buf , tests [ i ] . vals [ j ] . result ) != 0 ) { printf ( "result of strftime(\"%s\") = \"%s\" != \"%s\"\n" , tests [ i ] . vals [ j ] . format , buf , tests [ i ] . vals [ j ] . result ) ; ++ ret ; continue ; } ptr = strptime ( tests [ i ] . vals [ j ] . result , tests [ i ] . vals [ j ] . format , & tm2 ) ; if ( ptr == NULL || * ptr != '\0' ) { printf ( "bad return value from strptime(" "\"%s\", \"%s\")\n" , tests [ i ] . vals [ j ] . result , tests [ i ] . vals [ j ] . format ) ; ++ ret ; } strftime ( buf , sizeof ( buf ) , tests [ i ] . vals [ j ] . format , & tm2 ) ; if ( strcmp ( buf , tests [ i ] . vals [ j ] . result ) != 0 ) { printf ( "reverse of \"%s\" failed: \"%s\" vs \"%s\"\n" , tests [ i ] . vals [ j ] . format , buf , tests [ i ] . vals [ j ] . result ) ; ++ ret ; } } } { struct tm tm ; memset ( & tm , 0 , sizeof ( tm ) ) ; strptime ( "200505" , "%Y%m" , & tm ) ; if ( tm . tm_year != 105 ) { ++ ret ; } if ( tm . tm_mon != 4 ) { ++ ret ; } } if ( ret ) { printf ( "%d errors\n" , ret ) ; return 1 ; } else { return 0 ; } } 