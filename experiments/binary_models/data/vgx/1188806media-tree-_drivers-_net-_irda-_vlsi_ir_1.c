static int vlsi_stop_hw ( vlsi_irda_dev_t * idev ) { struct pci_dev * pdev = idev -> pdev ; struct net_device * ndev = pci_get_drvdata ( pdev ) ; unsigned iobase = ndev -> base_addr ; unsigned long flags ; spin_lock_irqsave ( & idev -> lock , flags ) ; outw ( 0 , iobase + VLSI_PIO_IRENABLE ) ; outw ( 0 , iobase + VLSI_PIO_IRCFG ) ; outb ( 0 , iobase + VLSI_PIO_IRINTR ) ; wmb ( ) ; outb ( IRINTR_INT_MASK , iobase + VLSI_PIO_IRINTR ) ; spin_unlock_irqrestore ( & idev -> lock , flags ) ; vlsi_unarm_tx ( idev , NULL ) ; vlsi_unarm_rx ( idev ) ; vlsi_clear_regs ( iobase ) ; vlsi_stop_clock ( pdev ) ; pci_disable_device ( pdev ) ; return 0 ; } 