int isocal_ntp64_to_date ( struct isodate * id , const vint64 * ntp ) { ntpcal_split ds ; int32_t ts [ 3 ] ; uint32_t uw , ud , sflag ; ds = ntpcal_daysplit ( ntp ) ; ds . hi += priv_timesplit ( ts , ds . lo ) ; id -> hour = ( uint8_t ) ts [ 0 ] ; id -> minute = ( uint8_t ) ts [ 1 ] ; id -> second = ( uint8_t ) ts [ 2 ] ; ds . hi += DAY_NTP_STARTS - 1 ; sflag = int32_sflag ( ds . hi , NULL ) ; ud = int32_to_uint32_2cpl ( ds . hi ) ; uw = sflag ^ ( ( sflag ^ ud ) / DAYSPERWEEK ) ; ud -= uw * DAYSPERWEEK ; ds . hi = uint32_2cpl_to_int32 ( uw ) ; ds . lo = ud ; id -> weekday = ( uint8_t ) ds . lo + 1 ; ds = isocal_split_eraweeks ( ds . hi ) ; id -> year = ( uint16_t ) ds . hi + 1 ; id -> week = ( uint8_t ) ds . lo + 1 ; return ( ds . hi >= 0 && ds . hi < 0x0000FFFF ) ; } 