static int show_cpuinfo ( struct seq_file * m , void * v ) { unsigned long cpu_id = ( unsigned long ) v - 1 ; unsigned int pvr ; unsigned long proc_freq ; unsigned short maj ; unsigned short min ; preempt_disable ( ) ; if ( ! cpu_online ( cpu_id ) ) { return 0 ; } pvr = per_cpu ( cpu_pvr , cpu_id ) ; pvr = mfspr ( SPRN_PVR ) ; maj = ( pvr >> 8 ) & 0xFF ; min = pvr & 0xFF ; seq_printf ( m , "processor\t: %lu\n" , cpu_id ) ; seq_printf ( m , "cpu\t\t: " ) ; if ( cur_cpu_spec -> pvr_mask && cur_cpu_spec -> cpu_name ) { seq_printf ( m , "%s" , cur_cpu_spec -> cpu_name ) ; } else { seq_printf ( m , "unknown (%08x)" , pvr ) ; } if ( cpu_has_feature ( CPU_FTR_ALTIVEC ) ) { seq_printf ( m , ", altivec supported" ) ; } seq_printf ( m , "\n" ) ; if ( cur_cpu_spec -> cpu_features & CPU_FTR_TAU ) { seq_printf ( m , "temperature \t: %u C (uncalibrated)\n" , cpu_temp ( cpu_id ) ) ; u32 temp ; temp = cpu_temp_both ( cpu_id ) ; seq_printf ( m , "temperature \t: %u-%u C (uncalibrated)\n" , temp & 0xff , temp >> 16 ) ; } if ( ppc_md . get_proc_freq ) { proc_freq = ppc_md . get_proc_freq ( cpu_id ) ; } else { proc_freq = ppc_proc_freq ; } if ( proc_freq ) { seq_printf ( m , "clock\t\t: %lu.%06luMHz\n" , proc_freq / 1000000 , proc_freq % 1000000 ) ; } if ( ppc_md . show_percpuinfo != NULL ) { ppc_md . show_percpuinfo ( m , cpu_id ) ; } if ( PVR_VER ( pvr ) & 0x8000 ) { switch ( PVR_VER ( pvr ) ) { case 0x8000 : case 0x8001 : case 0x8002 : case 0x8003 : case 0x8004 : case 0x800c : maj = ( ( pvr >> 8 ) & 0xF ) ; min = PVR_MIN ( pvr ) ; break ; default : maj = PVR_MAJ ( pvr ) ; min = PVR_MIN ( pvr ) ; break ; } } else { switch ( PVR_VER ( pvr ) ) { case 0x0020 : maj = PVR_MAJ ( pvr ) + 1 ; min = PVR_MIN ( pvr ) ; break ; case 0x1008 : maj = ( ( pvr >> 8 ) & 0xFF ) - 1 ; min = pvr & 0xFF ; break ; default : maj = ( pvr >> 8 ) & 0xFF ; min = pvr & 0xFF ; break ; } } seq_printf ( m , "revision\t: %hd.%hd (pvr %04x %04x)\n" , maj , min , PVR_VER ( pvr ) , PVR_REV ( pvr ) ) ; seq_printf ( m , "bogomips\t: %lu.%02lu\n" , loops_per_jiffy / ( 500000 / HZ ) , ( loops_per_jiffy / ( 5000 / HZ ) ) % 100 ) ; seq_printf ( m , "\n" ) ; preempt_enable ( ) ; if ( cpumask_next ( cpu_id , cpu_online_mask ) >= nr_cpu_ids ) { show_cpuinfo_summary ( m ) ; } return 0 ; } 