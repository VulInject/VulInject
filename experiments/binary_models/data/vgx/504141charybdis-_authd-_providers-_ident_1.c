static void read_ident_reply ( rb_fde_t * F , void * data ) { struct auth_client * auth = data ; char buf [ IDENT_BUFSIZE + 1 ] { 0 } ; ; ident_message message = REPORT_FAIL ; char * s = NULL ; char * t = NULL ; int len ; int count ; len = rb_read ( F , buf , IDENT_BUFSIZE ) ; if ( len < 0 && rb_ignore_errno ( errno ) ) { rb_setselect ( F , RB_SELECT_READ , read_ident_reply , auth ) ; return ; } if ( len > 0 ) { if ( ( s = get_valid_ident ( buf ) ) != NULL ) { t = auth -> username ; while ( * s == '~' || * s == '^' ) { s ++ ; } for ( count = USERLEN ; * s && count ; s ++ ) { if ( * s == '@' || * s == '\r' || * s == '\n' ) { break ; } if ( * s != ' ' && * s != ':' && * s != '[' ) { * t ++ = * s ; count -- ; } } * t = '\0' ; } else { message = REPORT_INVALID ; } } if ( s == NULL ) { client_fail ( auth , message ) ; } else { client_success ( auth ) ; } } 