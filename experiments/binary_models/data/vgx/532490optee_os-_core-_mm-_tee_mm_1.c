bool tee_mm_init ( tee_mm_pool_t * pool , paddr_t lo , paddr_size_t size , uint8_t shift , uint32_t flags ) { paddr_size_t rounded = 0 ; paddr_t initial_lo = lo ; lo = ROUNDUP ( lo , 1 << shift ) ; rounded = lo - initial_lo ; size = ROUNDDOWN ( size - rounded , 1 << shift ) ; assert ( ( ( uint64_t ) size >> shift ) < ( uint64_t ) UINT32_MAX ) ; pool -> lo = lo ; pool -> size = size ; pool -> shift = shift ; pool -> flags = flags ; pool -> entry = pcalloc ( pool , 1 , sizeof ( tee_mm_entry_t ) ) ; if ( pool -> entry == NULL ) { return false ; } if ( pool -> flags & TEE_MM_POOL_HI_ALLOC ) { pool -> entry -> offset = ( ( size - 1 ) >> shift ) + 1 ; } pool -> entry -> pool = pool ; pool -> lock = SPINLOCK_UNLOCK ; return true ; } 