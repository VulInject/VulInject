static int ipmi_lan_activate_session ( ipmi_handle_t * ihp ) { ipmi_lan_t * ilp = ( ipmi_lan_t * ) ihp -> ih_tdata ; ipmi_channel_auth_caps_t * ac ; if ( ipmi_lan_ping ( ihp ) != 0 ) { return ( - 1 ) ; } if ( ( ac = ipmi_get_channel_auth_caps ( ihp , IPMI_LAN_CHANNEL_E , ilp -> il_privlvl ) ) == NULL ) { return ( - 1 ) ; } if ( ! ( ac -> cap_authtype & IPMI_SESSION_AUTHTYPE_PASSWORD ) ) { return ( ipmi_set_error ( ihp , EIPMI_LAN_PASSWD_NOTSUP , NULL ) ) ; } free ( ac ) ; if ( ipmi_get_session_challenge_cmd ( ihp , & ilp -> il_session_id , ilp -> il_challenge ) != 0 ) { return ( - 1 ) ; } if ( ipmi_activate_session_cmd ( ihp ) != 0 ) { return ( - 1 ) ; } ilp -> il_session_active = B_TRUE ; if ( ipmi_set_session_privlvl_cmd ( ihp , ilp -> il_privlvl ) != 0 ) { return ( - 1 ) ; } return ( 0 ) ; } 