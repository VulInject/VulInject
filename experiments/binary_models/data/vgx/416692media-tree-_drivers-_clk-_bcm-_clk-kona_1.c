static unsigned long clk_recalc_rate ( struct ccu_data * ccu , struct bcm_clk_div * div , struct bcm_clk_div * pre_div , unsigned long parent_rate ) { u64 scaled_parent_rate ; u64 scaled_div ; u64 result ; if ( parent_rate > ( unsigned long ) LONG_MAX ) { return 0 ; } if ( pre_div && divider_exists ( pre_div ) ) { u64 scaled_rate ; scaled_rate = scale_rate ( pre_div , parent_rate ) ; scaled_rate = scale_rate ( div , scaled_rate ) ; scaled_div = divider_read_scaled ( ccu , pre_div ) ; scaled_parent_rate = DIV_ROUND_CLOSEST_ULL ( scaled_rate , scaled_div ) ; } else { scaled_parent_rate = scale_rate ( div , parent_rate ) ; } scaled_div = divider_read_scaled ( ccu , div ) ; result = DIV_ROUND_CLOSEST_ULL ( scaled_parent_rate , scaled_div ) ; return ( unsigned long ) result ; } 