static void program_capture_engine ( struct saa7146_dev * dev , int planar ) { struct saa7146_vv * vv = dev -> vv_data ; int count = 0 ; cfs_time_t e_wait = vv -> current_hps_sync == SAA7146_HPS_SYNC_PORT_A ?CMD_E_FID_A : CMD_E_FID_B ; unsigned long o_wait = vv -> current_hps_sync == SAA7146_HPS_SYNC_PORT_A ?CMD_O_FID_A : CMD_O_FID_B ; WRITE_RPS0 ( CMD_PAUSE | CMD_OAN | CMD_SIG0 | o_wait ) ; WRITE_RPS0 ( CMD_PAUSE | CMD_OAN | CMD_SIG0 | e_wait ) ; WRITE_RPS0 ( CMD_WR_REG | ( 1 << 8 ) | ( MC2 / 4 ) ) ; WRITE_RPS0 ( MASK_27 | MASK_11 ) ; WRITE_RPS0 ( CMD_WR_REG_MASK | ( MC1 / 4 ) ) ; WRITE_RPS0 ( MASK_06 | MASK_22 ) ; WRITE_RPS0 ( MASK_06 | MASK_22 ) ; if ( 0 != planar ) { WRITE_RPS0 ( CMD_WR_REG_MASK | ( MC1 / 4 ) ) ; WRITE_RPS0 ( MASK_05 | MASK_21 ) ; WRITE_RPS0 ( MASK_05 | MASK_21 ) ; WRITE_RPS0 ( CMD_WR_REG_MASK | ( MC1 / 4 ) ) ; WRITE_RPS0 ( MASK_04 | MASK_20 ) ; WRITE_RPS0 ( MASK_04 | MASK_20 ) ; } if ( vv -> last_field == V4L2_FIELD_INTERLACED ) { WRITE_RPS0 ( CMD_PAUSE | o_wait ) ; WRITE_RPS0 ( CMD_PAUSE | e_wait ) ; } if ( vv -> last_field == V4L2_FIELD_TOP ) { WRITE_RPS0 ( CMD_PAUSE | ( vv -> current_hps_sync == SAA7146_HPS_SYNC_PORT_A ?MASK_10 : MASK_09 ) ) ; WRITE_RPS0 ( CMD_PAUSE | o_wait ) ; } if ( vv -> last_field == V4L2_FIELD_BOTTOM ) { WRITE_RPS0 ( CMD_PAUSE | ( vv -> current_hps_sync == SAA7146_HPS_SYNC_PORT_A ?MASK_10 : MASK_09 ) ) ; WRITE_RPS0 ( CMD_PAUSE | e_wait ) ; } WRITE_RPS0 ( CMD_WR_REG_MASK | ( MC1 / 4 ) ) ; WRITE_RPS0 ( MASK_22 | MASK_06 ) ; WRITE_RPS0 ( MASK_22 ) ; if ( 0 != planar ) { WRITE_RPS0 ( CMD_WR_REG_MASK | ( MC1 / 4 ) ) ; WRITE_RPS0 ( MASK_05 | MASK_21 ) ; WRITE_RPS0 ( MASK_21 ) ; WRITE_RPS0 ( CMD_WR_REG_MASK | ( MC1 / 4 ) ) ; WRITE_RPS0 ( MASK_04 | MASK_20 ) ; WRITE_RPS0 ( MASK_20 ) ; } WRITE_RPS0 ( CMD_INTERRUPT ) ; WRITE_RPS0 ( CMD_STOP ) ; } 