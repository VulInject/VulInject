static long fb_compat_ioctl ( struct file * file , unsigned int cmd , unsigned long arg ) { struct fb_info * info = file_fb_info ( file ) ; const struct fb_ops * fb ; long ret = - ENOIOCTLCMD ; fb = info -> fbops ; switch ( cmd ) { case FBIOGET_VSCREENINFO : case FBIOPUT_VSCREENINFO : case FBIOPAN_DISPLAY : case FBIOGET_CON2FBMAP : case FBIOPUT_CON2FBMAP : arg = ( unsigned long ) compat_ptr ( arg ) ; fallthrough ; case FBIOBLANK : ret = do_fb_ioctl ( info , cmd , arg ) ; break ; case FBIOGET_FSCREENINFO : ret = fb_get_fscreeninfo ( info , cmd , arg ) ; break ; case FBIOGETCMAP : case FBIOPUTCMAP : ret = fb_getput_cmap ( info , cmd , arg ) ; break ; default : if ( fb -> fb_compat_ioctl ) { ret = fb -> fb_compat_ioctl ( info , cmd , arg ) ; } break ; } return ret ; } 