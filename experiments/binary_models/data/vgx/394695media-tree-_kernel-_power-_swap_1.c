static int write_page ( void * buf , sector_t offset , struct hib_bio_batch * hb ) { void * src ; int ret ; if ( hb ) { src = ( void * ) __get_free_page ( __GFP_RECLAIM | __GFP_NOWARN | __GFP_NORETRY ) ; if ( src ) { copy_page ( src , buf ) ; } else { ret = hib_wait_io ( hb ) ; if ( ret ) { return ret ; } src = ( void * ) __get_free_page ( __GFP_RECLAIM | __GFP_NOWARN | __GFP_NORETRY ) ; if ( src ) { copy_page ( src , buf ) ; } else { WARN_ON_ONCE ( 1 ) ; hb = NULL ; src = buf ; } } } else { src = buf ; } return hib_submit_io ( REQ_OP_WRITE , REQ_SYNC , offset , src , hb ) ; } 