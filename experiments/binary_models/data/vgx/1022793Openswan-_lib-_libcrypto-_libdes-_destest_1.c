int main ( argc , argv ) int argc ; char * argv [ ] ; { int i , j , err = 0 ; des_cblock in , out , outin , iv3 ; des_key_schedule ks , ks2 , ks3 ; unsigned char cbc_in [ 40 ] ; unsigned char cbc_out [ 40 ] ; DES_LONG cs ; unsigned char qret [ 4 ] [ 4 ] , cret [ 8 ] ; DES_LONG lqret [ 4 ] ; int num ; char * str ; printf ( "Doing ecb\n" ) ; for ( i = 0 ; i < NUM_TESTS ; i ++ ) { if ( ( j = des_key_sched ( ( C_Block * ) ( key_data [ i ] ) , ks ) ) != 0 ) { printf ( "Key error %2d:%d\n" , i + 1 , j ) ; err = 1 ; } memcpy ( in , plain_data [ i ] , 8 ) ; memset ( outin , 0 , 8 ) ; des_ecb_encrypt ( ( C_Block * ) in , ( C_Block * ) out , ks , DES_ENCRYPT ) ; des_ecb_encrypt ( ( C_Block * ) out , ( C_Block * ) outin , ks , DES_DECRYPT ) ; if ( memcmp ( out , cipher_data [ i ] , 8 ) != 0 ) { printf ( "Encryption error %2d\nk=%s p=%s o=%s act=%s\n" , i + 1 , pt ( key_data [ i ] ) , pt ( in ) , pt ( cipher_data [ i ] ) , pt ( out ) ) ; err = 1 ; } if ( memcmp ( in , outin , 8 ) != 0 ) { printf ( "Decryption error %2d\nk=%s p=%s o=%s act=%s\n" , i + 1 , pt ( key_data [ i ] ) , pt ( out ) , pt ( in ) , pt ( outin ) ) ; err = 1 ; } } printf ( "Doing ede ecb\n" ) ; for ( i = 0 ; i < ( NUM_TESTS - 1 ) ; i ++ ) { if ( ( j = des_key_sched ( ( C_Block * ) ( key_data [ i ] ) , ks ) ) != 0 ) { err = 1 ; printf ( "Key error %2d:%d\n" , i + 1 , j ) ; } if ( ( j = des_key_sched ( ( C_Block * ) ( key_data [ i + 1 ] ) , ks2 ) ) != 0 ) { printf ( "Key error %2d:%d\n" , i + 2 , j ) ; err = 1 ; } if ( ( j = des_key_sched ( ( C_Block * ) ( key_data [ i + 2 ] ) , ks3 ) ) != 0 ) { printf ( "Key error %2d:%d\n" , i + 3 , j ) ; err = 1 ; } memcpy ( in , plain_data [ i ] , 8 ) ; memset ( out , 0 , 8 ) ; memset ( outin , 0 , 8 ) ; des_ecb2_encrypt ( ( C_Block * ) in , ( C_Block * ) out , ks , ks2 , DES_ENCRYPT ) ; des_ecb2_encrypt ( ( C_Block * ) out , ( C_Block * ) outin , ks , ks2 , DES_DECRYPT ) ; if ( memcmp ( out , cipher_ecb2 [ i ] , 8 ) != 0 ) { printf ( "Encryption error %2d\nk=%s p=%s o=%s act=%s\n" , i + 1 , pt ( key_data [ i ] ) , pt ( in ) , pt ( cipher_ecb2 [ i ] ) , pt ( out ) ) ; err = 1 ; } if ( memcmp ( in , outin , 8 ) != 0 ) { printf ( "Decryption error %2d\nk=%s p=%s o=%s act=%s\n" , i + 1 , pt ( key_data [ i ] ) , pt ( out ) , pt ( in ) , pt ( outin ) ) ; err = 1 ; } } printf ( "Doing cbc\n" ) ; if ( ( j = des_key_sched ( ( C_Block * ) cbc_key , ks ) ) != 0 ) { printf ( "Key error %d\n" , j ) ; err = 1 ; } memset ( cbc_out , 0 , 40 ) ; memset ( cbc_in , 0 , 40 ) ; memcpy ( iv3 , cbc_iv , sizeof ( cbc_iv ) ) ; des_ncbc_encrypt ( ( C_Block * ) cbc_data , ( C_Block * ) cbc_out , ( long ) strlen ( ( char * ) cbc_data ) + 1 , ks , ( C_Block * ) iv3 , DES_ENCRYPT ) ; if ( memcmp ( cbc_out , cbc_ok , 32 ) != 0 ) { printf ( "cbc_encrypt encrypt error\n" ) ; } memcpy ( iv3 , cbc_iv , sizeof ( cbc_iv ) ) ; des_ncbc_encrypt ( ( C_Block * ) cbc_out , ( C_Block * ) cbc_in , ( long ) strlen ( ( char * ) cbc_data ) + 1 , ks , ( C_Block * ) iv3 , DES_DECRYPT ) ; if ( memcmp ( cbc_in , cbc_data , strlen ( ( char * ) cbc_data ) ) != 0 ) { printf ( "cbc_encrypt decrypt error\n" ) ; err = 1 ; } printf ( "Doing desx cbc\n" ) ; if ( ( j = des_key_sched ( ( C_Block * ) cbc_key , ks ) ) != 0 ) { printf ( "Key error %d\n" , j ) ; err = 1 ; } memset ( cbc_out , 0 , 40 ) ; memset ( cbc_in , 0 , 40 ) ; memcpy ( iv3 , cbc_iv , sizeof ( cbc_iv ) ) ; des_xcbc_encrypt ( ( C_Block * ) cbc_data , ( C_Block * ) cbc_out , ( long ) strlen ( ( char * ) cbc_data ) + 1 , ks , ( C_Block * ) iv3 , ( C_Block * ) cbc2_key , ( C_Block * ) cbc3_key , DES_ENCRYPT ) ; if ( memcmp ( cbc_out , xcbc_ok , 32 ) != 0 ) { printf ( "des_xcbc_encrypt encrypt error\n" ) ; } memcpy ( iv3 , cbc_iv , sizeof ( cbc_iv ) ) ; des_xcbc_encrypt ( ( C_Block * ) cbc_out , ( C_Block * ) cbc_in , ( long ) strlen ( ( char * ) cbc_data ) + 1 , ks , ( C_Block * ) iv3 , ( C_Block * ) cbc2_key , ( C_Block * ) cbc3_key , DES_DECRYPT ) ; if ( memcmp ( cbc_in , cbc_data , strlen ( ( char * ) cbc_data ) + 1 ) != 0 ) { printf ( "des_xcbc_encrypt decrypt error\n" ) ; err = 1 ; } printf ( "Doing ede cbc\n" ) ; if ( ( j = des_key_sched ( ( C_Block * ) cbc_key , ks ) ) != 0 ) { printf ( "Key error %d\n" , j ) ; err = 1 ; } if ( ( j = des_key_sched ( ( C_Block * ) cbc2_key , ks2 ) ) != 0 ) { printf ( "Key error %d\n" , j ) ; err = 1 ; } if ( ( j = des_key_sched ( ( C_Block * ) cbc3_key , ks3 ) ) != 0 ) { printf ( "Key error %d\n" , j ) ; err = 1 ; } memset ( cbc_out , 0 , 40 ) ; memset ( cbc_in , 0 , 40 ) ; i = strlen ( ( char * ) cbc_data ) + 1 ; memcpy ( iv3 , cbc_iv , sizeof ( cbc_iv ) ) ; des_ede3_cbc_encrypt ( ( C_Block * ) cbc_data , ( C_Block * ) cbc_out , 16L , ks , ks2 , ks3 , ( C_Block * ) iv3 , DES_ENCRYPT ) ; des_ede3_cbc_encrypt ( ( C_Block * ) & ( cbc_data [ 16 ] ) , ( C_Block * ) & ( cbc_out [ 16 ] ) , ( long ) i - 16 , ks , ks2 , ks3 , ( C_Block * ) iv3 , DES_ENCRYPT ) ; if ( memcmp ( cbc_out , cbc3_ok , ( unsigned int ) ( strlen ( ( char * ) cbc_data ) + 1 + 7 ) / 8 * 8 ) != 0 ) { printf ( "des_ede3_cbc_encrypt chained encrypt error\n" ) ; err = 1 ; } memcpy ( iv3 , cbc_iv , sizeof ( cbc_iv ) ) ; memcpy ( cbc_out , cbc_data , 40 ) ; des_ede3_cbc_encrypt ( ( C_Block * ) cbc_out , ( C_Block * ) cbc_out , 16L , ks , ks2 , ks3 , ( C_Block * ) iv3 , DES_ENCRYPT ) ; des_ede3_cbc_encrypt ( ( C_Block * ) & ( cbc_out [ 16 ] ) , ( C_Block * ) & ( cbc_out [ 16 ] ) , ( long ) i - 16 , ks , ks2 , ks3 , ( C_Block * ) iv3 , DES_ENCRYPT ) ; if ( memcmp ( cbc_out , cbc3_ok , ( unsigned int ) ( strlen ( ( char * ) cbc_data ) + 1 + 7 ) / 8 * 8 ) != 0 ) { printf ( "des_ede3_cbc_encrypt inplace and chained encrypt error\n" ) ; err = 1 ; } memcpy ( iv3 , cbc_iv , sizeof ( cbc_iv ) ) ; des_ede3_cbc_encrypt ( ( C_Block * ) cbc_out , ( C_Block * ) cbc_in , ( long ) i , ks , ks2 , ks3 , ( C_Block * ) iv3 , DES_DECRYPT ) ; if ( memcmp ( cbc_in , cbc_data , strlen ( cbc_data ) + 1 ) != 0 ) { printf ( "des_ede3_cbc_encrypt decrypt error\n" ) ; err = 1 ; } memcpy ( iv3 , cbc_iv , sizeof ( cbc_iv ) ) ; memcpy ( cbc_in , cbc_out , 40 ) ; des_ede3_cbc_encrypt ( ( C_Block * ) cbc_in , ( C_Block * ) cbc_in , ( long ) i , ks , ks2 , ks3 , ( C_Block * ) iv3 , DES_DECRYPT ) ; if ( memcmp ( cbc_in , cbc_data , strlen ( cbc_data ) + 1 ) != 0 ) { printf ( "des_ede3_cbc_encrypt inplace decrypt error\n" ) ; err = 1 ; } } 