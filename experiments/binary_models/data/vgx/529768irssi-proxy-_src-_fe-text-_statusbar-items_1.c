static char * get_activity_list ( MAIN_WINDOW_REC * window , int normal , int hilight ) { THEME_REC * theme ; GString * str ; GString * format ; GList * tmp ; char * ret , * name , * value ; int is_det ; int add_name = settings_get_bool ( "actlist_names" ) ; str = g_string_new ( NULL ) ; format = g_string_new ( NULL ) ; theme = window != NULL && window -> active != NULL && window -> active -> theme != NULL ?window -> active -> theme : current_theme ; for ( tmp = activity_list ; tmp != NULL ; tmp = tmp -> next ) { WINDOW_REC * window = tmp -> data ; is_det = window -> data_level >= DATA_LEVEL_HILIGHT ; if ( ( ! is_det && ! normal ) || ( is_det && ! hilight ) ) { continue ; } if ( str -> len > 0 ) { value = theme_format_expand ( theme , "{sb_act_sep ,}" ) ; g_string_append ( str , value ) ; } switch ( window -> data_level ) { case DATA_LEVEL_NONE : case DATA_LEVEL_TEXT : name = "{sb_act_text %d" ; break ; case DATA_LEVEL_MSG : name = "{sb_act_msg %d" ; break ; default : if ( window -> hilight_color == NULL ) { name = "{sb_act_hilight %d" ; } else { name = NULL ; } break ; } if ( name != NULL ) { g_string_printf ( format , name , window -> refnum ) ; } else { g_string_printf ( format , "{sb_act_hilight_color %s %d" , window -> hilight_color , window -> refnum ) ; } if ( add_name && window -> active != NULL ) { g_string_append_printf ( format , ":%s" , window -> active -> visible_name ) ; } g_string_append_c ( format , '}' ) ; value = theme_format_expand ( theme , format -> str ) ; g_string_append ( str , value ) ; g_free ( value ) ; } ret = str -> len == 0 ?NULL : str -> str ; g_string_free ( str , ret == NULL ) ; g_string_free ( format , TRUE ) ; return ret ; } 