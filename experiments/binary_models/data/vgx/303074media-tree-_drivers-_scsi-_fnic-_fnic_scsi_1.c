static int free_wq_copy_descs ( struct fnic * fnic , struct vnic_wq_copy * wq ) { if ( ! fnic -> fw_ack_recd [ 0 ] ) { return 1 ; } if ( wq -> to_clean_index <= fnic -> fw_ack_index [ 0 ] ) { wq -> ring . desc_avail += ( fnic -> fw_ack_index [ 0 ] - wq -> to_clean_index + 1 ) ; } else { wq -> ring . desc_avail += ( wq -> ring . desc_count - wq -> to_clean_index + fnic -> fw_ack_index [ 0 ] + 1 ) ; } wq -> to_clean_index = ( fnic -> fw_ack_index [ 0 ] + 1 ) % wq -> ring . desc_count ; return 0 ; } 