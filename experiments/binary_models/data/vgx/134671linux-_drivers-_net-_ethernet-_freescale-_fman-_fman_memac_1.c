static int memac_add_hash_mac_address ( struct fman_mac * memac , enet_addr_t * eth_addr ) { struct memac_regs __iomem * regs = memac -> regs ; struct eth_hash_entry * hash_entry ; u32 hash ; u64 addr ; addr = ENET_ADDR_TO_UINT64 ( * eth_addr ) ; if ( ! ( addr & GROUP_ADDRESS ) ) { pr_err ( "Unicast Address\n" ) ; return - EINVAL ; } hash = get_mac_addr_hash_code ( addr ) & HASH_CTRL_ADDR_MASK ; hash_entry = kmalloc ( sizeof ( * hash_entry ) , GFP_ATOMIC ) ; hash_entry -> addr = addr ; INIT_LIST_HEAD ( & hash_entry -> node ) ; list_add_tail ( & hash_entry -> node , & memac -> multicast_addr_hash -> lsts [ hash ] ) ; iowrite32be ( hash | HASH_CTRL_MCAST_EN , & regs -> hashtable_ctrl ) ; return 0 ; } 