libhal_device_get_property_double ( , , , ) { DBusMessage * message ; DBusMessage * reply ; DBusMessageIter iter , reply_iter ; double value ; DBusError _error ; LIBHAL_CHECK_LIBHALCONTEXT ( ctx , - 1.0 ) ; LIBHAL_CHECK_UDI_VALID ( udi , - 1.0 ) ; LIBHAL_CHECK_PARAM_VALID ( key , "*key" , - 1.0 ) ; message = dbus_message_new_method_call ( "org.freedesktop.Hal" , udi , "org.freedesktop.Hal.Device" , "GetPropertyDouble" ) ; if ( message == NULL ) { fprintf ( stderr , "%s %d : Couldn't allocate D-BUS message\n" , __FILE__ , __LINE__ ) ; return - 1.0f ; } dbus_message_iter_init_append ( message , & iter ) ; dbus_message_iter_append_basic ( & iter , DBUS_TYPE_STRING , & key ) ; dbus_error_init ( & _error ) ; reply = dbus_connection_send_with_reply_and_block ( ctx -> connection , message , - 1 , & _error ) ; dbus_message_unref ( message ) ; dbus_move_error ( & _error , error ) ; if ( error != NULL && dbus_error_is_set ( error ) ) { return - 1.0f ; } if ( reply == NULL ) { return - 1.0f ; } dbus_message_iter_init ( reply , & reply_iter ) ; if ( dbus_message_iter_get_arg_type ( & reply_iter ) != DBUS_TYPE_DOUBLE ) { fprintf ( stderr , "%s %d : property '%s' for device '%s' is not " "of type double\n" , __FILE__ , __LINE__ , key , udi ) ; return - 1.0f ; } dbus_message_iter_get_basic ( & reply_iter , & value ) ; dbus_message_unref ( reply ) ; return ( double ) value ; } 