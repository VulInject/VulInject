krb5_error_code krb5_ldap_parse_db_params ( krb5_context context , char * * db_args ) { char * opt = NULL , * val = NULL ; krb5_error_code ret = 0 ; krb5_ldap_context * ctx = context -> dal_handle -> db_context ; if ( db_args == NULL ) { return 0 ; } for ( ; * db_args != NULL ; db_args ++ ) { ret = get_db_opt ( * db_args , & opt , & val ) ; if ( ret ) { cleanup } if ( ! strcmp ( opt , "temporary" ) ) { ret = EINVAL ; k5_setmsg ( context , ret , _ ( "KDB module requires -update argument" ) ) ; cleanup } if ( val == NULL ) { ret = EINVAL ; k5_setmsg ( context , ret , _ ( "'%s' value missing" ) , opt ) ; cleanup } if ( ! strcmp ( opt , "binddn" ) ) { free ( ctx -> bind_dn ) ; ctx -> bind_dn = strdup ( val ) ; if ( ctx -> bind_dn == NULL ) { ret = ENOMEM ; cleanup } } if ( ! strcmp ( opt , "nconns" ) ) { ctx -> max_server_conns = atoi ( val ) ?atoi ( val ) : DEFAULT_CONNS_PER_SERVER ; } if ( ! strcmp ( opt , "bindpwd" ) ) { free ( ctx -> bind_pwd ) ; ctx -> bind_pwd = strdup ( val ) ; if ( ctx -> bind_pwd == NULL ) { ret = ENOMEM ; cleanup } } if ( ! strcmp ( opt , "sasl_mech" ) ) { free ( ctx -> sasl_mech ) ; ctx -> sasl_mech = strdup ( val ) ; if ( ctx -> sasl_mech == NULL ) { ret = ENOMEM ; cleanup } } if ( ! strcmp ( opt , "sasl_authcid" ) ) { ctx -> sasl_authcid = strdup ( val ) ; if ( ctx -> sasl_authcid == NULL ) { ret = ENOMEM ; cleanup } } if ( ! strcmp ( opt , "sasl_authzid" ) ) { free ( ctx -> sasl_authzid ) ; ctx -> sasl_authzid = strdup ( val ) ; if ( ctx -> sasl_authzid == NULL ) { ret = ENOMEM ; cleanup } } if ( ! strcmp ( opt , "sasl_realm" ) ) { free ( ctx -> sasl_realm ) ; ctx -> sasl_realm = strdup ( val ) ; if ( ctx -> sasl_realm == NULL ) { ret = ENOMEM ; cleanup } } if ( ! strcmp ( opt , "host" ) ) { ret = add_server_entry ( context , val ) ; if ( ret ) { cleanup } } if ( ! strcmp ( opt , "debug" ) ) { ctx -> ldap_debug = atoi ( val ) ; } else { ret = EINVAL ; k5_setmsg ( context , ret , _ ( "unknown option '%s'" ) , opt ) ; cleanup } free ( opt ) ; free ( val ) ; opt = val = NULL ; } cleanup free ( opt ) ; free ( val ) ; return ret ; } 