static int snd_emu10k1_efx_playback_open ( struct snd_pcm_substream * substream ) { struct snd_emu10k1 * emu = snd_pcm_substream_chip ( substream ) ; struct snd_emu10k1_pcm * epcm ; struct snd_emu10k1_pcm_mixer * mix ; struct snd_pcm_runtime * runtime = substream -> runtime ; int i ; epcm = kzalloc ( sizeof ( * epcm ) , GFP_KERNEL ) ; if ( epcm == NULL ) { return - ENOMEM ; } epcm -> emu = emu ; epcm -> type = PLAYBACK_EFX ; epcm -> substream = substream ; emu -> pcm_playback_efx_substream = substream ; runtime -> private_data = epcm ; runtime -> private_free = snd_emu10k1_pcm_free_substream ; runtime -> hw = snd_emu10k1_efx_playback ; for ( i = 0 ; i < NUM_EFX_PLAYBACK ; i ++ ) { mix = & emu -> efx_pcm_mixer [ i ] ; mix -> send_routing [ 0 ] [ 0 ] = i ; mix -> send_volume [ 0 ] [ 0 ] = 255 ; mix -> attn [ 0 ] = 0xffff ; mix -> epcm = epcm ; snd_emu10k1_pcm_efx_mixer_notify ( emu , i , 1 ) ; } return 0 ; } 