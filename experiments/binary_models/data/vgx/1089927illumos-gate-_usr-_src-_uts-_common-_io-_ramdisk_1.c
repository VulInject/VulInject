static void rd_phys_free ( page_t * * ppa , pgcnt_t npages ) { pgcnt_t i ; size_t ppalen = npages * sizeof ( page_t * ) ; for ( i = 0 ; i < npages ; ++ i ) { if ( ! page_tryupgrade ( ppa [ i ] ) ) { page_unlock ( ppa [ i ] ) ; while ( ! page_lock ( ppa [ i ] , SE_EXCL , NULL , P_RECLAIM ) ) { } } page_free ( ppa [ i ] , 0 ) ; } kmem_free ( ppa , ppalen ) ; page_unresv ( npages , NULL ) ; rd_tot_physmem -= npages ; } 