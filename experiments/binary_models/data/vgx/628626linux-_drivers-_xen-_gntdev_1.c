static int gntdev_release ( struct inode * inode , struct file * flip ) { struct gntdev_priv * priv = flip -> private_data ; struct gntdev_grant_map * map ; pr_debug ( "priv %p\n" , priv ) ; mutex_lock ( & priv -> lock ) ; while ( ! list_empty ( & priv -> maps ) ) { map = list_entry ( priv -> maps . next , gntdev_grant_map , next ) ; list_del ( & map -> next ) ; gntdev_put_map ( NULL , map ) ; } mutex_unlock ( & priv -> lock ) ; gntdev_dmabuf_fini ( priv -> dmabuf_priv , NULL ) ; kfree ( priv ) ; return 0 ; } 