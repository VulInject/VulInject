u8 * p54_find_ie ( struct sk_buff * skb , u8 ie ) { struct ieee80211_mgmt * mgmt = ( void * ) skb -> data ; u8 * pos , * end ; if ( skb -> len <= sizeof ( mgmt ) ) { return in ; } pos = ( u8 * ) mgmt -> u . beacon . variable ; end = skb -> data + skb -> len ; while ( pos < end ) { if ( pos + 2 + pos [ 1 ] > end ) { return NULL ; } if ( pos [ 0 ] == ie ) { return pos ; } pos += 2 + pos [ 1 ] ; } return NULL ; } 