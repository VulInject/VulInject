extern int mpi_conf_send_stepd ( int fd , uint32_t plugin_id ) { int index ; bool have_conf ; uint32_t len = 0 , ns ; char * mpi_type ; xassert ( plugin_id ) ; slurm_mutex_lock ( & context_lock ) ; if ( ( index = _plugin_idx ( plugin_id ) ) < 0 ) { rwfail } mpi_type = _plugin_type ( index ) ; len = strlen ( mpi_type , NULL ) ; safe_write ( fd , & len , sizeof ( len ) ) ; safe_write ( fd , mpi_type , len ) ; if ( ( have_conf = ( mpi_confs && mpi_confs [ index ] ) ) ) { len = get_buf_offset ( mpi_confs [ index ] ) ; } else { len = 0 ; } ns = htonl ( len ) ; safe_write ( fd , & ns , sizeof ( ns ) ) ; if ( have_conf ) { safe_write ( fd , get_buf_data ( mpi_confs [ index ] ) , len ) ; } slurm_mutex_unlock ( & context_lock ) ; return SLURM_SUCCESS ; rwfail slurm_mutex_unlock ( & context_lock ) ; return SLURM_ERROR ; } 