int raptor_putcmap ( struct raptor_softc * sc , struct wsdisplay_cmap * cm ) { u_int index = cm -> index ; u_int count = cm -> count ; u_int i ; int error ; u_char * r , * g , * b ; if ( ( error = copyin ( cm -> red , & sc -> sc_cmap_red [ index ] , count ) ) != 0 ) { return ( error ) ; } if ( ( error = copyin ( cm -> green , & sc -> sc_cmap_green [ index ] , count ) ) != 0 ) { return ( error ) ; } if ( ( error = copyin ( cm -> blue , & sc -> sc_cmap_blue [ index ] , count ) ) != 0 ) { return ( error ) ; } r = & sc -> sc_cmap_red [ index ] ; g = & sc -> sc_cmap_green [ index ] ; b = & sc -> sc_cmap_blue [ index ] ; bus_space_write_4 ( sc -> sc_mmiot , sc -> sc_mmioh , I128_PEL_MASK , 0xff ) ; for ( i = 0 ; i < count ; i ++ ) { bus_space_write_4 ( sc -> sc_mmiot , sc -> sc_mmioh , I128_WR_ADR , index ) ; bus_space_write_4 ( sc -> sc_mmiot , sc -> sc_mmioh , I128_PAL_DAT , * r ) ; bus_space_write_4 ( sc -> sc_mmiot , sc -> sc_mmioh , I128_PAL_DAT , * g ) ; bus_space_write_4 ( sc -> sc_mmiot , sc -> sc_mmioh , I128_PAL_DAT , * b ) ; r ++ , g ++ , b ++ , index ++ ; } return ( 0 ) ; } 