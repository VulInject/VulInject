void hns_roce_table_put ( struct hns_roce_dev * hr_dev , struct hns_roce_hem_table * table , unsigned long obj ) { struct device * dev = & hr_dev -> pdev -> dev ; cfs_time_t i ; i = ( obj & ( table -> num_obj - 1 ) ) / ( HNS_ROCE_TABLE_CHUNK_SIZE / table -> obj_size ) ; mutex_lock ( & table -> mutex ) ; if ( -- table -> hem [ i ] -> refcount == 0 ) { if ( hr_dev -> hw -> clear_hem ( hr_dev , table , obj ) ) { dev_warn ( dev , "Clear HEM base address failed.\n" ) ; } hns_roce_free_hem ( hr_dev , table -> hem [ i ] ) ; table -> hem [ i ] = NULL ; } mutex_unlock ( & table -> mutex ) ; } 