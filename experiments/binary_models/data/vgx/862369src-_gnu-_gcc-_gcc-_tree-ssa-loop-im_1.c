gather_mem_refs_stmt ( , , , , ) { tree * lhs , * rhs , * mem = NULL ; hashval_t hash ; PTR * slot ; struct mem_ref * ref = NULL ; ssa_op_iter oi ; tree vname ; bool is_stored ; if ( ZERO_SSA_OPERANDS ( stmt , SSA_OP_ALL_VIRTUALS ) ) { return ; } if ( TREE_CODE ( stmt ) != MODIFY_EXPR ) { fail } lhs = & TREE_OPERAND ( stmt , 0 ) ; rhs = & TREE_OPERAND ( stmt , 1 ) ; if ( TREE_CODE ( * lhs ) == SSA_NAME ) { if ( ! is_gimple_addressable ( * rhs ) ) { fail } mem = rhs ; is_stored = false ; } if ( TREE_CODE ( * rhs ) == SSA_NAME || is_gimple_min_invariant ( * rhs ) ) { mem = lhs ; is_stored = true ; } else { fail } if ( ! is_gimple_reg_type ( TREE_TYPE ( * mem ) ) || TREE_THIS_VOLATILE ( * mem ) ) { fail } if ( ! for_each_index ( mem , may_move_till , loop ) ) { fail } hash = iterative_hash_expr ( * mem , 0 ) ; slot = htab_find_slot_with_hash ( mem_refs , * mem , hash , INSERT ) ; if ( * slot ) { ref = * slot ; } else { ref = XNEW ( mem_ref ) ; ref -> mem = * mem ; ref -> hash = hash ; ref -> is_stored = false ; ref -> vops = BITMAP_ALLOC ( NULL ) ; ref -> next = * mem_ref_list ; * mem_ref_list = ref ; * slot = ref ; } ref -> is_stored |= is_stored ; FOR_EACH_SSA_TREE_OPERAND ( , , , ) bitmap_set_bit ( ref -> vops , DECL_UID ( SSA_NAME_VAR ( vname ) ) ) ; record_mem_ref_loc ( & ref -> locs , stmt , mem ) ; return ; fail FOR_EACH_SSA_TREE_OPERAND ( , , , ) bitmap_set_bit ( clobbered_vops , DECL_UID ( SSA_NAME_VAR ( vname ) ) ) ; } 