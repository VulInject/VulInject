static int set_mode ( struct spear_pmx * pmx , int mode ) { struct spear_pmx_mode * pmx_mode = NULL ; int i ; u32 val ; for ( i = 0 ; i < pmx -> machdata -> npmx_modes ; i ++ ) { if ( pmx -> machdata -> pmx_modes [ i ] -> mode == ( 1 << mode ) ) { pmx_mode = pmx -> machdata -> pmx_modes [ i ] ; break ; } } if ( ! pmx_mode ) { return - EINVAL ; } val = pmx_readl ( pmx , pmx_mode -> reg ) ; val &= ~ pmx_mode -> mask ; val |= pmx_mode -> val ; pmx_writel ( pmx , val , pmx_mode -> reg ) ; pmx -> machdata -> mode = pmx_mode -> mode ; dev_info ( pmx -> dev , "Configured Mode: %s with id: %x\n\n" , pmx_mode -> name ?pmx_mode -> name : "no_name" , pmx_mode -> reg ) ; return 0 ; } 