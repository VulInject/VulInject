static int atomisp_s_fmt_cap ( struct file * file , void * fh , struct v4l2_format * f ) { struct video_device * vdev = video_devdata ( file ) ; struct atomisp_device * isp = video_get_drvdata ( vdev ) ; int ret ; if ( isp -> isp_fatal_error ) { ret = - EIO ; rt_mutex_unlock ( & isp -> mutex ) ; return ret ; } ret = atomisp_set_fmt ( vdev , f ) ; rt_mutex_unlock ( & isp -> mutex ) ; return ret ; } 