static struct ib_uobject * lookup_get_fd_uobject ( const struct uverbs_obj_type * type , struct ib_ucontext * ucontext , int id , bool exclusive ) { struct file * f ; struct ib_uobject * uobject ; const struct uverbs_obj_fd_type * fd_type = container_of ( type , uverbs_obj_fd_type , type ) ; if ( exclusive ) { return ERR_PTR ( - EOPNOTSUPP ) ; } f = fget ( id ) ; uobject = f -> private_data ; if ( f -> f_op != fd_type -> fops ) { fput ( f ) ; return ERR_PTR ( - EBADF ) ; } uverbs_uobject_get ( uobject ) ; return uobject ; } 