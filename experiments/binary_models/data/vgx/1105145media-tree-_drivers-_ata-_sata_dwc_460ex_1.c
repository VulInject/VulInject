static int sata_dwc_dma_get_channel_old ( struct sata_dwc_device_port * hsdevp ) { struct sata_dwc_device * hsdev = hsdevp -> hsdev ; struct dw_dma_slave * dws = & sata_dwc_dma_dws ; dma_cap_mask_t mask ; dws -> dma_dev = hsdev -> dev ; dma_cap_zero ( mask , NULL ) ; dma_cap_set ( DMA_SLAVE , mask ) ; hsdevp -> chan = dma_request_channel ( mask , sata_dwc_dma_filter , hsdevp ) ; if ( ! hsdevp -> chan ) { dev_err ( hsdev -> dev , "%s: dma channel unavailable\n" , __func__ ) ; return - EAGAIN ; } return 0 ; } 