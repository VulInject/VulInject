void xfrm_dev_resume ( struct sk_buff * skb ) { struct net_device * dev = skb -> dev ; int ret = NETDEV_TX_BUSY ; struct netdev_queue * txq ; struct softnet_data * sd ; unsigned long flags ; rcu_read_lock ( ) ; txq = netdev_core_pick_tx ( dev , skb , NULL ) ; HARD_TX_LOCK ( dev , txq , smp_processor_id ( ) ) ; if ( ! netif_xmit_frozen_or_stopped ( txq ) ) { skb = dev_hard_start_xmit ( skb , dev , txq , & ret ) ; } HARD_TX_UNLOCK ( dev , txq ) ; if ( ! dev_xmit_complete ( ret ) ) { local_irq_save ( flags ) ; sd = this_cpu_ptr ( & softnet_data ) ; skb_queue_tail ( & sd -> xfrm_backlog , skb ) ; raise_softirq_irqoff ( NET_TX_SOFTIRQ , NULL ) ; local_irq_restore ( flags ) ; } rcu_read_unlock ( ) ; } 