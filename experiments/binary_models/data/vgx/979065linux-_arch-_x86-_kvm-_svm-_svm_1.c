static int svm_cpu_init ( int cpu ) { struct svm_cpu_data * sd = per_cpu_ptr ( & svm_data , cpu ) ; int ret = - ENOMEM ; sd -> save_area = alloc_page ( GFP_KERNEL | __GFP_ZERO ) ; if ( ! sd -> save_area ) { return ret ; } ret = sev_cpu_init ( sd ) ; if ( ret ) { free_save_area } sd -> save_area_pa = __sme_page_pa ( sd -> save_area ) ; return 0 ; free_save_area __free_page ( sd -> save_area ) ; sd -> save_area = NULL ; return ret ; } 