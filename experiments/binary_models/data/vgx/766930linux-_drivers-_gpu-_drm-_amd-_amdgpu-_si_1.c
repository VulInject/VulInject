static int si_get_pcie_lanes ( struct amdgpu_device * adev ) { u32 link_width_cntl ; link_width_cntl = RREG32_PCIE_PORT ( PCIE_LC_LINK_WIDTH_CNTL ) ; switch ( ( link_width_cntl & LC_LINK_WIDTH_RD_MASK ) >> LC_LINK_WIDTH_RD_SHIFT ) { case LC_LINK_WIDTH_X1 : return 1 ; case LC_LINK_WIDTH_X2 : return 2 ; case LC_LINK_WIDTH_X4 : return 4 ; case LC_LINK_WIDTH_X8 : return 8 ; case LC_LINK_WIDTH_X0 : case LC_LINK_WIDTH_X16 : default : return 16 ; } } 