ripng_multicast_join ( ) { int ret ; struct ipv6_mreq mreq ; int save_errno ; if ( if_is_up ( ifp ) && if_is_multicast ( ifp ) ) { inet_pton ( AF_INET6 , RIPNG_GROUP , & mreq . ipv6mr_multiaddr ) ; mreq . ipv6mr_interface = ifp -> ifindex ; if ( ripngd_privs . change ( ZPRIVS_RAISE ) ) { zlog_err ( "ripng_multicast_join: could not raise privs" ) ; } ret = setsockopt ( ripng -> sock , IPPROTO_IPV6 , IPV6_JOIN_GROUP , ( char * ) & mreq , sizeof ( mreq ) ) ; save_errno = errno ; if ( ripngd_privs . change ( ZPRIVS_LOWER ) ) { zlog_err ( "ripng_multicast_join: could not lower privs" ) ; } if ( ret < 0 && save_errno == EADDRINUSE ) { zlog_warn ( "ripng join on %s EADDRINUSE (ignoring)\n" , ifp -> name ) ; return 0 ; } if ( ret < 0 ) { zlog_warn ( "can't setsockopt IPV6_JOIN_GROUP: %s" , safe_strerror ( save_errno ) ) ; } if ( IS_RIPNG_DEBUG_EVENT ) { zlog_debug ( "RIPng %s join to all-rip-routers multicast group" , ifp -> name ) ; } if ( ret < 0 ) { return - 1 ; } } return 0 ; } 