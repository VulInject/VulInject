static int create_ok ( struct gfs2_inode * dip , const struct qstr * name , umode_t mode ) { int error ; error = gfs2_permission ( & nop_mnt_idmap , & dip -> i_inode , MAY_WRITE | MAY_EXEC ) ; if ( error ) { return error ; } if ( ! dip -> i_inode . i_nlink ) { return - ENOENT ; } if ( S_ISDIR ( mode ) && dip -> i_inode . i_nlink == ( u32 ) - 1 ) { return - EMLINK ; } return 0 ; } 