gui_bar_item_get_value ( , , , ) { char * item_value , delimiter_color [ 32 ] , bar_color [ 32 ] ; char * * result , str_attr [ 8 ] ; struct t_gui_buffer * buffer ; struct t_gui_bar_item * ptr_item ; if ( ! bar || ! bar -> items_array [ item ] [ subitem ] ) { return in ; } buffer = ( window ) ?window -> buffer : ( ( gui_current_window ) ?gui_current_window -> buffer : NULL ) ; item_value = NULL ; if ( bar -> items_name [ item ] [ subitem ] ) { if ( bar -> items_buffer [ item ] [ subitem ] ) { buffer = gui_buffer_search_by_full_name ( bar -> items_buffer [ item ] [ subitem ] ) ; if ( ! buffer ) { return NULL ; } } ptr_item = gui_bar_item_search_with_plugin ( ( buffer ) ?buffer -> plugin : NULL , 0 , bar -> items_name [ item ] [ subitem ] ) ; if ( ptr_item && ptr_item -> build_callback ) { item_value = ( ptr_item -> build_callback ) ( ptr_item -> build_callback_pointer , ptr_item -> build_callback_data , ptr_item , window , buffer , NULL ) ; } if ( item_value && ! item_value [ 0 ] ) { free ( item_value ) ; item_value = NULL ; } if ( ! item_value ) { return NULL ; } } result = string_dyn_alloc ( 128 ) ; if ( ! result ) { if ( item_value ) { free ( item_value ) ; } return NULL ; } delimiter_color [ 0 ] = '\0' ; bar_color [ 0 ] = '\0' ; if ( bar -> items_prefix [ item ] [ subitem ] || bar -> items_suffix [ item ] [ subitem ] ) { gui_color_attr_build_string ( CONFIG_COLOR ( bar -> options [ GUI_BAR_OPTION_COLOR_FG ] ) , str_attr ) ; if ( CONFIG_COLOR ( bar -> options [ GUI_BAR_OPTION_COLOR_FG ] ) & GUI_COLOR_EXTENDED_FLAG ) { snprintf ( bar_color , sizeof ( bar_color ) , "%c%c%c%s%05d" , GUI_COLOR_COLOR_CHAR , GUI_COLOR_FG_CHAR , GUI_COLOR_EXTENDED_CHAR , str_attr , CONFIG_COLOR ( bar -> options [ GUI_BAR_OPTION_COLOR_FG ] ) & GUI_COLOR_EXTENDED_MASK ) ; } else { snprintf ( bar_color , sizeof ( bar_color ) , "%c%c%s%02d" , GUI_COLOR_COLOR_CHAR , GUI_COLOR_FG_CHAR , str_attr , CONFIG_COLOR ( bar -> options [ GUI_BAR_OPTION_COLOR_FG ] ) & GUI_COLOR_EXTENDED_MASK ) ; } gui_color_attr_build_string ( CONFIG_COLOR ( bar -> options [ GUI_BAR_OPTION_COLOR_DELIM ] ) , str_attr ) ; if ( CONFIG_COLOR ( bar -> options [ GUI_BAR_OPTION_COLOR_DELIM ] ) & GUI_COLOR_EXTENDED_FLAG ) { snprintf ( delimiter_color , sizeof ( delimiter_color ) , "%c%c%c%s%05d" , GUI_COLOR_COLOR_CHAR , GUI_COLOR_FG_CHAR , GUI_COLOR_EXTENDED_CHAR , str_attr , CONFIG_COLOR ( bar -> options [ GUI_BAR_OPTION_COLOR_DELIM ] ) & GUI_COLOR_EXTENDED_MASK ) ; } else { snprintf ( delimiter_color , sizeof ( delimiter_color ) , "%c%c%s%02d" , GUI_COLOR_COLOR_CHAR , GUI_COLOR_FG_CHAR , str_attr , CONFIG_COLOR ( bar -> options [ GUI_BAR_OPTION_COLOR_DELIM ] ) & GUI_COLOR_EXTENDED_MASK ) ; } } if ( bar -> items_prefix [ item ] [ subitem ] ) { string_dyn_concat ( result , delimiter_color , - 1 ) ; string_dyn_concat ( result , bar -> items_prefix [ item ] [ subitem ] , - 1 ) ; string_dyn_concat ( result , bar_color , - 1 ) ; } if ( item_value ) { string_dyn_concat ( result , item_value , - 1 ) ; } if ( bar -> items_suffix [ item ] [ subitem ] ) { string_dyn_concat ( result , delimiter_color , - 1 ) ; string_dyn_concat ( result , bar -> items_suffix [ item ] [ subitem ] , - 1 ) ; } if ( item_value ) { free ( item_value ) ; } return string_dyn_free ( result , 0 ) ; } 