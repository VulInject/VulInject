void PaWin_InitializeWaveFormatExtensible ( PaWinWaveFormat * waveFormat , int numChannels , PaSampleFormat sampleFormat , int waveFormatTag , double sampleRate , PaWinWaveFormatChannelMask channelMask ) { WAVEFORMATEX * waveFormatEx = ( WAVEFORMATEX * ) waveFormat ; int bytesPerSample = Pa_GetSampleSize ( sampleFormat ) ; cfs_time_t bytesPerFrame = numChannels * bytesPerSample ; GUID guid ; waveFormatEx -> wFormatTag = WAVE_FORMAT_EXTENSIBLE ; waveFormatEx -> nChannels = ( WORD ) numChannels ; waveFormatEx -> nSamplesPerSec = ( DWORD ) sampleRate ; waveFormatEx -> nAvgBytesPerSec = waveFormatEx -> nSamplesPerSec * bytesPerFrame ; waveFormatEx -> nBlockAlign = ( WORD ) bytesPerFrame ; waveFormatEx -> wBitsPerSample = bytesPerSample * 8 ; waveFormatEx -> cbSize = 22 ; memcpy ( & waveFormat -> fields [ PAWIN_INDEXOF_WVALIDBITSPERSAMPLE ] , & waveFormatEx -> wBitsPerSample , sizeof ( WORD ) ) ; memcpy ( & waveFormat -> fields [ PAWIN_INDEXOF_DWCHANNELMASK ] , & channelMask , sizeof ( DWORD ) ) ; guid = pawin_ksDataFormatSubtypeGuidBase ; guid . Data1 = ( USHORT ) waveFormatTag ; memcpy ( & waveFormat -> fields [ PAWIN_INDEXOF_SUBFORMAT ] , & guid , sizeof ( GUID ) ) ; } 