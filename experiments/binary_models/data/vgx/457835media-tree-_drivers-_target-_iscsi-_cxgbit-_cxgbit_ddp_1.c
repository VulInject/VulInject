int cxgbit_ddp_init ( struct cxgbit_device * cdev ) { struct cxgb4_lld_info * lldi = & cdev -> lldi ; struct net_device * ndev = cdev -> lldi . ports [ 0 ] ; struct cxgbi_tag_format tformat ; unsigned int ppmax ; int ret , i ; if ( ! lldi -> vr -> iscsi . size ) { pr_warn ( "%s, iscsi NOT enabled, check config!\n" , ndev -> name ) ; return - EACCES ; } ppmax = lldi -> vr -> iscsi . size >> PPOD_SIZE_SHIFT ; for ( i = 0 ; i < 4 ; i ++ ) { tformat . pgsz_order [ i ] = ( lldi -> iscsi_pgsz_order >> ( i << 3 ) ) & 0xF ; } cxgbi_tagmask_check ( lldi -> iscsi_tagmask , & tformat ) ; ret = cxgbi_ppm_init ( lldi -> iscsi_ppm , cdev -> lldi . ports [ 0 ] , cdev -> lldi . pdev , & cdev -> lldi , & tformat , ppmax , lldi -> iscsi_llimit , lldi -> vr -> iscsi . start , 2 ) ; if ( ret >= 0 ) { struct cxgbi_ppm * ppm = ( cxgbi_ppm * ) ( * lldi -> iscsi_ppm ) ; if ( ( ppm -> tformat . pgsz_idx_dflt < DDP_PGIDX_MAX ) && ( ppm -> ppmax >= 1024 ) ) { set_bit ( CDEV_DDP_ENABLE , & cdev -> flags ) ; } ret = 0 ; } return ret ; } 