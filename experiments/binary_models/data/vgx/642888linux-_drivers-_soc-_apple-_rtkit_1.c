int apple_rtkit_reinit ( struct apple_rtkit * rtk ) { mbox_free_channel ( rtk -> mbox_chan ) ; flush_workqueue ( rtk -> wq ) ; apple_rtkit_free_buffer ( rtk , & rtk -> ioreport_buffer ) ; apple_rtkit_free_buffer ( rtk , & rtk -> crashlog_buffer ) ; apple_rtkit_free_buffer ( rtk , & rtk -> syslog_buffer ) ; kfree ( rtk -> syslog_msg_buffer ) ; rtk -> syslog_n_entries = 0 ; rtk -> syslog_msg_size = 0 ; bitmap_zero ( rtk -> endpoints , APPLE_RTKIT_MAX_ENDPOINTS ) ; set_bit ( APPLE_RTKIT_EP_MGMT , rtk -> endpoints ) ; reinit_completion ( & rtk -> epmap_completion ) ; reinit_completion ( & rtk -> iop_pwr_ack_completion ) ; reinit_completion ( & rtk -> ap_pwr_ack_completion ) ; rtk -> crashed = false ; rtk -> iop_power_state = APPLE_RTKIT_PWR_STATE_OFF ; rtk -> ap_power_state = APPLE_RTKIT_PWR_STATE_OFF ; return apple_rtkit_request_mbox_chan ( rtk ) ; } 