int dicread ( const char * filename ) { int i , ecount = 0 ; const char * envfile ; char buff [ BUFFERLEN ] ; FILE * fp ; if ( filename != NULL ) { filename = KP_find_file ( & kp_dict , filename ) ; if ( kpse_in_name_ok ( filename ) ) { fp = fopen ( filename , "rb" ) ; } else { fp = NULL ; } if ( fp == NULL ) { warn_printf ( efp , "Warning: Couldn't find dictionary file %s.\n" , filename ) ; ENV } verb_printf ( efp , "Scanning dictionary file %s." , filename ) ; for ( i = 0 ; ; i ++ ) { if ( fgets ( buff , BUFFERLEN - 1 , fp ) == NULL ) { break ; } if ( ( buff [ 0 ] == '\r' ) || ( buff [ 0 ] == '\n' ) || ( buff [ 0 ] == '\0' ) ) { i -- ; } } fclose ( fp , NULL ) ; dictable = xmalloc ( sizeof ( dictionary ) * i ) ; dlines = dicvalread ( filename , dictable , i ) ; verb_printf ( efp , "...done.\n" ) ; } ENV envfile = kpse_var_value ( "INDEXDEFAULTDICTIONARY" ) ; if ( ( envfile != NULL ) && ( strlen ( envfile ) != 0 ) ) { envfile = KP_find_file ( & kp_dict , envfile ) ; if ( kpse_in_name_ok ( envfile ) ) { fp = fopen ( envfile , "rb" ) ; } else { fp = NULL ; } if ( fp == NULL ) { warn_printf ( efp , "Warning: Couldn't find environment dictionary file %s.\n" , envfile ) ; return ecount ; } verb_printf ( efp , "Scanning environment dictionary file %s." , envfile ) ; for ( i = 0 ; ; i ++ ) { if ( fgets ( buff , 255 , fp ) == NULL ) { break ; } if ( ( buff [ 0 ] == '\r' ) || ( buff [ 0 ] == '\n' ) || ( buff [ 0 ] == '\0' ) ) { i -- ; } } fclose ( fp ) ; envdic = xmalloc ( sizeof ( dictionary ) * i ) ; elines = dicvalread ( envfile , envdic , i ) ; verb_printf ( efp , "...done.\n" ) ; } return 0 ; } 