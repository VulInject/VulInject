static int e100_configure ( struct nic * nic , struct cb * cb , struct sk_buff * skb ) { struct config * config = & cb -> u . config ; u8 * c = ( u8 * ) config ; struct net_device * netdev = nic -> netdev ; cb -> command = cpu_to_le16 ( cb_config ) ; config -> byte_count = 0x16 ; config -> rx_fifo_limit = 0x8 ; config -> direct_rx_dma = 0x1 ; config -> standard_tcb = 0x1 ; config -> standard_stat_counter = 0x1 ; config -> rx_discard_short_frames = 0x1 ; config -> tx_underrun_retry = 0x3 ; if ( e100_phy_supports_mii ( nic ) ) { config -> mii_mode = 1 ; } config -> pad10 = 0x6 ; config -> no_source_addr_insertion = 0x1 ; config -> preamble_length = 0x2 ; config -> ifs = 0x6 ; config -> ip_addr_hi = 0xF2 ; config -> pad15_1 = 0x1 ; config -> pad15_2 = 0x1 ; config -> crs_or_cdt = 0x0 ; config -> fc_delay_hi = 0x40 ; config -> tx_padding = 0x1 ; config -> fc_priority_threshold = 0x7 ; config -> pad18 = 0x1 ; config -> full_duplex_pin = 0x1 ; config -> pad20_1 = 0x1F ; config -> fc_priority_location = 0x1 ; config -> pad21_1 = 0x5 ; config -> adaptive_ifs = nic -> adaptive_ifs ; config -> loopback = nic -> loopback ; if ( nic -> mii . force_media && nic -> mii . full_duplex ) { config -> full_duplex_force = 0x1 ; } if ( nic -> flags & promiscuous || nic -> loopback ) { config -> rx_save_bad_frames = 0x1 ; config -> rx_discard_short_frames = 0x0 ; config -> promiscuous_mode = 0x1 ; } if ( unlikely ( netdev -> features & NETIF_F_RXFCS ) ) { config -> rx_crc_transfer = 0x1 ; } if ( nic -> flags & multicast_all ) { config -> multicast_all = 0x1 ; } if ( netif_running ( nic -> netdev ) || ! ( nic -> flags & wol_magic ) ) { config -> magic_packet_disable = 0x1 ; } if ( nic -> mac >= mac_82558_D101_A4 ) { config -> fc_disable = 0x1 ; config -> mwi_enable = 0x1 ; config -> standard_tcb = 0x0 ; config -> rx_long_ok = 0x1 ; if ( nic -> mac >= mac_82559_D101M ) { config -> tno_intr = 0x1 ; if ( nic -> mac >= mac_82551_10 ) { config -> byte_count = 0x20 ; config -> rx_d102_mode = 0x1 ; } } else { config -> standard_stat_counter = 0x0 ; } } if ( netdev -> features & NETIF_F_RXALL ) { config -> rx_save_overruns = 0x1 ; config -> rx_save_bad_frames = 0x1 ; config -> rx_discard_short_frames = 0x0 ; } netif_printk ( nic , hw , KERN_DEBUG , nic -> netdev , "[00-07]=%8ph\n" , c + 0 ) ; netif_printk ( nic , hw , KERN_DEBUG , nic -> netdev , "[08-15]=%8ph\n" , c + 8 ) ; netif_printk ( nic , hw , KERN_DEBUG , nic -> netdev , "[16-23]=%8ph\n" , c + 16 ) ; return 0 ; } 