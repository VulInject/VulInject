static void krait_evt_setup ( int idx , u32 config_base ) { u32 val ; u32 mask ; u32 vval , fval ; unsigned int region = EVENT_REGION ( config_base ) ; int group = EVENT_GROUP ( config_base ) ; unsigned int code = EVENT_CODE ( config_base ) ; unsigned int group_shift ; bool venum_event = EVENT_VENUM ( config_base ) ; group_shift = group * 8 ; mask = 0xff << group_shift ; if ( venum_event ) { val = KRAIT_VPMRESR0_GROUP0 ; } else { val = krait_get_pmresrn_event ( region ) ; } val += group ; val |= config_base & ( ARMV7_EXCLUDE_USER | ARMV7_EXCLUDE_PL1 ) ; armv7_pmnc_write_evtsel ( idx , val ) ; if ( venum_event ) { venum_pre_pmresr ( & vval , & fval ) ; val = venum_read_pmresr ( ) ; val &= ~ mask ; val |= code << group_shift ; val |= PMRESRn_EN ; venum_write_pmresr ( val ) ; venum_post_pmresr ( vval , fval ) ; } else { val = krait_read_pmresrn ( region ) ; val &= ~ mask ; val |= code << group_shift ; val |= PMRESRn_EN ; krait_write_pmresrn ( region , val ) ; } } 