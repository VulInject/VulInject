void mcdec_finalize ( GF_Filter * filter ) { GF_MCDecCtx * ctx = gf_filter_get_udta ( filter ) ; if ( ctx -> format && AMediaFormat_delete ( ctx -> format ) != AMEDIA_OK ) { GF_LOG ( GF_LOG_ERROR , GF_LOG_CODEC , ( "[MCDec] AMediaFormat_delete failed\n" ) ) ; } if ( ctx -> codec && AMediaCodec_delete ( ctx -> codec ) != AMEDIA_OK ) { GF_LOG ( GF_LOG_ERROR , GF_LOG_CODEC , ( "[MCDec] AMediaCodec_delete failed\n" ) ) ; } if ( ctx -> window ) { ANativeWindow_release ( ctx -> window ) ; ctx -> window = NULL ; } if ( ctx -> surfaceTex . texture_id ) { mcdec_delete_surface ( ctx -> surfaceTex ) ; } if ( ctx -> tex_id ) { glDeleteTextures ( 1 , & ctx -> tex_id ) ; } mcdec_reset_ps_list ( ctx -> SPSs ) ; gf_list_del ( ctx -> SPSs ) ; mcdec_reset_ps_list ( ctx -> PPSs ) ; gf_list_del ( ctx -> PPSs ) ; mcdec_reset_ps_list ( ctx -> VPSs ) ; gf_list_del ( ctx -> VPSs ) ; while ( gf_list_count ( ctx -> frames_res ) ) { GF_MCDecFrame * f = gf_list_pop_back ( ctx -> frames_res ) ; gf_free ( f ) ; } gf_list_del ( ctx -> frames_res , NULL ) ; gf_list_del ( ctx -> streams ) ; } 