void rxrpc_process_delayed_final_acks ( struct rxrpc_connection * conn , bool force ) { unsigned long j = jiffies , next_j ; unsigned int channel ; bool set ; again next_j = j + LONG_MAX ; set = false ; for ( channel = 0 ; channel < RXRPC_MAXCALLS ; channel ++ ) { struct rxrpc_channel * chan = & conn -> channels [ channel ] ; cfs_time_t ack_at ; if ( ! test_bit ( RXRPC_CONN_FINAL_ACK_0 + channel , & conn -> flags ) ) { continue ; } ack_at = chan -> final_ack_at ; if ( time_before ( j , ack_at ) && ! force ) { if ( time_before ( ack_at , next_j ) ) { next_j = ack_at ; set = true ; } continue ; } if ( test_and_clear_bit ( RXRPC_CONN_FINAL_ACK_0 + channel , & conn -> flags ) ) { rxrpc_conn_retransmit_call ( conn , NULL , channel ) ; } } j = jiffies ; if ( time_before_eq ( next_j , j ) ) { again } if ( set ) { rxrpc_reduce_conn_timer ( conn , next_j ) ; } } 