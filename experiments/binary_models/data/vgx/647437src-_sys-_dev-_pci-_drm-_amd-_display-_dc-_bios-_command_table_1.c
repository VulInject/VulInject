static enum bp_result transmitter_control_v4 ( struct bios_parser * bp , struct bp_transmitter_control * cntl ) { enum bp_result result = BP_RESULT_FAILURE ; DIG_TRANSMITTER_CONTROL_PARAMETERS_V4 params ; uint32_t ref_clk_src_id ; enum connector_id conn_id = dal_graphics_object_id_get_connector_id ( cntl -> connector_obj_id ) ; const struct command_table_helper * cmd = bp -> cmd_helper ; switch ( cntl -> transmitter ) { case TRANSMITTER_UNIPHY_A : case TRANSMITTER_UNIPHY_B : case TRANSMITTER_UNIPHY_C : case TRANSMITTER_UNIPHY_D : case TRANSMITTER_UNIPHY_E : case TRANSMITTER_UNIPHY_F : case TRANSMITTER_TRAVIS_LCD : break ; default : return BP_RESULT_BADINPUT ; } if ( ! cmd -> clock_source_id_to_ref_clk_src ( cntl -> pll_id , & ref_clk_src_id ) ) { return BP_RESULT_BADINPUT ; } switch ( cntl -> action ) { case TRANSMITTER_CONTROL_INIT : { if ( ( CONNECTOR_ID_DUAL_LINK_DVII == conn_id ) || ( CONNECTOR_ID_DUAL_LINK_DVID == conn_id ) ) { params . acConfig . fDualLinkConnector = 1 ; } params . usInitInfo = cpu_to_le16 ( ( uint8_t ) ( cntl -> connector_obj_id . id ) ) ; } break ; case TRANSMITTER_CONTROL_SET_VOLTAGE_AND_PREEMPASIS : params . asMode . ucLaneSel = ( uint8_t ) ( cntl -> lane_select ) ; params . asMode . ucLaneSet = ( uint8_t ) ( cntl -> lane_settings ) ; break ; default : if ( ( CONNECTOR_ID_DUAL_LINK_DVII == conn_id ) || ( CONNECTOR_ID_DUAL_LINK_DVID == conn_id ) ) { params . acConfig . fDualLinkConnector = 1 ; } if ( LANE_COUNT_FOUR < cntl -> lanes_number ) { params . usPixelClock = cpu_to_le16 ( ( uint16_t ) ( cntl -> pixel_clock / 20 ) ) ; } else { params . usPixelClock = cpu_to_le16 ( ( uint16_t ) ( cntl -> pixel_clock / 10 ) ) ; } break ; } params . acConfig . fCoherentMode = cntl -> coherent ; if ( ( TRANSMITTER_UNIPHY_B == cntl -> transmitter ) || ( TRANSMITTER_UNIPHY_D == cntl -> transmitter ) || ( TRANSMITTER_UNIPHY_F == cntl -> transmitter ) ) { params . acConfig . ucLinkSel = 1 ; } if ( ENGINE_ID_DIGB == cntl -> engine_id ) { params . acConfig . ucEncoderSel = 1 ; } params . acConfig . ucTransmitterSel = ( uint8_t ) ( cmd -> transmitter_bp_to_atom ( cntl -> transmitter ) ) ; params . ucLaneNum = ( uint8_t ) ( cntl -> lanes_number ) ; params . acConfig . ucRefClkSource = ( uint8_t ) ( ref_clk_src_id ) ; params . ucAction = ( uint8_t ) ( cntl -> action ) ; if ( EXEC_BIOS_CMD_TABLE ( UNIPHYTransmitterControl , params ) ) { result = BP_RESULT_OK ; } return result ; } 