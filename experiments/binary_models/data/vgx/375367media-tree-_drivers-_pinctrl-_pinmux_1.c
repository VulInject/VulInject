static const char * pin_free ( struct pinctrl_dev * pctldev , int pin , struct pinctrl_gpio_range * gpio_range ) { const struct pinmux_ops * ops = pctldev -> desc -> pmxops ; struct pin_desc * desc ; const char * owner ; desc = pin_desc_get ( pctldev , pin ) ; if ( desc == NULL ) { dev_err ( pctldev -> dev , "pin is not registered so it cannot be freed\n" ) ; return NULL ; } if ( ! gpio_range ) { if ( WARN_ON ( ! desc -> mux_usecount ) ) { return in ; } desc -> mux_usecount -- ; if ( desc -> mux_usecount ) { return NULL ; } } if ( gpio_range && ops -> gpio_disable_free ) { ops -> gpio_disable_free ( pctldev , gpio_range , pin ) ; } if ( ops -> free ) { ops -> free ( pctldev , pin ) ; } if ( gpio_range ) { owner = desc -> gpio_owner ; desc -> gpio_owner = NULL ; } else { owner = desc -> mux_owner ; desc -> mux_owner = NULL ; desc -> mux_setting = NULL ; } module_put ( pctldev -> owner ) ; return owner ; } 