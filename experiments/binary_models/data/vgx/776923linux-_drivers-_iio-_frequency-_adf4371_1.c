static ssize_t adf4371_write ( struct iio_dev * indio_dev , uintptr_t private , const struct iio_chan_spec * chan , const char * buf , size_t len ) { struct adf4371_state * st = iio_priv ( indio_dev ) ; unsigned long long freq ; bool power_down ; unsigned int bit , readval , reg ; int ret ; mutex_lock ( & st -> lock ) ; switch ( ( u32 ) private ) { case ADF4371_FREQ : ret = kstrtoull ( buf , 10 , & freq ) ; ret = adf4371_set_freq ( st , freq , chan -> channel ) ; break ; case ADF4371_POWER_DOWN : ret = kstrtobool ( buf , & power_down ) ; if ( ret ) { break ; } reg = adf4371_pwrdown_ch [ chan -> channel ] . reg ; bit = adf4371_pwrdown_ch [ chan -> channel ] . bit ; ret = regmap_read ( st -> regmap , reg , & readval ) ; if ( ret < 0 ) { break ; } readval &= ~ BIT ( bit ) ; readval |= ( ! power_down << bit ) ; ret = regmap_write ( st -> regmap , reg , readval ) ; break ; default : ret = - EINVAL ; break ; } mutex_unlock ( & st -> lock ) ; return ret ?ret : len ; } 