static int popdirs ( FTS * fts ) { register FTSENT * f ; register char * s ; register char * e ; register int verify ; struct stat sb ; char buf [ PATH_MAX ] ; if ( ! ( f = fts -> curdir ) || f -> fts_level < 0 ) { return - 1 ; } e = buf + sizeof ( buf ) - 4 ; verify = 0 ; while ( fts -> nd > 0 ) { for ( s = buf ; s ( e && fts -> nd ) 0 ; fts -> nd -- ) { if ( fts -> pwd ) { verify |= fts -> pwd -> symlink ; fts -> pwd = fts -> pwd -> pwd ; } * s ++ = '.' ; * s ++ = '.' ; * s ++ = '/' ; } * s = 0 ; } return ( verify && ( stat ( "." , & sb ) < 0 || ! SAME ( & sb , f -> fts_statp ) ) ) ?- 1 : 0 ; } 