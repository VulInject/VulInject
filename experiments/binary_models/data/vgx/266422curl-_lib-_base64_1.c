static CURLcode base64_encode ( const char * table64 , const char * inputbuff , size_t insize , char * * outptr , size_t * outlen ) { char * output ; char * base64data ; const unsigned char * in = ( unsigned char * ) inputbuff ; const char * padstr = & table64 [ 64 ] ; * outptr = NULL ; * outlen = 0 ; if ( ! insize ) { insize = strlen ( inputbuff ) ; } base64data = output = malloc ( ( insize + 2 ) / 3 * 4 + 1 ) ; if ( ! output ) { return CURLE_OUT_OF_MEMORY ; } while ( insize >= 3 ) { * output ++ = table64 [ in [ 0 ] >> 2 ] ; * output ++ = table64 [ ( ( in [ 0 ] & 0x03 ) << 4 ) | ( in [ 1 ] >> 4 ) ] ; * output ++ = table64 [ ( ( in [ 1 ] & 0x0F ) << 2 ) | ( ( in [ 2 ] & 0xC0 ) >> 6 ) ] ; * output ++ = table64 [ in [ 2 ] & 0x3F ] ; insize -= 3 ; in += 3 ; } if ( insize ) { * output ++ = table64 [ in [ 0 ] >> 2 ] ; if ( insize == 1 ) { * output ++ = table64 [ ( ( in [ 0 ] & 0x03 ) << 4 ) ] ; if ( * padstr ) { * output ++ = * padstr ; * output ++ = * padstr ; } } else { * output ++ = table64 [ ( ( in [ 0 ] & 0x03 ) << 4 ) | ( ( in [ 1 ] & 0xF0 ) >> 4 ) ] ; * output ++ = table64 [ ( ( in [ 1 ] & 0x0F ) << 2 ) ] ; if ( * padstr ) { * output ++ = * padstr ; } } } * output = '\0' ; * outptr = base64data ; * outlen = output - base64data ; return CURLE_OK ; } 