static int env_append ( char * * r , char * * * k , char * * a ) { assert ( r ) ; assert ( k ) ; assert ( * k >= r ) ; for ( ; * a ; a ++ ) { char * * j , * c ; size_t n ; n = strcspn ( * a , "=" ) ; if ( ( * a ) [ n ] == '=' ) { n ++ ; } for ( j = r ; j < * k ; j ++ ) { if ( strneq ( * j , * a , n ) ) { break ; } } c = strdup ( * a ) ; if ( ! c ) { return - ENOMEM ; } if ( j >= * k ) { ( * k ) [ 0 ] = c ; ( * k ) [ 1 ] = NULL ; ( * k ) ++ ; } else { free_and_replace ( * j , c ) ; } } return 0 ; } 