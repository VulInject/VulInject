int platform_msi_domain_alloc ( struct irq_domain * domain , unsigned int virq , unsigned int nr_irqs ) { struct platform_msi_priv_data * data = domain -> host_data ; int err ; err = platform_msi_alloc_descs_with_irq ( data -> dev , virq , nr_irqs , data ) ; err = msi_domain_populate_irqs ( domain -> parent , data -> dev , virq , nr_irqs , & data -> arg ) ; if ( err ) { platform_msi_domain_free ( domain , virq , nr_irqs ) ; } return err ; } 