static int snvs_rtc_set_time ( struct device * dev , struct rtc_time * tm ) { struct snvs_rtc_data * data = dev_get_drvdata ( dev ) ; unsigned long time = rtc_tm_to_time64 ( tm ) ; int ret ; ret = clk_enable ( data -> clk ) ; ret = snvs_rtc_enable ( data , false ) ; if ( ret ) { return ret ; } regmap_write ( data -> regmap , data -> offset + SNVS_LPSRTCLR , time << CNTR_TO_SECS_SH ) ; regmap_write ( data -> regmap , data -> offset + SNVS_LPSRTCMR , time >> ( 32 - CNTR_TO_SECS_SH ) ) ; ret = snvs_rtc_enable ( data , true ) ; clk_disable ( data -> clk ) ; return ret ; } 