static int jazz_sonic_probe ( struct platform_device * pdev ) { struct net_device * dev ; struct sonic_local * lp ; struct resource * res ; int err = 0 ; res = platform_get_resource ( pdev , IORESOURCE_MEM , 0 ) ; if ( ! res ) { return - ENODEV ; } dev = alloc_etherdev ( sizeof ( sonic_local ) ) ; if ( ! dev ) { return - ENOMEM ; } lp = netdev_priv ( dev ) ; lp -> device = & pdev -> dev ; SET_NETDEV_DEV ( dev , & pdev -> dev ) ; platform_set_drvdata ( pdev , dev ) ; netdev_boot_setup_check ( dev ) ; dev -> base_addr = res -> start ; dev -> irq = platform_get_irq ( pdev , 0 ) ; err = sonic_probe1 ( dev ) ; if ( err ) { out } err = register_netdev ( dev ) ; if ( err ) { out1 } printk ( "%s: MAC %pM IRQ %d\n" , dev -> name , dev -> dev_addr , dev -> irq ) ; return 0 ; out1 release_mem_region ( dev -> base_addr , SONIC_MEM_SIZE ) ; out return err ; } 