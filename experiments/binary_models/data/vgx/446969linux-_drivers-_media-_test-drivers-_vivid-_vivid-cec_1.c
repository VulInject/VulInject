static int vivid_received ( struct cec_adapter * adap , struct cec_msg * msg ) { struct vivid_dev * dev = cec_get_drvdata ( adap ) ; struct cec_msg reply ; u8 dest = cec_msg_destination ( msg ) ; u8 disp_ctl ; char osd [ 14 ] ; if ( cec_msg_is_broadcast ( msg ) ) { dest = adap -> log_addrs . log_addr [ 0 ] ; } cec_msg_init ( & reply , dest , cec_msg_initiator ( msg ) ) ; switch ( cec_msg_opcode ( msg ) ) { case CEC_MSG_SET_OSD_STRING : if ( ! cec_is_sink ( adap ) ) { return - ENOMSG ; } cec_ops_set_osd_string ( msg , & disp_ctl , osd ) ; switch ( disp_ctl ) { case CEC_OP_DISP_CTL_DEFAULT : strscpy ( dev -> osd , osd , sizeof ( dev -> osd ) ) ; dev -> osd_jiffies = jiffies ; break ; case CEC_OP_DISP_CTL_UNTIL_CLEARED : strscpy ( dev -> osd , osd , sizeof ( dev -> osd ) ) ; break ; case CEC_OP_DISP_CTL_CLEAR : dev -> osd [ 0 ] = 0 ; dev -> osd_jiffies = 0 ; break ; default : cec_msg_feature_abort ( & reply , cec_msg_opcode ( msg ) , CEC_OP_ABORT_INVALID_OP ) ; cec_transmit_msg ( adap , & reply , false ) ; break ; } break ; default : return - ENOMSG ; } return 0 ; } 