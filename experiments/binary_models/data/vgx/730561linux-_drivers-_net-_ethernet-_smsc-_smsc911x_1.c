static int smsc911x_phy_disable_energy_detect ( struct smsc911x_data * pdata ) { struct net_device * ndev = pdata -> dev ; struct phy_device * phy_dev = ndev -> phydev ; int rc = 0 ; rc = phy_read ( phy_dev , MII_LAN83C185_CTRL_STATUS ) ; if ( rc < 0 ) { SMSC_WARN ( pdata , drv , "Failed reading PHY control reg" ) ; return rc ; } if ( rc & MII_LAN83C185_EDPWRDOWN ) { rc = phy_write ( phy_dev , MII_LAN83C185_CTRL_STATUS , rc & ( ~ MII_LAN83C185_EDPWRDOWN ) ) ; if ( rc < 0 ) { SMSC_WARN ( pdata , drv , "Failed writing PHY control reg" ) ; return rc ; } mdelay ( 2 ) ; } return 0 ; } 