main ( int argc , char * * argv ) { STATE * state = NULL ; SF_INFO sfinfo ; int k , double_merge = 0 ; int ret = 1 ; if ( argc < 5 ) { if ( argc > 1 ) { puts ( "\nError : need at least 2 input files." ) ; } print_usage ( ) ; cleanup } if ( strcmp ( argv [ argc - 2 ] , "-o" ) != 0 ) { puts ( "\nError : second last command line parameter should be '-o'.\n" ) ; print_usage ( ) ; cleanup } if ( argc - 3 > MAX_INPUTS ) { printf ( "\nError : Cannot handle more than %d input channels.\n\n" , MAX_INPUTS ) ; cleanup } state = calloc ( 1 , sizeof ( STATE ) ) ; if ( state == NULL ) { puts ( "\nError : out of memory.\n" ) ; cleanup } memset ( & sfinfo , 0 , sizeof ( sfinfo ) ) ; for ( k = 1 ; k < argc - 2 ; k ++ ) { if ( ( state -> infile [ k - 1 ] = sf_open ( argv [ k ] , SFM_READ , & sfinfo ) ) == NULL ) { printf ( "\nError : Not able to open input file '%s'\n%s\n" , argv [ k ] , sf_strerror ( NULL ) ) ; cleanup } if ( sfinfo . channels != 1 ) { printf ( "\bError : Input file '%s' should be mono (has %d channels).\n" , argv [ k ] , sfinfo . channels ) ; cleanup } switch ( sfinfo . format & SF_FORMAT_SUBMASK ) { case SF_FORMAT_FLOAT : case SF_FORMAT_DOUBLE : case SF_FORMAT_VORBIS : double_merge = 1 ; break ; default : break ; } state -> channels ++ ; } sfinfo . channels = state -> channels ; sfinfo . format = sfe_file_type_of_ext ( argv [ argc - 1 ] , sfinfo . format ) ; if ( ( state -> outfile = sf_open ( argv [ argc - 1 ] , SFM_WRITE , & sfinfo ) ) == NULL ) { printf ( "Not able to open output file '%s'\n%s\n" , argv [ argc - 1 ] , sf_strerror ( NULL ) ) ; cleanup } if ( double_merge ) { interleave_double ( state ) ; } else { interleave_int ( state ) ; } ret = 0 ; cleanup if ( state != NULL ) { for ( k = 0 ; k < MAX_INPUTS ; k ++ ) { if ( state -> infile [ k ] != NULL ) { sf_close ( state -> infile [ k ] ) ; } } sf_close ( state -> outfile ) ; } return ret ; } 