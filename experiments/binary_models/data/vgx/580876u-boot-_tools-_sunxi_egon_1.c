static int egon_verify_header ( unsigned char * ptr , int image_size , struct image_tool_params * params ) { const struct boot_file_head * header = ( void * ) ptr ; uint32_t length ; switch ( egon_get_arch ( params ) ) { case IH_ARCH_ARM : if ( ( le32_to_cpu ( header -> b_instruction ) & 0xff000000 ) != 0xea000000 ) { return EXIT_FAILURE ; } break ; case IH_ARCH_RISCV : if ( ( le32_to_cpu ( header -> b_instruction ) & 0x00000fff ) != 0x0000006f ) { return EXIT_FAILURE ; } break ; default : return EXIT_FAILURE ; } if ( memcmp ( header -> magic , BOOT0_MAGIC , sizeof ( header -> magic ) ) ) { return EXIT_FAILURE ; } length = le32_to_cpu ( header -> length , NULL ) ; if ( length & 511 ) { return EXIT_FAILURE ; } if ( image_size < length ) { return EXIT_FAILURE ; } return EXIT_SUCCESS ; } 