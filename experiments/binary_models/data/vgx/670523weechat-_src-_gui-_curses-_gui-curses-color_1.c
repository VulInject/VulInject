gui_color_palette_new ( , ) { struct t_gui_color_palette * new_color_palette ; char * * items , * pos , * pos2 , * error1 , * error2 , * error3 ; char * str_alias , * str_rgb , str_number [ 64 ] ; int num_items , i , r , g , b ; if ( ! value ) { return in ; } new_color_palette = malloc ( sizeof ( * new_color_palette ) ) ; if ( new_color_palette ) { new_color_palette -> alias = NULL ; new_color_palette -> r = - 1 ; new_color_palette -> g = - 1 ; new_color_palette -> b = - 1 ; str_alias = NULL ; str_rgb = NULL ; items = string_split ( value , ";" , NULL , WEECHAT_STRING_SPLIT_STRIP_LEFT | WEECHAT_STRING_SPLIT_STRIP_RIGHT | WEECHAT_STRING_SPLIT_COLLAPSE_SEPS , 0 , & num_items ) ; if ( items ) { for ( i = 0 ; i < num_items ; i ++ ) { pos = strchr ( items [ i ] , '/' ) ; if ( pos ) { str_rgb = items [ i ] ; } else { pos = strchr ( items [ i ] , ',' ) ; if ( ! pos ) { str_alias = items [ i ] ; } } } if ( str_alias ) { new_color_palette -> alias = strdup ( str_alias ) ; } if ( str_rgb ) { pos = strchr ( str_rgb , '/' ) ; if ( pos ) { pos [ 0 ] = '\0' ; pos2 = strchr ( pos + 1 , '/' ) ; if ( pos2 ) { pos2 [ 0 ] = '\0' ; error1 = NULL ; r = ( int ) strtol ( str_rgb , & error1 , 10 ) ; error2 = NULL ; g = ( int ) strtol ( pos + 1 , & error2 , 10 ) ; error3 = NULL ; b = ( int ) strtol ( pos2 + 1 , & error3 , 10 ) ; if ( error1 && ! error1 [ 0 ] && error2 && ! error2 [ 0 ] && error3 && ! error3 [ 0 ] && ( r >= 0 ) && ( r <= 1000 ) && ( g >= 0 ) && ( g <= 1000 ) && ( b >= 0 ) && ( b <= 1000 ) ) { new_color_palette -> r = r ; new_color_palette -> g = g ; new_color_palette -> b = b ; } } } } string_free_split ( items ) ; } if ( ! new_color_palette -> alias ) { snprintf ( str_number , sizeof ( str_number ) , "%d" , number ) ; new_color_palette -> alias = strdup ( str_number ) ; } } return new_color_palette ; } 