static void reclaim_tcp_handler ( struct comm_point * c ) { log_assert ( c -> type == comm_tcp ) ; if ( c -> ssl ) { SSL_shutdown ( c -> ssl ) ; SSL_free ( c -> ssl ) ; c -> ssl = NULL ; } comm_point_close ( c ) ; if ( c -> tcp_parent ) { if ( c != c -> tcp_parent -> tcp_free ) { c -> tcp_parent -> cur_tcp_count -- ; c -> tcp_free = c -> tcp_parent -> tcp_free ; c -> tcp_parent -> tcp_free = c ; } if ( ! c -> tcp_free ) { comm_point_start_listening ( c -> tcp_parent , - 1 , - 1 ) ; } } c -> tcp_more_write_again = NULL ; c -> tcp_byte_count = 0 ; c -> pp2_header_state = pp2_header_none ; sldns_buffer_clear ( c -> buffer ) ; } 