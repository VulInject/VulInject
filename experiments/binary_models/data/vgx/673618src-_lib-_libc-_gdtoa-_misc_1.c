static Bigint * freelist [ Kmax + 1 ] ; static double private_mem [ PRIVATE_mem ] , * pmem_next = private_mem ; static void * __dtoa_locks [ ] { NULL NULL } ; ; Bigint * Balloc ( k ) int k ; ( int k ) { int x ; Bigint * rv ; unsigned int len ; ACQUIRE_DTOA_LOCK ( 0 ) ; if ( k <= Kmax && ( rv = freelist [ k ] ) != 0 ) { freelist [ k ] = rv -> next ; } else { x = 1 << k ; rv = ( Bigint * ) MALLOC ( sizeof ( Bigint ) + ( x - 1 ) * sizeof ( ULong ) ) ; len = ( sizeof ( Bigint ) + ( x - 1 ) * sizeof ( ULong ) + sizeof ( double ) - 1 ) / sizeof ( double ) ; if ( k <= Kmax && pmem_next - private_mem + len <= PRIVATE_mem ) { rv = ( Bigint * ) pmem_next ; pmem_next += len ; } else { rv = ( Bigint * ) MALLOC ( len * sizeof ( double ) ) ; if ( rv == NULL ) { return ( NULL ) ; } } rv -> k = k ; rv -> maxwds = x ; } FREE_DTOA_LOCK ( 0 ) ; } 