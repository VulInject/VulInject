static u32 scg_fircdiv_get_rate ( enum scg_clk clk ) { u32 reg , val , rate ; u32 shift , mask ; switch ( clk ) { case SCG_FIRC_DIV1_CLK : mask = SCG_FIRCDIV_DIV1_MASK ; shift = SCG_FIRCDIV_DIV1_SHIFT ; break ; case SCG_FIRC_DIV2_CLK : mask = SCG_FIRCDIV_DIV2_MASK ; shift = SCG_FIRCDIV_DIV2_SHIFT ; break ; case SCG_FIRC_DIV3_CLK : mask = SCG_FIRCDIV_DIV3_MASK ; shift = SCG_FIRCDIV_DIV3_SHIFT ; break ; default : return 0 ; } reg = readl ( & scg1_regs -> firccsr ) ; if ( ! ( reg & SCG_FIRC_CSR_FIRCVLD_MASK ) ) { return 0 ; } reg = readl ( & scg1_regs -> fircdiv ) ; val = ( reg & mask ) >> shift ; rate = scg_src_get_rate ( SCG_FIRC_CLK ) ; rate = rate / ( 1 << ( val - 1 ) ) ; return rate ; } 