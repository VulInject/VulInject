static ssize_t pdcspath_layer_write ( struct pdcspath_entry * entry , const char * buf , size_t count ) { unsigned int layers [ 6 ] ; unsigned short i ; char in [ 64 ] , * temp ; if ( ! entry || ! buf || ! count ) { return - EINVAL ; } count = min_t ( size_t , count , sizeof ( in ) - 1 ) ; strscpy ( in , buf , count + 1 ) ; if ( unlikely ( ! isdigit ( * in ) ) ) { return - EINVAL ; } layers [ 0 ] = simple_strtoul ( in , NULL , 10 ) ; DPRINTK ( "%s: layer[0]: %d\n" , __func__ , layers [ 0 ] ) ; temp = in ; for ( i = 1 ; ( ( temp = strchr ( temp , '.' ) ) ) && ( likely ( i < 6 ) ) ; i ++ ) { if ( unlikely ( ! isdigit ( * ( ++ temp ) ) ) ) { return - EINVAL ; } layers [ i ] = simple_strtoul ( temp , NULL , 10 ) ; DPRINTK ( "%s: layer[%d]: %d\n" , __func__ , i , layers [ i ] ) ; } write_lock ( & entry -> rw_lock ) ; memcpy ( & entry -> devpath . layers , & layers , sizeof ( layers ) ) ; pdcspath_store ( entry ) ; write_unlock ( & entry -> rw_lock ) ; printk ( ": changed \"%s\" layers to \"%s\"\n" , , ) return count ; } 