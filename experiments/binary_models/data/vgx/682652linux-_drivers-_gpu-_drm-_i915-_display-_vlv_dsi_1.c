static int intel_dsi_compute_config ( struct intel_encoder * encoder , struct intel_crtc_state * pipe_config , struct drm_connector_state * conn_state ) { struct drm_i915_private * dev_priv = to_i915 ( encoder -> base . dev ) ; struct intel_dsi * intel_dsi = container_of ( encoder , intel_dsi , base ) ; struct intel_connector * intel_connector = intel_dsi -> attached_connector ; struct drm_display_mode * adjusted_mode = & pipe_config -> hw . adjusted_mode ; int ret ; drm_dbg_kms ( & dev_priv -> drm , "\n" ) ; pipe_config -> output_format = INTEL_OUTPUT_FORMAT_RGB ; ret = intel_panel_compute_config ( intel_connector , adjusted_mode ) ; if ( ret ) { return ret ; } ret = intel_panel_fitting ( pipe_config , conn_state ) ; if ( ret ) { return ret ; } adjusted_mode -> flags = 0 ; if ( intel_dsi -> pixel_format == MIPI_DSI_FMT_RGB888 ) { pipe_config -> pipe_bpp = 24 ; } else { pipe_config -> pipe_bpp = 18 ; } if ( IS_GEMINILAKE ( dev_priv ) || IS_BROXTON ( dev_priv ) ) { pipe_config -> mode_flags |= I915_MODE_FLAG_GET_SCANLINE_FROM_TIMESTAMP ; if ( intel_dsi -> ports == BIT ( PORT_C ) ) { pipe_config -> cpu_transcoder = TRANSCODER_DSI_C ; } else { pipe_config -> cpu_transcoder = TRANSCODER_DSI_A ; } ret = bxt_dsi_pll_compute ( encoder , pipe_config ) ; if ( ret ) { return - EINVAL ; } } else { ret = vlv_dsi_pll_compute ( encoder , pipe_config ) ; if ( ret ) { return - EINVAL ; } } pipe_config -> clock_set = true ; return 0 ; } 