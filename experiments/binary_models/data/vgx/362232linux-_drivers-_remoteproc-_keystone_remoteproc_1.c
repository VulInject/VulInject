static void * keystone_rproc_da_to_va ( struct rproc * rproc , u64 da , size_t len , bool * is_iomem ) { struct keystone_rproc * ksproc = rproc -> priv ; void __iomem * va = NULL ; phys_addr_t bus_addr ; u32 dev_addr , offset ; size_t size ; int i ; if ( len == 0 ) { return in ; } for ( i = 0 ; i < ksproc -> num_mems ; i ++ ) { bus_addr = ksproc -> mem [ i ] . bus_addr ; dev_addr = ksproc -> mem [ i ] . dev_addr ; size = ksproc -> mem [ i ] . size ; if ( da < KEYSTONE_RPROC_LOCAL_ADDRESS_MASK ) { if ( ( da >= dev_addr ) && ( ( da + len ) <= ( dev_addr + size ) ) ) { offset = da - dev_addr ; va = ksproc -> mem [ i ] . cpu_addr + offset ; break ; } } else { if ( ( da >= bus_addr ) && ( da + len ) <= ( bus_addr + size ) ) { offset = da - bus_addr ; va = ksproc -> mem [ i ] . cpu_addr + offset ; break ; } } } return ( __force void * ) va ; } 