nautilus_drag_drop_action_ask ( , ) { GtkWidget * popover ; GtkWidget * menu ; GtkWidget * menu_item ; DropActionMenuData damd ; popover = gtk_popover_new ( widget ) ; gtk_popover_set_position ( GTK_POPOVER ( popover ) , GTK_POS_TOP ) ; menu = gtk_box_new ( GTK_ORIENTATION_VERTICAL , 0 ) ; gtk_widget_set_margin_top ( menu , 6 ) ; gtk_widget_set_margin_bottom ( menu , 6 ) ; gtk_widget_set_margin_start ( menu , 6 ) ; gtk_widget_set_margin_end ( menu , 6 ) ; gtk_popover_set_child ( GTK_POPOVER ( popover ) , menu ) ; gtk_widget_show ( menu ) ; append_drop_action_menu_item ( menu , _ ( "_Move Here" ) , GDK_ACTION_MOVE , ( actions & GDK_ACTION_MOVE ) != 0 , & damd ) ; append_drop_action_menu_item ( menu , _ ( "_Copy Here" ) , GDK_ACTION_COPY , ( actions & GDK_ACTION_COPY ) != 0 , & damd ) ; append_drop_action_menu_item ( menu , _ ( "_Link Here" ) , GDK_ACTION_LINK , ( actions & GDK_ACTION_LINK ) != 0 , & damd ) ; menu_item = gtk_separator_new ( GTK_ORIENTATION_VERTICAL ) ; gtk_box_append ( GTK_BOX ( menu ) , menu_item ) ; gtk_widget_show ( menu_item ) ; append_drop_action_menu_item ( menu , _ ( "Cancel" ) , 0 , TRUE , & damd ) ; damd . chosen = 0 ; damd . loop = g_main_loop_new ( NULL , FALSE ) ; g_signal_connect ( popover , "closed" , G_CALLBACK ( menu_deactivate_callback ) , & damd ) ; gtk_grab_add ( popover ) ; gtk_popover_set_pointing_to ( GTK_POPOVER ( popover ) , & ( GdkRectangle ) { . x = 0.5 * gtk_widget_get_allocated_width ( widget ) . y = 0.5 * gtk_widget_get_allocated_height ( widget ) . width = 0 . height = 0 } ) ; gtk_popover_popup ( GTK_POPOVER ( popover ) ) ; g_main_loop_run ( damd . loop ) ; gtk_grab_remove ( popover ) ; g_main_loop_unref ( damd . loop ) ; g_object_ref_sink ( popover , NULL ) ; g_object_unref ( popover ) ; return damd . chosen ; return 0 ; } 