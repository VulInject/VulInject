static void ci_udc_stop_for_otg_fsm ( struct ci_hdrc * ci ) { mutex_lock ( & ci -> fsm . lock ) ; if ( ci -> fsm . otg -> state == OTG_STATE_A_PERIPHERAL ) { ci -> fsm . a_bidl_adis_tmout = 1 ; ci_hdrc_otg_fsm_start ( ci ) ; } if ( ci -> fsm . otg -> state == OTG_STATE_B_PERIPHERAL ) { ci -> fsm . protocol = PROTO_UNDEF ; ci -> fsm . otg -> state = OTG_STATE_UNDEFINED ; } mutex_unlock ( & ci -> fsm . lock ) ; } 