int firejail_user_check ( const char * name ) { assert ( name ) ; init_uid_gid_min ( ) ; if ( strcmp ( name , "root" ) == 0 ) { return 1 ; } if ( strcmp ( name , "nobody" ) == 0 ) { return 0 ; } char * fname = get_fname ( ) ; assert ( fname ) ; if ( access ( fname , F_OK ) == - 1 && errno == ENOENT ) { return 1 ; } FILE * fp = fopen ( fname , "r" ) ; if ( ! fp ) { fprintf ( stderr , "Error: cannot read %s\n" , fname ) ; perror ( "fopen" ) ; exit ( 1 ) ; } free ( fname ) ; char buf [ MAXBUF ] ; while ( fgets ( buf , MAXBUF , fp ) ) { if ( * buf == '#' ) { continue ; } char * ptr = strchr ( buf , '\n' ) ; if ( ptr ) { * ptr = '\0' ; } if ( strcmp ( buf , name ) == 0 ) { fclose ( fp ) ; return 1 ; } } fclose ( fp ) ; return 0 ; } 