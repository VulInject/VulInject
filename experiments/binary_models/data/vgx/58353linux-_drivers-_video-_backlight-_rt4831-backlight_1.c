static int rt4831_bl_update_status ( struct backlight_device * bl_dev ) { struct rt4831_priv * priv = bl_get_data ( bl_dev ) ; int brightness = backlight_get_brightness ( bl_dev ) ; int enable = brightness ?RT4831_BLEN_MASK : 0 ; u8 v [ 2 ] ; int ret ; if ( brightness ) { v [ 0 ] = ( brightness - 1 ) & RT4831_BLDIML_MASK ; v [ 1 ] = ( ( brightness - 1 ) & RT4831_BLDIMH_MASK ) >> RT4831_BLDIMH_SHIFT ; ret = regmap_raw_write ( priv -> regmap , RT4831_REG_BLDIML , v , sizeof ( v ) ) ; if ( ret ) { return ret ; } } return regmap_update_bits ( priv -> regmap , RT4831_REG_ENABLE , RT4831_BLEN_MASK , enable ) ; } 