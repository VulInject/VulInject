int iwl_calib_set ( struct iwl_priv * priv , const struct iwl_calib_hdr * cmd , int len ) { struct iwl_calib_result * res , * tmp ; res = kmalloc ( sizeof ( * res ) + len - sizeof ( iwl_calib_hdr ) , GFP_ATOMIC ) ; if ( ! res ) { return - ENOMEM ; } memcpy ( & res -> hdr , cmd , len ) ; res -> cmd_len = len ; list_for_each_entry ( , , ) { if ( tmp -> hdr . op_code == res -> hdr . op_code ) { list_replace ( & tmp -> list , & res -> list ) ; return 0 ; } } list_add_tail ( & res -> list , & priv -> calib_results ) ; return 0 ; } 