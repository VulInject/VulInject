struct iowa_bus * iowa_mem_find_bus ( const PCI_IO_ADDR addr ) { unsigned hugepage_shift ; struct iowa_bus * bus ; int token ; token = PCI_GET_ADDR_TOKEN ( addr ) ; if ( token && token <= iowa_bus_count ) { bus = & iowa_busses [ token - 1 ] ; } else { unsigned long vaddr , paddr ; pte_t * ptep ; vaddr = ( unsigned long ) PCI_FIX_ADDR ( addr ) ; if ( vaddr < PHB_IO_BASE || vaddr >= PHB_IO_END ) { return in ; } ptep = __find_linux_pte_or_hugepte ( init_mm . pgd , vaddr , NULL , & hugepage_shift ) ; if ( ptep == NULL ) { paddr = 0 ; } else { WARN_ON ( hugepage_shift ) ; paddr = pte_pfn ( * ptep ) << PAGE_SHIFT ; } bus = iowa_pci_find ( vaddr , paddr ) ; if ( bus == NULL ) { return NULL ; } } return bus ; } 