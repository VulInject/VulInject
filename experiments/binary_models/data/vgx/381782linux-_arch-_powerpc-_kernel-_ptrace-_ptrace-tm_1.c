int tm_cvmx_active ( struct task_struct * target , const struct user_regset * regset ) { if ( ! cpu_has_feature ( CPU_FTR_TM ) ) { return - ENODEV ; } if ( ! MSR_TM_ACTIVE ( target -> thread . regs -> msr ) ) { return 0 ; } return regset -> n ; } int tm_cvmx_get ( struct task_struct * target , const struct user_regset * regset , struct membuf to ) { { elf_vrreg_t reg ; u32 word ; } , vrsave BUILD_BUG_ON ( TVSO ( vscr ) != TVSO ( vr [ 32 ] ) ) ; if ( ! cpu_has_feature ( CPU_FTR_TM ) ) { return - ENODEV ; } if ( ! MSR_TM_ACTIVE ( target -> thread . regs -> msr ) ) { return - ENODATA ; } flush_tmregs_to_thread ( target ) ; flush_fp_to_thread ( target ) ; flush_altivec_to_thread ( target ) ; membuf_write ( & to , & target -> thread . ckvr_state , 33 * sizeof ( vector128 ) ) ; vrsave . word = target -> thread . ckvrsave ; return membuf_write ( & to , & vrsave , sizeof ( vrsave ) ) ; } 