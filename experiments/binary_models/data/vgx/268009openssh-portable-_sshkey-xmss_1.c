int sshkey_xmss_init_enc_key ( struct sshkey * k , const char * ciphername ) { struct ssh_xmss_state * state = k -> xmss_state ; const struct sshcipher * cipher ; size_t keylen = 0 , ivlen = 0 ; if ( ( cipher = cipher_by_name ( ciphername ) ) == NULL ) { return SSH_ERR_INTERNAL_ERROR ; } if ( ( state -> enc_ciphername = strdup ( ciphername ) ) == NULL ) { return SSH_ERR_ALLOC_FAIL ; } keylen = cipher_keylen ( cipher ) ; ivlen = cipher_ivlen ( cipher ) ; state -> enc_keyiv_len = keylen + ivlen ; if ( ( state -> enc_keyiv = calloc ( state -> enc_keyiv_len , 1 ) ) == NULL ) { free ( state -> enc_ciphername ) ; state -> enc_ciphername = NULL ; return SSH_ERR_ALLOC_FAIL ; } arc4random_buf ( state -> enc_keyiv , state -> enc_keyiv_len ) ; return 0 ; } 