static int vp8_enc_encode_frame ( struct venc_vp8_inst * inst , struct venc_frm_buf * frm_buf , struct mtk_vcodec_mem * bs_buf , unsigned int * bs_size ) { int ret = 0 ; unsigned int irq_status ; mtk_vcodec_debug ( inst , "->frm_cnt=%d" , inst -> frm_cnt ) ; ret = vpu_enc_encode ( & inst -> vpu_inst , 0 , frm_buf , bs_buf , bs_size ) ; irq_status = vp8_enc_wait_venc_done ( inst ) ; if ( irq_status != MTK_VENC_IRQ_STATUS_FRM ) { mtk_vcodec_err ( inst , "irq_status=%d failed" , irq_status ) ; return - EIO ; } if ( vp8_enc_compose_one_frame ( inst , bs_buf , bs_size ) ) { mtk_vcodec_err ( inst , "vp8_enc_compose_one_frame failed" ) ; return - EINVAL ; } inst -> frm_cnt ++ ; mtk_vcodec_debug ( inst , "<-size=%d key_frm=%d" , * bs_size , inst -> vpu_inst . is_key_frm ) ; return ret ; } 