static int dt9812_rmw_multiple_registers ( struct comedi_device * dev , int reg_count , struct dt9812_rmw_byte * rmw ) { struct usb_device * usb = comedi_to_usb_dev ( dev ) ; struct dt9812_private * devpriv = dev -> private ; struct dt9812_usb_cmd * cmd ; int i , count ; int ret ; cmd = kzalloc ( sizeof ( * cmd ) , GFP_KERNEL ) ; cmd -> cmd = cpu_to_le32 ( DT9812_RMW_MULTI_BYTE_REG ) ; cmd -> u . rmw_multi_info . count = reg_count ; for ( i = 0 ; i < reg_count ; i ++ ) { cmd -> u . rmw_multi_info . rmw [ i ] = rmw [ i ] ; } ret = usb_bulk_msg ( usb , usb_sndbulkpipe ( usb , devpriv -> cmd_wr . addr ) , cmd , sizeof ( * cmd ) , & count , DT9812_USB_TIMEOUT ) ; kfree ( cmd ) ; return ret ; } 