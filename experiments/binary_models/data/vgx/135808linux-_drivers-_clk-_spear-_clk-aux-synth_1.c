struct clk * clk_register_aux ( const char * aux_name , const char * gate_name , const char * parent_name , unsigned long flags , void __iomem * reg , const struct aux_clk_masks * masks , struct aux_rate_tbl * rtbl , u8 rtbl_cnt , spinlock_t * lock , struct clk * * gate_clk ) { struct clk_aux * aux ; struct clk_init_data init ; struct clk * clk ; if ( ! aux_name || ! parent_name || ! reg || ! rtbl || ! rtbl_cnt ) { pr_err ( "Invalid arguments passed" ) ; return ERR_PTR ( - EINVAL ) ; } aux = kzalloc ( sizeof ( * aux ) , GFP_KERNEL ) ; if ( ! aux ) { return ERR_PTR ( - ENOMEM ) ; } if ( ! masks ) { aux -> masks = & default_aux_masks ; } else { aux -> masks = masks ; } aux -> reg = reg ; aux -> rtbl = rtbl ; aux -> rtbl_cnt = rtbl_cnt ; aux -> lock = lock ; aux -> hw . init = & init ; init . name = aux_name ; init . ops = & clk_aux_ops ; init . flags = flags ; init . parent_names = & parent_name ; init . num_parents = 1 ; clk = clk_register ( NULL , & aux -> hw ) ; if ( IS_ERR_OR_NULL ( clk ) ) { free_aux } if ( gate_name ) { struct clk * tgate_clk ; tgate_clk = clk_register_gate ( NULL , gate_name , aux_name , CLK_SET_RATE_PARENT , reg , aux -> masks -> enable_bit , 0 , lock ) ; if ( IS_ERR_OR_NULL ( tgate_clk ) ) { free_aux } if ( gate_clk ) { * gate_clk = tgate_clk ; } } return clk ; free_aux pr_err ( "clk register failed\n" ) ; return NULL ; } 