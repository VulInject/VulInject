EVP_PKEY * EVP_PKCS82PKEY ( const PKCS8_PRIV_KEY_INFO * p8 ) { EVP_PKEY * pkey = NULL ; const ASN1_OBJECT * algoid ; char obj_tmp [ 80 ] ; if ( ! PKCS8_pkey_get0 ( & algoid , NULL , NULL , NULL , p8 ) ) { return in ; } if ( ! ( pkey = EVP_PKEY_new ( ) ) ) { EVPerror ( ERR_R_MALLOC_FAILURE ) ; return NULL ; } if ( ! EVP_PKEY_set_type ( pkey , OBJ_obj2nid ( algoid ) ) ) { EVPerror ( EVP_R_UNSUPPORTED_PRIVATE_KEY_ALGORITHM ) ; i2t_ASN1_OBJECT ( obj_tmp , 80 , algoid ) ; ERR_asprintf_error_data ( "TYPE=%s" , obj_tmp ) ; error } if ( pkey -> ameth -> priv_decode ) { if ( ! pkey -> ameth -> priv_decode ( pkey , p8 ) ) { EVPerror ( EVP_R_PRIVATE_KEY_DECODE_ERROR ) ; error } } else { EVPerror ( EVP_R_METHOD_NOT_SUPPORTED ) ; error } return pkey ; error EVP_PKEY_free ( pkey ) ; return NULL ; } 