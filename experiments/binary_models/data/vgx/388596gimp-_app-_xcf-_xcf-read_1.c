xcf_read_string ( , , ) { guint total = 0 ; int i ; for ( i = 0 ; i < count ; i ++ ) { guint32 tmp ; total += xcf_read_int32 ( info , & tmp , 1 ) ; if ( tmp > MAX_XCF_STRING_LEN ) { g_warning ( "Maximum string length (%ld bytes) exceeded. " "Possibly corrupt XCF file." , MAX_XCF_STRING_LEN ) ; data [ i ] = NULL ; } if ( tmp > 0 ) { gchar * str ; str = g_new ( gchar , tmp ) ; total += xcf_read_int8 ( info , ( guint8 * ) str , tmp ) ; if ( str [ tmp - 1 ] != '\0' ) { str [ tmp - 1 ] = '\0' ; } data [ i ] = gimp_any_to_utf8 ( str , - 1 , _ ( "Invalid UTF-8 string in XCF file" ) ) ; g_free ( str ) ; } else { data [ i ] = NULL ; } } return total ; } 