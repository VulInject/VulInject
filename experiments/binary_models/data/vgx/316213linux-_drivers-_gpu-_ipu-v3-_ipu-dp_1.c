int ipu_dp_init ( struct ipu_soc * ipu , struct device * dev , unsigned long base ) { struct ipu_dp_priv * priv ; int i ; priv = devm_kzalloc ( dev , sizeof ( * priv ) , GFP_KERNEL ) ; priv -> dev = dev ; priv -> ipu = ipu ; ipu -> dp_priv = priv ; priv -> base = devm_ioremap ( dev , base , PAGE_SIZE ) ; if ( ! priv -> base ) { return - ENOMEM ; } mutex_init ( & priv -> mutex ) ; for ( i = 0 ; i < IPUV3_NUM_FLOWS ; i ++ ) { priv -> flow [ i ] . background . in_cs = IPUV3_COLORSPACE_UNKNOWN ; priv -> flow [ i ] . foreground . in_cs = IPUV3_COLORSPACE_UNKNOWN ; priv -> flow [ i ] . foreground . foreground = true ; priv -> flow [ i ] . base = priv -> base + ipu_dp_flow_base [ i ] ; priv -> flow [ i ] . priv = priv ; } return 0 ; } 