* - If __xstat & __xstat64 exist , then stat & stat64 will not exist * as symbols in the library , so the latter should not be mocked . * * - If __xstat exists in the library , but not the header than it * it is just there ; for ( ; ) { * / static int ( * real_stat ) ( const char * path , stat * sb ) ; } static int * real_stat64 ( const char * path , struct stat64 * sb ) static int * real___xstat ( int ver , const char * path , struct stat * sb ) static int * real___xstat64 ( int ver , const char * path , struct stat64 * sb ) static int * real_lstat ( const char * path , struct stat * sb ) static int * real_lstat64 ( const char * path , struct stat64 * sb ) static int * real___lxstat ( int ver , const char * path , struct stat * sb ) static int * real___lxstat64 ( int ver , const char * path , struct stat64 * sb ) static bool init ; static bool debug ; static void virMockStatInit ( void ) { if ( init ) { return ; } init = true ; debug = getenv ( "VIR_MOCK_STAT_DEBUG" ) ; VIR_MOCK_REAL_INIT_ALIASED ( stat , "stat$INODE64" ) ; VIR_MOCK_REAL_INIT ( stat , NULL ) ; fdebug ( "real stat %p\n" , real_stat ) ; VIR_MOCK_REAL_INIT_ALIASED ( stat64 , "__stat64_time64" ) ; VIR_MOCK_REAL_INIT ( stat64 ) ; fdebug ( "real stat64 %p\n" , real_stat64 ) ; VIR_MOCK_REAL_INIT ( __xstat ) ; fdebug ( "real __xstat %p\n" , real___xstat ) ; VIR_MOCK_REAL_INIT ( __xstat64 ) ; fdebug ( "real __xstat64 %p\n" , real___xstat64 ) ; VIR_MOCK_REAL_INIT_ALIASED ( lstat , "lstat$INODE64" ) ; VIR_MOCK_REAL_INIT ( lstat ) ; fdebug ( "real lstat %p\n" , real_lstat ) ; VIR_MOCK_REAL_INIT_ALIASED ( lstat64 , "__lstat64_time64" ) ; VIR_MOCK_REAL_INIT ( lstat64 ) ; fdebug ( "real lstat64 %p\n" , real_lstat64 ) ; VIR_MOCK_REAL_INIT ( __lxstat ) ; fdebug ( "real __lxstat %p\n" , real___lxstat ) ; VIR_MOCK_REAL_INIT ( __lxstat64 ) ; fdebug ( "real __lxstat64 %p\n" , real___lxstat64 ) ; } 