int acquire_bus ( BusFocus focus , sd_bus * * ret ) { int r ; assert ( focus < _BUS_FOCUS_MAX ) ; assert ( ret ) ; if ( arg_transport != BUS_TRANSPORT_LOCAL ) { focus = BUS_FULL ; } if ( getenv_bool ( "SYSTEMCTL_FORCE_BUS" ) > 0 ) { focus = BUS_FULL ; } if ( ! buses [ focus ] ) { bool user ; user = arg_scope != LOOKUP_SCOPE_SYSTEM ; if ( focus == BUS_MANAGER ) { r = bus_connect_transport_systemd ( arg_transport , arg_host , user , & buses [ focus ] ) ; } else { r = bus_connect_transport ( arg_transport , arg_host , user , & buses [ focus ] ) ; } ( void ) sd_bus_set_allow_interactive_authorization ( buses [ focus ] , arg_ask_password ) ; } * ret = buses [ focus ] ; return 0 ; } 