static int nge_resume ( dev_info_t * devinfo ) { nge_t * ngep ; chip_info_t * infop ; int err ; ASSERT ( devinfo != NULL ) ; ngep = ddi_get_driver_private ( devinfo ) ; err = 0 ; if ( ngep == NULL ) { cmn_err ( CE_PANIC , "nge: ngep returned from ddi_get_driver_private was NULL" ) ; } infop = ( chip_info_t * ) & ngep -> chipinfo ; if ( ngep -> devinfo != devinfo ) { cmn_err ( CE_PANIC , "nge: passed devinfo not the same as saved devinfo" ) ; } rw_enter ( ngep -> rwlock , RW_WRITER ) ; nge_chip_cfg_init ( ngep , infop , B_FALSE ) ; if ( ngep -> suspended == B_FALSE ) { rw_exit ( ngep -> rwlock ) ; mutex_exit ( ngep -> genlock ) ; return ( DDI_SUCCESS ) ; } nge_tx_recycle_all ( ngep ) ; err = nge_reinit_ring ( ngep ) ; if ( ! err ) { err = nge_chip_reset ( ngep ) ; if ( ! err ) { err = nge_chip_start ( ngep ) ; } } if ( err ) { cmn_err ( CE_WARN , "nge: resume: failed to restart controller" ) ; } else { ngep -> nge_mac_state = NGE_MAC_STARTED ; } ngep -> suspended = B_FALSE ; rw_exit ( ngep -> rwlock ) ; mutex_exit ( ngep -> genlock ) ; return ( DDI_SUCCESS ) ; } 