static int limits_update ( struct sht3x_data * data ) { int ret ; u8 index ; int temperature ; u32 humidity ; u16 raw ; char buffer [ SHT3X_RESPONSE_LENGTH ] ; const struct sht3x_limit_commands * commands ; struct i2c_client * client = data -> client ; for ( index = 0 ; index < SHT3X_NUM_LIMIT_CMD ; index ++ ) { commands = & limit_commands [ index ] ; ret = sht3x_read_from_command ( client , data , commands -> read_command , buffer , SHT3X_RESPONSE_LENGTH , 0 ) ; raw = be16_to_cpup ( ( __be16 * ) buffer ) ; temperature = sht3x_extract_temperature ( ( raw & 0x01ff ) << 7 ) ; humidity = sht3x_extract_humidity ( raw & 0xfe00 ) ; data -> temperature_limits [ index ] = temperature ; data -> humidity_limits [ index ] = humidity ; } return ret ; } 