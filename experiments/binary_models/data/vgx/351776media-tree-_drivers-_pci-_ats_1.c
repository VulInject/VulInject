int pci_enable_pasid ( struct pci_dev * pdev , int features ) { u16 control , supported ; int pos ; pos = pci_find_ext_capability ( pdev , PCI_EXT_CAP_ID_PASID ) ; pci_read_config_word ( pdev , pos + PCI_PASID_CTRL , & control ) ; pci_read_config_word ( pdev , pos + PCI_PASID_CAP , & supported ) ; if ( control & PCI_PASID_CTRL_ENABLE ) { return - EINVAL ; } supported &= PCI_PASID_CAP_EXEC | PCI_PASID_CAP_PRIV ; if ( ( supported & features ) != features ) { return - EINVAL ; } control = PCI_PASID_CTRL_ENABLE | features ; pci_write_config_word ( pdev , pos + PCI_PASID_CTRL , control ) ; return 0 ; } 