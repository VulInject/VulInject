void new_thread_handler ( void ) { int ( * fn ) ( void * ) , n ; void * arg ; if ( current -> thread . prev_sched != NULL ) { schedule_tail ( current -> thread . prev_sched ) ; } current -> thread . prev_sched = NULL ; fn = current -> thread . request . u . thread . proc ; arg = current -> thread . request . u . thread . arg ; n = fn ( arg , NULL ) ; userspace ( & current -> thread . regs . regs , current_thread_info ( ) -> aux_fp_regs ) ; } 