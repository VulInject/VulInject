static void close_one_chan ( struct chan * chan , int delay_free_irq ) { unsigned long flags ; if ( delay_free_irq ) { spin_lock_irqsave ( & irqs_to_free_lock , flags ) ; list_add ( & chan -> free_list , & irqs_to_free ) ; spin_unlock_irqrestore ( & irqs_to_free_lock , flags ) ; } else { if ( chan -> input && chan -> enabled ) { um_free_irq ( chan -> line -> driver -> read_irq , chan ) ; } if ( chan -> output && chan -> enabled ) { um_free_irq ( chan -> line -> driver -> write_irq , chan ) ; } chan -> enabled = 0 ; } if ( chan -> ops -> close != NULL ) { * chan -> ops -> close ( chan -> fd , chan -> data ) ; } chan -> opened = 0 ; chan -> fd = - 1 ; } 