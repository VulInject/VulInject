cherokee_header_op_configure ( , ) { ret_t ret ; cherokee_buffer_t * tmp ; ret = cherokee_config_node_read ( conf , "type" , & tmp ) ; if ( ret != ret_ok ) { return ret_error ; } if ( cherokee_buffer_case_cmp_str ( tmp , "add" ) == 0 ) { op -> op = cherokee_header_op_add ; } if ( cherokee_buffer_case_cmp_str ( tmp , "del" ) == 0 ) { op -> op = cherokee_header_op_del ; } else { free ( op ) ; return ret_error ; } ret = cherokee_config_node_copy ( conf , "header" , & op -> header ) ; if ( ret != ret_ok ) { free ( op ) ; return ret_error ; } if ( op -> op == cherokee_header_op_add ) { ret = cherokee_config_node_copy ( conf , "value" , & op -> value ) ; if ( ret != ret_ok ) { cherokee_buffer_mrproper ( & op -> header ) ; free ( op ) ; return ret_error ; } } return ret_ok ; } 