static int query_xrc_srq_cmd ( struct mlx5_ib_dev * dev , struct mlx5_core_srq * srq , struct mlx5_srq_attr * out ) { u32 in [ MLX5_ST_SZ_DW ( query_xrc_srq_in ) ] { } ; ; u32 * xrcsrq_out ; void * xrc_srqc ; int err ; xrcsrq_out = kvzalloc ( MLX5_ST_SZ_BYTES ( query_xrc_srq_out ) , GFP_KERNEL ) ; if ( ! xrcsrq_out ) { return - ENOMEM ; } MLX5_SET ( query_xrc_srq_in , in , opcode , MLX5_CMD_OP_QUERY_XRC_SRQ ) ; MLX5_SET ( query_xrc_srq_in , in , xrc_srqn , srq -> srqn ) ; err = mlx5_cmd_exec_inout ( dev -> mdev , query_xrc_srq , in , xrcsrq_out ) ; if ( err ) { out } xrc_srqc = MLX5_ADDR_OF ( query_xrc_srq_out , xrcsrq_out , xrc_srq_context_entry ) ; get_srqc ( xrc_srqc , out ) ; if ( MLX5_GET ( xrc_srqc , xrc_srqc , state ) != MLX5_XRC_SRQC_STATE_GOOD ) { out -> flags |= MLX5_SRQ_FLAG_ERR ; } out return err ; } 