static int pcxhr_pcm_vol_put ( struct snd_kcontrol * kcontrol , struct snd_ctl_elem_value * ucontrol ) { struct snd_pcxhr * chip = snd_kcontrol_chip ( kcontrol ) ; int idx = snd_ctl_get_ioffidx ( kcontrol , & ucontrol -> id ) ; int changed = 0 ; int is_capture = kcontrol -> private_value ; int * stored_volume ; int i ; mutex_lock ( & chip -> mgr -> mixer_mutex ) ; if ( is_capture ) { stored_volume = chip -> digital_capture_volume ; } else { stored_volume = chip -> digital_playback_volume [ idx ] ; } for ( i = 0 ; i < 2 ; i ++ ) { int vol = ucontrol -> value . integer . value [ i ] ; if ( stored_volume [ i ] != vol ) { stored_volume [ i ] = vol ; changed = 1 ; if ( is_capture ) { pcxhr_update_audio_pipe_level ( chip , 1 , i ) ; } } } if ( ! is_capture && changed ) { pcxhr_update_playback_stream_level ( chip , idx ) ; } mutex_unlock ( & chip -> mgr -> mixer_mutex ) ; return changed ; } 