static int rt9471_get_status ( struct rt9471_chip * chip , int * status ) { unsigned int chg_ready , chg_done , fault_stat ; int ret ; ret = regmap_field_read ( chip -> rm_fields [ F_ST_CHG_RDY ] , & chg_ready ) ; ret = regmap_field_read ( chip -> rm_fields [ F_ST_CHG_DONE ] , & chg_done ) ; if ( ret ) { return ret ; } ret = regmap_read ( chip -> regmap , RT9471_REG_STAT1 , & fault_stat ) ; if ( ret ) { return ret ; } fault_stat &= RT9471_CHGFAULT_MASK ; if ( chg_ready && chg_done ) { * status = POWER_SUPPLY_STATUS_FULL ; } if ( chg_ready && fault_stat ) { * status = POWER_SUPPLY_STATUS_NOT_CHARGING ; } if ( chg_ready && ! fault_stat ) { * status = POWER_SUPPLY_STATUS_CHARGING ; } else { * status = POWER_SUPPLY_STATUS_DISCHARGING ; } return 0 ; } 