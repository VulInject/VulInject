static inline void sfm_pool_insert ( struct sfm_pool * pool , int hash , struct sfm_frag * frag ) { unsigned long hash_bit ; frag_push ( & pool -> pool_hash [ hash ] . first , frag ) ; atomic_inc_long ( ( long * ) & pool -> pool_hash [ hash ] . no ) ; hash_bit = HASH_TO_BITMAP ( hash , NULL ) ; if ( ! ( atomic_get_long ( ( long * ) & pool -> bitmap ) & hash_bit ) ) { atomic_or_long ( ( long * ) & pool -> bitmap , hash_bit ) ; } } 