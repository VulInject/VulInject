static int init_core_mask ( struct peci_cputemp * priv ) { struct peci_device * peci_dev = priv -> peci_dev ; struct resolved_cores_reg * reg = priv -> gen_info -> reg ; u64 core_mask ; u32 data ; int ret ; switch ( peci_dev -> info . model ) { case INTEL_FAM6_ICELAKE_X : case INTEL_FAM6_ICELAKE_D : ret = peci_ep_pci_local_read ( peci_dev , 0 , reg -> bus , reg -> dev , reg -> func , reg -> offset + 4 , & data ) ; if ( ret ) { return ret ; } core_mask = ( u64 ) data << 32 ; ret = peci_ep_pci_local_read ( peci_dev , 0 , reg -> bus , reg -> dev , reg -> func , reg -> offset , & data ) ; if ( ret ) { return ret ; } core_mask |= data ; break ; default : ret = peci_pci_local_read ( peci_dev , reg -> bus , reg -> dev , reg -> func , reg -> offset , & data ) ; if ( ret ) { return ret ; } core_mask = data ; break ; } bitmap_from_u64 ( priv -> core_mask , core_mask ) ; return 0 ; } 