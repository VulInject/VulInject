static bool psb_intel_sdvo_tv_create_property ( struct psb_intel_sdvo * psb_intel_sdvo , struct psb_intel_sdvo_connector * psb_intel_sdvo_connector , int type ) { struct drm_device * dev = psb_intel_sdvo -> base . base . dev ; struct psb_intel_sdvo_tv_format format ; uint32_t format_map , i ; if ( ! psb_intel_sdvo_set_target_output ( psb_intel_sdvo , type ) ) { return false ; } BUILD_BUG_ON ( sizeof ( format ) != 6 ) ; if ( ! psb_intel_sdvo_get_value ( psb_intel_sdvo , SDVO_CMD_GET_SUPPORTED_TV_FORMATS , & format , sizeof ( format ) ) ) { return false ; } memcpy ( & format_map , & format , min ( sizeof ( format_map ) , sizeof ( format ) ) ) ; psb_intel_sdvo_connector -> format_supported_num = 0 ; for ( i = 0 ; i < ARRAY_SIZE ( tv_format_names ) ; i ++ ) { if ( format_map & ( 1 << i ) ) { psb_intel_sdvo_connector -> tv_format_supported [ psb_intel_sdvo_connector -> format_supported_num ++ ] = i ; } } psb_intel_sdvo_connector -> tv_format = drm_property_create ( dev , DRM_MODE_PROP_ENUM , "mode" , psb_intel_sdvo_connector -> format_supported_num ) ; if ( ! psb_intel_sdvo_connector -> tv_format ) { return false ; } for ( i = 0 ; i < psb_intel_sdvo_connector -> format_supported_num ; i ++ ) { drm_property_add_enum ( psb_intel_sdvo_connector -> tv_format , i , tv_format_names [ psb_intel_sdvo_connector -> tv_format_supported [ i ] ] ) ; } psb_intel_sdvo -> tv_format_index = psb_intel_sdvo_connector -> tv_format_supported [ 0 ] ; drm_object_attach_property ( & psb_intel_sdvo_connector -> base . base . base , psb_intel_sdvo_connector -> tv_format , 0 ) ; return true ; } if ( enhancements . name ) { if ( ! psb_intel_sdvo_get_value ( psb_intel_sdvo , SDVO_CMD_GET_MAX_ # # NAME , & data_value , 4 ) || ! psb_intel_sdvo_get_value ( psb_intel_sdvo , SDVO_CMD_GET_ # # NAME , & response , 2 ) ) { return false ; } psb_intel_sdvo_connector -> max_ # # name = data_value [ 0 ] ; psb_intel_sdvo_connector -> cur_ # # name = response ; psb_intel_sdvo_connector -> name = drm_property_create_range ( dev , 0 , # name , 0 , data_value [ 0 ] ) ; if ( ! psb_intel_sdvo_connector -> name ) { return false ; } drm_object_attach_property ( & connector -> base , psb_intel_sdvo_connector -> name , psb_intel_sdvo_connector -> cur_ # # name ) ; DRM_DEBUG_KMS ( # name ": max %d, default %d, current %d\n" , data_value [ 0 ] , data_value [ 1 ] , response ) ; } ( 0 ) 