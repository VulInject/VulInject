static void mt76x2_phy_temp_compensate ( struct mt76x02_dev * dev ) { struct mt76x2_temp_comp t ; int temp , db_diff ; temp = mt76_get_field ( dev , MT_TEMP_SENSOR , MT_TEMP_SENSOR_VAL ) ; temp -= t . temp_25_ref ; temp = ( temp * 1789 ) / 1000 + 25 ; dev -> cal . temp = temp ; if ( temp > 25 ) { db_diff = ( temp - 25 ) / t . high_slope ; } else { db_diff = ( 25 - temp ) / t . low_slope ; } db_diff = min ( db_diff , t . upper_bound ) ; db_diff = max ( db_diff , t . lower_bound ) ; mt76_rmw_field ( dev , MT_TX_ALC_CFG_1 , MT_TX_ALC_CFG_1_TEMP_COMP , db_diff * 2 ) ; mt76_rmw_field ( dev , MT_TX_ALC_CFG_2 , MT_TX_ALC_CFG_2_TEMP_COMP , db_diff * 2 ) ; } 