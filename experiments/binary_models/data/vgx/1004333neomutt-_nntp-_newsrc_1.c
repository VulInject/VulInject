void nntp_hcache_update ( struct NntpMboxData * mdata , struct HeaderCache * hc ) { char buf [ 32 ] { 0 } ; ; bool old = false ; anum_t first = 0 , last = 0 ; char * hdata = mutt_hcache_fetch_str ( hc , "index" , 5 ) ; if ( hdata ) { mutt_debug ( LL_DEBUG2 , "mutt_hcache_fetch index: %s\n" , hdata ) ; if ( sscanf ( hdata , ANUM " " ANUM , & first , & last ) == 2 ) { old = true ; mdata -> last_cached = last ; for ( anum_t current = first ; current <= last ; current ++ ) { if ( ( current >= mdata -> first_message ) && ( current <= mdata -> last_message ) ) { continue ; } snprintf ( buf , sizeof ( buf ) , ANUM , current ) ; mutt_debug ( LL_DEBUG2 , "mutt_hcache_delete_record %s\n" , buf ) ; mutt_hcache_delete_record ( hc , buf , strlen ( buf ) ) ; } } FREE ( & hdata ) ; } if ( ! old || ( mdata -> first_message != first ) || ( mdata -> last_message != last ) ) { snprintf ( buf , sizeof ( buf ) , ANUM " " ANUM , mdata -> first_message , mdata -> last_message ) ; mutt_debug ( LL_DEBUG2 , "mutt_hcache_store index: %s\n" , buf ) ; mutt_hcache_store_raw ( hc , "index" , 5 , buf , strlen ( buf ) + 1 ) ; } } 