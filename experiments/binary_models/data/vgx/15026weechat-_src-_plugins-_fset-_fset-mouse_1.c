fset_mouse_hsignal_cb ( , , , ) { const char * ptr_key , * ptr_chat_line_y , * ptr_fset_option_pointer ; char str_command [ 1024 ] ; struct t_fset_option * ptr_fset_option ; unsigned long value ; int rc , distance , num_options , y , y2 , chat_line_y , chat_line_y2 ; int min_y , max_y , i ; ( void ) pointer ; ( void ) data ; ( void ) signal ; if ( ! fset_buffer ) { return WEECHAT_RC_OK ; } ptr_key = weechat_hashtable_get ( hashtable , "_key" ) ; ptr_chat_line_y = weechat_hashtable_get ( hashtable , "_chat_line_y" ) ; ptr_fset_option_pointer = weechat_hashtable_get ( hashtable , "fset_option" ) ; if ( ! ptr_key || ! ptr_chat_line_y || ! ptr_fset_option_pointer ) { return WEECHAT_RC_OK ; } rc = sscanf ( ptr_fset_option_pointer , "%lx" , & value ) ; if ( ( rc == EOF ) || ( rc == 0 ) ) { return WEECHAT_RC_OK ; } ptr_fset_option = ( t_fset_option * ) value ; snprintf ( str_command , sizeof ( str_command ) , "/fset -go %s" , ptr_chat_line_y ) ; weechat_command ( fset_buffer , str_command ) ; if ( weechat_string_match ( ptr_key , "button2-gesture-left*" , 1 ) ) { distance = fset_mouse_get_distance_x ( hashtable ) ; if ( ( ptr_fset_option -> type == FSET_OPTION_TYPE_INTEGER ) || ( ptr_fset_option -> type == FSET_OPTION_TYPE_COLOR ) ) { snprintf ( str_command , sizeof ( str_command ) , "/fset -add -%d" , distance ) ; } else { snprintf ( str_command , sizeof ( str_command ) , "/fset -set" ) ; } weechat_command ( fset_buffer , str_command ) ; } if ( weechat_string_match ( ptr_key , "button2-gesture-right*" , 1 ) ) { distance = fset_mouse_get_distance_x ( hashtable ) ; if ( ( ptr_fset_option -> type == FSET_OPTION_TYPE_INTEGER ) || ( ptr_fset_option -> type == FSET_OPTION_TYPE_COLOR ) ) { snprintf ( str_command , sizeof ( str_command ) , "/fset -add %d" , distance ) ; } else { snprintf ( str_command , sizeof ( str_command ) , "/fset -append" ) ; } weechat_command ( fset_buffer , str_command ) ; } if ( weechat_string_match ( ptr_key , "button2*" , 1 ) ) { if ( fset_mouse_get_coords ( hashtable , & y , & y2 , & chat_line_y , & chat_line_y2 ) ) { if ( y == y2 ) { snprintf ( str_command , sizeof ( str_command ) , "/fset %s" , ( ptr_fset_option -> type == FSET_OPTION_TYPE_BOOLEAN ) ?"-toggle" : "-set" ) ; weechat_command ( fset_buffer , str_command ) ; } if ( ( chat_line_y >= 0 ) || ( chat_line_y2 >= 0 ) ) { num_options = weechat_arraylist_size ( fset_options ) ; if ( chat_line_y < 0 ) { chat_line_y = ( y > y2 ) ?0 : num_options - 1 ; } if ( chat_line_y2 < 0 ) { chat_line_y2 = ( y > y2 ) ?0 : num_options - 1 ; } min_y = ( chat_line_y < chat_line_y2 ) ?chat_line_y : chat_line_y2 ; max_y = ( chat_line_y > chat_line_y2 ) ?chat_line_y : chat_line_y2 ; if ( min_y < 0 ) { min_y = 0 ; } if ( max_y > num_options - 1 ) { max_y = num_options - 1 ; } for ( i = min_y ; i <= max_y ; i ++ ) { ptr_fset_option = weechat_arraylist_get ( fset_options , i ) ; if ( ptr_fset_option ) { fset_option_toggle_mark ( ptr_fset_option , NULL ) ; } } snprintf ( str_command , sizeof ( str_command ) , "/fset -go %d" , chat_line_y2 ) ; weechat_command ( fset_buffer , str_command ) ; } } } return WEECHAT_RC_OK ; } 