rpmstrPool rpmstrPoolFree ( rpmstrPool pool ) { if ( pool ) { poolLock ( pool , 1 ) ; if ( pool -> nrefs > 1 ) { pool -> nrefs -- ; poolUnlock ( pool ) ; } else { if ( pool_debug ) { poolHashPrintStats ( pool ) ; } poolHashFree ( pool -> hash ) ; for ( int i = 1 ; i <= pool -> chunks_size ; i ++ ) { pool -> chunks [ i ] = _free ( pool -> chunks [ i ] ) ; } free ( pool -> chunks ) ; poolUnlock ( pool ) ; pthread_rwlock_destroy ( & pool -> lock ) ; free ( pool ) ; } } return NULL ; } 