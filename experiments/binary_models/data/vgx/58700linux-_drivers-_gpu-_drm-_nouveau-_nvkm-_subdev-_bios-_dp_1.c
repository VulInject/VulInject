u16 nvbios_dpout_parse ( struct nvkm_bios * bios , u8 idx , u8 * ver , u8 * hdr , u8 * cnt , u8 * len , struct nvbios_dpout * info ) { u16 data = nvbios_dpout_entry ( bios , idx , ver , hdr , cnt , len ) ; if ( data && * ver ) { info -> type = nvbios_rd16 ( bios , data + 0x00 ) ; info -> mask = nvbios_rd16 ( bios , data + 0x02 ) ; switch ( * ver ) { case 0x20 : info -> mask |= 0x00c0 ; fallthrough ; case 0x21 : case 0x30 : info -> flags = nvbios_rd08 ( bios , data + 0x05 ) ; info -> script [ 0 ] = nvbios_rd16 ( bios , data + 0x06 ) ; info -> script [ 1 ] = nvbios_rd16 ( bios , data + 0x08 ) ; if ( * len >= 0x0c ) { info -> lnkcmp = nvbios_rd16 ( bios , data + 0x0a ) ; } if ( * len >= 0x0f ) { info -> script [ 2 ] = nvbios_rd16 ( bios , data + 0x0c ) ; info -> script [ 3 ] = nvbios_rd16 ( bios , data + 0x0e ) ; } if ( * len >= 0x11 ) { info -> script [ 4 ] = nvbios_rd16 ( bios , data + 0x10 ) ; } break ; case 0x40 : case 0x41 : case 0x42 : info -> flags = nvbios_rd08 ( bios , data + 0x04 ) ; info -> script [ 0 ] = nvbios_rd16 ( bios , data + 0x05 ) ; info -> script [ 1 ] = nvbios_rd16 ( bios , data + 0x07 ) ; info -> lnkcmp = nvbios_rd16 ( bios , data + 0x09 ) ; info -> script [ 2 ] = nvbios_rd16 ( bios , data + 0x0b ) ; info -> script [ 3 ] = nvbios_rd16 ( bios , data + 0x0d ) ; info -> script [ 4 ] = nvbios_rd16 ( bios , data + 0x0f ) ; break ; default : data = 0x0000 ; break ; } } return data ; } 