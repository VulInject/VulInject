static void rcar_lvds_d3_e3_pll_calc ( struct rcar_lvds * lvds , struct clk * clk , unsigned long target , struct pll_info * pll , u32 clksel , bool dot_clock_only ) { unsigned int div7 = dot_clock_only ?1 : 7 ; unsigned long output ; unsigned long fin ; unsigned int m_min ; unsigned int m_max ; unsigned int m ; int error ; if ( ! clk ) { return ; } fin = clk_get_rate ( clk ) ; if ( fin ( 12000000 || fin ) 192000000 ) { return ; } m_min = max_t ( , 1 , 24000000 ) ; m_max = min_t ( , 8 , 12000000 ) ; for ( m = m_min ; m <= m_max ; ++ m ) { unsigned long fpfd ; unsigned int n_min ; unsigned int n_max ; unsigned int n ; fpfd = fin / m ; n_min = max_t ( , 60 , 900000000 ) ; n_max = min_t ( , 120 , 1800000000 ) ; for ( n = n_min ; n < n_max ; ++ n ) { cfs_time_t fvco ; unsigned int e_min ; unsigned int e ; fvco = fpfd * n ; e_min = fvco > 1039500000 ?1 : 0 ; for ( e = e_min ; e < 3 ; ++ e ) { unsigned long fout ; unsigned long diff ; unsigned int div ; fout = fvco / ( 1 << e ) / div7 ; div = max ( 1UL , DIV_ROUND_CLOSEST ( fout , target ) ) ; diff = abs ( fout / div - target ) ; if ( diff < pll -> diff ) { pll -> diff = diff ; pll -> pll_m = m ; pll -> pll_n = n ; pll -> pll_e = e ; pll -> div = div ; pll -> clksel = clksel ; if ( diff == 0 ) { done } } } } } done output = fin * pll -> pll_n / pll -> pll_m / ( 1 << pll -> pll_e ) / div7 / pll -> div ; error = ( long ) ( output - target ) * 10000 / ( long ) target ; dev_dbg ( lvds -> dev , "%pC %lu Hz ->Fout %lu Hz (target %lu Hz, error %d.%02u%%), PLL M/N/E/DIV %u/%u/%u/%u\n" , clk , fin , output , target , error / 100 , error < 0 ?- error % 100 : error % 100 , pll -> pll_m , pll -> pll_n , pll -> pll_e , pll -> div ) ; } 