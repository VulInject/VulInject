static int bcm4377_check_bdaddr ( struct bcm4377_data * bcm4377 ) { struct hci_rp_read_bd_addr * bda ; struct sk_buff * skb ; skb = __hci_cmd_sync ( bcm4377 -> hdev , HCI_OP_READ_BD_ADDR , 0 , NULL , HCI_INIT_TIMEOUT ) ; if ( IS_ERR ( skb ) ) { int err = PTR_ERR ( skb ) ; dev_err ( & bcm4377 -> pdev -> dev , "HCI_OP_READ_BD_ADDR failed (%d)" , err ) ; return err ; } if ( skb -> len != sizeof ( * bda ) ) { dev_err ( & bcm4377 -> pdev -> dev , "HCI_OP_READ_BD_ADDR reply length invalid" ) ; return - EIO ; } bda = ( hci_rp_read_bd_addr * ) skb -> data ; if ( ! bcm4377_is_valid_bdaddr ( bcm4377 , & bda -> bdaddr ) ) { set_bit ( HCI_QUIRK_INVALID_BDADDR , & bcm4377 -> hdev -> quirks ) ; } kfree_skb ( skb ) ; return 0 ; } 