int dsl_prop_get_ds ( dsl_dataset_t * ds , const char * propname , int intsz , int numints , void * buf , char * setpoint ) { zfs_prop_t prop = zfs_name_to_prop ( propname ) ; boolean_t inheritable ; uint64_t zapobj ; ASSERT ( dsl_pool_config_held ( ds -> ds_dir -> dd_pool ) ) ; inheritable = ( prop == ZPROP_INVAL || zfs_prop_inheritable ( prop ) ) ; zapobj = dsl_dataset_phys ( ds ) -> ds_props_obj ; if ( zapobj != 0 ) { objset_t * mos = ds -> ds_dir -> dd_pool -> dp_meta_objset ; int err ; ASSERT ( ds -> ds_is_snapshot , NULL ) ; err = zap_lookup ( mos , zapobj , propname , intsz , numints , buf ) ; if ( err != ENOENT ) { if ( setpoint != NULL && err == 0 ) { dsl_dataset_name ( ds , setpoint ) ; } return ( err ) ; } if ( inheritable ) { char * inheritstr = kmem_asprintf ( "%s%s" , propname , ZPROP_INHERIT_SUFFIX ) ; err = zap_contains ( mos , zapobj , inheritstr ) ; strfree ( inheritstr ) ; if ( err != 0 && err != ENOENT ) { return ( err ) ; } } if ( err == ENOENT ) { char * recvdstr = kmem_asprintf ( "%s%s" , propname , ZPROP_RECVD_SUFFIX ) ; err = zap_lookup ( mos , zapobj , recvdstr , intsz , numints , buf ) ; strfree ( recvdstr ) ; if ( err != ENOENT ) { if ( setpoint != NULL && err == 0 ) { ( void ) strcpy ( setpoint , ZPROP_SOURCE_VAL_RECVD ) ; } return ( err ) ; } } } return ( dsl_prop_get_dd ( ds -> ds_dir , propname , intsz , numints , buf , setpoint , ds -> ds_is_snapshot ) ) ; } 