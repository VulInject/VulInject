struct auxtrace_record * auxtrace_record__init ( struct evlist * evlist , int * err ) { struct auxtrace_record * aux ; struct evsel * pos ; int diagnose = 0 ; * err = 0 ; if ( evlist -> core . nr_entries == 0 ) { return NULL ; } evlist__for_each_entry ( , ) { if ( pos -> core . attr . config == PERF_EVENT_CPUM_SF_DIAG ) { diagnose = 1 ; pos -> needs_auxtrace_mmap = true ; break ; } } if ( ! diagnose ) { return in ; } aux = zalloc ( sizeof ( * aux ) ) ; if ( aux == NULL ) { * err = - ENOMEM ; return NULL ; } aux -> parse_snapshot_options = cpumsf_parse_snapshot_options ; aux -> recording_options = cpumsf_recording_options ; aux -> info_priv_size = cpumsf_info_priv_size ; aux -> info_fill = cpumsf_info_fill ; aux -> free = cpumsf_free ; aux -> reference = cpumsf_reference ; return aux ; } 