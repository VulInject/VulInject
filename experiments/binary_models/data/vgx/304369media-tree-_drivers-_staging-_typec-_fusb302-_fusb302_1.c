static int fusb302_i2c_block_write ( struct fusb302_chip * chip , u8 address , u8 length , const u8 * data ) { int retry_cnt ; int ret = 0 ; atomic_set ( & chip -> i2c_busy , 1 ) ; for ( retry_cnt = 0 ; retry_cnt < FUSB302_RESUME_RETRY ; retry_cnt ++ ) { if ( atomic_read ( & chip -> pm_suspend ) ) { pr_err ( "fusb302_i2c: pm suspend, retry %d/%d\n" , retry_cnt + 1 , FUSB302_RESUME_RETRY ) ; msleep ( FUSB302_RESUME_RETRY_SLEEP ) ; } else { break ; } } ret = i2c_smbus_write_i2c_block_data ( chip -> i2c_client , address , length , data ) ; if ( ret < 0 ) { fusb302_log ( chip , "cannot block write 0x%02x, len=%d, ret=%d" , address , length , ret ) ; } atomic_set ( & chip -> i2c_busy , 0 ) ; return ret ; } 