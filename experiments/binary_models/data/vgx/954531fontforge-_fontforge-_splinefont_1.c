ArchiveCleanup ( archivedir ) ; return ( NULL ) ; ( listcommand ) ; desiredfile = ArchiveParseTOC ( listfile , archivers [ i ] . ars , & doall ) ; free ( listfile ) ; if ( desiredfile == NULL ) { return ( NULL ) ; } unarchivecmd = malloc ( strlen ( archivers [ i ] . unarchive ) + 1 + strlen ( archivers [ i ] . listargs ) + 1 + strlen ( name ) + 1 + strlen ( desiredfile ) + 3 + strlen ( archivedir ) + 30 ) ; sprintf ( unarchivecmd , "( cd %s ; %s %s %s %s )>/dev/null" , archivedir , archivers [ i ] . unarchive , archivers [ i ] . extractargs , name , doall ?"" : desiredfile ) ; if ( system ( unarchivecmd ) != 0 ) { free ( unarchivecmd ) ; free ( desiredfile ) ; ArchiveCleanup ( archivedir ) ; return ( NULL ) ; } free ( unarchivecmd ) ; finalfile = malloc ( strlen ( archivedir ) + 1 + strlen ( desiredfile ) + 1 ) ; sprintf ( finalfile , "%s/%s" , archivedir , desiredfile ) ; free ( desiredfile ) ; * _archivedir = archivedir ; return ( finalfile ) ; 