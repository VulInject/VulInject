static int open_dmap ( struct audio_operations * adev , int mode , struct dma_buffparms * dmap ) { int err ; if ( dmap -> flags & DMA_BUSY ) { return - EBUSY ; } if ( ( err = sound_alloc_dmap ( dmap ) ) < 0 ) { return err ; } if ( dmap -> raw_buf == NULL ) { printk ( KERN_WARNING "Sound: DMA buffers not available\n" ) ; return - ENOSPC ; } if ( dmap -> dma >= 0 && sound_open_dma ( dmap -> dma , adev -> name ) ) { printk ( KERN_WARNING "Unable to grab(2) DMA%d for the audio driver\n" , dmap -> dma ) ; return - EBUSY ; } dma_init_buffers ( dmap ) ; spin_lock_init ( & dmap -> lock ) ; dmap -> open_mode = mode ; dmap -> subdivision = dmap -> underrun_count = 0 ; dmap -> fragment_size = 0 ; dmap -> max_fragments = 65536 ; dmap -> byte_counter = 0 ; dmap -> max_byte_counter = 8000 * 60 * 60 ; dmap -> applic_profile = APF_NORMAL ; dmap -> audio_callback = NULL ; dmap -> callback_parm = 0 ; return 0 ; } 