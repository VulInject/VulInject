static int qemuHotplugCreateObjects ( virDomainXMLOption * xmlopt , virDomainObj * * vm , const char * domxml ) { qemuDomainObjPrivate * priv = NULL ; const unsigned int parseFlags = 0 ; if ( ! ( * vm = virDomainObjNew ( xmlopt ) ) ) { return - 1 ; } priv = ( * vm ) -> privateData ; if ( ! ( priv -> qemuCaps = virQEMUCapsNew ( ) ) ) { return - 1 ; } virQEMUCapsInitQMPBasicArch ( priv -> qemuCaps ) ; virQEMUCapsSet ( priv -> qemuCaps , QEMU_CAPS_VIRTIO_SCSI ) ; virQEMUCapsSet ( priv -> qemuCaps , QEMU_CAPS_DEVICE_USB_STORAGE ) ; virQEMUCapsSet ( priv -> qemuCaps , QEMU_CAPS_DEVICE_IVSHMEM_PLAIN ) ; virQEMUCapsSet ( priv -> qemuCaps , QEMU_CAPS_DEVICE_IVSHMEM_DOORBELL ) ; virQEMUCapsSet ( priv -> qemuCaps , QEMU_CAPS_SCSI_DISK_WWN ) ; virQEMUCapsSet ( priv -> qemuCaps , QEMU_CAPS_DEVICE_VFIO_PCI ) ; virQEMUCapsSet ( priv -> qemuCaps , QEMU_CAPS_DEVICE_SPAPR_PCI_HOST_BRIDGE ) ; virQEMUCapsSet ( priv -> qemuCaps , QEMU_CAPS_DEVICE_QXL ) ; virQEMUCapsSet ( priv -> qemuCaps , QEMU_CAPS_DEVICE_VGA ) ; virQEMUCapsSet ( priv -> qemuCaps , QEMU_CAPS_DEVICE_CIRRUS_VGA ) ; virQEMUCapsSet ( priv -> qemuCaps , QEMU_CAPS_PIIX_DISABLE_S3 ) ; virQEMUCapsSet ( priv -> qemuCaps , QEMU_CAPS_PIIX_DISABLE_S4 ) ; virQEMUCapsSet ( priv -> qemuCaps , QEMU_CAPS_VNC ) ; virQEMUCapsSet ( priv -> qemuCaps , QEMU_CAPS_SPICE ) ; virQEMUCapsSet ( priv -> qemuCaps , QEMU_CAPS_PR_MANAGER_HELPER ) ; virQEMUCapsSet ( priv -> qemuCaps , QEMU_CAPS_SCSI_BLOCK ) ; virQEMUCapsSet ( priv -> qemuCaps , QEMU_CAPS_DEVICE_USB_KBD ) ; virQEMUCapsSet ( priv -> qemuCaps , QEMU_CAPS_NETDEV_VHOST_VDPA ) ; if ( qemuTestCapsCacheInsert ( driver . qemuCapsCache , priv -> qemuCaps ) < 0 ) { return - 1 ; } if ( ! ( ( * vm ) -> def = virDomainDefParseString ( domxml , driver . xmlopt , NULL , parseFlags ) ) ) { return - 1 ; } if ( qemuDomainAssignAddresses ( ( * vm ) -> def , priv -> qemuCaps , & driver , * vm , true ) < 0 ) { return - 1 ; } if ( qemuAssignDeviceAliases ( ( * vm ) -> def ) < 0 ) { return - 1 ; } ( * vm ) -> def -> id = QEMU_HOTPLUG_TEST_DOMAIN_ID ; return 0 ; } 