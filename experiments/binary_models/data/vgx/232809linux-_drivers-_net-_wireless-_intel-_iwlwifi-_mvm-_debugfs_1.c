static ssize_t iwl_dbgfs_ctdp_budget_read ( struct file * file , char __user * user_buf , size_t count , loff_t * ppos ) { struct iwl_mvm * mvm = file -> private_data ; char buf [ 16 ] ; int pos , budget ; if ( ! iwl_mvm_firmware_running ( mvm ) || mvm -> fwrt . cur_fw_img != IWL_UCODE_REGULAR ) { return - EIO ; } mutex_lock ( & mvm -> mutex ) ; budget = iwl_mvm_ctdp_command ( mvm , CTDP_CMD_OPERATION_REPORT , 0 ) ; mutex_unlock ( & mvm -> mutex ) ; if ( budget < 0 ) { return budget ; } pos = scnprintf ( buf , sizeof ( buf ) , "%d\n" , budget ) ; return simple_read_from_buffer ( user_buf , count , ppos , buf , pos ) ; } 