static void parse_exit_reason_from_stderr ( svc_action_t * op ) { const char * reason_start = NULL ; const char * reason_end = NULL ; const int prefix_len = strlen ( PCMK_OCF_REASON_PREFIX ) ; for ( const char * cur = strstr ( op -> stderr_data , PCMK_OCF_REASON_PREFIX ) ; cur != NULL ; cur = strstr ( cur , PCMK_OCF_REASON_PREFIX ) ) { cur += prefix_len ; reason_start = cur ; } if ( ( reason_start == NULL ) || ( reason_start [ 0 ] == '\n' ) || ( reason_start [ 0 ] == '\0' ) ) { return ; } reason_end = strchr ( reason_start , '\n' ) ; if ( reason_end == NULL ) { reason_end = reason_start + strlen ( reason_start ) ; } if ( reason_end > ( reason_start + EXIT_REASON_MAX_LEN ) ) { reason_end = reason_start + EXIT_REASON_MAX_LEN ; } free ( op -> opaque -> exit_reason ) ; op -> opaque -> exit_reason = strndup ( reason_start , reason_end - reason_start ) ; } 