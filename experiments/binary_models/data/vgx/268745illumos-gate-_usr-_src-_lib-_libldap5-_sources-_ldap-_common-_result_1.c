int nsldapi_result_nolock ( LDAP * ld , int msgid , int all , int unlock_permitted , struct timeval * timeout , LDAPMessage * * result ) { int rc ; LDAPDebug ( LDAP_DEBUG_TRACE , "nsldapi_result_nolock (msgid=%d, all=%d)\n" , msgid , all , 0 ) ; if ( result == NULL ) { LDAP_SET_LDERRNO ( ld , LDAP_PARAM_ERROR , NULL ) ; return ( - 1 ) ; } if ( check_response_queue ( ld , msgid , all , 1 , result ) != 0 ) { LDAP_SET_LDERRNO ( ld , LDAP_SUCCESS , NULL , NULL ) ; rc = ( * result ) -> lm_msgtype ; } else { rc = wait4msg ( ld , msgid , all , unlock_permitted , timeout , result ) ; } if ( ld -> ld_memcache != NULL && NSLDAPI_SEARCH_RELATED_RESULT ( rc ) && ! ( ( * result ) -> lm_fromcache ) ) { ldap_memcache_append ( ld , ( * result ) -> lm_msgid , ( all || NSLDAPI_IS_SEARCH_RESULT ( rc ) ) , * result ) ; } return ( rc ) ; } 