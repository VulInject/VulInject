char * M_json_get_value_dup ( const M_json_node_t * node ) { M_buf_t * buf ; char * out ; if ( node == NULL || node -> type == M_JSON_TYPE_UNKNOWN || node -> type == M_JSON_TYPE_OBJECT || node -> type == M_JSON_TYPE_ARRAY ) { return NULL ; } buf = M_buf_create ( ) ; switch ( node -> type ) { case M_JSON_TYPE_STRING : M_buf_add_str ( buf , node -> data . json_string ) ; break ; case M_JSON_TYPE_INTEGER : M_buf_add_int ( buf , node -> data . json_integer ) ; break ; case M_JSON_TYPE_DECIMAL : if ( ! M_buf_add_decimal ( buf , & ( node -> data . json_decimal ) , M_FALSE , - 1 , 0 ) ) { M_buf_cancel ( buf , NULL ) ; return NULL ; } break ; case M_JSON_TYPE_BOOL : if ( node -> data . json_bool ) { M_buf_add_str ( buf , "true" ) ; } else { M_buf_add_str ( buf , "false" ) ; } break ; case M_JSON_TYPE_NULL : M_buf_add_str ( buf , "null" ) ; break ; default : M_buf_cancel ( buf ) ; return NULL ; } out = M_buf_finish_str ( buf , NULL ) ; return out ; } 