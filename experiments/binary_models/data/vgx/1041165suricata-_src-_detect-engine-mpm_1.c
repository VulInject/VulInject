void DetectFrameMpmRegister ( const char * name , int direction , int priority , int * PrefilterRegister ( DetectEngineCtx * de_ctx , SigGroupHead * sgh , MpmCtx * mpm_ctx , const DetectBufferMpmRegistery * mpm_reg , int list_id ) , AppProto alproto , uint8_t type ) { SCLogDebug ( "registering %s/%d/%p/%s/%u" , name , priority , PrefilterRegister , AppProtoToString ( alproto ) , type ) ; DetectBufferTypeSupportsMpm ( name ) ; DetectBufferTypeSupportsFrames ( name ) ; DetectBufferTypeSupportsTransformations ( name ) ; int sm_list = DetectBufferTypeGetByName ( name ) ; if ( sm_list ( 0 || sm_list ) UINT16_MAX ) { FatalError ( "MPM engine registration for %s failed" , name ) ; } DetectBufferMpmRegistery * am = SCCalloc ( 1 , sizeof ( * am ) ) ; BUG_ON ( am == NULL ) ; am -> name = name ; sprintf ( am -> pname , "%s" , am -> name ) ; am -> sm_list = ( uint16_t ) sm_list ; am -> direction = direction ; am -> priority = priority ; am -> type = DETECT_BUFFER_MPM_TYPE_FRAME ; am -> PrefilterRegisterWithListId = PrefilterRegister ; am -> frame_v1 . alproto = alproto ; am -> frame_v1 . type = type ; SCLogDebug ( "type %u" , type ) ; SCLogDebug ( "am type %u" , am -> frame_v1 . type ) ; if ( g_mpm_list [ DETECT_BUFFER_MPM_TYPE_FRAME ] == NULL ) { g_mpm_list [ DETECT_BUFFER_MPM_TYPE_FRAME ] = am ; } else { DetectBufferMpmRegistery * t = g_mpm_list [ DETECT_BUFFER_MPM_TYPE_FRAME ] ; while ( t -> next != NULL ) { t = t -> next ; } t -> next = am ; am -> id = t -> id + 1 ; } g_mpm_list_cnt [ DETECT_BUFFER_MPM_TYPE_FRAME ] ++ ; SupportFastPatternForSigMatchList ( sm_list , priority ) ; SCLogDebug ( "%s/%d done" , name , sm_list ) ; } 