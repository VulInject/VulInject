static void csio_ln_fdmi_dhba_cbfn ( struct csio_hw * hw , struct csio_ioreq * fdmi_req ) { struct csio_lnode * ln = fdmi_req -> lnode ; void * cmd ; struct fc_fdmi_port_name * port_name ; uint32_t len ; if ( fdmi_req -> wr_status != FW_SUCCESS ) { csio_ln_dbg ( ln , "WR error:%x in processing fdmi dhba cmd\n" , fdmi_req -> wr_status ) ; CSIO_INC_STATS ( ln , n_fdmi_err ) ; } if ( ! csio_is_rnode_ready ( fdmi_req -> rnode ) ) { CSIO_INC_STATS ( ln , n_fdmi_err ) ; return ; } cmd = fdmi_req -> dma_buf . vaddr ; if ( ntohs ( csio_ct_rsp ( cmd ) ) != FC_FS_ACC ) { csio_ln_dbg ( ln , "fdmi dhba cmd rejected reason %x expl %x\n" , csio_ct_reason ( cmd ) , csio_ct_expl ( cmd ) ) ; } csio_fill_ct_iu ( cmd , FC_FST_MGMT , FC_FDMI_SUBTYPE , FC_FDMI_DPRT ) ; len = FC_CT_HDR_LEN ; port_name = ( fc_fdmi_port_name * ) csio_ct_get_pld ( cmd ) ; memcpy ( & port_name -> portname , csio_ln_wwpn ( ln ) , 8 ) ; len += sizeof ( * port_name ) ; spin_lock_irq ( & hw -> lock ) ; if ( csio_ln_mgmt_submit_req ( fdmi_req , csio_ln_fdmi_dprt_cbfn , FCOE_CT , & fdmi_req -> dma_buf , len ) ) { CSIO_INC_STATS ( ln , n_fdmi_err ) ; csio_ln_dbg ( ln , "Failed to issue fdmi dprt req\n" ) ; } spin_unlock_irq ( & hw -> lock ) ; } 