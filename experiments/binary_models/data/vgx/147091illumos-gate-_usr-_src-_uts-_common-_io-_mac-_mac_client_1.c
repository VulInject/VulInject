int mac_open ( const char * macname , mac_handle_t * mhp ) { mac_impl_t * mip ; int err ; if ( ( err = mac_hold ( macname , & mip ) ) != 0 ) { return ( err ) ; } e_ddi_hold_devi ( mip -> mi_dip ) ; if ( ! ( mip -> mi_callbacks -> mc_callbacks & MC_OPEN ) ) { * mhp = ( mac_handle_t ) mip ; return ( 0 ) ; } i_mac_perim_enter ( mip , NULL ) ; mip -> mi_oref ++ ; if ( mip -> mi_oref != 1 || ( ( err = mip -> mi_open ( mip -> mi_driver ) ) == 0 ) ) { * mhp = ( mac_handle_t ) mip ; i_mac_perim_exit ( mip ) ; return ( 0 ) ; } mip -> mi_oref -- ; ddi_release_devi ( mip -> mi_dip ) ; mac_rele ( mip ) ; i_mac_perim_exit ( mip ) ; return ( err ) ; } 