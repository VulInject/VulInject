int amdgpu_amdkfd_alloc_gws ( struct amdgpu_device * adev , size_t size , void * * mem_obj ) { struct amdgpu_bo * bo = NULL ; struct amdgpu_bo_user * ubo ; struct amdgpu_bo_param bp ; int r ; bp . size = size ; bp . byte_align = 1 ; bp . domain = AMDGPU_GEM_DOMAIN_GWS ; bp . flags = AMDGPU_GEM_CREATE_NO_CPU_ACCESS ; bp . type = ttm_bo_type_device ; bp . resv = NULL ; bp . bo_ptr_size = sizeof ( amdgpu_bo ) ; r = amdgpu_bo_create_user ( adev , & bp , & ubo ) ; if ( r ) { dev_err ( adev -> dev , "failed to allocate gws BO for amdkfd (%d)\n" , r ) ; return r ; } bo = & ubo -> bo ; * mem_obj = bo ; return 0 ; } 