static int uwsgi_routing_func_tofile ( struct wsgi_request * wsgi_req , struct uwsgi_route * ur ) { struct uwsgi_router_tofile_conf * urtc = ( uwsgi_router_tofile_conf * ) ur -> data2 ; struct uwsgi_transformation_tofile_conf * uttc = uwsgi_calloc ( sizeof ( uwsgi_transformation_tofile_conf ) ) ; char * * subject = ( char * * ) ( ( ( char * ) ( wsgi_req ) ) + ur -> subject ) ; uint16_t * subject_len = ( uint16_t * ) ( ( ( char * ) ( wsgi_req ) ) + ur -> subject_len ) ; uttc -> filename = uwsgi_routing_translate ( wsgi_req , ur , * subject , * subject_len , urtc -> filename , urtc -> filename_len ) ; if ( ! uttc -> filename ) { error } uwsgi_add_transformation ( wsgi_req , transform_tofile , uttc ) ; return UWSGI_ROUTE_NEXT ; error if ( uttc -> filename ) { uwsgi_buffer_destroy ( uttc -> filename ) ; } return UWSGI_ROUTE_NEXT ; } 