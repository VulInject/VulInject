ec_mulm_25519 ( , , , ) { mpi_ptr_t wp , up , vp ; mpi_size_t wsize = LIMB_SIZE_25519 ; mpi_limb_t n [ LIMB_SIZE_25519 * 2 ] ; mpi_limb_t cy ; int msb ; ( void ) ctx ; if ( w -> nlimbs != wsize || u -> nlimbs != wsize || v -> nlimbs != wsize ) { log_bug ( "mulm_25519: different sizes\n" ) ; } up = u -> d ; vp = v -> d ; wp = w -> d ; _gcry_mpih_mul_n ( n , up , vp , wsize ) ; memcpy ( wp , n , wsize * BYTES_PER_MPI_LIMB ) ; wp [ LIMB_SIZE_25519 - 1 ] &= ~ ( ( mpi_limb_t ) 1 << ( 255 % BITS_PER_MPI_LIMB ) ) ; _gcry_mpih_rshift ( n , n + LIMB_SIZE_25519 - 1 , LIMB_SIZE_25519 + 1 , ( 255 % BITS_PER_MPI_LIMB ) ) ; cy = _gcry_mpih_addmul_1 ( wp , n , wsize , 19 ) ; msb = ( wp [ LIMB_SIZE_25519 - 1 ] >> ( 255 % BITS_PER_MPI_LIMB ) ) ; n [ 0 ] = ( cy * 2 + msb ) * 19 ; wp [ LIMB_SIZE_25519 - 1 ] &= ~ ( ( mpi_limb_t ) 1 << ( 255 % BITS_PER_MPI_LIMB ) ) ; _gcry_mpih_add_n ( wp , wp , n , wsize ) ; cy = _gcry_mpih_sub_n ( n , wp , ctx -> p -> d , wsize ) ; mpih_set_cond ( wp , n , wsize , ( cy == 0UL ) ) ; } 