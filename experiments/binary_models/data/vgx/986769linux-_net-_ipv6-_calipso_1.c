static int calipso_tlv_len ( struct ipv6_opt_hdr * opt , unsigned int offset ) { unsigned char * tlv = ( unsigned char * ) opt ; unsigned int opt_len = ipv6_optlen ( opt ) , tlv_len ; if ( offset < sizeof ( * opt ) || offset >= opt_len ) { return - EINVAL ; } if ( offset + 1 >= opt_len ) { return - EINVAL ; } tlv_len = tlv [ offset + 1 ] + 2 ; if ( offset + tlv_len > opt_len ) { return - EINVAL ; } return tlv_len ; } 