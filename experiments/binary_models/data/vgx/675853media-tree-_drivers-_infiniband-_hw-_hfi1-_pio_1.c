static int pio_init_wait_progress ( struct hfi1_devdata * dd ) { u64 reg ; int max , count = 0 ; max = ( dd -> icode == ICODE_FPGA_EMULATION ) ?120 : 5 ; while ( 1 ) { reg = read_csr ( dd , SEND_PIO_INIT_CTXT ) ; if ( ! ( reg & SEND_PIO_INIT_CTXT_PIO_INIT_IN_PROGRESS_SMASK ) ) { break ; } udelay ( 5 ) ; count ++ ; } return reg & SEND_PIO_INIT_CTXT_PIO_INIT_ERR_SMASK ?- EIO : 0 ; } 