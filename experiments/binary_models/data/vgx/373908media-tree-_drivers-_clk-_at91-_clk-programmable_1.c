static struct clk_hw * __init at91_clk_register_programmable ( struct regmap * regmap , const char * name , const char * * parent_names , u8 num_parents , u8 id , const struct clk_programmable_layout * layout ) { struct clk_programmable * prog ; struct clk_hw * hw ; struct clk_init_data init ; int ret ; if ( id > PROG_ID_MAX ) { return ERR_PTR ( - EINVAL ) ; } prog = kmalloc ( sizeof ( * prog ) , GFP_KERNEL ) ; if ( ! prog ) { return ERR_PTR ( - ENOMEM ) ; } init . name = name ; init . ops = & programmable_ops ; init . parent_names = parent_names ; init . num_parents = num_parents ; init . flags = CLK_SET_RATE_GATE | CLK_SET_PARENT_GATE ; prog -> id = id ; prog -> layout = layout ; prog -> hw . init = & init ; prog -> regmap = regmap ; hw = & prog -> hw ; ret = clk_hw_register ( NULL , & prog -> hw ) ; if ( ret ) { kfree ( prog ) ; hw = ERR_PTR ( ret ) ; } return hw ; } 