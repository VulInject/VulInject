static void ppc440spe_adma_free_chan_resources ( struct dma_chan * chan ) { struct ppc440spe_adma_chan * ppc440spe_chan ; struct ppc440spe_adma_desc_slot * iter , * _iter ; int in_use_descs = 0 ; ppc440spe_chan = to_ppc440spe_adma_chan ( chan ) ; ppc440spe_adma_slot_cleanup ( ppc440spe_chan ) ; spin_lock_bh ( & ppc440spe_chan -> lock ) ; list_for_each_entry_safe ( , , , ) { in_use_descs ++ ; list_del ( & iter -> chain_node ) ; } list_for_each_entry_safe_reverse ( , , , ) { list_del ( & iter -> slot_node ) ; ppc440spe_chan -> slots_allocated -- ; } ppc440spe_chan -> last_used = NULL ; dev_dbg ( ppc440spe_chan -> device -> common . dev , "ppc440spe adma%d %s slots_allocated %d\n" , ppc440spe_chan -> device -> id , __func__ , ppc440spe_chan -> slots_allocated ) ; spin_unlock_bh ( & ppc440spe_chan -> lock ) ; if ( in_use_descs > 1 ) { printk ( KERN_ERR "SPE: Freeing %d in use descriptors!\n" , in_use_descs - 1 ) ; } } 