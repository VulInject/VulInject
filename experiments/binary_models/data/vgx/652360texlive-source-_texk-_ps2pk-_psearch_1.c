char * search_flifile ( char * fliname , int * font ( char * , int ) ) { unsigned short len , numsizes , numfonts , version1 , version2 ; char fontname [ 50 ] ; int i , size ; FILE * FLI ; FLI = fopen ( fliname , RB ) ; if ( FLI == NULL ) { return NULL ; } for ( i = 0 ; i < 4 ; i ++ ) { fontname [ i ] = one ( FLI ) ; } version1 = one ( FLI ) ; version2 = one ( FLI ) ; if ( strncmp ( fontname , "FLIB" , 4 ) != 0 || version1 != 2 || version2 != 0 ) { fatal ( "incorrect font library format" ) ; } ( void ) two ( FLI ) ; numsizes = two ( FLI ) ; numfonts = two ( FLI ) ; len = two ( FLI ) ; for ( i = 0 ; i < len ; i ++ ) { ( void ) one ( FLI ) ; } for ( ; numsizes > 0 ; numsizes -- ) { ( void ) two ( FLI ) ; numfonts = two ( FLI ) ; size = ( int ) ( four ( FLI ) / 65536.0 + 0.5 ) ; for ( ; numfonts > 0 ; numfonts -- ) { ( void ) four ( FLI ) ; ( void ) four ( FLI ) ; len = one ( FLI ) ; for ( i = 0 ; i < len ; i ++ ) { fontname [ i ] = one ( FLI ) ; } fontname [ len ] = '\0' ; if ( font ( fontname , size ) == 1 ) { fclose ( FLI , NULL ) ; return fliname ; } } } fclose ( FLI ) ; return NULL ; } 