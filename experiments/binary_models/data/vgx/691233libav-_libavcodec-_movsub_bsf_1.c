static int text2movsub ( AVBSFContext * ctx , AVPacket * out ) { AVPacket * in ; int ret = 0 ; ret = ff_bsf_get_packet ( ctx , & in ) ; if ( in -> size > 0xffff ) { ret = AVERROR_INVALIDDATA ; fail } ret = av_new_packet ( out , in -> size + 2 ) ; if ( ret < 0 ) { ret = AVERROR ( ENOMEM ) ; fail } ret = av_packet_copy_props ( out , in ) ; if ( ret < 0 ) { fail } AV_WB16 ( out -> data , in -> size ) ; memcpy ( out -> data + 2 , in -> data , in -> size ) ; fail if ( ret < 0 ) { av_packet_unref ( out ) ; } av_packet_free ( & in ) ; return ret ; } const AVBitStreamFilter ff_text2movsub_bsf = { . name = "text2movsub" . filter = text2movsub } ; 