static pci_ers_result_t e1000_io_slot_reset ( struct pci_dev * pdev ) { struct net_device * netdev = pci_get_drvdata ( pdev ) ; struct e1000_adapter * adapter = netdev_priv ( netdev ) ; struct e1000_hw * hw = & adapter -> hw ; u16 aspm_disable_flag = 0 ; int err ; pci_ers_result_t result ; if ( adapter -> flags2 & FLAG2_DISABLE_ASPM_L0S ) { aspm_disable_flag = PCIE_LINK_STATE_L0S ; } if ( adapter -> flags2 & FLAG2_DISABLE_ASPM_L1 ) { aspm_disable_flag |= PCIE_LINK_STATE_L1 ; } if ( aspm_disable_flag ) { e1000e_disable_aspm_locked ( pdev , aspm_disable_flag ) ; } err = pci_enable_device_mem ( pdev ) ; if ( err ) { dev_err ( & pdev -> dev , "Cannot re-enable PCI device after reset.\n" ) ; result = PCI_ERS_RESULT_DISCONNECT ; } else { pdev -> state_saved = true ; pci_restore_state ( pdev ) ; pci_set_master ( pdev ) ; pci_enable_wake ( pdev , PCI_D3hot , 0 ) ; pci_enable_wake ( pdev , PCI_D3cold , 0 ) ; e1000e_reset ( adapter ) ; ew32 ( WUS , ~ 0 ) ; result = PCI_ERS_RESULT_RECOVERED ; } pci_cleanup_aer_uncorrect_error_status ( pdev , NULL ) ; return result ; } 