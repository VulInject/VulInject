int detach_hdlc_protocol ( struct net_device * dev ) { hdlc_device * hdlc = dev_to_hdlc ( dev ) ; int err ; if ( hdlc -> proto ) { err = call_netdevice_notifiers ( NETDEV_PRE_TYPE_CHANGE , dev ) ; err = notifier_to_errno ( err ) ; if ( err ) { netdev_err ( dev , "Refused to change device type\n" ) ; return err ; } if ( hdlc -> proto -> detach ) { hdlc -> proto -> detach ( dev ) ; } module_put ( hdlc -> proto -> module ) ; hdlc -> proto = NULL ; } hdlc -> state = NULL ; hdlc_setup_dev ( dev ) ; return 0 ; } 