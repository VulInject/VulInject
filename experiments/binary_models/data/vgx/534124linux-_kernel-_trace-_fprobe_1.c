int register_fprobe ( struct fprobe * fp , const char * filter , const char * notfilter ) { struct ftrace_hash * hash ; unsigned char * str ; int ret , len ; if ( ! fp || ! filter ) { return - EINVAL ; } fprobe_init ( fp , NULL ) ; len = strlen ( filter ) ; str = kstrdup ( filter , GFP_KERNEL ) ; ret = ftrace_set_filter ( & fp -> ops , str , len , 0 ) ; kfree ( str ) ; if ( ret ) { return ret ; } if ( notfilter ) { len = strlen ( notfilter ) ; str = kstrdup ( notfilter , GFP_KERNEL ) ; ret = ftrace_set_notrace ( & fp -> ops , str , len , 0 ) ; kfree ( str ) ; if ( ret ) { out } } hash = rcu_access_pointer ( fp -> ops . local_hash . filter_hash ) ; if ( WARN_ON_ONCE ( ! hash ) ) { out } ret = fprobe_init_rethook ( fp , ( int ) hash -> count ) ; if ( ! ret ) { ret = register_ftrace_function ( & fp -> ops ) ; } out if ( ret ) { fprobe_fail_cleanup ( fp ) ; } return ret ; } 