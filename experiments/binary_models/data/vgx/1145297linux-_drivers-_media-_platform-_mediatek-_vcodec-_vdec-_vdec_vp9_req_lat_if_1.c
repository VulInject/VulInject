static int vdec_vp9_slice_setup_tile ( struct vdec_vp9_slice_vsi * vsi , struct v4l2_ctrl_vp9_frame * hdr ) { unsigned int rows_log2 ; unsigned int cols_log2 ; int rows ; unsigned int cols ; unsigned int mi_rows ; unsigned int mi_cols ; struct vdec_vp9_slice_tiles * tiles ; int offset ; int start ; int end ; int i ; rows_log2 = hdr -> tile_rows_log2 ; cols_log2 = hdr -> tile_cols_log2 ; rows = 1 << rows_log2 ; cols = 1 << cols_log2 ; tiles = & vsi -> frame . tiles ; tiles -> actual_rows = 0 ; if ( rows > 4 || cols > 64 ) { return - EINVAL ; } mi_rows = ( hdr -> frame_height_minus_1 + 1 + 7 ) >> 3 ; mi_cols = ( hdr -> frame_width_minus_1 + 1 + 7 ) >> 3 ; for ( i = 0 ; i < rows ; i ++ ) { start = vdec_vp9_slice_tile_offset ( i , mi_rows , rows_log2 ) ; end = vdec_vp9_slice_tile_offset ( i + 1 , mi_rows , rows_log2 ) ; offset = end - start ; tiles -> mi_rows [ i ] = ( offset + 7 ) >> 3 ; if ( tiles -> mi_rows [ i ] ) { tiles -> actual_rows ++ ; } } for ( i = 0 ; i < cols ; i ++ ) { start = vdec_vp9_slice_tile_offset ( i , mi_cols , cols_log2 ) ; end = vdec_vp9_slice_tile_offset ( i + 1 , mi_cols , cols_log2 ) ; offset = end - start ; tiles -> mi_cols [ i ] = ( offset + 7 ) >> 3 ; } return 0 ; } 