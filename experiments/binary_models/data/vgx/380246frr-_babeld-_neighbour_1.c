unsigned neighbour_cost ( struct neighbour * neigh ) { unsigned a , b , cost ; a = neighbour_txcost ( neigh ) ; if ( a >= INFINITY ) { return INFINITY ; } b = neighbour_rxcost ( neigh ) ; if ( b >= INFINITY ) { return INFINITY ; } if ( ! ( babel_get_if_nfo ( neigh -> ifp ) -> flags & BABEL_IF_LQ ) || ( a < 256 && b < 256 ) ) { cost = a ; } else { a = MAX ( a , 256 ) ; b = MAX ( b , 256 ) ; cost = ( a * b + 128 ) >> 8 ; } cost += neighbour_rttcost ( neigh ) ; return MIN ( cost , INFINITY ) ; } 