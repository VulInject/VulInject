static int __xfs_attr3_rmt_read_verify ( struct xfs_buf * bp , bool check_crc , xfs_failaddr_t * failaddr ) { struct xfs_mount * mp = bp -> b_mount ; char * ptr ; int len ; xfs_daddr_t bno ; int blksize = mp -> m_attr_geo -> blksize ; if ( ! xfs_has_crc ( mp ) ) { return 0 ; } ptr = bp -> b_addr ; bno = xfs_buf_daddr ( bp ) ; len = BBTOB ( bp -> b_length ) ; ASSERT ( len >= blksize ) ; while ( len > 0 ) { if ( check_crc && ! xfs_verify_cksum ( ptr , blksize , XFS_ATTR3_RMT_CRC_OFF ) ) { * failaddr = __this_address ; return - EFSBADCRC ; } * failaddr = xfs_attr3_rmt_verify ( mp , bp , ptr , blksize , bno ) ; len -= blksize ; ptr += blksize ; bno += BTOBB ( blksize ) ; } if ( len != 0 ) { * failaddr = __this_address ; return - EFSCORRUPTED ; } return 0 ; } 