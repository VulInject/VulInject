int sub1_from_channel ( Channel * channel ) { Ban * ban ; Link * lp ; int should_destroy = 1 ; -- channel -> users ; if ( channel -> users > 0 ) { return 0 ; } channel -> users = 0 ; RunHook ( HOOKTYPE_CHANNEL_DESTROY , channel , & should_destroy ) ; if ( ! should_destroy ) { return 0 ; } moddata_free_channel ( channel ) ; while ( channel -> banlist ) { ban = channel -> banlist ; channel -> banlist = ban -> next ; safe_free ( ban -> banstr ) ; free_ban ( ban ) ; } while ( channel -> exlist ) { ban = channel -> exlist ; channel -> exlist = ban -> next ; safe_free ( ban -> banstr ) ; safe_free ( ban -> who ) ; free_ban ( ban ) ; } while ( channel -> invexlist ) { ban = channel -> invexlist ; channel -> invexlist = ban -> next ; safe_free ( ban -> banstr ) ; safe_free ( ban -> who ) ; free_ban ( ban ) ; } extcmode_free_paramlist ( channel -> mode . mode_params ) ; safe_free ( channel -> mode_lock ) ; safe_free ( channel -> topic ) ; safe_free ( channel -> topic_nick ) ; if ( channel -> prevch ) { channel -> prevch -> nextch = channel -> nextch ; } else { channels = channel -> nextch ; } if ( channel -> nextch ) { channel -> nextch -> prevch = channel -> prevch ; } del_from_channel_hash_table ( channel -> name , channel ) ; irccounts . channels -- ; mp_pool_release ( channel ) ; return 1 ; } 