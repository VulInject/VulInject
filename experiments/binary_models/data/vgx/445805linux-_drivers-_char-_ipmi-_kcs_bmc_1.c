int kcs_bmc_add_device ( struct kcs_bmc_device * kcs_bmc ) { struct kcs_bmc_driver * drv ; int error = 0 ; int rc ; spin_lock_init ( & kcs_bmc -> lock ) ; mutex_lock ( & kcs_bmc_lock ) ; list_add ( & kcs_bmc -> entry , & kcs_bmc_devices ) ; list_for_each_entry ( , , ) { rc = drv -> ops -> add_device ( kcs_bmc ) ; if ( ! rc ) { continue ; } dev_err ( kcs_bmc -> dev , "Failed to add chardev for KCS channel %d: %d" , kcs_bmc -> channel , rc ) ; error = rc ; } mutex_unlock ( & kcs_bmc_lock ) ; return error ; } 