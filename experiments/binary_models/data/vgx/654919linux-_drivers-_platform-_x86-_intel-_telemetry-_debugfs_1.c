static int __init telemetry_debugfs_init ( void ) { const struct x86_cpu_id * id ; int err ; struct dentry * dir ; id = x86_match_cpu ( telemetry_debugfs_cpu_ids ) ; if ( ! id ) { return - ENODEV ; } debugfs_conf = ( telemetry_debugfs_conf * ) id -> driver_data ; if ( ! telemetry_get_pltdata ( ) ) { pr_info ( "Invalid pltconfig, ensure IPC1 device is enabled in BIOS\n" ) ; return - ENODEV ; } err = telemetry_debugfs_check_evts ( ) ; if ( err < 0 ) { pr_info ( "telemetry_debugfs_check_evts failed\n" ) ; return - EINVAL ; } register_pm_notifier ( & pm_notifier ) ; dir = debugfs_create_dir ( "telemetry" , NULL ) ; debugfs_conf -> telemetry_dbg_dir = dir ; debugfs_create_file ( "pss_info" , S_IFREG | S_IRUGO , dir , NULL , & telem_pss_states_fops ) ; debugfs_create_file ( "ioss_info" , S_IFREG | S_IRUGO , dir , NULL , & telem_ioss_states_fops ) ; debugfs_create_file ( "soc_states" , S_IFREG | S_IRUGO , dir , NULL , & telem_soc_states_fops ) ; debugfs_create_file ( "s0ix_residency_usec" , S_IFREG | S_IRUGO , dir , NULL , & telem_s0ix_fops ) ; debugfs_create_file ( "pss_trace_verbosity" , S_IFREG | S_IRUGO , dir , & telem_pss_trc_verb_ops ) ; debugfs_create_file ( "ioss_trace_verbosity" , S_IFREG | S_IRUGO , dir , NULL , & telem_ioss_trc_verb_ops ) ; return 0 ; } 