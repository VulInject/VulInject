static int qm_init_pfdr ( struct device * dev , u32 pfdr_start , u32 num ) { u8 rslt = MCR_get_rslt ( qm_ccsr_in ( REG_MCR ) ) ; DPAA_ASSERT ( pfdr_start && ! ( pfdr_start & 7 ) && ! ( num & 7 ) && num ) ; if ( ! MCR_rslt_idle ( rslt ) ) { dev_crit ( dev , "QMAN_MCR isn't idle" ) ; WARN_ON ( 1 ) ; } qm_ccsr_out ( REG_MCP ( 0 ) , pfdr_start ) ; qm_ccsr_out ( REG_MCP ( 1 ) , pfdr_start + num - 16 ) ; dma_wmb ( ) ; qm_ccsr_out ( REG_MCR , MCR_INIT_PFDR ) ; { rslt = MCR_get_rslt ( qm_ccsr_in ( REG_MCR ) ) ; } ! MCR_rslt_idle ( rslt ) ; if ( MCR_rslt_ok ( rslt ) ) { return 0 ; } if ( MCR_rslt_inval ( rslt ) ) { return - EINVAL ; } dev_crit ( dev , "Unexpected result from MCR_INIT_PFDR: %02x\n" , rslt ) ; return - ENODEV ; } 