static int _cpuset_create ( stepd_step_rec_t * step ) { int rc ; char * sys_cgpath = NULL ; char * value ; size_t cpus_size ; rc = common_cgroup_get_param ( & int_cg [ CG_CPUS ] [ CG_LEVEL_SLURM ] , "cpuset.cpus" , & value , & cpus_size ) ; if ( ( rc != SLURM_SUCCESS ) || ( cpus_size == 1 ) ) { if ( xcgroup_cpuset_init ( & int_cg [ CG_CPUS ] [ CG_LEVEL_SLURM ] ) != SLURM_SUCCESS ) { xfree ( value ) ; return SLURM_ERROR ; } } common_cgroup_set_param ( & int_cg [ CG_CPUS ] [ CG_LEVEL_SLURM ] , "cgroup.clone_children" , "0" ) ; if ( step == NULL ) { xstrfmtcat ( sys_cgpath , "%s/system" , int_cg [ CG_CPUS ] [ CG_LEVEL_SLURM ] . name ) ; if ( ( rc = common_cgroup_create ( & g_cg_ns [ CG_CPUS ] , & int_cg [ CG_CPUS ] [ CG_LEVEL_SYSTEM ] , sys_cgpath , getuid ( ) , getgid ( ) ) ) != SLURM_SUCCESS ) { end } if ( running_in_slurmd ( ) ) { if ( ( rc = common_cgroup_instantiate ( & int_cg [ CG_CPUS ] [ CG_LEVEL_SYSTEM ] ) ) != SLURM_SUCCESS ) { end } common_cgroup_set_param ( & int_cg [ CG_CPUS ] [ CG_LEVEL_SYSTEM ] , "notify_on_release" , "0" ) ; if ( ( rc = xcgroup_cpuset_init ( & int_cg [ CG_CPUS ] [ CG_LEVEL_SYSTEM ] ) ) != SLURM_SUCCESS ) { end } } log_flag ( CGROUP , "system cgroup: system cpuset cgroup initialized" ) ; } else { rc = xcgroup_create_hierarchy ( __func__ , step , & g_cg_ns [ CG_CPUS ] , int_cg [ CG_CPUS ] , g_job_cgpath [ CG_CPUS ] , g_step_cgpath [ CG_CPUS ] , g_user_cgpath [ CG_CPUS ] ) ; } end xfree ( value ) ; return rc ; } 