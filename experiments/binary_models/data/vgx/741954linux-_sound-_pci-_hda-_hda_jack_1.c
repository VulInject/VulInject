static int add_jack_kctl ( struct hda_codec * codec , hda_nid_t nid , const struct auto_pin_cfg * cfg , const char * base_name ) { unsigned int def_conf , conn ; char name [ SNDRV_CTL_ELEM_ID_NAME_MAXLEN ] ; int err ; bool phantom_jack ; WARN_ON ( codec -> dp_mst ) ; def_conf = snd_hda_codec_get_pincfg ( codec , nid ) ; conn = get_defcfg_connect ( def_conf ) ; if ( conn == AC_JACK_PORT_NONE ) { return 0 ; } phantom_jack = ( conn != AC_JACK_PORT_COMPLEX ) || ! is_jack_detectable ( codec , nid ) ; if ( base_name ) { strscpy ( name , base_name , sizeof ( name ) ) ; } else { snd_hda_get_pin_label ( codec , nid , cfg , name , sizeof ( name ) , NULL ) ; } if ( phantom_jack ) { strncat ( name , " Phantom" , sizeof ( name ) - strlen ( name ) - 1 ) ; } err = snd_hda_jack_add_kctl ( codec , nid , name , phantom_jack , 0 , NULL ) ; if ( err < 0 ) { return err ; } if ( ! phantom_jack ) { return snd_hda_jack_detect_enable ( codec , nid , 0 ) ; } return 0 ; } 