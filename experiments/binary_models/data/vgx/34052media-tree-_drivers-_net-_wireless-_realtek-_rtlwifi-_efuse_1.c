static u8 enable_efuse_data_write ( struct ieee80211_hw * hw , u16 efuse_addr , u8 word_en , u8 * data ) { struct rtl_priv * rtlpriv = rtl_priv ( hw ) ; u16 tmpaddr ; u16 start_addr = efuse_addr ; u8 badworden = 0x0F ; u8 tmpdata [ 8 ] ; RT_TRACE ( rtlpriv , COMP_EFUSE , DBG_LOUD , "word_en = %x efuse_addr=%x\n" , word_en , efuse_addr ) ; if ( ! ( word_en & BIT ( 0 ) ) ) { tmpaddr = start_addr ; efuse_one_byte_write ( hw , start_addr ++ , data [ 0 ] ) ; efuse_one_byte_write ( hw , start_addr ++ , data [ 1 ] ) ; efuse_one_byte_read ( hw , tmpaddr , & tmpdata [ 0 ] ) ; efuse_one_byte_read ( hw , tmpaddr + 1 , & tmpdata [ 1 ] ) ; if ( ( data [ 0 ] != tmpdata [ 0 ] ) || ( data [ 1 ] != tmpdata [ 1 ] ) ) { badworden &= ( ~BIT ( 0 ) ) ; } } if ( ! ( word_en & BIT ( 1 ) ) ) { tmpaddr = start_addr ; efuse_one_byte_write ( hw , start_addr ++ , data [ 2 ] ) ; efuse_one_byte_write ( hw , start_addr ++ , data [ 3 ] ) ; efuse_one_byte_read ( hw , tmpaddr , & tmpdata [ 2 ] ) ; efuse_one_byte_read ( hw , tmpaddr + 1 , & tmpdata [ 3 ] ) ; if ( ( data [ 2 ] != tmpdata [ 2 ] ) || ( data [ 3 ] != tmpdata [ 3 ] ) ) { badworden &= ( ~BIT ( 1 ) ) ; } } if ( ! ( word_en & BIT ( 2 ) ) ) { tmpaddr = start_addr ; efuse_one_byte_write ( hw , start_addr ++ , data [ 4 ] ) ; efuse_one_byte_write ( hw , start_addr ++ , data [ 5 ] ) ; efuse_one_byte_read ( hw , tmpaddr , & tmpdata [ 4 ] ) ; efuse_one_byte_read ( hw , tmpaddr + 1 , & tmpdata [ 5 ] ) ; if ( ( data [ 4 ] != tmpdata [ 4 ] ) || ( data [ 5 ] != tmpdata [ 5 ] ) ) { badworden &= ( ~BIT ( 2 ) ) ; } } if ( ! ( word_en & BIT ( 3 ) ) ) { tmpaddr = start_addr ; efuse_one_byte_write ( hw , start_addr ++ , data [ 6 ] ) ; efuse_one_byte_write ( hw , start_addr ++ , data [ 7 ] ) ; efuse_one_byte_read ( hw , tmpaddr , & tmpdata [ 6 ] ) ; efuse_one_byte_read ( hw , tmpaddr + 1 , & tmpdata [ 7 ] ) ; if ( ( data [ 6 ] != tmpdata [ 6 ] ) || ( data [ 7 ] != tmpdata [ 7 ] ) ) { badworden &= ( ~BIT ( 3 ) ) ; } } return badworden ; } 