static int apci1032_auto_attach ( struct comedi_device * dev , unsigned long context_unused ) { struct pci_dev * pcidev = comedi_to_pci_dev ( dev ) ; struct apci1032_private * devpriv ; struct comedi_subdevice * s ; int ret ; devpriv = comedi_alloc_devpriv ( dev , sizeof ( * devpriv ) ) ; ret = comedi_pci_enable ( dev ) ; if ( ret ) { return ret ; } devpriv -> amcc_iobase = pci_resource_start ( pcidev , 0 ) ; dev -> iobase = pci_resource_start ( pcidev , 1 ) ; apci1032_reset ( dev ) ; if ( pcidev -> irq > 0 ) { ret = request_irq ( pcidev -> irq , apci1032_interrupt , IRQF_SHARED , dev -> board_name , dev ) ; if ( ret == 0 ) { dev -> irq = pcidev -> irq ; } } ret = comedi_alloc_subdevices ( dev , 2 ) ; if ( ret ) { return ret ; } s = & dev -> subdevices [ 0 ] ; s -> type = COMEDI_SUBD_DI ; s -> subdev_flags = SDF_READABLE ; s -> n_chan = 32 ; s -> maxdata = 1 ; s -> range_table = & range_digital ; s -> insn_bits = apci1032_di_insn_bits ; s = & dev -> subdevices [ 1 ] ; if ( dev -> irq ) { dev -> read_subdev = s ; s -> type = COMEDI_SUBD_DI ; s -> subdev_flags = SDF_READABLE | SDF_CMD_READ ; s -> n_chan = 1 ; s -> maxdata = 1 ; s -> range_table = & range_digital ; s -> insn_config = apci1032_cos_insn_config ; s -> insn_bits = apci1032_cos_insn_bits ; s -> len_chanlist = 1 ; s -> do_cmdtest = apci1032_cos_cmdtest ; s -> do_cmd = apci1032_cos_cmd ; s -> cancel = apci1032_cos_cancel ; } else { s -> type = COMEDI_SUBD_UNUSED ; } return 0 ; } 