static int fill_read_buffer ( struct dentry * dentry , struct configfs_buffer * buffer ) { struct configfs_attribute * attr = to_attr ( dentry ) ; struct config_item * item = to_item ( dentry -> d_parent ) ; int ret = 0 ; ssize_t count ; if ( ! buffer -> page ) { buffer -> page = ( char * ) get_zeroed_page ( GFP_KERNEL ) ; } if ( ! buffer -> page ) { return - ENOMEM ; } count = attr -> show ( item , buffer -> page ) ; BUG_ON ( count > ( ssize_t ) SIMPLE_ATTR_SIZE ) ; if ( count >= 0 ) { buffer -> count = count ; } else { ret = count ; } return ret ; } 