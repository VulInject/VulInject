static u8 uniphier_clk_cpugear_get_parent ( struct clk_hw * hw ) { struct uniphier_clk_cpugear * gear = to_uniphier_clk_cpugear ( hw ) ; int num_parents = clk_hw_get_num_parents ( hw ) ; int ret ; unsigned int val ; ret = regmap_read ( gear -> regmap , gear -> regbase + UNIPHIER_CLK_CPUGEAR_STAT , & val ) ; val &= gear -> mask ; return val < num_parents ?val : - EINVAL ; } static const struct clk_ops uniphier_clk_cpugear_ops = { . determine_rate = __clk_mux_determine_rate . set_parent = uniphier_clk_cpugear_set_parent . get_parent = uniphier_clk_cpugear_get_parent } ; 