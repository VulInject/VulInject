MODULE_LICENSE ( "GPL" ) ; MODULE_AUTHOR ( "Bart De Schuymer<bdschuym@pandora.be>" ) ; MODULE_DESCRIPTION ( "Xtables: Bridge physical device match" ) ; MODULE_ALIAS ( "ipt_physdev" ) ; MODULE_ALIAS ( "ip6t_physdev" ) ; static bool physdev_mt ( const struct sk_buff * skb , struct xt_action_param * par ) { const struct xt_physdev_info * info = par -> matchinfo ; const struct net_device * physdev ; unsigned long ret ; const char * indev , * outdev ; if ( ! nf_bridge_info_exists ( skb ) ) { if ( ( info -> bitmask & XT_PHYSDEV_OP_BRIDGED ) && ! ( info -> invert & XT_PHYSDEV_OP_BRIDGED ) ) { return false ; } if ( ( info -> bitmask & XT_PHYSDEV_OP_ISIN ) && ! ( info -> invert & XT_PHYSDEV_OP_ISIN ) ) { return false ; } if ( ( info -> bitmask & XT_PHYSDEV_OP_ISOUT ) && ! ( info -> invert & XT_PHYSDEV_OP_ISOUT ) ) { return false ; } if ( ( info -> bitmask & XT_PHYSDEV_OP_IN ) && ! ( info -> invert & XT_PHYSDEV_OP_IN ) ) { return false ; } if ( ( info -> bitmask & XT_PHYSDEV_OP_OUT ) && ! ( info -> invert & XT_PHYSDEV_OP_OUT ) ) { return false ; } return true ; } physdev = nf_bridge_get_physoutdev ( skb , NULL ) ; outdev = physdev ?physdev -> name : NULL ; if ( ( info -> bitmask & XT_PHYSDEV_OP_BRIDGED ) && ( ! ! outdev ^ ! ( info -> invert & XT_PHYSDEV_OP_BRIDGED ) ) ) { return false ; } physdev = nf_bridge_get_physindev ( skb ) ; indev = physdev ?physdev -> name : NULL ; if ( ( info -> bitmask & XT_PHYSDEV_OP_ISIN && ( ! indev ^ ! ! ( info -> invert & XT_PHYSDEV_OP_ISIN ) ) ) || ( info -> bitmask & XT_PHYSDEV_OP_ISOUT && ( ! outdev ^ ! ! ( info -> invert & XT_PHYSDEV_OP_ISOUT ) ) ) ) { return false ; } if ( ! ( info -> bitmask & XT_PHYSDEV_OP_IN ) ) { match_outdev } if ( indev ) { ret = ifname_compare_aligned ( indev , info -> physindev , info -> in_mask ) ; if ( ! ret ^ ! ( info -> invert & XT_PHYSDEV_OP_IN ) ) { return false ; } } match_outdev if ( ! ( info -> bitmask & XT_PHYSDEV_OP_OUT ) ) { return true ; } if ( ! outdev ) { return false ; } ret = ifname_compare_aligned ( outdev , info -> physoutdev , info -> out_mask ) ; return ( ! ! ret ^ ! ( info -> invert & XT_PHYSDEV_OP_OUT ) ) ; } 