int pflog_clone_create ( struct if_clone * ifc , int unit ) { struct ifnet * ifp ; struct pflog_softc * pflogif ; pflogif = malloc ( sizeof ( * pflogif ) , M_DEVBUF , M_WAITOK | M_ZERO ) ; pflogif -> sc_unit = unit ; ifp = & pflogif -> sc_if ; snprintf ( ifp -> if_xname , sizeof ifp -> if_xname , "pflog%d" , unit ) ; ifp -> if_softc = pflogif ; ifp -> if_mtu = PFLOGMTU ; ifp -> if_ioctl = pflogioctl ; ifp -> if_output = pflogoutput ; ifp -> if_xflags = IFXF_CLONED ; ifp -> if_type = IFT_PFLOG ; ifp -> if_hdrlen = PFLOG_HDRLEN ; if_attach ( ifp ) ; if_alloc_sadl ( ifp , NULL ) ; bpfattach ( & pflogif -> sc_if . if_bpf , ifp , DLT_PFLOG , PFLOG_HDRLEN ) ; NET_LOCK ( ) ; LIST_INSERT_HEAD ( & pflog_ifs , pflogif , sc_entry ) ; NET_UNLOCK ( ) ; return ( 0 ) ; } 