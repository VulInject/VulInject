static int request_data ( struct regmap * regmap , int chan , u32 * data ) { unsigned int val ; int ret ; ret = regmap_write ( regmap , LOCHNAGAR2_IMON_CTRL4 , LOCHNAGAR2_IMON_DATA_REQ_MASK | chan << LOCHNAGAR2_IMON_CH_SEL_SHIFT ) ; ret = regmap_read_poll_timeout ( regmap , LOCHNAGAR2_IMON_CTRL4 , val , val & LOCHNAGAR2_IMON_DATA_RDY_MASK , 1000 , 10000 ) ; if ( ret < 0 ) { return ret ; } ret = regmap_read ( regmap , LOCHNAGAR2_IMON_DATA1 , & val ) ; if ( ret < 0 ) { return ret ; } * data = val << 16 ; ret = regmap_read ( regmap , LOCHNAGAR2_IMON_DATA2 , & val ) ; if ( ret < 0 ) { return ret ; } * data |= val ; return regmap_write ( regmap , LOCHNAGAR2_IMON_CTRL4 , 0 ) ; } 