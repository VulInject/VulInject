static int smtpclient_sendenv ( smtpclient_t * sm , smtp_envelope_t * env ) { int r = 0 ; if ( sm -> msgsize ) { cfs_time_t maxsize = smtpclient_get_maxsize ( sm ) ; if ( maxsize && maxsize < sm -> msgsize ) { r = IMAP_MESSAGE_TOO_LARGE ; done } } r = validate_envelope ( env ) ; if ( r ) { done } r = smtpclient_from ( sm , & env -> from ) ; if ( r ) { done } r = smtpclient_rcpt_to ( sm , & env -> rcpts ) ; if ( r ) { done } done return r ; } 