static void devmap_softlock_exit ( struct devmap_softlock * slock , size_t npages , enum fault_type type ) { mutex_enter ( & ( slock -> lock ) ) ; switch ( type ) { case F_SOFTLOCK : ASSERT ( - slock -> softlocked >= npages ) ; slock -> softlocked += npages ; if ( slock -> softlocked == 0 ) { cv_signal ( & slock -> cv ) ; } break ; case F_INVAL : case F_PROT : ASSERT ( slock -> softlocked >= npages ) ; slock -> softlocked -= npages ; if ( slock -> softlocked == 0 ) { cv_signal ( & slock -> cv ) ; } break ; default : ASSERT ( 0 ) ; } mutex_exit ( & ( slock -> lock ) ) ; } 