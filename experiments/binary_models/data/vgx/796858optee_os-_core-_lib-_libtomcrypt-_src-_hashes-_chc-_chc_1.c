static int s_chc_compress ( hash_state * md , const unsigned char * buf ) { unsigned char T [ 2 ] [ MAXBLOCKSIZE ] ; symmetric_key * key ; int err , x ; if ( ( key = XMALLOC ( sizeof ( * key ) ) ) == NULL ) { return CRYPT_MEM ; } if ( ( err = cipher_descriptor [ cipher_idx ] -> setup ( md -> chc . state , cipher_blocksize , 0 , key ) ) != CRYPT_OK ) { XFREE ( key , NULL ) ; return err ; } XMEMCPY ( T [ 1 ] , buf , cipher_blocksize ) ; cipher_descriptor [ cipher_idx ] -> ecb_encrypt ( buf , T [ 0 ] , key ) ; for ( x = 0 ; x < cipher_blocksize ; x ++ ) { md -> chc . state [ x ] ^= T [ 0 ] [ x ] ^ T [ 1 ] [ x ] ; } zeromem ( T , sizeof ( T ) ) ; zeromem ( key , sizeof ( * key ) ) ; XFREE ( key ) ; return CRYPT_OK ; } 