static krb5_error_code hdb_test_create ( krb5_context context , struct HDB * * db , const char * arg ) { TEST_HDB * tdb ; if ( ( tdb = calloc ( 1 , sizeof ( tdb [ 0 ] ) ) ) == NULL || ( tdb -> hdb . hdb_name = strdup ( arg ) ) == NULL || ( tdb -> dict = heim_dict_create ( 10 ) ) == NULL ) { if ( tdb ) { free ( tdb -> hdb . hdb_name ) ; } free ( tdb ) ; return krb5_enomem ( context ) ; } tdb -> hdb . hdb_master_key_set = 0 ; tdb -> hdb . hdb_openp = 0 ; tdb -> hdb . hdb_capability_flags = HDB_CAP_F_HANDLE_ENTERPRISE_PRINCIPAL ; tdb -> hdb . hdb_open = TDB_open ; tdb -> hdb . hdb_close = TDB_close ; tdb -> hdb . hdb_fetch_kvno = _hdb_fetch_kvno ; tdb -> hdb . hdb_store = _hdb_store ; tdb -> hdb . hdb_remove = _hdb_remove ; tdb -> hdb . hdb_firstkey = TDB_firstkey ; tdb -> hdb . hdb_nextkey = TDB_nextkey ; tdb -> hdb . hdb_lock = TDB_lock ; tdb -> hdb . hdb_unlock = TDB_unlock ; tdb -> hdb . hdb_rename = TDB_rename ; tdb -> hdb . hdb__get = TDB__get ; tdb -> hdb . hdb__put = TDB__put ; tdb -> hdb . hdb__del = TDB__del ; tdb -> hdb . hdb_destroy = TDB_destroy ; tdb -> hdb . hdb_set_sync = TDB_set_sync ; * db = & tdb -> hdb ; return 0 ; } 