void utf8_test ( void ) { char buf [ 1024 ] ; char * res ; int cnt = 0 ; char * heapbuf ; char * workbuf = safe_alloc ( 500 ) ; size_t workbuflen = 500 ; while ( ( fgets ( buf , sizeof ( buf ) , stdin ) ) ) { stripcrlf ( buf ) ; heapbuf = strdup ( buf ) ; res = unrl_utf8_make_valid ( heapbuf , workbuf , workbuflen , 1 ) ; if ( heapbuf == res ) { printf ( "    %s\n" , res ) ; } else { printf ( "[!] %s\n" , res ) ; } } safe_free ( workbuf ) ; } 