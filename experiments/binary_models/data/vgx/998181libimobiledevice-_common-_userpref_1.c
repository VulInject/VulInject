userpref_error_t pair_record_get_item_as_key_data ( plist_t pair_record , const char * name , key_data_t * value ) { if ( ! pair_record || ! value ) { return USERPREF_E_INVALID_ARG ; } userpref_error_t ret = USERPREF_E_SUCCESS ; char * buffer = NULL ; uint64_t length = 0 ; plist_t node = plist_dict_get_item ( pair_record , name ) ; if ( node && plist_get_node_type ( node ) == PLIST_DATA ) { plist_get_data_val ( node , & buffer , & length ) ; value -> data = ( unsigned char * ) malloc ( length + 1 ) ; memcpy ( value -> data , buffer , length ) ; value -> data [ length ] = '\0' ; value -> size = length + 1 ; buffer = NULL ; } else { ret = USERPREF_E_INVALID_CONF ; } if ( buffer ) { free ( buffer ) ; } return ret ; } 