static void ares_address_cb ( void * arg , int status , int timeouts , struct hostent * he ) { struct resolver_query * query = ( resolver_query * ) arg ; union sockunion addr [ 16 ] ; void * callback ( struct resolver_query * , const char * , int , union sockunion * ) size_t i ; callback = query -> callback ; query -> callback = NULL ; if ( status != ARES_SUCCESS ) { if ( resolver_debug ) { zlog_debug ( "[%p] Resolving failed (%s)" , query , ares_strerror ( status ) ) ; } callback ( query , ares_strerror ( status ) , - 1 , NULL ) ; return ; } for ( i = 0 ; i < array_size ( addr ) && he -> h_addr_list [ i ] != NULL ; i ++ ) { addr [ i ] . sa . sa_family = he -> h_addrtype ; switch ( he -> h_addrtype ) { case AF_INET : memcpy ( & addr [ i ] . sin . sin_addr , ( uint8_t * ) he -> h_addr_list [ i ] , he -> h_length ) ; break ; case AF_INET6 : memcpy ( & addr [ i ] . sin6 . sin6_addr , ( uint8_t * ) he -> h_addr_list [ i ] , he -> h_length ) ; break ; } } if ( resolver_debug ) { zlog_debug ( "[%p] Resolved with %d results" , query , ( int ) i ) ; } callback ( query , NULL , i , & addr [ 0 ] ) ; } 