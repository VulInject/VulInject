static void write_mod_c_file ( struct module * mod ) { struct buffer buf = { } ; char fname [ PATH_MAX ] ; int ret ; check_modname_len ( mod ) ; check_exports ( mod ) ; add_header ( & buf , mod ) ; add_exported_symbols ( & buf , mod ) ; add_versions ( & buf , mod ) ; add_depends ( & buf , mod ) ; add_moddevtable ( & buf , mod ) ; add_srcversion ( & buf , mod ) ; ret = snprintf ( fname , sizeof ( fname ) , "%s.mod.c" , mod -> name ) ; if ( ret >= sizeof ( fname ) ) { error ( "%s: too long path was truncated\n" , fname ) ; free } write_if_changed ( & buf , fname ) ; free } 