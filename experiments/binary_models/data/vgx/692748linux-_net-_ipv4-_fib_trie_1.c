int fib_table_dump ( struct fib_table * tb , struct sk_buff * skb , struct netlink_callback * cb , struct fib_dump_filter * filter ) { struct trie * t = ( trie * ) tb -> tb_data ; struct key_vector * l , * tp = t -> kv ; int count = cb -> args [ 2 ] ; t_key key = cb -> args [ 3 ] ; if ( count && ! key ) { return skb -> len ; } while ( ( l = leaf_walk_rcu ( & tp , key ) ) != NULL ) { int err ; err = fn_trie_dump_leaf ( l , tb , skb , cb , filter ) ; if ( err < 0 ) { cb -> args [ 3 ] = key ; cb -> args [ 2 ] = count ; return err ; } ++ count ; key = l -> key + 1 ; if ( key < l -> key ) { break ; } } cb -> args [ 3 ] = key ; cb -> args [ 2 ] = count ; return skb -> len ; } 