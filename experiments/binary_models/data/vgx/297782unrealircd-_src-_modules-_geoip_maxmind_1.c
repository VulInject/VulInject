GeoIPResult * geoip_lookup_maxmind ( char * ip ) int geoip_maxmind_configtest ( ConfigFile * cf , ConfigEntry * ce , int type , int * errs ) { ConfigEntry * cep ; int errors = 0 ; int i ; if ( type != CONFIG_SET ) { return 0 ; } if ( strcmp ( ce -> name , "geoip-maxmind" ) ) { return 0 ; } geoip_maxmind_config . have_config = 1 ; for ( cep = ce -> items ; cep ; cep = cep -> next ) { if ( ! strcmp ( cep -> name , "database" ) ) { if ( geoip_maxmind_config . have_database ) { config_error ( "%s:%i: duplicate item set::geoip-maxmind::%s" , cep -> file -> filename , cep -> line_number , cep -> name ) ; continue ; } if ( ! is_file_readable ( cep -> value , PERMDATADIR ) ) { config_error ( "%s:%i: set::geoip-maxmind::%s: cannot open file \"%s/%s\" for reading (%s)" , cep -> file -> filename , cep -> line_number , cep -> name , PERMDATADIR , cep -> value , strerror ( errno ) ) ; errors ++ ; continue ; } geoip_maxmind_config . have_database = 1 ; continue ; } config_warn ( "%s:%i: unknown item set::geoip-maxmind::%s" , cep -> file -> filename , cep -> line_number , cep -> name ) ; } * errs = errors ; return errors ?- 1 : 1 ; } 