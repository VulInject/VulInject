int scifioctl ( dev_t dev , u_long cmd , caddr_t data , int flag , struct proc * p ) { struct scif_softc * sc = scif_cd . cd_devs [ SCIFUNIT ( dev ) ] ; struct tty * tp = sc -> sc_tty ; int error ; int s ; error = ( * linesw [ tp -> t_line ] . l_ioctl ) ( tp , cmd , data , flag , p ) ; error = ttioctl ( tp , cmd , data , flag , p ) ; if ( error != - 1 ) { return ( error ) ; } error = 0 ; s = spltty ( ) ; switch ( cmd ) { case TIOCSBRK : scif_break ( sc , 1 ) ; break ; case TIOCCBRK : scif_break ( sc , 0 ) ; break ; case TIOCGFLAGS : * ( int * ) data = sc -> sc_swflags ; break ; case TIOCSFLAGS : error = suser ( p ) ; if ( error ) { break ; } sc -> sc_swflags = * ( int * ) data ; break ; default : error = - 1 ; break ; } splx ( s ) ; return ( error ) ; } 