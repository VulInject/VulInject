static void __tape_34xx_medium_sense ( struct tape_request * request ) { struct tape_device * device = request -> device ; unsigned char * sense ; if ( request -> rc == 0 ) { sense = request -> cpdata ; if ( sense [ 0 ] & SENSE_INTERVENTION_REQUIRED ) { tape_med_state_set ( device , MS_UNLOADED ) ; } else { tape_med_state_set ( device , MS_LOADED ) ; } if ( sense [ 1 ] & SENSE_WRITE_PROTECT ) { device -> tape_generic_status |= GMT_WR_PROT ( ~ 0 ) ; } else { device -> tape_generic_status &= ~ GMT_WR_PROT ( ~ 0 ) ; } } else { DBF_EVENT ( 4 , "tape_34xx: medium sense failed with rc=%d\n" , request -> rc ) ; } } 