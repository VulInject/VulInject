static int acp_dma_close ( struct snd_pcm_substream * substream ) { u16 bank ; struct snd_pcm_runtime * runtime = substream -> runtime ; struct audio_substream_data * rtd = runtime -> private_data ; struct snd_soc_pcm_runtime * prtd = substream -> private_data ; struct audio_drv_data * adata = dev_get_drvdata ( prtd -> platform -> dev ) ; if ( substream -> stream == SNDRV_PCM_STREAM_PLAYBACK ) { adata -> play_stream = NULL ; for ( bank = 1 ; bank <= 4 ; bank ++ ) { acp_set_sram_bank_state ( adata -> acp_mmio , bank , false ) ; } } else { adata -> capture_stream = NULL ; for ( bank = 5 ; bank <= 8 ; bank ++ ) { acp_set_sram_bank_state ( adata -> acp_mmio , bank , false ) ; } } if ( ! adata -> play_stream && ! adata -> capture_stream ) { acp_reg_write ( 0 , adata -> acp_mmio , mmACP_EXTERNAL_INTR_ENB ) ; } return 0 ; } 