static int get_cert_version ( str * res , int local , sip_msg_t * msg ) { static char buf [ INT2STR_MAX_LEN ] ; X509 * cert ; struct tcp_connection * c ; char * version ; if ( get_cert ( & cert , & c , msg , local ) < 0 ) { return - 1 ; } version = int2str ( X509_get_version ( cert ) , & res -> len ) ; memcpy ( buf , version , res -> len ) ; res -> s = buf ; if ( ! local ) { X509_free ( cert ) ; } tcpconn_put ( c , NULL ) ; return 0 ; } 