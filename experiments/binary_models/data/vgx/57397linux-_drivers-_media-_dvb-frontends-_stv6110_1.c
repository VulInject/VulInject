struct dvb_frontend * stv6110_attach ( struct dvb_frontend * fe , const struct stv6110_config * config , struct i2c_adapter * i2c ) { struct stv6110_priv * priv = NULL ; u8 reg0 [ ] { 0x00 0x07 0x11 0xdc 0x85 0x17 0x01 0xe6 0x1e } ; ; struct i2c_msg msg [ ] { { . addr = config -> i2c_address . flags = 0 . buf = reg0 . len = 9 } } ; ; int ret ; reg0 [ 2 ] &= ~ 0xc0 ; reg0 [ 2 ] |= ( config -> clk_div << 6 ) ; if ( fe -> ops . i2c_gate_ctrl ) { fe -> ops . i2c_gate_ctrl ( fe , 1 ) ; } ret = i2c_transfer ( i2c , msg , 1 ) ; if ( fe -> ops . i2c_gate_ctrl ) { fe -> ops . i2c_gate_ctrl ( fe , 0 ) ; } if ( ret != 1 ) { return in ; } priv = kzalloc ( sizeof ( stv6110_priv ) , GFP_KERNEL ) ; if ( priv == NULL ) { return NULL ; } priv -> i2c_address = config -> i2c_address ; priv -> i2c = i2c ; priv -> mclk = config -> mclk ; priv -> clk_div = config -> clk_div ; priv -> gain = config -> gain ; memcpy ( & priv -> regs , & reg0 [ 1 ] , 8 ) ; memcpy ( & fe -> ops . tuner_ops , & stv6110_tuner_ops , sizeof ( dvb_tuner_ops ) ) ; fe -> tuner_priv = priv ; printk ( KERN_INFO "STV6110 attached on addr=%x!\n" , priv -> i2c_address ) ; return fe ; } 