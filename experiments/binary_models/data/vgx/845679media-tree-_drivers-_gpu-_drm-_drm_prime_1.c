void drm_prime_remove_buf_handle_locked ( struct drm_prime_file_private * prime_fpriv , struct dma_buf * dma_buf ) { struct rb_node * rb ; rb = prime_fpriv -> dmabufs . rb_node ; while ( rb ) { struct drm_prime_member * member ; member = rb_entry ( rb , drm_prime_member , dmabuf_rb ) ; if ( member -> dma_buf == dma_buf ) { rb_erase ( & member -> handle_rb , & prime_fpriv -> handles ) ; rb_erase ( & member -> dmabuf_rb , & prime_fpriv -> dmabufs ) ; dma_buf_put ( dma_buf ) ; return ; } if ( member -> dma_buf < dma_buf ) { rb = rb -> rb_right ; } else { rb = rb -> rb_left ; } } } 