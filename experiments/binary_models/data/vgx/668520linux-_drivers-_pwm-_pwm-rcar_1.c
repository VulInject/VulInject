static int rcar_pwm_set_counter ( struct rcar_pwm_chip * rp , int div , int duty_ns , int period_ns ) { unsigned long long one_cycle , tmp ; unsigned long clk_rate = clk_get_rate ( rp -> clk ) ; u32 cyc , ph ; one_cycle = NSEC_PER_SEC * 100ULL << div ; do_div ( one_cycle , clk_rate ) ; tmp = period_ns * 100ULL ; do_div ( tmp , one_cycle ) ; cyc = ( tmp << RCAR_PWMCNT_CYC0_SHIFT ) & RCAR_PWMCNT_CYC0_MASK ; tmp = duty_ns * 100ULL ; do_div ( tmp , one_cycle ) ; ph = tmp & RCAR_PWMCNT_PH0_MASK ; rcar_pwm_write ( rp , cyc | ph , RCAR_PWMCNT ) ; return 0 ; } 