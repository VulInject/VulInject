static inline size_t print_line ( struct verifier_stream * stream , int eof ) { char * eol = NULL ; size_t len ; const char * fmt ; assert ( stream -> off <= stream -> cnt ) ; if ( stream -> off == stream -> cnt ) { return 0 ; } assert ( stream -> buf [ stream -> cnt ] == '\0' ) ; if ( ( eol = strchr ( stream -> buf + stream -> off , '\n' ) ) ) { len = eol - ( stream -> buf + stream -> off ) ; } else { len = stream -> cnt - stream -> off ; } assert ( len <= ( stream -> cnt - stream -> off ) ) ; if ( len < LOGLINELEN && ! eol && ! eof ) { return 0 ; } if ( len > LOGLINELEN ) { fmt = stream -> cut ?".. %.*s .." : "%.*s .." ; len = LOGLINELEN ; stream -> cut = 1 ; } else { fmt = stream -> cut ?".. %.*s" : "%.*s" ; stream -> cut = 0 ; } log_msg ( stream -> priority , fmt , len , stream -> buf + stream -> off ) ; stream -> off += len + ( eol != NULL ) ; assert ( stream -> off <= stream -> cnt ) ; return len ; } 