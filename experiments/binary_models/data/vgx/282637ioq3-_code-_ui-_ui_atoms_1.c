void UI_LoadBestScores ( const char * map , int game ) { char fileName [ MAX_QPATH ] ; fileHandle_t f ; postGameInfo_t newInfo ; int protocol , protocolLegacy ; Com_sprintf ( fileName , MAX_QPATH , "games/%s_%i.game" , map , game ) ; if ( trap_FS_FOpenFile ( fileName , & f , FS_READ ) >= 0 ) { int size = 0 ; trap_FS_Read ( & size , sizeof ( int ) , f ) ; if ( size == sizeof ( postGameInfo_t ) ) { trap_FS_Read ( & newInfo , sizeof ( postGameInfo_t ) , f ) ; } trap_FS_FCloseFile ( f ) ; } UI_SetBestScores ( & newInfo , qfalse ) ; uiInfo . demoAvailable = qfalse ; protocolLegacy = trap_Cvar_VariableValue ( "com_legacyprotocol" ) ; protocol = trap_Cvar_VariableValue ( "com_protocol" ) ; if ( ! protocol ) { protocol = trap_Cvar_VariableValue ( "protocol" ) ; } if ( protocolLegacy == protocol ) { protocolLegacy = 0 ; } Com_sprintf ( fileName , MAX_QPATH , "demos/%s_%d.%s%d" , map , game , DEMOEXT , protocol ) ; if ( trap_FS_FOpenFile ( fileName , & f , FS_READ ) >= 0 ) { uiInfo . demoAvailable = qtrue ; trap_FS_FCloseFile ( f ) ; } if ( protocolLegacy > 0 ) { Com_sprintf ( fileName , MAX_QPATH , "demos/%s_%d.%s%d" , map , game , DEMOEXT , protocolLegacy ) ; if ( trap_FS_FOpenFile ( fileName , & f , FS_READ ) >= 0 ) { uiInfo . demoAvailable = qtrue ; trap_FS_FCloseFile ( f ) ; } } } 