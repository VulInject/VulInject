static vdev_t * mmp_random_leaf ( vdev_t * vd ) { int child_idx ; if ( ! vdev_writeable ( vd ) ) { return ( NULL ) ; } child_idx = spa_get_random ( vd -> vdev_children ) ; for ( int offset = vd -> vdev_children ; offset > 0 ; offset -- ) { vdev_t * leaf ; vdev_t * child = vd -> vdev_child [ ( child_idx + offset ) % vd -> vdev_children ] ; leaf = mmp_random_leaf ( child ) ; if ( leaf ) { return ( leaf ) ; } } return ( NULL ) ; } 