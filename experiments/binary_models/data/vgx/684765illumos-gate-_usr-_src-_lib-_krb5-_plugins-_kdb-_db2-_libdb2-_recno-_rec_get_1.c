int __rec_fmap ( t , top ) BTREE * t ; recno_t top ; { DBT data ; recno_t nrec ; u_char * sp , * ep , * p ; size_t len ; if ( t -> bt_rdata . size < t -> bt_reclen ) { t -> bt_rdata . data = t -> bt_rdata . data == NULL ?malloc ( t -> bt_reclen ) : realloc ( t -> bt_rdata . data , t -> bt_reclen ) ; t -> bt_rdata . size = t -> bt_reclen ; } data . data = t -> bt_rdata . data ; data . size = t -> bt_reclen ; sp = ( u_char * ) t -> bt_cmap ; ep = ( u_char * ) t -> bt_emap ; for ( nrec = t -> bt_nrecs ; nrec < top ; ++ nrec ) { if ( sp >= ep ) { F_SET ( t , R_EOF ) ; return ( RET_SPECIAL ) ; } len = t -> bt_reclen ; for ( p = t -> bt_rdata . data ; sp ( ep && len ) 0 ; * p ++ = * sp ++ , -- len ) { } if ( len != 0 ) { memset ( p , t -> bt_bval , len ) ; } if ( __rec_iput ( t , nrec , & data , 0 ) != RET_SUCCESS ) { return ( RET_ERROR ) ; } } t -> bt_cmap = ( caddr_t ) sp ; return ( RET_SUCCESS ) ; } 