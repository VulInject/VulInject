unsigned long __get_wchan ( struct task_struct * task ) { unsigned long pc , fp , bias = 0 ; unsigned long task_base = ( unsigned long ) task ; cfs_time_t ret = 0 ; struct reg_window32 * rw ; int count = 0 ; fp = task_thread_info ( task ) -> ksp + bias ; { if ( fp < ( task_base + sizeof ( thread_info ) ) || fp >= ( task_base + ( 2 * PAGE_SIZE ) ) ) { break ; } rw = ( reg_window32 * ) fp ; pc = rw -> ins [ 7 ] ; if ( ! in_sched_functions ( pc ) ) { ret = pc ; out } fp = rw -> ins [ 6 ] + bias ; } ++ count < 16 ; out return ret ; } 