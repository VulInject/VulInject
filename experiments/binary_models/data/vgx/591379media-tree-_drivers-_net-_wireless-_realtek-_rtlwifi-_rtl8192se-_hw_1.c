void rtl92se_card_disable ( struct ieee80211_hw * hw ) { struct rtl_priv * rtlpriv = rtl_priv ( hw ) ; struct rtl_mac * mac = rtl_mac ( rtl_priv ( hw ) ) ; struct rtl_pci * rtlpci = rtl_pcidev ( rtl_pcipriv ( hw ) ) ; struct rtl_ps_ctl * ppsc = rtl_psc ( rtl_priv ( hw ) ) ; enum nl80211_iftype opmode ; u8 wait = 30 ; rtlpriv -> intf_ops -> enable_aspm ( hw ) ; if ( rtlpci -> driver_is_goingto_unload || ppsc -> rfoff_reason > RF_CHANGE_BY_PS ) { rtlpriv -> cfg -> ops -> led_control ( hw , LED_CTL_POWER_OFF ) ; } rtl8192se_gpiobit3_cfg_inputmode ( hw , NULL ) ; while ( wait -- >= 10 && rtlpriv -> psc . pwrdomain_protect ) { if ( rtlpriv -> psc . pwrdomain_protect ) { mdelay ( 20 ) ; } else { break ; } } mac -> link_state = MAC80211_NOLINK ; opmode = NL80211_IFTYPE_UNSPECIFIED ; _rtl92se_set_media_status ( hw , opmode ) ; _rtl92s_phy_set_rfhalt ( hw ) ; udelay ( 100 ) ; } 