save_dialog ( , , ) { GtkWidget * dialog ; GtkListStore * store ; GtkWidget * compression_scale ; GtkWidget * orig_profile_check ; GtkWidget * profile_label ; GimpColorProfile * cmyk_profile = NULL ; gboolean run ; dialog = gimp_save_procedure_dialog_new ( GIMP_SAVE_PROCEDURE ( procedure ) , GIMP_PROCEDURE_CONFIG ( config ) , image ) ; gimp_procedure_dialog_get_widget ( GIMP_PROCEDURE_DIALOG ( dialog ) , "lossless" , GTK_TYPE_CHECK_BUTTON ) ; compression_scale = gimp_procedure_dialog_get_widget ( GIMP_PROCEDURE_DIALOG ( dialog ) , "compression" , GIMP_TYPE_SCALE_ENTRY ) ; g_object_bind_property ( config , "lossless" , compression_scale , "sensitive" , G_BINDING_SYNC_CREATE | G_BINDING_INVERT_BOOLEAN ) ; store = gimp_int_store_new ( _ ( "lightning (fastest)" ) , 1 , _ ( "thunder" ) , 2 , _ ( "falcon (faster)" ) , 3 , _ ( "cheetah" ) , 4 , _ ( "hare" ) , 5 , _ ( "wombat" ) , 6 , _ ( "squirrel" ) , 7 , _ ( "kitten" ) , 8 , _ ( "tortoise (slower)" ) , 9 , NULL ) ; gimp_procedure_dialog_get_int_combo ( GIMP_PROCEDURE_DIALOG ( dialog ) , "speed" , GIMP_INT_STORE ( store ) ) ; store = gimp_int_store_new ( _ ( "8 bit/channel" ) , 8 , _ ( "16 bit/channel" ) , 16 , NULL ) ; gimp_procedure_dialog_get_int_combo ( GIMP_PROCEDURE_DIALOG ( dialog ) , "save-bit-depth" , GIMP_INT_STORE ( store ) ) ; profile_label = gimp_procedure_dialog_get_label ( GIMP_PROCEDURE_DIALOG ( dialog ) , "profile-label" , _ ( "CMYK profile required for export" ) ) ; gtk_label_set_xalign ( GTK_LABEL ( profile_label ) , 0.0 ) ; gtk_label_set_ellipsize ( GTK_LABEL ( profile_label ) , PANGO_ELLIPSIZE_END ) ; gimp_label_set_attributes ( GTK_LABEL ( profile_label ) , PANGO_ATTR_STYLE , PANGO_STYLE_ITALIC , - 1 ) ; gimp_help_set_help_data ( profile_label , _ ( "Name of the color profile used for CMYK export." ) , NULL ) ; gimp_procedure_dialog_fill_frame ( GIMP_PROCEDURE_DIALOG ( dialog ) , "cmyk-frame" , "cmyk" , FALSE , "profile-label" ) ; cmyk_profile = gimp_image_get_simulation_profile ( image ) ; if ( ! cmyk_profile ) { g_object_set ( config , "cmyk" , FALSE , NULL ) ; } if ( cmyk_profile ) { if ( gimp_color_profile_is_cmyk ( cmyk_profile ) ) { gchar * label_text ; label_text = g_strdup_printf ( _ ( "Profile: %s" ) , gimp_color_profile_get_label ( cmyk_profile ) ) ; gtk_label_set_text ( GTK_LABEL ( profile_label ) , label_text ) ; gimp_label_set_attributes ( GTK_LABEL ( profile_label ) , PANGO_ATTR_STYLE , PANGO_STYLE_NORMAL , - 1 ) ; } g_object_unref ( cmyk_profile ) ; } gimp_procedure_dialog_set_sensitive ( GIMP_PROCEDURE_DIALOG ( dialog ) , "cmyk" , cmyk_profile != NULL , NULL , NULL , FALSE ) ; orig_profile_check = gimp_procedure_dialog_get_widget ( GIMP_PROCEDURE_DIALOG ( dialog ) , "uses-original-profile" , GTK_TYPE_CHECK_BUTTON ) ; g_object_bind_property ( config , "lossless" , orig_profile_check , "sensitive" , G_BINDING_SYNC_CREATE | G_BINDING_INVERT_BOOLEAN ) ; gimp_procedure_dialog_fill ( GIMP_PROCEDURE_DIALOG ( dialog ) , "lossless" , "compression" , "speed" , "save-bit-depth" , "cmyk-frame" , "uses-original-profile" , "save-exif" , "save-xmp" , NULL ) ; run = gimp_procedure_dialog_run ( GIMP_PROCEDURE_DIALOG ( dialog ) ) ; gtk_widget_destroy ( dialog ) ; return run ; } 