static void test_user_ringbuf_loop ( void ) { struct user_ringbuf_success * skel ; struct user_ring_buffer * ringbuf ; uint32_t total_samples = 8192 ; uint32_t remaining_samples = total_samples ; int err ; BUILD_BUG_ON ( total_samples <= c_max_entries ) ; err = load_skel_create_user_ringbuf ( & skel , & ringbuf ) ; { uint32_t curr_samples ; curr_samples = remaining_samples > c_max_entries ?c_max_entries : remaining_samples ; err = write_samples ( ringbuf , curr_samples ) ; if ( err != 0 ) { ASSERT_OK ( err , "write_samples" ) ; cleanup } remaining_samples -= curr_samples ; ASSERT_EQ ( skel -> bss -> read , total_samples - remaining_samples , "current_batched_entries" ) ; } remaining_samples > 0 ; ASSERT_EQ ( skel -> bss -> read , total_samples , "total_batched_entries" ) ; cleanup user_ring_buffer__free ( ringbuf ) ; user_ringbuf_success__destroy ( skel ) ; } 