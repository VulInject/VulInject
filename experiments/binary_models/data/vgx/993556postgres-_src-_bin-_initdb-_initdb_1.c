static void bootstrap_template1 ( void ) { PG_CMD_DECL ; char * * line ; char * * bki_lines ; char headerline [ MAXPGPATH ] ; char buf [ 64 ] ; printf ( _ ( "running bootstrap script ... " ) ) ; fflush ( stdout ) ; bki_lines = readfile ( bki_file ) ; snprintf ( headerline , sizeof ( headerline ) , "# PostgreSQL %s\n" , PG_MAJORVERSION ) ; if ( strcmp ( headerline , * bki_lines ) != 0 ) { pg_log_error ( "input file \"%s\" does not belong to PostgreSQL %s" , bki_file , PG_VERSION ) ; pg_log_error_hint ( "Specify the correct path using the option -L." ) ; exit ( 1 ) ; } sprintf ( buf , "%d" , NAMEDATALEN ) ; bki_lines = replace_token ( bki_lines , "NAMEDATALEN" , buf ) ; sprintf ( buf , "%d" , ( int ) sizeof ( Pointer ) ) ; bki_lines = replace_token ( bki_lines , "SIZEOF_POINTER" , buf ) ; bki_lines = replace_token ( bki_lines , "ALIGNOF_POINTER" , ( sizeof ( Pointer ) == 4 ) ?"i" : "d" ) ; bki_lines = replace_token ( bki_lines , "FLOAT8PASSBYVAL" , FLOAT8PASSBYVAL ?"true" : "false" ) ; bki_lines = replace_token ( bki_lines , "POSTGRES" , escape_quotes_bki ( username ) ) ; bki_lines = replace_token ( bki_lines , "ENCODING" , encodingid_to_string ( encodingid ) ) ; bki_lines = replace_token ( bki_lines , "LC_COLLATE" , escape_quotes_bki ( lc_collate ) ) ; bki_lines = replace_token ( bki_lines , "LC_CTYPE" , escape_quotes_bki ( lc_ctype ) ) ; bki_lines = replace_token ( bki_lines , "ICU_LOCALE" , locale_provider == COLLPROVIDER_ICU ?escape_quotes_bki ( icu_locale ) : "_null_" ) ; sprintf ( buf , "%c" , locale_provider ) ; bki_lines = replace_token ( bki_lines , "LOCALE_PROVIDER" , buf ) ; unsetenv ( "PGCLIENTENCODING" ) ; snprintf ( cmd , sizeof ( cmd ) , "\"%s\" --boot -X %d %s %s %s %s" , backend_exec , wal_segment_size_mb * ( 1024 * 1024 ) , data_checksums ?"-k" : "" , boot_options , extra_options , debug ?"-d 5" : "" ) ; PG_CMD_OPEN ; for ( line = bki_lines ; * line != NULL ; line ++ ) { PG_CMD_PUTS ( * line ) ; free ( * line ) ; } PG_CMD_CLOSE ; check_ok ( ) ; } 