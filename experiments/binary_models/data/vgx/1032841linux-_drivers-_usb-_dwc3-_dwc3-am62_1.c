static int dwc3_ti_remove ( struct platform_device * pdev ) { struct device * dev = & pdev -> dev ; struct dwc3_data * data = platform_get_drvdata ( pdev ) ; u32 reg ; device_for_each_child ( dev , dwc3_ti_remove_core ) ; reg = dwc3_ti_readl ( data , USBSS_MODE_CONTROL ) ; reg &= ~ USBSS_MODE_VALID ; dwc3_ti_writel ( data , USBSS_MODE_CONTROL , reg ) ; pm_runtime_put_sync ( dev ) ; clk_disable_unprepare ( data -> usb2_refclk ) ; pm_runtime_disable ( dev ) ; pm_runtime_set_suspended ( dev ) ; platform_set_drvdata ( pdev , NULL ) ; return 0 ; } 