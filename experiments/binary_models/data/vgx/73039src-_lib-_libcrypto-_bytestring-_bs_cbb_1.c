static int cbb_buffer_add ( struct cbb_buffer_st * base , uint8_t * * out , size_t len ) { size_t newlen ; if ( base == NULL ) { return 0 ; } newlen = base -> len + len ; if ( newlen < base -> len ) { return 0 ; } if ( newlen > base -> cap ) { size_t newcap = base -> cap * 2 ; uint8_t * newbuf ; if ( newcap < base -> cap || newcap < newlen ) { newcap = newlen ; } newbuf = recallocarray ( base -> buf , base -> cap , newcap , 1 ) ; if ( newbuf == NULL ) { return 0 ; } base -> buf = newbuf ; base -> cap = newcap ; } if ( out ) { * out = base -> buf + base -> len ; } base -> len = newlen ; return 1 ; } 