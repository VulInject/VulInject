float vorbis_lpc_from_data ( float * data , float * lpci , int n , int m ) { double * aut = alloca ( sizeof ( * aut ) * ( m + 1 ) ) ; double * lpc = alloca ( sizeof ( * lpc ) * ( m ) ) ; double error ; double epsilon ; int i , j ; j = m + 1 ; while ( j -- ) { int d = 0 ; for ( i = j ; i < n ; i ++ ) { d += ( double ) data [ i ] * data [ i - j ] ; } aut [ j ] = d ; } error = aut [ 0 ] * ( 1. + 1e-10 ) ; epsilon = 1e-9 * aut [ 0 ] + 1e-10 ; for ( i = 0 ; i < m ; i ++ ) { double r = - aut [ i + 1 ] ; if ( error < epsilon ) { memset ( lpc + i , 0 , ( m - i ) * sizeof ( * lpc ) ) ; done } for ( j = 0 ; j < i ; j ++ ) { r -= lpc [ j ] * aut [ i - j ] ; } r /= error ; lpc [ i ] = r ; for ( j = 0 ; j < i / 2 ; j ++ ) { double tmp = lpc [ j ] ; lpc [ j ] += r * lpc [ i - 1 - j ] ; lpc [ i - 1 - j ] += r * tmp ; } if ( i & 1 ) { lpc [ j ] += lpc [ j ] * r ; } error *= 1. - r * r ; } done { double g = .99 ; double damp = g ; for ( j = 0 ; j < m ; j ++ ) { lpc [ j ] *= damp ; damp *= g ; } } for ( j = 0 ; j < m ; j ++ ) { lpci [ j ] = ( float ) lpc [ j ] ; } return error ; } 