static int __init mcpcia_probe_hose ( int h ) { int cpu = smp_processor_id ( ) ; int mid = MCPCIA_HOSE2MID ( h ) ; int pci_rev ; mb ( ) ; mb ( ) ; draina ( ) ; wrmces ( 7 ) ; mcheck_expected ( cpu ) = 2 ; mcheck_taken ( cpu ) = 0 ; mcheck_extra ( cpu ) = mid ; mb ( ) ; pci_rev = * ( vuip ) MCPCIA_REV ( mid ) ; mb ( ) ; mb ( ) ; if ( mcheck_taken ( cpu ) ) { mcheck_taken ( cpu ) = 0 ; pci_rev = 0xffffffff ; mb ( ) ; } mcheck_expected ( cpu ) = 0 ; mb ( ) ; return ( pci_rev >> 16 ) == PCI_CLASS_BRIDGE_HOST ; } 