static int vpx3220_probe ( struct i2c_client * client , const struct i2c_device_id * id ) { struct vpx3220 * decoder ; struct v4l2_subdev * sd ; const char * name = NULL ; u8 ver ; u16 pn ; decoder = devm_kzalloc ( & client -> dev , sizeof ( * decoder ) , GFP_KERNEL ) ; if ( decoder == NULL ) { return - ENOMEM ; } sd = & decoder -> sd ; v4l2_i2c_subdev_init ( sd , client , & vpx3220_ops ) ; decoder -> norm = V4L2_STD_PAL ; decoder -> input = 0 ; decoder -> enable = 1 ; v4l2_ctrl_handler_init ( & decoder -> hdl , 4 ) ; v4l2_ctrl_new_std ( & decoder -> hdl , & vpx3220_ctrl_ops , V4L2_CID_BRIGHTNESS , - 128 , 127 , 1 , 0 ) ; v4l2_ctrl_new_std ( & decoder -> hdl , & vpx3220_ctrl_ops , V4L2_CID_CONTRAST , 0 , 63 , 1 , 32 ) ; v4l2_ctrl_new_std ( & decoder -> hdl , & vpx3220_ctrl_ops , V4L2_CID_SATURATION , 0 , 4095 , 1 , 2048 ) ; v4l2_ctrl_new_std ( & decoder -> hdl , & vpx3220_ctrl_ops , V4L2_CID_HUE , - 512 , 511 , 1 , 0 ) ; sd -> ctrl_handler = & decoder -> hdl ; if ( decoder -> hdl . error ) { int err = decoder -> hdl . error ; v4l2_ctrl_handler_free ( & decoder -> hdl ) ; return err ; } v4l2_ctrl_handler_setup ( & decoder -> hdl ) ; ver = i2c_smbus_read_byte_data ( client , 0x00 ) ; pn = ( i2c_smbus_read_byte_data ( client , 0x02 ) << 8 ) + i2c_smbus_read_byte_data ( client , 0x01 ) ; if ( ver == 0xec ) { switch ( pn ) { case 0x4680 : name = "vpx3220a" ; break ; case 0x4260 : name = "vpx3216b" ; break ; case 0x4280 : name = "vpx3214c" ; break ; } } if ( name ) { v4l2_info ( sd , "%s found @ 0x%x (%s)\n" , name , client -> addr << 1 , client -> adapter -> name ) ; } else { v4l2_info ( sd , "chip (%02x:%04x) found @ 0x%x (%s)\n" , ver , pn , client -> addr << 1 , client -> adapter -> name ) ; } vpx3220_write_block ( sd , init_common , sizeof ( init_common ) ) ; vpx3220_write_fp_block ( sd , init_fp , sizeof ( init_fp ) >> 1 ) ; vpx3220_write_fp_block ( sd , init_pal , sizeof ( init_pal ) >> 1 ) ; return 0 ; } 