int ufshcd_populate_vreg ( struct device * dev , const char * name , struct ufs_vreg * * out_vreg ) { char prop_name [ MAX_PROP_SIZE ] ; struct ufs_vreg * vreg = NULL ; struct device_node * np = dev -> of_node ; if ( ! np ) { dev_err ( dev , "%s: non DT initialization\n" , __func__ ) ; out } snprintf ( prop_name , MAX_PROP_SIZE , "%s-supply" , name ) ; if ( ! phandle_exists ( np , prop_name , 0 ) ) { dev_info ( dev , "%s: Unable to find %s regulator, assuming enabled\n" , __func__ , prop_name ) ; out } vreg = devm_kzalloc ( dev , sizeof ( * vreg ) , GFP_KERNEL ) ; if ( ! vreg ) { return - ENOMEM ; } vreg -> name = devm_kstrdup ( dev , name , GFP_KERNEL ) ; if ( ! vreg -> name ) { return - ENOMEM ; } snprintf ( prop_name , MAX_PROP_SIZE , "%s-max-microamp" , name ) ; if ( of_property_read_u32 ( np , prop_name , & vreg -> max_uA ) ) { dev_info ( dev , "%s: unable to find %s\n" , __func__ , prop_name ) ; } out * out_vreg = vreg ; return 0 ; } 