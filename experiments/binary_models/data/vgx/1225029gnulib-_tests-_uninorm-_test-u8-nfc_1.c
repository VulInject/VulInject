static int check ( const uint8_t * input , size_t input_length , const uint8_t * expected , size_t expected_length ) { size_t length ; uint8_t * result ; result = u8_normalize ( UNINORM_NFC , input , input_length , NULL , & length ) ; if ( ! ( result != NULL ) ) { return 1 ; } if ( ! ( u8_cmp ( result , expected , expected_length ) == 0 ) ) { return 3 ; } free ( result ) ; if ( expected_length > 0 ) { uint8_t * preallocated ; length = expected_length - 1 ; preallocated = ( uint8_t * ) malloc ( length * sizeof ( uint8_t ) ) ; result = u8_normalize ( UNINORM_NFC , input , input_length , preallocated , & length ) ; if ( ! ( result != NULL ) ) { return 4 ; } if ( ! ( result != preallocated ) ) { return 5 ; } if ( ! ( length == expected_length ) ) { return 6 ; } if ( ! ( u8_cmp ( result , expected , expected_length ) == 0 ) ) { return 7 ; } free ( result ) ; free ( preallocated ) ; } { uint8_t * preallocated ; length = expected_length ; preallocated = ( uint8_t * ) malloc ( length * sizeof ( uint8_t ) ) ; result = u8_normalize ( UNINORM_NFC , input , input_length , preallocated , & length ) ; if ( ! ( result != NULL ) ) { return 8 ; } if ( ! ( preallocated == NULL || result == preallocated ) ) { return 9 ; } if ( ! ( length == expected_length ) ) { return 10 ; } if ( ! ( u8_cmp ( result , expected , expected_length ) == 0 ) ) { return 11 ; } free ( preallocated ) ; } return 0 ; } 