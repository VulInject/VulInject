static void sf_pdma_free_chan_resources ( struct dma_chan * dchan ) { struct sf_pdma_chan * chan = to_sf_pdma_chan ( dchan ) ; unsigned long flags ; LIST_HEAD ( head ) ; spin_lock_irqsave ( & chan -> vchan . lock , flags ) ; sf_pdma_disable_request ( chan ) ; chan -> desc = NULL ; vchan_get_all_descriptors ( & chan -> vchan , & head ) ; sf_pdma_disclaim_chan ( chan ) ; spin_unlock_irqrestore ( & chan -> vchan . lock , flags ) ; vchan_dma_desc_free_list ( & chan -> vchan , & head ) ; } 