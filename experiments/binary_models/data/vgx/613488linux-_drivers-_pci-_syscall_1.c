SYSCALL_DEFINE5 ( , , , , , , , , , , ) { struct pci_dev * dev ; u8 byte ; u16 word ; u32 dword ; int err = 0 ; dev = pci_get_domain_bus_and_slot ( 0 , bus , dfn ) ; if ( ! dev ) { return - ENODEV ; } switch ( len ) { case 1 : err = get_user ( byte , ( u8 __user * ) buf ) ; if ( err ) { break ; } err = pci_user_write_config_byte ( dev , off , byte ) ; if ( err ) { err = - EIO ; } break ; case 2 : err = get_user ( word , ( u16 __user * ) buf ) ; if ( err ) { break ; } err = pci_user_write_config_word ( dev , off , word ) ; if ( err ) { err = - EIO ; } break ; case 4 : err = get_user ( dword , ( u32 __user * ) buf ) ; if ( err ) { break ; } err = pci_user_write_config_dword ( dev , off , dword ) ; if ( err ) { err = - EIO ; } break ; default : err = - EINVAL ; break ; } pci_dev_put ( dev ) ; return err ; } 