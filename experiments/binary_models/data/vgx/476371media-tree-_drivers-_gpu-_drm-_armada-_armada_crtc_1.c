static void armada_drm_crtc_complete_frame_work ( struct armada_crtc * dcrtc , struct armada_plane * plane , struct armada_plane_work * work ) { struct armada_frame_work * fwork = container_of ( work , armada_frame_work , work ) ; struct drm_device * dev = dcrtc -> crtc . dev ; unsigned long flags ; spin_lock_irqsave ( & dcrtc -> irq_lock , flags ) ; armada_drm_crtc_update_regs ( dcrtc , fwork -> regs ) ; spin_unlock_irqrestore ( & dcrtc -> irq_lock , flags ) ; if ( fwork -> event ) { spin_lock_irqsave ( & dev -> event_lock , flags ) ; drm_crtc_send_vblank_event ( & dcrtc -> crtc , fwork -> event ) ; spin_unlock_irqrestore ( & dev -> event_lock , flags ) ; } __armada_drm_queue_unref_work ( dcrtc -> crtc . dev , fwork -> old_fb ) ; } 