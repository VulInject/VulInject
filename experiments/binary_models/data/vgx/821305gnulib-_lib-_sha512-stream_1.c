Return zero only successful . * int shaxxx_stream ( FILE * stream , char const * alg , void * resblock , ssize_t hashlen , void ( * init_ctx ) ( sha512_ctx * ) , void * * finish_ctx ( sha512_ctx * , void * ) ) ( ( afalg_stream ( stream , alg , resblock , hashlen ) ) { case 0 : return 0 ; } case - EIO : , 1 ) char * buffer = malloc ( BLOCKSIZE + 72 ) ; if ( ! buffer ) { return 1 ; } struct sha512_ctx ctx ; init_ctx ( & ctx ) ; size_t sum ; while ( 1 ) { size_t n ; sum = 0 ; while ( 1 ) { if ( feof ( stream ) ) { process_partial_block } n = fread ( buffer + sum , 1 , BLOCKSIZE - sum , stream ) ; sum += n ; if ( sum == BLOCKSIZE ) { break ; } if ( n == 0 ) { if ( ferror ( stream ) ) { return 1 ; } process_partial_block } } sha512_process_block ( buffer , BLOCKSIZE , & ctx ) ; } process_partial_block if ( sum > 0 ) { sha512_process_bytes ( buffer , sum , & ctx ) ; } finish_ctx ( & ctx , resblock ) ; free ( buffer ) ; return 0 ; 