static u8 * brcmf_fw_nvram_from_efi ( size_t * data_len_ret ) { efi_guid_t guid = EFI_GUID ( 0x74b00bd9 , 0x805a , 0x4d61 , 0xb5 , 0x1f , 0x43 , 0x26 , 0x81 , 0x23 , 0xd1 , 0x13 ) ; unsigned long data_len = 0 ; efi_status_t status ; u8 * data = NULL ; if ( ! efi_rt_services_supported ( EFI_RT_SUPPORTED_GET_VARIABLE ) ) { return NULL ; } status = efi . get_variable ( L"nvram" , & guid , NULL , & data_len , NULL ) ; if ( status != EFI_BUFFER_TOO_SMALL ) { fail } data = kmalloc ( data_len , GFP_KERNEL ) ; if ( ! data ) { fail } status = efi . get_variable ( L"nvram" , & guid , NULL , & data_len , data ) ; if ( status != EFI_SUCCESS ) { fail } brcmf_fw_fix_efi_nvram_ccode ( data , data_len ) ; brcmf_info ( "Using nvram EFI variable\n" ) ; * data_len_ret = data_len ; return data ; fail return NULL ; } 