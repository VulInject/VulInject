static void bluefield_edac_check ( struct mem_ctl_info * mci ) { struct bluefield_edac_priv * priv = mci -> pvt_info ; u32 ecc_count , single_error_count , double_error_count , ecc_error = 0 ; ecc_count = readl ( priv -> emi_base + MLXBF_ECC_CNT ) ; single_error_count = FIELD_GET ( MLXBF_ECC_CNT__SERR_CNT , ecc_count ) ; double_error_count = FIELD_GET ( MLXBF_ECC_CNT__DERR_CNT , ecc_count ) ; if ( single_error_count ) { ecc_error |= MLXBF_ECC_ERR__SECC ; bluefield_gather_report_ecc ( mci , single_error_count , 1 ) ; } if ( double_error_count ) { ecc_error |= MLXBF_ECC_ERR__DECC ; bluefield_gather_report_ecc ( mci , double_error_count , 0 ) ; } if ( ecc_count ) { writel ( ecc_error , priv -> emi_base + MLXBF_ECC_ERR ) ; } } 