int shm_regcomp ( shm_regex_t * preg , const char * regex , int cflags ) { malloc_hook_t * orig_malloc_hook ; realloc_hook_t * orig_realloc_hook ; free_hook_t * orig_free_hook ; int ret ; replace_malloc_hooks ( ) ; ret = regcomp ( & preg -> regexp , regex , cflags ) ; restore_malloc_hooks ( ) ; if ( ret ) { lock_destroy ( & preg -> lock ) ; } return ret ; } 