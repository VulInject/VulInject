static void llc_shdlc_rcv_i_frame ( struct llc_shdlc * shdlc , struct sk_buff * skb , int ns , int nr ) { int x_ns = ns ; int y_nr = nr ; pr_debug ( "recvd I-frame %d, remote waiting frame %d\n" , ns , nr ) ; if ( shdlc -> state != SHDLC_CONNECTED ) { exit } if ( x_ns != shdlc -> nr ) { llc_shdlc_send_s_frame ( shdlc , S_FRAME_REJ , shdlc -> nr ) ; exit } if ( ! shdlc -> t1_active ) { shdlc -> t1_active = true ; mod_timer ( & shdlc -> t1_timer , jiffies + msecs_to_jiffies ( SHDLC_T1_VALUE_MS ( shdlc -> w ) ) ) ; pr_debug ( "(re)Start T1(send ack)\n" ) ; } if ( skb -> len ) { shdlc -> rcv_to_hci ( shdlc -> hdev , skb ) ; skb = NULL ; } shdlc -> nr = ( shdlc -> nr + 1 ) % 8 ; if ( llc_shdlc_x_lt_y_lteq_z ( shdlc -> dnr , y_nr , shdlc -> ns ) ) { llc_shdlc_reset_t2 ( shdlc , y_nr ) ; shdlc -> dnr = y_nr ; } exit } 