AcpiNsCheckPackage ( , ) { ACPI_OPERAND_OBJECT * ReturnObject = * ReturnObjectPtr ; const ACPI_PREDEFINED_INFO * Package ; ACPI_OPERAND_OBJECT * * Elements ; ACPI_STATUS Status = AE_OK ; UINT32 ExpectedCount ; UINT32 Count ; UINT32 i ; ACPI_FUNCTION_NAME ( NsCheckPackage ) ; Package = Info -> Predefined + 1 ; ACPI_DEBUG_PRINT ( ( ACPI_DB_NAMES , "%s Validating return Package of Type %X, Count %X\n" , Info -> FullPathname , Package -> RetInfo . Type , ReturnObject -> Package . Count ) ) ; AcpiNsRemoveNullElements ( Info , Package -> RetInfo . Type , ReturnObject ) ; Elements = ReturnObject -> Package . Elements ; Count = ReturnObject -> Package . Count ; if ( ! Count ) { ACPI_WARN_PREDEFINED ( ( AE_INFO , Info -> FullPathname , Info -> NodeFlags , "Return Package has no elements (empty)" ) ) ; return ( AE_AML_OPERAND_VALUE ) ; } switch ( Package -> RetInfo . Type ) { case ACPI_PTYPE_CUSTOM : Status = AcpiNsCustomPackage ( Info , Elements , Count ) ; break ; case ACPI_PTYPE1_FIXED : ExpectedCount = Package -> RetInfo . Count1 + Package -> RetInfo . Count2 ; if ( Count < ExpectedCount ) { PackageTooSmall } if ( Count > ExpectedCount ) { ACPI_DEBUG_PRINT ( ( ACPI_DB_REPAIR , "%s: Return Package is larger than needed - " "found %u, expected %u\n" , Info -> FullPathname , Count , ExpectedCount ) ) ; } Status = AcpiNsCheckPackageElements ( Info , Elements , Package -> RetInfo . ObjectType1 , Package -> RetInfo . Count1 , Package -> RetInfo . ObjectType2 , Package -> RetInfo . Count2 , 0 ) ; break ; case ACPI_PTYPE1_VAR : for ( i = 0 ; i < Count ; i ++ ) { Status = AcpiNsCheckObjectType ( Info , Elements , Package -> RetInfo . ObjectType1 , i ) ; if ( ACPI_FAILURE ( Status ) ) { return ( Status ) ; } Elements ++ ; } break ; case ACPI_PTYPE1_OPTION : ExpectedCount = Package -> RetInfo3 . Count ; if ( Count < ExpectedCount ) { PackageTooSmall } for ( i = 0 ; i < Count ; i ++ ) { if ( i < Package -> RetInfo3 . Count ) { Status = AcpiNsCheckObjectType ( Info , Elements , Package -> RetInfo3 . ObjectType [ i ] , i ) ; if ( ACPI_FAILURE ( Status ) ) { return ( Status ) ; } } else { Status = AcpiNsCheckObjectType ( Info , Elements , Package -> RetInfo3 . TailObjectType , i ) ; if ( ACPI_FAILURE ( Status ) ) { return ( Status ) ; } } Elements ++ ; } break ; case ACPI_PTYPE2_REV_FIXED : Status = AcpiNsCheckObjectType ( Info , Elements , ACPI_RTYPE_INTEGER , 0 ) ; if ( ACPI_FAILURE ( Status ) ) { return ( Status ) ; } Elements ++ ; Count -- ; Status = AcpiNsCheckPackageList ( Info , Package , Elements , Count ) ; break ; case ACPI_PTYPE2_PKG_COUNT : Status = AcpiNsCheckObjectType ( Info , Elements , ACPI_RTYPE_INTEGER , 0 ) ; if ( ACPI_FAILURE ( Status ) ) { return ( Status ) ; } ExpectedCount = ( UINT32 ) ( * Elements ) -> Integer . Value ; if ( ExpectedCount >= Count ) { PackageTooSmall } Count = ExpectedCount ; Elements ++ ; Status = AcpiNsCheckPackageList ( Info , Package , Elements , Count ) ; break ; case ACPI_PTYPE2 : case ACPI_PTYPE2_FIXED : case ACPI_PTYPE2_MIN : case ACPI_PTYPE2_COUNT : case ACPI_PTYPE2_FIX_VAR : if ( * Elements && ( ( * Elements ) -> Common . Type != ACPI_TYPE_PACKAGE ) ) { Status = AcpiNsWrapWithPackage ( Info , ReturnObject , ReturnObjectPtr ) ; if ( ACPI_FAILURE ( Status ) ) { return ( Status ) ; } ReturnObject = * ReturnObjectPtr ; Elements = ReturnObject -> Package . Elements ; Count = 1 ; } Status = AcpiNsCheckPackageList ( Info , Package , Elements , Count ) ; break ; case ACPI_PTYPE2_VAR_VAR : break ; case ACPI_PTYPE2_UUID_PAIR : if ( Count & 1 ) { ExpectedCount = Count + 1 ; PackageTooSmall } while ( Count > 0 ) { Status = AcpiNsCheckObjectType ( Info , Elements , Package -> RetInfo . ObjectType1 , 0 ) ; if ( ACPI_FAILURE ( Status ) ) { return ( Status ) ; } if ( ( * Elements ) -> Buffer . Length != 16 ) { ACPI_WARN_PREDEFINED ( ( AE_INFO , Info -> FullPathname , Info -> NodeFlags , "Invalid length for UUID Buffer" ) ) ; return ( AE_AML_OPERAND_VALUE ) ; } Status = AcpiNsCheckObjectType ( Info , Elements + 1 , Package -> RetInfo . ObjectType2 , 0 ) ; if ( ACPI_FAILURE ( Status ) ) { return ( Status ) ; } Elements += 2 ; Count -= 2 ; } break ; default : ACPI_WARN_PREDEFINED ( ( AE_INFO , Info -> FullPathname , Info -> NodeFlags , "Invalid internal return type in table entry: %X" , Package -> RetInfo . Type ) ) ; return ( AE_AML_INTERNAL ) ; } return ( Status ) ; PackageTooSmall ACPI_WARN_PREDEFINED ( ( AE_INFO , Info -> FullPathname , Info -> NodeFlags , "Return Package is too small - found %u elements, expected %u" , Count , ExpectedCount ) ) ; return ( AE_AML_OPERAND_VALUE ) ; } 