int ecryptfs_write_lower ( struct inode * ecryptfs_inode , char * data , loff_t offset , size_t size ) { struct file * lower_file ; ssize_t rc ; lower_file = ecryptfs_inode_to_private ( ecryptfs_inode ) -> lower_file ; if ( ! lower_file ) { return - EIO ; } rc = kernel_write ( lower_file , data , size , & offset ) ; mark_inode_dirty_sync ( ecryptfs_inode , NULL ) ; return rc ; } int ecryptfs_write_lower_page_segment ( struct inode * ecryptfs_inode , struct page * page_for_lower , size_t offset_in_page , size_t size ) { char * virt ; loff_t offset ; int rc ; offset = ( ( ( ( loff_t ) page_for_lower -> index ) << PAGE_SHIFT ) + offset_in_page ) ; virt = kmap ( page_for_lower ) ; rc = ecryptfs_write_lower ( ecryptfs_inode , virt , offset , size ) ; if ( rc > 0 ) { rc = 0 ; } kunmap ( page_for_lower ) ; return rc ; } 