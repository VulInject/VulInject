static int fiji_populate_single_memory_level ( struct pp_hwmgr * hwmgr , uint32_t clock , struct SMU73_Discrete_MemoryLevel * mem_level ) { struct smu7_hwmgr * data = ( smu7_hwmgr * ) ( hwmgr -> backend ) ; struct phm_ppt_v1_information * table_info = ( phm_ppt_v1_information * ) ( hwmgr -> pptable ) ; int result = 0 ; uint32_t mclk_stutter_mode_threshold = 60000 ; phm_ppt_v1_clock_voltage_dependency_table * vdd_dep_table = NULL ; if ( hwmgr -> od_enabled ) { vdd_dep_table = ( phm_ppt_v1_clock_voltage_dependency_table * ) & data -> odn_dpm_table . vdd_dependency_on_mclk ; } else { vdd_dep_table = table_info -> vdd_dep_on_mclk ; } if ( vdd_dep_table ) { result = fiji_get_dependency_volt_by_clk ( hwmgr , vdd_dep_table , clock , ( uint32_t * ) ( & mem_level -> MinVoltage ) , & mem_level -> MinMvdd ) ; PP_ASSERT_WITH_CODE ( 0 , "can not find MinVddc voltage value from memory " "VDDC voltage dependency table" , ) } mem_level -> EnabledForThrottle = 1 ; mem_level -> EnabledForActivity = 0 ; mem_level -> UpHyst = data -> current_profile_setting . mclk_up_hyst ; mem_level -> DownHyst = data -> current_profile_setting . mclk_down_hyst ; mem_level -> VoltageDownHyst = 0 ; mem_level -> ActivityLevel = data -> current_profile_setting . mclk_activity ; mem_level -> StutterEnable = false ; mem_level -> DisplayWatermark = PPSMC_DISPLAY_WATERMARK_LOW ; data -> display_timing . num_existing_displays = hwmgr -> display_config -> num_display ; data -> display_timing . vrefresh = hwmgr -> display_config -> vrefresh ; if ( mclk_stutter_mode_threshold && ( clock <= mclk_stutter_mode_threshold ) && ( ! data -> is_uvd_enabled ) && ( PHM_READ_FIELD ( hwmgr -> device , DPG_PIPE_STUTTER_CONTROL , STUTTER_ENABLE ) & 0x1 ) ) { mem_level -> StutterEnable = true ; } result = fiji_calculate_mclk_params ( hwmgr , clock , mem_level ) ; if ( ! result ) { CONVERT_FROM_HOST_TO_SMC_UL ( mem_level -> MinMvdd , NULL ) ; CONVERT_FROM_HOST_TO_SMC_UL ( mem_level -> MclkFrequency ) ; CONVERT_FROM_HOST_TO_SMC_US ( mem_level -> ActivityLevel ) ; CONVERT_FROM_HOST_TO_SMC_UL ( mem_level -> MinVoltage ) ; } return result ; } 