static int adis16260_write_raw ( struct iio_dev * indio_dev , struct iio_chan_spec const * chan , int val , int val2 , long mask ) { struct adis16260 * adis16260 = iio_priv ( indio_dev ) ; struct adis * adis = & adis16260 -> adis ; int ret ; u8 addr ; u8 t ; switch ( mask ) { case IIO_CHAN_INFO_CALIBBIAS : addr = adis16260_addresses [ chan -> scan_index ] [ 0 ] ; return adis_write_reg_16 ( adis , addr , val ) ; case IIO_CHAN_INFO_CALIBSCALE : if ( val < 0 || val >= 4096 ) { return - EINVAL ; } addr = adis16260_addresses [ chan -> scan_index ] [ 1 ] ; return adis_write_reg_16 ( adis , addr , val ) ; case IIO_CHAN_INFO_SAMP_FREQ : adis_dev_lock ( adis ) ; if ( spi_get_device_id ( adis -> spi ) -> driver_data ) { t = 256 / val ; } else { t = 2048 / val ; } if ( t > ADIS16260_SMPL_PRD_DIV_MASK ) { t = ADIS16260_SMPL_PRD_DIV_MASK ; } if ( t > 0 ) { t -- ; } if ( t >= 0x0A ) { adis -> spi -> max_speed_hz = ADIS16260_SPI_SLOW ; } else { adis -> spi -> max_speed_hz = ADIS16260_SPI_FAST ; } ret = __adis_write_reg_8 ( adis , ADIS16260_SMPL_PRD , t ) ; adis_dev_unlock ( adis ) ; return ret ; } return - EINVAL ; } 