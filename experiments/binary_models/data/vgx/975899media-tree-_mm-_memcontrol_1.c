static void mem_cgroup_css_free ( struct cgroup_subsys_state * css ) { struct mem_cgroup * memcg = mem_cgroup_from_css ( css ) ; if ( cgroup_subsys_on_dfl ( memory_cgrp_subsys ) && ! cgroup_memory_nosocket ) { static_branch_dec ( & memcg_sockets_enabled_key ) ; } if ( ! cgroup_subsys_on_dfl ( memory_cgrp_subsys ) && memcg -> tcpmem_active ) { static_branch_dec ( & memcg_sockets_enabled_key ) ; } vmpressure_cleanup ( & memcg -> vmpressure ) ; cancel_work_sync ( & memcg -> high_work ) ; mem_cgroup_remove_from_trees ( memcg ) ; memcg_free_kmem ( memcg ) ; } 