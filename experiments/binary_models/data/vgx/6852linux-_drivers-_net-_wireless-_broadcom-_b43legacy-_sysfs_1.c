static ssize_t b43legacy_attr_interfmode_store ( struct device * dev , struct device_attribute * attr , const char * buf , size_t count ) { struct b43legacy_wldev * wldev = dev_to_b43legacy_wldev ( dev ) ; unsigned long flags ; int err ; int mode ; mode = get_integer ( buf , count ) ; switch ( mode ) { case 0 : mode = B43legacy_INTERFMODE_NONE ; break ; case 1 : mode = B43legacy_INTERFMODE_NONWLAN ; break ; case 2 : mode = B43legacy_INTERFMODE_MANUALWLAN ; break ; case 3 : mode = B43legacy_INTERFMODE_AUTOWLAN ; break ; default : return - EINVAL ; } mutex_lock ( & wldev -> wl -> mutex ) ; spin_lock_irqsave ( & wldev -> wl -> irq_lock , flags ) ; err = b43legacy_radio_set_interference_mitigation ( wldev , mode ) ; if ( err ) { b43legacyerr ( wldev -> wl , "Interference Mitigation not " "supported by device\n" ) ; } spin_unlock_irqrestore ( & wldev -> wl -> irq_lock , flags ) ; mutex_unlock ( & wldev -> wl -> mutex ) ; return err ?err : count ; } 