int pnp_check_irq ( struct pnp_dev * dev , struct resource * res ) { int i ; struct pnp_dev * tdev ; struct resource * tres ; resource_size_t * irq ; irq = & res -> start ; if ( cannot_compare ( res -> flags ) ) { return 1 ; } for ( i = 0 ; i < 16 ; i ++ ) { if ( pnp_reserve_irq [ i ] == * irq ) { return 0 ; } } for ( i = 0 ; ( tres = pnp_get_resource ( dev , IORESOURCE_IRQ , i ) ) ; i ++ ) { if ( tres != res && tres -> flags & IORESOURCE_IRQ ) { if ( tres -> start == * irq ) { return 0 ; } } } if ( pci_uses_irq ( dev , * irq ) ) { return 0 ; } if ( ! dev -> active ) { if ( request_irq ( * irq , pnp_test_handler , IRQF_PROBE_SHARED , "pnp" , NULL ) ) { return 0 ; } free_irq ( * irq , NULL ) ; } pnp_for_each_dev ( ) { if ( tdev == dev ) { continue ; } for ( i = 0 ; ( tres = pnp_get_resource ( tdev , IORESOURCE_IRQ , i ) ) ; i ++ ) { if ( tres -> flags & IORESOURCE_IRQ ) { if ( cannot_compare ( tres -> flags ) ) { continue ; } if ( tres -> start == * irq ) { return 0 ; } } } } return 1 ; } 