static hma_reg_t * hma_register_backend ( const char * name ) { struct hma_reg * reg ; boolean_t is_ready ; ASSERT ( MUTEX_HELD ( & hma_lock ) ) ; switch ( cpuid_getvendor ( CPU ) ) { case X86_VENDOR_Intel : is_ready = hma_vmx_ready ; break ; case X86_VENDOR_AMD : case X86_VENDOR_HYGON : is_ready = hma_svm_ready ; break ; default : is_ready = B_FALSE ; break ; } reg = kmem_zalloc ( sizeof ( * reg ) , KM_SLEEP ) ; reg -> hr_name = name ; list_insert_tail ( & hma_registrations , reg ) ; return ( reg ) ; } 