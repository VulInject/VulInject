exec_display_line ( , , , ) { char * line_color , * line_color2 , * line2 , str_number [ 32 ] , str_tags [ 1024 ] ; const char * ptr_line_color ; int length ; if ( ! exec_cmd || ! line ) { return ; } if ( exec_cmd -> output_to_buffer && ! exec_cmd -> pipe_command && ! buffer ) { return ; } if ( exec_cmd -> output_to_buffer && ( out == EXEC_STDERR ) && ! exec_cmd -> output_to_buffer_stderr ) { return ; } line_color = exec_decode_color ( exec_cmd , line ) ; if ( ! line_color ) { return ; } exec_cmd -> output_line_nb ++ ; if ( exec_cmd -> pipe_command ) { if ( strstr ( exec_cmd -> pipe_command , "$line" ) ) { line2 = weechat_string_replace ( exec_cmd -> pipe_command , "$line" , line_color ) ; if ( line2 ) { weechat_command ( buffer , line2 ) ; } } else { length = strlen ( exec_cmd -> pipe_command ) + 1 + strlen ( line_color ) + 1 ; line2 = malloc ( length ) ; if ( line2 ) { snprintf ( line2 , length , "%s %s" , exec_cmd -> pipe_command , line_color ) ; weechat_command ( buffer , line2 ) ; free ( line2 ) ; } } } if ( exec_cmd -> output_to_buffer ) { if ( exec_cmd -> line_numbers ) { length = 32 + strlen ( line_color ) + 1 ; line2 = malloc ( length ) ; if ( line2 ) { snprintf ( line2 , length , "%d. %s" , exec_cmd -> output_line_nb , line_color ) ; weechat_command ( buffer , line2 ) ; free ( line2 ) ; } } else { if ( exec_cmd -> output_to_buffer_exec_cmd ) { ptr_line_color = line_color ; } else { ptr_line_color = weechat_string_input_for_buffer ( line_color ) ; } if ( ptr_line_color ) { weechat_command ( buffer , ( ptr_line_color [ 0 ] ) ?ptr_line_color : " " ) ; } else { length = 1 + strlen ( line_color ) + 1 ; line_color2 = malloc ( length ) ; if ( line_color2 ) { snprintf ( line_color2 , length , "%c%s" , line_color [ 0 ] , line_color ) ; weechat_command ( buffer , ( line_color2 [ 0 ] ) ?line_color2 : " " ) ; free ( line_color2 ) ; } } } } else { snprintf ( str_number , sizeof ( str_number ) , "%ld" , exec_cmd -> number ) ; snprintf ( str_tags , sizeof ( str_tags ) , "exec_%s,exec_cmd_%s" , ( out == EXEC_STDOUT ) ?"stdout" : "stderr" , ( exec_cmd -> name ) ?exec_cmd -> name : str_number ) ; if ( weechat_buffer_get_integer ( buffer , "type" ) == 1 ) { snprintf ( str_number , sizeof ( str_number ) , "%d. " , exec_cmd -> output_line_nb ) ; weechat_printf_y ( buffer , - 1 , "%s%s" , ( exec_cmd -> line_numbers ) ?str_number : " " , line_color ) ; } else { snprintf ( str_number , sizeof ( str_number ) , "%d\t" , exec_cmd -> output_line_nb ) ; weechat_printf_date_tags ( buffer , 0 , str_tags , "%s%s" , ( exec_cmd -> line_numbers ) ?str_number : " \t" , line_color ) ; } } free ( line_color ) ; } 