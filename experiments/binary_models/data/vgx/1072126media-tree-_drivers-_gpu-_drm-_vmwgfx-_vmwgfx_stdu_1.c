static void vmw_stdu_crtc_mode_set_nofb ( struct drm_crtc * crtc ) { struct vmw_private * dev_priv ; struct vmw_screen_target_display_unit * stdu ; int ret ; stdu = vmw_crtc_to_stdu ( crtc ) ; dev_priv = vmw_priv ( crtc -> dev ) ; if ( stdu -> defined ) { ret = vmw_stdu_bind_st ( dev_priv , stdu , NULL ) ; if ( ret ) { DRM_ERROR ( "Failed to blank CRTC\n" ) ; } ( void ) vmw_stdu_update_st ( dev_priv , stdu ) ; ret = vmw_stdu_destroy_st ( dev_priv , stdu ) ; if ( ret ) { DRM_ERROR ( "Failed to destroy Screen Target\n" ) ; } stdu -> content_fb_type = SAME_AS_DISPLAY ; } vmw_svga_enable ( dev_priv ) ; ret = vmw_stdu_define_st ( dev_priv , stdu , & crtc -> mode , crtc -> x , crtc -> y ) ; if ( ret ) { DRM_ERROR ( "Failed to define Screen Target of size %dx%d\n" , crtc -> x , crtc -> y ) ; } } 