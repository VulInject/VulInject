static void uvc_delete ( struct uvc_device * dev ) { struct list_head * p , * n ; uvc_status_cleanup ( dev ) ; uvc_ctrl_cleanup_device ( dev ) ; usb_put_intf ( dev -> intf ) ; usb_put_dev ( dev -> udev ) ; if ( dev -> vdev . dev ) { v4l2_device_unregister ( & dev -> vdev ) ; } if ( media_devnode_is_registered ( dev -> mdev . devnode ) ) { media_device_unregister ( & dev -> mdev ) ; } media_device_cleanup ( & dev -> mdev ) ; list_for_each_safe ( , , ) { struct uvc_video_chain * chain ; chain = list_entry ( p , uvc_video_chain , list ) ; kfree ( chain ) ; } list_for_each_safe ( , , ) { struct uvc_entity * entity ; entity = list_entry ( p , uvc_entity , list ) ; uvc_mc_cleanup_entity ( entity ) ; kfree ( entity ) ; } list_for_each_safe ( , , ) { struct uvc_streaming * streaming ; streaming = list_entry ( p , uvc_streaming , list ) ; usb_driver_release_interface ( & uvc_driver . driver , streaming -> intf ) ; usb_put_intf ( streaming -> intf ) ; kfree ( streaming -> format ) ; kfree ( streaming ) ; } kfree ( dev ) ; } 