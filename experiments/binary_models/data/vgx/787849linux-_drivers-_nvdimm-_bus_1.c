int nvdimm_bus_create_ndctl ( struct nvdimm_bus * nvdimm_bus ) { dev_t devt = MKDEV ( nvdimm_bus_major , nvdimm_bus -> id ) ; struct device * dev ; int rc ; dev = kzalloc ( sizeof ( * dev ) , GFP_KERNEL ) ; device_initialize ( dev ) ; lockdep_set_class ( & dev -> mutex , & nvdimm_ndctl_key ) ; device_set_pm_not_required ( dev ) ; dev -> class = nd_class ; dev -> parent = & nvdimm_bus -> dev ; dev -> devt = devt ; dev -> release = ndctl_release ; rc = dev_set_name ( dev , "ndctl%d" , nvdimm_bus -> id ) ; if ( rc ) { err } rc = device_add ( dev ) ; if ( rc ) { dev_dbg ( & nvdimm_bus -> dev , "failed to register ndctl%d: %d\n" , nvdimm_bus -> id , rc ) ; err } return 0 ; err put_device ( dev ) ; return rc ; } 