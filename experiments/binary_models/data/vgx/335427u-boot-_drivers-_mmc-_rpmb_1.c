int mmc_rpmb_get_counter ( struct mmc * mmc , unsigned long * pcounter ) { int ret ; ALLOC_CACHE_ALIGN_BUFFER ( s_rpmb , rpmb_frame , 1 ) ; memset ( rpmb_frame , 0 , sizeof ( s_rpmb ) ) ; rpmb_frame -> request = cpu_to_be16 ( RPMB_REQ_WCOUNTER , NULL ) ; if ( mmc_rpmb_request ( mmc , rpmb_frame , 1 , false ) ) { return - 1 ; } ret = mmc_rpmb_response ( mmc , rpmb_frame , RPMB_RESP_WCOUNTER ) ; if ( ret ) { return ret ; } * pcounter = be32_to_cpu ( rpmb_frame -> write_counter ) ; return 0 ; } 