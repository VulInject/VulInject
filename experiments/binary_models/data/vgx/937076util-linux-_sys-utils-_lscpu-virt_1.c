static int is_vmware_platform ( void ) { uint32_t eax , ebx , ecx , edx ; struct sigaction act , oact ; if ( getuid ( ) != 0 ) { return 0 ; } if ( sigsetjmp ( segv_handler_env , 1 ) ) { return 0 ; } act . sa_sigaction = segv_handler ; act . sa_flags = SA_SIGINFO ; if ( sigaction ( SIGSEGV , & act , & oact ) ) { err ( EXIT_FAILURE , _ ( "cannot set signal handler" ) ) ; } vmware_bdoor ( & eax , & ebx , & ecx , & edx ) ; if ( sigaction ( SIGSEGV , & oact , NULL ) ) { err ( EXIT_FAILURE , _ ( "cannot restore signal handler" ) ) ; } return eax != ( uint32_t ) - 1 && ebx == VMWARE_BDOOR_MAGIC ; } 