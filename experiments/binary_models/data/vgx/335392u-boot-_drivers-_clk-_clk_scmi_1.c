static ulong scmi_clk_set_rate ( struct clk * clk , ulong rate ) { struct scmi_clk_priv * priv = dev_get_priv ( clk -> dev ) ; struct scmi_clk_rate_set_in in = { . clock_id = clk -> id . flags = SCMI_CLK_RATE_ROUND_CLOSEST . rate_lsb = ( u32 ) rate . rate_msb = ( u32 ) ( ( u64 ) rate >> 32 ) } ; struct scmi_clk_rate_set_out out ; struct scmi_msg msg = SCMI_MSG_IN ( SCMI_PROTOCOL_ID_CLOCK , SCMI_CLOCK_RATE_SET , in , out ) ; int ret ; ret = devm_scmi_process_msg ( clk -> dev , priv -> channel , & msg ) ; ret = scmi_to_linux_errno ( out . status ) ; if ( ret < 0 ) { return ret ; } return scmi_clk_get_rate ( clk ) ; } 