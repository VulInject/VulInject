LOCAL ( ) write_header ( , , ) { char targaheader [ 18 ] ; if ( num_colors > 0 ) { targaheader [ 1 ] = 1 ; targaheader [ 5 ] = ( char ) ( num_colors & 0xFF ) ; targaheader [ 6 ] = ( char ) ( num_colors >> 8 ) ; targaheader [ 7 ] = 24 ; } targaheader [ 12 ] = ( char ) ( cinfo -> output_width & 0xFF ) ; targaheader [ 13 ] = ( char ) ( cinfo -> output_width >> 8 ) ; targaheader [ 14 ] = ( char ) ( cinfo -> output_height & 0xFF ) ; targaheader [ 15 ] = ( char ) ( cinfo -> output_height >> 8 ) ; targaheader [ 17 ] = 0x20 ; if ( cinfo -> out_color_space == JCS_GRAYSCALE ) { targaheader [ 2 ] = 3 ; targaheader [ 16 ] = 8 ; } else { if ( num_colors > 0 ) { targaheader [ 2 ] = 1 ; targaheader [ 16 ] = 8 ; } else { targaheader [ 2 ] = 2 ; targaheader [ 16 ] = 24 ; } } if ( fwrite ( targaheader , 1 , 18 , dinfo -> output_file ) != ( size_t ) 18 ) { ERREXIT ( cinfo , JERR_FILE_WRITE ) ; } } 