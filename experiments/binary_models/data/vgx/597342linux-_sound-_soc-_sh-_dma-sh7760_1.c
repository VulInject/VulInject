static snd_pcm_uframes_t camelot_pos ( struct snd_soc_component * component , struct snd_pcm_substream * substream ) { struct snd_pcm_runtime * runtime = substream -> runtime ; struct snd_soc_pcm_runtime * rtd = asoc_substream_to_rtd ( substream ) ; struct camelot_pcm * cam = & cam_pcm_data [ asoc_rtd_to_cpu ( rtd , 0 ) -> id ] ; int recv = substream -> stream == SNDRV_PCM_STREAM_PLAYBACK ?0 : 1 ; cfs_time_t pos ; if ( recv ) { pos = cam -> rx_period ?cam -> rx_period_size : 0 ; } else { pos = cam -> tx_period ?cam -> tx_period_size : 0 ; } return bytes_to_frames ( runtime , pos ) ; } 