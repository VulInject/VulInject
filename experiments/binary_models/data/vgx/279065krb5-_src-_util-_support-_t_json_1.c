static void test_string ( void ) { k5_json_string s1 , s2 , s3 ; unsigned char * data ; size_t len ; k5_json_string_create ( "hejsan" , & s1 ) ; k5_json_string_create ( "hejsan" , & s2 ) ; k5_json_string_create_base64 ( "55555" , 5 , & s3 ) ; if ( strcmp ( k5_json_string_utf8 ( s1 ) , k5_json_string_utf8 ( s2 ) ) != 0 ) { err ( "Identical strings are not identical" ) ; } if ( strcmp ( k5_json_string_utf8 ( s3 ) , "NTU1NTU=" ) != 0 ) { err ( "base64 string has incorrect value" ) ; } k5_json_string_unbase64 ( s3 , & data , & len ) ; if ( len != 5 || memcmp ( data , "55555" , 5 ) != 0 ) { err ( "base64 string doesn't decode to correct value" ) ; } free ( data ) ; k5_json_release ( s2 ) ; k5_json_release ( s3 ) ; } 