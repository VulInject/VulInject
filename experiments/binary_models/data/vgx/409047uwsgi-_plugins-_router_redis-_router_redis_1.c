static int uwsgi_router_redis ( struct uwsgi_route * ur , char * args ) { ur -> func = uwsgi_routing_func_redis ; ur -> data = args ; ur -> data_len = strlen ( args ) ; struct uwsgi_router_redis_conf * urrc = uwsgi_calloc ( sizeof ( uwsgi_router_redis_conf ) ) ; if ( uwsgi_kvlist_parse ( ur -> data , ur -> data_len , ',' , '=' , "addr" , & urrc -> addr , "key" , & urrc -> key , "content_type" , & urrc -> content_type , "content_encoding" , & urrc -> content_encoding , "no_offload" , & urrc -> no_offload , NULL ) ) { uwsgi_log ( "invalid route syntax: %s\n" , args ) ; exit ( 1 ) ; } if ( ! urrc -> key || ! urrc -> addr ) { uwsgi_log ( "invalid route syntax: you need to specify a redis address and key pattern\n" ) ; return - 1 ; } urrc -> key_len = strlen ( urrc -> key ) ; urrc -> addr_len = strlen ( urrc -> addr ) ; if ( ! urrc -> content_type ) { urrc -> content_type = "text/html" ; } urrc -> content_type_len = strlen ( urrc -> content_type ) ; if ( urrc -> content_encoding ) { urrc -> content_encoding_len = strlen ( urrc -> content_encoding ) ; } ur -> data2 = urrc ; return 0 ; } 