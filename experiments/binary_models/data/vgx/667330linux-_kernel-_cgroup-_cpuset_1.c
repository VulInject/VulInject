static int validate_change ( struct cpuset * cur , struct cpuset * trial ) { struct cgroup_subsys_state * css ; struct cpuset * c , * par ; int ret ; rcu_read_lock ( ) ; if ( ! is_in_v2_mode ( ) ) { ret = validate_change_legacy ( cur , trial ) ; } if ( ret ) { out } if ( cur == & top_cpuset ) { out } par = parent_cs ( cur ) ; ret = - ENOSPC ; if ( ( cgroup_is_populated ( cur -> css . cgroup ) || cur -> attach_in_progress ) ) { if ( ! cpumask_empty ( cur -> cpus_allowed ) && cpumask_empty ( trial -> cpus_allowed ) ) { out } if ( ! nodes_empty ( cur -> mems_allowed ) && nodes_empty ( trial -> mems_allowed ) ) { out } } ret = - EBUSY ; if ( is_cpu_exclusive ( cur ) && ! cpuset_cpumask_can_shrink ( cur -> cpus_allowed , trial -> cpus_allowed ) ) { out } ret = - EINVAL ; cpuset_for_each_child ( , , ) { if ( ( is_cpu_exclusive ( trial ) || is_cpu_exclusive ( c ) ) && c != cur && cpumask_intersects ( trial -> cpus_allowed , c -> cpus_allowed ) ) { out } if ( ( is_mem_exclusive ( trial ) || is_mem_exclusive ( c ) ) && c != cur && nodes_intersects ( trial -> mems_allowed , c -> mems_allowed ) ) { out } } ret = 0 ; out rcu_read_unlock ( ) ; return ret ; } 