static struct dentry * hfs_file_lookup ( struct inode * dir , struct dentry * dentry , unsigned int flags ) { struct inode * inode = NULL ; hfs_cat_rec rec ; struct hfs_find_data fd ; int res ; if ( HFS_IS_RSRC ( dir ) || strcmp ( dentry -> d_name . name , "rsrc" ) ) { out } inode = HFS_I ( dir ) -> rsrc_inode ; if ( inode ) { out } inode = new_inode ( dir -> i_sb ) ; if ( ! inode ) { return ERR_PTR ( - ENOMEM ) ; } res = hfs_find_init ( HFS_SB ( dir -> i_sb ) -> cat_tree , & fd ) ; if ( res ) { iput ( inode ) ; return ERR_PTR ( res ) ; } fd . search_key -> cat = HFS_I ( dir ) -> cat_key ; res = hfs_brec_read ( & fd , & rec , sizeof ( rec ) ) ; if ( ! res ) { struct hfs_iget_data idata = { NULL & rec } ; hfs_read_inode ( inode , & idata ) ; } hfs_find_exit ( & fd ) ; if ( res ) { iput ( inode ) ; return ERR_PTR ( res ) ; } HFS_I ( inode ) -> rsrc_inode = dir ; HFS_I ( dir ) -> rsrc_inode = inode ; igrab ( dir ) ; inode_fake_hash ( inode , NULL ) ; mark_inode_dirty ( inode ) ; dont_mount ( dentry ) ; out return d_splice_alias ( inode , dentry ) ; } 