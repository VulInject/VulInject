static u32 qcaspi_write_legacy ( struct qcaspi * qca , u8 * src , u32 len ) { struct spi_message msg ; struct spi_transfer transfer ; int ret ; memset ( & transfer , 0 , sizeof ( transfer ) ) ; spi_message_init ( & msg ) ; transfer . tx_buf = src ; transfer . len = len ; spi_message_add_tail ( & transfer , & msg ) ; ret = spi_sync ( qca -> spi_dev , & msg ) ; if ( ret || ( msg . actual_length != len ) ) { qcaspi_spi_error ( qca , NULL ) ; return 0 ; } return len ; } 