static int dr_buddy_find_free_seg ( struct mlx5dr_icm_buddy_mem * buddy , unsigned int start_order , unsigned int * segment , unsigned int * order ) { unsigned int seg , order_iter , m ; for ( order_iter = start_order ; order_iter <= buddy -> max_order ; ++ order_iter ) { if ( ! buddy -> num_free [ order_iter ] ) { continue ; } m = 1 << ( buddy -> max_order - order_iter ) ; seg = find_first_bit ( buddy -> bitmap [ order_iter ] , m ) ; if ( WARN ( seg >= m , "ICM Buddy: failed finding free mem for order %d\n" , order_iter ) ) { return - ENOMEM ; } break ; } * segment = seg ; * order = order_iter ; return 0 ; } 