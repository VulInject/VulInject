static int lp50xx_probe ( struct i2c_client * client ) { struct lp50xx * led ; int count ; int ret ; count = device_get_child_node_count ( & client -> dev ) ; if ( ! count ) { dev_err ( & client -> dev , "LEDs are not defined in device tree!" ) ; return - ENODEV ; } led = devm_kzalloc ( & client -> dev , struct_size ( led , leds , count ) , GFP_KERNEL ) ; mutex_init ( & led -> lock ) ; led -> client = client ; led -> dev = & client -> dev ; led -> chip_info = device_get_match_data ( & client -> dev ) ; i2c_set_clientdata ( client , led ) ; led -> regmap = devm_regmap_init_i2c ( client , led -> chip_info -> lp50xx_regmap_config ) ; if ( IS_ERR ( led -> regmap ) ) { ret = PTR_ERR ( led -> regmap ) ; dev_err ( & client -> dev , "Failed to allocate register map: %d\n" , ret ) ; return ret ; } ret = lp50xx_reset ( led ) ; if ( ret ) { return ret ; } ret = lp50xx_enable_disable ( led , 1 ) ; if ( ret ) { return ret ; } return lp50xx_probe_dt ( led ) ; } 