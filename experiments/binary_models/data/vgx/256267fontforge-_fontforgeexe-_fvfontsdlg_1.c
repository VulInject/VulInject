void FVMergeFonts ( FontView * fv ) { GRect pos ; GWindow gw ; GWindowAttrs wattrs ; GGadgetCreateData gcd [ 7 ] , * varray [ 9 ] , * barray [ 8 ] , boxes [ 4 ] ; GTextInfo label [ 7 ] ; struct mf_data d ; char buffer [ 80 ] ; if ( fv_list == fv && fv_list -> b . next == NULL ) { MergeAskFilename ( fv , - 1 ) ; } else { wattrs . mask = wam_events | wam_cursor | wam_utf8_wtitle | wam_undercursor | wam_restrict | wam_isdlg ; wattrs . event_masks = ~ ( 1 << et_charup ) ; wattrs . restrict_input_to_me = 1 ; wattrs . is_dlg = 1 ; wattrs . undercursor = 1 ; wattrs . cursor = ct_pointer ; wattrs . utf8_window_title = _ ( "Merge Fonts" ) ; pos . x = pos . y = 0 ; pos . width = GGadgetScale ( GDrawPointsToPixels ( NULL , 150 ) ) ; pos . height = GDrawPointsToPixels ( NULL , 88 ) ; gw = GDrawCreateTopWindow ( NULL , & pos , mv_e_h , & d , & wattrs ) ; memset ( & label , 0 , sizeof ( label ) ) ; memset ( & gcd , 0 , sizeof ( gcd ) ) ; memset ( & boxes , 0 , sizeof ( boxes ) ) ; sprintf ( buffer , _ ( "Font to merge into %.20s" ) , fv -> b . sf -> fontname ) ; label [ 0 ] . text = ( unichar_t * ) buffer ; label [ 0 ] . text_is_1byte = true ; gcd [ 0 ] . gd . label = & label [ 0 ] ; gcd [ 0 ] . gd . pos . x = 12 ; gcd [ 0 ] . gd . pos . y = 6 ; gcd [ 0 ] . gd . flags = gg_visible | gg_enabled ; gcd [ 0 ] . creator = GLabelCreate ; varray [ 0 ] = & gcd [ 0 ] ; varray [ 1 ] = NULL ; gcd [ 1 ] . gd . pos . x = 15 ; gcd [ 1 ] . gd . pos . y = 21 ; gcd [ 1 ] . gd . pos . width = 120 ; gcd [ 1 ] . gd . flags = gg_visible | gg_enabled ; gcd [ 1 ] . gd . u . list = BuildFontList ( fv ) ; gcd [ 1 ] . gd . label = & gcd [ 1 ] . gd . u . list [ 0 ] ; gcd [ 1 ] . gd . u . list [ 0 ] . selected = true ; gcd [ 1 ] . creator = GListButtonCreate ; varray [ 2 ] = & gcd [ 1 ] ; varray [ 3 ] = NULL ; label [ 2 ] . text = ( unichar_t * ) _ ( "Preserve cross-font kerning" ) ; label [ 2 ] . text_is_1byte = true ; gcd [ 2 ] . gd . label = & label [ 2 ] ; gcd [ 2 ] . gd . pos . x = 12 ; gcd [ 2 ] . gd . pos . y = 6 ; gcd [ 2 ] . gd . flags = gg_visible | gg_enabled | gg_cb_on ; gcd [ 2 ] . gd . cid = CID_Preserve ; gcd [ 2 ] . creator = GCheckBoxCreate ; varray [ 4 ] = & gcd [ 2 ] ; varray [ 5 ] = NULL ; gcd [ 3 ] . gd . pos . x = 15 - 3 ; gcd [ 3 ] . gd . pos . y = 55 - 3 ; gcd [ 3 ] . gd . pos . width = - 1 ; gcd [ 3 ] . gd . pos . height = 0 ; gcd [ 3 ] . gd . flags = gg_visible | gg_enabled | gg_but_default ; label [ 3 ] . text = ( unichar_t * ) _ ( "_OK" ) ; label [ 3 ] . text_is_1byte = true ; label [ 3 ] . text_in_resource = true ; gcd [ 3 ] . gd . mnemonic = 'O' ; gcd [ 3 ] . gd . label = & label [ 3 ] ; gcd [ 3 ] . gd . handle_controlevent = MF_OK ; gcd [ 3 ] . creator = GButtonCreate ; gcd [ 4 ] . gd . pos . x = - 15 ; gcd [ 4 ] . gd . pos . y = 55 ; gcd [ 4 ] . gd . pos . width = - 1 ; gcd [ 4 ] . gd . pos . height = 0 ; gcd [ 4 ] . gd . flags = gg_visible | gg_enabled | gg_but_cancel ; label [ 4 ] . text = ( unichar_t * ) _ ( "_Cancel" ) ; label [ 4 ] . text_is_1byte = true ; label [ 4 ] . text_in_resource = true ; gcd [ 4 ] . gd . label = & label [ 4 ] ; gcd [ 4 ] . gd . mnemonic = 'C' ; gcd [ 4 ] . gd . handle_controlevent = MF_Cancel ; gcd [ 4 ] . creator = GButtonCreate ; barray [ 0 ] = barray [ 2 ] = barray [ 3 ] = barray [ 4 ] = barray [ 6 ] = GCD_Glue ; barray [ 7 ] = NULL ; barray [ 1 ] = & gcd [ 3 ] ; barray [ 5 ] = & gcd [ 4 ] ; boxes [ 2 ] . gd . flags = gg_enabled | gg_visible ; boxes [ 2 ] . gd . u . boxelements = barray ; boxes [ 2 ] . creator = GHBoxCreate ; varray [ 6 ] = & boxes [ 2 ] ; varray [ 7 ] = NULL ; varray [ 8 ] = NULL ; boxes [ 0 ] . gd . pos . x = boxes [ 0 ] . gd . pos . y = 2 ; boxes [ 0 ] . gd . flags = gg_enabled | gg_visible ; boxes [ 0 ] . gd . u . boxelements = varray ; boxes [ 0 ] . creator = GHVGroupCreate ; GGadgetsCreate ( gw , boxes ) ; GHVBoxSetExpandableCol ( boxes [ 2 ] . ret , gb_expandgluesame ) ; GHVBoxFitWindow ( boxes [ 0 ] . ret ) ; memset ( & d , '\0' , sizeof ( d ) ) ; d . other = gcd [ 1 ] . ret ; d . fv = fv ; GDrawSetVisible ( gw , true ) ; while ( ! d . done ) { GDrawProcessOneEvent ( NULL ) ; } GDrawDestroyWindow ( gw ) ; TFFree ( gcd [ 1 ] . gd . u . list ) ; } } 