struct clk * imx8m_clk_composite_flags ( const char * name , const char * const * parent_names , int num_parents , void __iomem * reg , unsigned long flags ) { struct clk * clk = ERR_PTR ( - ENOMEM ) ; struct clk_divider * div = NULL ; struct clk_gate * gate = NULL ; struct clk_mux * mux = NULL ; mux = kzalloc ( sizeof ( * mux ) , GFP_KERNEL ) ; if ( ! mux ) { fail } mux -> reg = reg ; mux -> shift = PCG_PCS_SHIFT ; mux -> mask = PCG_PCS_MASK ; mux -> num_parents = num_parents ; mux -> flags = flags ; mux -> parent_names = parent_names ; div = kzalloc ( sizeof ( * div ) , GFP_KERNEL ) ; if ( ! div ) { fail } div -> reg = reg ; div -> shift = PCG_PREDIV_SHIFT ; div -> width = PCG_PREDIV_WIDTH ; div -> flags = CLK_DIVIDER_ROUND_CLOSEST | flags ; gate = kzalloc ( sizeof ( * gate ) , GFP_KERNEL ) ; if ( ! gate ) { fail } gate -> reg = reg ; gate -> bit_idx = PCG_CGC_SHIFT ; gate -> flags = flags ; clk = clk_register_composite ( NULL , name , parent_names , num_parents , & mux -> clk , & clk_mux_ops , & div -> clk , & imx8m_clk_composite_divider_ops , & gate -> clk , & clk_gate_ops , flags ) ; if ( IS_ERR ( clk ) ) { fail } return clk ; fail kfree ( gate ) ; kfree ( mux ) ; return ERR_CAST ( clk ) ; } 