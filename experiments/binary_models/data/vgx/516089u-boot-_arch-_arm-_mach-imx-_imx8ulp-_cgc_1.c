u32 cgc_pll_pfd_div ( enum cgc_clk clk ) { void __iomem * base ; u32 pfd , index , gate , reg ; switch ( clk ) { case PLL3_PFD0_DIV1 : case PLL3_PFD0_DIV2 : base = & cgc1_regs -> pll3div_pfd0 ; pfd = PLL3_PFD0 ; index = clk - PLL3_PFD0_DIV1 ; break ; case PLL3_PFD1_DIV1 : case PLL3_PFD1_DIV2 : base = & cgc1_regs -> pll3div_pfd0 ; pfd = PLL3_PFD1 ; index = clk - PLL3_PFD0_DIV1 ; break ; case PLL3_PFD2_DIV1 : case PLL3_PFD2_DIV2 : base = & cgc1_regs -> pll3div_pfd1 ; pfd = PLL3_PFD2 ; index = clk - PLL3_PFD2_DIV1 ; break ; case PLL3_PFD3_DIV1 : case PLL3_PFD3_DIV2 : base = & cgc1_regs -> pll3div_pfd1 ; pfd = PLL3_PFD3 ; index = clk - PLL3_PFD2_DIV1 ; break ; case PLL4_PFD0_DIV1 : case PLL4_PFD0_DIV2 : base = & cgc2_regs -> pll4div_pfd0 ; pfd = PLL4_PFD0 ; index = clk - PLL4_PFD0_DIV1 ; break ; case PLL4_PFD1_DIV1 : case PLL4_PFD1_DIV2 : base = & cgc2_regs -> pll4div_pfd0 ; pfd = PLL4_PFD1 ; index = clk - PLL4_PFD0_DIV1 ; break ; case PLL4_PFD2_DIV1 : case PLL4_PFD2_DIV2 : base = & cgc2_regs -> pll4div_pfd1 ; pfd = PLL4_PFD2 ; index = clk - PLL4_PFD2_DIV1 ; break ; case PLL4_PFD3_DIV1 : case PLL4_PFD3_DIV2 : base = & cgc2_regs -> pll4div_pfd1 ; pfd = PLL4_PFD3 ; index = clk - PLL4_PFD2_DIV1 ; break ; default : return 0 ; } reg = readl ( base ) ; gate = reg & ( BIT ( 7 ) << ( index * 8 ) ) ; return cgc_pll_pfd_rate ( pfd ) / ( ( ( reg >> ( index * 8 ) ) & 0x3F ) + 1 ) ; } 