static int rk808_buck1_2_get_voltage_sel_regmap ( struct regulator_dev * rdev ) { struct rk808_regulator_data * pdata = rdev_get_drvdata ( rdev ) ; int id = rdev_get_id ( rdev ) ; struct gpio_desc * gpio = pdata -> dvs_gpio [ id ] ; int val ; int ret ; if ( ! gpio || gpiod_get_value ( gpio ) == 0 ) { return regulator_get_voltage_sel_regmap ( rdev ) ; } ret = regmap_read ( rdev -> regmap , rdev -> desc -> vsel_reg + RK808_DVS_REG_OFFSET , & val ) ; if ( ret != 0 ) { return ret ; } val &= rdev -> desc -> vsel_mask ; val >>= ffs ( rdev -> desc -> vsel_mask ) - 1 ; return val ; } 