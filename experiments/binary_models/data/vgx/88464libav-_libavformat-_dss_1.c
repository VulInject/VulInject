static int dss_read_metadata_string ( AVFormatContext * s , unsigned int offset , unsigned int size , const char * key ) { AVIOContext * pb = s -> pb ; char * value ; int ret ; avio_seek ( pb , offset , SEEK_SET ) ; value = av_mallocz ( size + 1 ) ; if ( ! value ) { return AVERROR ( ENOMEM ) ; } ret = avio_read ( s -> pb , value , size ) ; if ( ret < size ) { ret = ret < 0 ?ret : AVERROR_EOF ; exit } ret = av_dict_set ( & s -> metadata , key , value , 0 ) ; exit return ret ; } 