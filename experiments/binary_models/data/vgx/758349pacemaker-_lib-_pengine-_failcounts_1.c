static int generate_fail_regexes ( const pe_resource_t * rsc , const pe_working_set_t * data_set , regex_t * failcount_re , regex_t * lastfailure_re ) { char * rsc_name = rsc_fail_name ( rsc ) ; const char * version = crm_element_value ( data_set -> input , XML_ATTR_CRM_VERSION ) ; gboolean is_legacy = ( compare_version ( version , "3.0.13" ) < 0 ) ; int rc = pcmk_rc_ok ; if ( generate_fail_regex ( PCMK__FAIL_COUNT_PREFIX , rsc_name , is_legacy , pcmk_is_set ( rsc -> flags , pe_rsc_unique ) , failcount_re ) != pcmk_rc_ok ) { rc = EINVAL ; } if ( generate_fail_regex ( PCMK__LAST_FAILURE_PREFIX , rsc_name , is_legacy , pcmk_is_set ( rsc -> flags , pe_rsc_unique ) , lastfailure_re ) != pcmk_rc_ok ) { rc = EINVAL ; } free ( rsc_name ) ; return rc ; } 