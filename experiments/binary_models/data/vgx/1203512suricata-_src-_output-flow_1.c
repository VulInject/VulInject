TmEcode OutputFlowLogThreadInit ( ThreadVars * tv , void * initdata , void * * data ) { OutputFlowLoggerThreadData * td = SCMalloc ( sizeof ( * td ) ) ; if ( td == NULL ) { return TM_ECODE_FAILED ; } * data = ( void * ) td ; SCLogDebug ( "OutputFlowLogThreadInit happy (*data %p)" , * data ) ; OutputFlowLogger * logger = list ; while ( logger ) { if ( logger -> ThreadInit ) { void * retptr = NULL ; if ( logger -> ThreadInit ( tv , ( void * ) logger -> output_ctx , & retptr ) == TM_ECODE_OK ) { OutputLoggerThreadStore * ts = SCMalloc ( sizeof ( * ts ) ) ; BUG_ON ( ts == NULL ) ; memset ( ts , 0x00 , sizeof ( * ts ) ) ; ts -> thread_data = retptr ; if ( td -> store == NULL ) { td -> store = ts ; } else { OutputLoggerThreadStore * tmp = td -> store ; while ( tmp -> next != NULL ) { tmp = tmp -> next ; } tmp -> next = ts ; } SCLogDebug ( "%s is now set up" , logger -> name ) ; } } logger = logger -> next ; } return TM_ECODE_OK ; } 