static int flock_get_start ( vnode_t * vp , flock64_t * flp , offset_t offset , u_offset_t * start ) { struct vattr vattr ; int error ; switch ( flp -> l_whence ) { case 0 : * start = ( u_offset_t ) flp -> l_start ; break ; case 1 : * start = ( u_offset_t ) ( flp -> l_start + offset ) ; break ; case 2 : vattr . va_mask = AT_SIZE ; * start = ( u_offset_t ) ( flp -> l_start + ( offset_t ) vattr . va_size ) ; break ; default : return ( EINVAL ) ; } return ( 0 ) ; } 