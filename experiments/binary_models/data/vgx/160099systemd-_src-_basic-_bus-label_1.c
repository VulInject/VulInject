char * bus_label_escape ( const char * s ) { char * r , * t ; const char * f ; assert_return ( s , NULL ) ; if ( * s == 0 ) { return strdup ( "_" ) ; } r = new ( char , strlen ( s ) * 3 + 1 ) ; if ( ! r ) { return in ; } for ( f = s , t = r ; * f ; f ++ ) { if ( ! ascii_isalpha ( * f ) && ! ( f > s && ascii_isdigit ( * f ) ) ) { * ( t ++ ) = '_' ; * ( t ++ ) = hexchar ( * f >> 4 ) ; * ( t ++ ) = hexchar ( * f ) ; } else { * ( t ++ ) = * f ; } } * t = 0 ; return r ; } 