void iwn_rx_statistics ( struct iwn_softc * sc , struct iwn_rx_desc * desc , struct iwn_rx_data * data ) { struct iwn_ops * ops = & sc -> ops ; struct ieee80211com * ic = & sc -> sc_ic ; struct iwn_calib_state * calib = & sc -> calib ; struct iwn_stats * stats = ( iwn_stats * ) ( desc + 1 ) ; int temp ; if ( ic -> ic_state != IEEE80211_S_RUN ) { return ; } bus_dmamap_sync ( sc -> sc_dmat , data -> map , sizeof ( * desc ) , sizeof ( * stats ) , BUS_DMASYNC_POSTREAD ) ; DPRINTFN ( 3 , ( "received statistics (cmd=%d)\n" , desc -> type ) ) ; sc -> rx_stats_flags = htole32 ( stats -> flags ) ; if ( stats -> general . temp != sc -> rawtemp ) { sc -> rawtemp = stats -> general . temp ; temp = ops -> get_temperature ( sc ) ; DPRINTFN ( 2 , ( "temperature=%dC\n" , temp ) ) ; if ( sc -> hw_type == IWN_HW_REV_TYPE_4965 ) { iwn4965_power_calibration ( sc , temp ) ; } } if ( desc -> type != IWN_BEACON_STATISTICS ) { return ; } sc -> noise = iwn_get_noise ( & stats -> rx . general ) ; if ( sc -> noise == - 127 ) { return ; } if ( letoh32 ( stats -> rx . general . flags ) != 1 ) { DPRINTF ( ( "received statistics without RSSI\n" ) ) ; return ; } if ( sc -> hw_type == IWN_HW_REV_TYPE_6005 ) { return ; } if ( calib -> state == IWN_CALIB_STATE_ASSOC ) { iwn_collect_noise ( sc , & stats -> rx . general ) ; } if ( calib -> state == IWN_CALIB_STATE_RUN ) { iwn_tune_sensitivity ( sc , & stats -> rx ) ; } } 