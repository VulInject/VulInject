int socket_vop_getattr ( struct vnode * vp , struct vattr * vap , int flags , struct cred * cr , caller_context_t * ct ) { dev_t fsid ; struct sonode * so ; static int sonode_shift = 0 ; if ( sonode_shift == 0 ) { int bit = highbit ( sizeof ( sonode ) ) ; VERIFY3S ( bit , > , 0 ) ; sonode_shift = bit - 1 ; } so = VTOSO ( vp ) ; fsid = sockdev ; if ( so -> so_version == SOV_STREAM ) { vap -> va_type = VCHR ; vap -> va_mode = 0 ; } else { vap -> va_type = vp -> v_type ; vap -> va_mode = S_IRUSR | S_IWUSR | S_IRGRP | S_IWGRP | S_IROTH | S_IWOTH ; } vap -> va_uid = vap -> va_gid = 0 ; vap -> va_fsid = fsid ; vap -> va_nodeid = ( ( ino_t ) so >> sonode_shift ) & 0xFFFFFFFF ; vap -> va_size = 0 ; vap -> va_rdev = ( dev_t ) 0 ; vap -> va_blksize = MAXBSIZE ; vap -> va_nblocks = btod ( vap -> va_size ) ; if ( ! SOCK_IS_NONSTR ( so ) ) { sotpi_info_t * sti = SOTOTPI ( so ) ; mutex_enter ( & so -> so_lock ) ; vap -> va_atime . tv_sec = sti -> sti_atime ; vap -> va_mtime . tv_sec = sti -> sti_mtime ; vap -> va_ctime . tv_sec = sti -> sti_ctime ; mutex_exit ( & so -> so_lock ) ; } else { vap -> va_atime . tv_sec = 0 ; vap -> va_mtime . tv_sec = 0 ; vap -> va_ctime . tv_sec = 0 ; } vap -> va_atime . tv_nsec = 0 ; vap -> va_mtime . tv_nsec = 0 ; vap -> va_ctime . tv_nsec = 0 ; vap -> va_seq = 0 ; return ( 0 ) ; } 