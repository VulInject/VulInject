static int lxcDomainGetMemoryParameters ( virDomainPtr dom , virTypedParameterPtr params , int * nparams , unsigned int flags ) { virDomainDef * persistentDef = NULL ; virDomainDef * def = NULL ; virDomainObj * vm = NULL ; virLXCDomainObjPrivate * priv = NULL ; unsigned long long val ; int ret = - 1 ; int i ; virCheckFlags ( VIR_DOMAIN_AFFECT_LIVE | VIR_DOMAIN_AFFECT_CONFIG | VIR_TYPED_PARAM_STRING_OKAY , - 1 ) ; flags &= ~ VIR_TYPED_PARAM_STRING_OKAY ; if ( ! ( vm = lxcDomObjFromDomain ( dom ) ) ) { cleanup } priv = vm -> privateData ; if ( virDomainGetMemoryParametersEnsureACL ( dom -> conn , vm -> def ) < 0 ) { cleanup } if ( virDomainObjGetDefs ( vm , flags , & def , & persistentDef ) < 0 ) { cleanup } if ( def && ! virCgroupHasController ( priv -> cgroup , VIR_CGROUP_CONTROLLER_MEMORY ) ) { virReportError ( VIR_ERR_OPERATION_INVALID , "%s" , _ ( "cgroup memory controller is not mounted" ) ) ; cleanup } if ( ( * nparams ) == 0 ) { * nparams = LXC_NB_MEM_PARAM ; ret = 0 ; cleanup } for ( i = 0 ; i < LXC_NB_MEM_PARAM && i < * nparams ; i ++ ) { virTypedParameterPtr param = & params [ i ] ; val = 0 ; switch ( i ) { case 0 : if ( persistentDef ) { val = persistentDef -> mem . hard_limit ; } if ( virCgroupGetMemoryHardLimit ( priv -> cgroup , & val ) < 0 ) { cleanup } if ( virTypedParameterAssign ( param , VIR_DOMAIN_MEMORY_HARD_LIMIT , VIR_TYPED_PARAM_ULLONG , val ) < 0 ) { cleanup } break ; case 1 : if ( persistentDef ) { val = persistentDef -> mem . soft_limit ; } if ( virCgroupGetMemorySoftLimit ( priv -> cgroup , & val ) < 0 ) { cleanup } if ( virTypedParameterAssign ( param , VIR_DOMAIN_MEMORY_SOFT_LIMIT , VIR_TYPED_PARAM_ULLONG , val ) < 0 ) { cleanup } break ; case 2 : if ( persistentDef ) { val = persistentDef -> mem . swap_hard_limit ; } if ( virCgroupGetMemSwapHardLimit ( priv -> cgroup , & val ) < 0 ) { cleanup } if ( virTypedParameterAssign ( param , VIR_DOMAIN_MEMORY_SWAP_HARD_LIMIT , VIR_TYPED_PARAM_ULLONG , val ) < 0 ) { cleanup } break ; } } if ( * nparams > LXC_NB_MEM_PARAM ) { * nparams = LXC_NB_MEM_PARAM ; } ret = 0 ; cleanup virDomainObjEndAPI ( & vm ) ; return ret ; } 