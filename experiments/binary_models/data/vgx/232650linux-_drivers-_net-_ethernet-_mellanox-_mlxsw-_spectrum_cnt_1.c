static int mlxsw_sp_counter_sub_pools_init ( struct mlxsw_sp * mlxsw_sp ) { struct mlxsw_sp_counter_pool * pool = mlxsw_sp -> counter_pool ; struct devlink * devlink = priv_to_devlink ( mlxsw_sp -> core ) ; struct mlxsw_sp_counter_sub_pool * sub_pool ; unsigned int base_index = 0 ; enum mlxsw_res_id res_id ; int err ; int i ; for ( i = 0 ; i < pool -> sub_pools_count ; i ++ ) { sub_pool = & pool -> sub_pools [ i ] ; res_id = sub_pool -> entry_size_res_id ; sub_pool -> entry_size = mlxsw_core_res_get ( mlxsw_sp -> core , res_id ) ; err = devl_resource_size_get ( devlink , sub_pool -> resource_id , & sub_pool -> size ) ; if ( err ) { err_resource_size_get } devl_resource_occ_get_register ( devlink , sub_pool -> resource_id , mlxsw_sp_counter_sub_pool_occ_get , sub_pool ) ; sub_pool -> base_index = base_index ; base_index += sub_pool -> size ; atomic_set ( & sub_pool -> active_entries_count , 0 ) ; } return 0 ; err_resource_size_get for ( i -- ; i >= 0 ; i -- ) { sub_pool = & pool -> sub_pools [ i ] ; devl_resource_occ_get_unregister ( devlink , sub_pool -> resource_id ) ; } return err ; } 