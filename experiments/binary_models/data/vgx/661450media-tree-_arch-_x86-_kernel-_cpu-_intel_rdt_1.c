static inline bool cache_alloc_hsw_probe ( void ) { if ( boot_cpu_data . x86_vendor == X86_VENDOR_INTEL && boot_cpu_data . x86 == 6 && boot_cpu_data . x86_model == INTEL_FAM6_HASWELL_X ) { struct rdt_resource * r = & rdt_resources_all [ RDT_RESOURCE_L3 ] ; u32 l , h , max_cbm = BIT_MASK ( 20 ) - 1 ; if ( wrmsr_safe ( IA32_L3_CBM_BASE , max_cbm , 0 ) ) { return false ; } rdmsr ( IA32_L3_CBM_BASE , l , h ) ; r -> num_closid = 4 ; r -> default_ctrl = max_cbm ; r -> cache . cbm_len = 20 ; r -> cache . min_cbm_bits = 2 ; r -> capable = true ; r -> enabled = true ; return true ; } return false ; } 