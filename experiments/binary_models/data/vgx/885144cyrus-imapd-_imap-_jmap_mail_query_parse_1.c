HIDDEN void jmap_email_filter_parse ( json_t * filter , jmap_email_filter_parse_ctx_t * ctx ) { if ( ! JNOTNULL ( filter ) || json_typeof ( filter ) != JSON_OBJECT ) { ctx -> invalid_field ( ctx -> rock ) ; return ; } json_t * jop = json_object_get ( filter , "operator" ) ; if ( json_is_string ( jop ) ) { const char * op = json_string_value ( jop ) ; if ( strcmp ( "AND" , op ) && strcmp ( "OR" , op ) && strcmp ( "NOT" , op ) ) { ctx -> invalid_field ( "operator" , ctx -> rock ) ; } json_t * jconds = json_object_get ( filter , "conditions" ) ; size_t i ; json_t * jcond ; json_array_foreach ( , , ) { ctx -> path_push_index ( "conditions" , i , NULL , ctx -> rock ) ; jmap_email_filter_parse ( jcond , ctx ) ; ctx -> path_pop ( ctx -> rock ) ; } } if ( jop ) { ctx -> invalid_field ( "operator" , ctx -> rock ) ; } else { jmap_email_filtercondition_parse ( filter , ctx ) ; } } 