STATIC int xfs_rtallocate_extent_exact ( xfs_mount_t * mp , xfs_trans_t * tp , xfs_rtblock_t bno , xfs_extlen_t minlen , xfs_extlen_t maxlen , xfs_extlen_t * len , struct xfs_buf * * rbpp , xfs_fsblock_t * rsb , xfs_extlen_t prod , xfs_rtblock_t * rtblock ) { int error ; xfs_extlen_t i ; int isfree ; xfs_rtblock_t next ; ASSERT ( minlen % prod == 0 && maxlen % prod == 0 ) ; error = xfs_rtcheck_range ( mp , tp , bno , maxlen , 1 , & next , & isfree ) ; if ( isfree ) { error = xfs_rtallocate_range ( mp , tp , bno , maxlen , rbpp , rsb ) ; if ( error ) { return error ; } * len = maxlen ; * rtblock = bno ; return 0 ; } maxlen = next - bno ; if ( maxlen < minlen ) { * rtblock = NULLRTBLOCK ; return 0 ; } if ( prod > 1 && ( i = maxlen % prod ) ) { maxlen -= i ; if ( maxlen < minlen ) { * rtblock = NULLRTBLOCK ; return 0 ; } } error = xfs_rtallocate_range ( mp , tp , bno , maxlen , rbpp , rsb ) ; if ( error ) { return error ; } * len = maxlen ; * rtblock = bno ; return 0 ; } 