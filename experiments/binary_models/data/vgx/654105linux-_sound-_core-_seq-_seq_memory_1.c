int snd_seq_pool_done ( struct snd_seq_pool * pool ) { struct snd_seq_event_cell * ptr ; if ( waitqueue_active ( & pool -> output_sleep ) ) { wake_up ( & pool -> output_sleep ) ; } while ( atomic_read ( & pool -> counter ) > 0 ) { schedule_timeout_uninterruptible ( 1 ) ; } spin_lock_irq ( & pool -> lock ) ; ptr = pool -> ptr ; pool -> ptr = NULL ; pool -> free = NULL ; pool -> total_elements = 0 ; spin_unlock_irq ( & pool -> lock ) ; kvfree ( ptr ) ; spin_lock_irq ( & pool -> lock ) ; pool -> closing = 0 ; spin_unlock_irq ( & pool -> lock ) ; return 0 ; } 