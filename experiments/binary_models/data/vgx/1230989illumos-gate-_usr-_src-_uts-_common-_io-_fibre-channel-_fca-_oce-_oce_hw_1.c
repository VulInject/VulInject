int oce_setup_adapter ( struct oce_dev * dev ) { int ret ; char itbl [ OCE_ITBL_SIZE ] ; char hkey [ OCE_HKEY_SIZE ] ; oce_chip_di ( dev ) ; ret = oce_create_nw_interface ( dev ) ; ret = oce_create_queues ( dev ) ; if ( ret != DDI_SUCCESS ) { oce_delete_nw_interface ( dev ) ; return ( DDI_FAILURE ) ; } if ( dev -> rss_enable ) { ( void ) oce_create_itbl ( dev , itbl ) ; ( void ) oce_gen_hkey ( hkey , OCE_HKEY_SIZE ) ; ret = oce_config_rss ( dev , dev -> if_id , hkey , itbl , OCE_ITBL_SIZE , OCE_DEFAULT_RSS_TYPE , B_TRUE ) ; if ( ret != DDI_SUCCESS ) { oce_log ( dev , CE_NOTE , MOD_CONFIG , "%s" , "Failed to Configure RSS" ) ; oce_delete_queues ( dev ) ; oce_delete_nw_interface ( dev ) ; return ( ret ) ; } } ret = oce_setup_handlers ( dev ) ; if ( ret != DDI_SUCCESS ) { oce_log ( dev , CE_NOTE , MOD_CONFIG , "%s" , "Failed to Setup handlers" ) ; oce_delete_queues ( dev ) ; oce_delete_nw_interface ( dev ) ; return ( ret ) ; } return ( DDI_SUCCESS ) ; } 