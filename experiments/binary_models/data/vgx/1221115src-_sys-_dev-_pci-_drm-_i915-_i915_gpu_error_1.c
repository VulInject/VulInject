static struct intel_engine_capture_vma * capture_vma_snapshot ( struct intel_engine_capture_vma * next , struct i915_vma_resource * vma_res , gfp_t gfp , const char * name ) { struct intel_engine_capture_vma * c ; if ( ! vma_res ) { return next ; } c = kmalloc ( sizeof ( * c ) , gfp ) ; if ( ! i915_vma_resource_hold ( vma_res , & c -> lockdep_cookie ) ) { kfree ( c ) ; return next ; } strlcpy ( c -> name , name , sizeof ( c -> name ) ) ; c -> vma_res = i915_vma_resource_get ( vma_res ) ; c -> next = next ; return c ; } 