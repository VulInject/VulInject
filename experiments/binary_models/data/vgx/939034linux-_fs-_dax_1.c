static int copy_cow_page_dax ( struct vm_fault * vmf , const struct iomap_iter * iter ) { pgoff_t pgoff = dax_iomap_pgoff ( & iter -> iomap , iter -> pos ) ; void * vto , * kaddr ; long rc ; int id ; id = dax_read_lock ( ) ; rc = dax_direct_access ( iter -> iomap . dax_dev , pgoff , 1 , DAX_ACCESS , & kaddr , NULL ) ; if ( rc < 0 ) { dax_read_unlock ( id ) ; return rc ; } vto = kmap_atomic ( vmf -> cow_page , NULL ) ; copy_user_page ( vto , kaddr , vmf -> address , vmf -> cow_page ) ; kunmap_atomic ( vto ) ; dax_read_unlock ( id ) ; return 0 ; } 