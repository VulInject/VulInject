char * g_get_physical_name ( char * path ) { int stbuf ; char s [ MAXPATHLEN ] ; char namebuf [ MAXPATHLEN ] ; char savedir [ MAXPATHLEN ] ; char * result = NULL ; DIR * dirp ; struct dirent * entp ; char * dev_name , * char_ptr ; struct stat sb ; int found_flag = 0 ; int status = 0 ; int i ; if ( path == NULL ) { return ( NULL ) ; } ( void ) strcpy ( s , path ) ; status = stat ( s , & stbuf ) ; if ( ( ( status == - 1 ) && ( errno == ENOENT ) ) || ( ( s [ 0 ] == 'c' ) && ( ( int ) strlen ( s ) > 1 ) && ( ( int ) strlen ( s ) < 5 ) ) ) { if ( ( s [ 0 ] != 'c' ) || ( ( int ) strlen ( s ) <= 1 ) || ( ( int ) strlen ( s ) >= 5 ) ) { exit } for ( i = 1 ; i < ( int ) strlen ( s ) ; i ++ ) { if ( ( s [ i ] < '0' ) || ( s [ i ] > '9' ) ) { exit } } P_DPRINTF ( "  g_get_physical_name: " "Found entry of the form cN n=%s len=%d\n" , & s [ 1 ] , strlen ( s ) ) ; dev_name = g_zalloc ( sizeof ( "/dev/rdsk" ) ) ; sprintf ( ( char * ) dev_name , "/dev/rdsk" ) ; if ( ( dirp = opendir ( dev_name ) ) == NULL ) { g_destroy_data ( dev_name ) ; exit } while ( ( entp = readdir ( dirp ) ) != NULL ) { if ( strcmp ( entp -> d_name , "." ) == 0 || strcmp ( entp -> d_name , ".." ) == 0 ) { continue ; } if ( entp -> d_name [ 0 ] != 'c' ) { continue ; } sprintf ( namebuf , "%s/%s" , dev_name , entp -> d_name ) ; if ( ( lstat ( namebuf , & sb ) ) < 0 ) { L_WARNINGS ( MSGSTR ( 55 , "Warning: Cannot stat %s\n" ) , namebuf ) ; continue ; } if ( ! S_ISLNK ( sb . st_mode ) ) { L_WARNINGS ( MSGSTR ( 56 , "Warning: %s is not a symbolic link\n" ) , namebuf ) ; continue ; } if ( strstr ( entp -> d_name , s ) != NULL ) { if ( atoi ( & s [ 1 ] ) == atoi ( & entp -> d_name [ 1 ] ) ) { P_DPRINTF ( "  g_get_physical_name: " "Found entry in /dev/rdsk matching %s: %s\n" , s , entp -> d_name ) ; found_flag = 1 ; break ; } } } closedir ( dirp ) ; g_destroy_data ( dev_name ) ; if ( found_flag ) { result = g_get_physical_name_from_link ( namebuf ) ; if ( result == NULL ) { exit } char_ptr = strrchr ( result , '/' ) ; * char_ptr = '\0' ; ( void ) strcat ( result , CTLR_POSTFIX ) ; } exit } if ( status == - 1 ) { exit } if ( lstat ( s , & stbuf ) == - 1 ) { L_WARNINGS ( MSGSTR ( 134 , "%s: lstat() failed - %s\n" ) , s , strerror ( errno ) ) ; exit } if ( ! S_ISLNK ( stbuf . st_mode ) ) { if ( S_ISCHR ( stbuf . st_mode ) || S_ISDIR ( stbuf . st_mode ) ) { if ( strstr ( s , "/devices" ) ) { result = g_alloc_string ( s ) ; } else { if ( getcwd ( savedir , sizeof ( savedir ) ) == NULL ) { return ( NULL ) ; } if ( s [ 0 ] == '.' ) { strcat ( savedir , & s [ 1 ] ) ; } else { strcat ( savedir , "/" ) ; strcat ( savedir , s ) ; } result = g_alloc_string ( savedir ) ; } } } else { result = g_get_physical_name_from_link ( path ) ; } exit return ( result ) ; } 