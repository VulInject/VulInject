int nvkm_falcon_pio_rd ( struct nvkm_falcon * falcon , u8 port , enum nvkm_falcon_mem mem_type , u32 mem_base , const u8 * img , u32 img_base , int len ) { const struct nvkm_falcon_func_pio * pio = nvkm_falcon_pio ( falcon , & mem_type , & mem_base ) ; const char * type = nvkm_falcon_mem ( mem_type ) ; int xfer_len ; FLCN_DBG ( falcon , "%s %08x ->%08x bytes at %08x" , type , mem_base , len , img_base ) ; if ( WARN_ON ( ! len || ( len & ( pio -> min - 1 ) ) ) ) { return - EINVAL ; } pio -> rd_init ( falcon , port , mem_base ) ; { xfer_len = min ( len , pio -> max ) ; pio -> rd ( falcon , port , img , xfer_len ) ; if ( nvkm_printk_ok ( falcon -> owner , falcon -> user , NV_DBG_TRACE ) ) { for ( img_base = 0 ; img_base < xfer_len ; img_base += 4 , mem_base += 4 ) { if ( ( ( img_base / 4 ) % 8 ) == 0 ) { printk ( KERN_INFO "%s %08x ->" , type , mem_base ) ; } printk ( KERN_CONT " %08x" , * ( u32 * ) ( img + img_base ) ) ; } } img += xfer_len ; len -= xfer_len ; } len ; return 0 ; } 