static irqreturn_t gf100_fifo_intr ( struct nvkm_inth * inth ) { struct nvkm_fifo * fifo = container_of ( inth , typeof ( * fifo ) , engine . subdev . inth ) ; struct nvkm_subdev * subdev = & fifo -> engine . subdev ; struct nvkm_device * device = subdev -> device ; u32 mask = nvkm_rd32 ( device , 0x002140 ) ; u32 stat = nvkm_rd32 ( device , 0x002100 ) & mask ; if ( stat & 0x00000001 ) { u32 intr = nvkm_rd32 ( device , 0x00252c ) ; nvkm_warn ( subdev , "INTR 00000001: %08x\n" , intr ) ; nvkm_wr32 ( device , 0x002100 , 0x00000001 ) ; stat &= ~ 0x00000001 ; } if ( stat & 0x00000100 ) { gf100_fifo_intr_sched ( fifo , NULL ) ; nvkm_wr32 ( device , 0x002100 , 0x00000100 ) ; stat &= ~ 0x00000100 ; } if ( stat & 0x00010000 ) { u32 intr = nvkm_rd32 ( device , 0x00256c ) ; nvkm_warn ( subdev , "INTR 00010000: %08x\n" , intr ) ; nvkm_wr32 ( device , 0x002100 , 0x00010000 ) ; stat &= ~ 0x00010000 ; } if ( stat & 0x01000000 ) { u32 intr = nvkm_rd32 ( device , 0x00258c ) ; nvkm_warn ( subdev , "INTR 01000000: %08x\n" , intr ) ; nvkm_wr32 ( device , 0x002100 , 0x01000000 ) ; stat &= ~ 0x01000000 ; } if ( stat & 0x10000000 ) { gf100_fifo_intr_mmu_fault ( fifo ) ; stat &= ~ 0x10000000 ; } if ( stat & 0x20000000 ) { if ( gf100_fifo_intr_pbdma ( fifo ) ) { stat &= ~ 0x20000000 ; } } if ( stat & 0x40000000 ) { gf100_fifo_intr_runlist ( fifo ) ; stat &= ~ 0x40000000 ; } if ( stat & 0x80000000 ) { gf100_fifo_intr_engine ( fifo ) ; stat &= ~ 0x80000000 ; } if ( stat ) { nvkm_error ( subdev , "INTR %08x\n" , stat ) ; spin_lock ( & fifo -> lock ) ; nvkm_mask ( device , 0x002140 , stat , 0x00000000 ) ; spin_unlock ( & fifo -> lock ) ; nvkm_wr32 ( device , 0x002100 , stat ) ; } return IRQ_HANDLED ; } 