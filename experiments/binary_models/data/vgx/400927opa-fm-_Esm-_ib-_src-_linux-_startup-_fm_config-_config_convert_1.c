char * formatOldValue ( Ag_Man_t * sp , OldFormat_t format ) { static char buf [ 50 ] ; unsigned long long value ; unsigned long long value2 ; switch ( format ) { default : case FORMAT_NONE : return ( char * ) sp -> value ; case FORMAT_HEX : if ( FALSE == getOldUllValue ( sp , & value ) ) { return ( char * ) sp -> value ; } sprintf ( buf , "0x%Lx" , value ) ; return buf ; case FORMAT_DEC : if ( FALSE == getOldUllValue ( sp , & value ) ) { return ( char * ) sp -> value ; } snprintf ( buf , sizeof ( buf ) , "%Ld" , value ) ; return buf ; case FORMAT_MTU : if ( FALSE == getOldUllValue ( sp , & value ) ) { return ( char * ) sp -> value ; } snprintf ( buf , 50 , "%s" , IbMTUToText ( ( IB_MTU ) value ) ) ; return buf ; case FORMAT_RATE : if ( FALSE == getOldUllValue ( sp , & value ) ) { return ( char * ) sp -> value ; } if ( value == IB_STATIC_RATE_DONTCARE ) { return ( char * ) sp -> value ; } snprintf ( buf , sizeof ( buf ) , "%s" , StlStaticRateToText ( ( IB_STATIC_RATE ) value ) ) ; return buf ; case FORMAT_PLUS : if ( FALSE == getOldUllValue ( sp , & value ) ) { return ( char * ) sp -> value ; } snprintf ( buf , sizeof ( buf ) , "%lld" , value + 1 ) ; return buf ; case FORMAT_2N : case FORMAT_2NINF : if ( FALSE == getOldUllValue ( sp , & value ) ) { return ( char * ) sp -> value ; } if ( format == FORMAT_2NINF && value > IB_LIFETIME_MAX ) { return "infinite" ; } FormatTimeoutMult ( buf , value ) ; int s = 0 ; int d = 0 ; { if ( buf [ s ] != ' ' ) { buf [ d ++ ] = buf [ s ] ; } } buf [ s ++ ] ; return buf ; case FORMAT_GID : { char * p ; int s = 0 ; int d = 0 ; { if ( d >= sizeof ( buf ) ) { fprintf ( stderr , "WARNING: invalid value for %s_%d_%s=%s\n" , sp -> system , sp -> instance , sp -> key , sp -> value ) ; return ( char * ) sp -> value ; } if ( sp -> value [ s ] != ' ' ) { buf [ d ++ ] = sp -> value [ s ] ; } } sp -> value [ s ++ ] ; int len = strlen ( buf ) ; if ( len != 34 ) { fprintf ( stderr , "WARNING: invalid value for %s_%d_%s=%s\n" , sp -> system , sp -> instance , sp -> key , sp -> value ) ; return ( char * ) sp -> value ; } errno = 0 ; value2 = strtoull ( buf + 18 , & p , 16 ) ; if ( errno || * p ) { fprintf ( stderr , "WARNING invalid value for %s_%d_%s=%s\n" , sp -> system , sp -> instance , sp -> key , sp -> value ) ; return ( char * ) sp -> value ; } buf [ 18 ] = '\0' ; errno = 0 ; value = strtoull ( buf , & p , 16 ) ; if ( errno || * p ) { fprintf ( stderr , "WARNING invalid value for %s_%d_%s=%s\n" , sp -> system , sp -> instance , sp -> key , sp -> value ) ; return ( char * ) sp -> value ; } snprintf ( buf , sizeof ( buf ) , "0x%016llx:0x%016llx" , value , value2 ) ; return buf ; } } } 