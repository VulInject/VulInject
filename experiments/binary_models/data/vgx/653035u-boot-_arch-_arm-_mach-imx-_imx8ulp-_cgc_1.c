void cgc2_pll4_pfd_config ( enum cgc_clk pllpfd , u32 pfd ) { void __iomem * reg = & cgc2_regs -> pll4div_pfd0 ; u32 halt_mask = BIT ( 7 ) | BIT ( 15 ) ; u32 pfd_shift = ( pllpfd - PLL4_PFD0 ) * 8 ; u32 val ; if ( ( pllpfd - PLL4_PFD0 ) >> 1 ) { reg = & cgc2_regs -> pll4div_pfd1 ; } halt_mask = halt_mask << ( ( ( pllpfd - PLL4_PFD0 ) & 0x1 ) * 16 ) ; setbits_le32 ( reg , halt_mask ) ; setbits_le32 ( & cgc2_regs -> pll4pfdcfg , BIT ( 7 ) << pfd_shift ) ; val = readl ( & cgc2_regs -> pll4pfdcfg ) ; val &= ~ ( 0x3f << pfd_shift ) ; val |= ( pfd << pfd_shift ) ; writel ( val , & cgc2_regs -> pll4pfdcfg ) ; clrbits_le32 ( & cgc2_regs -> pll4pfdcfg , BIT ( 7 ) << pfd_shift ) ; while ( ( readl ( & cgc2_regs -> pll4pfdcfg ) & ( BIT ( 6 ) << pfd_shift ) ) != ( BIT ( 6 ) << pfd_shift ) ) { } clrbits_le32 ( reg , halt_mask ) ; } 