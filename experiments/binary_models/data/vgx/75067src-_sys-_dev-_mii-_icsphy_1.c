int icsphy_service ( struct mii_softc * sc , struct mii_data * mii , int cmd ) { struct ifmedia_entry * ife = mii -> mii_media . ifm_cur ; int reg ; if ( ( sc -> mii_dev . dv_flags & DVF_ACTIVE ) == 0 ) { return ( ENXIO ) ; } switch ( cmd ) { case MII_POLLSTAT : if ( IFM_INST ( ife -> ifm_media ) != sc -> mii_inst ) { return ( 0 ) ; } break ; case MII_MEDIACHG : if ( IFM_INST ( ife -> ifm_media ) != sc -> mii_inst ) { reg = PHY_READ ( sc , MII_BMCR ) ; PHY_WRITE ( sc , MII_BMCR , reg | BMCR_ISO ) ; return ( 0 ) ; } if ( ( mii -> mii_ifp -> if_flags & IFF_UP ) == 0 ) { break ; } mii_phy_setmedia ( sc ) ; break ; case MII_TICK : if ( IFM_INST ( ife -> ifm_media ) != sc -> mii_inst ) { return ( 0 ) ; } if ( mii_phy_tick ( sc ) == EJUSTRETURN ) { return ( 0 ) ; } break ; case MII_DOWN : mii_phy_down ( sc , NULL ) ; return ( 0 ) ; } mii_phy_status ( sc ) ; mii_phy_update ( sc , cmd ) ; return ( 0 ) ; } 