static int __init stm32_timer_init ( struct device_node * node ) { struct reset_control * rstc ; struct timer_of * to ; int ret ; to = kzalloc ( sizeof ( * to ) , GFP_KERNEL ) ; if ( ! to ) { return - ENOMEM ; } to -> flags = TIMER_OF_IRQ | TIMER_OF_CLOCK | TIMER_OF_BASE ; to -> of_irq . handler = stm32_clock_event_handler ; ret = timer_of_init ( node , to ) ; if ( ret ) { err } to -> private_data = kzalloc ( sizeof ( stm32_timer_private ) , GFP_KERNEL ) ; if ( ! to -> private_data ) { ret = - ENOMEM ; deinit } rstc = of_reset_control_get ( node , NULL ) ; if ( ! IS_ERR ( rstc ) ) { reset_control_deassert ( rstc ) ; } stm32_timer_set_width ( to ) ; stm32_timer_set_prescaler ( to ) ; ret = stm32_clocksource_init ( to ) ; if ( ret ) { deinit } stm32_clockevent_init ( to ) ; return 0 ; deinit timer_of_cleanup ( to ) ; err kfree ( to ) ; return ret ; } 