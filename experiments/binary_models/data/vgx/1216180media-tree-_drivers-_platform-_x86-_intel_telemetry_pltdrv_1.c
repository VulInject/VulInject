static int telemetry_plt_set_trace_verbosity ( enum telemetry_unit telem_unit , u32 verbosity ) { int temp = 0 ; int ret ; verbosity &= TELEM_TRC_VERBOSITY_MASK ; mutex_lock ( & ( telm_conf -> telem_trace_lock ) ) ; switch ( telem_unit ) { case TELEM_PSS : ret = intel_punit_ipc_command ( IPC_PUNIT_BIOS_READ_TELE_TRACE_CTRL , 0 , 0 , NULL , & temp ) ; if ( ret ) { pr_err ( "PSS TRACE_CTRL Read Failed\n" ) ; out } TELEM_CLEAR_VERBOSITY_BITS ( temp ) ; TELEM_SET_VERBOSITY_BITS ( temp , verbosity ) ; ret = intel_punit_ipc_command ( IPC_PUNIT_BIOS_WRITE_TELE_TRACE_CTRL , 0 , 0 , & temp , NULL ) ; if ( ret ) { pr_err ( "PSS TRACE_CTRL Verbosity Set Failed\n" ) ; out } break ; case TELEM_IOSS : ret = intel_pmc_ipc_command ( PMC_IPC_PMC_TELEMTRY , IOSS_TELEM_TRACE_CTL_READ , NULL , 0 , & temp , IOSS_TELEM_READ_WORD ) ; if ( ret ) { pr_err ( "IOSS TRACE_CTL Read Failed\n" ) ; out } TELEM_CLEAR_VERBOSITY_BITS ( temp ) ; TELEM_SET_VERBOSITY_BITS ( temp , verbosity ) ; ret = intel_pmc_ipc_command ( PMC_IPC_PMC_TELEMTRY , IOSS_TELEM_TRACE_CTL_WRITE , ( u8 * ) & temp , IOSS_TELEM_WRITE_FOURBYTES , NULL , 0 ) ; if ( ret ) { pr_err ( "IOSS TRACE_CTL Verbosity Set Failed\n" ) ; out } break ; default : pr_err ( "Unknown Telemetry Unit Specified %d\n" , telem_unit ) ; ret = - EINVAL ; break ; } out mutex_unlock ( & ( telm_conf -> telem_trace_lock ) ) ; return ret ; } static const struct telemetry_core_ops telm_pltops = { . get_trace_verbosity = telemetry_plt_get_trace_verbosity . set_trace_verbosity = telemetry_plt_set_trace_verbosity . set_sampling_period = telemetry_plt_set_sampling_period . get_sampling_period = telemetry_plt_get_sampling_period . raw_read_eventlog = telemetry_plt_raw_read_eventlog . get_eventconfig = telemetry_plt_get_eventconfig . update_events = telemetry_plt_update_events . read_eventlog = telemetry_plt_read_eventlog . reset_events = telemetry_plt_reset_events . add_events = telemetry_plt_add_events } ; 