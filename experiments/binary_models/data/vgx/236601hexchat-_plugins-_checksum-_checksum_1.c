sha256_from_file ( , ) { GFileInputStream * file_stream ; char * filename_fs ; GFile * file ; filename_fs = g_filename_from_utf8 ( filename , - 1 , NULL , NULL , NULL ) ; if ( ! filename_fs ) { hexchat_printf ( ph , "Checksum: Invalid filename (%s)\n" , filename ) ; return FALSE ; } file = g_file_new_for_path ( filename_fs ) ; if ( ! file ) { hexchat_printf ( ph , "Checksum: Failed to open %s\n" , filename ) ; return FALSE ; } if ( ! check_limit ( file ) ) { hexchat_printf ( ph , "Checksum: %s is larger than size limit. You can increase it with /CHECKSUM SET.\n" , filename ) ; g_object_unref ( file ) ; return FALSE ; } file_stream = g_file_read ( file , NULL , NULL ) ; if ( ! file_stream ) { hexchat_printf ( ph , "Checksum: Failed to read file %s\n" , filename ) ; g_object_unref ( file ) ; return FALSE ; } if ( ! sha256_from_stream ( file_stream , out_buf ) ) { hexchat_printf ( ph , "Checksum: Failed to generate checksum for %s\n" , filename ) ; g_object_unref ( file_stream ) ; g_object_unref ( file ) ; return FALSE ; } g_object_unref ( file_stream ) ; g_object_unref ( file ) ; return TRUE ; } 