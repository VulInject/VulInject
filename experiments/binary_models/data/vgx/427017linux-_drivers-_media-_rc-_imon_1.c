static ssize_t imon_clock_show ( struct device * d , struct device_attribute * attr , char * buf ) { struct imon_context * ictx = dev_get_drvdata ( d ) ; size_t len ; mutex_lock ( & ictx -> lock ) ; if ( ! ictx -> display_supported ) { len = snprintf ( buf , PAGE_SIZE , "Not supported." ) ; } else { len = snprintf ( buf , PAGE_SIZE , "To set the clock on your iMON display:\n" "# date \"+%%y %%m %%d %%w %%H %%M %%S\">imon_clock\n" "%s" , ictx -> display_isopen ?"\nNOTE: imon device must be closed\n" : "" ) ; } mutex_unlock ( & ictx -> lock ) ; return len ; } 