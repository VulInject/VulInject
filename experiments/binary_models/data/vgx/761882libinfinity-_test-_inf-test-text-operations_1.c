static gboolean test_undo ( InfAdoptedOperation * op , InfAdoptedUser * user , GError * * error ) { InfTextBuffer * first ; InfTextBuffer * second ; InfAdoptedOperation * reverted ; InfTextChunk * first_chunk ; InfTextChunk * second_chunk ; int result ; first = INF_TEXT_BUFFER ( inf_text_default_buffer_new ( "UTF-8" ) ) ; inf_text_buffer_insert_text ( first , 0 , EXAMPLE_DOCUMENT , strlen ( EXAMPLE_DOCUMENT ) , strlen ( EXAMPLE_DOCUMENT ) , NULL ) ; second = INF_TEXT_BUFFER ( inf_text_default_buffer_new ( "UTF-8" ) ) ; inf_text_buffer_insert_text ( second , 0 , EXAMPLE_DOCUMENT , strlen ( EXAMPLE_DOCUMENT ) , strlen ( EXAMPLE_DOCUMENT ) , NULL ) ; if ( ! inf_adopted_operation_apply ( op , user , INF_BUFFER ( first ) , error ) ) { g_object_unref ( first ) ; g_object_unref ( second ) ; return FALSE ; } reverted = inf_adopted_operation_revert ( op ) ; if ( ! inf_adopted_operation_apply ( reverted , user , INF_BUFFER ( first ) , error ) ) { g_object_unref ( first ) ; g_object_unref ( second ) ; g_object_unref ( reverted ) ; return FALSE ; } g_object_unref ( reverted ) ; first_chunk = inf_text_buffer_get_slice ( INF_TEXT_BUFFER ( first ) , 0 , inf_text_buffer_get_length ( INF_TEXT_BUFFER ( first ) ) ) ; second_chunk = inf_text_buffer_get_slice ( INF_TEXT_BUFFER ( second ) , 0 , inf_text_buffer_get_length ( INF_TEXT_BUFFER ( second ) ) ) ; result = inf_text_chunk_equal ( first_chunk , second_chunk ) ; inf_text_chunk_free ( second_chunk ) ; g_object_unref ( first ) ; g_object_unref ( second ) ; return result ; } 