static int spinand_init_cfg_cache ( struct spinand_device * spinand ) { struct nand_device * nand = spinand_to_nand ( spinand ) ; struct udevice * dev = spinand -> slave -> dev ; unsigned int target ; int ret ; spinand -> cfg_cache = devm_kzalloc ( dev , sizeof ( * spinand -> cfg_cache ) * nand -> memorg . ntargets , GFP_KERNEL ) ; for ( target = 0 ; target < nand -> memorg . ntargets ; target ++ ) { ret = spinand_select_target ( spinand , target ) ; if ( ret ) { return ret ; } ret = spinand_read_reg_op ( spinand , REG_CFG , & spinand -> cfg_cache [ target ] ) ; if ( ret ) { return ret ; } } return 0 ; } 