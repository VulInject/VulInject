static int copy_compat_shminfo_to_user ( void __user * buf , struct shminfo64 * in , int version ) { if ( in -> shmmax > INT_MAX ) { in -> shmmax = INT_MAX ; } if ( version == IPC_64 ) { struct compat_shminfo64 info ; info . shmmax = in -> shmmax ; info . shmmin = in -> shmmin ; info . shmmni = in -> shmmni ; info . shmseg = in -> shmseg ; info . shmall = in -> shmall ; return copy_to_user ( buf , & info , sizeof ( info ) ) ; } else { struct shminfo info ; memset ( & info , 0 , sizeof ( info ) ) ; info . shmmax = in -> shmmax ; info . shmmin = in -> shmmin ; info . shmmni = in -> shmmni ; info . shmseg = in -> shmseg ; info . shmall = in -> shmall ; return copy_to_user ( buf , & info , sizeof ( info ) ) ; } } 