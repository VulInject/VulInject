size_t M_sql_connpool_active_conns ( M_sql_connpool_t * pool , M_bool readonly ) { size_t cnt ; M_sql_connpool_data_t * pool_data ; M_thread_mutex_lock ( pool -> lock ) ; if ( readonly ) { pool_data = & pool -> pool_readonly ; } else { pool_data = & pool -> pool_primary ; } cnt = M_llist_len ( pool_data -> conns ) + M_queue_len ( pool_data -> used_conns ) ; M_thread_mutex_unlock ( pool -> lock ) ; return cnt ; } 