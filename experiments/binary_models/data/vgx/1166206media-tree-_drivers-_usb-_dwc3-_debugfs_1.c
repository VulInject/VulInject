static int dwc3_link_state_show ( struct seq_file * s , void * unused ) { struct dwc3 * dwc = s -> private ; unsigned long flags ; enum dwc3_link_state state ; int reg ; spin_lock_irqsave ( & dwc -> lock , flags ) ; reg = dwc3_readl ( dwc -> regs , DWC3_DSTS ) ; state = DWC3_DSTS_USBLNKST ( reg ) ; spin_unlock_irqrestore ( & dwc -> lock , flags ) ; seq_printf ( s , "%s\n" , dwc3_gadget_link_string ( state ) ) ; return 0 ; } 