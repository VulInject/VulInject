struct afs_volume * afs_create_volume ( struct afs_fs_context * params ) { struct afs_vldb_entry * vldb ; struct afs_volume * volume ; cfs_time_t type_mask = 1UL << params -> type ; vldb = afs_vl_lookup_vldb ( params -> cell , params -> key , params -> volname , params -> volnamesz ) ; if ( IS_ERR ( vldb ) ) { return ERR_CAST ( vldb ) ; } if ( test_bit ( AFS_VLDB_QUERY_ERROR , & vldb -> flags ) ) { volume = ERR_PTR ( vldb -> error ) ; error } volume = ERR_PTR ( - ENOMEDIUM ) ; if ( params -> force ) { if ( ! ( vldb -> flags & type_mask ) ) { error } } if ( test_bit ( AFS_VLDB_HAS_RO , & vldb -> flags ) ) { params -> type = AFSVL_ROVOL ; } if ( test_bit ( AFS_VLDB_HAS_RW , & vldb -> flags ) ) { params -> type = AFSVL_RWVOL ; } else { error } type_mask = 1UL << params -> type ; volume = afs_lookup_volume ( params , vldb , type_mask ) ; error kfree ( vldb ) ; return volume ; } 