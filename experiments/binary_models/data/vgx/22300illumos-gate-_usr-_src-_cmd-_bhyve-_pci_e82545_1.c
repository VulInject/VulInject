static void e82545_reset ( struct e82545_softc * sc , int drvr ) { int i ; e82545_rx_disable ( sc ) ; e82545_tx_disable ( sc ) ; if ( sc -> esc_irq_asserted ) { pci_lintr_deassert ( sc -> esc_pi ) ; } if ( ! drvr ) { sc -> esc_FCAL = 0 ; sc -> esc_FCAH = 0 ; sc -> esc_FCT = 0 ; sc -> esc_VET = 0 ; sc -> esc_FCTTV = 0 ; } sc -> esc_LEDCTL = 0x07061302 ; sc -> esc_PBA = 0x00100030 ; sc -> nvm_opaddr = 0 ; sc -> nvm_mode = E82545_NVM_MODE_OPADDR ; sc -> nvm_bits = E82545_NVM_OPADDR_BITS ; sc -> eeprom_control = E1000_EECD_PRES | E82545_EECD_FWE_EN ; e82545_init_eeprom ( sc ) ; sc -> esc_ICR = 0 ; sc -> esc_ITR = 250 ; sc -> esc_ICS = 0 ; sc -> esc_IMS = 0 ; sc -> esc_IMC = 0 ; if ( ! drvr ) { memset ( sc -> esc_fmcast , 0 , sizeof ( sc -> esc_fmcast ) ) ; memset ( sc -> esc_uni , 0 , sizeof ( sc -> esc_uni ) ) ; sc -> esc_uni [ 0 ] . eu_valid = 1 ; memcpy ( sc -> esc_uni [ 0 ] . eu_eth . octet , sc -> esc_mac . octet , ETHER_ADDR_LEN ) ; } else { for ( i = 0 ; i < 16 ; i ++ ) { sc -> esc_uni [ i ] . eu_valid = 0 ; } } if ( ! drvr ) { sc -> esc_RDBAL = 0 ; sc -> esc_RDBAH = 0 ; } sc -> esc_RCTL = 0 ; sc -> esc_FCRTL = 0 ; sc -> esc_FCRTH = 0 ; sc -> esc_RDLEN = 0 ; sc -> esc_RDH = 0 ; sc -> esc_RDT = 0 ; sc -> esc_RDTR = 0 ; sc -> esc_RXDCTL = ( 1 << 24 ) | ( 1 << 16 ) ; sc -> esc_RADV = 0 ; sc -> esc_RXCSUM = 0 ; if ( ! drvr ) { sc -> esc_TDBAL = 0 ; sc -> esc_TDBAH = 0 ; sc -> esc_TIPG = 0 ; sc -> esc_AIT = 0 ; sc -> esc_TIDV = 0 ; sc -> esc_TADV = 0 ; } sc -> esc_tdba = 0 ; sc -> esc_txdesc = NULL ; sc -> esc_TXCW = 0 ; sc -> esc_TCTL = 0 ; sc -> esc_TDLEN = 0 ; sc -> esc_TDT = 0 ; sc -> esc_TDHr = sc -> esc_TDH = 0 ; sc -> esc_TXDCTL = 0 ; } 