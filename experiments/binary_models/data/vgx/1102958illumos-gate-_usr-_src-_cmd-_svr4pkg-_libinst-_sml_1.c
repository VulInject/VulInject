static int _smlWriteSimpleTag ( char * * a_str , SML_TAG * tag ) { int r ; int k ; char * ns ; char * np0 ; char * np1 ; if ( tag == NULL ) { return ( RESULT_OK ) ; } if ( * a_str == NULL ) { * a_str = strdup ( "" ) ; } if ( tag -> params_num == 0 ) { if ( tag -> tags_num == 0 ) { ns = sml_strPrintf ( "%s<%s/>\n" , * a_str , tag -> name ) ; free ( * a_str ) ; * a_str = ns ; return ( RESULT_OK ) ; } else { ns = sml_strPrintf ( "%s<%s>\n" , * a_str , tag -> name ) ; if ( ns == NULL ) { return ( RESULT_ERR ) ; } free ( * a_str ) ; * a_str = ns ; } } else { ns = sml_strPrintf ( "%s<%s %s=" , * a_str ?* a_str : "" , tag -> name , tag -> params [ 0 ] . name ) ; if ( ns == NULL ) { return ( RESULT_ERR ) ; } free ( * a_str ) ; * a_str = ns ; np0 = NULL ; r = _smlWriteParamValue ( & np0 , tag -> params [ 0 ] . value ) ; if ( ( np0 == NULL ) || ( r != RESULT_OK ) ) { return ( RESULT_ERR ) ; } ns = sml_strPrintf ( "%s%s" , * a_str , np0 ) ; if ( ns == NULL ) { return ( RESULT_ERR ) ; } free ( * a_str ) ; * a_str = ns ; for ( k = 1 ; k < tag -> params_num ; k ++ ) { np0 = sml_strPrintf ( " %s=" , tag -> params [ k ] . name ) ; if ( np0 == NULL ) { return ( RESULT_ERR ) ; } np1 = NULL ; r = _smlWriteParamValue ( & np1 , tag -> params [ k ] . value ) ; if ( ( np1 == NULL ) || ( r != RESULT_OK ) ) { return ( RESULT_ERR ) ; } ns = sml_strPrintf ( "%s%s%s" , * a_str , np0 , np1 ) ; if ( ns == NULL ) { return ( RESULT_ERR ) ; } free ( np0 ) ; free ( np1 ) ; free ( * a_str ) ; * a_str = ns ; } if ( tag -> tags_num == 0 ) { np0 = sml_strPrintf ( "/>\n" ) ; if ( np0 == NULL ) { return ( RESULT_ERR ) ; } ns = sml_strPrintf ( "%s%s" , * a_str , np0 ) ; if ( ns == NULL ) { return ( RESULT_ERR ) ; } free ( np0 ) ; free ( * a_str ) ; * a_str = ns ; } else { np0 = sml_strPrintf ( ">\n" ) ; if ( np0 == NULL ) { return ( RESULT_ERR ) ; } ns = sml_strPrintf ( "%s%s" , * a_str , np0 ) ; if ( ns == NULL ) { return ( RESULT_ERR ) ; } free ( np0 ) ; free ( * a_str ) ; * a_str = ns ; } } for ( k = 0 ; k < tag -> tags_num ; k ++ ) { r = _smlWriteSimpleTag ( a_str , & ( tag -> tags [ k ] ) ) ; if ( r != RESULT_OK ) { return ( r ) ; } } if ( tag -> tags_num > 0 ) { np0 = sml_strPrintf ( "</%s>\n" , tag -> name ) ; if ( np0 == NULL ) { return ( RESULT_ERR ) ; } ns = sml_strPrintf ( "%s%s" , * a_str ?* a_str : "" , np0 ) ; if ( ns == NULL ) { return ( RESULT_ERR ) ; } free ( np0 ) ; free ( * a_str ) ; * a_str = ns ; } return ( RESULT_OK ) ; } 