static avifResult readFromCtx ( avifIO * io , uint32_t readFlags , uint64_t offset , size_t size , avifROData * out ) { gdIOCtx * ctx = ( gdIOCtx * ) io -> data ; avifIOCtxReader * reader = ( avifIOCtxReader * ) io ; if ( readFlags != 0 ) { return AVIF_RESULT_IO_ERROR ; } if ( ! ctx -> seek ( ctx , ( int ) offset ) ) { return AVIF_RESULT_IO_ERROR ; } if ( size > reader -> rodata . size ) { reader -> rodata . data = gdRealloc ( ( void * ) reader -> rodata . data , size ) ; reader -> rodata . size = size ; } if ( ! reader -> rodata . data ) { gd_error ( "avif error - couldn't allocate memory" ) ; return AVIF_RESULT_UNKNOWN_ERROR ; } int charsRead = ctx -> getBuf ( ctx , ( void * ) reader -> rodata . data , ( int ) size ) ; if ( charsRead < 0 ) { return AVIF_RESULT_IO_ERROR ; } out -> data = reader -> rodata . data ; out -> size = charsRead ; return AVIF_RESULT_OK ; } 