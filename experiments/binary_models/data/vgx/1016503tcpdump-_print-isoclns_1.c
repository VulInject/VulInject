static int isis_print_mt_port_cap_subtlv ( netdissect_options * ndo , const uint8_t * tptr , u_int len ) { u_int stlv_type , stlv_len ; const struct isis_subtlv_spb_mcid * subtlv_spb_mcid ; int i ; while ( len > 2 ) { stlv_type = GET_U_1 ( tptr ) ; stlv_len = GET_U_1 ( tptr + 1 ) ; ND_PRINT ( "\n\t       %s subTLV #%u, length: %u" , tok2str ( isis_mt_port_cap_subtlv_values , "unknown" , stlv_type ) , stlv_type , stlv_len ) ; tptr += 2 ; len -= 2 ; if ( len < stlv_len ) { subtlv_too_long } ND_TCHECK_LEN ( tptr , stlv_len ) ; switch ( stlv_type ) { case ISIS_SUBTLV_SPB_MCID : { if ( stlv_len < ISIS_SUBTLV_SPB_MCID_MIN_LEN ) { subtlv_too_short } subtlv_spb_mcid = ( const isis_subtlv_spb_mcid * ) tptr ; ND_PRINT ( "\n\t         MCID: " ) ; isis_print_mcid ( ndo , & ( subtlv_spb_mcid -> mcid ) ) ; ND_PRINT ( "\n\t         AUX-MCID: " ) ; isis_print_mcid ( ndo , & ( subtlv_spb_mcid -> aux_mcid ) ) ; tptr += ISIS_SUBTLV_SPB_MCID_MIN_LEN ; len -= ISIS_SUBTLV_SPB_MCID_MIN_LEN ; stlv_len -= ISIS_SUBTLV_SPB_MCID_MIN_LEN ; break ; } case ISIS_SUBTLV_SPB_DIGEST : { if ( stlv_len < ISIS_SUBTLV_SPB_DIGEST_MIN_LEN ) { subtlv_too_short } ND_PRINT ( "\n\t        RES: %u V: %u A: %u D: %u" , ( GET_U_1 ( tptr ) >> 5 ) , ( ( GET_U_1 ( tptr ) >> 4 ) & 0x01 ) , ( ( GET_U_1 ( tptr ) >> 2 ) & 0x03 ) , ( GET_U_1 ( tptr ) & 0x03 ) ) ; tptr ++ ; ND_PRINT ( "\n\t         Digest: " ) ; for ( i = 1 ; i <= 8 ; i ++ ) { ND_PRINT ( "%08x " , GET_BE_U_4 ( tptr ) ) ; if ( i % 4 == 0 && i != 8 ) { ND_PRINT ( "\n\t                 " ) ; } tptr += 4 ; } len -= ISIS_SUBTLV_SPB_DIGEST_MIN_LEN ; stlv_len -= ISIS_SUBTLV_SPB_DIGEST_MIN_LEN ; break ; } case ISIS_SUBTLV_SPB_BVID : { while ( stlv_len != 0 ) { if ( stlv_len < 4 ) { subtlv_too_short } ND_PRINT ( "\n\t           ECT: %08x" , GET_BE_U_4 ( tptr ) ) ; tptr += 4 ; len -= 4 ; stlv_len -= 4 ; if ( stlv_len < 2 ) { subtlv_too_short } ND_PRINT ( " BVID: %u, U:%01x M:%01x " , ( GET_BE_U_2 ( tptr ) >> 4 ) , ( GET_BE_U_2 ( tptr ) >> 3 ) & 0x01 , ( GET_BE_U_2 ( tptr ) >> 2 ) & 0x01 ) ; tptr += 2 ; len -= 2 ; stlv_len -= 2 ; } break ; } default : break ; } tptr += stlv_len ; len -= stlv_len ; } return ( 0 ) ; trunc nd_print_trunc ( ndo ) ; return ( 1 ) ; subtlv_too_long ND_PRINT ( " (>containing TLV length)" ) ; return ( 1 ) ; subtlv_too_short ND_PRINT ( " (too short)" ) ; return ( 1 ) ; } 