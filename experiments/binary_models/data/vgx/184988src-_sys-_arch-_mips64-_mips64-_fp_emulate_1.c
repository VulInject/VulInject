int fpu_int_l ( struct proc * p , struct trapframe * tf , uint fmt , uint ft , uint fs , uint fd , uint rm ) { uint64_t raw ; uint32_t oldrm ; if ( ft != 0 ) { return SIGILL ; } raw = fpu_load ( p , tf , fmt , fs ) ; oldrm = tf -> fsr & FPCSR_RM_MASK ; tf -> fsr = ( tf -> fsr & ~ FPCSR_RM_MASK ) | rm ; if ( fmt == FMT_S ) { raw = float32_to_int64 ( ( float32 ) raw ) ; } else { raw = float64_to_int64 ( ( float64 ) raw ) ; } tf -> fsr = ( tf -> fsr & ~ FPCSR_RM_MASK ) | oldrm ; if ( ( tf -> fsr & ( FPCSR_C_V | FPCSR_E_V ) ) != ( FPCSR_C_V | FPCSR_E_V ) ) { fpu_store ( p , tf , fmt , fd , raw ) ; } return 0 ; } 