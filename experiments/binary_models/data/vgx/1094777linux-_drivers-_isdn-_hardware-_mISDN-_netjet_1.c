static int nj_probe ( struct pci_dev * pdev , const struct pci_device_id * ent ) { int err = - ENOMEM ; int cfg ; struct tiger_hw * card ; if ( pdev -> subsystem_vendor == 0x8086 && pdev -> subsystem_device == 0x0003 ) { pr_notice ( "Netjet: Digium X100P/X101P not handled\n" ) ; return - ENODEV ; } if ( pdev -> subsystem_vendor == 0x55 && pdev -> subsystem_device == 0x02 ) { pr_notice ( "Netjet: Enter!Now not handled yet\n" ) ; return - ENODEV ; } if ( pdev -> subsystem_vendor == 0xb100 && pdev -> subsystem_device == 0x0003 ) { pr_notice ( "Netjet: Digium TDM400P not handled yet\n" ) ; return - ENODEV ; } card = kmalloc ( sizeof ( tiger_hw ) , GFP_KERNEL ) ; if ( ! card ) { pr_info ( "No kmem for Netjet\n" ) ; return err ; } card -> pdev = pdev ; err = pci_enable_device ( pdev ) ; if ( err ) { kfree ( card ) ; return err ; } printk ( KERN_INFO "nj_probe(mISDN): found adapter at %s\n" , pci_name ( pdev ) ) ; pci_set_master ( pdev ) ; pci_read_config_dword ( pdev , 0x04 , & cfg ) ; if ( cfg & 0x00100000 ) { card -> typ = NETJET_S_TJ320 ; } else { card -> typ = NETJET_S_TJ300 ; } card -> base = pci_resource_start ( pdev , 0 ) ; pci_set_drvdata ( pdev , card ) ; err = setup_instance ( card ) ; if ( err ) { pci_set_drvdata ( pdev , NULL ) ; } return err ; } 