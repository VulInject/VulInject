static uint64_t virt_alloc_region ( struct kvm_vm * vm , int ri ) { int taddr ; taddr = vm_phy_pages_alloc ( vm , ri < 4 ?PAGES_PER_REGION : 1 , KVM_GUEST_PAGE_TABLE_MIN_PADDR , 0 ) ; memset ( addr_gpa2hva ( vm , taddr ) , 0xff , PAGES_PER_REGION * vm -> page_size ) ; return ( taddr & REGION_ENTRY_ORIGIN ) | ( ( ( 4 - ri ) << 2 ) & REGION_ENTRY_TYPE ) | ( ( ri < 4 ?( PAGES_PER_REGION - 1 ) : 0 ) & REGION_ENTRY_LENGTH ) ; } 