int tls1_transcript_hash_value ( SSL * s , unsigned char * out , size_t len , size_t * outlen ) { EVP_MD_CTX * mdctx = NULL ; unsigned int mdlen ; int ret = 0 ; if ( s -> s3 -> handshake_hash == NULL ) { err } if ( EVP_MD_CTX_size ( s -> s3 -> handshake_hash ) > len ) { err } if ( ( mdctx = EVP_MD_CTX_new ( ) ) == NULL ) { SSLerror ( s , ERR_R_MALLOC_FAILURE ) ; err } if ( ! EVP_MD_CTX_copy_ex ( mdctx , s -> s3 -> handshake_hash ) ) { SSLerror ( s , ERR_R_EVP_LIB ) ; err } if ( ! EVP_DigestFinal_ex ( mdctx , out , & mdlen ) ) { SSLerror ( s , ERR_R_EVP_LIB ) ; err } if ( outlen != NULL ) { * outlen = mdlen ; } ret = 1 ; err return ( ret ) ; } 