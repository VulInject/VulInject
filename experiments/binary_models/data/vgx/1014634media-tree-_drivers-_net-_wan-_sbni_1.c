static int enslave ( struct net_device * dev , struct net_device * slave_dev ) { struct net_local * nl = netdev_priv ( dev ) ; struct net_local * snl = netdev_priv ( slave_dev ) ; if ( nl -> state & FL_SLAVE ) { return - EBUSY ; } if ( snl -> state & FL_SLAVE ) { return - EBUSY ; } spin_lock ( & nl -> lock ) ; spin_lock ( & snl -> lock ) ; snl -> link = nl -> link ; nl -> link = slave_dev ; snl -> master = dev ; snl -> state |= FL_SLAVE ; memset ( & slave_dev -> stats , 0 , sizeof ( net_device_stats ) ) ; netif_stop_queue ( slave_dev , NULL ) ; netif_wake_queue ( dev ) ; spin_unlock ( & snl -> lock ) ; spin_unlock ( & nl -> lock ) ; netdev_notice ( dev , "slave device (%s) attached\n" , slave_dev -> name ) ; return 0 ; } 