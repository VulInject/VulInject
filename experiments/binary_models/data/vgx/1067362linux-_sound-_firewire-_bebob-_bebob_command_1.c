int avc_bridgeco_get_plug_ch_count ( struct fw_unit * unit , u8 addr [ AVC_BRIDGECO_ADDR_BYTES ] , unsigned int * ch_count ) { u8 * buf ; int err ; buf = kzalloc ( 12 , GFP_KERNEL ) ; avc_bridgeco_fill_plug_info_extension_command ( buf , addr , 0x02 ) ; err = fcp_avc_transaction ( unit , buf , 12 , buf , 12 , BIT ( 1 ) | BIT ( 2 ) | BIT ( 3 ) | BIT ( 4 ) | BIT ( 5 ) | BIT ( 6 ) | BIT ( 7 ) | BIT ( 9 ) ) ; if ( err < 0 ) { } if ( err < 11 ) { err = - EIO ; } if ( buf [ 0 ] == 0x08 ) { err = - ENOSYS ; } if ( buf [ 0 ] == 0x0a ) { err = - EINVAL ; } if ( buf [ 0 ] == 0x0b ) { err = - EAGAIN ; } if ( err < 0 ) { end } * ch_count = buf [ 10 ] ; err = 0 ; end kfree ( buf ) ; return err ; } 