static void print_zig_diff ( RCore * c , RSignBytes * ab , RSignBytes * bb , RLevOp * ops ) { lines { char * mask , * bytes , * land ; } , al , bl memset ( & bl , 0 , sizeof ( bl ) ) ; char * colsub , * coladd , * coldel ; colsub = coladd = coldel = NULL ; if ( r_config_get_b ( c -> config , "scr.color" ) ) { coldel = "\x1b[1;31m" ; coladd = "\x1b[1;32m" ; colsub = "\x1b[1;33m" ; } int i , ia , ib , iastart , ibstart ; ia = ib = iastart = ibstart = 0 ; bool printb = false ; for ( i = 0 ; ops [ i ] != LEVEND ; i ++ ) { switch ( ops [ i ] ) { case LEVNOP : if ( ! printb && ( ab -> bytes [ ia ] != bb -> bytes [ ib ] || ab -> mask [ ia ] != bb -> mask [ ib ] ) ) { printb = true ; } lines_addbytesmask ( al , ab , ia , " " , ( const char * ) NULL ) ; lines_addbytesmask ( bl , bb , ib , " " , ( const char * ) NULL ) ; break ; case LEVSUB : lines_addbytesmask ( al , ab , ia , " " , colsub ) ; lines_addbytesmask ( bl , bb , ib , "^" , colsub ) ; printb = true ; break ; case LEVADD : lines_addblnk ( al ) ; lines_addbytesmask ( bl , bb , ib , "+" , coladd ) ; printb = true ; break ; case LEVDEL : lines_addbytesmask ( al , ab , ia , "-" , coldel ) ; lines_addblnk ( bl ) ; printb = true ; break ; default : r_warn_if_reached ( ) ; freelines ( al ) ; freelines ( bl ) ; return ; } if ( ! ( al . bytes && al . mask && al . land && bl . bytes && bl . mask && bl . land ) ) { freelines ( al ) ; freelines ( bl ) ; return ; } if ( i % 16 == 15 || ops [ i + 1 ] == LEVEND ) { if ( i > 16 ) { r_cons_printf ( "\n" ) ; } r_cons_printf ( "Fnc cmp   0x%04x %s\n" , iastart , al . land ) ; if ( printb ) { r_cons_printf ( "Sig cmp   0x%04x %s\n" , ibstart , bl . land ) ; } r_cons_printf ( "Fnc Mask  0x%04x %s\n" , iastart , al . mask ) ; if ( printb ) { r_cons_printf ( "Sig Mask  0x%04x %s\n" , ibstart , bl . mask ) ; } r_cons_printf ( "Fnc Bytes 0x%04x %s\n" , iastart , al . bytes ) ; if ( printb ) { r_cons_printf ( "Sig Bytes 0x%04x %s\n" , ibstart , bl . bytes ) ; } else { r_cons_printf ( "== Signature was same ==\n" ) ; } freelines ( al ) ; freelines ( bl ) ; iastart = ia ; ibstart = ib ; printb = false ; } } } 