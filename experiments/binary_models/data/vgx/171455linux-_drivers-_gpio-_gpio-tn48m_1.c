static int tn48m_gpio_probe ( struct platform_device * pdev ) { const struct tn48m_gpio_config * gpio_config ; struct gpio_regmap_config config = { } ; struct regmap * regmap ; u32 base ; int ret ; if ( ! pdev -> dev . parent ) { return - ENODEV ; } gpio_config = device_get_match_data ( & pdev -> dev ) ; ret = device_property_read_u32 ( & pdev -> dev , "reg" , & base ) ; if ( ret ) { return ret ; } regmap = dev_get_regmap ( pdev -> dev . parent , NULL ) ; if ( ! regmap ) { return - ENODEV ; } config . regmap = regmap ; config . parent = & pdev -> dev ; config . ngpio = gpio_config -> ngpio ; config . ngpio_per_reg = gpio_config -> ngpio_per_reg ; switch ( gpio_config -> type ) { case TN48M_GP0 : config . reg_set_base = base ; break ; case TN48M_GPI : config . reg_dat_base = base ; break ; default : return - EINVAL ; } return PTR_ERR_OR_ZERO ( devm_gpio_regmap_register ( & pdev -> dev , & config ) ) ; } 