int initInterprocessBuffers ( void ) { frontRegUserTableBuffer = shm_malloc ( sizeof ( interprocessBuffer_t ) ) ; endRegUserTableBuffer = shm_malloc ( sizeof ( interprocessBuffer_t ) ) ; if ( frontRegUserTableBuffer == NULL || endRegUserTableBuffer == NULL ) { LM_ERR ( "no more shared memory\n" ) ; return - 1 ; } memset ( endRegUserTableBuffer , 0x00 , sizeof ( interprocessBuffer_t ) ) ; interprocessCBLock = lock_alloc ( ) ; if ( interprocessCBLock == NULL ) { LM_ERR ( "cannot allocate the lock\n" ) ; shm_free ( frontRegUserTableBuffer ) ; frontRegUserTableBuffer = NULL ; shm_free ( endRegUserTableBuffer ) ; endRegUserTableBuffer = NULL ; return - 1 ; } lock_init ( interprocessCBLock ) ; hashTable = createHashTable ( HASH_SIZE ) ; if ( hashTable == NULL ) { LM_ERR ( "no more shared memory\n" ) ; lock_destroy ( interprocessCBLock ) ; lock_dealloc ( interprocessCBLock ) ; shm_free ( frontRegUserTableBuffer ) ; frontRegUserTableBuffer = NULL ; shm_free ( endRegUserTableBuffer ) ; endRegUserTableBuffer = NULL ; return - 1 ; } return 1 ; } 