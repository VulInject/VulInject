Datum be_lo_open ( PG_FUNCTION_ARGS ) { Oid lobjId = PG_GETARG_OID ( 0 ) ; int32 mode = PG_GETARG_INT32 ( 1 ) ; LargeObjectDesc * lobjDesc ; int fd ; elog ( DEBUG4 , "lo_open(%u,%d)" , lobjId , mode ) ; if ( mode & INV_WRITE ) { PreventCommandIfReadOnly ( "lo_open(INV_WRITE)" ) ; } fd = newLOfd ( ) ; lobjDesc = inv_open ( lobjId , mode , fscxt ) ; lobjDesc -> subid = GetCurrentSubTransactionId ( ) ; if ( lobjDesc -> snapshot ) { lobjDesc -> snapshot = RegisterSnapshotOnOwner ( lobjDesc -> snapshot , TopTransactionResourceOwner ) ; } Assert ( cookies [ fd ] == NULL ) ; cookies [ fd ] = lobjDesc ; PG_RETURN_INT32 ( fd , NULL ) ; } 