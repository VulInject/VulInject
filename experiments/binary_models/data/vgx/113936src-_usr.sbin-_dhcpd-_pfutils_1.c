void pf_change_table ( int fd , int op , struct in_addr ip , char * table ) { struct pfioc_table io ; struct pfr_addr addr ; if ( table == NULL ) { return ; } strlcpy ( io . pfrio_table . pfrt_name , table , sizeof ( io . pfrio_table . pfrt_name ) ) ; io . pfrio_buffer = & addr ; io . pfrio_esize = sizeof ( addr ) ; io . pfrio_size = 1 ; memset ( & addr , 0 , sizeof ( addr ) ) ; memcpy ( & addr . pfra_ip4addr , & ip , 4 ) ; addr . pfra_af = AF_INET ; addr . pfra_net = 32 ; if ( ioctl ( fd , op ?DIOCRADDADDRS : DIOCRDELADDRS , & io ) == - 1 && errno != ESRCH ) { log_warn ( "DIOCR%sADDRS on table %s" , op ?"ADD" : "DEL" , table ) ; } } 