static int attach_codec_to_fabric ( struct aoa_codec * c ) { int err ; if ( ! try_module_get ( c -> owner ) ) { return - EBUSY ; } err = - ENOENT ; if ( fabric -> found_codec ) { err = fabric -> found_codec ( c ) ; } if ( err ) { module_put ( c -> owner ) ; printk ( KERN_ERR "snd-aoa: fabric didn't like codec %s\n" , c -> name ) ; return err ; } c -> fabric = fabric ; err = 0 ; if ( c -> init ) { err = c -> init ( c ) ; } if ( err ) { printk ( KERN_ERR "snd-aoa: codec %s didn't init\n" , c -> name ) ; if ( fabric -> remove_codec ) { fabric -> remove_codec ( c ) ; } module_put ( c -> owner ) ; return err ; } if ( fabric -> attached_codec ) { fabric -> attached_codec ( c ) ; } return 0 ; } 