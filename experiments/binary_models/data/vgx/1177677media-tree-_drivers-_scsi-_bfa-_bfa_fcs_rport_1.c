static struct bfa_fcs_rport_s * bfa_fcs_rport_alloc ( struct bfa_fcs_lport_s * port , wwn_t pwwn , u32 rpid ) { struct bfa_fcs_s * fcs = port -> fcs ; struct bfa_fcs_rport_s * rport ; struct bfad_rport_s * rport_drv ; if ( fcs -> num_rport_logins >= bfa_fcs_rport_max_logins ) { bfa_trc ( fcs , rpid ) ; return NULL ; } if ( bfa_fcb_rport_alloc ( fcs -> bfad , & rport , & rport_drv ) != BFA_STATUS_OK ) { bfa_trc ( fcs , rpid ) ; return NULL ; } rport -> port = port ; rport -> fcs = fcs ; rport -> rp_drv = rport_drv ; rport -> pid = rpid ; rport -> pwwn = pwwn ; rport -> old_pid = 0 ; rport -> bfa_rport = NULL ; WARN_ON ( ! bfa_fcs_lport_is_initiator ( port ) ) ; if ( bfa_fcs_lport_is_initiator ( port ) ) { rport -> itnim = bfa_fcs_itnim_create ( rport ) ; if ( ! rport -> itnim ) { bfa_trc ( fcs , rpid ) ; return NULL ; } } bfa_fcs_lport_add_rport ( port , rport ) ; fcs -> num_rport_logins ++ ; bfa_sm_set_state ( rport , bfa_fcs_rport_sm_uninit ) ; if ( ! BFA_FCS_PID_IS_WKA ( rport -> pid ) ) { bfa_fcs_rpf_init ( rport ) ; } return rport ; } 