char * expand ( char * name ) { char xname [ BUFSIZ ] ; char foldbuf [ BUFSIZ ] ; register char * cp ; register int l ; wordexp_t wrdexp_buf ; if ( debug ) { fprintf ( stderr , "expand(%s)=" , name ) ; } cp = strchr ( name , '\0' ) - 1 ; if ( isspace ( * cp ) ) { while ( cp > name && isspace ( * cp ) ) { cp -- ; } l = * ++ cp ; * cp = '\0' ; name = savestr ( name ) ; * cp = ( char ) l ; } if ( name [ 0 ] == '+' && getfold ( foldbuf ) >= 0 ) { sprintf ( xname , "%s/%s" , foldbuf , name + 1 ) ; cp = safeexpand ( savestr ( xname ) ) ; if ( debug ) { fprintf ( stderr , "%s\n" , cp ) ; } return ( cp ) ; } if ( ! anyof ( name , "~{[*?$`'\"\\" ) ) { if ( debug ) { fprintf ( stderr , "%s\n" , name ) ; } return ( name ) ; } if ( wordexp ( name , & wrdexp_buf , WRDE_NOCMD ) != 0 ) { fprintf ( stderr , gettext ( "Syntax error in \"%s\"\n" ) , name ) ; fflush ( stderr ) ; return ( NOSTR ) ; } if ( wrdexp_buf . we_wordc > 1 ) { fprintf ( stderr , gettext ( "\"%s\": Ambiguous\n" ) , name ) ; fflush ( stderr ) ; return ( NOSTR ) ; } if ( debug ) { fprintf ( stderr , "%s\n" , wrdexp_buf . we_wordv [ 0 ] ) ; } return ( savestr ( wrdexp_buf . we_wordv [ 0 ] ) ) ; } 