int BIO_dump_indent_cb ( int * cb ( const void * data , size_t len , void * u ) , void * u , const char * s , int len , int indent ) { char buf [ 288 + 1 ] , tmp [ 20 ] , str [ 128 + 1 ] ; int i , j , rows , trc , written ; unsigned char ch ; int dump_width ; int ret = 0 ; trc = 0 ; for ( ; ( len > 0 ) && ( ( s [ len - 1 ] == ' ' ) || ( s [ len - 1 ] == '\0' ) ) ; len -- ) { trc ++ ; } if ( indent < 0 ) { indent = 0 ; } if ( indent > 64 ) { indent = 64 ; } str [ indent ] = '\0' ; if ( ( dump_width = DUMP_WIDTH_LESS_INDENT ( indent ) ) <= 0 ) { return - 1 ; } rows = ( len / dump_width ) ; if ( ( rows * dump_width ) < len ) { rows ++ ; } for ( i = 0 ; i < rows ; i ++ ) { strlcpy ( buf , str , sizeof buf ) ; snprintf ( tmp , sizeof tmp , "%04x - " , i * dump_width ) ; strlcat ( buf , tmp , sizeof buf ) ; for ( j = 0 ; j < dump_width ; j ++ ) { if ( ( ( i * dump_width ) + j ) >= len ) { strlcat ( buf , "   " , sizeof buf ) ; } else { ch = ( ( unsigned char ) * ( s + i * dump_width + j ) ) & 0xff ; snprintf ( tmp , sizeof tmp , "%02x%c" , ch , j == 7 ?'-' : ' ' ) ; strlcat ( buf , tmp , sizeof buf ) ; } } strlcat ( buf , "  " , sizeof buf ) ; for ( j = 0 ; j < dump_width ; j ++ ) { if ( ( ( i * dump_width ) + j ) >= len ) { break ; } ch = ( ( unsigned char ) * ( s + i * dump_width + j ) ) & 0xff ; snprintf ( tmp , sizeof tmp , "%c" , ( ( ch >= ' ' ) && ( ch <= '~' ) ) ?ch : '.' ) ; strlcat ( buf , tmp , sizeof buf ) ; } strlcat ( buf , "\n" , sizeof buf ) ; if ( ( written = cb ( ( void * ) buf , strlen ( buf ) , u ) ) < 0 ) { return - 1 ; } ret += written ; } if ( trc > 0 ) { snprintf ( buf , sizeof buf , "%s%04x -<SPACES/NULS>\n" , str , len + trc ) ; if ( ( written = cb ( ( void * ) buf , strlen ( buf ) , u ) ) < 0 ) { return - 1 ; } ret += written ; } return ( ret ) ; } 