u32 ciaddr ; u32 yiaddr ; u32 siaddr ; u32 giaddr ; u8 chaddr [ 16 ] ; u8 sname [ 64 ] ; u8 file [ 128 ] ; dhcp { struct ethernet_hdr eth_hdr ; struct ip_udp_hdr ip_udp ; struct dhcp_hdr dhcp_hdr ; u8 opt [ 128 ] ; } , __packed static struct efi_boot_services * boottime ; static struct efi_simple_network * net ; static struct efi_event * timer ; static const efi_guid_t efi_net_guid = EFI_SIMPLE_NETWORK_PROTOCOL_GUID ; static unsigned int net_ip_id ; static unsigned int efi_ip_checksum ( const void * buf , size_t len ) { int i ; u32 sum = 0 ; const u16 * pos = buf ; for ( i = 0 ; i < len ; i += 2 ) { sum += * pos ++ ; } sum = ( sum >> 16 ) + ( sum & 0xffff ) ; sum += sum >> 16 ; sum = ~ sum & 0xffff ; return sum ; } 