static int rtc7301_read_alarm ( struct device * dev , struct rtc_wkalrm * alarm ) { struct rtc7301_priv * priv = dev_get_drvdata ( dev ) ; unsigned long flags ; u8 alrm_ctrl ; spin_lock_irqsave ( & priv -> lock , flags ) ; rtc7301_select_bank ( priv , 1 ) ; rtc7301_get_time ( priv , & alarm -> time , true ) ; alrm_ctrl = rtc7301_read ( priv , RTC7301_ALARM_CONTROL ) ; alarm -> enabled = ! ! ( alrm_ctrl & RTC7301_ALARM_CONTROL_AIE ) ; alarm -> pending = ! ! ( alrm_ctrl & RTC7301_ALARM_CONTROL_AF ) ; spin_unlock_irqrestore ( & priv -> lock , flags ) ; return 0 ; } 