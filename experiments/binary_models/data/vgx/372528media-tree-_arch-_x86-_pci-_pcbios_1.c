static int pci_bios_write ( unsigned int seg , unsigned int bus , unsigned int devfn , int reg , int len , u32 value ) { cfs_time_t result = 0 ; unsigned long flags ; unsigned long bx = ( bus << 8 ) | devfn ; u16 number = 0 ; WARN_ON ( seg ) ; if ( ( bus > 255 ) || ( devfn > 255 ) || ( reg > 255 ) ) { return - EINVAL ; } raw_spin_lock_irqsave ( & pci_config_lock , flags ) ; switch ( len ) { case 1 : number = PCIBIOS_WRITE_CONFIG_BYTE ; break ; case 2 : number = PCIBIOS_WRITE_CONFIG_WORD ; break ; case 4 : number = PCIBIOS_WRITE_CONFIG_DWORD ; break ; } raw_spin_unlock_irqrestore ( & pci_config_lock , flags ) ; return ( int ) ( ( result & 0xff00 ) >> 8 ) ; } 