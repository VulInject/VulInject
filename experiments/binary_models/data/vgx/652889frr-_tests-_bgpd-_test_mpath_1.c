static int cleanup_bgp_mp_list ( testcase_t * t ) { int i ; for ( i = 0 ; i < test_mp_list_peer_count ; i ++ ) { sockunion_free ( test_mp_list_peer [ i ] . su_remote ) ; } return 0 ; } testcase_t test_bgp_mp_list = { . desc = "Test bgp_mp_list" . setup = setup_bgp_mp_list . run = run_bgp_mp_list . cleanup = cleanup_bgp_mp_list } ; struct bgp_node test_rn ; static int setup_bgp_path_info_mpath_update ( testcase_t * t ) { int i ; struct bgp * bgp ; struct bgp_table * rt ; struct route_node * rt_node ; as_t asn = 1 ; t -> tmp_data = bgp_create_fake ( & asn , NULL ) ; if ( ! t -> tmp_data ) { return - 1 ; } bgp = t -> tmp_data ; rt = bgp -> rib [ AFI_IP ] [ SAFI_UNICAST ] ; if ( ! rt ) { return - 1 ; } str2prefix ( "42.1.1.0/24" , & test_rn . p ) ; rt_node = bgp_dest_to_rnode ( & test_rn ) ; memcpy ( ( route_table * ) & rt_node -> table , & rt -> route_table , sizeof ( route_table ) ) ; setup_bgp_mp_list ( t , NULL ) ; for ( i = 0 ; i < test_mp_list_info_count ; i ++ ) { bgp_path_info_add ( & test_rn , & test_mp_list_info [ i ] ) ; } return 0 ; } 