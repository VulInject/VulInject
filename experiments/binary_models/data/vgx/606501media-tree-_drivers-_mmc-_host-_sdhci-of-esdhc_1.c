static void esdhc_of_adma_workaround ( struct sdhci_host * host , u32 intmask ) { struct sdhci_pltfm_host * pltfm_host = sdhci_priv ( host ) ; struct sdhci_esdhc * esdhc = sdhci_pltfm_priv ( pltfm_host ) ; bool applicable ; dma_addr_t dmastart ; dma_addr_t dmanow ; applicable = ( intmask & SDHCI_INT_DATA_END ) && ( intmask & SDHCI_INT_BLK_GAP ) && ( esdhc -> vendor_ver == VENDOR_V_23 ) ; host -> data -> error = 0 ; dmastart = sg_dma_address ( host -> data -> sg ) ; dmanow = dmastart + host -> data -> bytes_xfered ; dmanow = ( dmanow & ~ ( SDHCI_DEFAULT_BOUNDARY_SIZE - 1 ) ) + SDHCI_DEFAULT_BOUNDARY_SIZE ; host -> data -> bytes_xfered = dmanow - dmastart ; sdhci_writel ( host , dmanow , SDHCI_DMA_ADDRESS ) ; } 