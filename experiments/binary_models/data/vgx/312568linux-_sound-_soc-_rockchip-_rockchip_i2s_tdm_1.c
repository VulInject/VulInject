static int rockchip_i2s_tdm_clk_set_rate ( struct rk_i2s_tdm_dev * i2s_tdm , struct clk * clk , unsigned long rate , int ppm ) { unsigned long rate_target ; int delta , ret ; if ( ppm < 0 ) { delta = - 1 ; } else { delta = 1 ; } delta *= ( int ) div64_u64 ( ( u64 ) rate * ( u64 ) abs ( ppm ) + 500000 , 1000000 ) ; rate_target = rate + delta ; if ( ! rate_target ) { return - EINVAL ; } ret = clk_set_rate ( clk , rate_target ) ; if ( ret ) { return ret ; } i2s_tdm -> clk_ppm = ppm ; return 0 ; } 