static int iwscnopen ( dev_t * devp , int flag , int state , cred_t * cred ) { iwscn_list_t * lp ; vnode_t * vp = rwsconsvp ; if ( state != OTYP_CHR ) { return ( ENXIO ) ; } if ( getminor ( * devp ) != 0 ) { return ( ENXIO ) ; } mutex_enter ( & iwscn_list_lock ) ; if ( ( iwscn_list == NULL ) || ( iwscn_list -> wl_vp == str_vp ( vp ) ) ) { int error = 0 ; mutex_exit ( & iwscn_list_lock ) ; error = VOP_OPEN ( & vp , flag , cred , NULL ) ; if ( error != 0 ) { return ( error ) ; } mutex_enter ( & iwscn_list_lock ) ; if ( iwscn_list == NULL ) { srpush ( vp , B_TRUE ) ; } else { ( void ) VOP_CLOSE ( vp , flag , 1 , ( offset_t ) 0 , cred , NULL ) ; } } str_cn_clean ( VTOS ( rwsconsvp ) -> s_commonvp ) ; for ( lp = iwscn_list ; lp != NULL ; lp = lp -> wl_next ) { ASSERT ( lp -> wl_vp -> v_stream != NULL ) ; str_cn_clean ( lp -> wl_vp ) ; } mutex_exit ( & iwscn_list_lock ) ; return ( 0 ) ; } 