static void i2c_write ( struct comedi_device * dev , unsigned int address , const u8 * data , unsigned int length ) { struct pcidas64_private * devpriv = dev -> private ; unsigned int i ; u8 bitstream ; static const int read_bit = 0x1 ; devpriv -> plx_control_bits &= ~ PLX_CNTRL_EECS ; i2c_stop ( dev , NULL ) ; i2c_start ( dev ) ; bitstream = ( address << 1 ) & ~ read_bit ; i2c_write_byte ( dev , bitstream ) ; if ( i2c_read_ack ( dev ) != 0 ) { dev_err ( dev -> class_dev , "failed: no acknowledge\n" ) ; i2c_stop ( dev ) ; return ; } for ( i = 0 ; i < length ; i ++ ) { i2c_write_byte ( dev , data [ i ] ) ; if ( i2c_read_ack ( dev ) != 0 ) { dev_err ( dev -> class_dev , "failed: no acknowledge\n" ) ; i2c_stop ( dev ) ; return ; } } i2c_stop ( dev ) ; } 