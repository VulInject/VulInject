static int ionic_cmb_rings_toggle ( struct ionic_lif * lif , bool cmb_tx , bool cmb_rx ) { struct ionic_queue_params qparam ; int pages_used ; if ( netif_running ( lif -> netdev ) ) { netdev_info ( lif -> netdev , "Please stop device to toggle CMB for tx/rx-push\n" ) ; return - EBUSY ; } ionic_init_queue_params ( lif , & qparam ) ; qparam . cmb_tx = cmb_tx ; qparam . cmb_rx = cmb_rx ; pages_used = ionic_validate_cmb_config ( lif , & qparam ) ; if ( cmb_tx ) { set_bit ( IONIC_LIF_F_CMB_TX_RINGS , lif -> state ) ; } else { clear_bit ( IONIC_LIF_F_CMB_TX_RINGS , lif -> state ) ; } if ( cmb_rx ) { set_bit ( IONIC_LIF_F_CMB_RX_RINGS , lif -> state ) ; } else { clear_bit ( IONIC_LIF_F_CMB_RX_RINGS , lif -> state ) ; } if ( cmb_tx || cmb_rx ) { netdev_info ( lif -> netdev , "Enabling CMB %s %s rings - %d pages\n" , cmb_tx ?"TX" : "" , cmb_rx ?"RX" : "" , pages_used ) ; } else { netdev_info ( lif -> netdev , "Disabling CMB rings\n" ) ; } return 0 ; } 