int loadrandom ( void ) { char buf [ BOOTRANDOM_MAX ] ; struct stat sb ; int fd , ret = 0 ; fd = open ( BOOTRANDOM , O_RDONLY ) ; if ( fd == - 1 ) { fprintf ( stderr , "%s: cannot open %s: %s" , __func__ , BOOTRANDOM , strerror ( errno ) ) ; disk_close ( ) ; return - 1 ; } if ( fstat ( fd , & sb ) == 0 ) { if ( sb . st_mode & S_ISTXT ) { printf ( "NOTE: random seed is being reused.\n" ) ; ret = - 1 ; } if ( read ( fd , buf , sizeof ( buf ) ) != sizeof ( buf ) ) { ret = - 1 ; } fchmod ( fd , sb . st_mode | S_ISTXT ) ; } else { ret = - 1 ; } close ( fd ) ; disk_close ( ) ; fd = open ( DEVRANDOM , O_WRONLY ) ; if ( fd == - 1 ) { fprintf ( stderr , "%s: cannot open %s: %s" , __func__ , DEVRANDOM , strerror ( errno ) ) ; return - 1 ; } write ( fd , buf , sizeof ( buf ) ) ; close ( fd ) ; return ret ; } 