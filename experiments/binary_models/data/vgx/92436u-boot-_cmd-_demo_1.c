static int do_demo ( struct cmd_tbl * cmdtp , int flag , int argc , char * const argv [ ] ) { struct cmd_tbl * demo_cmd ; int devnum = 0 ; int ret ; if ( argc < 2 ) { return CMD_RET_USAGE ; } demo_cmd = find_cmd_tbl ( argv [ 1 ] , demo_commands , ARRAY_SIZE ( demo_commands ) ) ; argc -= 2 ; argv += 2 ; if ( ( ! demo_cmd || argc > demo_cmd -> maxargs ) || ( ( demo_cmd -> name [ 0 ] != 'l' ) && ( argc < 1 ) ) ) { return CMD_RET_USAGE ; } if ( argc ) { devnum = dectoul ( argv [ 0 ] , NULL ) ; ret = uclass_get_device ( UCLASS_DEMO , devnum , & demo_dev ) ; if ( ret ) { return cmd_process_error ( cmdtp , ret ) ; } argc -- ; argv ++ ; } else { demo_dev = NULL ; } ret = demo_cmd -> cmd ( demo_cmd , flag , argc , argv ) ; return cmd_process_error ( demo_cmd , ret ) ; } 