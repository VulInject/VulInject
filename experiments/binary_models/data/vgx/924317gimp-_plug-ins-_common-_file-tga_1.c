tga_save ( , , , , , , , ) { GimpProcedureConfig * config ; GimpPDBStatusType status = GIMP_PDB_SUCCESS ; GimpExportReturn export = GIMP_EXPORT_CANCEL ; GError * error = NULL ; gegl_init ( NULL , NULL ) ; config = gimp_procedure_create_config ( procedure ) ; gimp_procedure_config_begin_run ( config , image , run_mode , args ) ; switch ( run_mode ) { case GIMP_RUN_INTERACTIVE : case GIMP_RUN_WITH_LAST_VALS : gimp_ui_init ( PLUG_IN_BINARY ) ; export = gimp_export_image ( & image , & n_drawables , & drawables , "TGA" , GIMP_EXPORT_CAN_HANDLE_RGB | GIMP_EXPORT_CAN_HANDLE_GRAY | GIMP_EXPORT_CAN_HANDLE_INDEXED | GIMP_EXPORT_CAN_HANDLE_ALPHA ) ; if ( export == GIMP_EXPORT_CANCEL ) { return gimp_procedure_new_return_values ( procedure , GIMP_PDB_CANCEL , NULL ) ; } break ; default : break ; } if ( n_drawables != 1 ) { g_set_error ( & error , G_FILE_ERROR , 0 , _ ( "TGA format does not support multiple layers." ) ) ; return gimp_procedure_new_return_values ( procedure , GIMP_PDB_CALLING_ERROR , error ) ; } if ( run_mode == GIMP_RUN_INTERACTIVE ) { if ( ! save_dialog ( procedure , G_OBJECT ( config ) ) ) { status = GIMP_PDB_CANCEL ; } } if ( status == GIMP_PDB_SUCCESS ) { if ( ! save_image ( file , image , drawables [ 0 ] , G_OBJECT ( config ) , & error ) ) { status = GIMP_PDB_EXECUTION_ERROR ; } } gimp_procedure_config_end_run ( config , status ) ; g_object_unref ( config ) ; if ( export == GIMP_EXPORT_EXPORT ) { gimp_image_delete ( image ) ; } return gimp_procedure_new_return_values ( procedure , status , error ) ; } 