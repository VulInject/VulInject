char * * IniFile_GetSectionNames ( wIniFile * ini , int * count ) { char * p ; size_t index ; size_t length ; size_t nameLength ; char * * sectionNames ; wIniFileSection * section = NULL ; if ( ! ini || ! count ) { return NULL ; } if ( ini -> nSections > INT_MAX ) { return in ; } length = ( sizeof ( char * ) * ini -> nSections ) + sizeof ( char ) ; for ( index = 0 ; index < ini -> nSections ; index ++ ) { section = ini -> sections [ index ] ; nameLength = strlen ( section -> name ) ; length += ( nameLength + 1 ) ; } sectionNames = ( char * * ) malloc ( length ) ; if ( ! sectionNames ) { return NULL ; } p = ( char * ) & ( ( BYTE * ) sectionNames ) [ sizeof ( char * ) * ini -> nSections ] ; for ( index = 0 ; index < ini -> nSections ; index ++ ) { sectionNames [ index ] = p ; section = ini -> sections [ index ] ; nameLength = strlen ( section -> name ) ; CopyMemory ( p , section -> name , nameLength + 1 ) ; p += ( nameLength + 1 ) ; } * p = '\0' ; * count = ( int ) ini -> nSections ; return sectionNames ; } 