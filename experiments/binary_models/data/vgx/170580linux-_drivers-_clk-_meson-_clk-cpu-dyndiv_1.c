static int meson_clk_cpu_dyndiv_set_rate ( struct clk_hw * hw , unsigned long rate , unsigned long parent_rate ) { struct clk_regmap * clk = to_clk_regmap ( hw ) ; struct meson_clk_cpu_dyndiv_data * data = meson_clk_cpu_dyndiv_data ( clk ) ; unsigned int val ; int ret ; ret = divider_get_val ( rate , parent_rate , NULL , data -> div . width , 0 ) ; val = ( unsigned int ) ret << data -> div . shift ; meson_parm_write ( clk -> map , & data -> dyn , 1 ) ; return regmap_update_bits ( clk -> map , data -> div . reg_off , SETPMASK ( data -> div . width , data -> div . shift ) | SETPMASK ( data -> dyn . width , data -> dyn . shift ) , val ) ; } 