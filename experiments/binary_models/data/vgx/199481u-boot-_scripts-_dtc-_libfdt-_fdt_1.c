int fdt_next_node ( const void * fdt , int offset , int * depth ) { int nextoffset = 0 ; uint32_t tag ; if ( offset >= 0 ) { if ( ( nextoffset = fdt_check_node_offset_ ( fdt , offset ) ) < 0 ) { return nextoffset ; } } { offset = nextoffset ; tag = fdt_next_tag ( fdt , offset , & nextoffset ) ; switch ( tag ) { case FDT_PROP : case FDT_NOP : break ; case FDT_BEGIN_NODE : if ( depth ) { ( * depth ) ++ ; } break ; case FDT_END_NODE : break ; case FDT_END : if ( ( nextoffset >= 0 ) || ( ( nextoffset == - FDT_ERR_TRUNCATED ) && ! depth ) ) { return - FDT_ERR_NOTFOUND ; } else { return nextoffset ; } } } tag != FDT_BEGIN_NODE ; return offset ; } 