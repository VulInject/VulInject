static snd_pcm_uframes_t snd_cs46xx_playback_direct_pointer ( struct snd_pcm_substream * substream ) { struct snd_cs46xx * chip = snd_pcm_substream_chip ( substream ) ; size_t ptr ; struct snd_cs46xx_pcm * cpcm = substream -> runtime -> private_data ; ptr = snd_cs46xx_peek ( chip , ( cpcm -> pcm_channel -> pcm_reader_scb -> address + 2 ) << 2 ) ; ptr = snd_cs46xx_peek ( chip , BA1_PBA ) ; ptr -= cpcm -> hw_buf . addr ; return ptr >> cpcm -> shift ; } 