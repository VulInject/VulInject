int insn_get_modrm ( struct insn * insn ) { struct insn_field * modrm = & insn -> modrm ; insn_byte_t pfx_id , mod ; int ret ; if ( ! insn -> opcode . got ) { ret = insn_get_opcode ( insn ) ; if ( ret ) { return ret ; } } if ( inat_has_modrm ( insn -> attr ) ) { mod = get_next ( insn_byte_t , insn ) ; insn_field_set ( modrm , mod , 1 ) ; if ( inat_is_group ( insn -> attr ) ) { pfx_id = insn_last_prefix_id ( insn ) ; insn -> attr = inat_get_group_attribute ( mod , pfx_id , insn -> attr ) ; if ( insn_is_avx ( insn ) && ! inat_accept_vex ( insn -> attr ) ) { insn -> attr = 0 ; return - EINVAL ; } } } if ( insn -> x86_64 && inat_is_force64 ( insn -> attr ) ) { insn -> opnd_bytes = 8 ; } modrm -> got = 1 ; return 0 ; err_out return - ENODATA ; } 