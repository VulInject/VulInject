static int mlx5_ib_set_vport_rep ( struct mlx5_core_dev * dev , struct mlx5_eswitch_rep * rep , int vport_index ) { struct mlx5_ib_dev * ibdev ; ibdev = mlx5_eswitch_uplink_get_proto_dev ( dev -> priv . eswitch , REP_IB ) ; ibdev -> port [ vport_index ] . rep = rep ; rep -> rep_data [ REP_IB ] . priv = ibdev ; write_lock ( & ibdev -> port [ vport_index ] . roce . netdev_lock ) ; ibdev -> port [ vport_index ] . roce . netdev = mlx5_ib_get_rep_netdev ( rep -> esw , rep -> vport ) ; write_unlock ( & ibdev -> port [ vport_index ] . roce . netdev_lock ) ; return 0 ; } 