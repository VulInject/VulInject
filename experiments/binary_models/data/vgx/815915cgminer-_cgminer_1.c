static void discard_stale ( void ) { struct work * work , * tmp ; int stale = 0 ; HASH_ITER ( , , , ) { if ( stale_work ( work , false ) ) { HASH_DEL ( staged_work , work ) ; discard_work ( work ) ; stale ++ ; } } pthread_cond_signal ( & gws_cond ) ; mutex_unlock ( stgd_lock ) ; if ( stale ) { applog ( LOG_DEBUG , "Discarded %d stales that didn't match current hash" , stale ) ; } } 