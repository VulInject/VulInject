int sm_gp_get_cryptogram ( unsigned char * session_key , unsigned char * left , unsigned char * right , unsigned char * out , int out_len ) { unsigned char block [ 24 ] ; sm_des_cblock cksum = { 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 } ; memcpy ( block + 0 , left , 8 ) ; memcpy ( block + 8 , right , 8 ) ; memcpy ( block + 16 , "\x80\0\0\0\0\0\0\0" , 8 ) ; DES_cbc_cksum_3des ( block , & cksum , sizeof ( block ) , session_key , & cksum ) ; memcpy ( out , cksum , 8 ) ; return 0 ; } 