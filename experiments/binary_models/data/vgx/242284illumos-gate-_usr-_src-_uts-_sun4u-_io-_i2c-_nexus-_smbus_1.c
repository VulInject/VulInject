static void smbus_dodetach ( dev_info_t * dip ) { smbus_t * smbus ; int instance = ddi_get_instance ( dip ) ; smbus = ddi_get_soft_state ( smbus_state , instance ) ; cv_destroy ( & smbus -> smbus_cv ) ; mutex_destroy ( & smbus -> smbus_mutex ) ; if ( ( smbus -> smbus_attachflags & INTERRUPT_PRI ) != 0 ) { ( void ) ddi_prop_remove ( DDI_DEV_T_NONE , dip , "interrupt-priorities" ) ; } smbus_free_regs ( smbus ) ; if ( ( smbus -> smbus_attachflags & NEXUS_REGISTER ) != 0 ) { i2c_nexus_unregister ( dip ) ; } if ( ( smbus -> smbus_attachflags & IMUTEX ) != 0 ) { mutex_destroy ( & smbus -> smbus_imutex ) ; cv_destroy ( & smbus -> smbus_icv ) ; } if ( smbus -> smbus_timeout != 0 ) { ( void ) untimeout ( smbus -> smbus_timeout ) ; } if ( ( smbus -> smbus_attachflags & ADD_INTR ) != 0 ) { ddi_remove_intr ( dip , 0 , smbus -> smbus_icookie ) ; } ddi_soft_state_free ( smbus_state , instance ) ; } 