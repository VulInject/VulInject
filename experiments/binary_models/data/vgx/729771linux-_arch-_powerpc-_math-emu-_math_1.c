FLOATFUNC ( mtfsb0 ) ; FLOATFUNC ( mtfsb1 ) ; FLOATFUNC ( lfd ) ; FLOATFUNC ( lfs , NULL ) ; FLOATFUNC ( stfd ) ; FLOATFUNC ( stfs ) ; FLOATFUNC ( stfiwx ) ; FLOATFUNC ( fabs ) ; FLOATFUNC ( fmr ) ; FLOATFUNC ( fnabs ) ; FLOATFUNC ( fneg ) ; FLOATFUNC ( fres ) ; FLOATFUNC ( frsqrte ) ; FLOATFUNC ( fsel ) ; static int record_exception ( struct pt_regs * regs , int eflag ) { u32 fpscr ; fpscr = __FPU_FPSCR ; if ( eflag ) { fpscr |= FPSCR_FX ; if ( eflag & EFLAG_OVERFLOW ) { fpscr |= FPSCR_OX ; } if ( eflag & EFLAG_UNDERFLOW ) { fpscr |= FPSCR_UX ; } if ( eflag & EFLAG_DIVZERO ) { fpscr |= FPSCR_ZX ; } if ( eflag & EFLAG_INEXACT ) { fpscr |= FPSCR_XX ; } if ( eflag & EFLAG_INVALID ) { fpscr |= FPSCR_VX ; } if ( eflag & EFLAG_VXSNAN ) { fpscr |= FPSCR_VXSNAN ; } if ( eflag & EFLAG_VXISI ) { fpscr |= FPSCR_VXISI ; } if ( eflag & EFLAG_VXIDI ) { fpscr |= FPSCR_VXIDI ; } if ( eflag & EFLAG_VXZDZ ) { fpscr |= FPSCR_VXZDZ ; } if ( eflag & EFLAG_VXIMZ ) { fpscr |= FPSCR_VXIMZ ; } if ( eflag & EFLAG_VXVC ) { fpscr |= FPSCR_VXVC ; } if ( eflag & EFLAG_VXSOFT ) { fpscr |= FPSCR_VXSOFT ; } if ( eflag & EFLAG_VXSQRT ) { fpscr |= FPSCR_VXSQRT ; } if ( eflag & EFLAG_VXCVI ) { fpscr |= FPSCR_VXCVI ; } } if ( fpscr & ( FPSCR_VXSNAN | FPSCR_VXISI | FPSCR_VXIDI | FPSCR_VXZDZ | FPSCR_VXIMZ | FPSCR_VXVC | FPSCR_VXSOFT | FPSCR_VXSQRT | FPSCR_VXCVI ) ) { fpscr |= FPSCR_VX ; } fpscr &= ~ ( FPSCR_FEX ) ; if ( ( ( fpscr & FPSCR_VX ) && ( fpscr & FPSCR_VE ) ) || ( ( fpscr & FPSCR_OX ) && ( fpscr & FPSCR_OE ) ) || ( ( fpscr & FPSCR_UX ) && ( fpscr & FPSCR_UE ) ) || ( ( fpscr & FPSCR_ZX ) && ( fpscr & FPSCR_ZE ) ) || ( ( fpscr & FPSCR_XX ) && ( fpscr & FPSCR_XE ) ) ) { fpscr |= FPSCR_FEX ; } __FPU_FPSCR = fpscr ; return ( fpscr & FPSCR_FEX ) ?1 : 0 ; } 