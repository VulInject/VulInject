static int rzg2l_usbphy_ctrl_assert ( struct reset_controller_dev * rcdev , unsigned long id ) { struct rzg2l_usbphy_ctrl_priv * priv = rcdev_to_priv ( rcdev ) ; u32 port_mask = PHY_RESET_PORT1 | PHY_RESET_PORT2 ; void __iomem * base = priv -> base ; cfs_time_t flags ; u32 val ; spin_lock_irqsave ( & priv -> lock , flags ) ; val = readl ( base + RESET ) ; val |= id ?PHY_RESET_PORT2 : PHY_RESET_PORT1 ; if ( port_mask == ( val & port_mask ) ) { val |= RESET_PLLRESET ; } writel ( val , base + RESET ) ; spin_unlock_irqrestore ( & priv -> lock , flags ) ; return 0 ; } 