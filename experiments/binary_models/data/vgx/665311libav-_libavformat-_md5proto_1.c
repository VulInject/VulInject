static int md5_close ( URLContext * h ) { struct MD5Context * c = h -> priv_data ; const char * filename = h -> filename ; uint8_t md5 [ 16 ] , buf [ 64 ] ; URLContext * out ; int i , err ; av_md5_final ( c -> md5 , md5 ) ; for ( i = 0 ; i < sizeof ( md5 ) ; i ++ ) { snprintf ( buf + i * 2 , 3 , "%02x" , md5 [ i ] ) ; } buf [ i * 2 ] = '\n' ; av_strstart ( filename , "md5:" , & filename ) ; if ( * filename ) { err = ffurl_open ( & out , filename , AVIO_FLAG_WRITE , & h -> interrupt_callback , NULL , h -> protocols , h ) ; if ( err ) { return err ; } err = ffurl_write ( out , buf , i * 2 + 1 ) ; ffurl_close ( out ) ; } else { if ( fwrite ( buf , 1 , i * 2 + 1 , stdout ) < i * 2 + 1 ) { err = AVERROR ( errno ) ; } } av_freep ( & c -> md5 ) ; return err ; } const URLProtocol ff_md5_protocol = { . name = "md5" . url_open = md5_open . url_write = md5_write . url_close = md5_close . priv_data_size = sizeof ( MD5Context ) } ; 