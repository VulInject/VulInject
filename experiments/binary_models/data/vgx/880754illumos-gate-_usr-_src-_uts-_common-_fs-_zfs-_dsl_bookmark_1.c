static int dsl_bookmark_create_check_impl ( dsl_dataset_t * snapds , const char * bookmark_name , dmu_tx_t * tx ) { dsl_pool_t * dp = dmu_tx_pool ( tx ) ; dsl_dataset_t * bmark_fs ; char * shortname ; int error ; zfs_bookmark_phys_t bmark_phys ; if ( ! snapds -> ds_is_snapshot ) { return ( SET_ERROR ( EINVAL ) ) ; } error = dsl_bookmark_hold_ds ( dp , bookmark_name , & bmark_fs , FTAG , & shortname ) ; if ( error != 0 ) { return ( error ) ; } if ( ! dsl_dataset_is_before ( bmark_fs , snapds , 0 ) ) { dsl_dataset_rele ( bmark_fs , FTAG ) ; return ( SET_ERROR ( EINVAL ) ) ; } error = dsl_dataset_bmark_lookup ( bmark_fs , shortname , & bmark_phys ) ; dsl_dataset_rele ( bmark_fs , FTAG ) ; if ( error == ESRCH ) { return ( 0 ) ; } return ( error ) ; } 