static double get_scene_score ( AVFilterContext * ctx , AVFrame * frame ) { double ret = 0 ; SelectContext * select = ctx -> priv ; AVFrame * prev_picref = select -> prev_picref ; if ( prev_picref && frame -> height == prev_picref -> height && frame -> width == prev_picref -> width ) { uint64_t sad = 0 ; double mafd , diff ; uint64_t count = 0 ; for ( int plane = 0 ; plane < select -> nb_planes ; plane ++ ) { uint64_t plane_sad ; select -> sad ( prev_picref -> data [ plane ] , prev_picref -> linesize [ plane ] , frame -> data [ plane ] , frame -> linesize [ plane ] , select -> width [ plane ] , select -> height [ plane ] , & plane_sad ) ; sad += plane_sad ; count += select -> width [ plane ] * select -> height [ plane ] ; } emms_c ( ) ; mafd = ( double ) sad / count / ( 1ULL << ( select -> bitdepth - 8 ) ) ; diff = fabs ( mafd - select -> prev_mafd ) ; ret = av_clipf ( FFMIN ( mafd , diff ) / 100. , 0 , 1 ) ; select -> prev_mafd = mafd ; } select -> prev_picref = av_frame_clone ( frame ) ; return ret ; } 