static int fsl_pcie_check_link ( struct pci_controller * hose ) { u32 val = 0 ; if ( hose -> indirect_type & PPC_INDIRECT_TYPE_FSL_CFG_REG_LINK ) { if ( hose -> ops -> read == fsl_indirect_read_config ) { __indirect_read_config ( hose , hose -> first_busno , 0 , PCIE_LTSSM , 4 , & val ) ; } else { early_read_config_dword ( hose , 0 , 0 , PCIE_LTSSM , & val ) ; } if ( val < PCIE_LTSSM_L0 ) { return 1 ; } } else { struct ccsr_pci __iomem * pci = hose -> private_data ; val = ( in_be32 ( & pci -> pex_csr0 ) & PEX_CSR0_LTSSM_MASK ) >> PEX_CSR0_LTSSM_SHIFT ; } return 0 ; } 