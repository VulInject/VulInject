int dw_ab_parse ( struct dwbuf * abseg , struct dwabbrev_queue * dabq ) { struct dwabbrev * dab ; uint64_t code , tag ; uint8_t children ; for ( ; ; ) { if ( dw_read_uleb128 ( abseg , & code ) || ( code == 0 ) ) { break ; } if ( dw_read_uleb128 ( abseg , & tag ) || dw_read_u8 ( abseg , & children ) ) { return - 1 ; } dab = pmalloc ( & dab_pool , sizeof ( * dab ) ) ; if ( dab == NULL ) { return ENOMEM ; } dab -> dab_code = code ; dab -> dab_tag = tag ; dab -> dab_children = children ; SIMPLEQ_INIT ( & dab -> dab_attrs ) ; SIMPLEQ_INSERT_TAIL ( dabq , dab , dab_next ) ; for ( ; ; ) { struct dwattr * dat ; uint64_t attr = 0 , form = 0 ; if ( dw_read_uleb128 ( abseg , & attr ) || dw_read_uleb128 ( abseg , & form ) ) { return - 1 ; } if ( ( attr == 0 ) && ( form == 0 ) ) { break ; } dat = pmalloc ( & dat_pool , sizeof ( * dat ) ) ; if ( dat == NULL ) { return ENOMEM ; } dat -> dat_attr = attr ; dat -> dat_form = form ; SIMPLEQ_INSERT_TAIL ( & dab -> dab_attrs , dat , dat_next ) ; } } return 0 ; } 