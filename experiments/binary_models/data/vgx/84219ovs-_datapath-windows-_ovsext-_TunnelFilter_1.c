VOID OvsTunnelAddSystemProvider ( HANDLE engineSession ) { NTSTATUS status = STATUS_SUCCESS ; BOOLEAN inTransaction = FALSE ; FWPM_PROVIDER provider = { 0 } ; { status = FwpmTransactionBegin ( engineSession , 0 ) ; inTransaction = TRUE ; memset ( & provider , 0 , sizeof ( provider ) ) ; provider . providerKey = OVS_TUNNEL_PROVIDER_KEY ; provider . displayData . name = OVS_TUNNEL_PROVIDER_NAME ; provider . displayData . description = OVS_TUNNEL_PROVIDER_DESC ; provider . flags = FWPM_PROVIDER_FLAG_PERSISTENT ; status = FwpmProviderAdd ( engineSession , & provider , NULL ) ; if ( ! NT_SUCCESS ( status ) ) { if ( STATUS_FWP_ALREADY_EXISTS != status ) { OVS_LOG_ERROR ( "Failed to add WFP provider, status: %x." , status ) ; break ; } } status = FwpmTransactionCommit ( engineSession ) ; if ( ! NT_SUCCESS ( status ) ) { break ; } inTransaction = FALSE ; } inTransaction ; if ( inTransaction ) { FwpmTransactionAbort ( engineSession ) ; } } 