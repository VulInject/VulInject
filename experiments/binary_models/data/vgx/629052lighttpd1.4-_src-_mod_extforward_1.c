static int is_proxy_trusted ( plugin_data * p , const char * const ip , size_t iplen ) { const data_string * ds = ( const data_string * ) array_get_element_klen ( p -> conf . forwarder , ip , iplen ) ; if ( NULL != ds ) { return ! buffer_is_blank ( & ds -> value ) ; } if ( p -> conf . forward_masks_used ) { const struct sock_addr_mask * const addrs = p -> conf . forward_masks ; const uint32_t aused = p -> conf . forward_masks_used ; sock_addr addr ; char addrstr [ 64 ] ; memcpy ( addrstr , ip , iplen ) ; addrstr [ iplen ] = '\0' ; if ( 1 != sock_addr_inet_pton ( & addr , addrstr , AF_INET , 0 ) && 1 != sock_addr_inet_pton ( & addr , addrstr , AF_INET6 , 0 ) ) { return 0 ; } for ( uint32_t i = 0 ; i < aused ; ++ i ) { if ( sock_addr_is_addr_eq_bits ( & addr , & addrs [ i ] . addr , addrs [ i ] . bits ) ) { return 1 ; } } } return 0 ; } 