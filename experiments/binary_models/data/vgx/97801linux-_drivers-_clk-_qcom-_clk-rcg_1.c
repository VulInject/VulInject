static int _freq_tbl_determine_rate ( struct clk_hw * hw , const struct freq_tbl * f , struct clk_rate_request * req , const struct parent_map * parent_map ) { unsigned long clk_flags , rate = req -> rate ; struct clk_hw * p ; int index ; f = qcom_find_freq ( f , rate ) ; index = qcom_find_src_index ( hw , parent_map , f -> src ) ; if ( index < 0 ) { return index ; } clk_flags = clk_hw_get_flags ( hw ) ; p = clk_hw_get_parent_by_index ( hw , index ) ; if ( clk_flags & CLK_SET_RATE_PARENT ) { rate = rate * f -> pre_div ; if ( f -> n ) { u64 tmp = rate ; tmp = tmp * f -> n ; do_div ( tmp , f -> m ) ; rate = tmp ; } } else { rate = clk_hw_get_rate ( p ) ; } req -> best_parent_hw = p ; req -> best_parent_rate = rate ; req -> rate = f -> freq ; return 0 ; } 