static void atombios_yuv_setup ( struct drm_encoder * encoder , bool enable ) { struct drm_device * dev = encoder -> dev ; struct radeon_device * rdev = dev -> dev_private ; struct radeon_encoder * radeon_encoder = to_radeon_encoder ( encoder ) ; struct radeon_crtc * radeon_crtc = to_radeon_crtc ( encoder -> crtc ) ; ENABLE_YUV_PS_ALLOCATION args ; int index = GetIndexIntoMasterTable ( COMMAND , EnableYUV ) ; uint32_t temp , reg ; if ( rdev -> family >= CHIP_R600 ) { reg = R600_BIOS_3_SCRATCH ; } else { reg = RADEON_BIOS_3_SCRATCH ; } temp = RREG32 ( reg ) ; if ( radeon_encoder -> active_device & ( ATOM_DEVICE_TV_SUPPORT ) ) { WREG32 ( reg , ( ATOM_S3_TV1_ACTIVE | ( radeon_crtc -> crtc_id << 18 ) ) ) ; } if ( radeon_encoder -> active_device & ( ATOM_DEVICE_CV_SUPPORT ) ) { WREG32 ( reg , ( ATOM_S3_CV_ACTIVE | ( radeon_crtc -> crtc_id << 24 ) ) ) ; } else { WREG32 ( reg , 0 ) ; } if ( enable ) { args . ucEnable = ATOM_ENABLE ; } args . ucCRTC = radeon_crtc -> crtc_id ; atom_execute_table ( rdev -> mode_info . atom_context , index , ( uint32_t * ) & args ) ; WREG32 ( reg , temp ) ; } 