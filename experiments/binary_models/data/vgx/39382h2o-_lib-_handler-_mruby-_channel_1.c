static mrb_value channel_initialize_method ( mrb_state * mrb , mrb_value self ) { h2o_mruby_shared_context_t * shared_ctx = mrb -> ud ; struct st_h2o_mruby_channel_context_t * ctx ; ctx = h2o_mem_alloc ( sizeof ( * ctx ) ) ; assert ( shared_ctx -> current_context != NULL ) ; ctx -> ctx = shared_ctx -> current_context ; ctx -> receivers = mrb_ary_new ( mrb ) ; mrb_gc_register ( mrb , ctx -> receivers ) ; mrb_iv_set ( mrb , self , mrb_intern_lit ( mrb , "@queue" ) , mrb_ary_new ( mrb ) ) ; mrb_data_init ( self , ctx , & channel_type ) ; return self ; } 