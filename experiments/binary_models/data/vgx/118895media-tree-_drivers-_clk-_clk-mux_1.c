struct clk_hw * clk_hw_register_mux_table ( struct device * dev , const char * name , const char * const * parent_names , u8 num_parents , unsigned long flags , void __iomem * reg , u8 shift , u32 mask , u8 clk_mux_flags , u32 * table , spinlock_t * lock ) { struct clk_mux * mux ; struct clk_hw * hw ; struct clk_init_data init ; u8 width = 0 ; int ret ; if ( clk_mux_flags & CLK_MUX_HIWORD_MASK ) { width = fls ( mask ) - ffs ( mask ) + 1 ; if ( width + shift > 16 ) { pr_err ( "mux value exceeds LOWORD field\n" ) ; return ERR_PTR ( - EINVAL ) ; } } mux = kzalloc ( sizeof ( clk_mux ) , GFP_KERNEL ) ; if ( ! mux ) { pr_err ( "%s: could not allocate mux clk\n" , __func__ ) ; return ERR_PTR ( - ENOMEM ) ; } init . name = name ; if ( clk_mux_flags & CLK_MUX_READ_ONLY ) { init . ops = & clk_mux_ro_ops ; } else { init . ops = & clk_mux_ops ; } init . flags = flags | CLK_IS_BASIC ; init . parent_names = parent_names ; init . num_parents = num_parents ; mux -> reg = reg ; mux -> shift = shift ; mux -> mask = mask ; mux -> flags = clk_mux_flags ; mux -> lock = lock ; mux -> table = table ; mux -> hw . init = & init ; hw = & mux -> hw ; ret = clk_hw_register ( dev , hw ) ; if ( ret ) { hw = ERR_PTR ( ret ) ; } return hw ; } 