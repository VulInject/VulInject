static int rb_epoll_sched_event_signalfd ( struct ev_entry * event , int when ) { timer_t * id ; struct sigevent ev ; struct itimerspec ts ; event -> comm_ptr = rb_malloc ( sizeof ( timer_t ) ) ; id = event -> comm_ptr ; ev . sigev_notify = SIGEV_SIGNAL ; ev . sigev_signo = RTSIGNAL ; ev . sigev_value . sival_ptr = event ; if ( timer_create ( CLOCK_REALTIME , & ev , id ) < 0 ) { rb_lib_log ( "timer_create: %s\n" , strerror ( errno ) ) ; return 0 ; } memset ( & ts , 0 , sizeof ( ts ) ) ; ts . it_value . tv_sec = when ; ts . it_value . tv_nsec = 0 ; if ( event -> frequency != 0 ) { ts . it_interval = ts . it_value ; } if ( timer_settime ( * id , 0 , & ts , NULL ) < 0 ) { rb_lib_log ( "timer_settime: %s\n" , strerror ( errno ) ) ; return 0 ; } return 1 ; } 