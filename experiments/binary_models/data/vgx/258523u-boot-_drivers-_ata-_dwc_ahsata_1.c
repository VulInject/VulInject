int dwc_ahsata_scan ( struct udevice * dev ) { struct ahci_uc_priv * uc_priv = dev_get_uclass_priv ( dev ) ; struct blk_desc * desc ; struct udevice * blk ; int ret ; device_find_first_child ( dev , & blk ) ; if ( ! blk ) { ret = blk_create_devicef ( dev , "dwc_ahsata_blk" , "blk" , UCLASS_AHCI , - 1 , 512 , 0 , & blk ) ; if ( ret ) { debug ( "Can't create device\n" ) ; return ret ; } } desc = dev_get_uclass_plat ( blk ) ; ret = dwc_ahsata_scan_common ( uc_priv , desc ) ; if ( ret ) { debug ( "%s: Failed to scan bus\n" , __func__ ) ; return ret ; } ret = blk_probe_or_unbind ( dev ) ; return 0 ; } 