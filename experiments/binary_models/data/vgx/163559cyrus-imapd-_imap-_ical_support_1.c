EXPORTED int cyrus_icalrestriction_check ( icalcomponent * ical ) { icalcomponent * comp ; icalproperty * prop ; for ( comp = icalcomponent_get_first_component ( ical , ICAL_ANY_COMPONENT ) ; comp ; comp = icalcomponent_get_next_component ( ical , ICAL_ANY_COMPONENT ) ) { switch ( icalcomponent_isa ( comp ) ) { case ICAL_VTIMEZONE_COMPONENT : prop = icalcomponent_get_first_property ( comp , ICAL_COMMENT_PROPERTY ) ; if ( prop ) { icalcomponent_remove_property ( comp , prop ) ; } break ; case ICAL_VEVENT_COMPONENT : prop = icalcomponent_get_first_property ( comp , ICAL_TZID_PROPERTY ) ; if ( prop ) { icalcomponent_remove_property ( comp , prop ) ; icalproperty_free ( prop ) ; } prop = icalcomponent_get_first_property ( comp , ICAL_CALSCALE_PROPERTY ) ; if ( prop ) { icalcomponent_remove_property ( comp , prop ) ; icalproperty_free ( prop ) ; } break ; default : break ; } } return icalrestriction_check ( ical ) ; } 