static int osif_probe ( struct usb_interface * interface , const struct usb_device_id * id ) { int ret ; struct osif_priv * priv ; u16 version ; priv = devm_kzalloc ( & interface -> dev , sizeof ( * priv ) , GFP_KERNEL ) ; priv -> usb_dev = usb_get_dev ( interface_to_usbdev ( interface ) ) ; priv -> interface = interface ; usb_set_intfdata ( interface , priv ) ; priv -> adapter . owner = THIS_MODULE ; priv -> adapter . class = I2C_CLASS_HWMON ; priv -> adapter . algo = & osif_algorithm ; priv -> adapter . algo_data = priv ; snprintf ( priv -> adapter . name , sizeof ( priv -> adapter . name ) , "OSIF at bus %03d device %03d" , priv -> usb_dev -> bus -> busnum , priv -> usb_dev -> devnum ) ; ret = osif_usb_read ( & priv -> adapter , OSIFI2C_SET_BIT_RATE , 52 , 0 , NULL , 0 ) ; if ( ret ) { dev_err ( & interface -> dev , "failure sending bit rate" ) ; usb_put_dev ( priv -> usb_dev ) ; return ret ; } i2c_add_adapter ( & ( priv -> adapter ) ) ; version = le16_to_cpu ( priv -> usb_dev -> descriptor . bcdDevice ) ; dev_info ( & interface -> dev , "version %x.%02x found at bus %03d address %03d" , version >> 8 , version & 0xff , priv -> usb_dev -> bus -> busnum , priv -> usb_dev -> devnum ) ; return 0 ; } 