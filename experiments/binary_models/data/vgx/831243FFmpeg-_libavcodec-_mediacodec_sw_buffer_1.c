void ff_mediacodec_sw_buffer_copy_yuv420_semi_planar ( AVCodecContext * avctx , MediaCodecDecContext * s , uint8_t * data , size_t size , FFAMediaCodecBufferInfo * info , AVFrame * frame ) { int i ; uint8_t * src = NULL ; for ( i = 0 ; i < 2 ; i ++ ) { int height ; src = data + info -> offset ; if ( i == 0 ) { height = avctx -> height ; src += s -> crop_top * s -> stride ; src += s -> crop_left ; } if ( i == 1 ) { height = avctx -> height / 2 ; src += s -> slice_height * s -> stride ; src += s -> crop_top * s -> stride ; src += s -> crop_left ; } if ( frame -> linesize [ i ] == s -> stride ) { memcpy ( frame -> data [ i ] , src , height * s -> stride ) ; } else { int j , width ; uint8_t * dst = frame -> data [ i ] ; if ( i == 0 ) { width = avctx -> width ; } if ( i == 1 ) { width = FFMIN ( frame -> linesize [ i ] , FFALIGN ( avctx -> width , 2 ) ) ; } for ( j = 0 ; j < height ; j ++ ) { memcpy ( dst , src , width ) ; src += s -> stride ; dst += frame -> linesize [ i ] ; } } } } 