int mailimap_acl_setacl ( mailimap * session , const char * mailbox , const char * identifier , const char * mod_rights ) { struct mailimap_response * response ; int r ; int error_code ; if ( session -> imap_state != MAILIMAP_STATE_AUTHENTICATED ) { return MAILIMAP_ERROR_BAD_STATE ; } r = mailimap_send_current_tag ( session ) ; if ( r != MAILIMAP_NO_ERROR ) { return r ; } r = mailimap_acl_setacl_send ( session -> imap_stream , mailbox , identifier , mod_rights ) ; if ( r != MAILIMAP_NO_ERROR ) { return r ; } r = mailimap_crlf_send ( session -> imap_stream ) ; if ( r != MAILIMAP_NO_ERROR ) { return r ; } if ( mailimap_read_line ( session ) == NULL ) { return MAILIMAP_ERROR_STREAM ; } r = mailimap_parse_response ( session , & response ) ; if ( r != MAILIMAP_NO_ERROR ) { return r ; } error_code = response -> rsp_resp_done -> rsp_data . rsp_tagged -> rsp_cond_state -> rsp_type ; mailimap_response_free ( response ) ; switch ( error_code ) { case MAILIMAP_RESP_COND_STATE_OK : return MAILIMAP_NO_ERROR ; default : return MAILIMAP_ERROR_EXTENSION ; } } 