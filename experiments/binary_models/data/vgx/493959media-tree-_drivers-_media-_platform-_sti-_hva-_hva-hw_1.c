static unsigned long int hva_hw_get_ip_version ( struct hva_dev * hva ) { struct device * dev = hva_to_dev ( hva ) ; unsigned long int version ; if ( pm_runtime_get_sync ( dev ) < 0 ) { dev_err ( dev , "%s     failed to get pm_runtime\n" , HVA_PREFIX ) ; return - EFAULT ; } version = readl_relaxed ( hva -> regs + HVA_HIF_REG_VERSION ) & VERSION_ID_MASK ; pm_runtime_put_autosuspend ( dev ) ; switch ( version ) { case HVA_VERSION_V400 : dev_dbg ( dev , "%s     IP hardware version 0x%lx\n" , HVA_PREFIX , version ) ; break ; default : dev_err ( dev , "%s     unknown IP hardware version 0x%lx\n" , HVA_PREFIX , version ) ; version = HVA_VERSION_UNKNOWN ; break ; } return version ; } 