int spl_parse_legacy_header ( struct spl_image_info * spl_image , const struct legacy_img_hdr * header ) { u32 header_size = sizeof ( legacy_img_hdr ) ; if ( IS_ENABLED ( CONFIG_SPL_LEGACY_IMAGE_CRC_CHECK ) && ! image_check_hcrc ( header ) ) { puts ( "SPL: Image header CRC check failed!\n" ) ; return - EINVAL ; } if ( spl_image -> flags & SPL_COPY_PAYLOAD_ONLY ) { spl_image -> load_addr = image_get_load ( header ) ; spl_image -> entry_point = image_get_ep ( header ) ; spl_image -> size = image_get_data_size ( header ) ; } else { spl_image -> entry_point = image_get_ep ( header ) ; spl_image -> load_addr = image_get_load ( header ) - header_size ; spl_image -> size = image_get_data_size ( header ) + header_size ; } spl_image -> dcrc_data = image_get_load ( header ) ; spl_image -> dcrc_length = image_get_data_size ( header ) ; spl_image -> dcrc = image_get_dcrc ( header ) ; spl_image -> os = image_get_os ( header , NULL ) ; spl_image -> name = image_get_name ( header ) ; debug ( SPL_TPL_PROMPT "payload image: %32s load addr: 0x%lx size: %d\n" , spl_image -> name , spl_image -> load_addr , spl_image -> size ) ; return 0 ; } 