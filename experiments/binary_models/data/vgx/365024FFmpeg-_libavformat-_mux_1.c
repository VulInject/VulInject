int av_write_frame ( AVFormatContext * s , AVPacket * in ) { FFFormatContext * const si = ffformatcontext ( s ) ; AVPacket * pkt = si -> parse_pkt ; int ret ; if ( ! in ) { if ( s -> oformat -> flags & AVFMT_ALLOW_FLUSH ) { ret = ffofmt ( s -> oformat ) -> write_packet ( s , NULL ) ; flush_if_needed ( s ) ; if ( ret >= 0 && s -> pb && s -> pb -> error < 0 ) { ret = s -> pb -> error ; } return ret ; } return 1 ; } if ( in -> flags & AV_PKT_FLAG_UNCODED_FRAME ) { pkt = in ; } else { pkt -> data = in -> data ; pkt -> size = in -> size ; ret = av_packet_copy_props ( pkt , in ) ; if ( ret < 0 ) { return ret ; } if ( in -> buf ) { pkt -> buf = av_buffer_ref ( in -> buf ) ; if ( ! pkt -> buf ) { ret = AVERROR ( ENOMEM ) ; fail } } } ret = write_packets_common ( s , pkt , 0 ) ; fail return ret ; } 