static int si1133_read_raw ( struct iio_dev * iio_dev , struct iio_chan_spec const * chan , int * val , int * val2 , long mask ) { struct si1133_data * data = iio_priv ( iio_dev ) ; u8 adc_sens = data -> adc_sens [ 0 ] ; int err ; switch ( mask ) { case IIO_CHAN_INFO_PROCESSED : switch ( chan -> type ) { case IIO_LIGHT : err = si1133_get_lux ( data , val ) ; return IIO_VAL_INT ; default : return - EINVAL ; } case IIO_CHAN_INFO_RAW : switch ( chan -> type ) { case IIO_INTENSITY : case IIO_UVINDEX : err = si1133_measure ( data , chan , val ) ; if ( err ) { return err ; } return IIO_VAL_INT ; default : return - EINVAL ; } case IIO_CHAN_INFO_INT_TIME : switch ( chan -> type ) { case IIO_INTENSITY : case IIO_UVINDEX : adc_sens &= SI1133_ADCSENS_HW_GAIN_MASK ; * val = si1133_int_time_table [ adc_sens ] [ 0 ] ; * val2 = si1133_int_time_table [ adc_sens ] [ 1 ] ; return IIO_VAL_INT_PLUS_MICRO ; default : return - EINVAL ; } case IIO_CHAN_INFO_SCALE : switch ( chan -> type ) { case IIO_INTENSITY : case IIO_UVINDEX : adc_sens &= SI1133_ADCSENS_SCALE_MASK ; adc_sens >>= SI1133_ADCSENS_SCALE_SHIFT ; * val = BIT ( adc_sens ) ; return IIO_VAL_INT ; default : return - EINVAL ; } case IIO_CHAN_INFO_HARDWAREGAIN : switch ( chan -> type ) { case IIO_INTENSITY : case IIO_UVINDEX : adc_sens >>= SI1133_ADCSENS_HSIG_SHIFT ; * val = adc_sens ; return IIO_VAL_INT ; default : return - EINVAL ; } default : return - EINVAL ; } } 