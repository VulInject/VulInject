static mutex_t ch_lock = ERRORCHECKMUTEX ; constraint_handler_t set_constraint_handler_s ( constraint_handler_t handler ) { constraint_handler_t * new , * old , ret ; new = malloc ( sizeof ( constraint_handler_t ) ) ; if ( new == NULL ) { return ( NULL ) ; } * new = handler ; mutex_enter ( & ch_lock ) ; old = _ch ; _ch = new ; mutex_exit ( & ch_lock ) ; if ( old == NULL ) { ret = NULL ; } else { ret = * old ; } return ( ret ) ; } 