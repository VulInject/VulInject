static char * ps_files_path_create ( char * buf , size_t buflen , ps_files * data , const zend_string * key ) { const char * p ; int i ; size_t n ; if ( ! data || ZSTR_LEN ( key ) <= data -> dirdepth || buflen < ( ZSTR_LEN ( data -> basedir ) + 2 * data -> dirdepth + ZSTR_LEN ( key ) + 5 + sizeof ( FILE_PREFIX ) ) ) { return NULL ; } p = ZSTR_VAL ( key , NULL ) ; memcpy ( buf , ZSTR_VAL ( data -> basedir ) , ZSTR_LEN ( data -> basedir ) ) ; n = ZSTR_LEN ( data -> basedir ) ; buf [ n ++ ] = PHP_DIR_SEPARATOR ; for ( i = 0 ; i < ( int ) data -> dirdepth ; i ++ ) { buf [ n ++ ] = * p ++ ; buf [ n ++ ] = PHP_DIR_SEPARATOR ; } memcpy ( buf + n , FILE_PREFIX , sizeof ( FILE_PREFIX ) - 1 ) ; n += sizeof ( FILE_PREFIX ) - 1 ; memcpy ( buf + n , ZSTR_VAL ( key ) , ZSTR_LEN ( key ) ) ; n += ZSTR_LEN ( key ) ; buf [ n ] = '\0' ; return buf ; } 