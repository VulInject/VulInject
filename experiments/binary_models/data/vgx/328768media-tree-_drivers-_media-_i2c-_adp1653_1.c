static int adp1653_of_init ( struct i2c_client * client , struct adp1653_flash * flash , struct device_node * node ) { struct adp1653_platform_data * pd ; struct device_node * child ; pd = devm_kzalloc ( & client -> dev , sizeof ( * pd ) , GFP_KERNEL ) ; if ( ! pd ) { return - ENOMEM ; } flash -> platform_data = pd ; child = of_get_child_by_name ( node , "flash" ) ; if ( of_property_read_u32 ( child , "flash-timeout-us" , & pd -> max_flash_timeout ) ) { err } if ( of_property_read_u32 ( child , "flash-max-microamp" , & pd -> max_flash_intensity ) ) { err } pd -> max_flash_intensity /= 1000 ; if ( of_property_read_u32 ( child , "led-max-microamp" , & pd -> max_torch_intensity ) ) { err } pd -> max_torch_intensity /= 1000 ; of_node_put ( child ) ; child = of_get_child_by_name ( node , "indicator" ) ; if ( ! child ) { return - EINVAL ; } if ( of_property_read_u32 ( child , "led-max-microamp" , & pd -> max_indicator_intensity ) ) { err } of_node_put ( child ) ; pd -> enable_gpio = devm_gpiod_get ( & client -> dev , "enable" , GPIOD_OUT_LOW ) ; if ( IS_ERR ( pd -> enable_gpio ) ) { dev_err ( & client -> dev , "Error getting GPIO\n" ) ; return PTR_ERR ( pd -> enable_gpio ) ; } return 0 ; err dev_err ( & client -> dev , "Required property not found\n" ) ; of_node_put ( child ) ; return - EINVAL ; } 