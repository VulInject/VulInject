static int vprbrd_gpio_probe ( struct platform_device * pdev ) { struct vprbrd * vb = dev_get_drvdata ( pdev -> dev . parent ) ; struct vprbrd_gpio * vb_gpio ; int ret ; vb_gpio = devm_kzalloc ( & pdev -> dev , sizeof ( * vb_gpio ) , GFP_KERNEL ) ; vb_gpio -> vb = vb ; vb_gpio -> gpioa . label = "viperboard gpio a" ; vb_gpio -> gpioa . parent = & pdev -> dev ; vb_gpio -> gpioa . owner = THIS_MODULE ; vb_gpio -> gpioa . base = - 1 ; vb_gpio -> gpioa . ngpio = 16 ; vb_gpio -> gpioa . can_sleep = true ; vb_gpio -> gpioa . set = vprbrd_gpioa_set ; vb_gpio -> gpioa . get = vprbrd_gpioa_get ; vb_gpio -> gpioa . direction_input = vprbrd_gpioa_direction_input ; vb_gpio -> gpioa . direction_output = vprbrd_gpioa_direction_output ; ret = devm_gpiochip_add_data ( & pdev -> dev , & vb_gpio -> gpioa , vb_gpio ) ; if ( ret < 0 ) { return ret ; } vb_gpio -> gpiob . label = "viperboard gpio b" ; vb_gpio -> gpiob . parent = & pdev -> dev ; vb_gpio -> gpiob . owner = THIS_MODULE ; vb_gpio -> gpiob . base = - 1 ; vb_gpio -> gpiob . ngpio = 16 ; vb_gpio -> gpiob . can_sleep = true ; vb_gpio -> gpiob . set = vprbrd_gpiob_set ; vb_gpio -> gpiob . get = vprbrd_gpiob_get ; vb_gpio -> gpiob . direction_input = vprbrd_gpiob_direction_input ; vb_gpio -> gpiob . direction_output = vprbrd_gpiob_direction_output ; return devm_gpiochip_add_data ( & pdev -> dev , & vb_gpio -> gpiob , vb_gpio ) ; } 