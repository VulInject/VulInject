int radeon_vce_ring_test ( struct radeon_device * rdev , struct radeon_ring * ring ) { uint32_t rptr = vce_v1_0_get_rptr ( rdev , ring ) ; int i ; int r ; r = radeon_ring_lock ( rdev , ring , 16 ) ; if ( r ) { DRM_ERROR ( "radeon: vce failed to lock ring %d (%d).\n" , ring -> idx , r ) ; return r ; } radeon_ring_write ( ring , cpu_to_le32 ( VCE_CMD_END ) ) ; radeon_ring_unlock_commit ( rdev , ring , false ) ; for ( i = 0 ; i < rdev -> usec_timeout ; i ++ ) { if ( vce_v1_0_get_rptr ( rdev , ring ) != rptr ) { break ; } udelay ( 1 ) ; } if ( i < rdev -> usec_timeout ) { DRM_INFO ( "ring test on %d succeeded in %d usecs\n" , ring -> idx , i ) ; } else { DRM_ERROR ( "radeon: ring %d test failed\n" , ring -> idx ) ; r = - ETIMEDOUT ; } return r ; } 