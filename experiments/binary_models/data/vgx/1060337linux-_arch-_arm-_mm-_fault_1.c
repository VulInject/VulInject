static vm_fault_t __kprobes __do_page_fault ( struct mm_struct * mm , unsigned long addr , unsigned int flags , unsigned long vma_flags , struct pt_regs * regs ) { struct vm_area_struct * vma = find_vma ( mm , addr ) ; if ( unlikely ( ! vma ) ) { return VM_FAULT_BADMAP ; } if ( unlikely ( vma -> vm_start > addr ) ) { if ( addr < FIRST_USER_ADDRESS ) { return VM_FAULT_BADMAP ; } if ( expand_stack ( vma , addr ) ) { return VM_FAULT_BADMAP ; } } if ( ! ( vma -> vm_flags & vma_flags ) ) { return VM_FAULT_BADACCESS ; } return handle_mm_fault ( vma , addr & PAGE_MASK , flags , regs ) ; } 