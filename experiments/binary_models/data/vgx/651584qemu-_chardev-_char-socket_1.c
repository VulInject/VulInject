static gboolean tcp_chr_telnet_init_io ( QIOChannel * ioc , GIOCondition cond G_GNUC_UNUSED , gpointer user_data ) { SocketChardev * s = user_data ; Chardev * chr = CHARDEV ( s ) ; TCPChardevTelnetInit * init = s -> telnet_init ; ssize_t ret ; assert ( init ) ; ret = qio_channel_write ( ioc , init -> buf , init -> buflen , NULL ) ; if ( ret < 0 ) { if ( ret == QIO_CHANNEL_ERR_BLOCK ) { ret = 0 ; } else { tcp_chr_disconnect ( chr ) ; end } } init -> buflen -= ret ; if ( init -> buflen == 0 ) { tcp_chr_connect ( chr ) ; end } memmove ( init -> buf , init -> buf + ret , init -> buflen ) ; return G_SOURCE_CONTINUE ; end g_free ( s -> telnet_init ) ; g_source_unref ( s -> telnet_source ) ; s -> telnet_source = NULL ; return G_SOURCE_REMOVE ; } 