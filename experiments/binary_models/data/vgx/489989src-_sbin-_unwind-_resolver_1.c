void free_resolver ( struct uw_resolver * res ) { struct val_env * val_env ; if ( res == NULL ) { return ; } if ( res -> ref_cnt > 0 ) { res -> stop = 1 ; } else { evtimer_del ( & res -> check_ev ) ; if ( res -> ctx != NULL ) { if ( res -> ctx -> env -> msg_cache == unified_msg_cache ) { val_env = ( val_env * ) res -> ctx -> env -> modinfo [ val_id ] ; res -> ctx -> env -> msg_cache = NULL ; res -> ctx -> env -> rrset_cache = NULL ; res -> ctx -> env -> key_cache = NULL ; val_env -> neg_cache = NULL ; res -> ctx -> env -> neg_cache = NULL ; } } ub_ctx_delete ( res -> ctx ) ; asr_resolver_free ( res -> asr_ctx ) ; free ( res ) ; } } 