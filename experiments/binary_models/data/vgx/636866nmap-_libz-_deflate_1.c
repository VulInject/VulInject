uLong ZEXPORT deflateBound ( strm , sourceLen ) z_streamp strm ; uLong sourceLen ; { deflate_state * s ; uLong complen , wraplen ; complen = sourceLen + ( ( sourceLen + 7 ) >> 3 ) + ( ( sourceLen + 63 ) >> 6 ) + 5 ; s = strm -> state ; switch ( s -> wrap ) { case 0 : wraplen = 0 ; break ; case 1 : wraplen = 6 + ( s -> strstart ?4 : 0 ) ; break ; case 2 : wraplen = 18 ; if ( s -> gzhead != Z_NULL ) { Bytef * str ; if ( s -> gzhead -> extra != Z_NULL ) { wraplen += 2 + s -> gzhead -> extra_len ; } str = s -> gzhead -> name ; if ( str != Z_NULL ) { { wraplen ++ ; } * str ++ ; } str = s -> gzhead -> comment ; if ( str != Z_NULL ) { { wraplen ++ ; } * str ++ ; } if ( s -> gzhead -> hcrc ) { wraplen += 2 ; } } break ; default : wraplen = 6 ; } if ( s -> w_bits != 15 || s -> hash_bits != 8 + 7 ) { return complen + wraplen ; } return sourceLen + ( sourceLen >> 12 ) + ( sourceLen >> 14 ) + ( sourceLen >> 25 ) + 13 - 6 + wraplen ; } 