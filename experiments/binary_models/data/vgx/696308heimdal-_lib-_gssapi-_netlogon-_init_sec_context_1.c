static OM_uint32 _netlogon_read_initial_auth_message ( OM_uint32 * minor_status , gssnetlogon_ctx ctx , const gss_buffer_t input_token ) { NL_AUTH_MESSAGE msg ; const uint8_t * p = ( const uint8_t * ) input_token -> value ; if ( ctx -> State != NL_AUTH_NEGOTIATE ) { * minor_status = EINVAL ; return GSS_S_FAILURE ; } _gss_mg_decode_le_uint32 ( & p [ 0 ] , & msg . MessageType ) ; _gss_mg_decode_le_uint32 ( & p [ 4 ] , & msg . Flags ) ; if ( msg . MessageType != NL_NEGOTIATE_RESPONSE_MESSAGE || msg . Flags != 0 ) { return GSS_S_DEFECTIVE_TOKEN ; } ctx -> State = NL_AUTH_ESTABLISHED ; * minor_status = 0 ; return GSS_S_COMPLETE ; } 