tbitset_list ( , , , ) { if ( TBITSET_ZERO_P ( bset ) ) { return 0 ; } bitset_bindex bitno = * next ; bitset_bindex count = 0 ; tbitset_elts * elts = TBITSET_ELTS ( bset ) ; bitset_windex size = TBITSET_SIZE ( bset ) ; bitset_windex eindex = bitno / TBITSET_ELT_BITS ; if ( bitno % TBITSET_ELT_BITS ) { tbitset_elt * elt = elts [ eindex ] ; if ( elt ) { bitset_word * srcp = TBITSET_WORDS ( elt ) ; bitset_windex woffset = eindex * TBITSET_ELT_WORDS ; for ( bitset_windex windex = bitno / BITSET_WORD_BITS ; ( windex - woffset ) < TBITSET_ELT_WORDS ; windex ++ ) { bitset_word word = srcp [ windex - woffset ] >> ( bitno % BITSET_WORD_BITS ) ; BITSET_FOR_EACH_BIT ( , ) { list [ count ++ ] = bitno + pos ; if ( count >= num ) { * next = bitno + pos + 1 ; return count ; } } bitno = ( windex + 1 ) * BITSET_WORD_BITS ; } } eindex ++ ; } for ( ; eindex < size ; eindex ++ ) { tbitset_elt * elt = elts [ eindex ] ; bitset_word * srcp = TBITSET_WORDS ( elt ) ; bitset_windex windex = eindex * TBITSET_ELT_WORDS ; bitno = windex * BITSET_WORD_BITS ; if ( ( count + TBITSET_ELT_BITS ) < num ) { bitset_word word = srcp [ 0 ] ; if ( word ) { BITSET_FOR_EACH_BIT ( , ) list [ count ++ ] = bitno + pos ; } windex ++ ; bitno = windex * BITSET_WORD_BITS ; word = srcp [ 1 ] ; if ( word ) { BITSET_FOR_EACH_BIT ( , ) list [ count ++ ] = bitno + pos ; } windex ++ ; bitno = windex * BITSET_WORD_BITS ; for ( int i = 0 ; i < TBITSET_ELT_WORDS ; i ++ , windex ++ ) { bitset_word word = srcp [ i ] ; if ( word ) { BITSET_FOR_EACH_BIT ( , ) list [ count ++ ] = bitno + pos ; } bitno = windex * BITSET_WORD_BITS ; } } else { for ( int i = 0 ; i < TBITSET_ELT_WORDS ; i ++ ) { bitset_word word = srcp [ i ] ; if ( word ) { BITSET_FOR_EACH_BIT ( , ) { list [ count ++ ] = bitno + pos ; if ( count >= num ) { * next = bitno + pos + 1 ; return count ; } } } windex ++ ; bitno = windex * BITSET_WORD_BITS ; } } } * next = bitno ; return count ; } 