static int vblank_ctrl_queue_work ( struct msm_drm_private * priv , int crtc_id , bool enable ) { struct msm_vblank_ctrl * vbl_ctrl = & priv -> vblank_ctrl ; struct vblank_event * vbl_ev ; unsigned long flags ; vbl_ev = kzalloc ( sizeof ( * vbl_ev ) , GFP_ATOMIC ) ; vbl_ev -> crtc_id = crtc_id ; vbl_ev -> enable = enable ; spin_lock_irqsave ( & vbl_ctrl -> lock , flags ) ; list_add_tail ( & vbl_ev -> node , & vbl_ctrl -> event_list ) ; spin_unlock_irqrestore ( & vbl_ctrl -> lock , flags ) ; queue_work ( priv -> wq , & vbl_ctrl -> work ) ; return 0 ; } 