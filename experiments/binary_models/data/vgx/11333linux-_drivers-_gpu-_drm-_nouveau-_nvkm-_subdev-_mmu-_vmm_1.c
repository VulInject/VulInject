struct nvkm_vma * nvkm_vmm_node_split ( struct nvkm_vmm * vmm , struct nvkm_vma * vma , u64 addr , u64 size ) { struct nvkm_vma * prev = NULL ; if ( vma -> addr != addr ) { prev = vma ; if ( ! ( vma = nvkm_vma_tail ( vma , vma -> size + vma -> addr - addr ) ) ) { return NULL ; } vma -> part = true ; nvkm_vmm_node_insert ( vmm , vma ) ; } if ( vma -> size != size ) { struct nvkm_vma * tmp ; if ( ! ( tmp = nvkm_vma_tail ( vma , vma -> size - size ) ) ) { nvkm_vmm_node_merge ( vmm , prev , vma , vma -> size ) ; return NULL ; } tmp -> part = true ; nvkm_vmm_node_insert ( vmm , tmp ) ; } return vma ; } 