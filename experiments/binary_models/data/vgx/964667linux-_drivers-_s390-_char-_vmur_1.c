static int __init ur_init ( void ) { int rc ; dev_t dev ; if ( ! MACHINE_IS_VM ) { pr_err ( "The %s cannot be loaded without z/VM\n" , ur_banner ) ; return - ENODEV ; } vmur_dbf = debug_register ( "vmur" , 4 , 1 , 4 * sizeof ( long ) ) ; rc = debug_register_view ( vmur_dbf , & debug_sprintf_view ) ; if ( rc ) { fail_free_dbf } debug_set_level ( vmur_dbf , 6 ) ; vmur_class = class_create ( THIS_MODULE , "vmur" ) ; if ( IS_ERR ( vmur_class ) ) { rc = PTR_ERR ( vmur_class ) ; fail_free_dbf } rc = ccw_driver_register ( & ur_driver ) ; if ( rc ) { fail_class_destroy } rc = alloc_chrdev_region ( & dev , 0 , NUM_MINORS , "vmur" ) ; if ( rc ) { pr_err ( "Kernel function alloc_chrdev_region failed with " "error code %d\n" , rc ) ; fail_unregister_driver } ur_first_dev_maj_min = MKDEV ( MAJOR ( dev ) , 0 ) ; pr_info ( "%s loaded.\n" , ur_banner ) ; return 0 ; fail_unregister_driver ccw_driver_unregister ( & ur_driver ) ; fail_class_destroy class_destroy ( vmur_class ) ; fail_free_dbf debug_unregister ( vmur_dbf ) ; return rc ; } 