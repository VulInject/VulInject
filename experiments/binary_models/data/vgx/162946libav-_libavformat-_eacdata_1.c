static int cdata_read_header ( AVFormatContext * s ) { CdataDemuxContext * cdata = s -> priv_data ; AVIOContext * pb = s -> pb ; unsigned int sample_rate , header ; AVStream * st ; header = avio_rb16 ( pb ) ; switch ( header ) { case 0x0400 : cdata -> channels = 1 ; break ; case 0x0404 : cdata -> channels = 2 ; break ; case 0x040C : cdata -> channels = 4 ; break ; default : av_log ( s , AV_LOG_INFO , "unknown header 0x%04x\n" , header ) ; return - 1 ; } sample_rate = avio_rb16 ( pb ) ; avio_skip ( pb , 12 ) ; st = avformat_new_stream ( s , NULL ) ; if ( ! st ) { return AVERROR ( ENOMEM ) ; } st -> codecpar -> codec_type = AVMEDIA_TYPE_AUDIO ; st -> codecpar -> codec_tag = 0 ; st -> codecpar -> codec_id = AV_CODEC_ID_ADPCM_EA_XAS ; st -> codecpar -> channels = cdata -> channels ; st -> codecpar -> sample_rate = sample_rate ; avpriv_set_pts_info ( st , 64 , 1 , sample_rate ) ; return 0 ; } 