unsigned long get_wchan ( struct task_struct * p ) { unsigned long ebp , esp , eip ; unsigned long stack_page ; int count = 0 ; if ( ! p || p == current || p -> state == TASK_RUNNING ) { return 0 ; } stack_page = ( unsigned long ) p ; esp = p -> thread . esp ; ebp = * ( unsigned long * ) esp ; { if ( ebp ( stack_page || ebp ) 8184 + stack_page ) { return 0 ; } eip = * ( unsigned long * ) ( ebp + 4 ) ; if ( ! in_sched_functions ( eip ) ) { return eip ; } ebp = * ( unsigned long * ) ebp ; } count ++ < 16 ; return 0 ; } 