static int be_probe ( struct pci_dev * pdev , const struct pci_device_id * pdev_id ) { struct be_adapter * adapter ; struct net_device * netdev ; int status = 0 ; status = pci_enable_device ( pdev ) ; if ( status ) { do_none } status = pci_request_regions ( pdev , DRV_NAME ) ; if ( status ) { disable_dev } pci_set_master ( pdev ) ; netdev = alloc_etherdev_mqs ( sizeof ( * adapter ) , MAX_TX_QS , MAX_RX_QS ) ; if ( ! netdev ) { status = - ENOMEM ; rel_reg } adapter = netdev_priv ( netdev ) ; adapter -> pdev = pdev ; pci_set_drvdata ( pdev , adapter ) ; adapter -> netdev = netdev ; SET_NETDEV_DEV ( netdev , & pdev -> dev ) ; status = dma_set_mask_and_coherent ( & pdev -> dev , DMA_BIT_MASK ( 64 ) ) ; if ( status ) { dev_err ( & pdev -> dev , "Could not set PCI DMA Mask\n" ) ; free_netdev } status = pci_enable_pcie_error_reporting ( pdev ) ; if ( ! status ) { dev_info ( & pdev -> dev , "PCIe error reporting enabled\n" ) ; } status = be_map_pci_bars ( adapter ) ; if ( status ) { free_netdev } status = be_drv_init ( adapter ) ; if ( status ) { unmap_bars } status = be_setup ( adapter ) ; if ( status ) { drv_cleanup } be_netdev_init ( netdev ) ; status = register_netdev ( netdev ) ; if ( status != 0 ) { unsetup } be_roce_dev_add ( adapter ) ; be_schedule_err_detection ( adapter , ERR_DETECTION_DELAY ) ; adapter -> error_recovery . probe_time = jiffies ; if ( be_physfn ( adapter ) && IS_ENABLED ( CONFIG_BE2NET_HWMON ) ) { adapter -> hwmon_info . hwmon_dev = devm_hwmon_device_register_with_groups ( & pdev -> dev , DRV_NAME , adapter , be_hwmon_groups ) ; adapter -> hwmon_info . be_on_die_temp = BE_INVALID_DIE_TEMP ; } dev_info ( & pdev -> dev , "%s: %s %s port %c\n" , nic_name ( pdev ) , func_name ( adapter ) , mc_name ( adapter ) , adapter -> port_name ) ; return 0 ; unsetup be_clear ( adapter ) ; drv_cleanup be_drv_cleanup ( adapter ) ; unmap_bars be_unmap_pci_bars ( adapter ) ; free_netdev pci_disable_pcie_error_reporting ( pdev ) ; rel_reg pci_release_regions ( pdev ) ; disable_dev pci_disable_device ( pdev ) ; do_none dev_err ( & pdev -> dev , "%s initialization failed\n" , nic_name ( pdev ) ) ; return status ; } 