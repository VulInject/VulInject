static ssize_t store_shost_eh_deadline ( struct device * dev , struct device_attribute * attr , const char * buf , size_t count ) { struct Scsi_Host * shost = class_to_shost ( dev ) ; int ret = - EINVAL ; unsigned long deadline , flags ; if ( shost -> transportt && ( shost -> transportt -> eh_strategy_handler || ! shost -> hostt -> eh_host_reset_handler ) ) { return ret ; } if ( ! strncmp ( buf , "off" , strlen ( "off" ) ) ) { deadline = - 1 ; } else { ret = kstrtoul ( buf , 10 , & deadline ) ; if ( deadline * HZ > UINT_MAX ) { return - EINVAL ; } } spin_lock_irqsave ( shost -> host_lock , flags ) ; if ( scsi_host_in_recovery ( shost ) ) { ret = - EBUSY ; } else { if ( deadline == - 1 ) { shost -> eh_deadline = - 1 ; } else { shost -> eh_deadline = deadline * HZ ; } ret = count ; } spin_unlock_irqrestore ( shost -> host_lock , flags ) ; return ret ; } 