static int meson_pinconf_get_drive_strength ( struct meson_pinctrl * pc , unsigned int pin , u16 * drive_strength_ua ) { struct meson_bank * bank ; unsigned int reg , bit ; unsigned int val ; int ret ; ret = meson_get_bank ( pc , pin , & bank ) ; if ( ret ) { return ret ; } meson_calc_reg_and_bit ( bank , pin , MESON_REG_DS , & reg , & bit ) ; ret = regmap_read ( pc -> reg_ds , reg , & val ) ; if ( ret ) { return ret ; } switch ( ( val >> bit ) & 0x3 ) { case MESON_PINCONF_DRV_500UA : * drive_strength_ua = 500 ; break ; case MESON_PINCONF_DRV_2500UA : * drive_strength_ua = 2500 ; break ; case MESON_PINCONF_DRV_3000UA : * drive_strength_ua = 3000 ; break ; case MESON_PINCONF_DRV_4000UA : * drive_strength_ua = 4000 ; break ; default : return - EINVAL ; } return 0 ; } 