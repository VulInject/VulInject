static bool index_unchanged_by_update ( ResultRelInfo * resultRelInfo , EState * estate , IndexInfo * indexInfo , Relation indexRelation ) { Bitmapset * updatedCols ; Bitmapset * extraUpdatedCols ; Bitmapset * allUpdatedCols ; bool hasexpression = false ; List * idxExprs ; indexInfo -> ii_CheckedUnchanged = true ; updatedCols = ExecGetUpdatedCols ( resultRelInfo , estate ) ; extraUpdatedCols = ExecGetExtraUpdatedCols ( resultRelInfo , estate ) ; for ( int attr = 0 ; attr < indexInfo -> ii_NumIndexKeyAttrs ; attr ++ ) { int keycol = indexInfo -> ii_IndexAttrNumbers [ attr ] ; if ( keycol <= 0 ) { hasexpression = true ; continue ; } if ( bms_is_member ( keycol - FirstLowInvalidHeapAttributeNumber , updatedCols ) || bms_is_member ( keycol - FirstLowInvalidHeapAttributeNumber , extraUpdatedCols ) ) { indexInfo -> ii_IndexUnchanged = false ; return false ; } } if ( ! hasexpression ) { indexInfo -> ii_IndexUnchanged = true ; return true ; } if ( ! extraUpdatedCols ) { allUpdatedCols = updatedCols ; } else { allUpdatedCols = bms_union ( updatedCols , extraUpdatedCols ) ; } idxExprs = RelationGetIndexExpressions ( indexRelation ) ; hasexpression = index_expression_changed_walker ( ( Node * ) idxExprs , allUpdatedCols ) ; list_free ( idxExprs ) ; if ( extraUpdatedCols ) { bms_free ( allUpdatedCols ) ; } if ( hasexpression ) { indexInfo -> ii_IndexUnchanged = false ; return false ; } indexInfo -> ii_IndexUnchanged = true ; return true ; } 