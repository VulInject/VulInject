static void isci_task_refuse ( struct isci_host * ihost , struct sas_task * task , enum service_response response , enum exec_status status ) { cfs_time_t flags ; dev_dbg ( & ihost -> pdev -> dev , "%s: task = %p, response=%d, status=%d\n" , __func__ , task , response , status ) ; spin_lock_irqsave ( & task -> task_state_lock , flags ) ; task -> task_status . resp = response ; task -> task_status . stat = status ; task -> task_state_flags |= SAS_TASK_STATE_DONE ; task -> task_state_flags &= ~ SAS_TASK_STATE_PENDING ; task -> lldd_task = NULL ; spin_unlock_irqrestore ( & task -> task_state_lock , flags ) ; task -> task_done ( task ) ; } 