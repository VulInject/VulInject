void * xmalloc ( size_t size ) int ip_v4 = 0 ; int ip_v6 = 0 ; int ip_both = 1 ; struct dict seen ; int spfwalk ( int argc , struct parameter * argv ) { struct target tgt ; const char * ip_family = NULL ; char * line ; size_t linesize = 0 ; ssize_t linelen ; if ( argv ) { ip_family = argv [ 0 ] . u . u_str ; } if ( ip_family ) { if ( strcmp ( ip_family , "-4" ) == 0 ) { ip_both = 0 ; ip_v4 = 1 ; } if ( strcmp ( ip_family , "-6" ) == 0 ) { ip_both = 0 ; ip_v6 = 1 ; } else { errx ( 1 , "invalid ip_family" ) ; } } dict_init ( & seen ) ; event_init ( ) ; tgt . cidr4 = tgt . cidr6 = - 1 ; tgt . dispatch = dispatch_txt ; while ( ( linelen = getline ( & line , & linesize , stdin ) ) != - 1 ) { while ( linelen -- > 0 && isspace ( ( unsigned char ) line [ linelen ] ) ) { line [ linelen ] = '\0' ; } if ( linelen > 0 ) { lookup_record ( T_TXT , line , & tgt ) ; } } free ( line ) ; if ( pledge ( "dns stdio" , NULL ) == - 1 ) { err ( 1 , "pledge" ) ; } event_dispatch ( ) ; return 0 ; } 