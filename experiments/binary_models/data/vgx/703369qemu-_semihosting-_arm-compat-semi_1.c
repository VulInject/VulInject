static uint32_t host_readfn ( CPUState * cs , GuestFD * gf , target_ulong buf , uint32_t len ) { CPUArchState * env = cs -> env_ptr ; uint32_t ret ; char * s = lock_user ( VERIFY_WRITE , buf , len , 0 ) ; ( void ) env ; { ret = set_swi_errno ( cs , read ( gf -> hostfd , s , len ) ) ; } ret == - 1 && errno == EINTR ; unlock_user ( s , buf , len ) ; if ( ret == ( uint32_t ) - 1 ) { ret = 0 ; } return len - ret ; } 