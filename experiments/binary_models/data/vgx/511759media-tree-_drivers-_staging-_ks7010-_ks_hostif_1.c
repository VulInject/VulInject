void hostif_sme_set_rsn ( struct ks_wlan_private * priv , int type ) { struct wpa_suite_t wpa_suite ; struct rsn_mode_t rsn_mode ; u32 val ; switch ( type ) { case SME_RSN_UCAST_REQUEST : wpa_suite . size = cpu_to_le16 ( ( uint16_t ) 1 ) ; switch ( priv -> wpa . pairwise_suite ) { case IW_AUTH_CIPHER_NONE : if ( priv -> wpa . version == IW_AUTH_WPA_VERSION_WPA2 ) { memcpy ( & wpa_suite . suite [ 0 ] [ 0 ] , CIPHER_ID_WPA2_NONE , CIPHER_ID_LEN ) ; } else { memcpy ( & wpa_suite . suite [ 0 ] [ 0 ] , CIPHER_ID_WPA_NONE , CIPHER_ID_LEN ) ; } break ; case IW_AUTH_CIPHER_WEP40 : if ( priv -> wpa . version == IW_AUTH_WPA_VERSION_WPA2 ) { memcpy ( & wpa_suite . suite [ 0 ] [ 0 ] , CIPHER_ID_WPA2_WEP40 , CIPHER_ID_LEN ) ; } else { memcpy ( & wpa_suite . suite [ 0 ] [ 0 ] , CIPHER_ID_WPA_WEP40 , CIPHER_ID_LEN ) ; } break ; case IW_AUTH_CIPHER_TKIP : if ( priv -> wpa . version == IW_AUTH_WPA_VERSION_WPA2 ) { memcpy ( & wpa_suite . suite [ 0 ] [ 0 ] , CIPHER_ID_WPA2_TKIP , CIPHER_ID_LEN ) ; } else { memcpy ( & wpa_suite . suite [ 0 ] [ 0 ] , CIPHER_ID_WPA_TKIP , CIPHER_ID_LEN ) ; } break ; case IW_AUTH_CIPHER_CCMP : if ( priv -> wpa . version == IW_AUTH_WPA_VERSION_WPA2 ) { memcpy ( & wpa_suite . suite [ 0 ] [ 0 ] , CIPHER_ID_WPA2_CCMP , CIPHER_ID_LEN ) ; } else { memcpy ( & wpa_suite . suite [ 0 ] [ 0 ] , CIPHER_ID_WPA_CCMP , CIPHER_ID_LEN ) ; } break ; case IW_AUTH_CIPHER_WEP104 : if ( priv -> wpa . version == IW_AUTH_WPA_VERSION_WPA2 ) { memcpy ( & wpa_suite . suite [ 0 ] [ 0 ] , CIPHER_ID_WPA2_WEP104 , CIPHER_ID_LEN ) ; } else { memcpy ( & wpa_suite . suite [ 0 ] [ 0 ] , CIPHER_ID_WPA_WEP104 , CIPHER_ID_LEN ) ; } break ; } hostif_mib_set_request ( priv , DOT11_RSN_CONFIG_UNICAST_CIPHER , sizeof ( wpa_suite . size ) + CIPHER_ID_LEN * wpa_suite . size , MIB_VALUE_TYPE_OSTRING , & wpa_suite ) ; break ; case SME_RSN_MCAST_REQUEST : switch ( priv -> wpa . group_suite ) { case IW_AUTH_CIPHER_NONE : if ( priv -> wpa . version == IW_AUTH_WPA_VERSION_WPA2 ) { memcpy ( & wpa_suite . suite [ 0 ] [ 0 ] , CIPHER_ID_WPA2_NONE , CIPHER_ID_LEN ) ; } else { memcpy ( & wpa_suite . suite [ 0 ] [ 0 ] , CIPHER_ID_WPA_NONE , CIPHER_ID_LEN ) ; } break ; case IW_AUTH_CIPHER_WEP40 : if ( priv -> wpa . version == IW_AUTH_WPA_VERSION_WPA2 ) { memcpy ( & wpa_suite . suite [ 0 ] [ 0 ] , CIPHER_ID_WPA2_WEP40 , CIPHER_ID_LEN ) ; } else { memcpy ( & wpa_suite . suite [ 0 ] [ 0 ] , CIPHER_ID_WPA_WEP40 , CIPHER_ID_LEN ) ; } break ; case IW_AUTH_CIPHER_TKIP : if ( priv -> wpa . version == IW_AUTH_WPA_VERSION_WPA2 ) { memcpy ( & wpa_suite . suite [ 0 ] [ 0 ] , CIPHER_ID_WPA2_TKIP , CIPHER_ID_LEN ) ; } else { memcpy ( & wpa_suite . suite [ 0 ] [ 0 ] , CIPHER_ID_WPA_TKIP , CIPHER_ID_LEN ) ; } break ; case IW_AUTH_CIPHER_CCMP : if ( priv -> wpa . version == IW_AUTH_WPA_VERSION_WPA2 ) { memcpy ( & wpa_suite . suite [ 0 ] [ 0 ] , CIPHER_ID_WPA2_CCMP , CIPHER_ID_LEN ) ; } else { memcpy ( & wpa_suite . suite [ 0 ] [ 0 ] , CIPHER_ID_WPA_CCMP , CIPHER_ID_LEN ) ; } break ; case IW_AUTH_CIPHER_WEP104 : if ( priv -> wpa . version == IW_AUTH_WPA_VERSION_WPA2 ) { memcpy ( & wpa_suite . suite [ 0 ] [ 0 ] , CIPHER_ID_WPA2_WEP104 , CIPHER_ID_LEN ) ; } else { memcpy ( & wpa_suite . suite [ 0 ] [ 0 ] , CIPHER_ID_WPA_WEP104 , CIPHER_ID_LEN ) ; } break ; } hostif_mib_set_request ( priv , DOT11_RSN_CONFIG_MULTICAST_CIPHER , CIPHER_ID_LEN , MIB_VALUE_TYPE_OSTRING , & wpa_suite . suite [ 0 ] [ 0 ] ) ; break ; case SME_RSN_AUTH_REQUEST : wpa_suite . size = cpu_to_le16 ( ( uint16_t ) 1 ) ; switch ( priv -> wpa . key_mgmt_suite ) { case IW_AUTH_KEY_MGMT_802_1X : if ( priv -> wpa . version == IW_AUTH_WPA_VERSION_WPA2 ) { memcpy ( & wpa_suite . suite [ 0 ] [ 0 ] , KEY_MGMT_ID_WPA2_1X , KEY_MGMT_ID_LEN ) ; } else { memcpy ( & wpa_suite . suite [ 0 ] [ 0 ] , KEY_MGMT_ID_WPA_1X , KEY_MGMT_ID_LEN ) ; } break ; case IW_AUTH_KEY_MGMT_PSK : if ( priv -> wpa . version == IW_AUTH_WPA_VERSION_WPA2 ) { memcpy ( & wpa_suite . suite [ 0 ] [ 0 ] , KEY_MGMT_ID_WPA2_PSK , KEY_MGMT_ID_LEN ) ; } else { memcpy ( & wpa_suite . suite [ 0 ] [ 0 ] , KEY_MGMT_ID_WPA_PSK , KEY_MGMT_ID_LEN ) ; } break ; case 0 : if ( priv -> wpa . version == IW_AUTH_WPA_VERSION_WPA2 ) { memcpy ( & wpa_suite . suite [ 0 ] [ 0 ] , KEY_MGMT_ID_WPA2_NONE , KEY_MGMT_ID_LEN ) ; } else { memcpy ( & wpa_suite . suite [ 0 ] [ 0 ] , KEY_MGMT_ID_WPA_NONE , KEY_MGMT_ID_LEN ) ; } break ; case 4 : if ( priv -> wpa . version == IW_AUTH_WPA_VERSION_WPA2 ) { memcpy ( & wpa_suite . suite [ 0 ] [ 0 ] , KEY_MGMT_ID_WPA2_WPANONE , KEY_MGMT_ID_LEN ) ; } else { memcpy ( & wpa_suite . suite [ 0 ] [ 0 ] , KEY_MGMT_ID_WPA_WPANONE , KEY_MGMT_ID_LEN ) ; } break ; } hostif_mib_set_request ( priv , DOT11_RSN_CONFIG_AUTH_SUITE , sizeof ( wpa_suite . size ) + KEY_MGMT_ID_LEN * wpa_suite . size , MIB_VALUE_TYPE_OSTRING , & wpa_suite ) ; break ; case SME_RSN_ENABLED_REQUEST : val = cpu_to_le32 ( ( uint32_t ) ( priv -> wpa . rsn_enabled ) ) ; hostif_mib_set_request ( priv , DOT11_RSN_ENABLED , sizeof ( val ) , MIB_VALUE_TYPE_BOOL , & val ) ; break ; case SME_RSN_MODE_REQUEST : if ( priv -> wpa . version == IW_AUTH_WPA_VERSION_WPA2 ) { rsn_mode . rsn_mode = cpu_to_le32 ( ( uint32_t ) RSN_MODE_WPA2 ) ; rsn_mode . rsn_capability = cpu_to_le16 ( ( uint16_t ) 0 ) ; } if ( priv -> wpa . version == IW_AUTH_WPA_VERSION_WPA ) { rsn_mode . rsn_mode = cpu_to_le32 ( ( uint32_t ) RSN_MODE_WPA ) ; rsn_mode . rsn_capability = cpu_to_le16 ( ( uint16_t ) 0 ) ; } else { rsn_mode . rsn_mode = cpu_to_le32 ( ( uint32_t ) RSN_MODE_NONE ) ; rsn_mode . rsn_capability = cpu_to_le16 ( ( uint16_t ) 0 ) ; } hostif_mib_set_request ( priv , LOCAL_RSN_MODE , sizeof ( rsn_mode ) , MIB_VALUE_TYPE_OSTRING , & rsn_mode ) ; break ; } } 