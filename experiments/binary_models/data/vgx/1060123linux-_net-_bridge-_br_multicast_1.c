static bool __grp_src_toin_excl ( struct net_bridge_mcast * brmctx , struct net_bridge_mcast_port * pmctx , struct net_bridge_port_group * pg , void * h_addr , void * srcs , u32 nsrcs , size_t addr_size , int grec_type ) { u32 src_idx , to_send = pg -> src_ents ; struct net_bridge_group_src * ent ; unsigned long now = jiffies ; bool changed = false ; struct br_ip src_ip ; hlist_for_each_entry ( , , ) if ( timer_pending ( & ent -> timer ) ) { ent -> flags |= BR_SGRP_F_SEND ; } src_ip . proto = pg -> key . addr . proto ; for ( src_idx = 0 ; src_idx < nsrcs ; src_idx ++ ) { memcpy ( & src_ip . src , srcs + ( src_idx * addr_size ) , addr_size ) ; ent = br_multicast_find_group_src ( pg , & src_ip ) ; if ( ent ) { if ( timer_pending ( & ent -> timer ) ) { ent -> flags &= ~ BR_SGRP_F_SEND ; to_send -- ; } } else { ent = br_multicast_new_group_src ( pg , & src_ip ) ; if ( ent ) { changed = true ; } } if ( ent ) { __grp_src_mod_timer ( ent , now + br_multicast_gmi ( brmctx ) ) ; } } if ( br_multicast_eht_handle ( brmctx , pg , h_addr , srcs , nsrcs , addr_size , grec_type ) ) { changed = true ; } if ( to_send ) { __grp_src_query_marked_and_rexmit ( brmctx , pmctx , pg ) ; } __grp_send_query_and_rexmit ( brmctx , pmctx , pg ) ; return changed ; } 