void gui_setprio ( RS_BLOB * rs , guint prio ) { GList * selected ; gint i , num_selected ; GString * gs ; const gchar * next_name = NULL ; gui_set_busy ( TRUE ) ; GTK_CATCHUP ( ) ; selected = rs_store_get_selected_iters ( rs -> store ) ; num_selected = g_list_length ( selected ) ; GList * selected_names = rs_store_get_selected_names ( rs -> store ) ; if ( g_list_length ( selected_names ) ) { next_name = ( const gchar * ) ( g_list_last ( selected_names ) -> data ) ; } if ( rs -> photo ) { next_name = rs -> photo -> filename ; } if ( next_name ) { next_name = rs_store_get_prevnext ( rs -> store , next_name , 10 + prio ) ; } if ( next_name ) { gui_set_block_keyboard ( TRUE ) ; } for ( i = 0 ; i < num_selected ; i ++ ) { rs_store_set_flags ( rs -> store , NULL , g_list_nth_data ( selected , i ) , & prio , NULL , NULL ) ; } g_list_free ( selected ) ; if ( rs -> photo && rs_store_is_photo_selected ( rs -> store , rs -> photo -> filename ) ) { rs -> photo -> priority = prio ; rs_store_set_flags ( rs -> store , rs -> photo -> filename , NULL , & prio , NULL , NULL ) ; } gs = g_string_new ( NULL ) ; if ( prio == 0 ) { g_string_printf ( gs , _ ( "Changed photo priority (*)" ) ) ; } if ( prio == 51 ) { g_string_printf ( gs , _ ( "Changed photo priority (D)" ) ) ; } else { g_string_printf ( gs , _ ( "Changed photo priority (%d)" ) , prio ) ; } gui_status_notify ( gs -> str ) ; if ( prio == 51 && NULL == next_name ) { next_name = rs_store_get_first_last ( rs -> store , 2 ) ; } if ( next_name ) { rs_store_set_selected_name ( rs -> store , next_name , TRUE ) ; } g_string_free ( gs , TRUE ) ; gui_set_busy ( FALSE ) ; GTK_CATCHUP ( ) ; gui_set_block_keyboard ( FALSE ) ; } 