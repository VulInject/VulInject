R_API char * r_big_to_hexstr ( RNumBig * b ) { r_return_val_if_fail ( b , NULL ) ; int j = R_BIG_ARRAY_SIZE - 1 ; size_t i = 0 ; size_t k = 0 ; size_t z , last_z = 2 * R_BIG_WORD_SIZE ; for ( ; b -> array [ j ] == 0 && j >= 0 ; j -- ) { } size_t size = 3 + 2 * R_BIG_WORD_SIZE * ( j + 1 ) + ( ( b -> sign > 0 ) ?0 : 1 ) ; char * ret_str = calloc ( size , sizeof ( char ) ) ; if ( ! ret_str ) { return NULL ; } if ( b -> sign < 0 ) { ret_str [ i ++ ] = '-' ; } ret_str [ i ++ ] = '0' ; ret_str [ i ++ ] = 'x' ; r_snprintf ( ret_str + i , R_BIG_FORMAT_STR_LEN , R_BIG_SPRINTF_FORMAT_STR , b -> array [ j -- ] ) ; for ( ; ret_str [ i + k ] == '0' && k < 2 * R_BIG_WORD_SIZE ; k ++ ) { } for ( z = k ; ret_str [ i + z ] && z < last_z ; z ++ ) { ret_str [ i + z - k ] = ret_str [ i + z ] ; } i += z - k ; ret_str [ i ] = '\x00' ; for ( ; j >= 0 ; j -- ) { r_snprintf ( ret_str + i , R_BIG_FORMAT_STR_LEN , R_BIG_SPRINTF_FORMAT_STR , b -> array [ j ] ) ; i += 2 * R_BIG_WORD_SIZE ; } return ret_str ; } 