void muc_join ( const char * const room , const char * const nick , const char * const password , gboolean autojoin ) { ChatRoom * new_room = malloc ( sizeof ( ChatRoom ) ) ; new_room -> room = strdup ( room ) ; new_room -> nick = strdup ( nick ) ; new_room -> role = MUC_ROLE_NONE ; new_room -> affiliation = MUC_AFFILIATION_NONE ; if ( password ) { new_room -> password = strdup ( password ) ; } else { new_room -> password = NULL ; } new_room -> subject = NULL ; new_room -> pending_broadcasts = NULL ; new_room -> pending_config = FALSE ; new_room -> roster = g_hash_table_new_full ( g_str_hash , g_str_equal , g_free , ( GDestroyNotify ) _occupant_free ) ; new_room -> members = g_hash_table_new_full ( g_str_hash , g_str_equal , g_free , NULL ) ; new_room -> nick_ac = autocomplete_new ( ) ; new_room -> jid_ac = autocomplete_new ( ) ; new_room -> nick_changes = g_hash_table_new_full ( g_str_hash , g_str_equal , g_free , g_free ) ; new_room -> roster_received = FALSE ; new_room -> pending_nick_change = FALSE ; new_room -> autojoin = autojoin ; new_room -> member_type = MUC_MEMBER_TYPE_UNKNOWN ; new_room -> anonymity_type = MUC_ANONYMITY_TYPE_UNKNOWN ; g_hash_table_insert ( rooms , strdup ( room ) , new_room ) ; } 