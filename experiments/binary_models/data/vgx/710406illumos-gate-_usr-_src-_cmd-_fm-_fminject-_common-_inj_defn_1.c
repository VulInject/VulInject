void inj_defn_finish ( inj_defn_t * defn , const char * declnm , const char * name , inj_itemtype_t type ) { inj_decl_t * decl = inj_decl_lookup ( declnm , type ) ; inj_hash_t * hash = item2hash ( type ) ; inj_declmem_t * dlm ; inj_defnmem_t * dfm ; inj_var_t * v ; defn -> defn_name = name ; defn -> defn_decl = decl ; if ( decl == NULL ) { yyerror ( "unknown %s type %s\n" , inj_item2str ( type ) , declnm ) ; return ; } dlm = inj_list_next ( & decl -> decl_members ) ; dfm = inj_list_next ( & defn -> defn_members ) ; if ( ( defn -> defn_nvl = inj_defn_validate_memlist ( dlm , dfm ) ) == NULL ) { inj_defn_destroy ( defn ) ; return ; } if ( type == ITEMTYPE_EVENT ) { if ( ( errno = nvlist_add_string ( defn -> defn_nvl , "class" , ( char * ) defn -> defn_decl -> decl_name ) ) != 0 ) { die ( "failed to add class to %s" , name ) ; } } if ( ( v = inj_strhash_lookup ( hash , name ) ) != NULL ) { inj_defn_t * other = inj_hash_get_cookie ( v ) ; yyerror ( "duplicate %s name %s (other on line %d)\n" , inj_item2str ( type ) , name , other -> defn_lineno ) ; inj_defn_destroy ( defn ) ; return ; } ( void ) inj_strhash_insert ( hash , name , ( uintptr_t ) defn ) ; } 