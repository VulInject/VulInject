u32 ieee80211_mandatory_rates ( struct ieee80211_supported_band * sband , enum nl80211_bss_scan_width scan_width ) { struct ieee80211_rate * bitrates ; u32 mandatory_rates = 0 ; enum ieee80211_rate_flags mandatory_flag ; int i ; if ( sband -> band == NL80211_BAND_2GHZ ) { if ( scan_width == NL80211_BSS_CHAN_WIDTH_5 || scan_width == NL80211_BSS_CHAN_WIDTH_10 ) { mandatory_flag = IEEE80211_RATE_MANDATORY_G ; } else { mandatory_flag = IEEE80211_RATE_MANDATORY_B ; } } else { mandatory_flag = IEEE80211_RATE_MANDATORY_A ; } bitrates = sband -> bitrates ; for ( i = 0 ; i < sband -> n_bitrates ; i ++ ) { if ( bitrates [ i ] . flags & mandatory_flag ) { mandatory_rates |= BIT ( i ) ; } } return mandatory_rates ; } 