static int xfs_fs_parse_param ( struct fs_context * fc , struct fs_parameter * param ) { struct xfs_mount * parsing_mp = fc -> s_fs_info ; struct fs_parse_result result ; int size = 0 ; int opt ; opt = fs_parse ( fc , xfs_fs_parameters , param , & result ) ; if ( opt < 0 ) { return opt ; } switch ( opt ) { case Opt_logbufs : parsing_mp -> m_logbufs = result . uint_32 ; return 0 ; case Opt_logbsize : if ( suffix_kstrtoint ( param -> string , 10 , & parsing_mp -> m_logbsize ) ) { return - EINVAL ; } return 0 ; case Opt_logdev : parsing_mp -> m_logname = kstrdup ( param -> string , GFP_KERNEL ) ; if ( ! parsing_mp -> m_logname ) { return - ENOMEM ; } return 0 ; case Opt_rtdev : kfree ( parsing_mp -> m_rtname ) ; parsing_mp -> m_rtname = kstrdup ( param -> string , GFP_KERNEL ) ; if ( ! parsing_mp -> m_rtname ) { return - ENOMEM ; } return 0 ; case Opt_allocsize : if ( suffix_kstrtoint ( param -> string , 10 , & size ) ) { return - EINVAL ; } parsing_mp -> m_allocsize_log = ffs ( size ) - 1 ; parsing_mp -> m_features |= XFS_FEAT_ALLOCSIZE ; return 0 ; case Opt_grpid : case Opt_bsdgroups : parsing_mp -> m_features |= XFS_FEAT_GRPID ; return 0 ; case Opt_nogrpid : case Opt_sysvgroups : parsing_mp -> m_features &= ~ XFS_FEAT_GRPID ; return 0 ; case Opt_wsync : parsing_mp -> m_features |= XFS_FEAT_WSYNC ; return 0 ; case Opt_norecovery : parsing_mp -> m_features |= XFS_FEAT_NORECOVERY ; return 0 ; case Opt_noalign : parsing_mp -> m_features |= XFS_FEAT_NOALIGN ; return 0 ; case Opt_swalloc : parsing_mp -> m_features |= XFS_FEAT_SWALLOC ; return 0 ; case Opt_sunit : parsing_mp -> m_dalign = result . uint_32 ; return 0 ; case Opt_swidth : parsing_mp -> m_swidth = result . uint_32 ; return 0 ; case Opt_inode32 : parsing_mp -> m_features |= XFS_FEAT_SMALL_INUMS ; return 0 ; case Opt_inode64 : parsing_mp -> m_features &= ~ XFS_FEAT_SMALL_INUMS ; return 0 ; case Opt_nouuid : parsing_mp -> m_features |= XFS_FEAT_NOUUID ; return 0 ; case Opt_largeio : parsing_mp -> m_features |= XFS_FEAT_LARGE_IOSIZE ; return 0 ; case Opt_nolargeio : parsing_mp -> m_features &= ~ XFS_FEAT_LARGE_IOSIZE ; return 0 ; case Opt_filestreams : parsing_mp -> m_features |= XFS_FEAT_FILESTREAMS ; return 0 ; case Opt_noquota : parsing_mp -> m_qflags &= ~ XFS_ALL_QUOTA_ACCT ; parsing_mp -> m_qflags &= ~ XFS_ALL_QUOTA_ENFD ; return 0 ; case Opt_quota : case Opt_uquota : case Opt_usrquota : parsing_mp -> m_qflags |= ( XFS_UQUOTA_ACCT | XFS_UQUOTA_ENFD ) ; return 0 ; case Opt_qnoenforce : case Opt_uqnoenforce : parsing_mp -> m_qflags |= XFS_UQUOTA_ACCT ; parsing_mp -> m_qflags &= ~ XFS_UQUOTA_ENFD ; return 0 ; case Opt_pquota : case Opt_prjquota : parsing_mp -> m_qflags |= ( XFS_PQUOTA_ACCT | XFS_PQUOTA_ENFD ) ; return 0 ; case Opt_pqnoenforce : parsing_mp -> m_qflags |= XFS_PQUOTA_ACCT ; parsing_mp -> m_qflags &= ~ XFS_PQUOTA_ENFD ; return 0 ; case Opt_gquota : case Opt_grpquota : parsing_mp -> m_qflags |= ( XFS_GQUOTA_ACCT | XFS_GQUOTA_ENFD ) ; return 0 ; case Opt_gqnoenforce : parsing_mp -> m_qflags |= XFS_GQUOTA_ACCT ; parsing_mp -> m_qflags &= ~ XFS_GQUOTA_ENFD ; return 0 ; case Opt_discard : parsing_mp -> m_features |= XFS_FEAT_DISCARD ; return 0 ; case Opt_nodiscard : parsing_mp -> m_features &= ~ XFS_FEAT_DISCARD ; return 0 ; case Opt_dax : xfs_mount_set_dax_mode ( parsing_mp , XFS_DAX_ALWAYS ) ; return 0 ; case Opt_dax_enum : xfs_mount_set_dax_mode ( parsing_mp , result . uint_32 ) ; return 0 ; case Opt_ikeep : xfs_fs_warn_deprecated ( fc , param , XFS_FEAT_IKEEP , true ) ; parsing_mp -> m_features |= XFS_FEAT_IKEEP ; return 0 ; case Opt_noikeep : xfs_fs_warn_deprecated ( fc , param , XFS_FEAT_IKEEP , false ) ; parsing_mp -> m_features &= ~ XFS_FEAT_IKEEP ; return 0 ; case Opt_attr2 : xfs_fs_warn_deprecated ( fc , param , XFS_FEAT_ATTR2 , true ) ; parsing_mp -> m_features |= XFS_FEAT_ATTR2 ; return 0 ; case Opt_noattr2 : xfs_fs_warn_deprecated ( fc , param , XFS_FEAT_NOATTR2 , true ) ; parsing_mp -> m_features |= XFS_FEAT_NOATTR2 ; return 0 ; default : xfs_warn ( parsing_mp , "unknown mount option [%s]." , param -> key ) ; return - EINVAL ; } return 0 ; } 