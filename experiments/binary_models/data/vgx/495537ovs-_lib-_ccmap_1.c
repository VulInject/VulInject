static struct ccmap_impl * ccmap_rehash ( struct ccmap * ccmap , uint32_t mask ) { struct ccmap_impl * old = ccmap_get_impl ( ccmap ) ; ccmap_impl * new = ccmap_impl_create ( mask ) ; ovs_assert ( old -> n_unique < new -> max_n ) ; while ( ! ccmap_try_rehash ( old , new ) ) { new -> basis = random_uint32 ( ) ; } new -> n = old -> n ; new -> n_unique = old -> n_unique ; ovsrcu_set ( & ccmap -> impl , new ) ; ovsrcu_postpone ( free_cacheline , old ) ; return new ; } 