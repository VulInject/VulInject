static ssize_t mtdpstore_panic_write ( const char * buf , size_t size , loff_t off ) { struct mtdpstore_context * cxt = & oops_cxt ; struct mtd_info * mtd = cxt -> mtd ; size_t retlen ; int ret ; if ( mtdpstore_is_used ( cxt , off ) ) { return - ENOMSG ; } ret = mtd_panic_write ( cxt -> mtd , off , size , & retlen , ( u_char * ) buf ) ; if ( ret < 0 || size != retlen ) { dev_err ( & mtd -> dev , "panic write failure at %lld (%zu of %zu read), err %d\n" , off , retlen , size , ret ) ; return - EIO ; } mtdpstore_mark_used ( cxt , off ) ; return retlen ; } 