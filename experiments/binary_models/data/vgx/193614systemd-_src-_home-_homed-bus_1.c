int bus_message_read_home_record ( sd_bus_message * m , UserRecordLoadFlags flags , UserRecord * * ret , sd_bus_error * error ) { _cleanup_ ( ) JsonVariant * v = NULL ; _cleanup_ ( ) UserRecord * hr = NULL ; unsigned line = 0 , column = 0 ; const char * json ; int r ; r = sd_bus_message_read ( m , "s" , & json ) ; if ( r < 0 ) { return r ; } r = json_parse ( json , JSON_PARSE_SENSITIVE , & v , & line , & column ) ; if ( r < 0 ) { return sd_bus_error_setf ( error , SD_BUS_ERROR_INVALID_ARGS , "Failed to parse JSON identity record at %u:%u: %m" , line , column ) ; } hr = user_record_new ( ) ; if ( ! hr ) { return - ENOMEM ; } r = user_record_load ( hr , v , flags ) ; if ( r < 0 ) { return sd_bus_error_set ( error , SD_BUS_ERROR_INVALID_ARGS , "JSON data is not a valid identity record" ) ; } * ret = TAKE_PTR ( hr ) ; return 0 ; } 