int dpi_init_port ( struct platform_device * pdev , struct device_node * port ) { struct dpi_data * dpi ; struct device_node * ep ; u32 datalines ; int r ; dpi = devm_kzalloc ( & pdev -> dev , sizeof ( * dpi ) , GFP_KERNEL ) ; if ( ! dpi ) { return - ENOMEM ; } ep = of_get_next_child ( port , NULL ) ; r = of_property_read_u32 ( ep , "data-lines" , & datalines ) ; if ( r ) { DSSERR ( "failed to parse datalines\n" ) ; err_datalines } dpi -> data_lines = datalines ; of_node_put ( ep ) ; dpi -> pdev = pdev ; port -> data = dpi ; mutex_init ( & dpi -> lock ) ; dpi_init_output_port ( pdev , port ) ; dpi -> port_initialized = true ; return 0 ; err_datalines of_node_put ( ep ) ; return r ; } 