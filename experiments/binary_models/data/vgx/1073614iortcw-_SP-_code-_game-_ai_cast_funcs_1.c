{ } G_FreeEntity ( gent ) ; if ( ! moved ) { moveresult = AICast_MoveToPos ( cs , destorg , - 1 ) ; if ( moveresult && moveresult -> failure ) { if ( trap_AAS_GetRouteFirstVisPos ( cs -> audibleEventOrg , cs -> bs -> origin , cs -> travelflags , destorg ) ) { cs -> aiFlags |= AIFL_MISCFLAG2 ; VectorSubtract ( destorg , cs -> bs -> origin , destorg ) ; VectorNormalize ( destorg , NULL ) ; vectoangles ( destorg , cs -> ideal_viewangles ) ; return NULL ; } if ( cs -> lastEnemy < 0 && cs -> enemyNum < 0 ) { VectorCopy ( ent -> s . angles , cs -> ideal_viewangles ) ; } return AIFunc_DefaultStart ( cs ) ; } if ( ! moveresult ) { if ( trap_InPVS ( destorg , cs -> bs -> origin ) ) { VectorSubtract ( destorg , cs -> bs -> origin , vec ) ; VectorNormalize ( vec ) ; vectoangles ( vec , cs -> ideal_viewangles ) ; } } } if ( cs -> followDist && cs -> followSlowApproach ) { cs -> speedScale = AICast_SpeedScaleForDistance ( cs , dist , cs -> followDist ) ; } if ( cs -> aiFlags & AIFL_MISCFLAG1 ) { cs -> aiFlags &= ~ AIFL_MISCFLAG1 ; cs -> aiFlags &= ~ AIFL_DENYACTION ; AICast_ForceScriptEvent ( cs , "inspectsoundend" , g_entities [ cs -> audibleEventEnt ] . aiName ) ; if ( cs -> aiFlags & AIFL_DENYACTION ) { return AIFunc_DefaultStart ( cs ) ; } } else { if ( cs -> battleHuntViewTime < level . time ) { cs -> battleHuntViewTime = level . time + 700 + rand ( ) % 1000 ; cs -> ideal_viewangles [ YAW ] = AngleMod ( cs -> ideal_viewangles [ YAW ] + ( 45.0 + random ( ) * 45.0 ) * ( 2 * ( rand ( ) % 2 ) - 1 ) ) ; } if ( cs -> scriptPauseTime < level . time ) { if ( cs -> lastEnemy < 0 && cs -> enemyNum < 0 ) { VectorCopy ( ent -> s . angles , cs -> ideal_viewangles ) ; } return AIFunc_DefaultStart ( cs ) ; } } { int numEnemies ; numEnemies = AICast_ScanForEnemies ( cs , enemies ) ; if ( numEnemies == - 1 ) { return NULL ; } if ( numEnemies == - 2 ) { if ( ( g_entities [ cs -> inspectNum ] . health <= 0 ) && ( g_entities [ enemies [ 0 ] ] . health > 0 ) ) { return AIFunc_InspectFriendlyStart ( cs , enemies [ 0 ] ) ; } } if ( numEnemies == - 4 ) { return AIFunc_InspectAudibleEventStart ( cs , cs -> audibleEventEnt ) ; } if ( numEnemies > 0 ) { int i ; cs -> enemyNum = enemies [ 0 ] ; for ( i = 1 ; i < numEnemies ; i ++ ) { if ( AICast_CheckAttack ( cs , enemies [ i ] , qfalse ) ) { cs -> enemyNum = enemies [ i ] ; break ; } if ( cs -> enemyNum < 0 ) { cs -> lastEnemy = enemies [ i ] ; } } return AIFunc_BattleStart ( cs ) ; } } if ( cs -> enemyNum < 0 && cs -> attributes [ TACTICAL ] >= 0.5 && ! ( cs -> aiFlags & AIFL_NO_HEADLOOK ) ) { g_entities [ cs -> entityNum ] . client -> ps . eFlags |= EF_HEADLOOK ; } AICast_IdleReload ( cs ) ; return NULL ; 