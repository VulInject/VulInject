static void goldfish_pdev_worker ( struct work_struct * work ) static void __iomem * pdev_bus_base ; static unsigned long pdev_bus_addr ; static unsigned long pdev_bus_len ; static u32 pdev_bus_irq ; static LIST_HEAD ( pdev_bus_new_devices ) ; static LIST_HEAD ( pdev_bus_registered_devices ) ; static LIST_HEAD ( pdev_bus_removed_devices ) ; static DECLARE_WORK ( pdev_bus_worker , goldfish_pdev_worker ) ; static void goldfish_pdev_worker ( struct work_struct * work ) { int ret ; struct pdev_bus_dev * pos , * n ; list_for_each_entry_safe ( , , , ) { list_del ( & pos -> list ) ; platform_device_unregister ( & pos -> pdev ) ; } list_for_each_entry_safe ( , , , ) { list_del ( & pos -> list ) ; ret = platform_device_register ( & pos -> pdev ) ; if ( ret ) { pr_err ( "goldfish_pdev_worker failed to register device, %s\n" , pos -> pdev . name ) ; } list_add_tail ( & pos -> list , & pdev_bus_registered_devices ) ; } } 