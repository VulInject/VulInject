static void door_complete ( heim_sipc_call ctx , int returnvalue , heim_idata * reply ) { static heim_base_once_t once = HEIM_BASE_ONCE_INIT ; struct door_call * cs = ( door_call * ) ctx ; size_t rlen ; struct door_reply * r = NULL ; { struct door_reply reply ; char buffer [ offsetof ( door_reply , data ) + BUFSIZ ] ; } , replyBuf heim_base_once_f ( & once , & door_key , door_key_create ) ; error_reply rlen = offsetof ( door_reply , data ) ; if ( returnvalue == 0 ) { rlen += reply -> length ; } if ( rlen > BUFSIZ ) { int ret ; r = realloc ( HEIMDAL_getspecific ( door_key ) , rlen ) ; if ( r == NULL ) { returnvalue = EAGAIN ; error_reply } HEIMDAL_setspecific ( door_key , r , ret ) ; } else { r = & replyBuf . reply ; } r -> returnvalue = returnvalue ; if ( r -> returnvalue == 0 ) { r -> length = reply -> length ; memcpy ( r -> data , reply -> data , reply -> length ) ; } else { r -> length = 0 ; } door_return ( ( char * ) r , rlen , NULL , 0 ) ; } 