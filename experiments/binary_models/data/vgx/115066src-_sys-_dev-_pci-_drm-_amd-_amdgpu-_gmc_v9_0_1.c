static int gmc_v9_0_hw_init ( void * handle ) { struct amdgpu_device * adev = ( amdgpu_device * ) handle ; bool value ; int i , r ; gmc_v9_0_init_golden_registers ( adev ) ; if ( adev -> mode_info . num_crtc ) { WREG32_FIELD15 ( DCE , 0 , VGA_HDP_CONTROL , VGA_MEMORY_DISABLE , 1 ) ; WREG32_FIELD15 ( DCE , 0 , VGA_RENDER_CONTROL , VGA_VSTATUS_CNTL , 0 ) ; } if ( adev -> mmhub . funcs -> update_power_gating ) { adev -> mmhub . funcs -> update_power_gating ( adev , true ) ; } adev -> hdp . funcs -> init_registers ( adev , NULL ) ; adev -> hdp . funcs -> flush_hdp ( adev , NULL ) ; if ( amdgpu_vm_fault_stop == AMDGPU_VM_FAULT_STOP_ALWAYS ) { value = false ; } else { value = true ; } if ( ! amdgpu_sriov_vf ( adev ) ) { adev -> gfxhub . funcs -> set_fault_enable_default ( adev , value ) ; adev -> mmhub . funcs -> set_fault_enable_default ( adev , value ) ; } for ( i = 0 ; i < adev -> num_vmhubs ; ++ i ) { gmc_v9_0_flush_gpu_tlb ( adev , 0 , i , 0 ) ; } if ( adev -> umc . funcs && adev -> umc . funcs -> init_registers ) { adev -> umc . funcs -> init_registers ( adev ) ; } r = gmc_v9_0_gart_enable ( adev ) ; if ( r ) { return r ; } if ( amdgpu_emu_mode == 1 ) { return amdgpu_gmc_vram_checking ( adev ) ; } else { return r ; } } 