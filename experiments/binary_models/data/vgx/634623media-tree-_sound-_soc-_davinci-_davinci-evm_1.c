static int __init evm_init ( void ) { struct snd_soc_card * evm_snd_dev_data ; int index ; int ret ; if ( of_have_populated_dt ( ) ) { return platform_driver_register ( & davinci_evm_driver ) ; } if ( machine_is_davinci_evm ( ) ) { evm_snd_dev_data = & dm6446_snd_soc_card_evm ; index = 0 ; } if ( machine_is_davinci_dm355_evm ( ) ) { evm_snd_dev_data = & dm355_snd_soc_card_evm ; index = 1 ; } if ( machine_is_davinci_dm365_evm ( ) ) { evm_snd_dev_data = & dm365_snd_soc_card_evm ; index = 0 ; } if ( machine_is_davinci_dm6467_evm ( ) ) { evm_snd_dev_data = & dm6467_snd_soc_card_evm ; index = 0 ; } if ( machine_is_davinci_da830_evm ( ) ) { evm_snd_dev_data = & da830_snd_soc_card ; index = 1 ; } if ( machine_is_davinci_da850_evm ( ) ) { evm_snd_dev_data = & da850_snd_soc_card ; index = 0 ; } else { return - EINVAL ; } evm_snd_device = platform_device_alloc ( "soc-audio" , index ) ; platform_set_drvdata ( evm_snd_device , evm_snd_dev_data ) ; ret = platform_device_add ( evm_snd_device ) ; if ( ret ) { platform_device_put ( evm_snd_device ) ; } return ret ; } 