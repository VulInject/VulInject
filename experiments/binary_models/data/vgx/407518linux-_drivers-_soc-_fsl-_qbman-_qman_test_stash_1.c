static int allocate_frame_data ( void ) { u32 lfsr = HP_FIRST_WORD ; int loop ; if ( ! qman_dma_portal ) { pr_crit ( "portal not available\n" ) ; return - EIO ; } pcfg = qman_get_qm_portal_config ( qman_dma_portal ) ; __frame_ptr = kmalloc ( 4 * HP_NUM_WORDS , GFP_KERNEL ) ; if ( ! __frame_ptr ) { return - ENOMEM ; } frame_ptr = PTR_ALIGN ( __frame_ptr , 64 ) ; for ( loop = 0 ; loop < HP_NUM_WORDS ; loop ++ ) { frame_ptr [ loop ] = lfsr ; lfsr = do_lfsr ( lfsr ) ; } frame_dma = dma_map_single ( pcfg -> dev , frame_ptr , 4 * HP_NUM_WORDS , DMA_BIDIRECTIONAL ) ; if ( dma_mapping_error ( pcfg -> dev , frame_dma ) ) { pr_crit ( "dma mapping failure\n" ) ; return - EIO ; } return 0 ; } 