static int pcie_rd_conf ( struct pci_bus * bus , u32 devfn , int where , int size , u32 * val ) { struct pci_sys_data * sys = bus -> sysdata ; struct pcie_port * pp = sys -> private_data ; cfs_time_t flags ; int ret ; if ( pcie_valid_config ( pp , bus -> number , PCI_SLOT ( devfn ) ) == 0 ) { * val = 0xffffffff ; return PCIBIOS_DEVICE_NOT_FOUND ; } spin_lock_irqsave ( & pp -> conf_lock , flags ) ; ret = orion_pcie_rd_conf ( pp -> base , bus , devfn , where , size , val ) ; spin_unlock_irqrestore ( & pp -> conf_lock , flags ) ; return ret ; } 