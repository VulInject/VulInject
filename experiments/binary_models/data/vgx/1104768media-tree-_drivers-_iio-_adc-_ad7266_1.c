static int ad7266_remove ( struct spi_device * spi ) { struct iio_dev * indio_dev = spi_get_drvdata ( spi ) ; struct ad7266_state * st = iio_priv ( indio_dev ) ; iio_device_unregister ( indio_dev , NULL ) ; iio_triggered_buffer_cleanup ( indio_dev ) ; if ( ! st -> fixed_addr ) { gpio_free_array ( st -> gpios , ARRAY_SIZE ( st -> gpios ) ) ; } if ( ! IS_ERR ( st -> reg ) ) { regulator_disable ( st -> reg ) ; } return 0 ; } 