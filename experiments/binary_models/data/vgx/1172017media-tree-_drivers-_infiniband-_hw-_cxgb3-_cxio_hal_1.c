static int cxio_hal_ev_handler ( struct t3cdev * t3cdev_p , struct sk_buff * skb ) { static int cnt ; struct cxio_rdev * rdev_p ; struct respQ_msg_t * rsp_msg = ( respQ_msg_t * ) skb -> data ; pr_debug ( "%d: %s cq_id 0x%x cq_ptr 0x%x genbit %0x overflow %0x an %0x se %0x notify %0x cqbranch %0x creditth %0x\n" , cnt , __func__ , RSPQ_CQID ( rsp_msg ) , RSPQ_CQPTR ( rsp_msg ) , RSPQ_GENBIT ( rsp_msg ) , RSPQ_OVERFLOW ( rsp_msg ) , RSPQ_AN ( rsp_msg ) , RSPQ_SE ( rsp_msg ) , RSPQ_NOTIFY ( rsp_msg ) , RSPQ_CQBRANCH ( rsp_msg ) , RSPQ_CREDIT_THRESH ( rsp_msg ) ) ; pr_debug ( "CQE: QPID 0x%0x genbit %0x type 0x%0x status 0x%0x opcode %d len 0x%0x wrid_hi_stag 0x%x wrid_low_msn 0x%x\n" , CQE_QPID ( rsp_msg -> cqe ) , CQE_GENBIT ( rsp_msg -> cqe ) , CQE_TYPE ( rsp_msg -> cqe ) , CQE_STATUS ( rsp_msg -> cqe ) , CQE_OPCODE ( rsp_msg -> cqe ) , CQE_LEN ( rsp_msg -> cqe ) , CQE_WRID_HI ( rsp_msg -> cqe ) , CQE_WRID_LOW ( rsp_msg -> cqe ) ) ; rdev_p = ( cxio_rdev * ) t3cdev_p -> ulp ; if ( ! rdev_p ) { pr_debug ( "%s called by t3cdev %p with null ulp\n" , __func__ , t3cdev_p ) ; return 0 ; } if ( CQE_QPID ( rsp_msg -> cqe ) == T3_CTRL_QP_ID ) { rdev_p -> ctrl_qp . rptr = CQE_WRID_LOW ( rsp_msg -> cqe ) + 1 ; wake_up_interruptible ( & rdev_p -> ctrl_qp . waitq ) ; dev_kfree_skb_irq ( skb ) ; } if ( CQE_QPID ( rsp_msg -> cqe ) == 0xfff8 ) { dev_kfree_skb_irq ( skb ) ; } if ( cxio_ev_cb ) { * cxio_ev_cb ( rdev_p , skb ) ; } else { dev_kfree_skb_irq ( skb ) ; } cnt ++ ; return 0 ; } 