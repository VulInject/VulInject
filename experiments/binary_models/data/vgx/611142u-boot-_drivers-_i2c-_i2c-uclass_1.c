static int i2c_read_bytewise ( struct udevice * dev , uint offset , uint8_t * buffer , int len ) { struct dm_i2c_chip * chip = dev_get_parent_plat ( dev ) ; struct udevice * bus = dev_get_parent ( dev ) ; struct dm_i2c_ops * ops = i2c_get_ops ( bus ) ; struct i2c_msg msg [ 2 ] , * ptr ; uint8_t offset_buf [ I2C_MAX_OFFSET_LEN ] ; int ret ; int i ; for ( i = 0 ; i < len ; i ++ ) { if ( i2c_setup_offset ( chip , offset + i , offset_buf , msg ) ) { return - EINVAL ; } ptr = msg + 1 ; ptr -> addr = msg -> addr ; ptr -> flags = msg -> flags | I2C_M_RD ; ptr -> len = 1 ; ptr -> buf = & buffer [ i ] ; ptr ++ ; ret = ops -> xfer ( bus , msg , ptr - msg ) ; } return 0 ; } 