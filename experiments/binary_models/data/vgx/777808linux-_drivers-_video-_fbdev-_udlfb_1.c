static void dlfb_usb_disconnect ( struct usb_interface * intf ) { struct dlfb_data * dlfb ; struct fb_info * info ; int i ; dlfb = usb_get_intfdata ( intf ) ; info = dlfb -> info ; dev_dbg ( & intf -> dev , "USB disconnect starting\n" ) ; dlfb -> virtualized = true ; atomic_set ( & dlfb -> usb_active , 0 ) ; dlfb_free_urb_list ( dlfb ) ; for ( i = 0 ; i < ARRAY_SIZE ( fb_device_attrs ) ; i ++ ) { device_remove_file ( info -> dev , & fb_device_attrs [ i ] ) ; } device_remove_bin_file ( info -> dev , & edid_attr ) ; unregister_framebuffer ( info , NULL ) ; } 