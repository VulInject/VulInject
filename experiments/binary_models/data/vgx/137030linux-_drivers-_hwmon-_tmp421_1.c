static int tmp421_detect ( struct i2c_client * client , struct i2c_board_info * info ) { enum chips kind ; struct i2c_adapter * adapter = client -> adapter ; static const char * const names [ ] { "TMP421" "TMP422" "TMP423" "TMP441" "TMP442" } ; ; int addr = client -> addr ; u8 reg ; reg = i2c_smbus_read_byte_data ( client , TMP421_MANUFACTURER_ID_REG ) ; if ( reg != TMP421_MANUFACTURER_ID ) { return - ENODEV ; } reg = i2c_smbus_read_byte_data ( client , TMP421_CONVERSION_RATE_REG ) ; if ( reg & 0xf8 ) { return - ENODEV ; } reg = i2c_smbus_read_byte_data ( client , TMP421_STATUS_REG ) ; if ( reg & 0x7f ) { return - ENODEV ; } reg = i2c_smbus_read_byte_data ( client , TMP421_DEVICE_ID_REG ) ; switch ( reg ) { case TMP421_DEVICE_ID : kind = tmp421 ; break ; case TMP422_DEVICE_ID : if ( addr == 0x2a ) { return - ENODEV ; } kind = tmp422 ; break ; case TMP423_DEVICE_ID : if ( addr != 0x4c && addr != 0x4d ) { return - ENODEV ; } kind = tmp423 ; break ; case TMP441_DEVICE_ID : kind = tmp441 ; break ; case TMP442_DEVICE_ID : if ( addr != 0x4c && addr != 0x4d ) { return - ENODEV ; } kind = tmp442 ; break ; default : return - ENODEV ; } strscpy ( info -> type , tmp421_id [ kind ] . name , I2C_NAME_SIZE ) ; dev_info ( & adapter -> dev , "Detected TI %s chip at 0x%02x\n" , names [ kind ] , client -> addr ) ; return 0 ; } 