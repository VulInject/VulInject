static int __read ( RIO * io , RIODesc * desc , ut8 * buf , int count ) { RIOMalloc * mal = ( RIOMalloc * ) desc -> data ; if ( mal ) { ut64 addr = mal -> offset ; r_cons_break_push ( NULL , NULL ) ; RIOSocketData * sdat = mal -> data ; RSocket * s = sdat -> sc ; ut8 * mem = malloc ( 4096 ) ; if ( mem ) { int c = r_socket_read ( s , mem , 4096 ) ; if ( c > 0 ) { r_io_stream_read ( sdat -> ios , mem , c ) ; int osz = mal -> size ; io_memory_resize ( io , desc , mal -> size + c ) ; memcpy ( mal -> buf + osz , mem , c ) ; io -> coreb . cmdf ( io -> coreb . core , "f nread_%d %d %d" , sdat -> count , c , mal -> size ) ; sdat -> count ++ ; } } r_cons_break_pop ( ) ; mal -> offset = addr ; if ( sdat -> ios && sdat -> ios -> buf ) { return r_buf_read_at ( sdat -> ios -> buf , mal -> offset , buf , count ) ; } return - 1 ; } return - 1 ; } 