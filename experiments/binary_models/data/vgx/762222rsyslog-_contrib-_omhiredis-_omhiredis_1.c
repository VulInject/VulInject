static void setInstParamDefaults ( instanceData * pData ) { pData -> server = NULL ; pData -> port = 6379 ; pData -> serverpassword = NULL ; pData -> tplName = NULL ; pData -> mode = OMHIREDIS_MODE_TEMPLATE ; pData -> expiration = 0 ; pData -> modeDescription = NULL ; pData -> key = NULL ; pData -> useRPush = 0 ; } BEGINnewActInst struct cnfparamvals * pvals ; int i ; int iNumTpls ; uchar * keydup = NULL ; CODESTARTnewActInst if ( ( pvals = nvlstGetParams ( lst , & actpblk , NULL ) ) == NULL ) { ABORT_FINALIZE ( RS_RET_MISSING_CNFPARAMS ) ; } CHKiRet ( createInstance ( & pData ) ) ; setInstParamDefaults ( pData ) ; for ( i = 0 ; i < actpblk . nParams ; ++ i ) { if ( ! strcmp ( actpblk . descr [ i ] . name , "server" ) ) { pData -> server = ( uchar * ) es_str2cstr ( pvals [ i ] . val . d . estr , NULL ) ; } if ( ! strcmp ( actpblk . descr [ i ] . name , "serverport" ) ) { pData -> port = ( int ) pvals [ i ] . val . d . n ; } if ( ! strcmp ( actpblk . descr [ i ] . name , "serverpassword" ) ) { pData -> serverpassword = ( uchar * ) es_str2cstr ( pvals [ i ] . val . d . estr , NULL ) ; } if ( ! strcmp ( actpblk . descr [ i ] . name , "template" ) ) { pData -> tplName = ( uchar * ) es_str2cstr ( pvals [ i ] . val . d . estr , NULL ) ; } if ( ! strcmp ( actpblk . descr [ i ] . name , "dynakey" ) ) { pData -> dynaKey = pvals [ i ] . val . d . n ; } if ( ! strcmp ( actpblk . descr [ i ] . name , "userpush" ) ) { pData -> useRPush = pvals [ i ] . val . d . n ; } if ( ! strcmp ( actpblk . descr [ i ] . name , "mode" ) ) { pData -> modeDescription = es_str2cstr ( pvals [ i ] . val . d . estr , NULL ) ; if ( ! strcmp ( pData -> modeDescription , "template" ) ) { pData -> mode = OMHIREDIS_MODE_TEMPLATE ; } if ( ! strcmp ( pData -> modeDescription , "queue" ) ) { pData -> mode = OMHIREDIS_MODE_QUEUE ; } if ( ! strcmp ( pData -> modeDescription , "publish" ) ) { pData -> mode = OMHIREDIS_MODE_PUBLISH ; } if ( ! strcmp ( pData -> modeDescription , "set" ) ) { pData -> mode = OMHIREDIS_MODE_SET ; } else { dbgprintf ( "omhiredis: unsupported mode %s\n" , actpblk . descr [ i ] . name ) ; ABORT_FINALIZE ( RS_RET_MISSING_CNFPARAMS ) ; } } if ( ! strcmp ( actpblk . descr [ i ] . name , "key" ) ) { pData -> key = ( uchar * ) es_str2cstr ( pvals [ i ] . val . d . estr , NULL ) ; } if ( ! strcmp ( actpblk . descr [ i ] . name , "expiration" ) ) { pData -> expiration = pvals [ i ] . val . d . n ; dbgprintf ( "omhiredis: expiration set to %d\n" , pData -> expiration ) ; } else { dbgprintf ( "omhiredis: program error, non-handled " "param '%s'\n" , actpblk . descr [ i ] . name ) ; } } 