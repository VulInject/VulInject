static int xlnx_formatter_pcm_remove ( struct platform_device * pdev ) { int ret = 0 ; struct xlnx_pcm_drv_data * adata = dev_get_drvdata ( & pdev -> dev ) ; if ( adata -> s2mm_presence ) { ret = xlnx_formatter_pcm_reset ( adata -> mmio + XLNX_S2MM_OFFSET ) ; } if ( adata -> mm2s_presence ) { ret = xlnx_formatter_pcm_reset ( adata -> mmio + XLNX_MM2S_OFFSET ) ; } if ( ret ) { dev_err ( & pdev -> dev , "audio formatter reset failed\n" ) ; } clk_disable_unprepare ( adata -> axi_clk , NULL ) ; return 0 ; } 