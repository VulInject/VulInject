static void residual_interp ( int16_t * buf , int16_t * out , int lag , int gain , int * rseed ) { int i ; if ( lag ) { int16_t * vector_ptr = buf + PITCH_MAX ; for ( i = 0 ; i < lag ; i ++ ) { out [ i ] = vector_ptr [ i - lag ] * 3 >> 2 ; } av_memcpy_backptr ( ( uint8_t * ) ( out + lag ) , lag * sizeof ( * out ) , ( FRAME_LEN - lag ) * sizeof ( * out ) ) ; } else { for ( i = 0 ; i < FRAME_LEN ; i ++ ) { * rseed = ( int16_t ) ( * rseed * 521 + 259 ) ; out [ i ] = gain * * rseed >> 15 ; } } } { int m , n ; int res_shift = 16 & ~ - ( width ) ; int in_shift = 16 - res_shift ; for ( m = 0 ; m < SUBFRAME_LEN ; m ++ ) { int64_t filter = 0 ; for ( n = 1 ; n <= LPC_ORDER ; n ++ ) { filter -= ( fir_coef ) [ n - 1 ] * ( src ) [ m - n ] - ( iir_coef ) [ n - 1 ] * ( ( dest ) [ m - n ] >> in_shift ) ; } ( dest ) [ m ] = av_clipl_int32 ( ( ( src ) [ m ] * 65536 ) + ( filter * 8 ) + ( 1 << 15 ) ) >> res_shift ; } } 