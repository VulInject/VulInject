static void npad ( int , char * ) static void optmsg ( int , char * ) static void optmsg ( char * ) static void pnum ( int , char * ) static void regerr ( int ) static void usage ( ) extern char * optarg ; extern int optind ; int main ( int argc , char * argv [ ] ) { register int j ; register int i = 0 ; register char * p ; register char header = 'n' ; register char body = 't' ; register char footer = 'n' ; char line [ LINE_MAX ] ; char tempchr ; char swtch = 'n' ; char cntck = 'n' ; char type ; int cnt ; int pass1 = 1 ; char sep [ EXPSIZ ] ; char pat [ EXPSIZ ] ; int startcnt = 1 ; int increment = 1 ; int blank = 1 ; int blankctr = 0 ; int c ; int lnt ; char last ; FILE * iptr = stdin ; FILE * optr = stdout ; int option_end ; sep [ 0 ] = '\t' ; sep [ 1 ] = '\0' ; ( void ) setlocale ( LC_ALL , "" ) ; ( void ) textdomain ( TEXT_DOMAIN ) ; while ( argc > 0 ) { while ( ( c = getopt ( argc , argv , "pb:d:f:h:i:l:n:s:v:w:" ) ) != EOF ) { switch ( c ) { case 'h' : switch ( * optarg ) { case 'n' : header = 'n' ; break ; case 't' : header = 't' ; break ; case 'a' : header = 'a' ; break ; case 'p' : ( void ) strcpy ( pat , optarg + 1 ) ; header = 'h' ; hexpbuf = compile ( pat , NULL , NULL ) ; if ( regerrno ) { regerr ( regerrno ) ; } break ; case '\0' : header = 'n' ; break ; default : optmsg ( c , optarg ) ; } break ; case 'b' : switch ( * optarg ) { case 't' : body = 't' ; break ; case 'a' : body = 'a' ; break ; case 'n' : body = 'n' ; break ; case 'p' : ( void ) strcpy ( pat , optarg + 1 ) ; body = 'b' ; bexpbuf = compile ( pat , NULL , NULL ) ; if ( regerrno ) { regerr ( regerrno ) ; } break ; case '\0' : body = 't' ; break ; default : optmsg ( c , optarg ) ; } break ; case 'f' : switch ( * optarg ) { case 'n' : footer = 'n' ; break ; case 't' : footer = 't' ; break ; case 'a' : footer = 'a' ; break ; case 'p' : ( void ) strcpy ( pat , optarg + 1 ) ; footer = 'f' ; fexpbuf = compile ( pat , NULL , NULL ) ; if ( regerrno ) { regerr ( regerrno ) ; } break ; case '\0' : footer = 'n' ; break ; default : optmsg ( c , optarg ) ; } break ; case 'p' : if ( optarg == ( char * ) NULL ) { cntck = 'y' ; } else { optmsg ( c , optarg ) ; } break ; case 'v' : if ( * optarg == '\0' ) { startcnt = 1 ; } else { startcnt = convert ( c , optarg ) ; } break ; case 'i' : if ( * optarg == '\0' ) { increment = 1 ; } else { increment = convert ( c , optarg ) ; } break ; case 'w' : if ( * optarg == '\0' ) { width = 6 ; } else { width = convert ( c , optarg ) ; } break ; case 'l' : if ( * optarg == '\0' ) { blank = 1 ; } else { blank = convert ( c , optarg ) ; } break ; case 'n' : switch ( * optarg ) { case 'l' : if ( * ( optarg + 1 ) == 'n' ) { format = 'l' ; } else { optmsg ( c , optarg ) ; } break ; case 'r' : if ( ( * ( optarg + 1 ) == 'n' ) || ( * ( optarg + 1 ) == 'z' ) ) { format = * ( optarg + 1 ) ; } else { optmsg ( c , optarg ) ; } break ; case '\0' : format = 'n' ; break ; default : optmsg ( c , optarg ) ; break ; } break ; case 's' : ( void ) strcpy ( sep , optarg ) ; break ; case 'd' : delim1 = * optarg ; if ( * ( optarg + 1 ) == '\0' ) { break ; } delim2 = * ( optarg + 1 ) ; if ( * ( optarg + 2 ) != '\0' ) { optmsg ( c , optarg ) ; } break ; default : optmsg ( c , optarg ) ; } } argv += optind ; argc -= optind ; optind = 0 ; if ( argc > 0 ) { if ( ( iptr = fopen ( argv [ 0 ] , "r" ) ) == NULL ) { ( void ) fprintf ( stderr , "nl: %s: " , argv [ 0 ] ) ; perror ( "" ) ; return ( 1 ) ; } ++ argv ; -- argc ; } } for ( j = 1 ; j < argc ; j ++ ) { if ( argv [ j ] [ i ] == '-' && ( c = argv [ j ] [ i + 1 ] ) ) { if ( ! option_end ) { switch ( c ) { case 'h' : switch ( argv [ j ] [ i + 2 ] ) { case 'n' : header = 'n' ; break ; case 't' : header = 't' ; break ; case 'a' : header = 'a' ; break ; case 'p' : s = argv [ j ] ; q = 3 ; r = 0 ; while ( s [ q ] != '\0' ) { pat [ r ] = s [ q ] ; r ++ ; q ++ ; } pat [ r ] = '\0' ; header = 'h' ; hexpbuf = compile ( pat , NULL , NULL ) ; if ( regerrno ) { regerr ( regerrno ) ; } break ; case '\0' : header = 'n' ; break ; default : optmsg ( argv [ j ] ) ; } break ; case 'b' : switch ( argv [ j ] [ i + 2 ] ) { case 't' : body = 't' ; break ; case 'a' : body = 'a' ; break ; case 'n' : body = 'n' ; break ; case 'p' : s = argv [ j ] ; q = 3 ; r = 0 ; while ( s [ q ] != '\0' ) { pat [ r ] = s [ q ] ; r ++ ; q ++ ; } pat [ r ] = '\0' ; body = 'b' ; bexpbuf = compile ( pat , NULL , NULL ) ; if ( regerrno ) { regerr ( regerrno ) ; } break ; case '\0' : body = 't' ; break ; default : optmsg ( argv [ j ] ) ; } break ; case 'f' : switch ( argv [ j ] [ i + 2 ] ) { case 'n' : footer = 'n' ; break ; case 't' : footer = 't' ; break ; case 'a' : footer = 'a' ; break ; case 'p' : s = argv [ j ] ; q = 3 ; r = 0 ; while ( s [ q ] != '\0' ) { pat [ r ] = s [ q ] ; r ++ ; q ++ ; } pat [ r ] = '\0' ; footer = 'f' ; fexpbuf = compile ( pat , NULL , NULL ) ; if ( regerrno ) { regerr ( regerrno ) ; } break ; case '\0' : footer = 'n' ; break ; default : optmsg ( argv [ j ] ) ; } break ; case 'p' : if ( argv [ j ] [ i + 2 ] == '\0' ) { cntck = 'y' ; } else { optmsg ( argv [ j ] ) ; } break ; case 'v' : if ( argv [ j ] [ i + 2 ] == '\0' ) { startcnt = 1 ; } else { startcnt = convert ( argv [ j ] ) ; } break ; case 'i' : if ( argv [ j ] [ i + 2 ] == '\0' ) { increment = 1 ; } else { increment = convert ( argv [ j ] ) ; } break ; case 'w' : if ( argv [ j ] [ i + 2 ] == '\0' ) { width = 6 ; } else { width = convert ( argv [ j ] ) ; } break ; case 'l' : if ( argv [ j ] [ i + 2 ] == '\0' ) { blank = 1 ; } else { blank = convert ( argv [ j ] ) ; } break ; case 'n' : switch ( argv [ j ] [ i + 2 ] ) { case 'l' : if ( argv [ j ] [ i + 3 ] == 'n' ) { format = 'l' ; } else { optmsg ( argv [ j ] ) ; } break ; case 'r' : if ( ( argv [ j ] [ i + 3 ] == 'n' ) || ( argv [ j ] [ i + 3 ] == 'z' ) ) { format = argv [ j ] [ i + 3 ] ; } else { optmsg ( argv [ j ] ) ; } break ; case '\0' : format = 'n' ; break ; default : optmsg ( argv [ j ] ) ; break ; } break ; case 's' : if ( argv [ j ] [ i + 2 ] != '\0' ) { s = argv [ j ] ; q = 2 ; r = 0 ; while ( s [ q ] != '\0' ) { sep [ r ] = s [ q ] ; r ++ ; q ++ ; } sep [ r ] = '\0' ; } break ; case 'd' : tempchr = argv [ j ] [ i + 2 ] ; if ( tempchr == '\0' ) { break ; } delim1 = tempchr ; tempchr = argv [ j ] [ i + 3 ] ; if ( tempchr == '\0' ) { break ; } delim2 = tempchr ; if ( argv [ j ] [ i + 4 ] != '\0' ) { optmsg ( argv [ j ] ) ; } break ; case '-' : if ( argv [ j ] [ i + 2 ] == '\0' ) { option_end = 1 ; break ; } default : optmsg ( argv [ j ] ) ; } } if ( ( iptr = fopen ( argv [ j ] , "r" ) ) == NULL ) { ( void ) fprintf ( stderr , "nl: %s: " , argv [ j ] ) ; perror ( "" ) ; return ( 1 ) ; } } if ( ( iptr = fopen ( argv [ j ] , "r" ) ) == NULL ) { ( void ) fprintf ( stderr , "nl: %s: " , argv [ j ] ) ; perror ( "" ) ; return ( 1 ) ; } } } 