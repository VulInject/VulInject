static int xpc_hb_checker ( void * ignore ) { int force_IRQ = 0 ; set_cpus_allowed_ptr ( current , cpumask_of ( XPC_HB_CHECK_CPU ) ) ; xpc_hb_check_timeout = jiffies + ( xpc_hb_check_interval * HZ ) ; xpc_start_hb_beater ( ) ; while ( ! xpc_exiting ) { dev_dbg ( xpc_part , "woke up with %d ticks rem; %d IRQs have " "been received\n" , ( int ) ( xpc_hb_check_timeout - jiffies ) , xpc_activate_IRQ_rcvd ) ; if ( time_is_before_eq_jiffies ( xpc_hb_check_timeout ) ) { xpc_hb_check_timeout = jiffies + ( xpc_hb_check_interval * HZ ) ; dev_dbg ( xpc_part , "checking remote heartbeats\n" ) ; xpc_check_remote_hb ( ) ; } if ( xpc_activate_IRQ_rcvd > 0 || force_IRQ != 0 ) { dev_dbg ( xpc_part , "processing activate IRQs " "received\n" ) ; xpc_arch_ops . process_activate_IRQ_rcvd ( ) ; } ( void ) wait_event_interruptible ( xpc_activate_IRQ_wq , ( time_is_before_eq_jiffies ( xpc_hb_check_timeout ) || xpc_activate_IRQ_rcvd > 0 || xpc_exiting ) ) ; } xpc_stop_hb_beater ( ) ; dev_dbg ( xpc_part , "heartbeat checker is exiting\n" ) ; complete ( & xpc_hb_checker_exited ) ; return 0 ; } 