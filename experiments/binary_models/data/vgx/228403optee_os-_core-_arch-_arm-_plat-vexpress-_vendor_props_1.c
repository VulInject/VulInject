static TEE_Result get_prop_endorsement ( struct ts_session * sess , void * buf , size_t * blen ) { TEE_Result res ; uint32_t ta_endorsement_seed_size = 32 ; uint8_t data [ sizeof ( TEE_UUID ) + ta_endorsement_seed_size ] ; uint32_t bin [ 1 + ta_endorsement_seed_size / sizeof ( uint32_t ) ] ; uint32_t * bin_len = ( uint32_t * ) bin ; uint8_t * bin_val = ( uint8_t * ) ( & bin [ 1 ] ) ; if ( * blen < sizeof ( bin ) ) { * blen = sizeof ( bin ) ; return TEE_ERROR_SHORT_BUFFER ; } * blen = sizeof ( bin ) ; memcpy ( data , & sess -> ctx -> uuid , sizeof ( TEE_UUID ) ) ; res = tee_hash_createdigest ( TEE_ALG_SHA256 , data , sizeof ( data ) , bin_val , ta_endorsement_seed_size ) ; if ( res != TEE_SUCCESS ) { return TEE_ERROR_BAD_STATE ; } * bin_len = ta_endorsement_seed_size ; return copy_to_user ( buf , bin , sizeof ( bin ) ) ; } static const struct tee_props vendor_propset_array_tee [ ] { { . name = "com.microsoft.ta.endorsementSeed" . prop_type = USER_TA_PROP_TYPE_BINARY_BLOCK . get_prop_func = get_prop_endorsement } } ; ; 