int __qlcnic_up ( struct qlcnic_adapter * adapter , struct net_device * netdev ) { int ring ; struct qlcnic_host_rds_ring * rds_ring ; if ( adapter -> is_up != QLCNIC_ADAPTER_UP_MAGIC ) { return - EIO ; } if ( test_bit ( __QLCNIC_DEV_UP , & adapter -> state ) ) { return 0 ; } if ( qlcnic_set_eswitch_port_config ( adapter ) ) { return - EIO ; } qlcnic_get_lro_mss_capability ( adapter ) ; for ( ring = 0 ; ring < adapter -> max_rds_rings ; ring ++ ) { rds_ring = & adapter -> recv_ctx -> rds_rings [ ring ] ; qlcnic_post_rx_buffers ( adapter , rds_ring , ring ) ; } qlcnic_set_multi ( netdev ) ; qlcnic_fw_cmd_set_mtu ( adapter , netdev -> mtu ) ; adapter -> ahw -> linkup = 0 ; if ( adapter -> drv_sds_rings > 1 ) { qlcnic_config_rss ( adapter , 1 ) ; } qlcnic_config_def_intr_coalesce ( adapter ) ; if ( netdev -> features & NETIF_F_LRO ) { qlcnic_config_hw_lro ( adapter , QLCNIC_LRO_ENABLED ) ; } set_bit ( __QLCNIC_DEV_UP , & adapter -> state ) ; qlcnic_napi_enable ( adapter ) ; qlcnic_linkevent_request ( adapter , 1 ) ; adapter -> ahw -> reset_context = 0 ; netif_tx_start_all_queues ( netdev ) ; return 0 ; } 