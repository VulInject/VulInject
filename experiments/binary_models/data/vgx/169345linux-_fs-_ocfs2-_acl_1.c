int ocfs2_iop_set_acl ( struct mnt_idmap * idmap , struct dentry * dentry , struct posix_acl * acl , int type ) { struct buffer_head * bh = NULL ; int status , had_lock ; struct ocfs2_lock_holder oh ; struct inode * inode = d_inode ( dentry ) ; had_lock = ocfs2_inode_lock_tracker ( inode , & bh , 1 , & oh ) ; if ( type == ACL_TYPE_ACCESS && acl ) { umode_t mode ; status = posix_acl_update_mode ( & nop_mnt_idmap , inode , & mode , & acl ) ; if ( status ) { unlock } status = ocfs2_acl_set_mode ( inode , bh , NULL , mode ) ; if ( status ) { unlock } } status = ocfs2_set_acl ( NULL , inode , bh , type , acl , NULL , NULL ) ; unlock ocfs2_inode_unlock_tracker ( inode , 1 , & oh , had_lock ) ; brelse ( bh ) ; return status ; } 