login ( , ) int argc ; char * * argv ; { char * typed_password ; char * cvsroot_canonical ; if ( argc < 0 ) { usage ( login_usage ) ; } if ( current_parsed_root -> method != pserver_method ) { error ( 0 , 0 , "can only use `login' command with the 'pserver' method" ) ; error ( 1 , 0 , "CVSROOT: %s" , current_parsed_root -> original ) ; } cvsroot_canonical = normalize_cvsroot ( current_parsed_root ) ; printf ( "Logging in to %s\n" , cvsroot_canonical ) ; fflush ( stdout ) ; if ( current_parsed_root -> password ) { typed_password = scramble ( current_parsed_root -> password ) ; } else { char * tmp ; tmp = GETPASS ( "CVS password: " ) ; typed_password = scramble ( tmp ) ; memset ( tmp , 0 , strlen ( tmp ) ) ; } cvs_password = xstrdup ( typed_password ) ; connect_to_pserver ( NULL , NULL , 1 , 0 ) ; password_entry_operation ( password_entry_add , current_parsed_root , typed_password ) ; memset ( typed_password , 0 , strlen ( typed_password ) ) ; free ( typed_password ) ; free ( cvsroot_canonical ) ; cvs_password = NULL ; return 0 ; } 