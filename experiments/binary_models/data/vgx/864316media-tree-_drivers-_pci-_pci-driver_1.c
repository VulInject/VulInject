static int pci_legacy_suspend ( struct device * dev , pm_message_t state ) { struct pci_dev * pci_dev = to_pci_dev ( dev ) ; struct pci_driver * drv = pci_dev -> driver ; if ( drv && drv -> suspend ) { pci_power_t prev = pci_dev -> current_state ; int error ; error = drv -> suspend ( pci_dev , state ) ; suspend_report_result ( drv -> suspend , error ) ; if ( ! pci_dev -> state_saved && pci_dev -> current_state != PCI_D0 && pci_dev -> current_state != PCI_UNKNOWN ) { WARN_ONCE ( pci_dev -> current_state != prev , "PCI PM: Device state not saved by %pF\n" , drv -> suspend ) ; } } pci_fixup_device ( pci_fixup_suspend , pci_dev ) ; return 0 ; } 