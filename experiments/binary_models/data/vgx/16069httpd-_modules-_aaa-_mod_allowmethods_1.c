static const char * am_allowmethods ( cmd_parms * cmd , void * d , int argc , char * const argv [ ] ) { int i ; am_conf_t * conf = ( am_conf_t * ) d ; int merge = 0 ; int first = 1 ; char * method ; char action = '\0' ; if ( argc == 0 ) { return "AllowMethods: No method or 'reset' keyword given" ; } if ( argc == 1 ) { if ( ! ap_cstr_casecmp ( argv [ 0 ] , "reset" ) ) { conf -> allowed = 0 ; conf -> enforce_methods = 0 ; conf -> add = 0 ; conf -> allowed_set = 1 ; return NULL ; } } conf -> allowed = 0 ; conf -> add = 0 ; conf -> remove = 0 ; for ( i = 0 ; i < argc ; i ++ ) { int m ; char * w = argv [ i ] ; if ( * w == '-' || * w == '+' ) { if ( ! merge && ! first ) { return "Either all methods in AllowMethods must start with + or -, or no methods may." ; } action = * ( w ++ ) ; method = w ; merge = 1 ; } if ( merge ) { return "Either all methods in AllowMethods must start with + or -, or no methods may." ; } else { method = w ; } m = ap_method_number_of ( ( char const * ) method ) ; if ( m == M_INVALID ) { return apr_pstrcat ( cmd -> pool , "AllowMethods: Invalid Method '" , method , "'" , NULL ) ; } if ( action == '-' ) { conf -> remove |= ( AP_METHOD_BIT << m ) ; conf -> add &= ~ ( AP_METHOD_BIT << m ) ; conf -> allowed &= ~ ( AP_METHOD_BIT << m ) ; } if ( action == '+' ) { conf -> remove &= ~ ( AP_METHOD_BIT << m ) ; conf -> add |= ( AP_METHOD_BIT << m ) ; conf -> allowed |= ( AP_METHOD_BIT << m ) ; } else { conf -> allowed |= ( AP_METHOD_BIT << m ) ; } first = 0 ; } conf -> allowed_set = 1 ; conf -> enforce_methods = 1 ; return NULL ; } 