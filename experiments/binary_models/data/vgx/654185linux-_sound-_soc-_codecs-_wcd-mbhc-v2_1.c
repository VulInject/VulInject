static bool wcd_mbhc_check_for_spl_headset ( struct wcd_mbhc * mbhc ) { bool is_spl_hs = false ; int output_mv , hs_threshold , hph_threshold ; mbhc -> mbhc_cb -> mbhc_micb_ctrl_thr_mic ( mbhc -> component , MIC_BIAS_2 , true ) ; usleep_range ( 10000 , 10100 ) ; output_mv = wcd_measure_adc_once ( mbhc , MUX_CTL_IN2P ) ; hs_threshold = wcd_mbhc_get_spl_hs_thres ( mbhc ) ; hph_threshold = wcd_mbhc_adc_get_hph_thres ( mbhc ) ; if ( ! ( output_mv > hs_threshold || output_mv < hph_threshold ) ) { is_spl_hs = true ; } if ( ! is_spl_hs ) { mbhc -> mbhc_cb -> mbhc_micb_ctrl_thr_mic ( mbhc -> component , MIC_BIAS_2 , false ) ; usleep_range ( 10000 , 10100 ) ; } return is_spl_hs ; } 