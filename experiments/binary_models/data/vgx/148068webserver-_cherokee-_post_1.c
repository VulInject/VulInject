remove_surplus ( , ) { ret_t ret ; cuint_t header_len ; cint_t surplus_len ; ret = cherokee_header_get_length ( & conn -> header , & header_len ) ; if ( post -> len > 0 ) { surplus_len = MIN ( conn -> incoming_header . len - header_len , post -> len ) ; } else { surplus_len = conn -> incoming_header . len - header_len ; } if ( surplus_len <= 0 ) { return ret_ok ; } TRACE ( ENTRIES , "POST surplus: moving %d bytes\n" , surplus_len ) ; cherokee_buffer_add ( & post -> header_surplus , conn -> incoming_header . buf + header_len , surplus_len ) ; cherokee_buffer_remove_chunk ( & conn -> incoming_header , header_len , surplus_len ) ; TRACE ( ENTRIES , "POST surplus: incoming_header is %d bytes (header len=%d)\n" , conn -> incoming_header . len , header_len ) ; return ret_ok ; } 