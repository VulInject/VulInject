static int _modbus_tcp_set_ipv4_options ( int s ) { int rc ; int option ; rc = setsockopt ( s , IPPROTO_TCP , TCP_NODELAY , ( const void * ) & option , sizeof ( int ) ) ; if ( rc == - 1 ) { return - 1 ; } { u_long loption = 1 ; ioctlsocket ( s , FIONBIO , & loption ) ; } option = 1 ; ioctl ( s , FIONBIO , & option ) ; option = IPTOS_LOWDELAY ; rc = setsockopt ( s , IPPROTO_IP , IP_TOS , ( const void * ) & option , sizeof ( int ) ) ; if ( rc == - 1 ) { return - 1 ; } return 0 ; } 