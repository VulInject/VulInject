static int virStorageBackendISCSIGetHostNumber ( const char * sysfs_path , uint32_t * host ) { g_autoptr ( ) sysdir = NULL ; struct dirent * dirent = NULL ; int direrr ; VIR_DEBUG ( "Finding host number from '%s'" , sysfs_path ) ; virWaitForDevices ( ) ; while ( ( direrr = virDirRead ( sysdir , & dirent , sysfs_path ) ) > 0 ) { if ( STRPREFIX ( dirent -> d_name , "target" ) ) { if ( sscanf ( dirent -> d_name , "target%u:" , host ) == 1 ) { return 0 ; } else { virReportError ( VIR_ERR_INTERNAL_ERROR , _ ( "Failed to parse target '%s'" ) , dirent -> d_name ) ; return - 1 ; } } } if ( direrr == 0 ) { virReportError ( VIR_ERR_INTERNAL_ERROR , _ ( "Failed to get host number for iSCSI session " "with path '%s'" ) , sysfs_path ) ; return - 1 ; } return - 1 ; } 