static bool cg_copy_parent_file ( char * path , char * file ) { char * lastslash , * value = NULL , * fpath , oldv ; int len = 0 ; int ret ; lastslash = strrchr ( path , '/' ) ; if ( ! lastslash ) { pam_cgfs_debug ( "cgfsng:copy_parent_file: bad path %s" , path ) ; return false ; } oldv = * lastslash ; * lastslash = '\0' ; fpath = must_make_path ( path , file , NULL ) ; len = lxc_read_from_file ( fpath , NULL , 0 ) ; if ( len <= 0 ) { pam_cgfs_debug ( "Failed to read %s: %s" , fpath , strerror ( errno ) ) ; bad } value = must_realloc ( NULL , len + 1 ) ; if ( lxc_read_from_file ( fpath , value , len ) != len ) { pam_cgfs_debug ( "Failed to read %s: %s" , fpath , strerror ( errno ) ) ; bad } * lastslash = oldv ; fpath = must_make_path ( path , file , NULL ) ; ret = lxc_write_to_file ( fpath , value , len , false , 0660 ) ; if ( ret < 0 ) { pam_cgfs_debug ( "Unable to write %s to %s" , value , fpath ) ; } free ( fpath ) ; free ( value ) ; return ret >= 0 ; bad pam_cgfs_debug ( "Error reading '%s'" , fpath ) ; free ( fpath ) ; free ( value ) ; return false ; } 