static int gsmtty_modem_update ( struct gsm_dlci * dlci , u8 brk ) { u8 modembits [ 5 ] ; struct gsm_control * ctrl ; int len = 2 ; if ( brk ) { len ++ ; } modembits [ 0 ] = len << 1 | EA ; modembits [ 1 ] = dlci -> addr << 2 | 3 ; modembits [ 2 ] = gsm_encode_modem ( dlci ) << 1 | EA ; if ( brk ) { modembits [ 3 ] = brk << 4 | 2 | EA ; } ctrl = gsm_control_send ( dlci -> gsm , CMD_MSC , modembits , len + 1 ) ; return gsm_control_wait ( dlci -> gsm , ctrl ) ; } 