static int dissect_peekremote_legacy ( tvbuff_t * tvb , packet_info * pinfo , proto_tree * tree , void * data ) { tvbuff_t * next_tvb ; proto_tree * peekremote_tree = NULL ; proto_item * ti = NULL ; struct ieee_802_11_phdr phdr ; guint8 signal_percent ; if ( dissect_peekremote_new ( tvb , pinfo , tree , data ) ) { return tvb_reported_length ( tvb ) ; } col_set_str ( pinfo -> cinfo , COL_PROTOCOL , "PEEKREMOTE" ) ; col_clear ( pinfo -> cinfo , COL_INFO ) ; if ( tree ) { ti = proto_tree_add_item ( tree , proto_peekremote , tvb , 0 , - 1 , ENC_NA ) ; peekremote_tree = proto_item_add_subtree ( ti , ett_peekremote ) ; proto_tree_add_item ( peekremote_tree , hf_peekremote_signal_dbm , tvb , 0 , 1 , ENC_NA ) ; proto_tree_add_item ( peekremote_tree , hf_peekremote_noise_dbm , tvb , 1 , 1 , ENC_NA ) ; proto_tree_add_item ( peekremote_tree , hf_peekremote_packetlength , tvb , 2 , 2 , ENC_BIG_ENDIAN ) ; proto_tree_add_item ( peekremote_tree , hf_peekremote_slicelength , tvb , 4 , 2 , ENC_BIG_ENDIAN ) ; dissect_peekremote_flags ( tvb , pinfo , peekremote_tree , 6 ) ; dissect_peekremote_status ( tvb , pinfo , peekremote_tree , 7 ) ; proto_tree_add_item ( peekremote_tree , hf_peekremote_timestamp , tvb , 8 , 8 , ENC_BIG_ENDIAN ) ; proto_tree_add_item ( peekremote_tree , hf_peekremote_speed , tvb , 16 , 1 , ENC_NA ) ; proto_tree_add_item ( peekremote_tree , hf_peekremote_channel , tvb , 17 , 1 , ENC_BIG_ENDIAN ) ; proto_tree_add_item ( peekremote_tree , hf_peekremote_signal_percent , tvb , 18 , 1 , ENC_NA ) ; proto_tree_add_item ( peekremote_tree , hf_peekremote_noise_percent , tvb , 19 , 1 , ENC_NA ) ; } signal_percent = tvb_get_guint8 ( tvb , 18 ) ; proto_item_set_end ( ti , tvb , 20 ) ; next_tvb = tvb_new_subset_remaining ( tvb , 20 ) ; if ( GPOINTER_TO_INT ( data ) == IS_ARUBA && signal_percent == 100 ) { phdr . fcs_len = 0 ; } else { phdr . fcs_len = 4 ; } phdr . decrypted = FALSE ; phdr . phy = PHDR_802_11_PHY_UNKNOWN ; phdr . has_channel = TRUE ; phdr . channel = tvb_get_guint8 ( tvb , 17 ) ; phdr . has_data_rate = TRUE ; phdr . data_rate = tvb_get_guint8 ( tvb , 16 ) ; phdr . has_signal_percent = TRUE ; phdr . signal_percent = tvb_get_guint8 ( tvb , 18 ) ; phdr . has_noise_percent = TRUE ; phdr . noise_percent = tvb_get_guint8 ( tvb , 18 ) ; phdr . has_signal_dbm = TRUE ; phdr . signal_dbm = tvb_get_guint8 ( tvb , 0 ) ; phdr . has_noise_dbm = TRUE ; phdr . noise_dbm = tvb_get_guint8 ( tvb , 1 ) ; phdr . has_tsf_timestamp = TRUE ; phdr . tsf_timestamp = tvb_get_ntoh64 ( tvb , 8 ) ; if ( RATE_IS_DSSS ( phdr . data_rate ) ) { phdr . phy = PHDR_802_11_PHY_11B ; phdr . phy_info . info_11b . has_short_preamble = FALSE ; } if ( RATE_IS_OFDM ( phdr . data_rate ) ) { if ( CHAN_IS_BG ( phdr . channel ) ) { phdr . phy = PHDR_802_11_PHY_11G ; phdr . phy_info . info_11g . has_mode = FALSE ; } else { phdr . phy = PHDR_802_11_PHY_11A ; phdr . phy_info . info_11a . has_channel_type = FALSE ; phdr . phy_info . info_11a . has_turbo_type = FALSE ; } } return 20 + call_dissector_with_data ( wlan_radio_handle , next_tvb , pinfo , tree , & phdr ) ; } 