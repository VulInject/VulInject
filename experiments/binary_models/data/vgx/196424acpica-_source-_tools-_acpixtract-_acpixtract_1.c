AxExtractToMultiAmlFile ( ) { FILE * InputFile ; FILE * OutputFile ; int Status = 0 ; int TotalBytesWritten = 0 ; int ThisTableBytesWritten = 0 ; unsigned int BytesConverted ; char ThisSignature [ 4 ] ; unsigned int State = AX_STATE_FIND_HEADER ; strcpy ( Gbl_OutputFilename , AX_MULTI_TABLE_FILENAME ) ; InputFile = fopen ( InputPathname , "r" ) ; if ( ! InputFile ) { printf ( "Could not open input file %s\n" , InputPathname ) ; return ( - 1 ) ; } if ( ! AxIsFileAscii ( InputFile ) ) { fclose ( InputFile , NULL ) ; return ( - 1 ) ; } OutputFile = fopen ( Gbl_OutputFilename , "w+b" ) ; if ( ! OutputFile ) { printf ( "Could not open output file %s\n" , Gbl_OutputFilename ) ; fclose ( InputFile ) ; return ( - 1 ) ; } while ( fgets ( Gbl_LineBuffer , AX_LINE_BUFFER_SIZE , InputFile ) ) { if ( AX_IS_TABLE_BLOCK_HEADER && ( State == AX_STATE_EXTRACT_DATA ) ) { if ( ThisTableBytesWritten ) { printf ( AX_TABLE_INFO_FORMAT , ThisSignature , ThisTableBytesWritten , ThisTableBytesWritten , Gbl_OutputFilename ) ; } else { Gbl_TableCount -- ; } State = AX_STATE_FIND_HEADER ; } switch ( State ) { case AX_STATE_FIND_HEADER : if ( ! AxIsDataBlockHeader ( ) ) { continue ; } ACPI_COPY_NAMESEG ( ThisSignature , Gbl_LineBuffer ) ; if ( ! ACPI_COMPARE_NAMESEG ( ThisSignature , ACPI_SIG_DSDT ) && ! ACPI_COMPARE_NAMESEG ( ThisSignature , ACPI_SIG_SSDT ) ) { continue ; } Gbl_TableCount ++ ; ThisTableBytesWritten = 0 ; State = AX_STATE_EXTRACT_DATA ; continue ; case AX_STATE_EXTRACT_DATA : if ( ! AxIsHexDataLine ( ) ) { continue ; } BytesConverted = AxConvertAndWrite ( OutputFile , ThisSignature ) ; switch ( BytesConverted ) { case 0 : State = AX_STATE_FIND_HEADER ; continue ; case - 1 : Status = - 1 ; CleanupAndExit default : ThisTableBytesWritten += BytesConverted ; TotalBytesWritten += BytesConverted ; continue ; } default : Status = - 1 ; CleanupAndExit } } CleanupAndExit if ( State == AX_STATE_EXTRACT_DATA ) { printf ( AX_TABLE_INFO_FORMAT , ThisSignature , ThisTableBytesWritten , ThisTableBytesWritten , Gbl_OutputFilename ) ; } printf ( "\n%u binary ACPI tables extracted and written to %s (%u bytes)\n" , Gbl_TableCount , Gbl_OutputFilename , TotalBytesWritten ) ; fclose ( InputFile ) ; fclose ( OutputFile ) ; return ( Status ) ; } 