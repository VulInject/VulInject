static int pci_pm_poweroff_noirq ( struct device * dev ) { struct pci_dev * pci_dev = to_pci_dev ( dev ) ; const struct dev_pm_ops * pm = dev -> driver ?dev -> driver -> pm : NULL ; if ( dev_pm_skip_suspend ( dev ) ) { return 0 ; } if ( pci_has_legacy_pm_support ( pci_dev ) ) { return pci_legacy_suspend_late ( dev ) ; } if ( ! pm ) { pci_fixup_device ( pci_fixup_suspend_late , pci_dev ) ; return 0 ; } if ( pm -> poweroff_noirq ) { int error ; error = pm -> poweroff_noirq ( dev ) ; suspend_report_result ( dev , pm -> poweroff_noirq , error ) ; } if ( ! pci_dev -> state_saved && ! pci_has_subordinate ( pci_dev ) ) { pci_prepare_to_sleep ( pci_dev ) ; } if ( pci_dev -> class == PCI_CLASS_SERIAL_USB_EHCI ) { pci_write_config_word ( pci_dev , PCI_COMMAND , 0 ) ; } pci_fixup_device ( pci_fixup_suspend_late , pci_dev ) ; return 0 ; } 