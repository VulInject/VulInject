char * lost_held_location_request ( p_lost_held_t held , int * lgth ) { int buffersize = 0 ; char buf [ BUFSIZE ] ; char * doc = NULL ; xmlChar * xmlbuff = NULL ; xmlDocPtr request = NULL ; xmlNodePtr ptrLocationRequest = NULL ; xmlNodePtr ptrLocationType = NULL ; xmlNodePtr ptrDevice = NULL ; xmlKeepBlanksDefault ( 1 ) ; * lgth = 0 ; request = xmlNewDoc ( BAD_CAST "1.0" ) ; if ( request == NULL ) { LM_ERR ( "locationRequest xmlNewDoc() failed\n" ) ; return doc ; } ptrLocationRequest = xmlNewNode ( , ) ; if ( ptrLocationRequest == NULL ) { LM_ERR ( "locationRequest xmlNewNode() failed\n" ) ; return doc ; } xmlDocSetRootElement ( request , ptrLocationRequest ) ; xmlNewProp ( ptrLocationRequest , BAD_CAST "xmlns" , BAD_CAST "urn:ietf:params:xml:ns:geopriv:held" ) ; if ( held -> time > 0 ) { snprintf ( buf , BUFSIZE , "%d" , held -> time ) ; xmlNewProp ( , , ) } if ( held -> time == - 1 ) { xmlNewProp ( , , ) } else { xmlNewProp ( , , ) } ptrLocationType = xmlNewChild ( , , , ) ; xmlNewProp ( ptrLocationType , BAD_CAST "exact" , ( held -> exact == HELD_EXACT_TRUE ) ?BAD_CAST "true" : BAD_CAST "false" ) ; ptrDevice = xmlNewChild ( ptrLocationRequest , NULL , BAD_CAST "device" , NULL ) ; if ( ptrDevice == NULL ) { LM_ERR ( "locationRequest xmlNewChild() failed\n" ) ; xmlFreeDoc ( request ) ; return doc ; } xmlNewProp ( ptrDevice , BAD_CAST "xmlns" , BAD_CAST "urn:ietf:params:xml:ns:geopriv:held:id" ) ; xmlNewChild ( , , "uri" , ) xmlDocDumpFormatMemory ( request , & xmlbuff , & buffersize , 0 ) ; if ( xmlbuff == NULL ) { LM_ERR ( "locationRequest xmlDocDumpFormatMemory() failed\n" ) ; xmlFreeDoc ( request ) ; return doc ; } doc = ( char * ) pkg_malloc ( ( buffersize + 1 ) * sizeof ( char ) ) ; if ( doc == NULL ) { PKG_MEM_ERROR ; xmlFree ( xmlbuff ) ; xmlFreeDoc ( request ) ; return doc ; } memset ( doc , 0 , buffersize ) ; memcpy ( doc , ( char * ) xmlbuff , buffersize ) ; doc [ buffersize ] = '\0' ; * lgth = strlen ( doc ) ; xmlFree ( xmlbuff ) ; xmlFreeDoc ( request ) ; return doc ; } 