static ssize_t write_irq_affinity ( int type , struct file * file , const char __user * buffer , size_t count , loff_t * pos ) { unsigned int irq = ( int ) ( long ) pde_data ( file_inode ( file ) ) ; cpumask_var_t new_value ; int err ; if ( ! irq_can_set_affinity_usr ( irq ) || no_irq_affinity ) { return - EIO ; } if ( type ) { err = cpumask_parselist_user ( buffer , count , new_value ) ; } else { err = cpumask_parse_user ( buffer , count , new_value ) ; } if ( err ) { free_cpumask } if ( ! cpumask_intersects ( new_value , cpu_online_mask ) ) { err = irq_select_affinity_usr ( irq ) ?- EINVAL : count ; } else { err = irq_set_affinity ( irq , new_value ) ; if ( ! err ) { err = count ; } } free_cpumask free_cpumask_var ( new_value ) ; return err ; } 