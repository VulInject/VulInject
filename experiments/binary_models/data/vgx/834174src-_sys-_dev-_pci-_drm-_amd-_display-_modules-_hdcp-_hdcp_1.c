enum mod_hdcp_status mod_hdcp_update_display ( struct mod_hdcp * hdcp , uint8_t index , struct mod_hdcp_link_adjustment * link_adjust , struct mod_hdcp_display_adjustment * display_adjust , struct mod_hdcp_output * output ) { enum mod_hdcp_status status = MOD_HDCP_STATUS_SUCCESS ; struct mod_hdcp_display * display = NULL ; HDCP_TOP_INTERFACE_TRACE_WITH_INDEX ( hdcp , index ) ; memset ( output , 0 , sizeof ( mod_hdcp_output ) ) ; display = get_active_display_at_index ( hdcp , index ) ; if ( ! display ) { status = MOD_HDCP_STATUS_DISPLAY_NOT_FOUND ; out } if ( memcmp ( link_adjust , & hdcp -> connection . link . adjust , sizeof ( mod_hdcp_link_adjustment ) ) == 0 && memcmp ( display_adjust , & display -> adjust , sizeof ( mod_hdcp_display_adjustment ) ) == 0 ) { status = MOD_HDCP_STATUS_SUCCESS ; out } if ( memcmp ( link_adjust , & hdcp -> connection . link . adjust , sizeof ( mod_hdcp_link_adjustment ) ) == 0 && memcmp ( display_adjust , & display -> adjust , sizeof ( mod_hdcp_display_adjustment ) ) != 0 ) { status = update_display_adjustments ( hdcp , display , display_adjust ) ; if ( status != MOD_HDCP_STATUS_NOT_IMPLEMENTED ) { out } } status = reset_authentication ( hdcp , output ) ; if ( status != MOD_HDCP_STATUS_SUCCESS ) { out } reset_retry_counts ( hdcp , NULL ) ; memset ( & hdcp -> connection . trace , 0 , sizeof ( hdcp -> connection . trace ) ) ; hdcp -> connection . link . adjust = * link_adjust ; display -> adjust = * display_adjust ; if ( current_state ( hdcp ) != HDCP_UNINITIALIZED ) { callback_in_ms ( 100 , output ) ; } out if ( status != MOD_HDCP_STATUS_SUCCESS ) { push_error_status ( hdcp , status ) ; } return status ; } 