void * acpi_os_acquire_object ( struct acpi_memory_list * cache ) { acpi_status status ; void * object ; ACPI_FUNCTION_TRACE ( os_acquire_object ) ; if ( ! cache ) { return_PTR ( NULL ) ; } status = acpi_ut_acquire_mutex ( ACPI_MTX_CACHES ) ; if ( ACPI_FAILURE ( status ) ) { return_PTR ( NULL ) ; } ACPI_MEM_TRACKING ( cache -> requests ++ ) ; if ( cache -> list_head ) { object = cache -> list_head ; cache -> list_head = ACPI_GET_DESCRIPTOR_PTR ( object ) ; cache -> current_depth -- ; ACPI_MEM_TRACKING ( cache -> hits ++ ) ; ACPI_DEBUG_PRINT ( ( ACPI_DB_EXEC , "Object %p from %s cache\n" , object , cache -> list_name ) ) ; status = acpi_ut_release_mutex ( ACPI_MTX_CACHES ) ; if ( ACPI_FAILURE ( status ) ) { return_PTR ( NULL ) ; } } else { ACPI_MEM_TRACKING ( cache -> total_allocated ++ ) ; if ( ( cache -> total_allocated - cache -> total_freed ) > cache -> max_occupied ) { cache -> max_occupied = cache -> total_allocated - cache -> total_freed ; } status = acpi_ut_release_mutex ( ACPI_MTX_CACHES ) ; if ( ACPI_FAILURE ( status ) ) { return_PTR ( NULL ) ; } object = ACPI_ALLOCATE_ZEROED ( cache -> object_size ) ; if ( ! object ) { return_PTR ( NULL ) ; } } return_PTR ( object ) ; } 