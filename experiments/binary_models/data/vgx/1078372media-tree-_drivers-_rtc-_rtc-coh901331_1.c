static int coh901331_set_alarm ( struct device * dev , struct rtc_wkalrm * alarm ) { struct coh901331_port * rtap = dev_get_drvdata ( dev ) ; unsigned long time ; rtc_tm_to_time ( & alarm -> time , & time ) ; clk_enable ( rtap -> clk , NULL ) ; writel ( time , rtap -> virtbase + COH901331_ALARM ) ; writel ( alarm -> enabled , rtap -> virtbase + COH901331_IRQ_MASK ) ; clk_disable ( rtap -> clk ) ; return 0 ; } 