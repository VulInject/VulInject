static void key_send_line ( void ) { HISTORY_REC * history ; char * str ; int add_history ; str = gui_entry_get_text ( active_entry ) ; add_history = * str != '\0' ; history = command_history_current ( active_win , NULL ) ; if ( redir == NULL ) { signal_emit ( "send command" , 3 , str , active_win -> active_server , active_win -> active ) ; } else { if ( redir -> flags & ENTRY_REDIRECT_FLAG_HIDDEN ) { add_history = 0 ; } handle_entry_redirect ( str ) ; } if ( add_history ) { history = command_history_find ( history ) ; if ( history != NULL ) { command_history_add ( history , str ) ; } } if ( active_entry != NULL ) { gui_entry_set_text ( active_entry , "" ) ; } command_history_clear_pos ( active_win ) ; g_free ( str ) ; } 