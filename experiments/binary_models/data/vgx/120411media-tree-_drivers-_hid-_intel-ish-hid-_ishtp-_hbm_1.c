int ishtp_hbm_start_wait ( struct ishtp_device * dev ) { int ret ; dev_dbg ( dev -> devc , "Going to wait for ishtp start. hbm_state=%08X\n" , dev -> hbm_state ) ; ret = wait_event_interruptible_timeout ( dev -> wait_hbm_recvd_msg , dev -> hbm_state >= ISHTP_HBM_STARTED , ( ISHTP_INTEROP_TIMEOUT * HZ ) ) ; dev_dbg ( dev -> devc , "Woke up from waiting for ishtp start. hbm_state=%08X\n" , dev -> hbm_state ) ; if ( ret <= 0 && ( dev -> hbm_state <= ISHTP_HBM_START ) ) { dev -> hbm_state = ISHTP_HBM_IDLE ; dev_err ( dev -> devc , "waiting for ishtp start failed. ret=%d hbm_state=%08X\n" , ret , dev -> hbm_state ) ; return - ETIMEDOUT ; } return 0 ; } 