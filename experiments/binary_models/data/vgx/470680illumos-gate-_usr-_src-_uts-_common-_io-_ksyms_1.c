static size_t ksyms_buflist_alloc ( ksyms_buflist_hdr_t * hdr , size_t size ) { int chunks , i ; ksyms_buflist_t * list ; chunks = howmany ( size , BUF_SIZE ) ; if ( hdr -> nchunks >= chunks ) { return ( hdr -> nchunks * BUF_SIZE ) ; } for ( i = chunks - hdr -> nchunks ; i > 0 ; i -- ) { if ( ( list = kmem_alloc ( PAGESIZE , KM_NOSLEEP ) ) == NULL ) { break ; } list_insert_tail ( & hdr -> blist , list ) ; } if ( i > 0 ) { return ( 0 ) ; } hdr -> nchunks = chunks ; hdr -> cur = list_head ( & hdr -> blist ) ; hdr -> curbuf_off = 0 ; return ( chunks * BUF_SIZE ) ; } 