static int _set_node_type_cnt ( gres_state_t * gres_state_job , list_t * node_gres_list ) { gres_job_state_t * gres_js = gres_state_job -> gres_data ; gres_state_t * gres_state_node ; gres_node_state_t * gres_ns ; if ( ! ( gres_state_node = list_find_first ( node_gres_list , gres_find_id , & gres_state_job -> plugin_id ) ) ) { return 0 ; } gres_ns = gres_state_node -> gres_data ; for ( int j = 0 ; j < gres_ns -> type_cnt ; j ++ ) { if ( gres_ns -> type_cnt_alloc [ j ] || ( gres_ns -> type_id [ j ] != gres_js -> type_id ) || ( gres_js -> total_gres == NO_CONSUME_VAL64 ) ) { continue ; } gres_ns -> type_cnt_alloc [ j ] = gres_js -> total_gres ; break ; } return 0 ; } 