static int aac_scsi_64 ( struct fib * fib , struct scsi_cmnd * cmd ) { u16 fibsize ; struct aac_srb * srbcmd = aac_scsi_common ( fib , cmd ) ; long ret ; ret = aac_build_sg64 ( cmd , ( sgmap64 * ) & srbcmd -> sg ) ; if ( ret < 0 ) { return ret ; } srbcmd -> count = cpu_to_le32 ( scsi_bufflen ( cmd ) ) ; memcpy ( srbcmd -> cdb , cmd -> cmnd , cmd -> cmd_len ) ; fibsize = sizeof ( aac_srb ) - sizeof ( sgentry ) + ( ( le32_to_cpu ( srbcmd -> sg . count ) & 0xff ) * sizeof ( sgentry64 ) ) ; BUG_ON ( fibsize > ( fib -> dev -> max_fib_size - sizeof ( aac_fibhdr ) ) ) ; return aac_fib_send ( ScsiPortCommand64 , fib , fibsize , FsaNormal , 0 , 1 , ( fib_callback ) aac_srb_callback , ( void * ) cmd ) ; } 