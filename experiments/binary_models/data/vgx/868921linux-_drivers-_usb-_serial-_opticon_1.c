static int opticon_open ( struct tty_struct * tty , struct usb_serial_port * port ) { struct opticon_private * priv = usb_get_serial_port_data ( port ) ; cfs_time_t flags ; int res ; spin_lock_irqsave ( & priv -> lock , flags ) ; priv -> rts = false ; spin_unlock_irqrestore ( & priv -> lock , flags ) ; send_control_msg ( port , CONTROL_RTS , 0 ) ; usb_clear_halt ( port -> serial -> dev , port -> read_urb -> pipe ) ; res = usb_serial_generic_open ( tty , port ) ; if ( res ) { return res ; } send_control_msg ( port , RESEND_CTS_STATE , 1 ) ; return res ; } 