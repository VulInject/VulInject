static int vexpress_regulator_probe ( struct platform_device * pdev ) { struct regulator_desc * desc ; struct regulator_init_data * init_data ; struct regulator_config config = { } ; struct regulator_dev * rdev ; struct regmap * regmap ; desc = devm_kzalloc ( & pdev -> dev , sizeof ( * desc ) , GFP_KERNEL ) ; if ( ! desc ) { return - ENOMEM ; } regmap = devm_regmap_init_vexpress_config ( & pdev -> dev ) ; if ( IS_ERR ( regmap ) ) { return PTR_ERR ( regmap ) ; } desc -> name = dev_name ( & pdev -> dev ) ; desc -> type = REGULATOR_VOLTAGE ; desc -> owner = THIS_MODULE ; desc -> continuous_voltage_range = true ; init_data = of_get_regulator_init_data ( & pdev -> dev , pdev -> dev . of_node , desc ) ; init_data -> constraints . apply_uV = 0 ; if ( init_data -> constraints . min_uV && init_data -> constraints . max_uV ) { desc -> ops = & vexpress_regulator_ops ; } else { desc -> ops = & vexpress_regulator_ops_ro ; } config . regmap = regmap ; config . dev = & pdev -> dev ; config . init_data = init_data ; config . of_node = pdev -> dev . of_node ; rdev = devm_regulator_register ( & pdev -> dev , desc , & config ) ; return PTR_ERR_OR_ZERO ( rdev ) ; } 