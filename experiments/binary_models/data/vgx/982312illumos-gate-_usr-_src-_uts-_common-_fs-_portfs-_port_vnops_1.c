void port_discard_events ( port_queue_t * portq ) { port_kevent_t * kevp ; pid_t pid = curproc -> p_pid ; mutex_enter ( & portq -> portq_mutex ) ; port_block ( portq , NULL ) ; port_push_eventq ( portq ) ; kevp = list_head ( & portq -> portq_list ) ; while ( kevp ) { if ( kevp -> portkev_pid == pid ) { if ( kevp -> portkev_flags & PORT_KEV_NOSHARE ) { kevp -> portkev_flags |= PORT_KEV_FREE ; } } kevp = list_next ( & portq -> portq_list , kevp ) ; } port_unblock ( portq ) ; mutex_exit ( & portq -> portq_mutex ) ; } 