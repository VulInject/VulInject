static int ide_port_alloc_devices ( ide_hwif_t * hwif , int node ) { ide_drive_t * drive ; int i ; for ( i = 0 ; i < MAX_DRIVES ; i ++ ) { drive = kzalloc_node ( sizeof ( * drive ) , GFP_KERNEL , node ) ; if ( drive == NULL ) { out_nomem } drive -> id = kzalloc_node ( SECTOR_SIZE , GFP_KERNEL , node ) ; if ( drive -> id == NULL ) { out_free_drive } drive -> sense_rq = kmalloc ( sizeof ( request ) + sizeof ( ide_request ) , GFP_KERNEL ) ; if ( ! drive -> sense_rq ) { out_free_id } hwif -> devices [ i ] = drive ; } return 0 ; out_free_id kfree ( drive -> id ) ; out_free_drive out_nomem ide_port_free_devices ( hwif ) ; return - ENOMEM ; } 