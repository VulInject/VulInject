PHP_FUNCTION ( ) { php_stream * stream ; zval * zsrc ; zend_long maxlen , desiredpos = - 1L ; bool maxlen_is_null = 1 ; zend_string * contents ; ZEND_PARSE_PARAMETERS_START ( 1 , 3 ) Z_PARAM_RESOURCE ( ) Z_PARAM_OPTIONAL Z_PARAM_LONG_OR_NULL ( maxlen , maxlen_is_null ) Z_PARAM_LONG ( desiredpos ) ZEND_PARSE_PARAMETERS_END ( ) ; if ( maxlen_is_null ) { maxlen = ( ssize_t ) PHP_STREAM_COPY_ALL ; } if ( maxlen < 0 && maxlen != ( ssize_t ) PHP_STREAM_COPY_ALL ) { zend_argument_value_error ( 2 , "must be greater than or equal to -1" ) ; RETURN_THROWS ( ) ; } php_stream_from_zval ( stream , zsrc ) ; if ( desiredpos >= 0 ) { int seek_res ; zend_off_t position ; position = php_stream_tell ( stream ) ; if ( position >= 0 && desiredpos > position ) { seek_res = php_stream_seek ( stream , desiredpos - position , SEEK_CUR ) ; } if ( desiredpos < position ) { seek_res = php_stream_seek ( stream , desiredpos , SEEK_SET ) ; } if ( seek_res != 0 ) { php_error_docref ( NULL , E_WARNING , "Failed to seek to position " ZEND_LONG_FMT " in the stream" , desiredpos ) ; RETURN_FALSE ; } } if ( ( contents = php_stream_copy_to_mem ( stream , maxlen , 0 ) ) ) { RETURN_STR ( contents ) ; } else { RETURN_EMPTY_STRING ( ) ; } } 