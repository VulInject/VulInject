static int tcm_loop_make_nexus ( struct tcm_loop_tpg * tl_tpg , const char * name ) { struct tcm_loop_hba * tl_hba = tl_tpg -> tl_hba ; struct tcm_loop_nexus * tl_nexus ; int ret ; if ( tl_tpg -> tl_nexus ) { pr_debug ( "tl_tpg->tl_nexus already exists\n" ) ; return - EEXIST ; } tl_nexus = kzalloc ( sizeof ( tcm_loop_nexus ) , GFP_KERNEL ) ; if ( ! tl_nexus ) { pr_err ( "Unable to allocate struct tcm_loop_nexus\n" ) ; return - ENOMEM ; } tl_nexus -> se_sess = target_alloc_session ( & tl_tpg -> tl_se_tpg , 0 , 0 , TARGET_PROT_DIN_PASS | TARGET_PROT_DOUT_PASS , name , tl_nexus , tcm_loop_alloc_sess_cb ) ; if ( IS_ERR ( tl_nexus -> se_sess ) ) { ret = PTR_ERR ( tl_nexus -> se_sess ) ; return ret ; } pr_debug ( "TCM_Loop_ConfigFS: Established I_T Nexus to emulated" " %s Initiator Port: %s\n" , tcm_loop_dump_proto_id ( tl_hba ) , name ) ; return 0 ; } 