extern List create_node_info_list ( node_info_msg_t * node_info_ptr , bool by_partition ) { static List info_list = NULL ; static node_info_msg_t * last_node_info_ptr = NULL ; List last_list = NULL ; ListIterator last_list_itr = NULL ; int i = 0 ; sview_node_info_t * sview_node_info_ptr = NULL ; node_info_t * node_ptr = NULL ; char user [ 32 ] , time_str [ 256 ] ; if ( ! by_partition ) { if ( ! node_info_ptr || ( info_list && ( node_info_ptr == last_node_info_ptr ) ) ) { update_color } } last_node_info_ptr = node_info_ptr ; if ( info_list ) { last_list = info_list ; } info_list = list_create ( _node_info_list_del ) ; if ( last_list ) { last_list_itr = list_iterator_create ( last_list ) ; } for ( i = 0 ; i < node_info_ptr -> record_count ; i ++ ) { node_ptr = & ( node_info_ptr -> node_array [ i ] ) ; if ( ! node_ptr -> name || ( node_ptr -> name [ 0 ] == '\0' ) ) { continue ; } sview_node_info_ptr = NULL ; if ( last_list_itr ) { while ( ( sview_node_info_ptr = list_next ( last_list_itr ) ) ) { if ( ! xstrcmp ( sview_node_info_ptr -> node_name , node_ptr -> name ) ) { list_remove ( last_list_itr ) ; _node_info_free ( sview_node_info_ptr ) ; break ; } } list_iterator_reset ( last_list_itr ) ; } if ( ! sview_node_info_ptr ) { sview_node_info_ptr = xmalloc ( sizeof ( sview_node_info_t ) ) ; } list_append ( info_list , sview_node_info_ptr ) ; sview_node_info_ptr -> node_name = xstrdup ( node_ptr -> name ) ; sview_node_info_ptr -> node_ptr = node_ptr ; sview_node_info_ptr -> pos = i ; if ( node_ptr -> reason && ( node_ptr -> reason_uid != NO_VAL ) && node_ptr -> reason_time ) { struct passwd * pw = NULL ; if ( ( pw = getpwuid ( node_ptr -> reason_uid ) ) ) { snprintf ( user , sizeof ( user ) , "%s" , pw -> pw_name ) ; } else { snprintf ( user , sizeof ( user ) , "Unk(%u)" , node_ptr -> reason_uid ) ; } slurm_make_time_str ( & node_ptr -> reason_time , time_str , sizeof ( time_str ) ) ; sview_node_info_ptr -> reason = xstrdup_printf ( "%s [%s@%s]" , node_ptr -> reason , user , time_str ) ; } if ( node_ptr -> reason ) { sview_node_info_ptr -> reason = xstrdup ( node_ptr -> reason ) ; } if ( node_ptr -> boot_time ) { slurm_make_time_str ( & node_ptr -> boot_time , time_str , sizeof ( time_str ) ) ; sview_node_info_ptr -> boot_time = xstrdup ( time_str ) ; } if ( node_ptr -> slurmd_start_time ) { slurm_make_time_str ( & node_ptr -> slurmd_start_time , time_str , sizeof ( time_str ) ) ; sview_node_info_ptr -> slurmd_start_time = xstrdup ( time_str ) ; } } if ( last_list ) { list_iterator_destroy ( last_list_itr ) ; FREE_NULL_LIST ( last_list , NULL ) ; } update_color return info_list ; } 