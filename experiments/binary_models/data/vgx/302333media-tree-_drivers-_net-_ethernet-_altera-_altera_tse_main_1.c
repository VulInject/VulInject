static irqreturn_t altera_isr ( int irq , void * dev_id ) { struct net_device * dev = dev_id ; struct altera_tse_private * priv ; if ( unlikely ( ! dev ) ) { pr_err ( "%s: invalid dev pointer\n" , __func__ ) ; return IRQ_NONE ; } priv = netdev_priv ( dev ) ; spin_lock ( & priv -> rxdma_irq_lock ) ; priv -> dmaops -> clear_rxirq ( priv , NULL ) ; priv -> dmaops -> clear_txirq ( priv ) ; spin_unlock ( & priv -> rxdma_irq_lock ) ; if ( likely ( napi_schedule_prep ( & priv -> napi ) ) ) { spin_lock ( & priv -> rxdma_irq_lock ) ; priv -> dmaops -> disable_rxirq ( priv ) ; priv -> dmaops -> disable_txirq ( priv ) ; spin_unlock ( & priv -> rxdma_irq_lock ) ; __napi_schedule ( & priv -> napi ) ; } return IRQ_HANDLED ; } 