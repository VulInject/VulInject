int swreg_to_restricted ( swreg dst , swreg lreg , swreg rreg , struct nfp_insn_re_regs * reg , bool has_imm8 ) { if ( swreg_type ( dst ) == NN_REG_IMM ) { return - EFAULT ; } if ( swreg_type ( dst ) == NN_REG_GPR_B ) { reg -> dst_ab = ALU_DST_B ; } if ( swreg_type ( dst ) == NN_REG_GPR_BOTH ) { reg -> wr_both = true ; } reg -> dst = nfp_swreg_to_rereg ( dst , true , false , NULL ) ; if ( swreg_type ( lreg ) == swreg_type ( rreg ) && swreg_type ( lreg ) != NN_REG_NONE ) { return - EFAULT ; } if ( swreg_type ( lreg ) == NN_REG_GPR_B || swreg_type ( rreg ) == NN_REG_GPR_A ) { reg -> areg = nfp_swreg_to_rereg ( rreg , false , has_imm8 , & reg -> i8 ) ; reg -> breg = nfp_swreg_to_rereg ( lreg , false , has_imm8 , & reg -> i8 ) ; reg -> swap = true ; } else { reg -> areg = nfp_swreg_to_rereg ( lreg , false , has_imm8 , & reg -> i8 ) ; reg -> breg = nfp_swreg_to_rereg ( rreg , false , has_imm8 , & reg -> i8 ) ; } reg -> dst_lmextn = swreg_lmextn ( dst ) ; reg -> src_lmextn = swreg_lmextn ( lreg ) || swreg_lmextn ( rreg ) ; return 0 ; } 