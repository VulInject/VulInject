bbstreamer * bbstreamer_lz4_compressor_new ( bbstreamer * next , pg_compress_specification * compress ) { bbstreamer_lz4_frame * streamer ; LZ4F_errorCode_t ctxError ; LZ4F_preferences_t * prefs ; Assert ( next != NULL ) ; streamer = palloc0 ( sizeof ( bbstreamer_lz4_frame ) ) ; * ( ( const bbstreamer_ops * * ) & streamer -> base . bbs_ops ) = & bbstreamer_lz4_compressor_ops ; streamer -> base . bbs_next = next ; initStringInfo ( & streamer -> base . bbs_buffer ) ; streamer -> header_written = false ; prefs = & streamer -> prefs ; prefs -> frameInfo . blockSizeID = LZ4F_max256KB ; prefs -> compressionLevel = compress -> level ; ctxError = LZ4F_createCompressionContext ( & streamer -> cctx , LZ4F_VERSION ) ; if ( LZ4F_isError ( ctxError ) ) { pg_log_error ( "could not create lz4 compression context: %s" , LZ4F_getErrorName ( ctxError ) ) ; } return & streamer -> base ; pg_fatal ( "this build does not support compression with %s" , "LZ4" ) ; return NULL ; } 