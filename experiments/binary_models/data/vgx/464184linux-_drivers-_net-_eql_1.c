static int eql_s_slave_cfg ( struct net_device * dev , slave_config_t __user * scp ) { slave_t * slave ; equalizer_t * eql ; struct net_device * slave_dev ; slave_config_t sc ; int ret ; if ( copy_from_user ( & sc , scp , sizeof ( slave_config_t ) ) ) { return - EFAULT ; } slave_dev = __dev_get_by_name ( & init_net , sc . slave_name ) ; ret = - EINVAL ; eql = netdev_priv ( dev ) ; spin_lock_bh ( & eql -> queue . lock ) ; if ( eql_is_slave ( slave_dev ) ) { slave = __eql_find_slave_dev ( & eql -> queue , slave_dev ) ; if ( slave ) { slave -> priority = sc . priority ; slave -> priority_bps = sc . priority ; slave -> priority_Bps = sc . priority / 8 ; ret = 0 ; } } spin_unlock_bh ( & eql -> queue . lock ) ; return ret ; } 