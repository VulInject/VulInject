int fm10k_setup_tc ( struct net_device * dev , u8 tc ) { struct fm10k_intfc * interface = netdev_priv ( dev ) ; int err ; if ( tc && ( interface -> hw . mac . type != fm10k_mac_pf ) ) { return - EINVAL ; } if ( netif_running ( dev ) ) { fm10k_close ( dev ) ; } fm10k_mbx_free_irq ( interface ) ; fm10k_clear_queueing_scheme ( interface ) ; netdev_reset_tc ( dev ) ; netdev_set_num_tc ( dev , tc ) ; err = fm10k_init_queueing_scheme ( interface ) ; if ( err ) { err_queueing_scheme } err = fm10k_mbx_request_irq ( interface ) ; if ( err ) { err_mbx_irq } err = netif_running ( dev ) ?fm10k_open ( dev ) : 0 ; if ( err ) { err_open } set_bit ( FM10K_FLAG_SWPRI_CONFIG , interface -> flags ) ; return 0 ; err_open fm10k_mbx_free_irq ( interface ) ; err_mbx_irq fm10k_clear_queueing_scheme ( interface ) ; err_queueing_scheme netif_device_detach ( dev ) ; return err ; } 