static char * line_get_key_value ( char * content , const char * sep , size_t * pos , char * * key_ret , char * * value_ret ) { char * line , * value ; size_t linelen ; assert ( content ) ; assert ( sep ) ; assert ( pos ) ; assert ( key_ret ) ; for ( ; ; ) { line = content + * pos ; if ( * line == '\0' ) { return NULL ; } linelen = 0 ; while ( line [ linelen ] && ! strchr8 ( "\n\r" , line [ linelen ] ) ) { linelen ++ ; } * pos += linelen ; if ( content [ * pos ] ) { ( * pos ) ++ ; } if ( linelen == 0 ) { continue ; } line [ linelen ] = '\0' ; while ( strchr8 ( " \t" , * line ) ) { line ++ ; linelen -- ; } while ( linelen > 0 && strchr8 ( " \t" , line [ linelen - 1 ] ) ) { linelen -- ; } line [ linelen ] = '\0' ; if ( * line == '#' ) { continue ; } value = line ; while ( * value && ! strchr8 ( sep , * value ) ) { value ++ ; } if ( * value == '\0' ) { continue ; } * value = '\0' ; value ++ ; while ( * value && strchr8 ( sep , * value ) ) { value ++ ; } if ( value [ 0 ] == '"' && line [ linelen - 1 ] == '"' ) { value ++ ; line [ linelen - 1 ] = '\0' ; } * key_ret = line ; * value_ret = value ; return line ; } } 