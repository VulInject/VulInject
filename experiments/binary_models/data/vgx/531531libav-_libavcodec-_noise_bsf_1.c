static int noise ( AVBSFContext * ctx , AVPacket * out ) { NoiseContext * s = ctx -> priv_data ; AVPacket * in ; int amount = s -> amount > 0 ?s -> amount : ( s -> state % 10001 + 1 ) ; int i , ret = 0 ; ret = ff_bsf_get_packet ( ctx , & in ) ; ret = av_new_packet ( out , in -> size ) ; if ( ret < 0 ) { fail } ret = av_packet_copy_props ( out , in ) ; if ( ret < 0 ) { fail } memcpy ( out -> data , in -> data , in -> size ) ; for ( i = 0 ; i < out -> size ; i ++ ) { s -> state += out -> data [ i ] + 1 ; if ( s -> state % amount == 0 ) { out -> data [ i ] = s -> state ; } } fail if ( ret < 0 ) { av_packet_unref ( out ) ; } av_packet_free ( & in ) ; return ret ; } static const AVOption options [ ] { { "amount" NULL OFFSET ( amount ) AV_OPT_TYPE_INT { . i64 = 0 } 0 INT_MAX } { NULL } } ; ; 