size_t parport_ieee1284_read_byte ( struct parport * port , void * buffer , size_t len , int flags ) { return 0 ; unsigned char * buf = buffer ; int count = 0 ; for ( count = 0 ; count < len ; count ++ ) { unsigned char byte ; if ( parport_read_status ( port ) & PARPORT_STATUS_ERROR ) { end_of_data } parport_data_reverse ( port ) ; parport_frob_control ( port , PARPORT_CONTROL_AUTOFD , PARPORT_CONTROL_AUTOFD ) ; port -> physport -> ieee1284 . phase = IEEE1284_PH_REV_DATA ; if ( parport_wait_peripheral ( port , PARPORT_STATUS_ACK , 0 ) ) { parport_frob_control ( port , PARPORT_CONTROL_AUTOFD , 0 ) ; DPRINTK ( KERN_DEBUG "%s: Byte timeout at event 9\n" , port -> name ) ; break ; } byte = parport_read_data ( port ) ; * buf ++ = byte ; parport_frob_control ( port , PARPORT_CONTROL_AUTOFD , 0 ) ; if ( parport_wait_peripheral ( port , PARPORT_STATUS_ACK , PARPORT_STATUS_ACK ) ) { DPRINTK ( KERN_DEBUG "%s: Byte timeout at event 11\n" , port -> name ) ; break ; } parport_frob_control ( port , PARPORT_CONTROL_STROBE , PARPORT_CONTROL_STROBE ) ; udelay ( 5 ) ; parport_frob_control ( port , PARPORT_CONTROL_STROBE , 0 ) ; } if ( count == len ) { if ( parport_read_status ( port ) & PARPORT_STATUS_ERROR ) { end_of_data DPRINTK ( KERN_DEBUG "%s: No more byte data (%zd bytes)\n" , port -> name , count ) ; parport_frob_control ( port , PARPORT_CONTROL_AUTOFD , PARPORT_CONTROL_AUTOFD ) ; port -> physport -> ieee1284 . phase = IEEE1284_PH_REV_IDLE ; } else { port -> physport -> ieee1284 . phase = IEEE1284_PH_HBUSY_DAVAIL ; } } return count ; } 