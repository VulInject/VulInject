static int qemuDomainObjPrivateXMLParseJobNBDSource ( xmlNodePtr node , xmlXPathContextPtr ctxt , virDomainDiskDef * disk , virDomainXMLOption * xmlopt ) { VIR_XPATH_NODE_AUTORESTORE ( ) qemuDomainDiskPrivate * diskPriv = QEMU_DOMAIN_DISK_PRIVATE ( disk ) ; g_autofree char * format = NULL ; g_autofree char * type = NULL ; g_autoptr ( ) migrSource = NULL ; xmlNodePtr sourceNode ; ctxt -> node = node ; if ( ! ( type = virXMLPropString ( ctxt -> node , "type" ) ) ) { virReportError ( VIR_ERR_XML_ERROR , "%s" , _ ( "missing storage source type" ) ) ; return - 1 ; } if ( ! ( format = virXMLPropString ( ctxt -> node , "format" ) ) ) { virReportError ( VIR_ERR_XML_ERROR , "%s" , _ ( "missing storage source format" ) ) ; return - 1 ; } if ( ! ( migrSource = virDomainStorageSourceParseBase ( type , format , NULL ) ) ) { return - 1 ; } if ( ( sourceNode = virXPathNode ( "./source" , ctxt ) ) ) { ctxt -> node = sourceNode ; } if ( virDomainStorageSourceParse ( ctxt -> node , ctxt , migrSource , VIR_DOMAIN_DEF_PARSE_STATUS , xmlopt ) < 0 ) { return - 1 ; } diskPriv -> migrSource = g_steal_pointer ( & migrSource ) ; return 0 ; } 