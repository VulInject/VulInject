static int distance ( struct imx_resolution const * res , u32 w , u32 h , bool keep_ratio ) { unsigned int w_ratio ; unsigned int h_ratio ; int match ; int allowed_ratio_mismatch = LARGEST_ALLOWED_RATIO_MISMATCH ; if ( ! keep_ratio ) { allowed_ratio_mismatch = ~ 0 ; } if ( w == 0 ) { return - 1 ; } w_ratio = ( res -> width << 13 ) / w ; if ( h == 0 ) { return - 1 ; } h_ratio = ( res -> height << 13 ) / h ; if ( h_ratio == 0 ) { return - 1 ; } match = abs ( ( ( w_ratio << 13 ) / h_ratio ) - ( ( int ) 8192 ) ) ; if ( ( w_ratio < ( int ) 8192 ) || ( h_ratio < ( int ) 8192 ) || ( match > allowed_ratio_mismatch ) ) { return - 1 ; } return w_ratio + h_ratio ; } 