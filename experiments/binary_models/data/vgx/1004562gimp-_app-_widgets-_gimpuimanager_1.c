gimp_ui_manager_item_key_press ( , , ) { gchar * help_id = NULL ; while ( ! help_id && GTK_IS_MENU_SHELL ( widget ) ) { GtkWidget * menu_item ; menu_item = gtk_menu_shell_get_selected_item ( GTK_MENU_SHELL ( widget ) ) ; if ( ! menu_item && GTK_IS_MENU ( widget ) ) { GtkWidget * parent = gtk_widget_get_parent ( widget ) ; GdkWindow * window = gtk_widget_get_window ( parent ) ; if ( window ) { gint x , y ; gdk_window_get_pointer ( window , & x , & y , NULL ) ; menu_item = find_widget_under_pointer ( window , & x , & y ) ; if ( menu_item && ! GTK_IS_MENU_ITEM ( menu_item ) ) { menu_item = gtk_widget_get_ancestor ( menu_item , GTK_TYPE_MENU_ITEM ) ; if ( ! GTK_IS_MENU_ITEM ( menu_item ) ) { menu_item = NULL ; } } } } if ( menu_item ) { help_id = g_object_get_qdata ( G_OBJECT ( menu_item ) , GIMP_HELP_ID ) ; if ( help_id && ! strlen ( help_id ) ) { help_id = NULL ; } } if ( ! help_id ) { help_id = g_object_get_qdata ( G_OBJECT ( widget ) , GIMP_HELP_ID ) ; if ( help_id && ! strlen ( help_id ) ) { help_id = NULL ; } } if ( ! help_id ) { menu_item = NULL ; if ( GTK_IS_MENU ( widget ) ) { menu_item = gtk_menu_get_attach_widget ( GTK_MENU ( widget ) ) ; } if ( ! menu_item ) { break ; } widget = gtk_widget_get_parent ( menu_item ) ; if ( ! widget ) { break ; } } } if ( kevent -> keyval != GDK_KEY_F1 ) { if ( help_id && gtk_accelerator_valid ( kevent -> keyval , 0 ) && ( strcmp ( help_id , GIMP_HELP_HELP ) == 0 || strcmp ( help_id , GIMP_HELP_HELP_CONTEXT ) == 0 ) ) { return TRUE ; } return FALSE ; } if ( help_id ) { gchar * help_domain = NULL ; gchar * help_string = NULL ; gchar * domain_separator ; help_id = g_strdup ( help_id ) ; domain_separator = strchr ( help_id , '?' ) ; if ( domain_separator ) { * domain_separator = '\0' ; help_domain = g_strdup ( help_id ) ; help_string = g_strdup ( domain_separator + 1 ) ; } else { help_string = g_strdup ( help_id ) ; } gimp_help ( manager -> gimp , NULL , help_domain , help_string ) ; g_free ( help_domain ) ; g_free ( help_string ) ; } return TRUE ; } 