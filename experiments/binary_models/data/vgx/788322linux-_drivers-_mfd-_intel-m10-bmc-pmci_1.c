static int m10bmc_pmci_flash_read ( struct intel_m10bmc * m10bmc , u8 * buf , u32 addr , u32 size ) { struct m10bmc_pmci_device * pmci = container_of ( m10bmc , m10bmc_pmci_device , m10bmc ) ; int ret , ret2 ; mutex_lock ( & pmci -> flash_mutex ) ; if ( pmci -> flash_busy ) { ret = - EBUSY ; unlock } ret = m10bmc_pmci_set_flash_host_mux ( m10bmc , true ) ; if ( ret ) { mux_fail } ret = pmci_flash_bulk_read ( m10bmc , buf , addr , size ) ; mux_fail ret2 = m10bmc_pmci_set_flash_host_mux ( m10bmc , false ) ; unlock mutex_unlock ( & pmci -> flash_mutex ) ; return ret2 ; } 