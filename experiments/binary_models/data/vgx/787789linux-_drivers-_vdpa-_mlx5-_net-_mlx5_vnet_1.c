static virtio_net_ctrl_ack handle_ctrl_vlan ( struct mlx5_vdpa_dev * mvdev , u8 cmd ) { struct mlx5_vdpa_net * ndev = to_mlx5_vdpa_ndev ( mvdev ) ; virtio_net_ctrl_ack status = VIRTIO_NET_ERR ; struct mlx5_control_vq * cvq = & mvdev -> cvq ; __virtio16 vlan ; size_t read ; u16 id ; switch ( cmd ) { case VIRTIO_NET_CTRL_VLAN_ADD : read = vringh_iov_pull_iotlb ( & cvq -> vring , & cvq -> riov , & vlan , sizeof ( vlan ) ) ; if ( read != sizeof ( vlan ) ) { break ; } id = mlx5vdpa16_to_cpu ( mvdev , vlan ) ; if ( mac_vlan_add ( ndev , ndev -> config . mac , id , true ) ) { break ; } status = VIRTIO_NET_OK ; break ; case VIRTIO_NET_CTRL_VLAN_DEL : read = vringh_iov_pull_iotlb ( & cvq -> vring , & cvq -> riov , & vlan , sizeof ( vlan ) ) ; if ( read != sizeof ( vlan ) ) { break ; } id = mlx5vdpa16_to_cpu ( mvdev , vlan ) ; mac_vlan_del ( ndev , ndev -> config . mac , id , true ) ; status = VIRTIO_NET_OK ; break ; default : break ; } return status ; } 