static int DNP3GetTx ( lua_State * luastate ) { if ( ! LuaStateNeedProto ( luastate , ALPROTO_DNP3 ) ) { return LuaCallbackError ( luastate , "error: protocol not dnp3" ) ; } DNP3Transaction * tx = LuaStateGetTX ( luastate ) ; if ( tx == NULL ) { return LuaCallbackError ( luastate , "error: no tx" ) ; } lua_newtable ( luastate , NULL ) ; lua_pushliteral ( luastate , "tx_num" ) ; lua_pushinteger ( luastate , tx -> tx_num ) ; lua_settable ( luastate , - 3 ) ; LUA_PUSHT_INT ( luastate , "has_request" , tx -> is_request ?1 : 0 ) ; if ( tx -> is_request ) { lua_pushliteral ( luastate , "request" ) ; lua_newtable ( luastate ) ; LUA_PUSHT_INT ( luastate , "done" , tx -> done ) ; LUA_PUSHT_INT ( luastate , "complete" , tx -> complete ) ; DNP3PushRequest ( luastate , tx ) ; lua_settable ( luastate , - 3 ) ; } LUA_PUSHT_INT ( luastate , "has_response" , tx -> is_request ?0 : 1 ) ; if ( ! tx -> is_request ) { lua_pushliteral ( luastate , "response" ) ; lua_newtable ( luastate ) ; LUA_PUSHT_INT ( luastate , "done" , tx -> done ) ; LUA_PUSHT_INT ( luastate , "complete" , tx -> complete ) ; DNP3PushResponse ( luastate , tx ) ; lua_settable ( luastate , - 3 ) ; } return 1 ; } 