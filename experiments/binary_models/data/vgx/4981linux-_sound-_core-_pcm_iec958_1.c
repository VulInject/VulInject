( snd_pcm_create_iec958_consumer_default ) ; static int fill_iec958_consumer ( uint rate , uint sample_width , u8 * cs , size_t len ) { if ( ( cs [ 3 ] & IEC958_AES3_CON_FS ) == IEC958_AES3_CON_FS_NOTID ) { unsigned int fs ; switch ( rate ) { case 32000 : fs = IEC958_AES3_CON_FS_32000 ; break ; case 44100 : fs = IEC958_AES3_CON_FS_44100 ; break ; case 48000 : fs = IEC958_AES3_CON_FS_48000 ; break ; case 88200 : fs = IEC958_AES3_CON_FS_88200 ; break ; case 96000 : fs = IEC958_AES3_CON_FS_96000 ; break ; case 176400 : fs = IEC958_AES3_CON_FS_176400 ; break ; case 192000 : fs = IEC958_AES3_CON_FS_192000 ; break ; default : return - EINVAL ; } cs [ 3 ] &= ~ IEC958_AES3_CON_FS ; cs [ 3 ] |= fs ; } if ( len > 4 && ( cs [ 4 ] & IEC958_AES4_CON_WORDLEN ) == IEC958_AES4_CON_WORDLEN_NOTID ) { unsigned int ws ; switch ( sample_width ) { case 16 : ws = IEC958_AES4_CON_WORDLEN_20_16 ; break ; case 18 : ws = IEC958_AES4_CON_WORDLEN_22_18 ; break ; case 20 : ws = IEC958_AES4_CON_WORDLEN_20_16 | IEC958_AES4_CON_MAX_WORDLEN_24 ; break ; case 24 : case 32 : ws = IEC958_AES4_CON_WORDLEN_24_20 | IEC958_AES4_CON_MAX_WORDLEN_24 ; break ; default : return - EINVAL ; } cs [ 4 ] &= ~ IEC958_AES4_CON_WORDLEN ; cs [ 4 ] |= ws ; } return len ; } 