__dead void dvmrpd_shutdown ( void ) { struct iface * iface ; pid_t pid ; int status ; msgbuf_clear ( & iev_dvmrpe -> ibuf . w ) ; close ( iev_dvmrpe -> ibuf . fd ) ; msgbuf_clear ( & iev_rde -> ibuf . w ) ; close ( iev_rde -> ibuf . fd ) ; control_cleanup ( ) ; kmr_shutdown ( ) ; kr_shutdown ( ) ; LIST_FOREACH ( , , ) { if_del ( iface ) ; } mrt_done ( conf -> mroute_socket ) ; log_debug ( "waiting for children to terminate" ) ; { pid = wait ( & status ) ; if ( pid == - 1 ) { if ( errno != EINTR && errno != ECHILD ) { fatal ( "wait" ) ; } } if ( WIFSIGNALED ( status ) ) { log_warnx ( "%s terminated; signal %d" , ( pid == rde_pid ) ?"route decision engine" : "dvmrp engine" , WTERMSIG ( status ) ) ; } } pid != - 1 || ( pid == - 1 && errno == EINTR ) ; free ( iev_dvmrpe ) ; log_info ( "terminating" ) ; exit ( 0 ) ; } 