static int subsystem_open ( struct inode * inode , struct file * filp ) { struct trace_subsystem_dir * dir = NULL , * iter_dir ; struct trace_array * tr = NULL , * iter_tr ; struct event_subsystem * system = NULL ; int ret ; if ( tracing_is_disabled ( ) ) { return - ENODEV ; } mutex_lock ( & event_mutex ) ; mutex_lock ( & trace_types_lock ) ; list_for_each_entry ( , , ) { list_for_each_entry ( , , ) { if ( iter_dir == inode -> i_private ) { tr = iter_tr ; dir = iter_dir ; if ( dir -> nr_events ) { __get_system_dir ( dir ) ; system = dir -> subsystem ; } exit_loop } } } exit_loop mutex_unlock ( & trace_types_lock ) ; mutex_unlock ( & event_mutex ) ; if ( ! system ) { return - ENODEV ; } if ( trace_array_get ( tr ) < 0 ) { put_system ( dir , NULL ) ; return - ENODEV ; } ret = tracing_open_generic ( inode , filp ) ; if ( ret < 0 ) { trace_array_put ( tr ) ; put_system ( dir ) ; } return ret ; } 