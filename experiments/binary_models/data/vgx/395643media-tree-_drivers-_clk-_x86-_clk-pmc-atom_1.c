static int plt_clk_probe ( struct platform_device * pdev ) { const struct pmc_clk_data * pmc_data ; const char * * parent_names ; struct clk_plt_data * data ; unsigned int i ; int err ; pmc_data = dev_get_platdata ( & pdev -> dev ) ; data = devm_kzalloc ( & pdev -> dev , sizeof ( * data ) , GFP_KERNEL ) ; if ( ! data ) { return - ENOMEM ; } parent_names = plt_clk_register_parents ( pdev , data , pmc_data -> clks ) ; if ( IS_ERR ( parent_names ) ) { return PTR_ERR ( parent_names ) ; } for ( i = 0 ; i < PMC_CLK_NUM ; i ++ ) { data -> clks [ i ] = plt_clk_register ( pdev , i , pmc_data -> base , parent_names , data -> nparents ) ; if ( IS_ERR ( data -> clks [ i ] ) ) { err = PTR_ERR ( data -> clks [ i ] ) ; err_unreg_clk_plt } } data -> mclk_lookup = clkdev_hw_create ( & data -> clks [ 3 ] -> hw , "mclk" , NULL ) ; if ( ! data -> mclk_lookup ) { err = - ENOMEM ; err_unreg_clk_plt } plt_clk_free_parent_names_loop ( parent_names , data -> nparents ) ; platform_set_drvdata ( pdev , data ) ; return 0 ; err_unreg_clk_plt plt_clk_unregister_loop ( data , i ) ; plt_clk_unregister_parents ( data ) ; plt_clk_free_parent_names_loop ( parent_names , data -> nparents ) ; return err ; } 