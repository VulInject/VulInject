static ssize_t tpm_show_ppi_transition_action ( struct device * dev , struct device_attribute * attr , char * buf ) { u32 ret ; acpi_status status ; union acpi_object * obj = NULL ; union acpi_object tmp = { . buffer . type = ACPI_TYPE_BUFFER . buffer . length = 0 . buffer . pointer = NULL } ; struct tpm_chip * chip = to_tpm_chip ( dev ) ; static char * info [ ] { "None" "Shutdown" "Reboot" "OS Vendor-specific" "Error" } ; ; if ( strcmp ( chip -> ppi_version , "1.2" ) < 0 ) { obj = & tmp ; } obj = tpm_eval_dsm ( chip -> acpi_dev_handle , TPM_PPI_FN_GETACT , ACPI_TYPE_INTEGER , obj ) ; if ( ! obj ) { return - ENXIO ; } else { ret = obj -> integer . value ; ACPI_FREE ( obj , NULL ) ; } if ( ret < ARRAY_SIZE ( info ) - 1 ) { status = scnprintf ( buf , PAGE_SIZE , "%d: %s\n" , ret , info [ ret ] ) ; } else { status = scnprintf ( buf , PAGE_SIZE , "%d: %s\n" , ret , info [ ARRAY_SIZE ( info ) - 1 ] ) ; } return status ; } 