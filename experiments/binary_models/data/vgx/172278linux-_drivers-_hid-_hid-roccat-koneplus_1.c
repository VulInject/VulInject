static int koneplus_init_specials ( struct hid_device * hdev ) { struct usb_interface * intf = to_usb_interface ( hdev -> dev . parent ) ; struct usb_device * usb_dev = interface_to_usbdev ( intf ) ; struct koneplus_device * koneplus ; int retval ; if ( intf -> cur_altsetting -> desc . bInterfaceProtocol == USB_INTERFACE_PROTOCOL_MOUSE ) { koneplus = kmalloc ( sizeof ( * koneplus ) , GFP_KERNEL ) ; if ( ! koneplus ) { hid_err ( hdev , "can't alloc device descriptor\n" ) ; return - ENOMEM ; } hid_set_drvdata ( hdev , koneplus ) ; retval = koneplus_init_koneplus_device_struct ( usb_dev , koneplus ) ; if ( retval ) { hid_err ( hdev , "couldn't init struct koneplus_device\n" ) ; exit_free } retval = roccat_connect ( koneplus_class , hdev , sizeof ( koneplus_roccat_report ) ) ; if ( retval < 0 ) { hid_err ( hdev , "couldn't init char dev\n" ) ; } else { koneplus -> chrdev_minor = retval ; koneplus -> roccat_claimed = 1 ; } } else { hid_set_drvdata ( hdev , NULL ) ; } return 0 ; exit_free kfree ( koneplus ) ; return retval ; } 