__printf ( 2 , 3 ) int nft_request_module ( struct net * net , const char * fmt , ... ) { int module_name [ MODULE_NAME_LEN ] ; struct nftables_pernet * nft_net ; struct nft_module_request * req ; va_list args ; int ret ; va_start ( args , fmt ) ; ret = vsnprintf ( module_name , MODULE_NAME_LEN , fmt , args ) ; va_end ( args ) ; if ( ret >= MODULE_NAME_LEN ) { return 0 ; } nft_net = nft_pernet ( net ) ; list_for_each_entry ( , , ) { if ( ! strcmp ( req -> module , module_name ) ) { if ( req -> done ) { return 0 ; } return - EAGAIN ; } } req = kmalloc ( sizeof ( * req ) , GFP_KERNEL ) ; if ( ! req ) { return - ENOMEM ; } req -> done = false ; strscpy ( req -> module , module_name , MODULE_NAME_LEN ) ; list_add_tail ( & req -> list , & nft_net -> module_list ) ; return - EAGAIN ; } 