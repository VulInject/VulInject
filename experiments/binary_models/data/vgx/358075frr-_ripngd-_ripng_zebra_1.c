static void ripng_zebra_ipv6_send ( struct ripng * ripng , struct agg_node * rp , uint8_t cmd ) { struct list * list = ( list * ) rp -> info ; struct zapi_route api ; struct zapi_nexthop * api_nh ; struct listnode * listnode = NULL ; struct ripng_info * rinfo = NULL ; int count = 0 ; const struct prefix * p = agg_node_get_prefix ( rp ) ; api . vrf_id = ripng -> vrf -> vrf_id ; api . type = ZEBRA_ROUTE_RIPNG ; api . safi = SAFI_UNICAST ; api . prefix = * p ; SET_FLAG ( api . message , ZAPI_MESSAGE_NEXTHOP ) ; for ( ALL_LIST_ELEMENTS_RO ( list , listnode , rinfo ) ; ) { if ( count >= MULTIPATH_NUM ) { break ; } api_nh = & api . nexthops [ count ] ; api_nh -> vrf_id = ripng -> vrf -> vrf_id ; api_nh -> gate . ipv6 = rinfo -> nexthop ; api_nh -> ifindex = rinfo -> ifindex ; api_nh -> type = NEXTHOP_TYPE_IPV6_IFINDEX ; count ++ ; if ( cmd == ZEBRA_ROUTE_ADD ) { SET_FLAG ( rinfo -> flags , RIPNG_RTF_FIB ) ; } else { UNSET_FLAG ( rinfo -> flags , RIPNG_RTF_FIB ) ; } } api . nexthop_num = count ; rinfo = listgetdata ( listhead ( list ) ) ; SET_FLAG ( api . message , ZAPI_MESSAGE_METRIC ) ; api . metric = rinfo -> metric ; if ( rinfo -> tag ) { SET_FLAG ( api . message , ZAPI_MESSAGE_TAG ) ; api . tag = rinfo -> tag ; } zclient_route_send ( cmd , zclient , & api ) ; if ( IS_RIPNG_DEBUG_ZEBRA ) { if ( ripng -> ecmp ) { zlog_debug ( "%s: %pRN nexthops %d" , ( cmd == ZEBRA_ROUTE_ADD ) ?"Install into zebra" : "Delete from zebra" , rp , count ) ; } else { zlog_debug ( "%s: %pRN" , ( cmd == ZEBRA_ROUTE_ADD ) ?"Install into zebra" : "Delete from zebra" , rp ) ; } } } 