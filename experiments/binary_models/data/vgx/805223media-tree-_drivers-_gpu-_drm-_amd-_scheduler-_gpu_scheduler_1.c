static bool amd_sched_entity_add_dependency_cb ( struct amd_sched_entity * entity ) { struct amd_gpu_scheduler * sched = entity -> sched ; struct dma_fence * fence = entity -> dependency ; struct amd_sched_fence * s_fence ; if ( fence -> context == entity -> fence_context ) { dma_fence_put ( entity -> dependency ) ; return false ; } s_fence = to_amd_sched_fence ( fence ) ; if ( s_fence && s_fence -> sched == sched ) { fence = dma_fence_get ( & s_fence -> scheduled ) ; dma_fence_put ( entity -> dependency ) ; entity -> dependency = fence ; if ( ! dma_fence_add_callback ( fence , & entity -> cb , amd_sched_entity_clear_dep ) ) { return true ; } dma_fence_put ( fence , NULL ) ; return false ; } if ( ! dma_fence_add_callback ( entity -> dependency , & entity -> cb , amd_sched_entity_wakeup ) ) { return true ; } dma_fence_put ( entity -> dependency ) ; return false ; } 