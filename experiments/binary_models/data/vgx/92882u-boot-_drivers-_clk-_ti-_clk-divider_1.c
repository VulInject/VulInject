static ulong clk_ti_divider_set_rate ( struct clk * clk , ulong rate ) { struct clk_ti_divider_priv * priv = dev_get_priv ( clk -> dev ) ; ulong parent_rate ; int div ; u32 val , v ; div = clk_ti_divider_best_div ( clk , rate , & parent_rate ) ; if ( clk -> flags & CLK_SET_RATE_PARENT ) { parent_rate = clk_set_rate ( & priv -> parent , parent_rate ) ; if ( IS_ERR_VALUE ( parent_rate ) ) { return parent_rate ; } } val = _get_val ( priv -> table , priv -> div_flags , div ) ; v = clk_ti_readl ( & priv -> reg ) ; v &= ~ ( priv -> mask << priv -> shift ) ; v |= val << priv -> shift ; clk_ti_writel ( v , & priv -> reg ) ; clk_ti_latch ( & priv -> reg , priv -> latch ) ; return clk_get_rate ( clk ) ; } 