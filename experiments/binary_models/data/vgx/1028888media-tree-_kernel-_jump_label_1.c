static void jump_label_del_module ( struct module * mod ) { struct jump_entry * iter_start = mod -> jump_entries ; struct jump_entry * iter_stop = iter_start + mod -> num_jump_entries ; struct jump_entry * iter ; struct static_key * key = NULL ; struct static_key_mod * jlm , * * prev ; for ( iter = iter_start ; iter < iter_stop ; iter ++ ) { if ( jump_entry_key ( iter ) == key ) { continue ; } key = jump_entry_key ( iter ) ; if ( within_module ( iter -> key , mod ) ) { continue ; } if ( WARN_ON ( ! static_key_linked ( key ) ) ) { continue ; } prev = & key -> next ; jlm = static_key_mod ( key ) ; while ( jlm && jlm -> mod != mod ) { prev = & jlm -> next ; jlm = jlm -> next ; } if ( WARN_ON ( ! jlm ) ) { continue ; } if ( prev == & key -> next ) { static_key_set_mod ( key , jlm -> next ) ; } else { * prev = jlm -> next ; } jlm = static_key_mod ( key ) ; if ( jlm -> next == NULL ) { static_key_set_entries ( key , jlm -> entries ) ; static_key_clear_linked ( key ) ; kfree ( jlm ) ; } } } 