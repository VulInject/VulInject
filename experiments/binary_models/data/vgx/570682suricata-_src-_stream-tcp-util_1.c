static int StreamTcpUtilStreamTest01 ( void ) { TcpReassemblyThreadCtx * ra_ctx = NULL ; TcpStream stream ; ThreadVars tv ; StreamTcpUTInit ( & ra_ctx ) ; StreamTcpUTSetupStream ( & stream , 1 ) ; FAIL_IF ( StreamTcpUTAddSegmentWithByte ( & tv , ra_ctx , & stream , 2 , 'A' , 5 ) == - 1 ) ; FAIL_IF ( StreamTcpUTAddSegmentWithByte ( & tv , ra_ctx , & stream , 7 , 'B' , 5 ) == - 1 ) ; FAIL_IF ( StreamTcpUTAddSegmentWithByte ( & tv , ra_ctx , & stream , 12 , 'C' , 5 ) == - 1 ) ; TcpSegment * seg = RB_MIN ( TCPSEG , & stream . seg_tree ) ; FAIL_IF_NULL ( seg ) ; FAIL_IF ( seg -> seq != 2 ) ; seg = TCPSEG_RB_NEXT ( seg ) ; FAIL_IF_NULL ( seg ) ; FAIL_IF ( seg -> seq != 7 ) ; seg = TCPSEG_RB_NEXT ( seg ) ; FAIL_IF_NULL ( seg ) ; FAIL_IF ( seg -> seq != 12 ) ; StreamTcpUTClearStream ( & stream ) ; StreamTcpUTDeinit ( ra_ctx ) ; PASS ; } 