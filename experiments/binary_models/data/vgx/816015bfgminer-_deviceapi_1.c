struct work * get_and_prepare_work ( struct thr_info * thr ) { struct cgpu_info * proc = thr -> cgpu ; struct device_drv * api = proc -> drv ; struct work * work ; work = get_work ( thr ) ; if ( ! work ) { return NULL ; } if ( api -> prepare_work && ! api -> prepare_work ( thr , work ) ) { applog ( LOG_ERR , "%" PRIpreprv ": Work prepare failed, disabling!" , proc -> proc_repr ) ; proc -> deven = DEV_RECOVER_ERR ; run_cmd ( cmd_idle ) ; return NULL ; } return work ; } 