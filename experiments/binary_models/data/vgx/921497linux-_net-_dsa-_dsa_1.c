static int dsa_port_parse_of ( struct dsa_port * dp , struct device_node * dn ) { struct device_node * ethernet = of_parse_phandle ( dn , "ethernet" , 0 ) ; const char * name = of_get_property ( dn , "label" , NULL ) ; bool link = of_property_read_bool ( dn , "link" ) ; dp -> dn = dn ; if ( ethernet ) { struct net_device * master ; const char * user_protocol ; master = of_find_net_device_by_node ( ethernet ) ; of_node_put ( ethernet , NULL ) ; if ( ! master ) { return - EPROBE_DEFER ; } user_protocol = of_get_property ( dn , "dsa-tag-protocol" , NULL ) ; return dsa_port_parse_cpu ( dp , master , user_protocol ) ; } if ( link ) { return dsa_port_parse_dsa ( dp ) ; } return dsa_port_parse_user ( dp , name ) ; } 