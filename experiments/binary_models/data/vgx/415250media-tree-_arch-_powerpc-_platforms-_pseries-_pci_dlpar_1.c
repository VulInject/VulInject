struct pci_controller * init_phb_dynamic ( struct device_node * dn ) { struct pci_controller * phb ; pr_debug ( "PCI: Initializing new hotplug PHB %s\n" , dn -> full_name ) ; phb = pcibios_alloc_controller ( dn ) ; if ( ! phb ) { return NULL ; } rtas_setup_phb ( phb ) ; pci_process_bridge_OF_ranges ( phb , dn , 0 ) ; phb -> controller_ops = pseries_pci_controller_ops ; pci_devs_phb_init_dynamic ( phb ) ; eeh_dev_phb_init_dynamic ( phb ) ; if ( dn -> child ) { eeh_add_device_tree_early ( PCI_DN ( dn ) ) ; } pcibios_scan_phb ( phb ) ; pcibios_finish_adding_to_bus ( phb -> bus , NULL ) ; return phb ; } 