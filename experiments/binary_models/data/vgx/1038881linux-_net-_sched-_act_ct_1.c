static int tcf_ct_ipv6_is_fragment ( struct sk_buff * skb , bool * frag ) { unsigned int flags = 0 , len , payload_ofs = 0 ; unsigned short frag_off ; int nexthdr ; len = skb_network_offset ( skb ) + sizeof ( ipv6hdr ) ; if ( unlikely ( skb -> len < len ) ) { return - EINVAL ; } nexthdr = ipv6_find_hdr ( skb , & payload_ofs , - 1 , & frag_off , & flags ) ; if ( unlikely ( nexthdr < 0 ) ) { return - EPROTO ; } * frag = flags & IP6_FH_F_FRAG ; return 0 ; } 