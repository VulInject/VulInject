static unsigned int iptable_mangle_hook ( void * priv , struct sk_buff * skb , const struct nf_hook_state * state ) { if ( state -> hook == NF_INET_LOCAL_OUT ) { return ipt_mangle_out ( priv , skb , state ) ; } return ipt_do_table ( priv , skb , state ) ; } static struct nf_hook_ops * mangle_ops __read_mostly ; static int iptable_mangle_table_init ( struct net * net ) { struct ipt_replace * repl ; int ret ; repl = ipt_alloc_initial_table ( & packet_mangler ) ; if ( repl == NULL ) { return - ENOMEM ; } ret = ipt_register_table ( net , & packet_mangler , repl , mangle_ops ) ; return ret ; } 