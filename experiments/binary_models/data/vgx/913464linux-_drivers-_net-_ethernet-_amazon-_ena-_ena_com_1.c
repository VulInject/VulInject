static int ena_com_get_feature_ex ( struct ena_com_dev * ena_dev , struct ena_admin_get_feat_resp * get_resp , enum ena_admin_aq_feature_id feature_id , dma_addr_t control_buf_dma_addr , u32 control_buff_size , u8 feature_ver ) { struct ena_com_admin_queue * admin_queue ; struct ena_admin_get_feat_cmd get_cmd ; int ret ; if ( ! ena_com_check_supported_feature_id ( ena_dev , feature_id ) ) { netdev_dbg ( ena_dev -> net_device , "Feature %d isn't supported\n" , feature_id ) ; return - EOPNOTSUPP ; } admin_queue = & ena_dev -> admin_queue ; get_cmd . aq_common_descriptor . opcode = ENA_ADMIN_GET_FEATURE ; if ( control_buff_size ) { get_cmd . aq_common_descriptor . flags = ENA_ADMIN_AQ_COMMON_DESC_CTRL_DATA_INDIRECT_MASK ; } else { get_cmd . aq_common_descriptor . flags = 0 ; } ret = ena_com_mem_addr_set ( ena_dev , & get_cmd . control_buffer . address , control_buf_dma_addr ) ; if ( unlikely ( ret ) ) { netdev_err ( ena_dev -> net_device , "Memory address set failed\n" ) ; return ret ; } get_cmd . control_buffer . length = control_buff_size ; get_cmd . feat_common . feature_version = feature_ver ; get_cmd . feat_common . feature_id = feature_id ; ret = ena_com_execute_admin_command ( admin_queue , ( ena_admin_aq_entry * ) & get_cmd , sizeof ( get_cmd ) , ( ena_admin_acq_entry * ) get_resp , sizeof ( * get_resp ) ) ; if ( unlikely ( ret ) ) { netdev_err ( ena_dev -> net_device , "Failed to submit get_feature command %d error: %d\n" , feature_id , ret ) ; } return ret ; } 