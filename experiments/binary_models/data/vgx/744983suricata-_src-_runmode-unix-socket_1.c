static TmEcode UnixListAddFile ( PcapCommand * this , const char * filename , const char * output_dir , int tenant_id , bool continuous , bool should_delete , time_t delay , time_t poll_interval ) { PcapFiles * cfile = NULL ; if ( filename == NULL || this == NULL ) { return TM_ECODE_FAILED ; } cfile = SCMalloc ( sizeof ( PcapFiles ) ) ; if ( unlikely ( cfile == NULL ) ) { SCLogError ( "Unable to allocate new file" ) ; return TM_ECODE_FAILED ; } cfile -> filename = SCStrdup ( filename ) ; if ( unlikely ( cfile -> filename == NULL ) ) { SCFree ( cfile ) ; SCLogError ( "Unable to dup filename" ) ; return TM_ECODE_FAILED ; } if ( output_dir ) { cfile -> output_dir = SCStrdup ( output_dir ) ; if ( unlikely ( cfile -> output_dir == NULL ) ) { SCFree ( cfile -> filename ) ; SCFree ( cfile ) ; SCLogError ( "Unable to dup output_dir" ) ; return TM_ECODE_FAILED ; } } cfile -> tenant_id = tenant_id ; cfile -> continuous = continuous ; cfile -> should_delete = should_delete ; cfile -> delay = delay ; cfile -> poll_interval = poll_interval ; TAILQ_INSERT_TAIL ( & this -> files , cfile , next ) ; return TM_ECODE_OK ; } 