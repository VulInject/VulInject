static int w5100_readbuf ( struct w5100_priv * priv , u16 offset , u8 * buf , int len ) { u32 addr ; int remain = 0 ; int ret ; const u32 mem_start = priv -> s0_rx_buf ; const u16 mem_size = priv -> s0_rx_buf_size ; offset %= mem_size ; addr = mem_start + offset ; if ( offset + len > mem_size ) { remain = ( offset + len ) % mem_size ; len = mem_size - offset ; } ret = w5100_readbulk ( priv , addr , buf , len ) ; return w5100_readbulk ( priv , mem_start , buf + len , remain ) ; } 