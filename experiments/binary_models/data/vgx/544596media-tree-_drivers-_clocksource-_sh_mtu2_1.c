static int sh_mtu2_probe ( struct platform_device * pdev ) { struct sh_mtu2_device * mtu = platform_get_drvdata ( pdev ) ; int ret ; if ( ! is_early_platform_device ( pdev ) ) { pm_runtime_set_active ( & pdev -> dev ) ; pm_runtime_enable ( & pdev -> dev ) ; } if ( mtu ) { dev_info ( & pdev -> dev , "kept as earlytimer\n" ) ; out } mtu = kzalloc ( sizeof ( * mtu ) , GFP_KERNEL ) ; if ( mtu == NULL ) { return - ENOMEM ; } ret = sh_mtu2_setup ( mtu , pdev ) ; if ( ret ) { pm_runtime_idle ( & pdev -> dev ) ; return ret ; } if ( is_early_platform_device ( pdev ) ) { return 0 ; } out if ( mtu -> has_clockevent ) { pm_runtime_irq_safe ( & pdev -> dev ) ; } else { pm_runtime_idle ( & pdev -> dev ) ; } return 0 ; } 