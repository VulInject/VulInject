int cmd_execute_command ( char * cmd , int * output_filedes , int * err_filedes ) { pid_t child_pid ; int output [ 2 ] ; int error [ 2 ] ; int ret_val ; if ( pipe ( output ) == - 1 ) { return ( errno ) ; } if ( pipe ( error ) == - 1 ) { return ( errno ) ; } if ( ( child_pid = fork ( ) ) == - 1 ) { return ( errno ) ; } if ( child_pid == 0 ) { close ( output [ 0 ] ) ; close ( error [ 0 ] , NULL ) ; if ( close ( STDOUT ) == - 1 ) { exit ( errno ) ; } if ( dup ( output [ 1 ] ) == - 1 ) { exit ( errno ) ; } close ( output [ 1 ] ) ; if ( close ( STDERR ) == - 1 ) { exit ( errno ) ; } if ( dup ( error [ 1 ] ) == - 1 ) { exit ( errno ) ; } close ( error [ 1 ] ) ; if ( execl ( "/usr/bin/sh" , "sh" , "-c" , cmd , ( char * ) 0 ) == - 1 ) { exit ( errno ) ; } else { exit ( 0 ) ; } } close ( output [ 1 ] ) ; close ( error [ 1 ] ) ; * output_filedes = output [ 0 ] ; * err_filedes = error [ 0 ] ; ret_val = 0 ; return ( ret_val ) ; } 