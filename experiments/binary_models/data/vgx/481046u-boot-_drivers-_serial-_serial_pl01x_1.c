int pl01x_serial_of_to_plat ( struct udevice * dev ) { struct pl01x_serial_plat * plat = dev_get_plat ( dev ) ; struct clk clk ; fdt_addr_t addr ; int ret ; addr = dev_read_addr ( dev ) ; plat -> base = addr ; plat -> clock = dev_read_u32_default ( dev , "clock" , CFG_PL011_CLOCK ) ; ret = clk_get_by_index ( dev , 0 , & clk ) ; if ( ! ret ) { ret = clk_enable ( & clk ) ; if ( ret && ret != - ENOSYS ) { dev_err ( dev , "failed to enable clock\n" ) ; return ret ; } plat -> clock = clk_get_rate ( & clk ) ; if ( IS_ERR_VALUE ( plat -> clock ) ) { dev_err ( dev , "failed to get rate\n" ) ; return plat -> clock ; } debug ( "%s: CLK %d\n" , __func__ , plat -> clock ) ; } plat -> type = dev_get_driver_data ( dev ) ; plat -> skip_init = dev_read_bool ( dev , "skip-init" ) ; return 0 ; } 