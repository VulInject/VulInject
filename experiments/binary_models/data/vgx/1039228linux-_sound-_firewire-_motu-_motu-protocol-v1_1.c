static int get_clock_source_828 ( struct snd_motu * motu , enum snd_motu_clock_source * src ) { __be32 reg ; u32 data ; int err ; err = snd_motu_transaction_read ( motu , CLK_828_STATUS_OFFSET , & reg , sizeof ( reg ) ) ; data = be32_to_cpu ( reg ) & CLK_828_STATUS_MASK ; switch ( data & CLK_828_STATUS_MASK_SRC ) { case CLK_828_STATUS_FLAG_SRC_ADAT_ON_OPT : * src = SND_MOTU_CLOCK_SOURCE_ADAT_ON_OPT ; break ; case CLK_828_STATUS_FLAG_SRC_SPH : * src = SND_MOTU_CLOCK_SOURCE_SPH ; break ; case CLK_828_STATUS_FLAG_SRC_SPDIF : { if ( data & CLK_828_STATUS_FLAG_OPT_IN_IFACE_IS_SPDIF ) { * src = SND_MOTU_CLOCK_SOURCE_SPDIF_ON_COAX ; } else { * src = SND_MOTU_CLOCK_SOURCE_SPDIF_ON_OPT ; } break ; } case CLK_828_STATUS_FLAG_SRC_ADAT_ON_DSUB : * src = SND_MOTU_CLOCK_SOURCE_ADAT_ON_DSUB ; break ; case CLK_828_STATUS_FLAG_SRC_INTERNAL : * src = SND_MOTU_CLOCK_SOURCE_INTERNAL ; break ; default : return - ENXIO ; } return 0 ; } 