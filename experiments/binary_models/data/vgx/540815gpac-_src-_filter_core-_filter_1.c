void gf_filter_update_arg_task ( GF_FSTask * task ) { GF_FilterUpdate * arg = task -> udta ; Bool found = gf_filter_update_arg_apply ( task -> filter , arg -> name , arg -> val , GF_FALSE ) ; if ( ! found ) { if ( arg -> recursive ) { u32 i ; GF_LOG ( GF_LOG_DEBUG , GF_LOG_FILTER , ( "Failed to locate argument %s in filter %s, propagating %s the filter chain\n" , arg -> name , task -> filter -> freg -> name , ( arg -> recursive & ( GF_FILTER_UPDATE_UPSTREAM | GF_FILTER_UPDATE_DOWNSTREAM ) ) ?"up and down" : ( ( arg -> recursive & GF_FILTER_UPDATE_UPSTREAM ) ?"up" : "down" ) ) ) ; GF_List * flist = gf_list_new ( ) ; if ( arg -> recursive & GF_FILTER_UPDATE_UPSTREAM ) { gf_mx_p ( task -> filter -> tasks_mx ) ; for ( i = 0 ; i < task -> filter -> num_output_pids ; i ++ ) { u32 j ; GF_FilterPid * pid = gf_list_get ( task -> filter -> output_pids , i ) ; for ( j = 0 ; j < pid -> num_destinations ; j ++ ) { GF_FilterPidInst * pidi = gf_list_get ( pid -> destinations , j ) ; if ( gf_list_find ( flist , pidi -> filter ) < 0 ) { gf_list_add ( flist , pidi -> filter ) ; } } } for ( i = 0 ; i < gf_list_count ( flist ) ; i ++ ) { GF_Filter * a_f = gf_list_get ( flist , i ) ; gf_fs_send_update ( task -> filter -> session , a_f , arg -> name , arg -> val , GF_FILTER_UPDATE_UPSTREAM ) ; } gf_list_reset ( flist ) ; gf_mx_v ( task -> filter -> tasks_mx ) ; } if ( arg -> recursive & GF_FILTER_UPDATE_DOWNSTREAM ) { gf_mx_p ( task -> filter -> tasks_mx ) ; for ( i = 0 ; i < task -> filter -> num_input_pids ; i ++ ) { GF_FilterPidInst * pidi = gf_list_get ( task -> filter -> input_pids , i ) ; if ( gf_list_find ( flist , pidi -> pid -> filter ) < 0 ) { gf_list_add ( flist , pidi -> pid -> filter ) ; } } for ( i = 0 ; i < gf_list_count ( flist ) ; i ++ ) { GF_Filter * a_f = gf_list_get ( flist , i ) ; gf_fs_send_update ( task -> filter -> session , NULL , a_f , arg -> name , arg -> val , GF_FILTER_UPDATE_DOWNSTREAM ) ; } gf_mx_v ( task -> filter -> tasks_mx ) ; } gf_list_del ( flist ) ; } else { GF_LOG ( GF_LOG_WARNING , GF_LOG_FILTER , ( "Failed to locate argument %s in filter %s\n" , arg -> name , task -> filter -> freg -> name ) ) ; } } gf_free ( arg -> name ) ; gf_free ( arg -> val ) ; gf_free ( arg ) ; } 