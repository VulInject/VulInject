isc_result_t set_nameserver ( char * opt ) { isc_result_t result ; struct sockaddr_storage sockaddrs [ DIG_MAX_ADDRESSES ] ; int count , i ; dig_server_t * srv ; char tmp [ NI_MAXHOST ] ; result = get_addresses ( opt , 0 , sockaddrs , DIG_MAX_ADDRESSES , & count ) ; if ( result != ISC_R_SUCCESS ) { return ( result ) ; } flush_server_list ( ) ; for ( i = 0 ; i < count ; i ++ ) { int error ; error = getnameinfo ( ( sockaddr * ) & sockaddrs [ i ] , sockaddrs [ i ] . ss_len , tmp , sizeof ( tmp ) , NULL , 0 , NI_NUMERICHOST | NI_NUMERICSERV ) ; if ( error ) { fatal ( "%s" , gai_strerror ( error ) ) ; } srv = make_server ( tmp , opt ) ; if ( srv == NULL ) { fatal ( "memory allocation failure" ) ; } ISC_LIST_APPEND ( server_list , srv , link ) ; } return ( ISC_R_SUCCESS ) ; } 