void execlog ( char * format , ... ) { va_list ap ; int fd = open_logfile ( "exec" ) ; int buf [ BUFSIZ ] ; EXEC * ep ; static int nodate = 0 ; va_start ( ap , format ) ; if ( fd >= 0 ) { if ( ! nodate ) { time_t now = time ( ( time_t * ) 0 ) ; fdprintf ( fd , "%24.24s: " , ctime ( & now ) ) ; } nodate = 0 ; if ( ! STREQU ( format , "%e" ) ) { vsnprintf ( buf , sizeof ( buf ) , format , ap ) ; write ( fd , buf , strlen ( buf ) ) ; if ( format [ strlen ( format ) - 1 ] != '\n' ) { nodate = 1 ; } } else { switch ( ( ep = va_arg ( ap , EXEC * ) ) -> type ) { case EX_INTERF : fdprintf ( fd , "      EX_INTERF %s %s\n" , ep -> ex . printer -> printer -> name , ep -> ex . printer -> request -> secure -> req_id ) ; break ; case EX_SLOWF : fdprintf ( fd , "      EX_SLOWF %s\n" , ep -> ex . request -> secure -> req_id ) ; break ; case EX_ALERT : fdprintf ( fd , "      EX_ALERT %s\n" , ep -> ex . printer -> printer -> name ) ; break ; case EX_FAULT_MESSAGE : fdprintf ( fd , "      EX_FAULT_MESSAGE %s\n" , ep -> ex . printer -> printer -> name ) ; break ; case EX_FORM_MESSAGE : fdprintf ( fd , "      EX_FORM_MESSAGE %s\n" , ep -> ex . form -> form -> name ) ; break ; case EX_FALERT : fdprintf ( fd , "      EX_FALERT %s\n" , ep -> ex . form -> form -> name ) ; break ; case EX_PALERT : fdprintf ( fd , "      EX_PALERT %s\n" , ep -> ex . pwheel -> pwheel -> name ) ; break ; case EX_NOTIFY : fdprintf ( fd , "      EX_NOTIFY %s\n" , ep -> ex . request -> secure -> req_id ) ; break ; default : fdprintf ( fd , "      EX_???\n" ) ; break ; } } close ( fd ) ; } } 