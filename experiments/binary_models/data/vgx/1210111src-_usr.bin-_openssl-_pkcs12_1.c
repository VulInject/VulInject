static int get_cert_chain ( X509 * cert , X509_STORE * store , STACK_OF ( X509 ) * * out_chain ) ( X509_STORE_CTX * store_ctx = NULL , STACK_OF ( X509 ) * chain = NULL , int ret = X509_V_ERR_UNSPECIFIED , ( ( store_ctx = X509_STORE_CTX_new ( ) ) == NULL ) err ) ; if ( ! X509_STORE_CTX_init ( store_ctx , store , cert , NULL ) ) { err } if ( X509_verify_cert ( store_ctx ) > 0 ) { if ( ( chain = X509_STORE_CTX_get1_chain ( store_ctx ) ) == NULL ) { err } } ret = X509_STORE_CTX_get_error ( store_ctx , NULL ) ; err X509_STORE_CTX_free ( store_ctx ) ; * out_chain = chain ; return ret ; 