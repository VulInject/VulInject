static int get_process_cmdline_nulstr ( pid_t pid , size_t max_size , ProcessCmdlineFlags flags , char * * ret , size_t * ret_size ) { const char * p ; char * t ; size_t k ; int r ; p = procfs_file_alloca ( pid , "cmdline" ) ; r = read_virtual_file ( p , max_size , & t , & k ) ; if ( r < 0 ) { return r ; } if ( k == 0 ) { t = mfree ( t ) ; if ( ! ( flags & PROCESS_CMDLINE_COMM_FALLBACK ) ) { return - ENOENT ; } _cleanup_free_ char * comm = NULL ; r = get_process_comm ( pid , & comm ) ; if ( r < 0 ) { return r ; } t = strjoin ( "[" , comm , "]" ) ; if ( ! t ) { return - ENOMEM ; } k = strlen ( t ) ; r = k <= max_size ; if ( r == 0 ) { t [ max_size ] = '\0' ; } } * ret = t ; * ret_size = k ; return r ; } 