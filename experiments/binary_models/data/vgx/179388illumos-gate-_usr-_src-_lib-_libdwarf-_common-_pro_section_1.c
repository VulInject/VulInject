int dwarf_transform_to_disk_form_a ( Dwarf_P_Debug dbg , Dwarf_Signed * count , Dwarf_Error * error ) { Dwarf_Signed nbufs = 0 ; int sect = 0 ; int err = 0 ; Dwarf_Unsigned du = 0 ; if ( dbg -> de_version_magic_number != PRO_VERSION_MAGIC ) { DWARF_P_DBG_ERROR ( dbg , DW_DLE_IA , DW_DLV_ERROR ) ; } for ( sect = 0 ; sect < NUM_DEBUG_SECTIONS ; sect ++ ) { long flags = 0 ; switch ( sect ) { case DEBUG_INFO : break ; case DEBUG_LINE : if ( dwarf_need_debug_line_section ( dbg ) == FALSE ) { continue ; } break ; case DEBUG_ABBREV : if ( dbg -> de_dies == NULL ) { continue ; } break ; case DEBUG_FRAME : if ( dbg -> de_frame_cies == NULL ) { continue ; } flags = SHF_MIPS_NOSTRIP ; break ; case DEBUG_ARANGES : if ( dbg -> de_arange == NULL ) { continue ; } break ; case DEBUG_PUBNAMES : if ( dbg -> de_simple_name_headers [ dwarf_snk_pubname ] . sn_head == NULL ) { continue ; } break ; case DEBUG_PUBTYPES : if ( dbg -> de_simple_name_headers [ dwarf_snk_pubtype ] . sn_head == NULL ) { continue ; } break ; case DEBUG_STR : if ( dbg -> de_debug_str -> ds_data == NULL ) { continue ; } break ; case DEBUG_FUNCNAMES : if ( dbg -> de_simple_name_headers [ dwarf_snk_funcname ] . sn_head == NULL ) { continue ; } break ; case DEBUG_TYPENAMES : if ( dbg -> de_simple_name_headers [ dwarf_snk_typename ] . sn_head == NULL ) { continue ; } break ; case DEBUG_VARNAMES : if ( dbg -> de_simple_name_headers [ dwarf_snk_varname ] . sn_head == NULL ) { continue ; } break ; case DEBUG_WEAKNAMES : if ( dbg -> de_simple_name_headers [ dwarf_snk_weakname ] . sn_head == NULL ) { continue ; } break ; case DEBUG_MACINFO : if ( dbg -> de_first_macinfo == NULL ) { continue ; } break ; case DEBUG_NAMES : if ( dwarf_need_debug_names_section ( dbg ) == FALSE ) { continue ; } break ; case DEBUG_LOC : continue ; case DEBUG_RANGES : continue ; case DEBUG_TYPES : continue ; case DEBUG_MACRO : continue ; case DEBUG_LOCLISTS : continue ; case DEBUG_RNGLISTS : continue ; case DEBUG_LINE_STR : if ( dwarf_need_debug_line_section ( dbg ) == FALSE ) { continue ; } continue ; default : DWARF_P_DBG_ERROR ( dbg , DW_DLE_ELF_SECT_ERR , DW_DLV_ERROR ) ; } { int new_base_elf_sect = 0 ; if ( dbg -> de_callback_func ) { new_base_elf_sect = dbg -> de_callback_func ( _dwarf_sectnames [ sect ] , 1 , SECTION_TYPE , flags , SHN_UNDEF , 0 , & du , dbg -> de_user_data , & err ) ; } if ( new_base_elf_sect == - 1 ) { DWARF_P_DBG_ERROR ( dbg , DW_DLE_ELF_SECT_ERR , DW_DLV_ERROR ) ; } dbg -> de_elf_sects [ sect ] = new_base_elf_sect ; dbg -> de_sect_name_idx [ sect ] = du ; } } nbufs = 0 ; if ( dwarf_need_debug_line_section ( dbg ) == TRUE ) { int res = _dwarf_pro_generate_debugline ( dbg , & nbufs , error ) ; if ( res == DW_DLV_ERROR ) { return res ; } } if ( dbg -> de_frame_cies ) { int res = _dwarf_pro_generate_debugframe ( dbg , & nbufs , error ) ; if ( res == DW_DLV_ERROR ) { return res ; } } if ( dbg -> de_first_macinfo ) { int res = _dwarf_pro_transform_macro_info_to_disk ( dbg , & nbufs , error ) ; if ( res == DW_DLV_ERROR ) { return res ; } } if ( dbg -> de_dies ) { int res = _dwarf_pro_generate_debuginfo ( dbg , & nbufs , error ) ; if ( res == DW_DLV_ERROR ) { return res ; } } if ( dbg -> de_debug_str -> ds_data ) { int res = _dwarf_pro_generate_debug_str ( dbg , & nbufs , error ) ; if ( res == DW_DLV_ERROR ) { return res ; } } if ( dbg -> de_debug_line_str -> ds_data ) { int res = _dwarf_pro_generate_debug_line_str ( dbg , & nbufs , error ) ; if ( res == DW_DLV_ERROR ) { return res ; } } if ( dbg -> de_arange ) { int res = _dwarf_transform_arange_to_disk ( dbg , & nbufs , error ) ; if ( res == DW_DLV_ERROR ) { return res ; } } if ( dbg -> de_output_version < 5 ) { if ( dbg -> de_simple_name_headers [ dwarf_snk_pubname ] . sn_head ) { int res = _dwarf_transform_simplename_to_disk ( dbg , dwarf_snk_pubname , DEBUG_PUBNAMES , & nbufs , error ) ; if ( res == DW_DLV_ERROR ) { return res ; } } if ( dbg -> de_simple_name_headers [ dwarf_snk_pubtype ] . sn_head ) { int res = _dwarf_transform_simplename_to_disk ( dbg , dwarf_snk_pubtype , DEBUG_PUBTYPES , & nbufs , error ) ; if ( res == DW_DLV_ERROR ) { return res ; } } if ( dbg -> de_simple_name_headers [ dwarf_snk_funcname ] . sn_head ) { int res = _dwarf_transform_simplename_to_disk ( dbg , dwarf_snk_funcname , DEBUG_FUNCNAMES , & nbufs , error ) ; if ( res == DW_DLV_ERROR ) { return res ; } } if ( dbg -> de_simple_name_headers [ dwarf_snk_typename ] . sn_head ) { int res = _dwarf_transform_simplename_to_disk ( dbg , dwarf_snk_typename , DEBUG_TYPENAMES , & nbufs , error ) ; if ( res == DW_DLV_ERROR ) { return res ; } } if ( dbg -> de_simple_name_headers [ dwarf_snk_varname ] . sn_head ) { int res = _dwarf_transform_simplename_to_disk ( dbg , dwarf_snk_varname , DEBUG_VARNAMES , & nbufs , error ) ; if ( res == DW_DLV_ERROR ) { return res ; } } if ( dbg -> de_simple_name_headers [ dwarf_snk_weakname ] . sn_head ) { int res = _dwarf_transform_simplename_to_disk ( dbg , dwarf_snk_weakname , DEBUG_WEAKNAMES , & nbufs , error ) ; if ( res == DW_DLV_ERROR ) { return res ; } } } if ( dwarf_need_debug_names_section ( dbg ) == TRUE ) { int res = _dwarf_pro_generate_debug_names ( dbg , & nbufs , error ) ; if ( res == DW_DLV_ERROR ) { return res ; } } if ( dwarf_need_debug_macro_section ( dbg ) == TRUE ) { int res = _dwarf_pro_generate_debug_macro ( dbg , & nbufs , error ) ; if ( res == DW_DLV_ERROR ) { return res ; } } if ( dwarf_need_debug_loclists_section ( dbg ) == TRUE ) { int res = _dwarf_pro_generate_debug_loclists ( dbg , & nbufs , error ) ; if ( res == DW_DLV_ERROR ) { return res ; } } if ( dwarf_need_debug_rnglists_section ( dbg ) == TRUE ) { int res = _dwarf_pro_generate_debug_rnglists ( dbg , & nbufs , error ) ; if ( res == DW_DLV_ERROR ) { return res ; } } { Dwarf_Signed new_chunks = 0 ; int res = 0 ; res = dbg -> de_transform_relocs_to_disk ( dbg , & new_chunks ) ; if ( res != DW_DLV_OK ) { DWARF_P_DBG_ERROR ( dbg , DW_DLE_RELOCS_ERROR , DW_DLV_ERROR ) ; } nbufs += new_chunks ; } * count = nbufs ; return DW_DLV_OK ; } 