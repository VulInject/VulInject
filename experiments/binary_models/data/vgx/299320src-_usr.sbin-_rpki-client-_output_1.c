static FILE * output_createtmp ( char * ) static void output_cleantmp ( void ) static int output_finish ( FILE * ) static void sig_handler ( int ) static void set_signal_handler ( void ) int outputfiles ( struct vrp_tree * v , struct brk_tree * b , struct vap_tree * a , struct stats * st ) { int i , rc = 0 ; atexit ( output_cleantmp ) ; set_signal_handler ( ) ; for ( i = 0 ; outputs [ i ] . name ; i ++ ) { FILE * fout ; if ( ! ( outformats & outputs [ i ] . format ) ) { continue ; } fout = output_createtmp ( outputs [ i ] . name ) ; if ( fout == NULL ) { warn ( "cannot create %s" , outputs [ i ] . name ) ; rc = 1 ; continue ; } if ( ( * outputs [ i ] . fn ) ( fout , v , b , a , st ) != 0 ) { warn ( "output for %s format failed" , outputs [ i ] . name ) ; fclose ( fout , NULL ) ; output_cleantmp ( ) ; rc = 1 ; continue ; } if ( output_finish ( fout ) != 0 ) { warn ( "finish for %s format failed" , outputs [ i ] . name ) ; output_cleantmp ( ) ; rc = 1 ; continue ; } } return rc ; } 