static int event_file_open ( struct inode * inode , struct file * file ) { struct ibmasmfs_event_data * event_data ; struct service_processor * sp ; sp = inode -> i_private ; event_data = kmalloc ( sizeof ( ibmasmfs_event_data ) , GFP_KERNEL ) ; if ( ! event_data ) { return - ENOMEM ; } ibmasm_event_reader_register ( sp , & event_data -> reader ) ; event_data -> sp = sp ; event_data -> active = 0 ; file -> private_data = event_data ; return 0 ; } 