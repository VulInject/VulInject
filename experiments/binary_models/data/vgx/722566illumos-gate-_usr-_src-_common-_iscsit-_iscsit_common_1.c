int it_nv_to_tgtlist ( nvlist_t * nvl , uint32_t * count , it_tgt_t * * tgtlist ) { int ret = 0 ; it_tgt_t * tgt ; it_tgt_t * prev = NULL ; nvpair_t * nvp = NULL ; nvlist_t * nvt ; char * name ; * tgtlist = NULL ; * count = 0 ; if ( ! nvl ) { return ( 0 ) ; } while ( ( nvp = nvlist_next_nvpair ( nvl , nvp ) ) != NULL ) { name = nvpair_name ( nvp ) ; ret = nvpair_value_nvlist ( nvp , & nvt ) ; if ( ret != 0 ) { continue ; } ret = it_nv_to_tgt ( nvt , name , & tgt ) ; if ( ret != 0 ) { break ; } ( * count ) ++ ; if ( * tgtlist == NULL ) { * tgtlist = tgt ; } else { prev -> tgt_next = tgt ; } prev = tgt ; } if ( ret != 0 ) { it_tgt_free_cmn ( * tgtlist ) ; * tgtlist = NULL ; } return ( ret ) ; } 