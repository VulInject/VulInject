static unsigned find_free_label ( struct net * net ) { struct mpls_route __rcu * * platform_label ; size_t platform_labels ; unsigned index ; platform_label = rtnl_dereference ( net -> mpls . platform_label , NULL ) ; platform_labels = net -> mpls . platform_labels ; for ( index = MPLS_LABEL_FIRST_UNRESERVED ; index < platform_labels ; index ++ ) { if ( ! rtnl_dereference ( platform_label [ index ] ) ) { return index ; } } return LABEL_NOT_SPECIFIED ; } 