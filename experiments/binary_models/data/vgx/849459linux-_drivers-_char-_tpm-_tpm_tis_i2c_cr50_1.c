static int tpm_cr50_i2c_get_burst_and_status ( struct tpm_chip * chip , u8 mask , size_t * burst , u32 * status ) { unsigned long stop ; u8 buf [ 4 ] ; * status = 0 ; stop = jiffies + chip -> timeout_b ; { if ( tpm_cr50_i2c_read ( chip , TPM_I2C_STS ( 0 ) , buf , sizeof ( buf ) ) < 0 ) { msleep ( TPM_CR50_TIMEOUT_SHORT_MS ) ; continue ; } * status = * buf ; * burst = le16_to_cpup ( ( __le16 * ) ( buf + 1 ) ) ; msleep ( TPM_CR50_TIMEOUT_SHORT_MS ) ; } time_before ( jiffies , stop ) ; dev_err ( & chip -> dev , "Timeout reading burst and status\n" ) ; return - ETIMEDOUT ; } 