static void hdmi_pin_setup_infoframe ( struct hda_codec * codec , hda_nid_t pin_nid , int ca , int active_channels , int conn_type ) { union audio_infoframe ai ; if ( conn_type == 0 ) { struct hdmi_audio_infoframe * hdmi_ai = & ai . hdmi ; hdmi_ai -> type = 0x84 ; hdmi_ai -> ver = 0x01 ; hdmi_ai -> len = 0x0a ; hdmi_ai -> CC02_CT47 = active_channels - 1 ; hdmi_ai -> CA = ca ; hdmi_checksum_audio_infoframe ( hdmi_ai ) ; } if ( conn_type == 1 ) { struct dp_audio_infoframe * dp_ai = & ai . dp ; dp_ai -> type = 0x84 ; dp_ai -> len = 0x1b ; dp_ai -> ver = 0x11 << 2 ; dp_ai -> CC02_CT47 = active_channels - 1 ; dp_ai -> CA = ca ; } else { codec_dbg ( codec , "HDMI: unknown connection type at pin %d\n" , pin_nid ) ; return ; } if ( ! hdmi_infoframe_uptodate ( codec , pin_nid , ai . bytes , sizeof ( ai ) ) ) { codec_dbg ( codec , "hdmi_pin_setup_infoframe: pin=%d channels=%d ca=0x%02x\n" , pin_nid , active_channels , ca ) ; hdmi_stop_infoframe_trans ( codec , pin_nid ) ; hdmi_fill_audio_infoframe ( codec , pin_nid , ai . bytes , sizeof ( ai ) ) ; hdmi_start_infoframe_trans ( codec , pin_nid ) ; } } 