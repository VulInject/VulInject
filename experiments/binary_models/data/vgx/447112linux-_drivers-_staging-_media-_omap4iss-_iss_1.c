static int iss_pipeline_disable ( struct iss_pipeline * pipe , struct media_entity * until ) { struct iss_device * iss = pipe -> output -> iss ; struct media_entity * entity ; struct media_pad * pad ; struct v4l2_subdev * subdev ; int failure ; int ret ; entity = & pipe -> output -> video . entity ; while ( 1 ) { pad = & entity -> pads [ 0 ] ; if ( ! ( pad -> flags & MEDIA_PAD_FL_SINK ) ) { break ; } pad = media_pad_remote_pad_first ( pad ) ; if ( ! pad || ! is_media_entity_v4l2_subdev ( pad -> entity ) ) { break ; } entity = pad -> entity ; if ( entity == until ) { break ; } subdev = media_entity_to_v4l2_subdev ( entity ) ; ret = v4l2_subdev_call ( subdev , video , s_stream , 0 ) ; if ( ret < 0 ) { dev_warn ( iss -> dev , "%s: module stop timeout.\n" , subdev -> name ) ; media_entity_enum_set ( & iss -> crashed , & subdev -> entity ) ; failure = - ETIMEDOUT ; } } return failure ; } 