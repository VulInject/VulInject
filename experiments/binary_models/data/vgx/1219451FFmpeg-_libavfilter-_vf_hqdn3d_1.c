static int config_input ( AVFilterLink * inlink ) { AVFilterContext * ctx = inlink -> dst ; HQDN3DContext * s = inlink -> dst -> priv ; const AVPixFmtDescriptor * desc = av_pix_fmt_desc_get ( inlink -> format ) ; int i , depth ; uninit ( inlink -> dst ) ; s -> hsub = desc -> log2_chroma_w ; s -> vsub = desc -> log2_chroma_h ; s -> depth = depth = desc -> comp [ 0 ] . depth ; for ( i = 0 ; i < 3 ; i ++ ) { s -> line [ i ] = av_malloc_array ( inlink -> w , sizeof ( * s -> line [ i ] ) ) ; } for ( i = 0 ; i < 4 ; i ++ ) { s -> coefs [ i ] = av_malloc ( ( 512 << LUT_BITS ) * sizeof ( int16_t ) ) ; if ( ! s -> coefs [ i ] ) { return AVERROR ( ENOMEM ) ; } } calc_coefs ( ctx ) ; ff_hqdn3d_init_x86 ( s ) ; return 0 ; } ThreadData { AVFrame * in * out ; int direct ; } ThreadData 