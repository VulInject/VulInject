static ssize_t iwl_dbgfs_channels_read ( struct file * file , char __user * user_buf , size_t count , loff_t * ppos ) { struct iwl_priv * priv = file -> private_data ; struct ieee80211_channel * channels = NULL ; const struct ieee80211_supported_band * supp_band = NULL ; int pos = 0 , i , bufsz = PAGE_SIZE ; char * buf ; ssize_t ret ; buf = kzalloc ( bufsz , GFP_KERNEL ) ; supp_band = iwl_get_hw_mode ( priv , NL80211_BAND_2GHZ ) ; if ( supp_band ) { channels = supp_band -> channels ; pos += scnprintf ( buf + pos , bufsz - pos , "Displaying %d channels in 2.4GHz band 802.11bg):\n" , supp_band -> n_channels ) ; for ( i = 0 ; i < supp_band -> n_channels ; i ++ ) { pos += scnprintf ( buf + pos , bufsz - pos , "%d: %ddBm: BSS%s%s, %s.\n" , channels [ i ] . hw_value , channels [ i ] . max_power , channels [ i ] . flags & IEEE80211_CHAN_RADAR ?" (IEEE 802.11h required)" : "" , ( ( channels [ i ] . flags & IEEE80211_CHAN_NO_IR ) || ( channels [ i ] . flags & IEEE80211_CHAN_RADAR ) ) ?"" : ", IBSS" , channels [ i ] . flags & IEEE80211_CHAN_NO_IR ?"passive only" : "active/passive" ) ; } } supp_band = iwl_get_hw_mode ( priv , NL80211_BAND_5GHZ ) ; if ( supp_band ) { channels = supp_band -> channels ; pos += scnprintf ( buf + pos , bufsz - pos , "Displaying %d channels in 5.2GHz band (802.11a)\n" , supp_band -> n_channels ) ; for ( i = 0 ; i < supp_band -> n_channels ; i ++ ) { pos += scnprintf ( buf + pos , bufsz - pos , "%d: %ddBm: BSS%s%s, %s.\n" , channels [ i ] . hw_value , channels [ i ] . max_power , channels [ i ] . flags & IEEE80211_CHAN_RADAR ?" (IEEE 802.11h required)" : "" , ( ( channels [ i ] . flags & IEEE80211_CHAN_NO_IR ) || ( channels [ i ] . flags & IEEE80211_CHAN_RADAR ) ) ?"" : ", IBSS" , channels [ i ] . flags & IEEE80211_CHAN_NO_IR ?"passive only" : "active/passive" ) ; } } ret = simple_read_from_buffer ( user_buf , count , ppos , buf , pos ) ; kfree ( buf ) ; return ret ; } 