static gboolean exif_reader ( RAWFILE * rawfile , guint offset , RSMetadata * meta ) { gushort number_of_entries = 0 ; struct IFD ifd ; offset += 2 ; while ( number_of_entries -- ) { read_ifd ( rawfile , offset , & ifd ) ; offset += 12 ; switch ( ifd . tag ) { case 0x010f : if ( ! meta -> make_ascii ) { meta -> make_ascii = rs_remove_tailing_spaces ( raw_strdup ( rawfile , ifd . offset , ifd . count ) , TRUE ) ; } break ; case 0x0110 : if ( ! meta -> model_ascii ) { meta -> model_ascii = rs_remove_tailing_spaces ( raw_strdup ( rawfile , ifd . offset , ifd . count ) , TRUE ) ; } break ; case 0x9003 : case 0x9004 : if ( ! meta -> time_ascii ) { meta -> time_ascii = raw_strdup ( rawfile , ifd . value_offset , ifd . count ) ; meta -> timestamp = rs_exiftime_to_unixtime ( meta -> time_ascii ) ; } break ; case 0x829A : if ( ifd . count == 1 && ifd . value_rational < EXPO_TIME_MAXVAL ) { meta -> shutterspeed = 1.0 / ifd . value_rational ; } break ; case 0x829D : if ( ifd . count == 1 ) { meta -> aperture = ifd . value_rational ; } break ; case 0x8827 : if ( ifd . count == 1 ) { meta -> iso = ifd . value_ushort ; } break ; case 0x920A : meta -> focallength = ifd . value_rational ; break ; case 0x9204 : if ( ifd . count == 1 ) { meta -> exposurebias = ifd . value_srational ; } break ; case 0x927c : switch ( meta -> make ) { case MAKE_CANON : makernote_canon ( rawfile , ifd . value_offset , meta ) ; break ; case MAKE_MINOLTA : makernote_minolta ( rawfile , ifd . value_offset , meta ) ; break ; case MAKE_NIKON : makernote_nikon ( rawfile , ifd . value_offset , meta ) ; break ; case MAKE_PENTAX : makernote_pentax ( rawfile , ifd . value_offset , meta ) ; break ; case MAKE_OLYMPUS : if ( raw_strcmp ( rawfile , ifd . value_offset , "OLYMPUS" , 7 ) ) { makernote_olympus ( rawfile , ifd . value_offset , ifd . value_offset + 12 , meta ) ; } if ( raw_strcmp ( rawfile , ifd . value_offset , "OLYMP" , 5 ) ) { makernote_olympus ( rawfile , ifd . value_offset + 8 , ifd . value_offset + 8 , meta ) ; } break ; case MAKE_SAMSUNG : makernote_samsung ( rawfile , ifd . value_offset , meta ) ; break ; case MAKE_SONY : makernote_sony ( rawfile , ifd . value_offset , meta ) ; break ; case MAKE_LEICA : case MAKE_PANASONIC : if ( raw_strcmp ( rawfile , ifd . value_offset , "Panasonic" , 9 ) || raw_strcmp ( rawfile , ifd . value_offset , "LEICA" , 5 ) ) { makernote_panasonic ( rawfile , ifd . value_offset + 12 , meta ) ; } break ; default : break ; } break ; } } return TRUE ; } 