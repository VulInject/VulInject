static int __i915_ggtt_pin ( struct i915_vma * vma , struct i915_gem_ww_ctx * ww , u32 align , unsigned int flags ) { struct i915_address_space * vm = vma -> vm ; struct intel_gt * gt ; struct i915_ggtt * ggtt = i915_vm_to_ggtt ( vm ) ; int err ; { err = i915_vma_pin_ww ( vma , ww , 0 , align , flags | PIN_GLOBAL ) ; if ( err != - ENOSPC ) { if ( ! err ) { err = i915_vma_wait_for_bind ( vma ) ; if ( err ) { i915_vma_unpin ( vma ) ; } } return err ; } list_for_each_entry ( , , ) flush_idle_contexts ( gt ) ; if ( mutex_lock_interruptible ( & vm -> mutex ) == 0 ) { i915_gem_evict_vm ( vm , NULL ) ; mutex_unlock ( & vm -> mutex ) ; } } 1 ; } 