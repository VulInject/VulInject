int mbedtls_x509write_csr_set_key_usage ( mbedtls_x509write_csr * ctx , unsigned char key_usage ) { unsigned char buf [ 4 ] ; unsigned char * c ; int ret = MBEDTLS_ERR_ERROR_CORRUPTION_DETECTED ; c = buf + 4 ; ret = mbedtls_asn1_write_named_bitstring ( & c , buf , & key_usage , 8 ) ; ret = mbedtls_x509write_csr_set_extension ( ctx , MBEDTLS_OID_KEY_USAGE , MBEDTLS_OID_SIZE ( MBEDTLS_OID_KEY_USAGE ) , c , ( size_t ) ret ) ; if ( ret != 0 ) { return ( ret ) ; } return ( 0 ) ; } 