static __le32 vfio_generate_bar_flags ( struct pci_dev * pdev , int bar ) { cfs_time_t flags = pci_resource_flags ( pdev , bar ) ; u32 val ; if ( flags & IORESOURCE_IO ) { return cpu_to_le32 ( PCI_BASE_ADDRESS_SPACE_IO ) ; } val = PCI_BASE_ADDRESS_SPACE_MEMORY ; if ( flags & IORESOURCE_PREFETCH ) { val |= PCI_BASE_ADDRESS_MEM_PREFETCH ; } if ( flags & IORESOURCE_MEM_64 ) { val |= PCI_BASE_ADDRESS_MEM_TYPE_64 ; } return cpu_to_le32 ( val ) ; } 