int _lstFreeItem ( HLSTITEM hItem ) { HLST hLst ; HLSTITEM hItemRoot ; HLSTITEM hNewCurrent = NULL ; if ( ! hItem ) { return LST_ERROR ; } hLst = ( HLST ) hItem -> hLst ; if ( hLst -> hLstBase ) { hItemRoot = ( HLSTITEM ) hItem -> pData ; hItemRoot -> nRefs -- ; if ( hItemRoot -> nRefs < 1 && hItemRoot -> bDelete ) { _lstFreeItem ( hItemRoot ) ; } } if ( hItem -> pData && hLst -> pFree ) { hLst -> pFree ( hItem -> pData ) ; } if ( ! hItem -> bDelete ) { hLst -> nItems -- ; } if ( hItem == hLst -> hFirst ) { hLst -> hFirst = hItem -> pNext ; } if ( hItem == hLst -> hLast ) { hLst -> hLast = hItem -> pPrev ; } if ( hItem -> pPrev ) { hItem -> pPrev -> pNext = hItem -> pNext ; if ( hItem == hLst -> hCurrent ) { hNewCurrent = hItem -> pPrev ; } } if ( hItem -> pNext ) { hItem -> pNext -> pPrev = hItem -> pPrev ; if ( ! hNewCurrent && hItem == hLst -> hCurrent ) { hNewCurrent = hItem -> pNext ; } } hLst -> hCurrent = hNewCurrent ; _lstAdjustCurrent ( hLst ) ; return LST_SUCCESS ; } 