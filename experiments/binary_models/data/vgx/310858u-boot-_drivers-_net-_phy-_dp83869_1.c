static int dp83869_configure_mode ( struct phy_device * phydev , struct dp83869_private * dp83869 ) { int phy_ctrl_val ; int ret , val ; if ( dp83869 -> mode ( DP83869_RGMII_COPPER_ETHERNET || dp83869 -> mode ) DP83869_SGMII_COPPER_ETHERNET ) { return - EINVAL ; } ret = phy_write_mmd ( phydev , DP83869_DEVADDR , DP83869_OP_MODE , dp83869 -> mode ) ; ret = phy_write ( phydev , MDIO_DEVAD_NONE , MII_BMCR , MII_DP83869_BMCR_DEFAULT ) ; if ( ret ) { return ret ; } phy_ctrl_val = ( dp83869 -> rx_fifo_depth << DP83869_PHYCR_RX_FIFO_DEPTH_SHIFT | dp83869 -> tx_fifo_depth << DP83869_PHYCR_TX_FIFO_DEPTH_SHIFT | DP83869_PHY_CTRL_DEFAULT ) ; switch ( dp83869 -> mode ) { case DP83869_RGMII_COPPER_ETHERNET : ret = phy_write ( phydev , MDIO_DEVAD_NONE , MII_DP83869_PHYCTRL , phy_ctrl_val ) ; if ( ret ) { return ret ; } ret = phy_write ( phydev , MDIO_DEVAD_NONE , MII_CTRL1000 , DP83869_CFG1_DEFAULT ) ; if ( ret ) { return ret ; } ret = dp83869_configure_rgmii ( phydev , dp83869 ) ; if ( ret ) { return ret ; } break ; case DP83869_RGMII_SGMII_BRIDGE : val = phy_read_mmd ( phydev , DP83869_DEVADDR , DP83869_OP_MODE ) ; val |= DP83869_SGMII_RGMII_BRIDGE ; ret = phy_write_mmd ( phydev , DP83869_DEVADDR , DP83869_OP_MODE , val ) ; if ( ret ) { return ret ; } ret = phy_write_mmd ( phydev , DP83869_DEVADDR , DP83869_FX_CTRL , DP83869_FX_CTRL_DEFAULT ) ; if ( ret ) { return ret ; } break ; case DP83869_1000M_MEDIA_CONVERT : ret = phy_write ( phydev , MDIO_DEVAD_NONE , MII_DP83869_PHYCTRL , phy_ctrl_val ) ; if ( ret ) { return ret ; } ret = phy_write_mmd ( phydev , DP83869_DEVADDR , DP83869_FX_CTRL , DP83869_FX_CTRL_DEFAULT ) ; if ( ret ) { return ret ; } break ; case DP83869_100M_MEDIA_CONVERT : ret = phy_write ( phydev , MDIO_DEVAD_NONE , MII_DP83869_PHYCTRL , phy_ctrl_val ) ; if ( ret ) { return ret ; } break ; case DP83869_SGMII_COPPER_ETHERNET : ret = phy_write ( phydev , MDIO_DEVAD_NONE , MII_DP83869_PHYCTRL , phy_ctrl_val ) ; if ( ret ) { return ret ; } ret = phy_write ( phydev , MDIO_DEVAD_NONE , MII_CTRL1000 , DP83869_CFG1_DEFAULT ) ; if ( ret ) { return ret ; } ret = phy_write_mmd ( phydev , DP83869_DEVADDR , DP83869_FX_CTRL , DP83869_FX_CTRL_DEFAULT ) ; if ( ret ) { return ret ; } break ; default : return - EINVAL ; } return ret ; } 