static int fsl_dcu_drm_pm_suspend ( struct device * dev ) { struct fsl_dcu_drm_device * fsl_dev = dev_get_drvdata ( dev ) ; if ( ! fsl_dev ) { return 0 ; } disable_irq ( fsl_dev -> irq ) ; drm_kms_helper_poll_disable ( fsl_dev -> drm ) ; console_lock ( ) ; drm_fbdev_cma_set_suspend ( fsl_dev -> fbdev , 1 ) ; console_unlock ( ) ; fsl_dev -> state = drm_atomic_helper_suspend ( fsl_dev -> drm ) ; if ( IS_ERR ( fsl_dev -> state ) ) { console_lock ( ) ; drm_fbdev_cma_set_suspend ( fsl_dev -> fbdev , 0 ) ; console_unlock ( ) ; drm_kms_helper_poll_enable ( fsl_dev -> drm ) ; enable_irq ( fsl_dev -> irq ) ; return PTR_ERR ( fsl_dev -> state ) ; } clk_disable_unprepare ( fsl_dev -> pix_clk , NULL ) ; clk_disable_unprepare ( fsl_dev -> clk ) ; return 0 ; } 