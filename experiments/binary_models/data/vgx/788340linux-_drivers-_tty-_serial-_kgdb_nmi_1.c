static int kgdb_nmi_tty_install ( struct tty_driver * drv , struct tty_struct * tty ) { struct kgdb_nmi_tty_priv * priv ; int ret ; priv = kzalloc ( sizeof ( * priv ) , GFP_KERNEL ) ; if ( ! priv ) { return - ENOMEM ; } INIT_KFIFO ( priv -> fifo ) ; timer_setup ( & priv -> timer , kgdb_nmi_tty_receiver , 0 ) ; tty_port_init ( & priv -> port ) ; priv -> port . ops = & kgdb_nmi_tty_port_ops ; tty -> driver_data = priv ; ret = tty_port_install ( & priv -> port , drv , tty ) ; if ( ret ) { pr_err ( "%s: can't install tty port: %d\n" , __func__ , ret ) ; err } return 0 ; err tty_port_destroy ( & priv -> port ) ; return ret ; } 