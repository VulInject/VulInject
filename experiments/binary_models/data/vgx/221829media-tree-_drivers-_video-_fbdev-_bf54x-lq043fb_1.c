static int bfin_bf54x_fb_open ( struct fb_info * info , int user ) { struct bfin_bf54xfb_info * fbi = info -> par ; spin_lock ( & fbi -> lock ) ; fbi -> lq043_open_cnt ++ ; if ( fbi -> lq043_open_cnt <= 1 ) { bfin_write_EPPI0_CONTROL ( 0 ) ; SSYNC ( ) ; config_dma ( fbi , NULL ) ; config_ppi ( fbi ) ; enable_dma ( CH_EPPI0 ) ; bfin_write_EPPI0_CONTROL ( bfin_read_EPPI0_CONTROL ( ) | EPPI_EN ) ; } spin_unlock ( & fbi -> lock ) ; return 0 ; } 