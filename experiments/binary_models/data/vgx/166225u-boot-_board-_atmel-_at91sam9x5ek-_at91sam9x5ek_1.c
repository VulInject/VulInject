static void at91sam9x5ek_nand_hw_init ( void ) { struct at91_smc * smc = ( at91_smc * ) ATMEL_BASE_SMC ; struct at91_matrix * matrix = ( at91_matrix * ) ATMEL_BASE_MATRIX ; unsigned long csa ; csa = readl ( & matrix -> ebicsa ) ; csa |= AT91_MATRIX_EBI_CS3A_SMC_SMARTMEDIA ; csa |= AT91_MATRIX_NFD0_ON_D16 ; csa &= ~ AT91_MATRIX_EBI_EBI_IOSR_NORMAL ; writel ( csa , & matrix -> ebicsa ) ; writel ( AT91_SMC_SETUP_NWE ( 1 ) | AT91_SMC_SETUP_NCS_WR ( 0 ) | AT91_SMC_SETUP_NRD ( 1 ) | AT91_SMC_SETUP_NCS_RD ( 0 ) , & smc -> cs [ 3 ] . setup ) ; writel ( AT91_SMC_PULSE_NWE ( 3 ) | AT91_SMC_PULSE_NCS_WR ( 5 ) | AT91_SMC_PULSE_NRD ( 4 ) | AT91_SMC_PULSE_NCS_RD ( 6 ) , & smc -> cs [ 3 ] . pulse ) ; writel ( AT91_SMC_CYCLE_NWE ( 5 ) | AT91_SMC_CYCLE_NRD ( 6 ) , & smc -> cs [ 3 ] . cycle ) ; writel ( AT91_SMC_MODE_RM_NRD | AT91_SMC_MODE_WM_NWE | AT91_SMC_MODE_EXNW_DISABLE | AT91_SMC_MODE_DBW_16 | AT91_SMC_MODE_DBW_8 | AT91_SMC_MODE_TDF_CYCLE ( 1 ) , & smc -> cs [ 3 ] . mode ) ; at91_periph_clk_enable ( ATMEL_ID_PIOCD , NULL ) ; at91_set_gpio_input ( CFG_SYS_NAND_READY_PIN , 1 ) ; at91_set_gpio_output ( CFG_SYS_NAND_ENABLE_PIN , 1 ) ; at91_pio3_set_a_periph ( AT91_PIO_PORTD , 0 , 1 ) ; at91_pio3_set_a_periph ( AT91_PIO_PORTD , 1 , 1 ) ; at91_pio3_set_a_periph ( AT91_PIO_PORTD , 2 , 1 ) ; at91_pio3_set_a_periph ( AT91_PIO_PORTD , 3 , 1 ) ; at91_pio3_set_a_periph ( AT91_PIO_PORTD , 6 , 1 ) ; at91_pio3_set_a_periph ( AT91_PIO_PORTD , 7 , 1 ) ; at91_pio3_set_a_periph ( AT91_PIO_PORTD , 8 , 1 ) ; at91_pio3_set_a_periph ( AT91_PIO_PORTD , 9 , 1 ) ; at91_pio3_set_a_periph ( AT91_PIO_PORTD , 10 , 1 ) ; at91_pio3_set_a_periph ( AT91_PIO_PORTD , 11 , 1 ) ; at91_pio3_set_a_periph ( AT91_PIO_PORTD , 12 , 1 ) ; at91_pio3_set_a_periph ( AT91_PIO_PORTD , 13 , 1 ) ; } 