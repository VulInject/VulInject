static int drm_gem_map_attach ( struct dma_buf * dma_buf , struct device * target_dev , struct dma_buf_attachment * attach ) { struct drm_prime_attachment * prime_attach ; struct drm_gem_object * obj = dma_buf -> priv ; struct drm_device * dev = obj -> dev ; prime_attach = kzalloc ( sizeof ( * prime_attach ) , GFP_KERNEL ) ; prime_attach -> dir = DMA_NONE ; attach -> priv = prime_attach ; if ( ! dev -> driver -> gem_prime_pin ) { return 0 ; } return dev -> driver -> gem_prime_pin ( obj ) ; } 