static void test_chunked_at_once ( int line , int consume_trailer , const char * encoded , const char * decoded , ssize_t expected ) { struct phr_chunked_decoder dec = { 0 } ; char * buf ; size_t bufsz ; ssize_t ret ; dec . consume_trailer = consume_trailer ; note ( "testing at-once, source at line %d" , line ) ; buf = strdup ( encoded ) ; bufsz = strlen ( buf ) ; ret = phr_decode_chunked ( & dec , buf , & bufsz ) ; ok ( ret == expected ) ; ok ( bufsz == strlen ( decoded ) ) ; ok ( bufis ( buf , bufsz , decoded ) ) ; if ( expected >= 0 ) { if ( ret == expected ) { ok ( bufis ( buf + bufsz , ret , encoded + strlen ( encoded ) - ret ) ) ; } else { ok ( 0 ) ; } } } 