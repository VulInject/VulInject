paddr_t gfxp_mmap ( void * v , off_t off , int prot ) { struct gfxp_softc * sc = v ; if ( off & PGOFSET ) { return ( - 1 ) ; } switch ( sc -> sc_mode ) { case WSDISPLAYIO_MODE_MAPPED : if ( sc -> sc_mmiosize == 0 ) { return ( - 1 ) ; } if ( off >= sc -> sc_membase_be && off < ( sc -> sc_membase_be + sc -> sc_memsize_be ) ) { return ( bus_space_mmap ( sc -> sc_memt , sc -> sc_membase_be , off - sc -> sc_membase_be , prot , BUS_SPACE_MAP_LINEAR ) ) ; } if ( off >= sc -> sc_mmiobase && off < ( sc -> sc_mmiobase + sc -> sc_mmiosize ) ) { return ( bus_space_mmap ( sc -> sc_mmiot , sc -> sc_mmiobase , off - sc -> sc_mmiobase , prot , BUS_SPACE_MAP_LINEAR ) ) ; } break ; case WSDISPLAYIO_MODE_DUMBFB : if ( off >= 0 && off < sc -> sc_memsize_le ) { return ( bus_space_mmap ( sc -> sc_memt , sc -> sc_membase_le , off , prot , BUS_SPACE_MAP_LINEAR ) ) ; } break ; } return ( - 1 ) ; } 