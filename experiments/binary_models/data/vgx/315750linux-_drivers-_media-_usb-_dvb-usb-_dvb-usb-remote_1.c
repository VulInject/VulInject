static void legacy_dvb_usb_read_remote_control ( struct work_struct * work ) { struct dvb_usb_device * d = container_of ( work , dvb_usb_device , rc_query_work . work ) ; u32 event ; int state ; if ( dvb_usb_disable_rc_polling ) { return ; } if ( d -> props . rc . legacy . rc_query ( d , & event , & state ) ) { err ( "error while querying for an remote control event." ) ; schedule } switch ( state ) { case REMOTE_NO_KEY_PRESSED : break ; case REMOTE_KEY_PRESSED : deb_rc ( "key pressed\n" ) ; d -> last_event = event ; input_event ( d -> input_dev , EV_KEY , event , 1 ) ; input_sync ( d -> input_dev , NULL ) ; input_event ( d -> input_dev , EV_KEY , d -> last_event , 0 ) ; input_sync ( d -> input_dev ) ; break ; case REMOTE_KEY_REPEAT : deb_rc ( "key repeated\n" ) ; input_event ( d -> input_dev , EV_KEY , event , 1 ) ; input_sync ( d -> input_dev ) ; input_event ( d -> input_dev , EV_KEY , d -> last_event , 0 ) ; input_sync ( d -> input_dev ) ; break ; default : break ; } schedule schedule_delayed_work ( & d -> rc_query_work , msecs_to_jiffies ( d -> props . rc . legacy . rc_interval ) ) ; } 