static void ath10k_pci_rx_post_pipe ( struct ath10k_pci_pipe * pipe ) { struct ath10k * ar = pipe -> hif_ce_state ; struct ath10k_pci * ar_pci = ath10k_pci_priv ( ar ) ; struct ath10k_ce_pipe * ce_pipe = pipe -> ce_hdl ; int ret , num ; if ( ! ce_pipe -> dest_ring ) { return ; } spin_lock_bh ( & ar_pci -> ce_lock ) ; num = __ath10k_ce_rx_num_free_bufs ( ce_pipe ) ; spin_unlock_bh ( & ar_pci -> ce_lock ) ; while ( num >= 0 ) { ret = __ath10k_pci_rx_post_buf ( pipe ) ; if ( ret ) { if ( ret == - ENOSPC ) { break ; } ath10k_warn ( ar , "failed to post pci rx buf: %d\n" , ret ) ; mod_timer ( & ar_pci -> rx_post_retry , jiffies + ATH10K_PCI_RX_POST_RETRY_MS ) ; break ; } num -- ; } } 