static int __switchdev_handle_port_obj_del ( struct net_device * dev , struct switchdev_notifier_port_obj_info * port_obj_info , bool * check_cb ( const struct net_device * dev ) , bool * foreign_dev_check_cb ( const struct net_device * dev , const struct net_device * foreign_dev ) , int * del_cb ( struct net_device * dev , const void * ctx , const struct switchdev_obj * obj ) ) { struct switchdev_notifier_info * info = & port_obj_info -> info ; struct net_device * br , * lower_dev , * switchdev ; struct list_head * iter ; int err = - EOPNOTSUPP ; if ( check_cb ( dev ) ) { err = del_cb ( dev , info -> ctx , port_obj_info -> obj ) ; if ( err != - EOPNOTSUPP ) { port_obj_info -> handled = true ; } return err ; } netdev_for_each_lower_dev ( , , ) { if ( netif_is_bridge_master ( lower_dev ) ) { continue ; } if ( foreign_dev_check_cb && ! check_cb ( lower_dev ) && ! switchdev_lower_dev_find ( lower_dev , check_cb , foreign_dev_check_cb ) ) { continue ; } err = __switchdev_handle_port_obj_del ( lower_dev , port_obj_info , check_cb , foreign_dev_check_cb , del_cb ) ; if ( err && err != - EOPNOTSUPP ) { return err ; } } if ( ! foreign_dev_check_cb ) { return err ; } br = netdev_master_upper_dev_get ( dev ) ; switchdev = switchdev_lower_dev_find ( br , check_cb , foreign_dev_check_cb ) ; if ( ! switchdev ) { return err ; } if ( ! foreign_dev_check_cb ( switchdev , dev ) ) { return err ; } return __switchdev_handle_port_obj_del ( br , port_obj_info , check_cb , foreign_dev_check_cb , del_cb ) ; } 