int SigAddressPrepareStage4 ( DetectEngineCtx * de_ctx ) { SCEnter ( ) ; uint32_t cnt = 0 ; for ( uint32_t idx = 0 ; idx < de_ctx -> sgh_array_cnt ; idx ++ ) { SigGroupHead * sgh = de_ctx -> sgh_array [ idx ] ; SCLogDebug ( "sgh %p" , sgh ) ; SigGroupHeadSetFilemagicFlag ( de_ctx , sgh ) ; SigGroupHeadSetFileHashFlag ( de_ctx , sgh ) ; SigGroupHeadSetFilesizeFlag ( de_ctx , sgh ) ; SigGroupHeadSetFilestoreCount ( de_ctx , sgh ) ; SCLogDebug ( "filestore count %u" , sgh -> filestore_cnt ) ; PrefilterSetupRuleGroup ( de_ctx , sgh ) ; SigGroupHeadBuildNonPrefilterArray ( de_ctx , sgh ) ; sgh -> id = idx ; cnt ++ ; } SCLogPerf ( "Unique rule groups: %u" , cnt ) ; MpmStoreReportStats ( de_ctx ) ; if ( de_ctx -> decoder_event_sgh != NULL ) { } int dump_grouping = 0 ; ( void ) ConfGetBool ( "detect.profiling.grouping.dump-to-disk" , & dump_grouping ) ; if ( dump_grouping ) { int add_rules = 0 ; ( void ) ConfGetBool ( "detect.profiling.grouping.include-rules" , & add_rules ) ; int add_mpm_stats = 0 ; ( void ) ConfGetBool ( "detect.profiling.grouping.include-mpm-stats" , & add_mpm_stats ) ; RulesDumpGrouping ( de_ctx , add_rules , add_mpm_stats ) ; } for ( uint32_t idx = 0 ; idx < de_ctx -> sgh_array_cnt ; idx ++ ) { SigGroupHead * sgh = de_ctx -> sgh_array [ idx ] ; if ( sgh == NULL ) { continue ; } SigGroupHeadInitDataFree ( sgh -> init ) ; sgh -> init = NULL ; } SigGroupHeadHashFree ( de_ctx ) ; SCProfilingSghInitCounters ( de_ctx ) ; SCReturnInt ( 0 ) ; } 