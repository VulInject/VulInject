static int camif_clk_get ( struct camif_dev * camif ) { int ret , i ; for ( i = 1 ; i < CLK_MAX_NUM ; i ++ ) { camif -> clock [ i ] = ERR_PTR ( - EINVAL ) ; } for ( i = 0 ; i < CLK_MAX_NUM ; i ++ ) { camif -> clock [ i ] = clk_get ( camif -> dev , camif_clocks [ i ] ) ; if ( IS_ERR ( camif -> clock [ i ] ) ) { ret = PTR_ERR ( camif -> clock [ i ] ) ; err } ret = clk_prepare ( camif -> clock [ i ] ) ; if ( ret < 0 ) { clk_put ( camif -> clock [ i ] , NULL ) ; camif -> clock [ i ] = NULL ; err } } return 0 ; err camif_clk_put ( camif ) ; dev_err ( camif -> dev , "failed to get clock: %s\n" , camif_clocks [ i ] ) ; return ret ; } 