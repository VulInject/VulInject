static CK_RV key_mgr_get_private_key_type ( CK_BYTE * keydata , CK_ULONG keylen , CK_KEY_TYPE * keytype ) { CK_BYTE * alg = NULL ; CK_BYTE * priv_key ; CK_ULONG alg_len ; CK_RV rc ; rc = ber_decode_PrivateKeyInfo ( keydata , keylen , & alg , & alg_len , & priv_key ) ; if ( rc != CKR_OK ) { return ( rc ) ; } if ( alg_len >= ber_rsaEncryptionLen ) { if ( memcmp ( alg , ber_rsaEncryption , ber_rsaEncryptionLen ) == 0 ) { * keytype = CKK_RSA ; return ( CKR_OK ) ; } } return ( CKR_TEMPLATE_INCOMPLETE ) ; } 