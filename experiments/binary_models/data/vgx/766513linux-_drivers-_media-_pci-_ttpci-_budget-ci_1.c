static int philips_su1278_tt_tuner_set_params ( struct dvb_frontend * fe ) { struct dtv_frontend_properties * p = & fe -> dtv_property_cache ; struct budget_ci * budget_ci = ( budget_ci * ) fe -> dvb -> priv ; u32 div ; u8 buf [ 4 ] ; struct i2c_msg msg = { . addr = 0x60 . flags = 0 . buf = buf . len = ( buf ) } ; div = ( p -> frequency + ( 500 - 1 ) ) / 500 ; buf [ 0 ] = ( div >> 8 ) & 0x7f ; buf [ 1 ] = div & 0xff ; buf [ 2 ] = 0x80 | ( ( div & 0x18000 ) >> 10 ) | 2 ; buf [ 3 ] = 0x20 ; if ( p -> symbol_rate < 4000000 ) { buf [ 3 ] |= 1 ; } if ( p -> frequency < 1250000 ) { buf [ 3 ] |= 0 ; } if ( p -> frequency < 1550000 ) { buf [ 3 ] |= 0x40 ; } if ( p -> frequency < 2050000 ) { buf [ 3 ] |= 0x80 ; } if ( p -> frequency < 2150000 ) { buf [ 3 ] |= 0xC0 ; } if ( fe -> ops . i2c_gate_ctrl ) { fe -> ops . i2c_gate_ctrl ( fe , 1 ) ; } if ( i2c_transfer ( & budget_ci -> budget . i2c_adap , & msg , 1 ) != 1 ) { return - EIO ; } return 0 ; } 