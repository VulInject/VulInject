static int twl4030_pwmled_enable ( struct pwm_chip * chip , struct pwm_device * pwm ) { struct twl_pwmled_chip * twl = to_twl ( chip ) ; int ret ; u8 val ; ret = twl_i2c_read_u8 ( TWL4030_MODULE_LED , & val , TWL4030_LEDEN_REG ) ; if ( ret < 0 ) { dev_err ( chip -> dev , "%s: Failed to read LEDEN\n" , pwm -> label ) ; out } val |= TWL4030_LED_TOGGLE ( pwm -> hwpwm , TWL4030_LED_PINS ) ; ret = twl_i2c_write_u8 ( TWL4030_MODULE_LED , val , TWL4030_LEDEN_REG ) ; if ( ret < 0 ) { dev_err ( chip -> dev , "%s: Failed to enable PWM\n" , pwm -> label ) ; } out mutex_unlock ( & twl -> mutex ) ; return ret ; } 