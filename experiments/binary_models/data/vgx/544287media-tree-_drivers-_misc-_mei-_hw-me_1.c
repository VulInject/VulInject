static int mei_me_pg_legacy_enter_sync ( struct mei_device * dev ) { struct mei_me_hw * hw = to_me_hw ( dev ) ; unsigned long timeout = mei_secs_to_jiffies ( MEI_PGI_TIMEOUT ) ; int ret ; dev -> pg_event = MEI_PG_EVENT_WAIT ; ret = mei_hbm_pg ( dev , MEI_PG_ISOLATION_ENTRY_REQ_CMD ) ; if ( ret ) { return ret ; } mutex_unlock ( & dev -> device_lock ) ; wait_event_timeout ( dev -> wait_pg , dev -> pg_event == MEI_PG_EVENT_RECEIVED , timeout ) ; mutex_lock ( & dev -> device_lock ) ; if ( dev -> pg_event == MEI_PG_EVENT_RECEIVED ) { mei_me_pg_set ( dev , NULL ) ; ret = 0 ; } else { ret = - ETIME ; } dev -> pg_event = MEI_PG_EVENT_IDLE ; hw -> pg_state = MEI_PG_ON ; return ret ; } 