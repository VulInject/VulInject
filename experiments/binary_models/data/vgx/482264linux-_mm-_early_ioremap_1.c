void __init early_iounmap ( void __iomem * addr , unsigned long size ) { unsigned long virt_addr ; unsigned long offset ; unsigned int nrpages ; enum fixed_addresses idx ; int i , slot ; slot = - 1 ; for ( i = 0 ; i < FIX_BTMAPS_SLOTS ; i ++ ) { if ( prev_map [ i ] == addr ) { slot = i ; break ; } } if ( WARN ( slot < 0 , "%s(%p, %08lx) not found slot\n" , __func__ , addr , size ) ) { return ; } if ( WARN ( prev_size [ slot ] != size , "%s(%p, %08lx) [%d] size not consistent %08lx\n" , __func__ , addr , size , slot , prev_size [ slot ] ) ) { return ; } WARN ( early_ioremap_debug , "%s(%p, %08lx) [%d]\n" , __func__ , addr , size , slot ) ; virt_addr = ( unsigned long ) addr ; offset = offset_in_page ( virt_addr ) ; nrpages = PAGE_ALIGN ( offset + size ) >> PAGE_SHIFT ; idx = FIX_BTMAP_BEGIN - NR_FIX_BTMAPS * slot ; while ( nrpages > 0 ) { if ( after_paging_init ) { __late_clear_fixmap ( idx ) ; } else { __early_set_fixmap ( idx , 0 , FIXMAP_PAGE_CLEAR ) ; } -- idx ; -- nrpages ; } prev_map [ slot ] = NULL ; } 