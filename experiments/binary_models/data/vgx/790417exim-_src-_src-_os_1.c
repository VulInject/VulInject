for ( struct ifaddrs * ifa ifalist ; ; ifa ; ifa = ifa -> ifa_next ) { struct sockaddr * ifa_addr = ifa -> ifa_addr ; if ( ifa_addr -> sa_family != AF_INET && ifa_addr -> sa_family != AF_INET6 ) { continue ; } if ( ! ( ifa -> ifa_flags & IFF_UP ) ) { continue ; } next = store_get ( sizeof ( ip_address_item ) , GET_UNTAINTED ) ; next -> next = NULL ; next -> port = 0 ; ( void ) host_ntoa ( - 1 , ifa_addr , next -> address , NULL ) ; if ( ! yield ) { yield = last = next ; } else { last -> next = next ; last = next ; } DEBUG ( ) debug_printf ( "Actual local interface address is %s (%s)\n" , last -> address , ifa -> ifa_name ) ; } freeifaddrs ( ifalist ) ; return yield ; 