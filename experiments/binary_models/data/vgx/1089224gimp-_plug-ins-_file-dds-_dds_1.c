dds_save ( , , , , , , , ) { GimpProcedureConfig * config ; GimpPDBStatusType status = GIMP_PDB_SUCCESS ; GimpExportReturn export = GIMP_EXPORT_CANCEL ; GError * error = NULL ; gdouble gamma ; gegl_init ( NULL , NULL ) ; config = gimp_procedure_create_config ( procedure ) ; gimp_procedure_config_begin_run ( config , NULL , run_mode , args ) ; switch ( run_mode ) { case GIMP_RUN_INTERACTIVE : case GIMP_RUN_WITH_LAST_VALS : gimp_ui_init ( "dds" ) ; export = gimp_export_image ( & image , & n_drawables , & drawables , "DDS" , GIMP_EXPORT_CAN_HANDLE_RGB | GIMP_EXPORT_CAN_HANDLE_GRAY | GIMP_EXPORT_CAN_HANDLE_INDEXED | GIMP_EXPORT_CAN_HANDLE_ALPHA | GIMP_EXPORT_CAN_HANDLE_LAYERS ) ; if ( export == GIMP_EXPORT_CANCEL ) { return gimp_procedure_new_return_values ( procedure , GIMP_PDB_CANCEL , NULL ) ; } break ; default : break ; } g_object_get ( config , "gamma" , & gamma , NULL ) ; if ( gamma < 1e-04f ) { g_object_set ( config , "gamma" , 2.2 , NULL ) ; } status = write_dds ( file , image , drawables [ 0 ] , run_mode == GIMP_RUN_INTERACTIVE , procedure , G_OBJECT ( config ) , export == GIMP_EXPORT_EXPORT ) ; if ( export == GIMP_EXPORT_EXPORT ) { gimp_image_delete ( image ) ; } gimp_procedure_config_end_run ( config , status ) ; g_object_unref ( config ) ; return gimp_procedure_new_return_values ( procedure , status , error ) ; } 