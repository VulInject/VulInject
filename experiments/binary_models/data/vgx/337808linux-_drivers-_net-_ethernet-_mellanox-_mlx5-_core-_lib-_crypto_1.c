static int mlx5_crypto_create_dek_bulk ( struct mlx5_core_dev * mdev , u32 key_purpose , int log_obj_range , u32 * obj_id ) { u32 in [ MLX5_ST_SZ_DW ( create_encryption_key_in ) ] { } ; ; u32 out [ MLX5_ST_SZ_DW ( general_obj_out_cmd_hdr ) ] ; void * obj , * param ; int err ; MLX5_SET ( general_obj_in_cmd_hdr , in , opcode , MLX5_CMD_OP_CREATE_GENERAL_OBJECT ) ; MLX5_SET ( general_obj_in_cmd_hdr , in , obj_type , MLX5_GENERAL_OBJECT_TYPES_ENCRYPTION_KEY ) ; param = MLX5_ADDR_OF ( general_obj_in_cmd_hdr , in , op_param ) ; MLX5_SET ( general_obj_create_param , param , log_obj_range , log_obj_range ) ; obj = MLX5_ADDR_OF ( create_encryption_key_in , in , encryption_key_object ) ; MLX5_SET ( encryption_key_obj , obj , key_purpose , key_purpose ) ; MLX5_SET ( encryption_key_obj , obj , pd , mdev -> mlx5e_res . hw_objs . pdn ) ; err = mlx5_cmd_exec ( mdev , in , sizeof ( in ) , out , sizeof ( out ) ) ; * obj_id = MLX5_GET ( general_obj_out_cmd_hdr , out , obj_id ) ; mlx5_core_dbg ( mdev , "DEK objects created, bulk=%d, obj_id=%d\n" , 1 << log_obj_range , * obj_id ) ; return 0 ; } 