static int cxl_parse_cxims ( union acpi_subtable_headers * header , void * arg , const unsigned long end ) { struct acpi_cedt_cxims * cxims = ( acpi_cedt_cxims * ) header ; struct cxl_cxims_context * ctx = arg ; struct cxl_root_decoder * cxlrd = ctx -> cxlrd ; struct cxl_decoder * cxld = & cxlrd -> cxlsd . cxld ; struct device * dev = ctx -> dev ; struct cxl_cxims_data * cximsd ; unsigned int hbig , nr_maps ; int rc ; rc = eig_to_granularity ( cxims -> hbig , & hbig ) ; if ( rc ) { return rc ; } if ( hbig != cxld -> interleave_granularity ) { return 0 ; } if ( is_power_of_2 ( cxld -> interleave_ways ) ) { nr_maps = ilog2 ( cxld -> interleave_ways ) ; } else { nr_maps = ilog2 ( cxld -> interleave_ways / 3 ) ; } if ( cxims -> nr_xormaps < nr_maps ) { dev_dbg ( dev , "CXIMS nr_xormaps[%d] expected[%d]\n" , cxims -> nr_xormaps , nr_maps ) ; return - ENXIO ; } cximsd = devm_kzalloc ( dev , struct_size ( cximsd , xormaps , nr_maps ) , GFP_KERNEL ) ; memcpy ( cximsd -> xormaps , cxims -> xormap_list , nr_maps * sizeof ( * cximsd -> xormaps ) ) ; cximsd -> nr_maps = nr_maps ; cxlrd -> platform_data = cximsd ; return 0 ; } 