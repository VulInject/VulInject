static int read_key ( struct signer * ctx , const char * key_name ) { FILE * f = fopen ( key_name , "r" ) ; if ( ! f ) { fprintf ( stderr , "Can not get key file '%s'\n" , key_name ) ; return - ENOENT ; } ctx -> evp_key = PEM_read_PrivateKey ( f , NULL , NULL , NULL ) ; fclose ( f ) ; if ( ! ctx -> evp_key ) { fprintf ( stderr , "Can not read key from '%s'\n" , key_name ) ; return - EIO ; } if ( EVP_PKEY_id ( ctx -> evp_key ) != EVP_PKEY_EC ) { fprintf ( stderr , "'%s' is not an ECDSA key\n" , key_name ) ; return - EINVAL ; } ctx -> ecdsa_key = EVP_PKEY_get1_EC_KEY ( ctx -> evp_key , NULL ) ; if ( ! ctx -> ecdsa_key ) { fprintf ( stderr , "Can not extract ECDSA key\n" ) ; } return ( ctx -> ecdsa_key ) ?0 : - EINVAL ; } 