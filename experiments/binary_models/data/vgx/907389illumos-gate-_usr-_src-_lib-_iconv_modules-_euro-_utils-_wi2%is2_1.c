void _icv_close ( struct _icv_state * st ) { free ( st ) ; } size_t _icv_iconv ( struct _icv_state * st , char * * inbuf , size_t * inbytesleft , char * * outbuf , size_t * outbytesleft ) { int cset , stat ; unsigned char * op , ic ; char * ip ; size_t ileft , oleft ; size_t retval ; cset = st -> _st_cset ; stat = st -> _st_stat ; if ( ( inbuf == 0 ) || ( * inbuf == 0 ) ) { cset = CS_0 ; stat = ST_INIT ; op = ( unsigned char * ) * outbuf ; oleft = * outbytesleft ; retval = 0 ; ret2 } ip = * inbuf ; op = ( unsigned char * ) * outbuf ; ileft = * inbytesleft ; oleft = * outbytesleft ; while ( ileft > 0 ) { GET ( ic , NULL ) ; ic = __wi2_to_is2 [ ic ] ; PUT ( ic ) ; if ( ( oleft < 1 ) && ( ileft > 0 ) ) { errno = E2BIG ; retval = ERR_RETURN ; ret } } retval = ileft ; ret st -> _st_cset = cset ; st -> _st_stat = stat ; * inbuf = ip ; * inbytesleft = ileft ; ret2 * outbuf = ( char * ) op ; * outbytesleft = oleft ; return ( retval ) ; } 