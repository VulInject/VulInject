static pa_cntxt_t * pa_cntxt_find ( Mai_t * mad ) { uint64_t now ; int bucket ; Status_t status ; pa_cntxt_t * pa_cntxt ; pa_cntxt_t * req_cntxt ; if ( ( status = vs_lock ( & pa_cntxt_lock ) ) != VSTATUS_OK ) { IB_LOG_ERRORRC ( "Failed to lock PA context rc:" , status ) ; } else { vs_time_get ( & now ) ; bucket = mad -> addrInfo . slid % PA_CNTXT_HASH_TABLE_DEPTH ; pa_cntxt = pa_hash [ bucket ] ; while ( pa_cntxt ) { if ( pa_cntxt -> lid == mad -> addrInfo . slid && pa_cntxt -> tid == mad -> base . tid ) { req_cntxt = pa_cntxt ; pa_cntxt = pa_cntxt -> next ; req_cntxt -> tstamp = now ; break ; } else { pa_cntxt = pa_cntxt -> next ; } } if ( req_cntxt ) { req_cntxt -> tstamp = now ; pa_cntxt_delete_entry ( pa_hash [ bucket ] , req_cntxt ) ; pa_cntxt_insert_head ( pa_hash [ bucket ] , req_cntxt ) ; req_cntxt -> ref ++ ; } if ( ( status = vs_unlock ( & pa_cntxt_lock ) ) != VSTATUS_OK ) { IB_LOG_ERRORRC ( "Failed to unlock PA context rc:" , status ) ; } } IB_EXIT ( __func__ , req_cntxt ) ; return req_cntxt ; } 