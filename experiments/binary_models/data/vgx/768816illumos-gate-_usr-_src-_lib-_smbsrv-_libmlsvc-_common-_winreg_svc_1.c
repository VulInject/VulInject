static char * winreg_enum_subkey ( ndr_xa_t * mxa , const char * subkey , uint32_t index ) { winreg_subkey_t * key ; char * entry ; char * p ; int subkeylen ; int count = 0 ; if ( list_is_empty ( & winreg_keylist . kl_list ) ) { return ( NULL ) ; } subkeylen = strlen ( subkey ) ; for ( key = list_head ( & winreg_keylist . kl_list ) ; key != NULL ; key = list_next ( & winreg_keylist . kl_list , key ) ) { if ( strncasecmp ( subkey , key -> sk_name , subkeylen ) == 0 ) { p = key -> sk_name + subkeylen ; if ( ( * p != '\\' ) || ( * p == '\0' ) ) { continue ; } ++ p ; if ( count < index ) { ++ count ; continue ; } if ( ( entry = NDR_STRDUP ( mxa , p ) ) == NULL ) { return ( NULL ) ; } if ( ( p = strchr ( entry , '\\' ) ) != NULL ) { * p = '\0' ; } return ( entry ) ; } } return ( NULL ) ; } 