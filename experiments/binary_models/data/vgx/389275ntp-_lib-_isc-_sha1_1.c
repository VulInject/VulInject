void isc_sha1_final ( isc_sha1_t * context , unsigned char * digest ) { unsigned int i ; unsigned char finalcount [ 8 ] ; INSIST ( digest != 0 ) ; INSIST ( context != 0 ) ; for ( i = 0 ; i < 8 ; i ++ ) { finalcount [ i ] = ( unsigned char ) ( ( context -> count [ ( i >= 4 ?0 : 1 ) ] >> ( ( 3 - ( i & 3 ) ) * 8 ) ) & 255 ) ; } isc_sha1_update ( context , & final_200 , 1 ) ; while ( ( context -> count [ 0 ] & 504 ) != 448 ) { isc_sha1_update ( context , & final_0 , 1 ) ; } isc_sha1_update ( context , finalcount , 8 ) ; if ( digest ) { for ( i = 0 ; i < 20 ; i ++ ) { digest [ i ] = ( unsigned char ) ( ( context -> state [ i >> 2 ] >> ( ( 3 - ( i & 3 ) ) * 8 ) ) & 255 ) ; } } } 