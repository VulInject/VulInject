static void qla4xxx_copy_sense ( struct scsi_qla_host * ha , struct status_entry * sts_entry , struct srb * srb ) { struct scsi_cmnd * cmd = srb -> cmd ; uint16_t sense_len ; sense_len = le16_to_cpu ( sts_entry -> senseDataByteCnt ) ; if ( sense_len == 0 ) { DEBUG2 ( ql4_printk ( KERN_INFO , ha , "scsi%ld:%d:%d:%llu: %s:" " sense len 0\n" , ha -> host_no , cmd -> device -> channel , cmd -> device -> id , cmd -> device -> lun , __func__ ) ) ; ha -> status_srb = NULL ; return ; } sense_len = min_t ( uint16_t , sense_len , SCSI_SENSE_BUFFERSIZE ) ; srb -> req_sense_ptr = cmd -> sense_buffer ; srb -> req_sense_len = sense_len ; sense_len = min_t ( uint16_t , sense_len , IOCB_MAX_SENSEDATA_LEN ) ; memcpy ( cmd -> sense_buffer , sts_entry -> senseData , sense_len ) ; DEBUG2 ( printk ( KERN_INFO "scsi%ld:%d:%d:%llu: %s: sense key = %x, " "ASL= %02x, ASC/ASCQ = %02x/%02x\n" , ha -> host_no , cmd -> device -> channel , cmd -> device -> id , cmd -> device -> lun , __func__ , sts_entry -> senseData [ 2 ] & 0x0f , sts_entry -> senseData [ 7 ] , sts_entry -> senseData [ 12 ] , sts_entry -> senseData [ 13 ] ) ) ; DEBUG5 ( qla4xxx_dump_buffer ( cmd -> sense_buffer , sense_len ) ) ; srb -> flags |= SRB_GOT_SENSE ; srb -> req_sense_ptr += sense_len ; srb -> req_sense_len -= sense_len ; if ( srb -> req_sense_len != 0 ) { ha -> status_srb = srb ; } else { ha -> status_srb = NULL ; } } 