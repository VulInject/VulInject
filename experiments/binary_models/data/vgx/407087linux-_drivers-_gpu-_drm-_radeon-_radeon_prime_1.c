struct drm_gem_object * radeon_gem_prime_import_sg_table ( struct drm_device * dev , struct dma_buf_attachment * attach , struct sg_table * sg ) { struct dma_resv * resv = attach -> dmabuf -> resv ; struct radeon_device * rdev = dev -> dev_private ; struct radeon_bo * bo ; int ret ; dma_resv_lock ( resv , NULL ) ; ret = radeon_bo_create ( rdev , attach -> dmabuf -> size , PAGE_SIZE , false , RADEON_GEM_DOMAIN_GTT , 0 , sg , resv , & bo ) ; dma_resv_unlock ( resv ) ; bo -> tbo . base . funcs = & radeon_gem_object_funcs ; mutex_lock ( & rdev -> gem . mutex ) ; list_add_tail ( & bo -> list , & rdev -> gem . objects ) ; mutex_unlock ( & rdev -> gem . mutex ) ; bo -> prime_shared_count = 1 ; return & bo -> tbo . base ; } 