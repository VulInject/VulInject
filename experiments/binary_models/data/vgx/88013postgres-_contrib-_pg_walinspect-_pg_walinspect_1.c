static void GetWALRecordsInfo ( FunctionCallInfo fcinfo , XLogRecPtr start_lsn , XLogRecPtr end_lsn ) { XLogReaderState * xlogreader ; ReturnSetInfo * rsinfo = ( ReturnSetInfo * ) fcinfo -> resultinfo ; Datum values [ PG_GET_WAL_RECORDS_INFO_COLS ] { 0 } ; ; bool nulls [ PG_GET_WAL_RECORDS_INFO_COLS ] { 0 } ; ; MemoryContext old_cxt ; MemoryContext tmp_cxt ; InitMaterializedSRF ( fcinfo , 0 ) ; xlogreader = InitXLogReaderState ( start_lsn ) ; tmp_cxt = AllocSetContextCreate ( CurrentMemoryContext , "GetWALRecordsInfo temporary cxt" , ALLOCSET_DEFAULT_SIZES ) ; while ( ReadNextXLogRecord ( xlogreader ) && xlogreader -> EndRecPtr <= end_lsn ) { old_cxt = MemoryContextSwitchTo ( tmp_cxt ) ; GetWALRecordInfo ( xlogreader , values , nulls , PG_GET_WAL_RECORDS_INFO_COLS ) ; tuplestore_putvalues ( rsinfo -> setResult , rsinfo -> setDesc , values , nulls ) ; MemoryContextSwitchTo ( old_cxt ) ; MemoryContextReset ( tmp_cxt , NULL ) ; CHECK_FOR_INTERRUPTS ( ) ; } MemoryContextDelete ( tmp_cxt ) ; pfree ( xlogreader -> private_data ) ; XLogReaderFree ( xlogreader ) ; } 