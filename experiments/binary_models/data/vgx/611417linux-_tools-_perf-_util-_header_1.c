static int write_bpf_prog_info ( struct feat_fd * ff , struct evlist * evlist __maybe_unused ) { struct perf_env * env = & ff -> ph -> env ; struct rb_root * root ; struct rb_node * next ; int ret ; down_read ( & env -> bpf_progs . lock ) ; ret = do_write ( ff , & env -> bpf_progs . infos_cnt , sizeof ( env -> bpf_progs . infos_cnt ) ) ; root = & env -> bpf_progs . infos ; next = rb_first ( root ) ; while ( next ) { struct bpf_prog_info_node * node ; size_t len ; node = rb_entry ( next , bpf_prog_info_node , rb_node ) ; next = rb_next ( & node -> rb_node ) ; len = sizeof ( perf_bpil ) + node -> info_linear -> data_len ; bpil_addr_to_offs ( node -> info_linear ) ; ret = do_write ( ff , node -> info_linear , len ) ; bpil_offs_to_addr ( node -> info_linear ) ; if ( ret < 0 ) { out } } out up_read ( & env -> bpf_progs . lock ) ; return ret ; } 