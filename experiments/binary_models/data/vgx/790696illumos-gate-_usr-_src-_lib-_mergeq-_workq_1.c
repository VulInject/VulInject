static int workq_grow ( workq_t * wqp ) { size_t ncap ; void * * items ; VERIFY ( MUTEX_HELD ( & wqp -> wq_lock ) ) ; VERIFY ( wqp -> wq_working == B_FALSE ) ; ncap = wqp -> wq_cap + WORKQ_DEFAULT_CAP ; items = workq_alloc ( ncap * sizeof ( void * ) ) ; if ( items == NULL ) { return ( ENOMEM ) ; } bzero ( items , ncap * sizeof ( void * ) ) ; bcopy ( wqp -> wq_items , items , wqp -> wq_cap * sizeof ( void * ) ) ; workq_free ( wqp -> wq_items , sizeof ( void * ) * wqp -> wq_cap ) ; wqp -> wq_items = items ; wqp -> wq_cap = ncap ; return ( 0 ) ; } 