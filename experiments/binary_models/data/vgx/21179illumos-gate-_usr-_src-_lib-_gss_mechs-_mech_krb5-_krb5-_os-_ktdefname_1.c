krb5_error_code KRB5_CALLCONV krb5_kt_default_name ( krb5_context context , char * name , int namesize ) { char * cp = 0 ; char * retval ; if ( krb5_overridekeyname ) { if ( ( size_t ) namesize < ( strlen ( krb5_overridekeyname ) + 1 ) ) { return KRB5_CONFIG_NOTENUFSPACE ; } strncpy ( name , krb5_overridekeyname , namesize ) ; } if ( ( context -> profile_secure == FALSE ) && ( cp = getenv ( "KRB5_KTNAME" ) ) ) { if ( ( size_t ) namesize < ( strlen ( cp ) + 1 ) ) { return KRB5_CONFIG_NOTENUFSPACE ; } strncpy ( name , cp , namesize ) ; } if ( ( profile_get_string ( context -> profile , "libdefaults" , "default_keytab_name" , NULL , NULL , & retval ) == 0 ) && retval ) { if ( ( size_t ) namesize < ( strlen ( retval ) + 1 ) ) { return KRB5_CONFIG_NOTENUFSPACE ; } strncpy ( name , retval , namesize ) ; profile_release_string ( retval ) ; } else { { char defname [ 160 ] ; int len ; len = GetWindowsDirectory ( defname , sizeof ( defname ) - 2 ) ; defname [ len ] = '\0' ; sprintf ( name , krb5_defkeyname , defname ) ; } if ( ( size_t ) namesize < ( strlen ( krb5_defkeyname ) + 1 ) ) { return KRB5_CONFIG_NOTENUFSPACE ; } strncpy ( name , krb5_defkeyname , namesize ) ; } return 0 ; } 