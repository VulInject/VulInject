static int ixfr_rename_files ( struct zone * zone , const char * zfile , int dest_num_files ) { struct ixfr_data * data , * startspot = NULL ; int prevcount = 0 ; int destnum ; if ( ! zone -> ixfr || ! zone -> ixfr -> data ) { return 1 ; } data = ixfr_data_first ( zone -> ixfr ) ; destnum = dest_num_files ; if ( ! data ) { return 1 ; } if ( data -> file_num == destnum ) { return 1 ; } while ( data && data -> file_num != 0 ) { if ( ixfr_file_exists_temp ( zfile , data -> file_num ) ) { ( void ) ixfr_unlink_it_temp ( zone -> opts -> name , zfile , data -> file_num , 0 ) ; } if ( ! ixfr_rename_it ( zone -> opts -> name , zfile , data -> file_num , 0 , data -> file_num , 1 ) ) { ixfr_delete_rest_files ( zone , data , zfile , 1 ) ; return 0 ; } startspot = data ; data = ixfr_data_next ( zone -> ixfr , data ) ; destnum -- ; } data = startspot ; while ( data && data -> file_num != 0 ) { destnum ++ ; if ( ixfr_file_exists ( zfile , destnum ) ) { ( void ) ixfr_unlink_it ( zone -> opts -> name , zfile , destnum , 0 ) ; } if ( ! ixfr_rename_it ( zone -> opts -> name , zfile , data -> file_num , 1 , destnum , 0 ) ) { ixfr_delete_rest_files ( zone , data , zfile , 1 ) ; return 0 ; } data -> file_num = destnum ; data = ixfr_data_prev ( zone -> ixfr , data , & prevcount ) ; } return 1 ; } 