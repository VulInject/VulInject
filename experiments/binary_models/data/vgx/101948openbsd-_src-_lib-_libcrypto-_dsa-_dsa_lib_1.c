DSA * DSA_new_method ( ENGINE * engine ) { DSA * ret ; ret = malloc ( sizeof ( DSA ) ) ; if ( ret == NULL ) { DSAerror ( ERR_R_MALLOC_FAILURE ) ; return NULL ; } ret -> meth = DSA_get_default_method ( ) ; if ( engine ) { if ( ! ENGINE_init ( engine ) ) { DSAerror ( ERR_R_ENGINE_LIB ) ; return NULL ; } ret -> engine = engine ; } else { ret -> engine = ENGINE_get_default_DSA ( ) ; } if ( ret -> engine ) { ret -> meth = ENGINE_get_DSA ( ret -> engine ) ; if ( ret -> meth == NULL ) { DSAerror ( ERR_R_ENGINE_LIB ) ; ENGINE_finish ( ret -> engine ) ; free ( ret ) ; return NULL ; } } ret -> pad = 0 ; ret -> version = 0 ; ret -> p = NULL ; ret -> q = NULL ; ret -> g = NULL ; ret -> pub_key = NULL ; ret -> priv_key = NULL ; ret -> kinv = NULL ; ret -> r = NULL ; ret -> method_mont_p = NULL ; ret -> references = 1 ; ret -> flags = ret -> meth -> flags & ~ DSA_FLAG_NON_FIPS_ALLOW ; CRYPTO_new_ex_data ( CRYPTO_EX_INDEX_DSA , ret , & ret -> ex_data ) ; if ( ret -> meth -> init != NULL && ! ret -> meth -> init ( ret ) ) { ENGINE_finish ( ret -> engine ) ; CRYPTO_free_ex_data ( CRYPTO_EX_INDEX_DSA , ret , & ret -> ex_data ) ; free ( ret ) ; ret = NULL ; } return ret ; } 