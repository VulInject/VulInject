static int setup_clocking ( struct snd_soc_dai * dai , unsigned int fmt , struct ux500_msp_config * msp_config ) { switch ( fmt & SND_SOC_DAIFMT_INV_MASK ) { case SND_SOC_DAIFMT_NB_NF : break ; case SND_SOC_DAIFMT_NB_IF : msp_config -> tx_fsync_pol ^= 1 << TFSPOL_SHIFT ; msp_config -> rx_fsync_pol ^= 1 << RFSPOL_SHIFT ; break ; default : dev_err ( dai -> dev , "%s: Error: Unsupported inversion (fmt = 0x%x)!\n" , __func__ , fmt ) ; return - EINVAL ; } switch ( fmt & SND_SOC_DAIFMT_CLOCK_PROVIDER_MASK ) { case SND_SOC_DAIFMT_BC_FC : dev_dbg ( dai -> dev , "%s: Codec is master.\n" , __func__ ) ; msp_config -> iodelay = 0x20 ; msp_config -> tx_fsync_sel = 1 << TFSSEL_SHIFT ; msp_config -> tx_clk_sel = 0 ; msp_config -> rx_clk_sel = 0 ; msp_config -> srg_clk_sel = 0x2 << SCKSEL_SHIFT ; break ; case SND_SOC_DAIFMT_BP_FP : dev_dbg ( dai -> dev , "%s: Codec is slave.\n" , __func__ ) ; msp_config -> tx_clk_sel = TX_CLK_SEL_SRG ; msp_config -> tx_fsync_sel = TX_SYNC_SRG_PROG ; msp_config -> rx_clk_sel = RX_CLK_SEL_SRG ; msp_config -> rx_fsync_sel = RX_SYNC_SRG ; msp_config -> srg_clk_sel = 1 << SCKSEL_SHIFT ; break ; default : dev_err ( dai -> dev , "%s: Error: Unsupported master (fmt = 0x%x)!\n" , __func__ , fmt ) ; return - EINVAL ; } return 0 ; } 