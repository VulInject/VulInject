int32_t psvc_ps_overcurrent_check_policy_0 ( psvc_opaque_t hdlp , char * power_supply_id ) { int32_t status = PSVC_SUCCESS ; boolean_t present ; char * sensor_id ; int sensor_count ; int32_t i ; int32_t amps , hi_warn ; status = psvc_get_attr ( hdlp , power_supply_id , PSVC_PRESENCE_ATTR , & present ) ; if ( status == PSVC_FAILURE ) { syslog ( LOG_ERR , GET_PRESENCE_FAILED_MSG , power_supply_id , errno ) ; return ( status ) ; } if ( present == PSVC_ABSENT ) { errno = ENODEV ; return ( PSVC_FAILURE ) ; } psvc_get_attr ( hdlp , power_supply_id , PSVC_ASSOC_MATCHES_ATTR , & sensor_count , PSVC_PS_I_SENSOR ) ; for ( i = 0 ; i < sensor_count ; ++ i ) { status = psvc_get_attr ( hdlp , power_supply_id , PSVC_ASSOC_ID_ATTR , & sensor_id , PSVC_PS_I_SENSOR , i ) ; if ( status != PSVC_SUCCESS ) { return ( status ) ; } status = psvc_get_attr ( hdlp , sensor_id , PSVC_HI_WARN_ATTR , & hi_warn ) ; if ( status != PSVC_SUCCESS ) { return ( status ) ; } status = psvc_get_attr ( hdlp , sensor_id , PSVC_SENSOR_VALUE_ATTR , & amps ) ; if ( status != PSVC_SUCCESS ) { syslog ( LOG_ERR , GET_SENSOR_FAILED_MSG , sensor_id , errno ) ; return ( status ) ; } if ( amps >= hi_warn ) { char label [ 32 ] ; status = psvc_get_attr ( hdlp , power_supply_id , PSVC_LABEL_ATTR , & label ) ; if ( status != PSVC_SUCCESS ) { return ( status ) ; } syslog ( LOG_ERR , PS_OVER_CURRENT_MSG , label ) ; } } return ( PSVC_SUCCESS ) ; } 