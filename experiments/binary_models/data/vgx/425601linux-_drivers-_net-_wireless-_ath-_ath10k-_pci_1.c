static void ath10k_pci_sleep ( struct ath10k * ar ) { struct ath10k_pci * ar_pci = ath10k_pci_priv ( ar ) ; unsigned long flags ; spin_lock_irqsave ( & ar_pci -> ps_lock , flags ) ; ath10k_dbg ( ar , ATH10K_DBG_PCI_PS , "pci ps sleep refcount %lu awake %d\n" , ar_pci -> ps_wake_refcount , ar_pci -> ps_awake ) ; if ( WARN_ON ( ar_pci -> ps_wake_refcount == 0 ) ) { skip } ar_pci -> ps_wake_refcount -- ; mod_timer ( & ar_pci -> ps_timer , jiffies + msecs_to_jiffies ( ATH10K_PCI_SLEEP_GRACE_PERIOD_MSEC ) ) ; skip spin_unlock_irqrestore ( & ar_pci -> ps_lock , flags ) ; } 