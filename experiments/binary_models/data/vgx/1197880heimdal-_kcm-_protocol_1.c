static krb5_error_code kcm_op_initialize ( krb5_context context , kcm_client * client , kcm_operation opcode , krb5_storage * request , krb5_storage * response ) { kcm_ccache ccache ; krb5_principal principal ; krb5_error_code ret ; char * name ; kcm_event event ; KCM_LOG_REQUEST ( context , client , opcode ) ; ret = krb5_ret_stringz ( request , & name ) ; if ( ret ) { return ret ; } ret = krb5_ret_principal ( request , & principal ) ; if ( ret ) { return ret ; } ret = kcm_ccache_new_client ( context , client , name , & ccache ) ; if ( ret ) { free ( name ) ; krb5_free_principal ( context , principal ) ; return ret ; } ccache -> client = principal ; free ( name ) ; event . fire_time = 30 * 60 ; event . expire_time = 0 ; event . backoff_time = 0 ; event . action = KCM_EVENT_DESTROY_EMPTY_CACHE ; event . ccache = ccache ; ret = kcm_enqueue_event_relative ( context , & event ) ; kcm_release_ccache ( context , ccache ) ; return ret ; } 