int bge_init_rx_ring_std ( struct bge_softc * sc ) { int i ; if ( ISSET ( sc -> bge_flags , BGE_RXRING_VALID ) ) { return ( 0 ) ; } for ( i = 0 ; i < BGE_STD_RX_RING_CNT ; i ++ ) { if ( bus_dmamap_create ( sc -> bge_dmatag , sc -> bge_rx_std_len , 1 , sc -> bge_rx_std_len , 0 , BUS_DMA_NOWAIT | BUS_DMA_ALLOCNOW , & sc -> bge_cdata . bge_rx_std_map [ i ] ) != 0 ) { printf ( "%s: unable to create dmamap for slot %d\n" , sc -> bge_dev . dv_xname , i ) ; uncreate } bzero ( & sc -> bge_rdata -> bge_rx_std_ring [ i ] , sizeof ( bge_rx_bd ) ) ; } sc -> bge_std = BGE_STD_RX_RING_CNT - 1 ; if_rxr_init ( & sc -> bge_std_ring , 17 , BGE_STD_RX_RING_CNT ) ; bge_fill_rx_ring_std ( sc , NULL ) ; SET ( sc -> bge_flags , BGE_RXRING_VALID ) ; return ( 0 ) ; uncreate while ( -- i ) { bus_dmamap_destroy ( sc -> bge_dmatag , sc -> bge_cdata . bge_rx_std_map [ i ] ) ; } return ( 1 ) ; } 