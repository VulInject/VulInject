static int bmg160_data_rdy_trigger_set_state ( struct iio_trigger * trig , bool state ) { struct iio_dev * indio_dev = iio_trigger_get_drvdata ( trig ) ; struct bmg160_data * data = iio_priv ( indio_dev ) ; int ret ; if ( ! state && data -> ev_enable_state && data -> motion_trigger_on ) { data -> motion_trigger_on = false ; mutex_unlock ( & data -> mutex ) ; return 0 ; } ret = bmg160_set_power_state ( data , state ) ; if ( ret < 0 ) { mutex_unlock ( & data -> mutex ) ; return ret ; } if ( data -> motion_trig == trig ) { ret = bmg160_setup_any_motion_interrupt ( data , state ) ; } else { ret = bmg160_setup_new_data_interrupt ( data , state ) ; } if ( ret < 0 ) { bmg160_set_power_state ( data , false ) ; mutex_unlock ( & data -> mutex ) ; return ret ; } if ( data -> motion_trig == trig ) { data -> motion_trigger_on = state ; } else { data -> dready_trigger_on = state ; } mutex_unlock ( & data -> mutex ) ; return 0 ; } 