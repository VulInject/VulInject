static void rtl92c_dm_initial_gain_multi_sta ( struct ieee80211_hw * hw ) { static u8 initialized ; struct rtl_priv * rtlpriv = rtl_priv ( hw ) ; struct dig_t * dm_digtable = & rtlpriv -> dm_digtable ; struct rtl_mac * mac = rtl_mac ( rtl_priv ( hw ) ) ; long rssi_strength = rtlpriv -> dm . entry_min_undec_sm_pwdb ; bool multi_sta = false ; if ( mac -> opmode == NL80211_IFTYPE_ADHOC ) { multi_sta = true ; } if ( ! multi_sta || dm_digtable -> cursta_cstate == DIG_STA_DISCONNECT ) { initialized = false ; dm_digtable -> dig_ext_port_stage = DIG_EXT_PORT_STAGE_MAX ; return ; } if ( ! initialized ) { initialized = true ; dm_digtable -> dig_ext_port_stage = DIG_EXT_PORT_STAGE_0 ; dm_digtable -> cur_igvalue = 0x20 ; rtl92c_dm_write_dig ( hw , NULL ) ; } if ( dm_digtable -> curmultista_cstate == DIG_MULTISTA_CONNECT ) { if ( ( rssi_strength < dm_digtable -> rssi_lowthresh ) && ( dm_digtable -> dig_ext_port_stage != DIG_EXT_PORT_STAGE_1 ) ) { if ( dm_digtable -> dig_ext_port_stage == DIG_EXT_PORT_STAGE_2 ) { dm_digtable -> cur_igvalue = 0x20 ; rtl92c_dm_write_dig ( hw ) ; } dm_digtable -> dig_ext_port_stage = DIG_EXT_PORT_STAGE_1 ; } if ( rssi_strength > dm_digtable -> rssi_highthresh ) { dm_digtable -> dig_ext_port_stage = DIG_EXT_PORT_STAGE_2 ; rtl92c_dm_ctrl_initgain_by_fa ( hw ) ; } } if ( dm_digtable -> dig_ext_port_stage != DIG_EXT_PORT_STAGE_0 ) { dm_digtable -> dig_ext_port_stage = DIG_EXT_PORT_STAGE_0 ; dm_digtable -> cur_igvalue = 0x20 ; rtl92c_dm_write_dig ( hw ) ; } rtl_dbg ( rtlpriv , COMP_DIG , DBG_TRACE , "curmultista_cstate = %x dig_ext_port_stage %x\n" , dm_digtable -> curmultista_cstate , dm_digtable -> dig_ext_port_stage ) ; } 