static unsigned long clk_master_pres_get_rate ( struct clk * clk , unsigned long parent_rate ) { struct clk_master * master = clk -> priv ; const struct clk_master_charac * charac = master -> charac ; uint32_t val = 0 ; int pres = 0 ; val = io_read32 ( master -> base + master -> layout -> offset ) ; pres = ( val >> master -> layout -> pres_shift ) & MASTER_PRES_MASK ; if ( pres != 3 || ! charac -> have_div3_pres ) { pres = BIT ( pres ) ; } return UDIV_ROUND_NEAREST ( parent_rate , pres ) ; } 