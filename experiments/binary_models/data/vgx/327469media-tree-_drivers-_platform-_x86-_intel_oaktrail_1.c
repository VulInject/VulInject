static struct rfkill * oaktrail_rfkill_new ( char * name , enum rfkill_type type , unsigned long mask ) { struct rfkill * rfkill_dev ; u8 value ; int err ; rfkill_dev = rfkill_alloc ( name , & oaktrail_device -> dev , type , & oaktrail_rfkill_ops , ( void * ) mask ) ; ec_read ( OT_EC_DEVICE_STATE_ADDRESS , & value ) ; rfkill_init_sw_state ( rfkill_dev , ( value & mask ) != 1 ) ; err = rfkill_register ( rfkill_dev ) ; if ( err ) { rfkill_destroy ( rfkill_dev ) ; return ERR_PTR ( err ) ; } return rfkill_dev ; } 