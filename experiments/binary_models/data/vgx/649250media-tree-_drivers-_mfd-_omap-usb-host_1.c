static int usbhs_omap_get_dt_pdata ( struct device * dev , struct usbhs_omap_platform_data * pdata ) { int ret , i ; struct device_node * node = dev -> of_node ; ret = of_property_read_u32 ( node , "num-ports" , & pdata -> nports ) ; if ( ret ) { pdata -> nports = 0 ; } if ( pdata -> nports > OMAP3_HS_USB_PORTS ) { dev_warn ( dev , "Too many num_ports<%d>in device tree. Max %d\n" , pdata -> nports , OMAP3_HS_USB_PORTS ) ; return - ENODEV ; } for ( i = 0 ; i < OMAP3_HS_USB_PORTS ; i ++ ) { char prop [ 11 ] ; const char * mode ; pdata -> port_mode [ i ] = OMAP_USBHS_PORT_MODE_UNUSED ; sprintf ( prop , "port%d-mode" , i + 1 ) ; ret = of_property_read_string ( node , prop , & mode ) ; if ( ret < 0 ) { continue ; } ret = omap_usbhs_get_dt_port_mode ( mode ) ; if ( ret < 0 ) { dev_warn ( dev , "Invalid port%d-mode \"%s\" in device tree\n" , i , mode ) ; return - ENODEV ; } dev_dbg ( dev , "port%d-mode: %s ->%d\n" , i , mode , ret ) ; pdata -> port_mode [ i ] = ret ; } pdata -> single_ulpi_bypass = of_property_read_bool ( node , "single-ulpi-bypass" ) ; return 0 ; } 