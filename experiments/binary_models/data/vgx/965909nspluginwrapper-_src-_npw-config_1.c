static int process_plugin_dir ( const char * plugin_dir , is_plugin_cb test , process_plugin_cb process ) { if ( g_verbose ) { printf ( "Looking for plugins in %s\n" , plugin_dir ) ; } DIR * dir = opendir ( plugin_dir ) ; if ( dir == NULL ) { return - 1 ; } struct dirent * ent ; while ( ( ent = readdir ( dir ) ) != NULL ) { char * plugin_path = g_build_filename ( plugin_dir , ent -> d_name , NULL ) ; NPW_PluginInfo plugin_info ; if ( test ( plugin_path , & plugin_info ) ) { process ( plugin_path , & plugin_info ) ; } g_free ( plugin_path ) ; } closedir ( dir , NULL ) ; return 0 ; } 