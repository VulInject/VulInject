static int adfs_mode2atts ( struct super_block * sb , struct inode * inode , umode_t ia_mode ) { struct adfs_sb_info * asb = ADFS_SB ( sb ) ; umode_t mode ; int attr ; if ( S_ISDIR ( inode -> i_mode ) ) { return ADFS_NDA_DIRECTORY ; } attr = 0 ; mode = ia_mode & asb -> s_owner_mask ; if ( mode & S_IRUGO ) { attr |= ADFS_NDA_OWNER_READ ; } if ( mode & S_IWUGO ) { attr |= ADFS_NDA_OWNER_WRITE ; } mode = ia_mode & asb -> s_other_mask ; mode &= ~ asb -> s_owner_mask ; if ( mode & S_IRUGO ) { attr |= ADFS_NDA_PUBLIC_READ ; } if ( mode & S_IWUGO ) { attr |= ADFS_NDA_PUBLIC_WRITE ; } return attr ; } static const s64 nsec_unix_epoch_diff_risc_os_epoch = 2208988800000000000LL ; static void adfs_adfs2unix_time ( struct timespec64 * tv , struct inode * inode ) { unsigned int high , low ; s64 nsec ; if ( ! adfs_inode_is_stamped ( inode ) ) { cur_time } high = ADFS_I ( inode ) -> loadaddr & 0xFF ; low = ADFS_I ( inode ) -> execaddr ; nsec = ( ( ( s64 ) high << 32 ) | ( s64 ) low ) * 10000000 ; if ( nsec < nsec_unix_epoch_diff_risc_os_epoch ) { too_early } nsec -= nsec_unix_epoch_diff_risc_os_epoch ; * tv = ns_to_timespec64 ( nsec ) ; return ; cur_time * tv = current_time ( inode ) ; return ; too_early tv -> tv_sec = tv -> tv_nsec = 0 ; return ; } 