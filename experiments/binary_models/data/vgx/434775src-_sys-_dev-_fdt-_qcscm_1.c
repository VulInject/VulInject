int qcscm_smc_call ( struct qcscm_softc * sc , uint8_t owner , uint8_t svc , uint8_t cmd , uint32_t arginfo , uint64_t * args , int arglen , uint64_t * res ) { uint64_t smcreq [ 8 ] { 0 } ; , smcres [ 8 ] { 0 } ; ; uint64_t * smcextreq ; int i ; smcreq [ 0 ] = ARM_SMCCC_STD_CALL | ARM_SMCCC_LP64 | owner << 24 | svc << 8 | cmd ; smcreq [ 1 ] = arginfo ; for ( i = 0 ; i < min ( arglen , 4 ) ; i ++ ) { smcreq [ 2 + i ] = args [ i ] ; } smcextreq = QCSCM_DMA_KVA ( sc -> sc_extarg , NULL ) ; if ( arglen > 4 ) { smcreq [ 5 ] = QCSCM_DMA_DVA ( sc -> sc_extarg ) ; smcextreq = QCSCM_DMA_KVA ( sc -> sc_extarg ) ; for ( i = 0 ; i < min ( arglen - 3 , 7 ) ; i ++ ) { smcextreq [ i ] = args [ 3 + i ] ; } } for ( ; ; ) { qcscm_smc_exec ( smcreq , smcres ) ; if ( smcres [ 0 ] == QCSCM_INTERRUPTED ) { smcreq [ 0 ] = smcres [ 0 ] ; smcreq [ 6 ] = smcres [ 6 ] ; continue ; } break ; } if ( res ) { res [ 0 ] = smcres [ 1 ] ; res [ 1 ] = smcres [ 2 ] ; res [ 2 ] = smcres [ 3 ] ; } return smcres [ 0 ] ; } 