struct sst_dsp * sst_dsp_new ( struct device * dev , struct sst_dsp_device * sst_dev , struct sst_pdata * pdata ) { struct sst_dsp * sst ; int err ; dev_dbg ( dev , "initialising audio DSP id 0x%x\n" , pdata -> id ) ; sst = devm_kzalloc ( dev , sizeof ( * sst ) , GFP_KERNEL ) ; if ( sst == NULL ) { return NULL ; } spin_lock_init ( & sst -> spinlock ) ; sst -> dev = dev ; sst -> dma_dev = pdata -> dma_dev ; sst -> thread_context = sst_dev -> thread_context ; sst -> sst_dev = sst_dev ; sst -> id = pdata -> id ; sst -> irq = pdata -> irq ; sst -> ops = sst_dev -> ops ; sst -> pdata = pdata ; INIT_LIST_HEAD ( & sst -> used_block_list ) ; INIT_LIST_HEAD ( & sst -> free_block_list ) ; INIT_LIST_HEAD ( & sst -> module_list ) ; INIT_LIST_HEAD ( & sst -> fw_list ) ; INIT_LIST_HEAD ( & sst -> scratch_block_list ) ; if ( sst -> ops -> init ) { err = sst -> ops -> init ( sst , pdata ) ; if ( err < 0 ) { return NULL ; } } err = request_threaded_irq ( sst -> irq , sst -> ops -> irq_handler , sst_dev -> thread , IRQF_SHARED , "AudioDSP" , sst ) ; if ( err ) { irq_err } err = sst_dma_new ( sst ) ; if ( err ) { dev_warn ( dev , "sst_dma_new failed %d\n" , err ) ; } return sst ; irq_err if ( sst -> ops -> free ) { sst -> ops -> free ( sst ) ; } return NULL ; } 