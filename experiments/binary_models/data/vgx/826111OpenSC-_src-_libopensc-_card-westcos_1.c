static int westcos_list_files ( sc_card_t * card , u8 * buf , size_t buflen ) { int r ; sc_apdu_t apdu ; sc_log ( card -> ctx , "westcos_list_files\n" ) ; sc_format_apdu ( card , & apdu , SC_APDU_CASE_2_SHORT , 0x34 , 0x00 , 0x00 ) ; apdu . cla = 0x80 ; apdu . le = buflen ; apdu . resplen = buflen ; apdu . resp = buf ; r = sc_transmit_apdu ( card , & apdu ) ; if ( r ) { return ( r ) ; } r = sc_check_sw ( card , apdu . sw1 , apdu . sw2 ) ; if ( r ) { return ( r ) ; } return apdu . resplen ; } 