int m5602_write_sensor ( struct sd * sd , const u8 address , u8 * i2c_data , const u8 len ) { int err , i ; u8 * p ; struct gspca_dev * gspca_dev = ( gspca_dev * ) sd ; struct usb_device * udev = sd -> gspca_dev . dev ; __u8 * buf = sd -> gspca_dev . usb_buf ; memcpy ( buf , sensor_urb_skeleton , sizeof ( sensor_urb_skeleton ) ) ; buf [ 11 ] = sd -> sensor -> i2c_slave_id ; buf [ 15 ] = address ; p = buf + 16 ; for ( i = 0 ; i < len ; i ++ ) { memcpy ( p , sensor_urb_skeleton + 16 , 4 ) ; p [ 3 ] = i2c_data [ i ] ; p += 4 ; gspca_dbg ( gspca_dev , D_CONF , "Writing sensor register 0x%x with 0x%x\n" , address , i2c_data [ i ] ) ; } memcpy ( p , sensor_urb_skeleton + 20 , 4 ) ; p [ 3 ] = 0x10 + len ; err = usb_control_msg ( udev , usb_sndctrlpipe ( udev , 0 ) , 0x04 , 0x40 , 0x19 , 0x0000 , buf , 20 + len * 4 , M5602_URB_MSG_TIMEOUT ) ; return ( err < 0 ) ?err : 0 ; } 