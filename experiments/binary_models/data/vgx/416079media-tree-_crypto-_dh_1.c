static int dh_set_secret ( struct crypto_kpp * tfm , const void * buf , unsigned int len ) { struct dh_ctx * ctx = dh_get_ctx ( tfm ) ; struct dh params ; if ( crypto_dh_decode_key ( buf , len , & params ) < 0 ) { return - EINVAL ; } if ( dh_set_params ( ctx , & params ) < 0 ) { return - EINVAL ; } ctx -> xa = mpi_read_raw_data ( params . key , params . key_size ) ; if ( ! ctx -> xa ) { return - EINVAL ; } return 0 ; } 