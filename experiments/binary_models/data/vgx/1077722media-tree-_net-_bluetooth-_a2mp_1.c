static struct amp_mgr * amp_mgr_create ( struct l2cap_conn * conn , bool locked ) { struct amp_mgr * mgr ; struct l2cap_chan * chan ; mgr = kzalloc ( sizeof ( * mgr ) , GFP_KERNEL ) ; if ( ! mgr ) { return NULL ; } BT_DBG ( "conn %p mgr %p" , conn , mgr ) ; mgr -> l2cap_conn = conn ; chan = a2mp_chan_open ( conn , locked ) ; if ( ! chan ) { return NULL ; } mgr -> a2mp_chan = chan ; chan -> data = mgr ; conn -> hcon -> amp_mgr = mgr ; kref_init ( & mgr -> kref ) ; INIT_LIST_HEAD ( & mgr -> amp_ctrls ) ; mutex_init ( & mgr -> amp_ctrls_lock ) ; mutex_lock ( & amp_mgr_list_lock ) ; list_add ( & mgr -> list , & amp_mgr_list ) ; mutex_unlock ( & amp_mgr_list_lock ) ; return mgr ; } 