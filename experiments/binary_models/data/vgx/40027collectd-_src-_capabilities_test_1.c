DEF_TEST ( ) { oconfig_item_t test_cfg_parent = { "capabilities" NULL 0 NULL NULL 0 } ; char value_buff [ 256 ] "1234" ; ; char key_buff [ 256 ] "port" ; ; oconfig_value_t test_cfg_value = { { value_buff } OCONFIG_TYPE_STRING } ; oconfig_item_t test_cfg = { key_buff & test_cfg_value 1 & test_cfg_parent NULL 0 } ; test_cfg_parent . children = & test_cfg ; test_cfg_parent . children_num = 1 ; int ret = cap_config ( & test_cfg_parent ) ; EXPECT_EQ_INT ( 0 , ret ) ; EXPECT_EQ_INT ( 1234 , httpd_port ) ; OK ( NULL == httpd_host ) ; strncpy ( value_buff , "1" , STATIC_ARRAY_SIZE ( value_buff ) ) ; ret = cap_config ( & test_cfg_parent ) ; EXPECT_EQ_INT ( 0 , ret ) ; EXPECT_EQ_INT ( 1 , httpd_port ) ; strncpy ( value_buff , "65535" , STATIC_ARRAY_SIZE ( value_buff ) ) ; ret = cap_config ( & test_cfg_parent ) ; EXPECT_EQ_INT ( 0 , ret ) ; EXPECT_EQ_INT ( 65535 , httpd_port ) ; strncpy ( value_buff , "127.0.0.1" , STATIC_ARRAY_SIZE ( value_buff ) ) ; strncpy ( key_buff , "host" , STATIC_ARRAY_SIZE ( key_buff ) ) ; ret = cap_config ( & test_cfg_parent ) ; EXPECT_EQ_INT ( 0 , ret ) ; EXPECT_EQ_STR ( "127.0.0.1" , httpd_host ) ; EXPECT_EQ_INT ( 65535 , httpd_port ) ; strncpy ( key_buff , "port" , STATIC_ARRAY_SIZE ( key_buff ) ) ; double port_value = 65535 ; oconfig_value_t test_cfg_value2 = { { . number = port_value } OCONFIG_TYPE_NUMBER } ; test_cfg . values = & test_cfg_value2 ; ret = cap_config ( & test_cfg_parent ) ; EXPECT_EQ_INT ( 0 , ret ) ; EXPECT_EQ_INT ( 65535 , httpd_port ) ; return 0 ; } 