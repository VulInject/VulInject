static void kernel_fpu_fpstate_init ( kfpu_state_t * kfpu ) { struct xsave_state * xs ; switch ( fp_save_mech ) { case FP_FXSAVE : bcopy ( & sse_initial , kfpu -> kfpu_ctx . fpu_regs . kfpu_u . kfpu_fx , sizeof ( fxsave_state ) ) ; break ; case FP_XSAVE : xs = kfpu -> kfpu_ctx . fpu_regs . kfpu_u . kfpu_xs ; bzero ( xs , cpuid_get_xsave_size ( ) ) ; bcopy ( & avx_initial , xs , sizeof ( * xs ) ) ; xs -> xs_header . xsh_xstate_bv = XFEATURE_LEGACY_FP | XFEATURE_SSE ; kfpu -> kfpu_ctx . fpu_xsave_mask = XFEATURE_FP_ALL ; break ; default : panic ( "invalid fp_save_mech" ) ; } kfpu -> kfpu_ctx . fpu_flags = FPU_EN | FPU_VALID ; kfpu -> kfpu_flags |= KFPU_F_INITIALIZED ; } 