static void lan8814_ptp_init ( struct phy_device * phydev ) { struct kszphy_priv * priv = phydev -> priv ; struct kszphy_ptp_priv * ptp_priv = & priv -> ptp_priv ; u32 temp ; lanphy_write_page_reg ( phydev , 5 , TSU_HARD_RESET , TSU_HARD_RESET_ ) ; temp = lanphy_read_page_reg ( phydev , 5 , PTP_TX_MOD ) ; temp |= PTP_TX_MOD_BAD_UDPV4_CHKSUM_FORCE_FCS_DIS_ ; lanphy_write_page_reg ( phydev , 5 , PTP_TX_MOD , temp ) ; temp = lanphy_read_page_reg ( phydev , 5 , PTP_RX_MOD ) ; temp |= PTP_RX_MOD_BAD_UDPV4_CHKSUM_FORCE_FCS_DIS_ ; lanphy_write_page_reg ( phydev , 5 , PTP_RX_MOD , temp ) ; lanphy_write_page_reg ( phydev , 5 , PTP_RX_PARSE_CONFIG , 0 ) ; lanphy_write_page_reg ( phydev , 5 , PTP_TX_PARSE_CONFIG , 0 ) ; lanphy_write_page_reg ( phydev , 5 , PTP_TX_PARSE_L2_ADDR_EN , 0 ) ; lanphy_write_page_reg ( phydev , 5 , PTP_RX_PARSE_L2_ADDR_EN , 0 ) ; lanphy_write_page_reg ( phydev , 5 , PTP_TX_PARSE_IP_ADDR_EN , 0 ) ; lanphy_write_page_reg ( phydev , 5 , PTP_RX_PARSE_IP_ADDR_EN , 0 ) ; skb_queue_head_init ( & ptp_priv -> tx_queue ) ; skb_queue_head_init ( & ptp_priv -> rx_queue ) ; INIT_LIST_HEAD ( & ptp_priv -> rx_ts_list ) ; spin_lock_init ( & ptp_priv -> rx_ts_lock ) ; ptp_priv -> phydev = phydev ; ptp_priv -> mii_ts . rxtstamp = lan8814_rxtstamp ; ptp_priv -> mii_ts . txtstamp = lan8814_txtstamp ; ptp_priv -> mii_ts . hwtstamp = lan8814_hwtstamp ; ptp_priv -> mii_ts . ts_info = lan8814_ts_info ; phydev -> mii_ts = & ptp_priv -> mii_ts ; } 