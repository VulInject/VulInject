HAL_BOOL ar5k_ar5211_setup_tx_desc ( struct ath_hal * hal , struct ath_desc * desc , u_int packet_length , u_int header_length , HAL_PKT_TYPE type , u_int tx_power , u_int tx_rate0 , u_int tx_tries0 , u_int key_index , u_int antenna_mode , u_int flags , u_int rtscts_rate , u_int rtscts_duration ) { struct ar5k_ar5211_tx_desc * tx_desc ; tx_desc = ( ar5k_ar5211_tx_desc * ) & desc -> ds_ctl0 ; if ( ( tx_desc -> tx_control_0 = ( packet_length & AR5K_AR5211_DESC_TX_CTL0_FRAME_LEN ) ) != packet_length ) { return ( AH_FALSE ) ; } tx_desc -> tx_control_0 |= AR5K_REG_SM ( tx_rate0 , AR5K_AR5211_DESC_TX_CTL0_XMIT_RATE ) | AR5K_REG_SM ( antenna_mode , AR5K_AR5211_DESC_TX_CTL0_ANT_MODE_XMIT ) ; tx_desc -> tx_control_1 = AR5K_REG_SM ( type , AR5K_AR5211_DESC_TX_CTL1_FRAME_TYPE ) ; if ( flags & HAL_TXDESC_ # # _flag ) { tx_desc -> tx_control_ # # _c |= AR5K_AR5211_DESC_TX_CTL # # _c # # _ # # _flag _TX_FLAGS ( 0 , CLRDMASK ) ; } _TX_FLAGS ( 0 , VEOL ) ; _TX_FLAGS ( 0 , INTREQ ) ; _TX_FLAGS ( 0 , RTSENA ) ; _TX_FLAGS ( 1 , NOACK ) ; if ( key_index != HAL_TXKEYIX_INVALID ) { tx_desc -> tx_control_0 |= AR5K_AR5211_DESC_TX_CTL0_ENCRYPT_KEY_VALID ; tx_desc -> tx_control_1 |= AR5K_REG_SM ( key_index , AR5K_AR5211_DESC_TX_CTL1_ENCRYPT_KEY_INDEX ) ; } return ( AH_TRUE ) ; } 