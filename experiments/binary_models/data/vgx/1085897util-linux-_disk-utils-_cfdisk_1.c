static char * get_mountpoint ( struct cfdisk * cf , const char * tagname , const char * tagdata ) { struct libmnt_fs * fs = NULL ; char * target = NULL ; int mounted = 0 ; assert ( tagname ) ; DBG ( UI , ul_debug ( "asking for mountpoint [%s=%s]" , tagname , tagdata ) ) ; if ( ! cf -> mntcache ) { cf -> mntcache = mnt_new_cache ( ) ; } if ( ! cf -> mtab ) { cf -> mtab = mnt_new_table ( ) ; if ( cf -> mtab ) { mnt_table_set_cache ( cf -> mtab , cf -> mntcache ) ; mnt_table_parse_mtab ( cf -> mtab , NULL ) ; } } if ( cf -> mtab ) { fs = mnt_table_find_tag ( cf -> mtab , tagname , tagdata , MNT_ITER_FORWARD ) ; } if ( ! fs ) { if ( ! cf -> fstab ) { cf -> fstab = mnt_new_table ( ) ; if ( cf -> fstab ) { mnt_table_set_cache ( cf -> fstab , cf -> mntcache ) ; if ( mnt_table_parse_fstab ( cf -> fstab , NULL ) != 0 ) { mnt_unref_table ( cf -> fstab ) ; cf -> fstab = NULL ; } } } if ( cf -> fstab ) { fs = mnt_table_find_tag ( cf -> fstab , tagname , tagdata , MNT_ITER_FORWARD ) ; } } else { mounted = 1 ; } if ( fs ) { if ( mounted ) { xasprintf ( & target , _ ( "%s (mounted)" ) , mnt_fs_get_target ( fs ) ) ; } else { target = xstrdup ( mnt_fs_get_target ( fs ) ) ; } } return target ; } 