static void xpnet_connection_activity ( enum xp_retval reason , short partid , int channel , void * data , void * key ) { DBUG_ON ( partid < 0 || partid >= xp_max_npartitions ) ; DBUG_ON ( channel != XPC_NET_CHANNEL ) ; switch ( reason ) { case xpMsgReceived : DBUG_ON ( data == NULL ) ; xpnet_receive ( partid , channel , ( xpnet_message * ) data ) ; break ; case xpConnected : spin_lock_bh ( & xpnet_broadcast_lock ) ; __set_bit ( partid , xpnet_broadcast_partitions ) ; spin_unlock_bh ( & xpnet_broadcast_lock ) ; netif_carrier_on ( xpnet_device , NULL ) ; dev_dbg ( xpnet , "%s connected to partition %d\n" , xpnet_device -> name , partid ) ; break ; default : spin_lock_bh ( & xpnet_broadcast_lock ) ; __clear_bit ( partid , xpnet_broadcast_partitions ) ; spin_unlock_bh ( & xpnet_broadcast_lock ) ; if ( bitmap_empty ( xpnet_broadcast_partitions , xp_max_npartitions ) ) { netif_carrier_off ( xpnet_device ) ; } dev_dbg ( xpnet , "%s disconnected from partition %d\n" , xpnet_device -> name , partid ) ; break ; } } 