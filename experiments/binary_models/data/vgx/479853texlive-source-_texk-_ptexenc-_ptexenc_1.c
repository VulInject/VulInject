FILE * nkf_open ( const char * path , const char * mode ) { char buff [ PATH_MAX * 2 + 20 ] ; char * name ; FILE * fp ; if ( in_filter == NULL ) { in_filter = kpse_var_value ( "PTEX_IN_FILTER" ) ; if ( in_filter == NULL || strcasecmp ( in_filter , "no" ) == 0 ) { nkf_disable ( ) ; } atexit ( nkf_check ) ; } if ( in_filter [ 0 ] == '\0' ) { return fopen ( path , mode ) ; } name = xstrdup ( path ) ; if ( kpse_readable_file ( name ) == NULL ) { return NULL ; } sprintf ( buff , "%.*s<'%.*s'" , PATH_MAX , in_filter , PATH_MAX , path ) ; free ( name ) ; fp = popen ( buff , "r" ) ; if ( piped_num < NOFILE ) { piped_fp [ piped_num ++ ] = fp ; } return fp ; } 