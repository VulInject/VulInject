static int mwifiex_11n_dispatch_amsdu_pkt ( struct mwifiex_private * priv , struct sk_buff * skb ) { struct rxpd * local_rx_pd = ( rxpd * ) ( skb -> data ) ; int ret ; if ( le16_to_cpu ( local_rx_pd -> rx_pkt_type ) == PKT_TYPE_AMSDU ) { struct sk_buff_head list ; struct sk_buff * rx_skb ; __skb_queue_head_init ( & list ) ; skb_pull ( skb , le16_to_cpu ( local_rx_pd -> rx_pkt_offset ) ) ; skb_trim ( skb , le16_to_cpu ( local_rx_pd -> rx_pkt_length ) ) ; ieee80211_amsdu_to_8023s ( skb , & list , priv -> curr_addr , priv -> wdev . iftype , 0 , NULL , NULL ) ; while ( ! skb_queue_empty ( & list ) ) { struct rx_packet_hdr * rx_hdr ; rx_skb = __skb_dequeue ( & list ) ; rx_hdr = ( rx_packet_hdr * ) rx_skb -> data ; if ( ISSUPP_TDLS_ENABLED ( priv -> adapter -> fw_cap_info ) && ntohs ( rx_hdr -> eth803_hdr . h_proto ) == ETH_P_TDLS ) { mwifiex_process_tdls_action_frame ( priv , ( u8 * ) rx_hdr , skb -> len ) ; } if ( priv -> bss_role == MWIFIEX_BSS_ROLE_UAP ) { ret = mwifiex_uap_recv_packet ( priv , rx_skb ) ; } else { ret = mwifiex_recv_packet ( priv , rx_skb ) ; } if ( ret == - 1 ) { mwifiex_dbg ( priv -> adapter , ERROR , "Rx of A-MSDU failed" ) ; } } return 0 ; } return - 1 ; } 