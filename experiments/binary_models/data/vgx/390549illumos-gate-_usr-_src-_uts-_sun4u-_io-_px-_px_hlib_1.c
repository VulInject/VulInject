uint64_t hvio_suspend ( devhandle_t dev_hdl , pxu_t * pxu_p ) { uint64_t * config_state ; int total_size ; int i ; if ( msiq_suspend ( dev_hdl , pxu_p ) != H_EOK ) { return ( H_EIO ) ; } total_size = PEC_SIZE + MMU_SIZE + IB_SIZE + IB_MAP_SIZE ; config_state = kmem_zalloc ( total_size , KM_NOSLEEP ) ; pxu_p -> pec_config_state = config_state ; for ( i = 0 ; i < PEC_KEYS ; i ++ ) { if ( ( pec_config_state_regs [ i ] . chip == PX_CHIP_TYPE ( pxu_p ) ) || ( pec_config_state_regs [ i ] . chip == PX_CHIP_UNIDENTIFIED ) ) { pxu_p -> pec_config_state [ i ] = CSR_XR ( ( caddr_t ) dev_hdl , pec_config_state_regs [ i ] . reg ) ; } } pxu_p -> mmu_config_state = pxu_p -> pec_config_state + PEC_KEYS ; for ( i = 0 ; i < MMU_KEYS ; i ++ ) { pxu_p -> mmu_config_state [ i ] = CSR_XR ( ( caddr_t ) dev_hdl , mmu_config_state_regs [ i ] ) ; } pxu_p -> ib_intr_map = pxu_p -> mmu_config_state + MMU_KEYS ; for ( i = 0 ; i < INTERRUPT_MAPPING_ENTRIES ; i ++ ) { pxu_p -> ib_intr_map [ i ] = CSRA_XR ( ( caddr_t ) dev_hdl , INTERRUPT_MAPPING , i ) ; } pxu_p -> ib_config_state = pxu_p -> ib_intr_map + INTERRUPT_MAPPING_ENTRIES ; for ( i = 0 ; i < IB_KEYS ; i ++ ) { pxu_p -> ib_config_state [ i ] = CSR_XR ( ( caddr_t ) dev_hdl , ib_config_state_regs [ i ] ) ; } return ( H_EOK ) ; } 