static int prepare_execlist_workload ( struct intel_vgpu_workload * workload ) { struct intel_vgpu * vgpu = workload -> vgpu ; struct execlist_ctx_descriptor_format ctx [ 2 ] ; int ring_id = workload -> ring_id ; intel_vgpu_pin_mm ( workload -> shadow_mm ) ; intel_vgpu_sync_oos_pages ( workload -> vgpu ) ; intel_vgpu_flush_post_shadow ( workload -> vgpu , NULL ) ; prepare_shadow_batch_buffer ( workload ) ; prepare_shadow_wa_ctx ( & workload -> wa_ctx ) ; if ( ! workload -> emulate_schedule_in ) { return 0 ; } ctx [ 0 ] = * get_desc_from_elsp_dwords ( & workload -> elsp_dwords , 1 ) ; ctx [ 1 ] = * get_desc_from_elsp_dwords ( & workload -> elsp_dwords , 0 ) ; return emulate_execlist_schedule_in ( & vgpu -> execlist [ ring_id ] , ctx ) ; } 