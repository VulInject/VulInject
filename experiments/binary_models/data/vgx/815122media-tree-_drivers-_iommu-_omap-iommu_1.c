static struct iommu_domain * omap_iommu_domain_alloc ( unsigned type ) { struct omap_iommu_domain * omap_domain ; if ( type != IOMMU_DOMAIN_UNMANAGED ) { return NULL ; } omap_domain = kzalloc ( sizeof ( * omap_domain ) , GFP_KERNEL ) ; if ( ! omap_domain ) { out } omap_domain -> pgtable = kzalloc ( IOPGD_TABLE_SIZE , GFP_KERNEL ) ; if ( ! omap_domain -> pgtable ) { fail_nomem } if ( WARN_ON ( ! IS_ALIGNED ( ( long ) omap_domain -> pgtable , IOPGD_TABLE_SIZE ) ) ) { fail_align } clean_dcache_area ( omap_domain -> pgtable , IOPGD_TABLE_SIZE ) ; spin_lock_init ( & omap_domain -> lock ) ; omap_domain -> domain . geometry . aperture_start = 0 ; omap_domain -> domain . geometry . aperture_end = ( 1ULL << 32 ) - 1 ; omap_domain -> domain . geometry . force_aperture = true ; return & omap_domain -> domain ; fail_align fail_nomem kfree ( omap_domain ) ; out return NULL ; } 