PKCS12 * PKCS12_init ( int mode ) { PKCS12 * pkcs12 ; if ( ! ( pkcs12 = PKCS12_new ( ) ) ) { PKCS12error ( ERR_R_MALLOC_FAILURE , NULL ) ; return NULL ; } if ( ! ASN1_INTEGER_set ( pkcs12 -> version , 3 ) ) { err } if ( ( pkcs12 -> authsafes -> type = OBJ_nid2obj ( mode ) ) == NULL ) { err } switch ( mode ) { case NID_pkcs7_data : if ( ! ( pkcs12 -> authsafes -> d . data = ASN1_OCTET_STRING_new ( ) ) ) { PKCS12error ( ERR_R_MALLOC_FAILURE ) ; err } break ; default : PKCS12error ( PKCS12_R_UNSUPPORTED_PKCS12_MODE ) ; err } return pkcs12 ; err if ( pkcs12 != NULL ) { PKCS12_free ( pkcs12 ) ; } return NULL ; } 