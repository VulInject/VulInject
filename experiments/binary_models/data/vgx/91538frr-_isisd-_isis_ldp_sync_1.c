void isis_ldp_sync_set_if_metric ( struct isis_circuit * circuit , bool run_regen ) { struct ldp_sync_info * ldp_sync_info ; ldp_sync_info = circuit -> ldp_sync_info ; if ( ldp_sync_if_is_enabled ( ldp_sync_info ) ) { if ( CHECK_FLAG ( ldp_sync_info -> flags , LDP_SYNC_FLAG_SET_METRIC ) ) { return ; } SET_FLAG ( ldp_sync_info -> flags , LDP_SYNC_FLAG_SET_METRIC ) ; if ( circuit -> is_type & IS_LEVEL_1 ) { if ( circuit -> area -> newmetric ) { ldp_sync_info -> metric [ 0 ] = circuit -> te_metric [ 0 ] ; circuit -> te_metric [ 0 ] = ISIS_WIDE_METRIC_INFINITY ; } else { ldp_sync_info -> metric [ 0 ] = circuit -> metric [ 0 ] ; circuit -> metric [ 0 ] = ISIS_NARROW_METRIC_INFINITY ; } } if ( circuit -> is_type & IS_LEVEL_2 ) { if ( circuit -> area -> newmetric ) { ldp_sync_info -> metric [ 1 ] = circuit -> te_metric [ 1 ] ; circuit -> te_metric [ 1 ] = ISIS_WIDE_METRIC_INFINITY ; } else { ldp_sync_info -> metric [ 1 ] = circuit -> metric [ 1 ] ; circuit -> metric [ 1 ] = ISIS_NARROW_METRIC_INFINITY ; } } } else { if ( ! CHECK_FLAG ( ldp_sync_info -> flags , LDP_SYNC_FLAG_SET_METRIC ) ) { return ; } UNSET_FLAG ( ldp_sync_info -> flags , LDP_SYNC_FLAG_SET_METRIC ) ; if ( circuit -> is_type & IS_LEVEL_1 ) { circuit -> te_metric [ 0 ] = ldp_sync_info -> metric [ 0 ] ; circuit -> metric [ 0 ] = ldp_sync_info -> metric [ 0 ] ; } if ( circuit -> is_type & IS_LEVEL_2 ) { circuit -> te_metric [ 1 ] = ldp_sync_info -> metric [ 1 ] ; circuit -> metric [ 1 ] = ldp_sync_info -> metric [ 1 ] ; } } if ( run_regen ) { lsp_regenerate_schedule ( circuit -> area , circuit -> is_type , 0 ) ; } } 