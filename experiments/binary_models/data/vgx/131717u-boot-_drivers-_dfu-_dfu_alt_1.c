int dfu_write_by_name ( char * dfu_entity_name , void * addr , unsigned int len , char * interface , char * devstring ) { char * s , * sb ; int alt_setting_num , ret ; struct dfu_entity * dfu ; debug ( "%s: name: %s addr: 0x%p len: %d device: %s:%s\n" , __func__ , dfu_entity_name , addr , len , interface , devstring ) ; ret = dfu_init_env_entities ( interface , devstring ) ; if ( ret ) { done } s = strdup ( dfu_entity_name ) ; sb = s ; if ( ! s ) { ret = - ENOMEM ; done } strsep ( & s , "@" ) ; debug ( "%s: image name: %s strlen: %zd\n" , __func__ , sb , strlen ( sb ) ) ; alt_setting_num = dfu_get_alt ( sb ) ; if ( alt_setting_num < 0 ) { pr_err ( "Alt setting [%d] to write not found!" , alt_setting_num ) ; ret = - ENODEV ; done } dfu = dfu_get_entity ( alt_setting_num ) ; if ( ! dfu ) { pr_err ( "DFU entity for alt: %d not found!" , alt_setting_num ) ; ret = - ENODEV ; done } ret = dfu_write_from_mem_addr ( dfu , ( void * ) addr , len ) ; done dfu_free_entities ( ) ; return ret ; } 