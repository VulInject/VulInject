static DEVICE_ATTR_RO ( temp_deactivated ) ; static ssize_t caps_show ( struct device * dev , struct device_attribute * attr , char * buf ) { struct tpm_chip * chip = to_tpm_chip ( dev ) ; cap_t cap ; ssize_t rc ; char * str = buf ; rc = tpm_getcap ( chip , TPM_CAP_PROP_MANUFACTURER , & cap , "attempting to determine the manufacturer" , sizeof ( cap . manufacturer_id ) ) ; str += sprintf ( str , "Manufacturer: 0x%x\n" , be32_to_cpu ( cap . manufacturer_id ) ) ; rc = tpm_getcap ( chip , TPM_CAP_VERSION_1_2 , & cap , "attempting to determine the 1.2 version" , sizeof ( cap . tpm_version_1_2 ) ) ; if ( ! rc ) { str += sprintf ( str , "TCG version: %d.%d\nFirmware version: %d.%d\n" , cap . tpm_version_1_2 . Major , cap . tpm_version_1_2 . Minor , cap . tpm_version_1_2 . revMajor , cap . tpm_version_1_2 . revMinor ) ; } else { rc = tpm_getcap ( chip , TPM_CAP_VERSION_1_1 , & cap , "attempting to determine the 1.1 version" , sizeof ( cap . tpm_version ) ) ; if ( rc ) { return 0 ; } str += sprintf ( str , "TCG version: %d.%d\nFirmware version: %d.%d\n" , cap . tpm_version . Major , cap . tpm_version . Minor , cap . tpm_version . revMajor , cap . tpm_version . revMinor ) ; } return str - buf ; } 