static int ac100_clkout_determine_rate ( struct clk_hw * hw , struct clk_rate_request * req ) { struct clk_hw * best_parent ; unsigned long best = 0 ; int i , num_parents = clk_hw_get_num_parents ( hw ) ; for ( i = 0 ; i < num_parents ; i ++ ) { struct clk_hw * parent = clk_hw_get_parent_by_index ( hw , i ) ; unsigned long tmp , prate = clk_hw_get_rate ( parent ) ; tmp = ac100_clkout_round_rate ( hw , req -> rate , prate ) ; if ( req -> rate - tmp < req -> rate - best ) { best = tmp ; best_parent = parent ; } } if ( ! best ) { return - EINVAL ; } req -> best_parent_hw = best_parent ; req -> best_parent_rate = best ; req -> rate = best ; return 0 ; } 