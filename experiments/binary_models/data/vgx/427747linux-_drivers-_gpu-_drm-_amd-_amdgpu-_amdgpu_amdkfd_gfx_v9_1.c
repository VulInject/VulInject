int kgd_gfx_v9_hqd_dump ( amdgpu_device * adev , uint32_t pipe_id , uint32_t queue_id , uint32_t ( * * dump ) [ 2 ] , uint32_t * n_regs ) ( uint32_t i = 0 , reg , ( WARN_ON_ONCE ( i >= HQD_N_REGS ) ) break ; ) ; ( * dump ) [ i ] [ 0 ] = ( addr ) << 2 ; ( * dump ) [ i ++ ] [ 1 ] = RREG32 ( addr ) ; ( 0 ) * dump = kmalloc_array ( HQD_N_REGS * 2 , sizeof ( uint32_t ) , GFP_KERNEL ) ; acquire_queue ( adev , pipe_id , queue_id ) ; for ( reg = SOC15_REG_OFFSET ( GC , 0 , mmCP_MQD_BASE_ADDR ) ; reg <= SOC15_REG_OFFSET ( GC , 0 , mmCP_HQD_PQ_WPTR_HI ) ; reg ++ ) { DUMP_REG ( reg ) ; } release_queue ( adev ) ; WARN_ON_ONCE ( i != HQD_N_REGS ) ; * n_regs = i ; return 0 ; 