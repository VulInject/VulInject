void sv_ev_bookmark_autojoin ( Bookmark * bookmark ) { if ( bookmark_ignored ( bookmark ) ) { return ; } char * nick = NULL ; if ( bookmark -> nick ) { nick = strdup ( bookmark -> nick ) ; } else { char * account_name = session_get_account_name ( ) ; ProfAccount * account = accounts_get_account ( account_name ) ; nick = strdup ( account -> muc_nick ) ; account_free ( account ) ; } log_debug ( "Autojoin %s with nick=%s" , bookmark -> barejid , nick ) ; if ( ! muc_active ( bookmark -> barejid ) ) { presence_join_room ( bookmark -> barejid , nick , bookmark -> password ) ; muc_join ( bookmark -> barejid , nick , bookmark -> password , TRUE ) ; iq_room_affiliation_list ( bookmark -> barejid , "member" , false ) ; iq_room_affiliation_list ( bookmark -> barejid , "admin" , false ) ; iq_room_affiliation_list ( bookmark -> barejid , "owner" , false ) ; } } 