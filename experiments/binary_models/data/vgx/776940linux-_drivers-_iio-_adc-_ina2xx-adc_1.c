static int ina2xx_work_buffer ( struct iio_dev * indio_dev ) { struct ina2xx_chip_info * chip = iio_priv ( indio_dev ) ; int bit , ret , i = 0 ; s64 time ; time = iio_get_time_ns ( indio_dev ) ; for_each_set_bit ( , , ) { int val ; ret = regmap_read ( chip -> regmap , INA2XX_SHUNT_VOLTAGE + bit , & val ) ; if ( ret < 0 ) { return ret ; } chip -> scan . chan [ i ++ ] = val ; } iio_push_to_buffers_with_timestamp ( indio_dev , & chip -> scan , time ) ; return 0 ; } 