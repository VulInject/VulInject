static int mvgroup ( message_data_t * msg ) { int r ; size_t len ; char * group ; char oldmailboxname [ MAX_MAILBOX_BUFFER ] ; char newmailboxname [ MAX_MAILBOX_BUFFER ] ; struct mbentry_t * mbentry = NULL ; group = msg -> control + 7 ; while ( Uisspace ( * group ) ) { group ++ ; } len = strcspn ( group , " \t\r\n" ) ; sprintf ( oldmailboxname , "%s%.*s" , newsprefix , ( int ) len , group ) ; group += len ; while ( Uisspace ( * group ) ) { group ++ ; } len = strcspn ( group , " \t\r\n" ) ; snprintf ( newmailboxname , sizeof ( newmailboxname ) , "%s%.*s" , newsprefix , ( int ) len , group ) ; r = proxy_mlookup ( oldmailboxname , & mbentry , NULL , NULL ) ; if ( r ) { return r ; } r = mboxlist_renamemailbox ( mbentry , newmailboxname , NULL , 0 , newsmaster , newsmaster_authstate , 0 , 0 , 0 , 0 , 0 ) ; mboxlist_entry_free ( & mbentry ) ; sync_checkpoint ( nntp_in ) ; return r ; } 