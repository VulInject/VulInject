struct vsp1_hgt * vsp1_hgt_create ( struct vsp1_device * vsp1 ) { struct vsp1_hgt * hgt ; int ret ; hgt = devm_kzalloc ( vsp1 -> dev , sizeof ( * hgt ) , GFP_KERNEL ) ; v4l2_ctrl_handler_init ( & hgt -> ctrls , 1 ) ; v4l2_ctrl_new_custom ( & hgt -> ctrls , & hgt_hue_areas , NULL ) ; hgt -> histo . entity . subdev . ctrl_handler = & hgt -> ctrls ; ret = vsp1_histogram_init ( vsp1 , & hgt -> histo , VSP1_ENTITY_HGT , "hgt" , & hgt_entity_ops , hgt_mbus_formats , ARRAY_SIZE ( hgt_mbus_formats ) , HGT_DATA_SIZE , V4L2_META_FMT_VSP1_HGT ) ; if ( ret < 0 ) { vsp1_entity_destroy ( & hgt -> histo . entity ) ; return ERR_PTR ( ret ) ; } v4l2_ctrl_handler_setup ( & hgt -> ctrls ) ; return hgt ; } 