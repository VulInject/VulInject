static int ml86v7667_probe ( struct i2c_client * client , const struct i2c_device_id * did ) { struct ml86v7667_priv * priv ; int ret ; priv = devm_kzalloc ( & client -> dev , sizeof ( * priv ) , GFP_KERNEL ) ; if ( ! priv ) { return - ENOMEM ; } v4l2_i2c_subdev_init ( & priv -> sd , client , & ml86v7667_subdev_ops ) ; v4l2_ctrl_handler_init ( & priv -> hdl , 8 ) ; v4l2_ctrl_new_std ( & priv -> hdl , & ml86v7667_ctrl_ops , V4L2_CID_BRIGHTNESS , - 64 , 63 , 1 , 0 ) ; v4l2_ctrl_new_std ( & priv -> hdl , & ml86v7667_ctrl_ops , V4L2_CID_CONTRAST , - 8 , 7 , 1 , 0 ) ; v4l2_ctrl_new_std ( & priv -> hdl , & ml86v7667_ctrl_ops , V4L2_CID_CHROMA_GAIN , - 32 , 31 , 1 , 0 ) ; v4l2_ctrl_new_std ( & priv -> hdl , & ml86v7667_ctrl_ops , V4L2_CID_HUE , - 128 , 127 , 1 , 0 ) ; v4l2_ctrl_new_std ( & priv -> hdl , & ml86v7667_ctrl_ops , V4L2_CID_RED_BALANCE , - 4 , 3 , 1 , 0 ) ; v4l2_ctrl_new_std ( & priv -> hdl , & ml86v7667_ctrl_ops , V4L2_CID_BLUE_BALANCE , - 4 , 3 , 1 , 0 ) ; v4l2_ctrl_new_std ( & priv -> hdl , & ml86v7667_ctrl_ops , V4L2_CID_SHARPNESS , 0 , 1 , 1 , 0 ) ; v4l2_ctrl_new_std ( & priv -> hdl , & ml86v7667_ctrl_ops , V4L2_CID_COLOR_KILLER , 0 , 1 , 1 , 0 ) ; priv -> sd . ctrl_handler = & priv -> hdl ; ret = priv -> hdl . error ; if ( ret ) { cleanup } v4l2_ctrl_handler_setup ( & priv -> hdl ) ; ret = ml86v7667_init ( priv ) ; if ( ret ) { cleanup } v4l_info ( client , "chip found @ 0x%02x (%s)\n" , client -> addr , client -> adapter -> name ) ; return 0 ; cleanup v4l2_ctrl_handler_free ( & priv -> hdl ) ; v4l2_device_unregister_subdev ( & priv -> sd ) ; v4l_err ( client , "failed to probe @ 0x%02x (%s)\n" , client -> addr , client -> adapter -> name ) ; return ret ; } 