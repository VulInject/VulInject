static int cxd2841er_tune_tc ( struct dvb_frontend * fe , bool re_tune , unsigned int mode_flags , unsigned int * delay , enum fe_status * status ) { int ret , carrier_offset ; struct cxd2841er_priv * priv = fe -> demodulator_priv ; struct dtv_frontend_properties * p = & fe -> dtv_property_cache ; dev_dbg ( & priv -> i2c -> dev , "%s(): re_tune %d bandwidth=%d\n" , __func__ , re_tune , p -> bandwidth_hz ) ; if ( re_tune ) { ret = cxd2841er_set_frontend_tc ( fe ) ; cxd2841er_read_status_tc ( fe , status ) ; if ( * status & FE_HAS_LOCK ) { switch ( priv -> system ) { case SYS_ISDBT : ret = cxd2841er_get_carrier_offset_i ( priv , p -> bandwidth_hz , & carrier_offset ) ; if ( ret ) { return ret ; } break ; case SYS_DVBT : ret = cxd2841er_get_carrier_offset_t ( priv , p -> bandwidth_hz , & carrier_offset ) ; if ( ret ) { return ret ; } break ; case SYS_DVBT2 : ret = cxd2841er_get_carrier_offset_t2 ( priv , p -> bandwidth_hz , & carrier_offset ) ; if ( ret ) { return ret ; } break ; case SYS_DVBC_ANNEX_A : ret = cxd2841er_get_carrier_offset_c ( priv , & carrier_offset ) ; if ( ret ) { return ret ; } break ; default : dev_dbg ( & priv -> i2c -> dev , "%s(): invalid delivery system %d\n" , __func__ , priv -> system ) ; return - EINVAL ; } dev_dbg ( & priv -> i2c -> dev , "%s(): carrier offset %d\n" , __func__ , carrier_offset ) ; p -> frequency += carrier_offset ; ret = cxd2841er_set_frontend_tc ( fe ) ; if ( ret ) { return ret ; } } } * delay = HZ / 5 ; return cxd2841er_read_status_tc ( fe , status ) ; } 