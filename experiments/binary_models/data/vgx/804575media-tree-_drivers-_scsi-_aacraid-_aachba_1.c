static int aac_write_block64 ( struct fib * fib , struct scsi_cmnd * cmd , u64 lba , u32 count , int fua ) { u16 fibsize ; struct aac_write64 * writecmd ; long ret ; aac_fib_init ( fib ) ; writecmd = ( aac_write64 * ) fib_data ( fib ) ; writecmd -> command = cpu_to_le32 ( VM_CtHostWrite64 ) ; writecmd -> cid = cpu_to_le16 ( scmd_id ( cmd ) ) ; writecmd -> sector_count = cpu_to_le16 ( count ) ; writecmd -> block = cpu_to_le32 ( ( u32 ) ( lba & 0xffffffff ) ) ; writecmd -> pad = 0 ; writecmd -> flags = 0 ; ret = aac_build_sg64 ( cmd , & writecmd -> sg ) ; fibsize = sizeof ( aac_write64 ) + ( ( le32_to_cpu ( writecmd -> sg . count ) - 1 ) * sizeof ( sgentry64 ) ) ; BUG_ON ( fibsize > ( fib -> dev -> max_fib_size - sizeof ( aac_fibhdr ) ) ) ; return aac_fib_send ( ContainerCommand64 , fib , fibsize , FsaNormal , 0 , 1 , ( fib_callback ) io_callback , ( void * ) cmd ) ; } 