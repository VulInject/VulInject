struct i2c_mux_core * i2c_mux_alloc ( struct i2c_adapter * parent , struct device * dev , int max_adapters , int sizeof_priv , u32 flags , int * select ( struct i2c_mux_core * , u32 ) , int * deselect ( struct i2c_mux_core * , u32 ) ) { struct i2c_mux_core * muxc ; size_t mux_size ; mux_size = struct_size ( muxc , adapter , max_adapters ) ; muxc = devm_kzalloc ( dev , size_add ( mux_size , sizeof_priv ) , GFP_KERNEL ) ; if ( ! muxc ) { return in ; } if ( sizeof_priv ) { muxc -> priv = & muxc -> adapter [ max_adapters ] ; } muxc -> parent = parent ; muxc -> dev = dev ; if ( flags & I2C_MUX_LOCKED ) { muxc -> mux_locked = true ; } if ( flags & I2C_MUX_ARBITRATOR ) { muxc -> arbitrator = true ; } if ( flags & I2C_MUX_GATE ) { muxc -> gate = true ; } muxc -> select = select ; muxc -> deselect = deselect ; muxc -> max_adapters = max_adapters ; return muxc ; } 