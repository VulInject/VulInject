void libxsmm_x86_instruction_mask_compute_reg ( libxsmm_generated_code * io_generated_code , const unsigned int i_mask_instr , const unsigned int i_mask_reg_number_src_0 , const unsigned int i_mask_reg_number_src_1 , const unsigned int i_mask_reg_number_dest , const unsigned int i_imm8 ) { switch ( i_mask_instr ) { case LIBXSMM_X86_INSTR_KADDB : case LIBXSMM_X86_INSTR_KADDW : case LIBXSMM_X86_INSTR_KADDD : case LIBXSMM_X86_INSTR_KADDQ : case LIBXSMM_X86_INSTR_KANDB : case LIBXSMM_X86_INSTR_KANDW : case LIBXSMM_X86_INSTR_KANDD : case LIBXSMM_X86_INSTR_KANDQ : case LIBXSMM_X86_INSTR_KANDNB : case LIBXSMM_X86_INSTR_KANDNW : case LIBXSMM_X86_INSTR_KANDND : case LIBXSMM_X86_INSTR_KANDNQ : case LIBXSMM_X86_INSTR_KNOTB : case LIBXSMM_X86_INSTR_KNOTW : case LIBXSMM_X86_INSTR_KNOTD : case LIBXSMM_X86_INSTR_KNOTQ : case LIBXSMM_X86_INSTR_KORB : case LIBXSMM_X86_INSTR_KORW : case LIBXSMM_X86_INSTR_KORD : case LIBXSMM_X86_INSTR_KORQ : case LIBXSMM_X86_INSTR_KORTESTB : case LIBXSMM_X86_INSTR_KORTESTW : case LIBXSMM_X86_INSTR_KORTESTD : case LIBXSMM_X86_INSTR_KORTESTQ : case LIBXSMM_X86_INSTR_KSHIFTLB : case LIBXSMM_X86_INSTR_KSHIFTLW : case LIBXSMM_X86_INSTR_KSHIFTLD : case LIBXSMM_X86_INSTR_KSHIFTLQ : case LIBXSMM_X86_INSTR_KSHIFTRB : case LIBXSMM_X86_INSTR_KSHIFTRW : case LIBXSMM_X86_INSTR_KSHIFTRD : case LIBXSMM_X86_INSTR_KSHIFTRQ : case LIBXSMM_X86_INSTR_KTESTB : case LIBXSMM_X86_INSTR_KTESTW : case LIBXSMM_X86_INSTR_KTESTD : case LIBXSMM_X86_INSTR_KTESTQ : case LIBXSMM_X86_INSTR_KUNPCKBW : case LIBXSMM_X86_INSTR_KUNPCKWD : case LIBXSMM_X86_INSTR_KUNPCKDQ : case LIBXSMM_X86_INSTR_KXNORB : case LIBXSMM_X86_INSTR_KXNORW : case LIBXSMM_X86_INSTR_KXNORD : case LIBXSMM_X86_INSTR_KXNORQ : case LIBXSMM_X86_INSTR_KXORB : case LIBXSMM_X86_INSTR_KXORW : case LIBXSMM_X86_INSTR_KXORD : case LIBXSMM_X86_INSTR_KXORQ : break ; default : fprintf ( stderr , "libxsmm_x86_instruction_mask_compute_reg: unexpected instruction number: 0x%08x\n" , i_mask_instr ) ; LIBXSMM_EXIT_ERROR ( io_generated_code , NULL ) ; return ; } if ( io_generated_code -> code_type > 1 ) { const libxsmm_x86_simd_name l_vname = ( ( i_mask_instr & 0x300 ) == 0x300 ) ?LIBXSMM_X86_SIMD_NAME_YMM : LIBXSMM_X86_SIMD_NAME_XMM ; unsigned int l_src1 = 0 ; if ( ( ( i_mask_instr >> 28 ) & 3 ) == 2 ) { if ( i_mask_reg_number_src_1 != LIBXSMM_X86_VEC_REG_UNDEF ) { fprintf ( stderr , "libxsmm_x86_instruction_mask_compute_reg: In case of a 1 src operand instruction (0x%08x), i_reg_number_src1 needs to be LIBXSMM_X86_VEC_REG_UNDEF!\n" , i_mask_instr ) ; LIBXSMM_EXIT_ERROR ( io_generated_code ) ; return ; } l_src1 = 0 ; } else { if ( i_mask_reg_number_src_1 == LIBXSMM_X86_VEC_REG_UNDEF ) { fprintf ( stderr , "libxsmm_x86_instruction_mask_compute_reg: In case of a 2 src operand instruction (0x%08x), i_reg_number_src1 cannot be LIBXSMM_X86_VEC_REG_UNDEF!\n" , i_mask_instr ) ; LIBXSMM_EXIT_ERROR ( io_generated_code ) ; return ; } else { l_src1 = i_mask_reg_number_src_1 ; } } libxsmm_x86_instruction_vex_compute_3reg ( io_generated_code , i_mask_instr , l_vname , i_mask_reg_number_src_0 , l_src1 , i_mask_reg_number_dest ) ; if ( ( ( i_mask_instr >> 16 ) & 0x08 ) == 0x08 ) { if ( i_imm8 != LIBXSMM_X86_IMM_UNDEF ) { unsigned char * code = ( unsigned char * ) io_generated_code -> generated_code ; code [ io_generated_code -> code_size ++ ] = ( unsigned char ) i_imm8 ; } else { fprintf ( stderr , "libxsmm_x86_instruction_mask_compute_reg: imm8 required by instr, but LIBXSMM_X86_IMM_UNDEF was provided!\n" ) ; LIBXSMM_EXIT_ERROR ( io_generated_code ) ; return ; } } } else { char l_new_code [ 512 ] ; int l_max_code_length = 511 ; int l_code_length = 0 ; char l_instr_name [ 16 ] ; libxsmm_get_x86_instr_name ( i_mask_instr , l_instr_name , 15 ) ; if ( io_generated_code -> code_type == 0 ) { l_code_length = LIBXSMM_SNPRINTF ( l_new_code , l_max_code_length , "                       \"%s %%%%k%u, %%%%k%u, %%%%k%u\\n\\t\"\n" , l_instr_name , i_mask_reg_number_src_0 , i_mask_reg_number_src_1 , i_mask_reg_number_dest ) ; } else { l_code_length = LIBXSMM_SNPRINTF ( l_new_code , l_max_code_length , "                       %s %%k%u, %%k%u, %%k%u\n" , l_instr_name , i_mask_reg_number_src_0 , i_mask_reg_number_src_1 , i_mask_reg_number_dest ) ; } libxsmm_append_code_as_string ( io_generated_code , l_new_code , l_code_length ) ; } } 