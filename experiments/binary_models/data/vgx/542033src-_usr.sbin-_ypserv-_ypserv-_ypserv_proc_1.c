ypresp_xfr * ypproc_xfr_2_svc ( ypreq_xfr * argp , struct svc_req * rqstp ) { static ypresp_xfr res ; struct sockaddr_in * caller = svc_getcaller ( rqstp -> rq_xprt ) ; int ok = acl_check_host ( & caller -> sin_addr ) ; pid_t pid ; char tid [ 11 ] , prog [ 11 ] , port [ 11 ] ; char ypxfr_proc [ ] YPXFR_PROC ; , * ipadd ; bzero ( & res , sizeof ( res ) ) ; YPLOG ( "xfr_2: caller=[%s].%d, auth_ok=%s, domain=%s, tid=%d, prog=%d" , inet_ntoa ( caller -> sin_addr ) , ntohs ( caller -> sin_port ) , TORF ( ok ) , argp -> map_parms . domain , argp -> transid , argp -> prog ) ; YPLOG ( "       ipadd=%s, port=%d, map=%s" , inet_ntoa ( caller -> sin_addr ) , argp -> port , argp -> map_parms . map ) ; if ( strchr ( argp -> map_parms . domain , '/' ) || strchr ( argp -> map_parms . map , '/' ) || ntohs ( caller -> sin_port ) >= IPPORT_RESERVED ) { svcerr_auth ( rqstp -> rq_xprt , AUTH_FAILED ) ; return ( NULL ) ; } sprintf ( tid , "%d" , argp -> transid ) ; snprintf ( prog , sizeof ( prog ) , "%d" , argp -> prog ) ; snprintf ( port , sizeof ( port ) , "%d" , argp -> port ) ; ipadd = inet_ntoa ( caller -> sin_addr ) ; pid = vfork ( ) ; if ( pid == - 1 ) { svcerr_systemerr ( rqstp -> rq_xprt ) ; return ( NULL ) ; } if ( pid == 0 ) { execl ( ypxfr_proc , "ypxfr" , "-d" , argp -> map_parms . domain , "-C" , tid , prog , ipadd , port , argp -> map_parms . map , ( char * ) NULL ) ; _exit ( 1 ) ; } return ( & res ) ; } 