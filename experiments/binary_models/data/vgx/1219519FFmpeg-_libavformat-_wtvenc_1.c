static void write_table_entries_attrib ( AVFormatContext * s ) { WtvContext * wctx = s -> priv_data ; AVIOContext * pb = s -> pb ; const AVDictionaryEntry * tag = NULL ; ff_standardize_creation_time ( s , NULL ) ; ff_metadata_conv ( & s -> metadata , ff_asf_metadata_conv , NULL ) ; while ( ( tag = av_dict_iterate ( s -> metadata , tag ) ) ) { write_tag ( pb , tag -> key , tag -> value ) ; } if ( wctx -> thumbnail . size ) { AVStream * st = s -> streams [ wctx -> thumbnail . stream_index ] ; tag = av_dict_get ( st -> metadata , "title" , NULL , 0 ) ; write_metadata_header ( pb , 2 , "WM/Picture" , attachment_value_size ( & wctx -> thumbnail , tag ) ) ; avio_put_str16le ( pb , "image/jpeg" ) ; avio_w8 ( pb , 0x10 ) ; avio_put_str16le ( pb , tag ?tag -> value : "" ) ; avio_wl32 ( pb , wctx -> thumbnail . size ) ; avio_write ( pb , wctx -> thumbnail . data , wctx -> thumbnail . size ) ; write_tag_int32 ( pb , "WM/MediaThumbType" , 2 ) ; } } 