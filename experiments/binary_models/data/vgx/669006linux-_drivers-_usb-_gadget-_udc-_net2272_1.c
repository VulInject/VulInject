static int net2272_wakeup ( struct usb_gadget * _gadget ) { struct net2272 * dev ; u8 tmp ; unsigned long flags ; dev = container_of ( _gadget , net2272 , gadget ) ; spin_lock_irqsave ( & dev -> lock , flags ) ; tmp = net2272_read ( dev , USBCTL0 ) ; if ( tmp & ( 1 << IO_WAKEUP_ENABLE ) ) { net2272_write ( dev , USBCTL1 , ( 1 << GENERATE_RESUME ) ) ; } spin_unlock_irqrestore ( & dev -> lock , flags ) ; return 0 ; } 