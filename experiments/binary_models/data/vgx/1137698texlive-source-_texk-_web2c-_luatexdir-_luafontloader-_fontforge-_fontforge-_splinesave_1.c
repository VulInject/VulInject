static void BreakSubroutine ( GrowBuf * gb , struct hintdb * hdb ) { GlyphInfo * gi ; struct potentialsubrs * ps ; int hash ; int pi ; if ( hdb == NULL ) { return ; } gi = hdb -> gi ; if ( gi == NULL ) { return ; } if ( gi -> bcnt == - 1 ) { gi -> bcnt = 0 ; gi -> justbroken = true ; return ; } if ( gi -> justbroken ) { return ; } hash = hashfunc ( gb -> base , gb -> pt - gb -> base ) ; ps = NULL ; for ( pi = gi -> hashed [ hash ] ; pi != - 1 ; pi = gi -> psubrs [ pi ] . next ) { ps = & gi -> psubrs [ pi ] ; if ( ps -> len == gb -> pt - gb -> base && memcmp ( ps -> data , gb -> base , gb -> pt - gb -> base ) == 0 ) { break ; } } if ( pi == - 1 ) { if ( gi -> pcnt >= gi -> pmax ) { gi -> psubrs = grealloc ( gi -> psubrs , ( gi -> pmax += gi -> glyphcnt ) * sizeof ( potentialsubrs ) ) ; } ps = & gi -> psubrs [ gi -> pcnt ] ; ps -> idx = gi -> pcnt ++ ; ps -> len = gb -> pt - gb -> base ; ps -> data = galloc ( ps -> len ) ; memcpy ( ps -> data , gb -> base , ps -> len ) ; ps -> next = gi -> hashed [ hash ] ; gi -> hashed [ hash ] = ps -> idx ; ps -> fd = gi -> active -> fd ; ps -> full_glyph_index = - 1 ; } if ( ps -> fd != gi -> active -> fd ) { ps -> fd = - 1 ; } gi -> bits [ gi -> bcnt ] . psub_index = ps -> idx ; ++ ps -> cnt ; gb -> pt = gb -> base ; ++ gi -> bcnt ; gi -> justbroken = true ; } 