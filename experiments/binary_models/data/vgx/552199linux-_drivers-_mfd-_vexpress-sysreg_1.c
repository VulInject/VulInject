static int vexpress_sysreg_probe ( struct platform_device * pdev ) { struct resource * mem ; void __iomem * base ; struct gpio_chip * mmc_gpio_chip ; mem = platform_get_resource ( pdev , IORESOURCE_MEM , 0 ) ; base = devm_ioremap ( & pdev -> dev , mem -> start , resource_size ( mem ) ) ; if ( ! base ) { return - ENOMEM ; } mmc_gpio_chip = devm_kzalloc ( & pdev -> dev , sizeof ( * mmc_gpio_chip ) , GFP_KERNEL ) ; if ( ! mmc_gpio_chip ) { return - ENOMEM ; } bgpio_init ( mmc_gpio_chip , & pdev -> dev , 0x4 , base + SYS_MCI , NULL , NULL , NULL , NULL , 0 ) ; mmc_gpio_chip -> ngpio = 2 ; devm_gpiochip_add_data ( & pdev -> dev , mmc_gpio_chip , NULL ) ; return devm_mfd_add_devices ( & pdev -> dev , PLATFORM_DEVID_AUTO , vexpress_sysreg_cells , ARRAY_SIZE ( vexpress_sysreg_cells ) , mem , 0 , NULL ) ; } static const struct of_device_id vexpress_sysreg_match [ ] { { . compatible = "arm,vexpress-sysreg" } { } } ; ; 