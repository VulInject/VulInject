static int cpdma_chan_set_chan_shaper ( struct cpdma_chan * chan ) { struct cpdma_ctlr * ctlr = chan -> ctlr ; u32 rate_reg ; u32 rmask ; int ret ; rate_reg = CPDMA_TX_PRI0_RATE + 4 * chan -> chan_num ; dma_reg_write ( ctlr , rate_reg , chan -> rate_factor ) ; rmask = _cpdma_control_get ( ctlr , CPDMA_TX_RLIM ) ; rmask |= chan -> mask ; ret = _cpdma_control_set ( ctlr , CPDMA_TX_RLIM , rmask ) ; return ret ; } 