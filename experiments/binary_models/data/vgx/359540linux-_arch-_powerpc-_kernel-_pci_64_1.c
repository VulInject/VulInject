void __iomem * ioremap_phb ( phys_addr_t paddr , unsigned long size ) { struct vm_struct * area ; unsigned long addr ; WARN_ON_ONCE ( paddr & ~ PAGE_MASK ) ; WARN_ON_ONCE ( size & ~ PAGE_MASK ) ; area = __get_vm_area_caller ( size , VM_IOREMAP , PHB_IO_BASE , PHB_IO_END , __builtin_return_address ( 0 ) ) ; if ( ! area ) { return in ; } addr = ( unsigned long ) area -> addr ; if ( ioremap_page_range ( addr , addr + size , paddr , pgprot_noncached ( PAGE_KERNEL ) ) ) { vunmap_range ( addr , addr + size ) ; return NULL ; } return ( void __iomem * ) addr ; } 