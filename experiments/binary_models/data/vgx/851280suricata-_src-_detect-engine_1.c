void DetectEngineAppInspectionEngineSignatureFree ( DetectEngineCtx * de_ctx , Signature * s ) { int nlists = 0 ; DetectEngineAppInspectionEngine * ie = s -> app_inspect ; while ( ie ) { nlists = MAX ( ie -> sm_list + 1 , nlists ) ; ie = ie -> next ; } DetectEnginePktInspectionEngine * e = s -> pkt_inspect ; while ( e ) { nlists = MAX ( e -> sm_list + 1 , nlists ) ; e = e -> next ; } DetectEngineFrameInspectionEngine * u = s -> frame_inspect ; while ( u ) { nlists = MAX ( u -> sm_list + 1 , nlists ) ; u = u -> next ; } if ( nlists == 0 ) { BUG_ON ( s -> pkt_inspect ) ; BUG_ON ( s -> frame_inspect ) ; return ; } SigMatchData * ptrs [ nlists ] ; ie = s -> app_inspect ; while ( ie ) { DetectEngineAppInspectionEngine * next = ie -> next ; BUG_ON ( ptrs [ ie -> sm_list ] != NULL && ptrs [ ie -> sm_list ] != ie -> smd ) ; ptrs [ ie -> sm_list ] = ie -> smd ; SCFree ( ie ) ; ie = next ; } e = s -> pkt_inspect ; while ( e ) { DetectEnginePktInspectionEngine * next = e -> next ; ptrs [ e -> sm_list ] = e -> smd ; SCFree ( e ) ; e = next ; } u = s -> frame_inspect ; while ( u ) { DetectEngineFrameInspectionEngine * next = u -> next ; ptrs [ u -> sm_list ] = u -> smd ; SCFree ( u ) ; u = next ; } for ( int i = 0 ; i < nlists ; i ++ ) { if ( ptrs [ i ] == NULL ) { continue ; } SigMatchData * smd = ptrs [ i ] ; while ( 1 ) { if ( sigmatch_table [ smd -> type ] . Free != NULL ) { sigmatch_table [ smd -> type ] . Free ( de_ctx , smd -> ctx ) ; } if ( smd -> is_last ) { break ; } smd ++ ; } SCFree ( ptrs [ i ] ) ; } } static HashListTable * g_buffer_type_hash = NULL ; static int g_buffer_type_id = DETECT_SM_LIST_DYNAMIC_START ; static int g_buffer_type_reg_closed = 0 ; int DetectBufferTypeMaxId ( void ) { return g_buffer_type_id ; } 