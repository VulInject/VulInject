static kstat_t * pcmu_create_picN_kstat ( char * mod_name , int pic , int pic_shift , int num_ev , pcmu_kev_mask_t * ev_array ) { struct kstat_named * pic_named_data ; int inst = 0 ; int event ; char pic_name [ 30 ] ; kstat_t * picN_ksp ; ( void ) sprintf ( pic_name , "pic%d" , pic ) ; if ( ( picN_ksp = kstat_create ( mod_name , inst , pic_name , "bus" , KSTAT_TYPE_NAMED , num_ev , 0 ) ) == NULL ) { cmn_err ( CE_WARN , "%s %s : kstat create failed" , mod_name , pic_name ) ; return ( NULL ) ; } pic_named_data = ( kstat_named * ) picN_ksp -> ks_data ; for ( event = 0 ; event < num_ev - 1 ; event ++ ) { pic_named_data [ event ] . value . ui64 = ( ev_array [ event ] . pcr_mask << pic_shift ) ; kstat_named_init ( & pic_named_data [ event ] , ev_array [ event ] . event_name , KSTAT_DATA_UINT64 ) ; } pic_named_data [ event ] . value . ui64 = ( uint64_t ) ~ ( ev_array [ event ] . pcr_mask << pic_shift ) ; kstat_named_init ( & pic_named_data [ event ] , ev_array [ event ] . event_name , KSTAT_DATA_UINT64 ) ; kstat_install ( picN_ksp ) ; return ( picN_ksp ) ; } 