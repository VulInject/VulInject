static void test_simple ( int pagemap_fd , int pagesize ) { int i ; char * map ; map = aligned_alloc ( pagesize , pagesize ) ; if ( ! map ) { ksft_exit_fail_msg ( "mmap failed\n" ) ; } clear_softdirty ( ) ; for ( i = 0 ; i < TEST_ITERATIONS ; i ++ ) { if ( pagemap_is_softdirty ( pagemap_fd , map ) == 1 ) { ksft_print_msg ( "dirty bit was 1, but should be 0 (i=%d)\n" , i ) ; break ; } clear_softdirty ( ) ; map [ 0 ] ++ ; if ( pagemap_is_softdirty ( pagemap_fd , map ) == 0 ) { ksft_print_msg ( "dirty bit was 0, but should be 1 (i=%d)\n" , i ) ; break ; } clear_softdirty ( ) ; } ksft_test_result ( i == TEST_ITERATIONS , "Test %s\n" , __func__ ) ; } 