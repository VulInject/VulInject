static int switch_drv_remove ( struct platform_device * pdev ) { struct push_switch * psw = platform_get_drvdata ( pdev ) ; struct push_switch_platform_info * psw_info = pdev -> dev . platform_data ; int irq = platform_get_irq ( pdev , 0 ) ; if ( psw_info -> name ) { device_remove_file ( & pdev -> dev , & dev_attr_switch ) ; } platform_set_drvdata ( pdev , NULL ) ; flush_work ( & psw -> work ) ; timer_shutdown_sync ( & psw -> debounce ) ; free_irq ( irq , pdev ) ; return 0 ; } 