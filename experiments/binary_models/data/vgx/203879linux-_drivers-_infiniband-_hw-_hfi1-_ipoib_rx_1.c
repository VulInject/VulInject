static struct sk_buff * prepare_frag_skb ( struct napi_struct * napi , int size ) { struct sk_buff * skb ; int skb_size = SKB_DATA_ALIGN ( size + HFI1_IPOIB_SKB_PAD ) ; void * frag ; skb_size += SKB_DATA_ALIGN ( sizeof ( skb_shared_info ) ) ; skb_size = SKB_DATA_ALIGN ( skb_size ) ; frag = napi_alloc_frag ( skb_size ) ; if ( unlikely ( ! frag ) ) { return napi_alloc_skb ( napi , size ) ; } skb = build_skb ( frag , skb_size ) ; if ( unlikely ( ! skb ) ) { return NULL ; } skb_reserve ( skb , HFI1_IPOIB_SKB_PAD ) ; return skb ; } 