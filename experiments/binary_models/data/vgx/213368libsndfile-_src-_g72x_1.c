g72x_write_i ( , , ) { BUF_UNION ubuf ; G72x_PRIVATE * pg72x ; short * sptr ; int k , bufferlen , writecount = 0 , count ; sf_count_t total = 0 ; pg72x = ( G72x_PRIVATE * ) psf -> codec_data ; sptr = ubuf . sbuf ; bufferlen = SF_BUFFER_LEN / sizeof ( short ) ; while ( len > 0 ) { writecount = ( len >= bufferlen ) ?bufferlen : ( int ) len ; for ( k = 0 ; k < writecount ; k ++ ) { sptr [ k ] = ptr [ total + k ] >> 16 ; } count = g72x_write_block ( psf , pg72x , sptr , writecount ) ; total += count ; len -= writecount ; if ( count != writecount ) { break ; } } return total ; } 