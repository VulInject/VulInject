static int paf_audio_decode ( AVCodecContext * avctx , AVFrame * frame , int * got_frame , AVPacket * pkt ) { int16_t * output_samples ; const uint8_t * src = pkt -> data ; int frames , ret , i , j ; int16_t cb [ 256 ] ; frames = pkt -> size / PAF_SOUND_FRAME_SIZE ; frame -> nb_samples = PAF_SOUND_SAMPLES * frames ; if ( ( ret = ff_get_buffer ( avctx , frame , 0 ) ) < 0 ) { return ret ; } output_samples = ( int16_t * ) frame -> data [ 0 ] ; for ( j = 0 ; j < frames ; j ++ ) { for ( i = 0 ; i < 256 ; i ++ ) { cb [ i ] = sign_extend ( AV_RL16 ( src + i * 2 ) , 16 ) ; } src += 256 * 2 ; for ( i = 0 ; i < PAF_SOUND_SAMPLES * 2 ; i ++ ) { * output_samples ++ = cb [ * src ++ ] ; } } * got_frame = 1 ; return pkt -> size ; } 