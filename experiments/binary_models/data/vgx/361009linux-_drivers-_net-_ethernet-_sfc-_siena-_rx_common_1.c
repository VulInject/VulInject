static struct page * efx_reuse_page ( struct efx_rx_queue * rx_queue ) { struct efx_nic * efx = rx_queue -> efx ; struct efx_rx_page_state * state ; unsigned int index ; struct page * page ; if ( unlikely ( ! rx_queue -> page_ring ) ) { return NULL ; } index = rx_queue -> page_remove & rx_queue -> page_ptr_mask ; page = rx_queue -> page_ring [ index ] ; rx_queue -> page_ring [ index ] = NULL ; if ( rx_queue -> page_remove != rx_queue -> page_add ) { ++ rx_queue -> page_remove ; } if ( page_count ( page ) == 1 ) { ++ rx_queue -> page_recycle_count ; return page ; } else { state = page_address ( page ) ; dma_unmap_page ( & efx -> pci_dev -> dev , state -> dma_addr , PAGE_SIZE << efx -> rx_buffer_order , DMA_FROM_DEVICE ) ; put_page ( page ) ; ++ rx_queue -> page_recycle_failed ; } return NULL ; } 