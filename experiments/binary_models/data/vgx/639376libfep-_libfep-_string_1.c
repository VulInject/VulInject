_fep_substring ( , , ) { const char * p ; char * mbs ; const wchar_t * q ; wchar_t * wcs ; size_t wcs_len ; int index ; p = str ; wcs = xcalloc ( strlen ( str ) + 1 , sizeof ( wchar_t ) ) ; wcs_len = mbsrtowcs ( wcs , & p , strlen ( str ) , NULL ) ; if ( wcs_len == ( size_t ) - 1 ) { fep_log ( FEP_LOG_LEVEL_WARNING , "can't convert string to wchar string" ) ; return NULL ; } if ( from > to ) { index = from ; from = to ; to = index ; } if ( from > wcs_len || to > wcs_len ) { free ( wcs ) ; fep_log ( FEP_LOG_LEVEL_WARNING , "invalid range" ) ; return NULL ; } wcs [ to ] = L '\0' ; q = & wcs [ from ] ; mbs = xcalloc ( strlen ( str ) + 1 , sizeof ( char ) ) ; wcsrtombs ( mbs , & q , strlen ( str ) , NULL ) ; free ( wcs ) ; return mbs ; } 