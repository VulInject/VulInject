static int cst3xx_firmware_info ( struct i2c_client * client ) { struct hynitron_ts_data * ts_data = i2c_get_clientdata ( client ) ; int err ; u32 tmp ; unsigned char buf [ 4 ] ; put_unaligned_le16 ( CST3XX_FIRMWARE_INFO_START_CMD , buf ) ; err = cst3xx_i2c_write ( client , buf , 2 ) ; usleep_range ( 10000 , 11000 ) ; err = cst3xx_i2c_read_register ( client , CST3XX_FIRMWARE_CHK_CODE_REG , buf , 4 ) ; if ( err ) { return err ; } tmp = get_unaligned_le32 ( buf ) ; if ( ( tmp & 0xffff0000 ) != ts_data -> chip -> ic_chkcode ) { dev_err ( & client -> dev , "%s ic mismatch, chkcode is %u\n" , __func__ , tmp ) ; return - ENODEV ; } usleep_range ( 10000 , 11000 ) ; err = cst3xx_i2c_read_register ( client , CST3XX_FIRMWARE_VERSION_REG , buf , 4 ) ; if ( err ) { return err ; } tmp = get_unaligned_le32 ( buf ) ; if ( tmp == CST3XX_FIRMWARE_VER_INVALID_VAL ) { dev_err ( & client -> dev , "Device firmware missing\n" ) ; return - ENODEV ; } put_unaligned_le16 ( CST3XX_FIRMWARE_INFO_END_CMD , buf ) ; err = cst3xx_i2c_write ( client , buf , 2 ) ; if ( err ) { return err ; } usleep_range ( 5000 , 6000 ) ; return 0 ; } 