static int emc_clk_change_notify ( struct notifier_block * nb , unsigned long msg , void * data ) { struct tegra_emc * emc = container_of ( nb , tegra_emc , clk_nb ) ; struct clk_notifier_data * cnd = data ; int err ; switch ( msg ) { case PRE_RATE_CHANGE : disable_irq ( emc -> irq , NULL ) ; err = emc_prepare_timing_change ( emc , cnd -> new_rate ) ; enable_irq ( emc -> irq ) ; break ; case ABORT_RATE_CHANGE : err = emc_unprepare_timing_change ( emc , cnd -> old_rate ) ; break ; case POST_RATE_CHANGE : err = emc_complete_timing_change ( emc , cnd -> new_rate ) ; break ; default : return NOTIFY_DONE ; } return notifier_from_errno ( err ) ; } 