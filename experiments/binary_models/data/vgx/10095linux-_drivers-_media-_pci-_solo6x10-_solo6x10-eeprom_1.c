int solo_eeprom_write ( struct solo_dev * solo_dev , int loc , __be16 data ) { int write_cmd = loc | ( EE_WRITE_CMD << ADDR_LEN ) ; unsigned int retval ; int i ; solo_eeprom_cmd ( solo_dev , write_cmd ) ; for ( i = 15 ; i >= 0 ; i -- ) { int dataval = ( ( __force unsigned ) data >> i ) & 1 ; solo_eeprom_reg_write ( solo_dev , EE_ENB ) ; solo_eeprom_reg_write ( solo_dev , EE_ENB | ( dataval << 1 ) | EE_SHIFT_CLK ) ; } solo_eeprom_reg_write ( solo_dev , EE_ENB ) ; solo_eeprom_reg_write ( solo_dev , ~ EE_CS ) ; solo_eeprom_reg_write ( solo_dev , EE_ENB ) ; for ( i = retval = 0 ; i < 10000 && ! retval ; i ++ ) { retval = solo_eeprom_reg_read ( solo_dev ) ; } solo_eeprom_reg_write ( solo_dev , ~ EE_CS ) ; return ! retval ; } 