static irqreturn_t bcm_uart_interrupt ( int irq , void * dev_id ) { struct uart_port * port ; int irqstat ; port = dev_id ; spin_lock ( & port -> lock ) ; irqstat = bcm_uart_readl ( port , UART_IR_REG ) ; if ( irqstat & UART_RX_INT_STAT ) { bcm_uart_do_rx ( port ) ; } if ( irqstat & UART_TX_INT_STAT ) { bcm_uart_do_tx ( port ) ; } if ( irqstat & UART_IR_MASK ( UART_IR_EXTIP ) ) { unsigned int estat ; estat = bcm_uart_readl ( port , UART_EXTINP_REG ) ; if ( estat & UART_EXTINP_IRSTAT ( UART_EXTINP_IR_CTS ) ) { uart_handle_cts_change ( port , estat & UART_EXTINP_CTS_MASK ) ; } if ( estat & UART_EXTINP_IRSTAT ( UART_EXTINP_IR_DCD ) ) { uart_handle_dcd_change ( port , estat & UART_EXTINP_DCD_MASK ) ; } } spin_unlock ( & port -> lock ) ; return IRQ_HANDLED ; } 