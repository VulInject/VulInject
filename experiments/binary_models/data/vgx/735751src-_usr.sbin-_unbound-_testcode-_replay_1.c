char * macro_process ( rbtree_type * store , struct replay_runtime * runtime , char * text ) { char buf [ 10240 ] ; char * next , * expand ; char * at = text ; if ( ! strstr ( text , "${" ) ) { return strdup ( text ) ; } buf [ 0 ] = 0 ; buf [ sizeof ( buf ) - 1 ] = 0 ; while ( ( next = strstr ( at , "${" ) ) ) { if ( ( size_t ) ( next - at ) >= sizeof ( buf ) - strlen ( buf ) ) { return NULL ; } ( void ) strlcpy ( buf + strlen ( buf ) , at , ( size_t ) ( next - at + 1 ) ) ; next += 2 ; expand = macro_expand ( store , runtime , & next ) ; if ( ! expand ) { return NULL ; } ( void ) strlcpy ( buf + strlen ( buf ) , expand , sizeof ( buf ) - strlen ( buf ) ) ; at = next ; } ( void ) strlcpy ( buf + strlen ( buf ) , at , sizeof ( buf ) - strlen ( buf ) ) ; return strdup ( buf ) ; } 