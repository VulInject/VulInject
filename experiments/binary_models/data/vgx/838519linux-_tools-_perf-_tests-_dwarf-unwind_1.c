NO_TAIL_CALL_ATTRIBUTE noinline int test_dwarf_unwind__thread ( struct thread * thread ) { struct perf_sample sample ; unsigned long cnt = 0 ; int err = - 1 ; if ( test__arch_unwind_sample ( & sample , thread ) ) { pr_debug ( "failed to get unwind sample\n" ) ; out } err = unwind__get_entries ( unwind_entry , & cnt , thread , & sample , MAX_STACK , false ) ; if ( err ) { pr_debug ( "unwind failed\n" ) ; } if ( cnt != MAX_STACK ) { pr_debug ( "got wrong number of stack entries %lu != %d\n" , cnt , MAX_STACK ) ; err = - 1 ; } out zfree ( & sample . user_stack . data ) ; zfree ( & sample . user_regs . regs ) ; return err ; } 