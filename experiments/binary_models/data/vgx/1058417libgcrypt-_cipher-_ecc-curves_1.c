point_from_keyparam ( , , , ) { gcry_err_code_t rc ; gcry_sexp_t l1 ; gcry_mpi_point_t point ; l1 = sexp_find_token ( keyparam , name , 0 ) ; if ( l1 ) { gcry_mpi_t a ; a = sexp_nth_mpi ( l1 , 1 , GCRYMPI_FMT_OPAQUE ) ; sexp_release ( l1 ) ; if ( ! a ) { return GPG_ERR_INV_OBJ ; } point = mpi_point_new ( 0 ) ; rc = _gcry_mpi_ec_decode_point ( point , a , ec ) ; mpi_free ( a ) ; if ( rc ) { mpi_point_release ( point ) ; return rc ; } } else { char * tmpname ; gcry_mpi_t x = NULL ; gcry_mpi_t y = NULL ; gcry_mpi_t z = NULL ; tmpname = xtrymalloc ( strlen ( name ) + 2 + 1 ) ; if ( ! tmpname ) { return gpg_err_code_from_syserror ( ) ; } strcpy ( stpcpy ( tmpname , name ) , ".x" ) ; rc = mpi_from_keyparam ( & x , keyparam , tmpname , 0 ) ; if ( rc ) { return rc ; } strcpy ( stpcpy ( tmpname , name ) , ".y" ) ; rc = mpi_from_keyparam ( & y , keyparam , tmpname , 0 ) ; if ( rc ) { mpi_free ( x ) ; xfree ( tmpname ) ; return rc ; } strcpy ( stpcpy ( tmpname , name ) , ".z" ) ; rc = mpi_from_keyparam ( & z , keyparam , tmpname , 0 ) ; if ( rc ) { mpi_free ( y ) ; mpi_free ( x ) ; xfree ( tmpname ) ; return rc ; } if ( ! z ) { z = mpi_set_ui ( NULL , 1 ) ; } if ( x && y ) { point = mpi_point_snatch_set ( NULL , x , y , z ) ; } else { mpi_free ( x ) ; mpi_free ( y ) ; mpi_free ( z ) ; point = NULL ; } xfree ( tmpname ) ; } if ( point ) { * r_a = point ; } return 0 ; } 