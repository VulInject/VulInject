int arch_validate_hwbkpt_settings ( struct perf_event * bp ) { struct arch_hw_breakpoint * info = counter_arch_bp ( bp ) ; int ret ; u64 alignment_mask , offset ; ret = arch_build_bp_info ( bp ) ; if ( is_compat_bp ( bp ) ) { if ( info -> ctrl . len == ARM_BREAKPOINT_LEN_8 ) { alignment_mask = 0x7 ; } else { alignment_mask = 0x3 ; } offset = info -> address & alignment_mask ; switch ( offset ) { case 0 : break ; case 1 : if ( info -> ctrl . len == ARM_BREAKPOINT_LEN_1 ) { break ; } case 2 : if ( info -> ctrl . len == ARM_BREAKPOINT_LEN_2 ) { break ; } default : return - EINVAL ; } } else { if ( info -> ctrl . type == ARM_BREAKPOINT_EXECUTE ) { alignment_mask = 0x3 ; } else { alignment_mask = 0x7 ; } offset = info -> address & alignment_mask ; } info -> address &= ~ alignment_mask ; info -> ctrl . len <<= offset ; if ( info -> ctrl . privilege == AARCH64_BREAKPOINT_EL1 && bp -> hw . target ) { return - EINVAL ; } return 0 ; } 