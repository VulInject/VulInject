static void max98095_handle_eq_pdata ( struct snd_soc_codec * codec ) { struct max98095_priv * max98095 = snd_soc_codec_get_drvdata ( codec ) ; struct max98095_pdata * pdata = max98095 -> pdata ; struct max98095_eq_cfg * cfg ; int cfgcnt ; int i , j ; const char * * t ; int ret ; struct snd_kcontrol_new controls [ ] { SOC_ENUM_EXT ( "EQ1 Mode" , max98095 -> eq_enum , max98095_get_eq_enum , max98095_put_eq_enum ) SOC_ENUM_EXT ( "EQ2 Mode" , max98095 -> eq_enum , max98095_get_eq_enum , max98095_put_eq_enum ) } ; ; cfg = pdata -> eq_cfg ; cfgcnt = pdata -> eq_cfgcnt ; max98095 -> eq_textcnt = 0 ; max98095 -> eq_texts = NULL ; for ( i = 0 ; i < cfgcnt ; i ++ ) { for ( j = 0 ; j < max98095 -> eq_textcnt ; j ++ ) { if ( strcmp ( cfg [ i ] . name , max98095 -> eq_texts [ j ] ) == 0 ) { break ; } } if ( j != max98095 -> eq_textcnt ) { continue ; } t = krealloc ( max98095 -> eq_texts , sizeof ( char * ) * ( max98095 -> eq_textcnt + 1 ) , GFP_KERNEL ) ; if ( t == NULL ) { continue ; } t [ max98095 -> eq_textcnt ] = cfg [ i ] . name ; max98095 -> eq_textcnt ++ ; max98095 -> eq_texts = t ; } max98095 -> eq_enum . texts = max98095 -> eq_texts ; max98095 -> eq_enum . items = max98095 -> eq_textcnt ; ret = snd_soc_add_codec_controls ( codec , controls , ARRAY_SIZE ( controls ) ) ; if ( ret != 0 ) { dev_err ( codec -> dev , "Failed to add EQ control: %d\n" , ret ) ; } } 