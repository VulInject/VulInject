static int macio_do_write_reg32_slm ( PMF_STD_ARGS , u32 offset , u32 shift , u32 mask ) { struct macio_chip * macio = func -> driver_data ; cfs_time_t flags ; u32 tmp , val ; if ( args == NULL || args -> count == 0 ) { return - EINVAL ; } raw_spin_lock_irqsave ( & feature_lock , flags ) ; tmp = MACIO_IN32 ( offset ) ; val = args -> u [ 0 ] . v << shift ; tmp = ( tmp & ~ mask ) | ( val & mask ) ; MACIO_OUT32 ( offset , tmp ) ; raw_spin_unlock_irqrestore ( & feature_lock , flags ) ; return 0 ; } 