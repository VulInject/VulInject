static int intel_th_gth_assign ( struct intel_th_device * thdev , struct intel_th_device * othdev ) { struct gth_device * gth = dev_get_drvdata ( & thdev -> dev ) ; int i , id ; if ( othdev -> type != INTEL_TH_OUTPUT ) { return - EINVAL ; } for ( i = 0 , id = 0 ; i < TH_POSSIBLE_OUTPUTS ; i ++ ) { if ( gth -> output [ i ] . port_type != othdev -> output . type ) { continue ; } if ( othdev -> id == - 1 || othdev -> id == id ) { found } id ++ ; } return - ENOENT ; found spin_lock ( & gth -> gth_lock ) ; othdev -> output . port = i ; othdev -> output . active = false ; gth -> output [ i ] . output = & othdev -> output ; spin_unlock ( & gth -> gth_lock ) ; return 0 ; } 