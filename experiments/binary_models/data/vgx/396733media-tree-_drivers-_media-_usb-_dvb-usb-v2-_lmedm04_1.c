static int lme2510_usb_talk ( struct dvb_usb_device * d , u8 * wbuf , int wlen , u8 * rbuf , int rlen ) { struct lme2510_state * st = d -> priv ; u8 * buff ; int ret = 0 ; if ( st -> usb_buffer == NULL ) { st -> usb_buffer = kmalloc ( 64 , GFP_KERNEL ) ; if ( st -> usb_buffer == NULL ) { info ( "MEM Error no memory" ) ; return - ENOMEM ; } } buff = st -> usb_buffer ; ret = mutex_lock_interruptible ( & d -> usb_mutex ) ; memcpy ( buff , wbuf , ( wlen < 64 ) ?wlen : 64 ) ; ret |= lme2510_bulk_write ( d -> udev , buff , wlen , 0x01 ) ; ret |= lme2510_bulk_read ( d -> udev , buff , ( rlen < 64 ) ?rlen : 64 , 0x01 ) ; if ( rlen > 0 ) { memcpy ( rbuf , buff , rlen ) ; } mutex_unlock ( & d -> usb_mutex ) ; return ( ret < 0 ) ?- ENODEV : 0 ; } 