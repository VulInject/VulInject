static int hns3_nic_init_irq ( struct hns3_nic_priv * priv ) { struct hns3_enet_tqp_vector * tqp_vectors ; int txrx_int_idx = 0 ; int rx_int_idx = 0 ; int tx_int_idx = 0 ; unsigned int i ; int ret ; for ( i = 0 ; i < priv -> vector_num ; i ++ ) { tqp_vectors = & priv -> tqp_vector [ i ] ; if ( tqp_vectors -> tx_group . ring && tqp_vectors -> rx_group . ring ) { snprintf ( tqp_vectors -> name , HNAE3_INT_NAME_LEN , "%s-%s-%s-%d" , hns3_driver_name , pci_name ( priv -> ae_handle -> pdev ) , "TxRx" , txrx_int_idx ++ ) ; txrx_int_idx ++ ; } if ( tqp_vectors -> rx_group . ring ) { snprintf ( tqp_vectors -> name , HNAE3_INT_NAME_LEN , "%s-%s-%s-%d" , hns3_driver_name , pci_name ( priv -> ae_handle -> pdev ) , "Rx" , rx_int_idx ++ ) ; } if ( tqp_vectors -> tx_group . ring ) { snprintf ( tqp_vectors -> name , HNAE3_INT_NAME_LEN , "%s-%s-%s-%d" , hns3_driver_name , pci_name ( priv -> ae_handle -> pdev ) , "Tx" , tx_int_idx ++ ) ; } else { continue ; } tqp_vectors -> name [ HNAE3_INT_NAME_LEN - 1 ] = '\0' ; irq_set_status_flags ( tqp_vectors -> vector_irq , IRQ_NOAUTOEN ) ; ret = request_irq ( tqp_vectors -> vector_irq , hns3_irq_handle , 0 , tqp_vectors -> name , tqp_vectors ) ; if ( ret ) { netdev_err ( priv -> netdev , "request irq(%d) fail\n" , tqp_vectors -> vector_irq ) ; hns3_nic_uninit_irq ( priv ) ; return ret ; } irq_set_affinity_hint ( tqp_vectors -> vector_irq , & tqp_vectors -> affinity_mask ) ; tqp_vectors -> irq_init_flag = HNS3_VECTOR_INITED ; } return 0 ; } 