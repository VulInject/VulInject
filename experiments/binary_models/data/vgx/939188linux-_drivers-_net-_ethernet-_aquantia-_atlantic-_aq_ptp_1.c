int aq_ptp_ring_init ( struct aq_nic_s * aq_nic ) { struct aq_ptp_s * aq_ptp = aq_nic -> aq_ptp ; int err = 0 ; err = aq_ring_init ( & aq_ptp -> ptp_tx , ATL_RING_TX ) ; if ( err < 0 ) { err_exit } err = aq_nic -> aq_hw_ops -> hw_ring_tx_init ( aq_nic -> aq_hw , & aq_ptp -> ptp_tx , & aq_ptp -> ptp_ring_param ) ; if ( err < 0 ) { err_exit } err = aq_ring_init ( & aq_ptp -> ptp_rx , ATL_RING_RX ) ; if ( err < 0 ) { err_exit } err = aq_nic -> aq_hw_ops -> hw_ring_rx_init ( aq_nic -> aq_hw , & aq_ptp -> ptp_rx , & aq_ptp -> ptp_ring_param ) ; if ( err < 0 ) { err_exit } err = aq_ring_rx_fill ( & aq_ptp -> ptp_rx ) ; if ( err < 0 ) { err_rx_free } err = aq_nic -> aq_hw_ops -> hw_ring_rx_fill ( aq_nic -> aq_hw , & aq_ptp -> ptp_rx , 0U ) ; if ( err < 0 ) { err_rx_free } err = aq_ring_init ( & aq_ptp -> hwts_rx , ATL_RING_RX ) ; if ( err < 0 ) { err_rx_free } err = aq_nic -> aq_hw_ops -> hw_ring_rx_init ( aq_nic -> aq_hw , & aq_ptp -> hwts_rx , & aq_ptp -> ptp_ring_param ) ; if ( err < 0 ) { err_exit } err = aq_nic -> aq_hw_ops -> hw_ring_hwts_rx_fill ( aq_nic -> aq_hw , & aq_ptp -> hwts_rx ) ; if ( err < 0 ) { err_exit } return err ; err_rx_free aq_ring_rx_deinit ( & aq_ptp -> ptp_rx ) ; err_exit return err ; } 