static int m10bmc_sec_write ( struct m10bmc_sec * sec , const u8 * buf , u32 offset , u32 size ) { struct intel_m10bmc * m10bmc = sec -> m10bmc ; unsigned int stride = regmap_get_reg_stride ( m10bmc -> regmap ) ; u32 write_count = size / stride ; u32 leftover_offset = write_count * stride ; u32 leftover_size = size - leftover_offset ; int leftover_tmp = 0 ; int ret ; if ( sec -> m10bmc -> flash_bulk_ops ) { return sec -> m10bmc -> flash_bulk_ops -> write ( m10bmc , buf , offset , size ) ; } if ( WARN_ON_ONCE ( stride > sizeof ( leftover_tmp ) ) ) { return - EINVAL ; } ret = regmap_bulk_write ( m10bmc -> regmap , M10BMC_STAGING_BASE + offset , buf + offset , write_count ) ; if ( ret ) { return ret ; } if ( leftover_size ) { memcpy ( & leftover_tmp , buf + leftover_offset , leftover_size ) ; ret = regmap_write ( m10bmc -> regmap , M10BMC_STAGING_BASE + offset + leftover_offset , leftover_tmp ) ; if ( ret ) { return ret ; } } return 0 ; } 