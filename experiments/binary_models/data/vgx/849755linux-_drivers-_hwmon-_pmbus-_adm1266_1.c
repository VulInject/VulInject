static int adm1266_nvmem_read_blackbox ( struct adm1266_data * data , u8 * read_buff ) { int record_count ; char index ; u8 buf [ 5 ] ; int ret ; ret = i2c_smbus_read_block_data ( data -> client , ADM1266_BLACKBOX_INFO , buf ) ; if ( ret != 4 ) { return - EIO ; } record_count = buf [ 3 ] ; for ( index = 0 ; index < record_count ; index ++ ) { ret = adm1266_pmbus_block_xfer ( data , ADM1266_READ_BLACKBOX , 1 , & index , read_buff ) ; if ( ret < 0 ) { return ret ; } if ( ret != ADM1266_BLACKBOX_SIZE ) { return - EIO ; } read_buff += ADM1266_BLACKBOX_SIZE ; } return 0 ; } 