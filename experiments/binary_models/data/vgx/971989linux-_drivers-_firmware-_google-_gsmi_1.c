static struct gsmi_buf * gsmi_buf_alloc ( void ) { struct gsmi_buf * smibuf ; smibuf = kzalloc ( sizeof ( * smibuf ) , GFP_KERNEL ) ; if ( ! smibuf ) { printk ( KERN_ERR "gsmi: out of memory\n" ) ; return NULL ; } smibuf -> start = kmem_cache_alloc ( gsmi_dev . mem_pool , GFP_KERNEL ) ; if ( ! smibuf -> start ) { printk ( KERN_ERR "gsmi: failed to allocate name buffer\n" ) ; return NULL ; } smibuf -> length = GSMI_BUF_SIZE ; smibuf -> address = ( u32 ) virt_to_phys ( smibuf -> start ) ; return smibuf ; } 