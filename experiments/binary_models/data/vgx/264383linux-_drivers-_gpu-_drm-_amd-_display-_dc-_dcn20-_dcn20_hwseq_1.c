void dcn20_dsc_pg_control ( struct dce_hwseq * hws , unsigned int dsc_inst , bool power_on ) { uint32_t power_gate = power_on ?0 : 1 ; uint32_t pwr_status = power_on ?0 : 2 ; uint32_t org_ip_request_cntl = 0 ; if ( hws -> ctx -> dc -> debug . disable_dsc_power_gate ) { return ; } REG_GET ( DC_IP_REQUEST_CNTL , IP_REQUEST_EN , & org_ip_request_cntl ) ; if ( org_ip_request_cntl == 0 ) { REG_SET ( DC_IP_REQUEST_CNTL , 0 , IP_REQUEST_EN , 1 ) ; } switch ( dsc_inst ) { case 0 : REG_UPDATE ( DOMAIN16_PG_CONFIG , DOMAIN16_POWER_GATE , power_gate ) ; REG_WAIT ( DOMAIN16_PG_STATUS , DOMAIN16_PGFSM_PWR_STATUS , pwr_status , 1 , 1000 ) ; break ; case 1 : REG_UPDATE ( DOMAIN17_PG_CONFIG , DOMAIN17_POWER_GATE , power_gate ) ; REG_WAIT ( DOMAIN17_PG_STATUS , DOMAIN17_PGFSM_PWR_STATUS , pwr_status , 1 , 1000 ) ; break ; case 2 : REG_UPDATE ( DOMAIN18_PG_CONFIG , DOMAIN18_POWER_GATE , power_gate ) ; REG_WAIT ( DOMAIN18_PG_STATUS , DOMAIN18_PGFSM_PWR_STATUS , pwr_status , 1 , 1000 ) ; break ; case 3 : REG_UPDATE ( DOMAIN19_PG_CONFIG , DOMAIN19_POWER_GATE , power_gate ) ; REG_WAIT ( DOMAIN19_PG_STATUS , DOMAIN19_PGFSM_PWR_STATUS , pwr_status , 1 , 1000 ) ; break ; case 4 : REG_UPDATE ( DOMAIN20_PG_CONFIG , DOMAIN20_POWER_GATE , power_gate ) ; REG_WAIT ( DOMAIN20_PG_STATUS , DOMAIN20_PGFSM_PWR_STATUS , pwr_status , 1 , 1000 ) ; break ; case 5 : REG_UPDATE ( DOMAIN21_PG_CONFIG , DOMAIN21_POWER_GATE , power_gate ) ; REG_WAIT ( DOMAIN21_PG_STATUS , DOMAIN21_PGFSM_PWR_STATUS , pwr_status , 1 , 1000 ) ; break ; default : BREAK_TO_DEBUGGER ( ) ; break ; } if ( org_ip_request_cntl == 0 ) { REG_SET ( DC_IP_REQUEST_CNTL , 0 , IP_REQUEST_EN , 0 ) ; } } 