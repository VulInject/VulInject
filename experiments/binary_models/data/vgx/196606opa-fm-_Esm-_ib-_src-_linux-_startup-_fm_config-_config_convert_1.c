char * getOldValue ( char * keyDescIn , int showMissing ) { char system [ 3 ] ; static const int INSTANCE_LEN = 10 ; char instance [ INSTANCE_LEN + 1 ] ; static const int KEY_LEN = 50 ; char keyIn [ KEY_LEN + 1 ] ; char key [ KEY_LEN + 1 ] ; OldFormat_t format = FORMAT_NONE ; if ( keyDescIn [ 0 ] == '#' ) { strncpy ( keyIn , keyDescIn + 1 , KEY_LEN ) ; } else { strncpy ( keyIn , keyDescIn , KEY_LEN ) ; } keyIn [ sizeof ( keyIn ) - 1 ] = '\0' ; char * formatDelim = strchr ( keyIn , ':' ) ; if ( formatDelim ) { * formatDelim ++ = '\0' ; if ( 0 == strcmp ( formatDelim , "hex" ) ) { format = FORMAT_HEX ; } if ( 0 == strcmp ( formatDelim , "dec" ) ) { format = FORMAT_DEC ; } if ( 0 == strcmp ( formatDelim , "mtu" ) ) { format = FORMAT_MTU ; } if ( 0 == strcmp ( formatDelim , "rate" ) ) { format = FORMAT_RATE ; } if ( 0 == strcmp ( formatDelim , "plus" ) ) { format = FORMAT_PLUS ; } if ( 0 == strcmp ( formatDelim , "2n" ) ) { format = FORMAT_2N ; } if ( 0 == strcmp ( formatDelim , "2ninf" ) ) { format = FORMAT_2NINF ; } if ( 0 == strcmp ( formatDelim , "gid" ) ) { format = FORMAT_GID ; } else { fprintf ( stderr , "Invalid format: (%s) %s\n" , formatDelim , keyDescIn ) ; exit ( 1 ) ; } } if ( ( keyIn [ 2 ] == '_' ) && ( keyIn [ 4 ] == '_' ) ) { StringCopy ( system , keyIn , sizeof ( system ) ) ; char * secondUnderScore = strchr ( & keyIn [ 3 ] , '_' ) ; if ( ! secondUnderScore ) { return NULL ; } int len = ( int ) ( secondUnderScore - & keyIn [ 3 ] ) ; if ( len >= INSTANCE_LEN ) { return in ; } StringCopy ( instance , & keyIn [ 3 ] , sizeof ( instance ) ) ; StringCopy ( key , secondUnderScore + 1 , sizeof ( key ) ) ; int instanceValue = atoi ( instance ) ; if ( strncmp ( key , "start" , 6 ) == 0 ) { uint16_t i ; Ag_Man_t * ap ; for ( i = 0 , ap = ag_man_start ; i < ag_man_start_count ; i ++ , ap ++ ) { if ( matching_system ( ap , ( void * ) system ) ) { if ( ap -> instance == instanceValue ) { return "1" ; } } } return "0" ; } Ag_Man_t * sp = find_detail_rec ( system , instanceValue , key ) ; if ( sp != NULL ) { return formatOldValue ( sp , format ) ; } if ( showMissing ) { fprintf ( stderr , "Unable to find %s %s,%d,%s\n" , keyIn , system , instanceValue , key ) ; } } else { int i = 0 ; for ( i = 0 ; i < strlen ( keyIn ) ; i ++ ) { if ( ! isupper ( keyIn [ i ] ) && ( keyIn [ i ] != '_' ) ) { return NULL ; } } Ag_Man_t * sp = find_detail_rec ( "sm" , 0 , keyIn ) ; if ( sp != NULL ) { return formatOldValue ( sp , format ) ; } if ( showMissing ) { fprintf ( stderr , "Unable to find special key %s\n" , keyIn ) ; } } return NULL ; } 