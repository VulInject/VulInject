static void dss1down ( struct PStack * st , int pr , void * arg ) { int i , cr ; struct l3_process * proc ; struct Channel * chan ; if ( ( DL_ESTABLISH | REQUEST ) == pr ) { l3_msg ( st , pr , NULL ) ; return ; } if ( ( ( CC_SETUP | REQUEST ) == pr ) || ( ( CC_RESUME | REQUEST ) == pr ) ) { chan = arg ; cr = newcallref ( ) ; cr |= 0x80 ; if ( ( proc = dss1_new_l3_process ( st , cr ) ) ) { proc -> chan = chan ; chan -> proc = proc ; memcpy ( & proc -> para . setup , & chan -> setup , sizeof ( setup_parm ) ) ; proc -> callref = cr ; } } else { proc = arg ; } if ( ! proc ) { printk ( KERN_ERR "HiSax dss1down without proc pr=%04x\n" , pr ) ; return ; } if ( pr == ( CC_TDSS1_IO | REQUEST ) ) { l3dss1_io_timer ( proc , NULL ) ; return ; } for ( i = 0 ; i < ARRAY_SIZE ( downstatelist ) ; i ++ ) { if ( ( pr == downstatelist [ i ] . primitive ) && ( ( 1 << proc -> state ) & downstatelist [ i ] . state ) ) { break ; } } if ( i == ARRAY_SIZE ( downstatelist ) ) { if ( st -> l3 . debug & L3_DEB_STATE ) { l3_debug ( st , "dss1down state %d prim %#x unhandled" , proc -> state , pr ) ; } } else { if ( st -> l3 . debug & L3_DEB_STATE ) { l3_debug ( st , "dss1down state %d prim %#x" , proc -> state , pr ) ; } downstatelist [ i ] . rout ( proc , pr , arg ) ; } } 