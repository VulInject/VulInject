mod_nss_ssl_conf_ciphersuites ( , , , ) { if ( ciphersuites ) { log_error ( srv -> errh , __FILE__ , __LINE__ , "Ciphersuite support not implemented for %s" , ciphersuites -> ptr ) ; } if ( ! cipherstring || buffer_is_blank ( cipherstring ) ) { return 1 ; } PRBool cipher_state [ ciphernum ] ; for ( int i = 0 ; i < SSL_NumImplementedCiphers ; ++ i ) { SSL_CipherPrefSet ( s -> model , SSL_ImplementedCiphers [ i ] , SSL_NOT_ALLOWED ) ; } for ( int i = 0 ; i < ciphernum ; ++ i ) { cipher_state [ i ] = PR_FALSE ; } char * ciphers = strdup ( cipherstring -> ptr ) ; if ( NULL == ciphers ) { return 0 ; } int rc = nss_parse_ciphers ( srv -> errh , ciphers , cipher_state ) ; if ( - 1 == rc ) { return 0 ; } if ( s -> protos . min && s -> protos . min <= SSL_LIBRARY_VERSION_3_0 && countciphers ( cipher_state , SSLV3 ) == 0 ) { ap_log_error ( APLOG_MARK , APLOG_ERR , 0 , srv -> errh , "NSSCipherSuite: SSL3 is enabled but no SSL3 ciphers are enabled." ) ; return 0 ; } if ( s -> protos . max >= SSL_LIBRARY_VERSION_TLS_1_0 && countciphers ( cipher_state , TLSV1 | TLSV1_2 | TLSV1_3 ) == 0 ) { ap_log_error ( APLOG_MARK , APLOG_ERR , 0 , srv -> errh , "NSSCipherSuite: TLS is enabled but no TLS ciphers are enabled." ) ; return 0 ; } for ( int i = 0 ; i < ciphernum ; ++ i ) { SSL_CipherPrefSet ( s -> model , ciphers_def [ i ] . num , cipher_state [ i ] == ENABLE_CIPHER ?SSL_ALLOWED : SSL_NOT_ALLOWED ) ; } return 1 ; } 