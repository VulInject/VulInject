static rsRetVal createListner ( es_str_t * port , struct cnfparamvals * pvals ) { instanceConf_t * inst ; int i ; int bAppendPortUsed = 0 ; DEFiRet ; CHKiRet ( createInstance ( & inst ) ) ; inst -> pszBindPort = ( uchar * ) es_str2cstr ( port , NULL ) ; for ( i = 0 ; i < inppblk . nParams ; ++ i ) { if ( ! strcmp ( inppblk . descr [ i ] . name , "port" ) ) { continue ; } if ( ! strcmp ( inppblk . descr [ i ] . name , "name" ) ) { if ( inst -> inputname != NULL ) { LogError ( 0 , RS_RET_INVALID_PARAMS , "imudp: name and inputname " "parameter specified - only one can be used" ) ; ABORT_FINALIZE ( RS_RET_INVALID_PARAMS ) ; } inst -> inputname = ( uchar * ) es_str2cstr ( pvals [ i ] . val . d . estr , NULL ) ; } if ( ! strcmp ( inppblk . descr [ i ] . name , "name.appendport" ) ) { if ( bAppendPortUsed ) { LogError ( 0 , RS_RET_INVALID_PARAMS , "imudp: name.appendport and " "inputname.appendport parameter specified - only one can be used" ) ; ABORT_FINALIZE ( RS_RET_INVALID_PARAMS ) ; } inst -> bAppendPortToInpname = ( int ) pvals [ i ] . val . d . n ; bAppendPortUsed = 1 ; } if ( ! strcmp ( inppblk . descr [ i ] . name , "inputname" ) ) { LogError ( 0 , RS_RET_DEPRECATED , "imudp: deprecated parameter inputname " "used. Suggest to use name instead" ) ; if ( inst -> inputname != NULL ) { LogError ( 0 , RS_RET_INVALID_PARAMS , "imudp: name and inputname " "parameter specified - only one can be used" ) ; ABORT_FINALIZE ( RS_RET_INVALID_PARAMS ) ; } inst -> inputname = ( uchar * ) es_str2cstr ( pvals [ i ] . val . d . estr , NULL ) ; } if ( ! strcmp ( inppblk . descr [ i ] . name , "inputname.appendport" ) ) { LogError ( 0 , RS_RET_DEPRECATED , "imudp: deprecated parameter inputname.appendport " "used. Suggest to use name.appendport instead" ) ; if ( bAppendPortUsed ) { LogError ( 0 , RS_RET_INVALID_PARAMS , "imudp: name.appendport and " "inputname.appendport parameter specified - only one can be used" ) ; ABORT_FINALIZE ( RS_RET_INVALID_PARAMS ) ; } bAppendPortUsed = 1 ; inst -> bAppendPortToInpname = ( int ) pvals [ i ] . val . d . n ; } if ( ! strcmp ( inppblk . descr [ i ] . name , "defaulttz" ) ) { inst -> dfltTZ = ( uchar * ) es_str2cstr ( pvals [ i ] . val . d . estr , NULL ) ; } if ( ! strcmp ( inppblk . descr [ i ] . name , "address" ) ) { inst -> pszBindAddr = ( uchar * ) es_str2cstr ( pvals [ i ] . val . d . estr , NULL ) ; } if ( ! strcmp ( inppblk . descr [ i ] . name , "device" ) ) { inst -> pszBindDevice = ( char * ) es_str2cstr ( pvals [ i ] . val . d . estr , NULL ) ; } if ( ! strcmp ( inppblk . descr [ i ] . name , "ruleset" ) ) { inst -> pszBindRuleset = ( uchar * ) es_str2cstr ( pvals [ i ] . val . d . estr , NULL ) ; } if ( ! strcmp ( inppblk . descr [ i ] . name , "ratelimit.burst" ) ) { inst -> ratelimitBurst = ( unsigned int ) pvals [ i ] . val . d . n ; } if ( ! strcmp ( inppblk . descr [ i ] . name , "ratelimit.interval" ) ) { inst -> ratelimitInterval = ( unsigned int ) pvals [ i ] . val . d . n ; } if ( ! strcmp ( inppblk . descr [ i ] . name , "rcvbufsize" ) ) { const uint64_t val = pvals [ i ] . val . d . n ; if ( val > 1024 * 1024 * 1024 ) { LogError ( 0 , RS_RET_MISSING_CNFPARAMS , "imudp: rcvbufsize maximum is 1 GiB, using " "default instead" ) ; } else { inst -> rcvbuf = ( int ) val ; } } if ( ! strcmp ( inppblk . descr [ i ] . name , "ipfreebind" ) ) { inst -> ipfreebind = ( int ) pvals [ i ] . val . d . n ; } else { dbgprintf ( "imudp: program error, non-handled " "param '%s'\n" , inppblk . descr [ i ] . name ) ; } } finalize_it RETiRet ; } 