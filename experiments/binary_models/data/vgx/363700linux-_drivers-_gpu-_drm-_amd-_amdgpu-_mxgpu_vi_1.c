static void xgpu_vi_mailbox_send_ack ( struct amdgpu_device * adev ) { u32 reg ; int timeout = VI_MAILBOX_TIMEDOUT ; u32 mask = REG_FIELD_MASK ( MAILBOX_CONTROL , RCV_MSG_VALID ) ; reg = RREG32_NO_KIQ ( mmMAILBOX_CONTROL , NULL ) ; reg = REG_SET_FIELD ( reg , MAILBOX_CONTROL , RCV_MSG_ACK , 1 ) ; WREG32_NO_KIQ ( mmMAILBOX_CONTROL , reg ) ; reg = RREG32_NO_KIQ ( mmMAILBOX_CONTROL ) ; while ( reg & mask ) { if ( timeout <= 0 ) { pr_err ( "RCV_MSG_VALID is not cleared\n" ) ; break ; } mdelay ( 1 ) ; timeout -= 1 ; reg = RREG32_NO_KIQ ( mmMAILBOX_CONTROL ) ; } } 