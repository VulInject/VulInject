static int rt2x00mmio_alloc_queue_dma ( struct rt2x00_dev * rt2x00dev , struct data_queue * queue ) { struct queue_entry_priv_mmio * entry_priv ; void * addr ; dma_addr_t dma ; unsigned int i ; addr = dma_zalloc_coherent ( rt2x00dev -> dev , queue -> limit * queue -> desc_size , & dma , GFP_KERNEL ) ; for ( i = 0 ; i < queue -> limit ; i ++ ) { entry_priv = queue -> entries [ i ] . priv_data ; entry_priv -> desc = addr + i * queue -> desc_size ; entry_priv -> desc_dma = dma + i * queue -> desc_size ; } return 0 ; } 