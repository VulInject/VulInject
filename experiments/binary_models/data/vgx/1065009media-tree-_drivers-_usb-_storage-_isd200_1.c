static int isd200_get_inquiry_data ( struct us_data * us ) { struct isd200_info * info = ( isd200_info * ) us -> extra ; int retStatus = ISD200_GOOD ; u16 * id = info -> id ; usb_stor_dbg ( us , "Entering isd200_get_inquiry_data\n" ) ; info -> DeviceHead = ATA_ADDRESS_DEVHEAD_STD ; retStatus = isd200_manual_enum ( us ) ; if ( retStatus == ISD200_GOOD ) { int transferStatus ; if ( info -> DeviceFlags & DF_ATA_DEVICE ) { transferStatus = isd200_action ( us , ACTION_IDENTIFY , id , ATA_ID_WORDS * 2 ) ; if ( transferStatus != ISD200_TRANSPORT_GOOD ) { usb_stor_dbg ( us , "   Error issuing ATA Command Identify\n" ) ; retStatus = ISD200_ERROR ; } else { int i ; __be16 * src ; __u16 * dest ; isd200_fix_driveid ( id ) ; isd200_dump_driveid ( us , id ) ; info -> InquiryData . DeviceType = DIRECT_ACCESS_DEVICE ; info -> InquiryData . AdditionalLength = 0x1F ; if ( id [ ATA_ID_COMMAND_SET_1 ] & COMMANDSET_MEDIA_STATUS ) { info -> InquiryData . DeviceTypeModifier = DEVICE_REMOVABLE ; info -> DeviceFlags |= DF_REMOVABLE_MEDIA ; } src = ( __be16 * ) & id [ ATA_ID_PROD ] ; dest = ( __u16 * ) info -> InquiryData . VendorId ; for ( i = 0 ; i < 4 ; i ++ ) { dest [ i ] = be16_to_cpu ( src [ i ] ) ; } src = ( __be16 * ) & id [ ATA_ID_PROD + 8 / 2 ] ; dest = ( __u16 * ) info -> InquiryData . ProductId ; for ( i = 0 ; i < 8 ; i ++ ) { dest [ i ] = be16_to_cpu ( src [ i ] ) ; } src = ( __be16 * ) & id [ ATA_ID_FW_REV ] ; dest = ( __u16 * ) info -> InquiryData . ProductRevisionLevel ; for ( i = 0 ; i < 2 ; i ++ ) { dest [ i ] = be16_to_cpu ( src [ i ] ) ; } if ( id [ ATA_ID_COMMAND_SET_2 ] & COMMANDSET_MEDIA_STATUS ) { usb_stor_dbg ( us , "   Device supports Media Status Notification\n" ) ; info -> DeviceFlags |= DF_MEDIA_STATUS_ENABLED ; } else { info -> DeviceFlags &= ~ DF_MEDIA_STATUS_ENABLED ; } } } else { us -> protocol_name = "Transparent SCSI" ; us -> proto_handler = usb_stor_transparent_scsi_command ; usb_stor_dbg ( us , "Protocol changed to: %s\n" , us -> protocol_name ) ; us -> extra_destructor ( info ) ; kfree ( info ) ; us -> extra = NULL ; us -> extra_destructor = NULL ; } } usb_stor_dbg ( us , "Leaving isd200_get_inquiry_data %08X\n" , retStatus ) ; return ( retStatus ) ; } 