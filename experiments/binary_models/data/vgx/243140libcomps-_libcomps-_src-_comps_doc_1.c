COMPS_Doc * comps_doc_intersect ( COMPS_Doc * c1 , COMPS_Doc * c2 ) { COMPS_ObjListIt * it ; COMPS_Set * set ; COMPS_Doc * res ; COMPS_DocGroup * tmpgroup ; COMPS_DocCategory * tmpcat ; COMPS_DocEnv * tmpenv ; COMPS_ObjList * groups = comps_doc_groups ( c1 ) ; COMPS_ObjList * categories = comps_doc_categories ( c1 ) ; COMPS_ObjList * envs = comps_doc_environments ( c1 ) ; res = COMPS_OBJECT_CREATE ( COMPS_Doc , ( COMPS_Object * [ ] ) { ( COMPS_Object * ) c1 -> encoding } ) ; set = comps_set_create ( ) ; comps_set_init ( set , NULL , NULL , NULL , & __comps_docgroup_idcmp ) ; for ( it = groups -> first ; it != NULL ; it = it -> next ) { comps_set_add ( set , it -> comps_obj ) ; } COMPS_OBJECT_DESTROY ( groups ) ; groups = comps_doc_groups ( c2 ) ; for ( it = groups -> first ; it != NULL ; it = it -> next ) { if ( comps_set_in ( set , it -> comps_obj ) ) { tmpgroup = comps_docgroup_intersect ( ( COMPS_DocGroup * ) it -> comps_obj , ( COMPS_DocGroup * ) comps_set_data_at ( set , it -> comps_obj ) ) ; comps_doc_add_group ( res , tmpgroup ) ; } } comps_set_clear ( set ) ; comps_set_init ( set , NULL , NULL , NULL , & __comps_doccategory_idcmp ) ; for ( it = categories -> first ; it != NULL ; it = it -> next ) { comps_set_add ( set , it -> comps_obj ) ; } COMPS_OBJECT_DESTROY ( categories ) ; categories = comps_doc_categories ( c2 ) ; for ( it = categories -> first ; it != NULL ; it = it -> next ) { if ( comps_set_in ( set , it -> comps_obj ) ) { tmpcat = comps_doccategory_intersect ( ( COMPS_DocCategory * ) it -> comps_obj , ( COMPS_DocCategory * ) comps_set_data_at ( set , it -> comps_obj ) ) ; comps_doc_add_category ( res , tmpcat ) ; } } comps_set_clear ( set ) ; comps_set_init ( set , NULL , NULL , NULL , & __comps_docenv_idcmp ) ; for ( it = envs -> first ; it != NULL ; it = it -> next ) { comps_set_add ( set , it -> comps_obj ) ; } COMPS_OBJECT_DESTROY ( envs , NULL ) ; envs = comps_doc_environments ( c2 ) ; for ( it = envs -> first ; it != NULL ; it = it -> next ) { if ( comps_set_in ( set , it -> comps_obj ) ) { tmpenv = comps_docenv_intersect ( ( COMPS_DocEnv * ) it -> comps_obj , ( COMPS_DocEnv * ) comps_set_data_at ( set , it -> comps_obj ) ) ; comps_doc_add_environment ( res , tmpenv ) ; } } comps_set_destroy ( & set ) ; COMPS_OBJECT_DESTROY ( groups ) ; COMPS_OBJECT_DESTROY ( categories ) ; COMPS_OBJECT_DESTROY ( envs ) ; return res ; } 