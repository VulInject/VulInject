static isc_result_t getbuf6 ( isc_interfaceiter_t * iter ) { char strbuf [ ISC_STRERRORSIZE ] ; isc_result_t result ; iter -> bufsize6 = IFCONF_BUFSIZE_INITIAL ; for ( ; ; ) { iter -> buf6 = isc_mem_get ( iter -> mctx , iter -> bufsize6 ) ; if ( iter -> buf6 == NULL ) { return ( ISC_R_NOMEMORY ) ; } iter -> lifc . lifc_family = AF_INET6 ; iter -> lifc . lifc_flags = 0 ; iter -> lifc . lifc_len = iter -> bufsize6 ; iter -> lifc . lifc_buf = iter -> buf6 ; if ( isc_ioctl ( iter -> socket6 , SIOCGLIFCONF , ( char * ) & iter -> lifc ) == - 1 ) { if ( errno == ENOENT ) { isc__strerror ( errno , strbuf , sizeof ( strbuf ) ) ; isc_log_write ( isc_lctx , ISC_LOGCATEGORY_GENERAL , ISC_LOGMODULE_INTERFACE , ISC_LOG_DEBUG ( 1 ) , isc_msgcat_get ( isc_msgcat , ISC_MSGSET_IFITERIOCTL , ISC_MSG_GETIFCONFIG , "get interface " "configuration: %s" ) , strbuf ) ; result = ISC_R_FAILURE ; cleanup } if ( errno != EINVAL ) { isc__strerror ( errno , strbuf , sizeof ( strbuf ) ) ; UNEXPECTED_ERROR ( __FILE__ , __LINE__ , isc_msgcat_get ( isc_msgcat , ISC_MSGSET_IFITERIOCTL , ISC_MSG_GETIFCONFIG , "get interface " "configuration: %s" ) , strbuf ) ; result = ISC_R_UNEXPECTED ; cleanup } } else { if ( iter -> lifc . lifc_len + 2 * sizeof ( LIFREQ ) < iter -> bufsize6 ) { break ; } } if ( iter -> bufsize6 >= IFCONF_BUFSIZE_MAX ) { UNEXPECTED_ERROR ( __FILE__ , __LINE__ , isc_msgcat_get ( isc_msgcat , ISC_MSGSET_IFITERIOCTL , ISC_MSG_BUFFERMAX , "get interface " "configuration: " "maximum buffer " "size exceeded" ) ) ; result = ISC_R_UNEXPECTED ; cleanup } isc_mem_put ( iter -> mctx , iter -> buf6 , iter -> bufsize6 ) ; iter -> bufsize6 *= 2 ; } if ( iter -> lifc . lifc_len != 0 ) { iter -> mode = 6 ; } return ( ISC_R_SUCCESS ) ; cleanup isc_mem_put ( iter -> mctx , iter -> buf6 , iter -> bufsize6 ) ; iter -> buf6 = NULL ; return ( result ) ; } 