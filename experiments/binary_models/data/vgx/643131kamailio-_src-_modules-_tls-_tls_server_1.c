void tls_h_tcpconn_clean_f ( struct tcp_connection * c ) { struct tls_extra_data * extra ; if ( ( c -> type != PROTO_TLS ) && ( c -> type != PROTO_WSS ) ) { BUG ( "Bad connection structure\n" ) ; abort ( ) ; } if ( c -> extra_data ) { extra = ( tls_extra_data * ) c -> extra_data ; SSL_free ( extra -> ssl ) ; atomic_dec ( & extra -> cfg -> ref_count ) ; if ( extra -> ct_wq ) { tls_ct_wq_free ( & extra -> ct_wq ) ; } if ( extra -> enc_rd_buf ) { extra -> enc_rd_buf = 0 ; } shm_free ( c -> extra_data ) ; c -> extra_data = 0 ; } } 