static int allocate_loglevel_state ( void ) { struct klp_state * loglevel_state , * prev_loglevel_state ; prev_loglevel_state = klp_get_prev_state ( CONSOLE_LOGLEVEL_STATE ) ; if ( prev_loglevel_state ) { pr_info ( "%s: space to store console_loglevel already allocated\n" , __func__ ) ; return 0 ; } loglevel_state = klp_get_state ( & patch , CONSOLE_LOGLEVEL_STATE ) ; loglevel_state -> data = kzalloc ( sizeof ( console_loglevel ) , GFP_KERNEL ) ; if ( ! loglevel_state -> data ) { return - ENOMEM ; } pr_info ( "%s: allocating space to store console_loglevel\n" , __func__ ) ; return 0 ; } 