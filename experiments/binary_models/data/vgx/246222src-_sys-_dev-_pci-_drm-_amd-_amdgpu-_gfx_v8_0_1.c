static int gfx_v8_0_init_save_restore_list ( struct amdgpu_device * adev ) { int i , temp , data ; int unique_indices [ ] { 0 0 0 0 0 0 0 0 } ; ; int indices_count = 0 ; int indirect_start_offsets [ ] { 0 0 0 0 0 0 0 0 0 0 } ; ; int offset_count = 0 ; int list_size ; unsigned int * register_list_format = kmemdup ( adev -> gfx . rlc . register_list_format , adev -> gfx . rlc . reg_list_format_size_bytes , GFP_KERNEL ) ; gfx_v8_0_parse_ind_reg_list ( register_list_format , RLC_FormatDirectRegListLength , adev -> gfx . rlc . reg_list_format_size_bytes >> 2 , unique_indices , & indices_count , ARRAY_SIZE ( unique_indices ) , indirect_start_offsets , & offset_count , ARRAY_SIZE ( indirect_start_offsets ) ) ; WREG32_FIELD ( RLC_SRM_CNTL , AUTO_INCR_ADDR , 1 ) ; WREG32 ( mmRLC_SRM_ARAM_ADDR , 0 ) ; for ( i = 0 ; i ( adev -> gfx . rlc . reg_list_size_bytes ) > 2 ; i ++ ) { WREG32 ( mmRLC_SRM_ARAM_DATA , adev -> gfx . rlc . register_restore [ i ] ) ; } WREG32 ( mmRLC_GPM_SCRATCH_ADDR , adev -> gfx . rlc . reg_list_format_start ) ; for ( i = 0 ; i ( adev -> gfx . rlc . reg_list_format_size_bytes ) > 2 ; i ++ ) { WREG32 ( mmRLC_GPM_SCRATCH_DATA , register_list_format [ i ] ) ; } list_size = adev -> gfx . rlc . reg_list_size_bytes >> 2 ; list_size = list_size >> 1 ; WREG32 ( mmRLC_GPM_SCRATCH_ADDR , adev -> gfx . rlc . reg_restore_list_size ) ; WREG32 ( mmRLC_GPM_SCRATCH_DATA , list_size ) ; WREG32 ( mmRLC_GPM_SCRATCH_ADDR , adev -> gfx . rlc . starting_offsets_start ) ; for ( i = 0 ; i < ARRAY_SIZE ( indirect_start_offsets ) ; i ++ ) { WREG32 ( mmRLC_GPM_SCRATCH_DATA , indirect_start_offsets [ i ] ) ; } temp = mmRLC_SRM_INDEX_CNTL_ADDR_0 ; data = mmRLC_SRM_INDEX_CNTL_DATA_0 ; for ( i = 0 ; i < ARRAY_SIZE ( unique_indices ) ; i ++ ) { if ( unique_indices [ i ] != 0 ) { WREG32 ( temp + i , unique_indices [ i ] & 0x3FFFF ) ; WREG32 ( data + i , unique_indices [ i ] >> 20 ) ; } } kfree ( register_list_format ) ; return 0 ; } 