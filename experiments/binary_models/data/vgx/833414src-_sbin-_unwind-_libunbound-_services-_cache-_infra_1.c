static int * infra_rate_find_second_or_none ( void * data , time_t t , int should_add ) { struct rate_data * d = ( rate_data * ) data ; int i , oldest ; for ( i = 0 ; i < RATE_WINDOW ; i ++ ) { if ( d -> timestamp [ i ] == t ) { return & ( d -> qps [ i ] ) ; } } if ( ! should_add ) { return NULL ; } oldest = 0 ; for ( i = 0 ; i < RATE_WINDOW ; i ++ ) { if ( d -> timestamp [ i ] < d -> timestamp [ oldest ] ) { oldest = i ; } } d -> timestamp [ oldest ] = t ; return & ( d -> qps [ oldest ] ) ; } 