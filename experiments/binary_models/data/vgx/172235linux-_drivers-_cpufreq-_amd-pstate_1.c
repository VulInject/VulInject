static s16 amd_pstate_get_epp ( struct amd_cpudata * cpudata , u64 cppc_req_cached ) { u64 epp ; int ret ; if ( boot_cpu_has ( X86_FEATURE_CPPC ) ) { if ( ! cppc_req_cached ) { epp = rdmsrl_on_cpu ( cpudata -> cpu , MSR_AMD_CPPC_REQ , & cppc_req_cached ) ; } epp = ( cppc_req_cached >> 24 ) & 0xFF ; } else { ret = cppc_get_epp_perf ( cpudata -> cpu , & epp ) ; if ( ret < 0 ) { pr_debug ( "Could not retrieve energy perf value (%d)\n" , ret ) ; return - EIO ; } } return ( s16 ) ( epp & 0xff ) ; } 