static int __lpass_platform_codec_intf_init ( struct snd_soc_dai * dai , struct snd_pcm_substream * substream ) { struct snd_soc_pcm_runtime * soc_runtime = asoc_substream_to_rtd ( substream ) ; struct snd_soc_dai * cpu_dai = asoc_rtd_to_cpu ( soc_runtime , 0 ) ; struct lpaif_dmactl * dmactl = NULL ; struct device * dev = soc_runtime -> dev ; int ret , id , codec_intf ; unsigned int dai_id = cpu_dai -> driver -> id ; codec_intf = __lpass_get_codec_dma_intf_type ( dai_id ) ; if ( codec_intf < 0 ) { dev_err ( dev , "failed to get codec_intf: %d\n" , codec_intf ) ; return codec_intf ; } __lpass_get_dmactl_handle ( substream , dai , & dmactl , & id ) ; ret = regmap_fields_write ( dmactl -> codec_intf , id , codec_intf ) ; if ( ret ) { dev_err ( dev , "error writing to dmactl codec_intf reg field: %d\n" , ret ) ; return ret ; } ret = regmap_fields_write ( dmactl -> codec_fs_sel , id , 0x0 ) ; if ( ret ) { dev_err ( dev , "error writing to dmactl codec_fs_sel reg field: %d\n" , ret ) ; return ret ; } ret = regmap_fields_write ( dmactl -> codec_fs_delay , id , 0x0 ) ; if ( ret ) { dev_err ( dev , "error writing to dmactl codec_fs_delay reg field: %d\n" , ret ) ; return ret ; } ret = regmap_fields_write ( dmactl -> codec_pack , id , 0x1 ) ; if ( ret ) { dev_err ( dev , "error writing to dmactl codec_pack reg field: %d\n" , ret ) ; return ret ; } ret = regmap_fields_write ( dmactl -> codec_enable , id , LPAIF_DMACTL_ENABLE_ON ) ; if ( ret ) { dev_err ( dev , "error writing to dmactl codec_enable reg field: %d\n" , ret ) ; return ret ; } return 0 ; } 