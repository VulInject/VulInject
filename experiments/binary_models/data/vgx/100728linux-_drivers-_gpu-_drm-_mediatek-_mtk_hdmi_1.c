static void mtk_hdmi_hw_send_info_frame ( struct mtk_hdmi * hdmi , u8 * buffer , u8 len ) { u32 ctrl_reg = GRL_CTRL ; int i ; u8 * frame_data ; enum hdmi_infoframe_type frame_type ; u8 frame_ver ; int frame_len ; u8 checksum ; int ctrl_frame_en = 0 ; frame_type = * buffer ++ ; frame_ver = * buffer ++ ; frame_len = * buffer ++ ; checksum = * buffer ++ ; frame_data = buffer ; dev_dbg ( hdmi -> dev , "frame_type:0x%x,frame_ver:0x%x,frame_len:0x%x,checksum:0x%x\n" , frame_type , frame_ver , frame_len , checksum ) ; switch ( frame_type ) { case HDMI_INFOFRAME_TYPE_AVI : ctrl_frame_en = CTRL_AVI_EN ; ctrl_reg = GRL_CTRL ; break ; case HDMI_INFOFRAME_TYPE_SPD : ctrl_frame_en = CTRL_SPD_EN ; ctrl_reg = GRL_CTRL ; break ; case HDMI_INFOFRAME_TYPE_AUDIO : ctrl_frame_en = CTRL_AUDIO_EN ; ctrl_reg = GRL_CTRL ; break ; case HDMI_INFOFRAME_TYPE_VENDOR : ctrl_frame_en = VS_EN ; ctrl_reg = GRL_ACP_ISRC_CTRL ; break ; default : dev_err ( hdmi -> dev , "Unknown infoframe type %d\n" , frame_type ) ; return ; } mtk_hdmi_clear_bits ( hdmi , ctrl_reg , ctrl_frame_en ) ; mtk_hdmi_write ( hdmi , GRL_INFOFRM_TYPE , frame_type ) ; mtk_hdmi_write ( hdmi , GRL_INFOFRM_VER , frame_ver ) ; mtk_hdmi_write ( hdmi , GRL_INFOFRM_LNG , frame_len ) ; mtk_hdmi_write ( hdmi , GRL_IFM_PORT , checksum ) ; for ( i = 0 ; i < frame_len ; i ++ ) { mtk_hdmi_write ( hdmi , GRL_IFM_PORT , frame_data [ i ] ) ; } mtk_hdmi_set_bits ( hdmi , ctrl_reg , ctrl_frame_en ) ; } 