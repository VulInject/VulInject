static inline int inode_need_compress ( struct btrfs_inode * inode , u64 start , u64 end ) { struct btrfs_fs_info * fs_info = inode -> root -> fs_info ; if ( ! btrfs_inode_can_compress ( inode ) ) { WARN ( IS_ENABLED ( CONFIG_BTRFS_DEBUG ) , KERN_ERR "BTRFS: unexpected compression for ino %llu\n" , btrfs_ino ( inode ) ) ; return 0 ; } if ( fs_info -> sectorsize < PAGE_SIZE ) { if ( ! PAGE_ALIGNED ( start ) || ! PAGE_ALIGNED ( end + 1 ) ) { return 0 ; } } if ( btrfs_test_opt ( fs_info , FORCE_COMPRESS ) ) { return 1 ; } if ( inode -> flags & BTRFS_INODE_NOCOMPRESS ) { return 0 ; } if ( btrfs_test_opt ( fs_info , COMPRESS ) || inode -> flags & BTRFS_INODE_COMPRESS || inode -> prop_compress ) { return btrfs_compress_heuristic ( & inode -> vfs_inode , start , end ) ; } return 0 ; } 