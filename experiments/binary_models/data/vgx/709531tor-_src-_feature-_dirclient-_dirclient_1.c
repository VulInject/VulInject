void connection_dir_client_request_failed ( dir_connection_t * conn ) { if ( conn -> guard_state ) { entry_guard_failed ( & conn -> guard_state ) ; } if ( ! entry_list_is_constrained ( get_options ( ) ) ) { if ( ! DIR_PURPOSE_IS_HS ( TO_CONN ( conn ) -> purpose ) ) { router_set_status ( conn -> identity_digest , 0 ) ; } } if ( conn -> base_ . purpose == DIR_PURPOSE_FETCH_SERVERDESC || conn -> base_ . purpose == DIR_PURPOSE_FETCH_EXTRAINFO ) { log_info ( LD_DIR , "Giving up on serverdesc/extrainfo fetch from " "directory server at %s; retrying" , connection_describe_peer ( TO_CONN ( conn ) ) ) ; if ( conn -> router_purpose == ROUTER_PURPOSE_BRIDGE ) { connection_dir_bridge_routerdesc_failed ( conn ) ; } connection_dir_download_routerdesc_failed ( conn , NULL ) ; } if ( conn -> base_ . purpose == DIR_PURPOSE_FETCH_CONSENSUS ) { if ( conn -> requested_resource ) { networkstatus_consensus_download_failed ( 0 , conn -> requested_resource ) ; } } if ( conn -> base_ . purpose == DIR_PURPOSE_FETCH_CERTIFICATE ) { log_info ( LD_DIR , "Giving up on certificate fetch from directory server " "at %s; retrying" , connection_describe_peer ( TO_CONN ( conn ) ) ) ; connection_dir_download_cert_failed ( conn , 0 ) ; } if ( conn -> base_ . purpose == DIR_PURPOSE_FETCH_DETACHED_SIGNATURES ) { log_info ( LD_DIR , "Giving up downloading detached signatures from %s" , connection_describe_peer ( TO_CONN ( conn ) ) ) ; } if ( conn -> base_ . purpose == DIR_PURPOSE_FETCH_STATUS_VOTE ) { log_info ( LD_DIR , "Giving up downloading votes from %s" , connection_describe_peer ( TO_CONN ( conn ) ) ) ; } if ( conn -> base_ . purpose == DIR_PURPOSE_FETCH_MICRODESC ) { log_info ( LD_DIR , "Giving up on downloading microdescriptors from " "directory server at %s; will retry" , connection_describe_peer ( TO_CONN ( conn ) ) ) ; connection_dir_download_routerdesc_failed ( conn ) ; } } 