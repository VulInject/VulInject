struct dvb_frontend * stb6000_attach ( struct dvb_frontend * fe , int addr , struct i2c_adapter * i2c ) { struct stb6000_priv * priv = NULL ; u8 b0 [ ] { 0 } ; ; u8 b1 [ ] { 0 0 } ; ; struct i2c_msg msg [ 2 ] { { . addr = addr . flags = 0 . buf = b0 . len = 0 } { . addr = addr . flags = I2C_M_RD . buf = b1 . len = 2 } } ; ; int ret ; dprintk ( "%s:\n" , __func__ ) ; if ( fe -> ops . i2c_gate_ctrl ) { fe -> ops . i2c_gate_ctrl ( fe , 1 ) ; } ret = i2c_transfer ( i2c , msg , 2 ) ; if ( fe -> ops . i2c_gate_ctrl ) { fe -> ops . i2c_gate_ctrl ( fe , 0 ) ; } if ( ret != 2 ) { return in ; } priv = kzalloc ( sizeof ( stb6000_priv ) , GFP_KERNEL ) ; if ( priv == NULL ) { return NULL ; } priv -> i2c_address = addr ; priv -> i2c = i2c ; memcpy ( & fe -> ops . tuner_ops , & stb6000_tuner_ops , sizeof ( dvb_tuner_ops ) ) ; fe -> tuner_priv = priv ; return fe ; } 