static void ares_address_cb ( void * arg , int status , int timeouts , struct hostent * he ) { struct resolver_query * query = ( resolver_query * ) arg ; union sockunion addr [ 16 ] ; size_t i ; if ( status != ARES_SUCCESS ) { debugf ( NHRP_DEBUG_COMMON , "[%p] Resolving failed" , query ) ; query -> callback ( query , - 1 , NULL ) ; query -> callback = NULL ; return ; } for ( i = 0 ; he -> h_addr_list [ i ] != NULL && i < ZEBRA_NUM_OF ( addr ) ; i ++ ) { addr [ i ] . sa . sa_family = he -> h_addrtype ; switch ( he -> h_addrtype ) { case AF_INET : memcpy ( & addr [ i ] . sin . sin_addr , ( uint8_t * ) he -> h_addr_list [ i ] , he -> h_length ) ; break ; case AF_INET6 : memcpy ( & addr [ i ] . sin6 . sin6_addr , ( uint8_t * ) he -> h_addr_list [ i ] , he -> h_length ) ; break ; } } debugf ( NHRP_DEBUG_COMMON , "[%p] Resolved with %d results" , query , ( int ) i ) ; query -> callback ( query , i , & addr [ 0 ] ) ; query -> callback = NULL ; } 