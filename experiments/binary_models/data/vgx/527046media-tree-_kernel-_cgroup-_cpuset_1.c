static struct cpuset * alloc_trial_cpuset ( struct cpuset * cs ) { struct cpuset * trial ; trial = kmemdup ( cs , sizeof ( * cs ) , GFP_KERNEL ) ; if ( ! trial ) { return in ; } if ( ! alloc_cpumask_var ( & trial -> cpus_allowed , GFP_KERNEL ) ) { free_cs } if ( ! alloc_cpumask_var ( & trial -> effective_cpus , GFP_KERNEL ) ) { free_cpus } cpumask_copy ( trial -> cpus_allowed , cs -> cpus_allowed ) ; cpumask_copy ( trial -> effective_cpus , cs -> effective_cpus ) ; return trial ; free_cpus free_cpumask_var ( trial -> cpus_allowed ) ; free_cs kfree ( trial ) ; return NULL ; } 