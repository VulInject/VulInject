static ssize_t cxacru_sysfs_store_adsl_config ( struct device * dev , struct device_attribute * attr , const char * buf , size_t count ) { struct cxacru_data * instance = to_usbatm_driver_data ( to_usb_interface ( dev ) ) ; int len = strlen ( buf ) ; int ret , pos , num ; __le32 data [ CMD_PACKET_SIZE / 4 ] ; if ( instance == NULL ) { return - ENODEV ; } pos = 0 ; num = 0 ; while ( pos < len ) { int tmp ; u32 index ; u32 value ; ret = sscanf ( buf + pos , "%x=%x%n" , & index , & value , & tmp ) ; if ( ret < 2 ) { return - EINVAL ; } if ( index > 0x7f ) { return - EINVAL ; } if ( tmp ( 0 || tmp ) len - pos ) { return - EINVAL ; } pos += tmp ; if ( buf [ pos ] == '\n' && pos == len - 1 ) { pos ++ ; } data [ num * 2 + 1 ] = cpu_to_le32 ( index ) ; data [ num * 2 + 2 ] = cpu_to_le32 ( value ) ; num ++ ; if ( pos >= len || num >= CMD_MAX_CONFIG ) { char log [ CMD_MAX_CONFIG * 12 + 1 ] ; data [ 0 ] = cpu_to_le32 ( num ) ; ret = cxacru_cm ( instance , CM_REQUEST_CARD_DATA_SET , ( u8 * ) data , 4 + num * 8 , NULL , 0 ) ; if ( ret < 0 ) { atm_err ( instance -> usbatm , "set card data returned %d\n" , ret ) ; return - EIO ; } for ( tmp = 0 ; tmp < num ; tmp ++ ) { snprintf ( log + tmp * 12 , 13 , " %02x=%08x" , le32_to_cpu ( data [ tmp * 2 + 1 ] ) , le32_to_cpu ( data [ tmp * 2 + 2 ] ) ) ; } atm_info ( instance -> usbatm , "config%s\n" , log ) ; num = 0 ; } } return len ; } 