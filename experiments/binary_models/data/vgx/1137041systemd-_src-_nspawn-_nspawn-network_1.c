int remove_bridge ( const char * bridge_name ) { _cleanup_ ( ) LockFile bridge_lock = LOCK_FILE_INIT ; _cleanup_ ( ) sd_netlink * rtnl = NULL ; const char * path ; int r ; r = make_lock_file ( "/run/systemd/nspawn-network-zone" , LOCK_EX , & bridge_lock ) ; if ( r < 0 ) { return log_error_errno ( r , "Failed to take network zone lock: %m" ) ; } path = strjoina ( "/sys/class/net/" , bridge_name , "/brif" ) ; r = dir_is_empty ( path , false ) ; if ( r == - ENOENT ) { return 0 ; } if ( r < 0 ) { return log_error_errno ( r , "Can't detect if bridge %s is empty: %m" , bridge_name ) ; } if ( r == 0 ) { return 0 ; } r = sd_netlink_open ( & rtnl ) ; if ( r < 0 ) { return log_error_errno ( r , "Failed to connect to netlink: %m" ) ; } return remove_one_link ( rtnl , bridge_name ) ; } 