static bool memremap_should_map_decrypted ( resource_size_t phys_addr , unsigned long size ) { int is_pmem ; is_pmem = region_intersects ( phys_addr , size , IORESOURCE_MEM , IORES_DESC_PERSISTENT_MEMORY ) ; if ( is_pmem != REGION_DISJOINT ) { return true ; } if ( efi_enabled ( EFI_BOOT ) ) { switch ( efi_mem_type ( phys_addr ) ) { case EFI_RESERVED_TYPE : break ; default : break ; } } switch ( e820__get_entry_type ( phys_addr , phys_addr + size - 1 ) ) { case E820_TYPE_RESERVED : case E820_TYPE_ACPI : case E820_TYPE_NVS : case E820_TYPE_UNUSABLE : if ( cc_platform_has ( CC_ATTR_GUEST_MEM_ENCRYPT ) ) { break ; } fallthrough ; case E820_TYPE_PRAM : return true ; default : break ; } return false ; } 