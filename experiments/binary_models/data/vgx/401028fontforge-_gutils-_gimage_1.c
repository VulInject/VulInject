GImage * GImageCreate ( enum image_type type , int32_t width , int32_t height ) { GImage * gi ; struct _GImage * base ; if ( type ( it_mono || type ) it_rgba ) { return ( NULL ) ; } gi = ( GImage * ) calloc ( 1 , sizeof ( GImage ) ) ; base = ( _GImage * ) malloc ( sizeof ( _GImage ) ) ; if ( gi == NULL || base == NULL ) { errorGImageCreate } gi -> u . image = base ; base -> image_type = type ; base -> width = width ; base -> height = height ; base -> bytes_per_line = ( type == it_true || type == it_rgba ) ?4 * width : type == it_index ?width : ( width + 7 ) / 8 ; base -> data = NULL ; base -> clut = NULL ; base -> trans = COLOR_UNKNOWN ; if ( ( base -> data = ( uint8_t * ) malloc ( height * base -> bytes_per_line ) ) == NULL ) { errorGImageCreate } if ( type == it_index ) { if ( ( base -> clut = ( GClut * ) calloc ( 1 , sizeof ( GClut ) ) ) == NULL ) { free ( base -> data ) ; errorGImageCreate } base -> clut -> trans_index = COLOR_UNKNOWN ; } return ( gi ) ; errorGImageCreate free ( base ) ; NoMoreMemMessage ( ) ; return ( NULL ) ; } 