void lsblk_unref_devtree ( struct lsblk_devtree * tr ) { if ( ! tr ) { return ; } if ( -- tr -> refcount <= 0 ) { DBG ( TREE , ul_debugobj ( tr , "dealloc" ) ) ; while ( ! list_empty ( & tr -> devices ) ) { struct lsblk_device * dev = list_entry ( tr -> devices . next , lsblk_device , ls_devices ) ; lsblk_devtree_remove_device ( tr , dev ) ; } while ( ! list_empty ( & tr -> pktcdvd_map ) ) { struct lsblk_devnomap * map = list_entry ( tr -> pktcdvd_map . next , lsblk_devnomap , ls_devnomap ) ; list_del ( & map -> ls_devnomap ) ; free ( map ) ; } } } 