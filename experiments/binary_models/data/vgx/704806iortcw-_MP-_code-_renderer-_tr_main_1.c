if ( r_noportals -> integer || r_fastsky -> integer ) { return qfalse ; } oldParms = tr . viewParms ; newParms = tr . viewParms ; newParms . isPortal = qtrue ; if ( ! R_GetPortalOrientations ( drawSurf , entityNum , & surface , & camera , newParms . pvsOrigin , & newParms . isMirror ) ) { return qfalse ; } R_MirrorPoint ( oldParms . or . origin , & surface , & camera , newParms . or . origin ) ; VectorSubtract ( vec3_origin , camera . axis [ 0 ] , newParms . portalPlane . normal ) ; newParms . portalPlane . dist = DotProduct ( camera . origin , newParms . portalPlane . normal ) ; R_MirrorVector ( oldParms . or . axis [ 0 ] , & surface , & camera , newParms . or . axis [ 0 ] ) ; R_MirrorVector ( oldParms . or . axis [ 1 ] , & surface , & camera , newParms . or . axis [ 1 ] ) ; R_MirrorVector ( oldParms . or . axis [ 2 ] , & surface , & camera , newParms . or . axis [ 2 ] ) ; R_RenderView ( & newParms ) ; tr . viewParms = oldParms ; return qtrue ; 