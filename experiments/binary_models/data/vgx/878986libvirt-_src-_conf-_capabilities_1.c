static int virCapabilitiesInitResctrlMemory ( virCaps * caps ) { virCapsHostMemBWNode * node = NULL ; size_t i = 0 ; int ret = - 1 ; const virResctrlMonitorType montype = VIR_RESCTRL_MONITOR_TYPE_MEMBW ; const char * prefix = virResctrlMonitorPrefixTypeToString ( montype ) ; for ( i = 0 ; i < caps -> host . cache . nbanks ; i ++ ) { virCapsHostCacheBank * bank = caps -> host . cache . banks [ i ] ; node = g_new0 ( virCapsHostMemBWNode , 1 ) ; if ( virResctrlInfoGetMemoryBandwidth ( caps -> host . resctrl , bank -> level , & node -> control ) > 0 ) { node -> id = bank -> id ; node -> cpus = virBitmapNewCopy ( bank -> cpus ) ; VIR_APPEND_ELEMENT ( caps -> host . memBW . nodes , caps -> host . memBW . nnodes , node ) ; } g_clear_pointer ( & node , virCapsHostMemBWNodeFree ) ; } if ( virResctrlInfoGetMonitorPrefix ( caps -> host . resctrl , prefix , & caps -> host . memBW . monitor ) < 0 ) { cleanup } cleanup virCapsHostMemBWNodeFree ( node ) ; return ret ; } 