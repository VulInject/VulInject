int __dso__load_kallsyms ( struct dso * dso , const char * filename , struct map * map , bool no_kcore ) { struct kmap * kmap = map__kmap ( map ) ; int delta = 0 ; if ( symbol__restricted_filename ( filename , "/proc/kallsyms" ) ) { return - 1 ; } if ( ! kmap || ! kmap -> kmaps ) { return - 1 ; } if ( dso__load_all_kallsyms ( dso , filename ) < 0 ) { return - 1 ; } if ( kallsyms__delta ( kmap , filename , & delta ) ) { return - 1 ; } symbols__fixup_end ( & dso -> symbols , true ) ; symbols__fixup_duplicate ( & dso -> symbols ) ; if ( dso -> kernel == DSO_SPACE__KERNEL_GUEST ) { dso -> symtab_type = DSO_BINARY_TYPE__GUEST_KALLSYMS ; } else { dso -> symtab_type = DSO_BINARY_TYPE__KALLSYMS ; } if ( ! no_kcore && ! dso__load_kcore ( dso , map , filename ) ) { return maps__split_kallsyms_for_kcore ( kmap -> kmaps , dso ) ; } else { return maps__split_kallsyms ( kmap -> kmaps , dso , delta , map ) ; } } 