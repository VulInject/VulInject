static int felix_update_trapping_destinations ( struct dsa_switch * ds , bool using_tag_8021q ) { struct ocelot * ocelot = ds -> priv ; struct felix * felix = ocelot_to_felix ( ocelot ) ; struct ocelot_vcap_block * block_vcap_is2 ; struct ocelot_vcap_filter * trap ; enum ocelot_mask_mode mask_mode ; cfs_time_t port_mask ; bool cpu_copy_ena ; int err ; if ( ! felix -> info -> quirk_no_xtr_irq ) { return 0 ; } block_vcap_is2 = & ocelot -> block [ VCAP_IS2 ] ; list_for_each_entry ( , , ) { if ( ! trap -> is_trap ) { continue ; } if ( using_tag_8021q ) { mask_mode = OCELOT_MASK_MODE_REDIRECT ; port_mask = BIT ( felix_trap_get_cpu_port ( ds , trap ) ) ; cpu_copy_ena = ! ! trap -> take_ts ; } else { mask_mode = OCELOT_MASK_MODE_PERMIT_DENY ; port_mask = 0 ; cpu_copy_ena = true ; } if ( trap -> action . mask_mode == mask_mode && trap -> action . port_mask == port_mask && trap -> action . cpu_copy_ena == cpu_copy_ena ) { continue ; } trap -> action . mask_mode = mask_mode ; trap -> action . port_mask = port_mask ; trap -> action . cpu_copy_ena = cpu_copy_ena ; err = ocelot_vcap_filter_replace ( ocelot , trap ) ; if ( err ) { return err ; } } return 0 ; } 