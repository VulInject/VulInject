static int add_digits ( int ch ) { int32_t value , p_value , scale ; int digit ; value = ch - '0' ; save_unsafe_ch ( ch ) ; ch = next_ch ( ) ; while ( isDECIMAL_DIGIT ( ch ) && value < ( MAX_INTEGER / 10 ) ) { value = ( value << 3 ) + ( value << 1 ) + ( ch - '0' ) ; save_unsafe_ch ( ch ) ; ch = next_ch ( ) ; } if ( isNUMBER_ENDER ( ch ) ) { back_ch_not_white ( ch ) ; tokenValue . integer = ( m_sign == '-' ?- value : value ) ; tokenType = TOKEN_INTEGER ; return ( DONE ) ; } p_value = value ; value = ( m_sign == '-' ?- value : value ) ; if ( isDECIMAL_DIGIT ( ch ) ) { if ( p_value == ( MAX_INTEGER / 10 ) ) { digit = ch - '0' ; if ( value > 0 ) { if ( digit <= MAX_INTEGER % 10 ) { value = ( value << 3 ) + ( value << 1 ) + digit ; } else { ++ scale ; } } else { if ( digit <= - ( MIN_INTEGER + 10 ) % 10 ) { value = ( value << 3 ) + ( value << 1 ) - digit ; } else { ++ scale ; } } } else { ++ scale ; } save_unsafe_ch ( ch ) ; ch = next_ch ( ) ; while ( isDECIMAL_DIGIT ( ch ) ) { ++ scale ; save_ch ( ch ) ; ch = next_ch ( ) ; } } m_value = value ; m_scale = scale ; e_sign = '+' ; e_value = 0 ; e_scale = 0 ; return ( ch ) ; } 