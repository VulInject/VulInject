static void ovsdb_relay_parse_update ( struct relay_ctx * ctx , const struct ovsdb_cs_update_event * update ) { if ( ! ctx -> db ) { return ; } if ( update -> monitor_reply && ctx -> new_schema ) { ctx -> schema_change_cb ( ctx -> db , ctx -> new_schema , ctx -> schema_change_aux ) ; ovsdb_schema_destroy ( ctx -> new_schema ) ; } struct ovsdb_cs_db_update * du ; struct ovsdb_error * error = ovsdb_cs_parse_db_update ( update -> table_updates , update -> version , & du ) ; if ( ! error ) { if ( update -> clear ) { error = ovsdb_relay_clear ( ctx -> db ) ; } if ( ! error ) { error = ovsdb_relay_parse_update__ ( ctx -> db , du , & update -> last_id ) ; } } ovsdb_cs_db_update_destroy ( du ) ; if ( error ) { static struct vlog_rate_limit rl = VLOG_RATE_LIMIT_INIT ( 1 , 5 ) ; if ( ! VLOG_DROP_WARN ( & rl ) ) { char * s = ovsdb_error_to_string ( error ) ; VLOG_WARN_RL ( & rl , "%s" , s ) ; free ( s ) ; } if ( ! strcmp ( ovsdb_error_get_tag ( error ) , "consistency violation" ) ) { ovsdb_cs_flag_inconsistency ( ctx -> cs ) ; } else { ovsdb_cs_force_reconnect ( ctx -> cs ) ; } ovsdb_error_destroy ( error ) ; } } 