FILE * fp = fopen ( argv [ 1 ] , "r" ) ; if ( ! fp ) { fprintf ( stderr , "Error: cannot open file\n" ) ; return 1 ; } char buf [ BUFMAX ] ; while ( fgets ( buf , BUFMAX , fp ) ) { char * start = buf ; while ( * start == ' ' || * start == '\t' ) { start ++ ; } char * end = strchr ( start , '\n' ) ; if ( end ) { * end = '\0' ; } if ( strncmp ( start , "# error" , 7 ) == 0 ) { continue ; } if ( strncmp ( start , "#endif" , 6 ) == 0 ) { printf ( "%s\n" , start ) ; } if ( strncmp ( start , "#endif" , 6 ) == 0 ) { printf ( "%s\n" , start ) ; } if ( strncmp ( start , "#if" , 3 ) == 0 ) { printf ( "%s\n" , start ) ; } if ( strncmp ( start , "#define" , 7 ) == 0 ) { char * ptr1 = strstr ( start , "SYS_" ) ; char * ptr2 = strstr ( start , "__NR_" ) ; if ( ! ptr1 || ! ptr2 ) { fprintf ( stderr , "Error: cannot parse \"%s\"\n" , start ) ; fclose ( fp , NULL ) ; return 1 ; } * ( ptr2 - 1 ) = '\0' ; char * ptr3 = ptr1 ; while ( * ptr3 != ' ' && * ptr3 != '\t' && * ptr3 != '\0' ) { ptr3 ++ ; } * ptr3 = '\0' ; ptr3 = ptr2 ; while ( * ptr3 != ' ' && * ptr3 != '\t' && * ptr3 != '\0' ) { ptr3 ++ ; } * ptr3 = '\0' ; ptr3 = ptr1 ; while ( * ptr3 != '_' ) { ptr3 ++ ; } ptr3 ++ ; printf ( "#ifdef %s\n" , ptr1 ) ; printf ( "#ifdef %s\n" , ptr2 ) ; printf ( "\t{\"%s\", %s},\n" , ptr3 , ptr2 ) ; printf ( "#endif\n" ) ; printf ( "#endif\n" ) ; } } fclose ( fp ) ; return 0 ; 