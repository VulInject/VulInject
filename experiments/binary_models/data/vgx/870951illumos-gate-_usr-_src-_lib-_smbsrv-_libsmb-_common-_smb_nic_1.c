static int smb_nic_dbdelhost ( const char * host ) { sqlite * db ; char * sql ; char * errmsg ; int rc , err = SMB_NIC_SUCCESS ; sql = sqlite_mprintf ( "DELETE FROM hosts WHERE hostname = '%s'" , host ) ; if ( sql == NULL ) { return ( SMB_NIC_NO_MEMORY ) ; } db = smb_nic_dbopen ( SMB_NIC_DB_ORW ) ; if ( db == NULL ) { sqlite_freemem ( sql ) ; return ( SMB_NIC_DBOPEN_FAILED ) ; } rc = sqlite_exec ( db , sql , NULL , NULL , & errmsg ) ; sqlite_freemem ( sql ) ; smb_nic_dbclose ( db ) ; if ( rc != SQLITE_OK ) { syslog ( LOG_ERR , "Failed to delete host %s from host " "database (%s)." , host , NULL_MSGCHK ( errmsg ) ) ; err = SMB_NIC_DELETE_FAILED ; } return ( err ) ; } 