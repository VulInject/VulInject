static ssize_t batadv_store_mesh_iface ( struct kobject * kobj , struct attribute * attr , char * buff , size_t count ) { struct net_device * net_dev = batadv_kobj_to_netdev ( kobj ) ; struct batadv_store_mesh_work * store_work ; if ( buff [ count - 1 ] == '\n' ) { buff [ count - 1 ] = '\0' ; } if ( strlen ( buff ) >= IFNAMSIZ ) { pr_err ( "Invalid parameter for 'mesh_iface' setting received: interface name too long '%s'\n" , buff ) ; return - EINVAL ; } store_work = kmalloc ( sizeof ( * store_work ) , GFP_KERNEL ) ; dev_hold ( net_dev ) ; INIT_WORK ( & store_work -> work , batadv_store_mesh_iface_work ) ; store_work -> net_dev = net_dev ; strlcpy ( store_work -> soft_iface_name , buff , sizeof ( store_work -> soft_iface_name ) ) ; queue_work ( batadv_event_workqueue , & store_work -> work ) ; return count ; } 