int fts_close_compat ( FTS * sp ) { FTSENT * freep , * p ; int saved_errno = 0 ; if ( sp -> fts_cur ) { for ( p = sp -> fts_cur ; p -> fts_level >= FTS_ROOTLEVEL ; ) { freep = p ; p = p -> fts_link ?p -> fts_link : p -> fts_parent ; free ( freep ) ; } } if ( sp -> fts_child ) { fts_lfree ( sp -> fts_child ) ; } if ( sp -> fts_array ) { free ( sp -> fts_array ) ; } free ( sp -> fts_path ) ; if ( ! ISSET ( FTS_NOCHDIR ) ) { if ( fchdir ( sp -> fts_rfd ) ) { saved_errno = errno ; } ( void ) close ( sp -> fts_rfd ) ; } free ( sp ) ; if ( saved_errno ) { errno = saved_errno ; return ( - 1 ) ; } return ( 0 ) ; } 