dir_list_search ( , , , , ) { str_llist_elt_type * elt ; str_llist_elt_type * next_elt ; str_list_type ret ; unsigned name_len = strlen ( name ) ; unsigned allocated = INIT_ALLOC ; string potential = ( string ) xmalloc ( allocated ) ; if ( KPATHSEA_DEBUG_P ( KPSE_DEBUG_SEARCH ) ) { const_string casefold = ( readable_file_p == casefold_readable_file ) ?"yes" : "no" ; "No" ; DEBUGF3 ( "  dir_list_search(file=%s, find_all=%d, casefold=%s)\n" , name , search_all , casefold ) ; } ret = str_list_init ( ) ; for ( elt = * dirs ; elt ; elt = next_elt ) { string readable_name ; const_string dir = STR_LLIST ( * elt ) ; unsigned dir_len = strlen ( dir ) ; next_elt = STR_LLIST_NEXT ( * elt ) ; while ( dir_len + name_len + 1 > allocated ) { allocated += allocated ; XRETALLOC ( potential , allocated , char ) ; } strcpy ( potential , dir ) ; strcat ( potential , name ) ; readable_name = readable_file_p ( kpse , potential ) ; if ( readable_name ) { str_list_add ( & ret , readable_name ) ; str_llist_float ( dirs , elt ) ; if ( ! search_all ) { return ret ; } allocated = INIT_ALLOC ; potential = ( string ) xmalloc ( allocated ) ; } } return ret ; } 