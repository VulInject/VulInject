static ssize_t ina3221_show_bus_voltage ( struct device * dev , struct device_attribute * attr , char * buf ) { struct sensor_device_attribute * sd_attr = to_sensor_dev_attr ( attr ) ; struct ina3221_data * ina = dev_get_drvdata ( dev ) ; unsigned int reg = sd_attr -> index ; int val , voltage_mv , ret ; ret = ina3221_read_value ( ina , reg , & val ) ; voltage_mv = val * 8 ; return snprintf ( buf , PAGE_SIZE , "%d\n" , voltage_mv ) ; } 