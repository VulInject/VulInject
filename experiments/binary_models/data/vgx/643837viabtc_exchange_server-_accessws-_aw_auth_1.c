int send_auth_request ( nw_ses * ses , uint64_t id , struct clt_info * info , json_t * params ) { const char * token = json_string_value ( json_array_get ( params , 0 ) ) ; if ( token == NULL ) { return send_error_invalid_argument ( ses , id ) ; } const char * source = json_string_value ( json_array_get ( params , 1 ) ) ; if ( source == NULL || strlen ( source ) >= SOURCE_MAX_LEN ) { return send_error_invalid_argument ( ses , id ) ; } nw_state_entry * entry = nw_state_add ( state_context , settings . backend_timeout , 0 ) ; struct state_data * state = entry -> data ; state -> ses = ses ; state -> ses_id = ses -> id ; state -> request_id = id ; state -> info = info ; log_info ( "send auth request, token: %s, source: %s" , token , source ) ; info -> source = strdup ( source ) ; nw_job_add ( job_context , entry -> id , sdsnew ( token ) ) ; return 0 ; } 