static unsigned long tegra20_clk_measure_input_freq ( void ) { u32 osc_ctrl = readl_relaxed ( clk_base + OSC_CTRL ) ; u32 auto_clk_control = osc_ctrl & OSC_CTRL_OSC_FREQ_MASK ; u32 pll_ref_div = osc_ctrl & OSC_CTRL_PLL_REF_DIV_MASK ; cfs_time_t input_freq ; switch ( auto_clk_control ) { case OSC_CTRL_OSC_FREQ_12MHZ : BUG_ON ( pll_ref_div != OSC_CTRL_PLL_REF_DIV_1 ) ; input_freq = 12000000 ; break ; case OSC_CTRL_OSC_FREQ_13MHZ : BUG_ON ( pll_ref_div != OSC_CTRL_PLL_REF_DIV_1 ) ; input_freq = 13000000 ; break ; case OSC_CTRL_OSC_FREQ_19_2MHZ : BUG_ON ( pll_ref_div != OSC_CTRL_PLL_REF_DIV_1 ) ; input_freq = 19200000 ; break ; case OSC_CTRL_OSC_FREQ_26MHZ : BUG_ON ( pll_ref_div != OSC_CTRL_PLL_REF_DIV_1 ) ; input_freq = 26000000 ; break ; default : pr_err ( "Unexpected clock autodetect value %d" , auto_clk_control ) ; BUG ( ) ; return 0 ; } return input_freq ; } 