int coda_fsync ( struct file * coda_file , loff_t start , loff_t end , int datasync ) { struct file * host_file ; struct inode * coda_inode = file_inode ( coda_file ) ; struct coda_file_info * cfi ; int err ; if ( ! ( S_ISREG ( coda_inode -> i_mode ) || S_ISDIR ( coda_inode -> i_mode ) || S_ISLNK ( coda_inode -> i_mode ) ) ) { return - EINVAL ; } err = filemap_write_and_wait_range ( coda_inode -> i_mapping , start , end ) ; if ( err ) { return err ; } inode_lock ( coda_inode , NULL ) ; cfi = coda_ftoc ( coda_file ) ; host_file = cfi -> cfi_container ; err = vfs_fsync ( host_file , datasync ) ; if ( ! err && ! datasync ) { err = venus_fsync ( coda_inode -> i_sb , coda_i2f ( coda_inode ) ) ; } inode_unlock ( coda_inode ) ; return err ; } 