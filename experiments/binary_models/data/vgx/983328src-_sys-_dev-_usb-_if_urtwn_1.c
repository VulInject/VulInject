int urtwn_detach ( struct device * self , int flags ) { struct urtwn_softc * sc = ( urtwn_softc * ) self ; int s ; s = splusb ( ) ; if ( timeout_initialized ( & sc -> scan_to ) ) { timeout_del ( & sc -> scan_to ) ; } if ( timeout_initialized ( & sc -> calib_to ) ) { timeout_del ( & sc -> calib_to ) ; } usb_rem_wait_task ( sc -> sc_udev , & sc -> sc_task ) ; usbd_ref_wait ( sc -> sc_udev ) ; rtwn_detach ( & sc -> sc_sc , flags ) ; urtwn_close_pipes ( sc ) ; urtwn_free_tx_list ( sc ) ; urtwn_free_rx_list ( sc ) ; splx ( s , NULL ) ; return ( 0 ) ; } 