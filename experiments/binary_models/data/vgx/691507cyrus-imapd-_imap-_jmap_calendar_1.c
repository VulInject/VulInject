static seqset_t * _readseen ( struct mailbox * mbox , const char * userid ) { seqset_t * seenuids = NULL ; struct seen * seendb ; int r = seen_open ( userid , SEEN_SILENT , & seendb ) ; if ( ! r ) { struct seendata sd = SEENDATA_INITIALIZER ; r = seen_read ( seendb , mailbox_uniqueid ( mbox ) , & sd ) ; if ( ! r ) { seenuids = seqset_parse ( sd . seenuids , NULL , sd . lastuid ) ; seen_freedata ( & sd ) ; } } if ( r == IMAP_NOTFOUND ) { seenuids = seqset_init ( 1 , SEQ_MERGE ) ; } if ( r ) { xsyslog ( LOG_ERR , "can not read seen state" , "userid=%s error=%s" , userid , error_message ( r ) ) ; } seen_close ( & seendb ) ; return seenuids ; } 