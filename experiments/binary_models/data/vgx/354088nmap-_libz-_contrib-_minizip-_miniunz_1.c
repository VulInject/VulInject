static int makedir ( newdir ) char * newdir ; { char * buffer ; char * p ; size_t len = strlen ( newdir ) ; if ( len == 0 ) { return 0 ; } buffer = ( char * ) malloc ( len + 1 ) ; if ( buffer == NULL ) { printf ( "Error allocating memory\n" ) ; return UNZ_INTERNALERROR ; } strcpy ( buffer , newdir ) ; if ( buffer [ len - 1 ] == '/' ) { buffer [ len - 1 ] = '\0' ; } if ( mymkdir ( buffer ) == 0 ) { return 1 ; } p = buffer + 1 ; while ( 1 ) { char hold ; while ( * p && * p != '\\' && * p != '/' ) { p ++ ; } hold = * p ; * p = 0 ; if ( ( mymkdir ( buffer ) == - 1 ) && ( errno == ENOENT ) ) { printf ( "couldn't create directory %s\n" , buffer ) ; free ( buffer ) ; return 0 ; } if ( hold == 0 ) { break ; } * p ++ = hold ; } free ( buffer ) ; return 1 ; } 