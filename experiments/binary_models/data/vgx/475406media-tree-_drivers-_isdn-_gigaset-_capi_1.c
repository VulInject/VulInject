int gigaset_isdn_regdev ( struct cardstate * cs , const char * isdnid ) { struct gigaset_capi_ctr * iif ; int rc ; iif = kzalloc ( sizeof ( * iif ) , GFP_KERNEL ) ; if ( ! iif ) { pr_err ( "%s: out of memory\n" , __func__ ) ; return - ENOMEM ; } iif -> ctr . owner = THIS_MODULE ; iif -> ctr . driverdata = cs ; strncpy ( iif -> ctr . name , isdnid , sizeof ( iif -> ctr . name ) - 1 ) ; iif -> ctr . driver_name = "gigaset" ; iif -> ctr . load_firmware = NULL ; iif -> ctr . register_appl = gigaset_register_appl ; iif -> ctr . release_appl = gigaset_release_appl ; iif -> ctr . send_message = gigaset_send_message ; iif -> ctr . procinfo = gigaset_procinfo ; iif -> ctr . proc_fops = & gigaset_proc_fops ; INIT_LIST_HEAD ( & iif -> appls ) ; skb_queue_head_init ( & iif -> sendqueue ) ; atomic_set ( & iif -> sendqlen , 0 ) ; rc = attach_capi_ctr ( & iif -> ctr ) ; if ( rc ) { pr_err ( "attach_capi_ctr failed (%d)\n" , rc ) ; kfree ( iif ) ; return rc ; } cs -> iif = iif ; cs -> hw_hdr_len = CAPI_DATA_B3_REQ_LEN ; return 0 ; } 