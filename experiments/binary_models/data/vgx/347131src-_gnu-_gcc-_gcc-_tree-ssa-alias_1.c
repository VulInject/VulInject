create_overlap_variables_for ( ) { VEC ( fieldoff_s , heap ) * fieldstack = NULL ; used_part_t up ; size_t uid = DECL_UID ( var ) ; up = up_lookup ( uid ) ; if ( ! up || up -> write_only ) { return ; } push_fields_onto_fieldstack ( TREE_TYPE ( var ) , & fieldstack , 0 , NULL ) ; if ( VEC_length ( fieldoff_s , fieldstack ) != 0 ) { subvar_t * subvars ; fieldoff_s * fo ; bool notokay = false ; int fieldcount = 0 ; int i ; HOST_WIDE_INT lastfooffset = - 1 ; HOST_WIDE_INT lastfosize = - 1 ; tree lastfotype = NULL_TREE ; for ( i = 0 ; VEC_iterate ( fieldoff_s , fieldstack , i , fo ) ; i ++ ) { if ( ! fo -> size || TREE_CODE ( fo -> size ) != INTEGER_CST || fo -> offset < 0 ) { notokay = true ; break ; } fieldcount ++ ; } if ( fieldcount >= SALIAS_MAX_IMPLICIT_FIELDS && ! up -> explicit_uses ) { if ( dump_file && ( dump_flags & TDF_DETAILS ) ) { fprintf ( dump_file , "Variable " ) ; print_generic_expr ( dump_file , var , 0 ) ; fprintf ( dump_file , " has no explicit uses in this function, and is>SALIAS_MAX_IMPLICIT_FIELDS, so skipping\n" ) ; } notokay = true ; } if ( notokay ) { VEC_free ( fieldoff_s , heap , fieldstack ) ; return ; } subvars = lookup_subvars_for_var ( var ) ; sort_fieldstack ( fieldstack ) ; for ( i = VEC_length ( fieldoff_s , fieldstack ) ; VEC_iterate ( fieldoff_s , fieldstack , -- i , fo ) ; ) { subvar_t sv ; HOST_WIDE_INT fosize ; tree currfotype ; fosize = TREE_INT_CST_LOW ( fo -> size ) ; currfotype = fo -> type ; if ( ( ( fo -> offset <= up -> minused && fo -> offset + fosize <= up -> minused ) || fo -> offset >= up -> maxused ) || ( fo -> offset == lastfooffset && fosize == lastfosize && currfotype == lastfotype ) ) { continue ; } sv = GGC_NEW ( subvar ) ; sv -> next = * subvars ; sv -> var = create_sft ( var , fo -> type , fo -> offset , fosize ) ; if ( dump_file ) { fprintf ( dump_file , "structure field tag %s created for var %s" , get_name ( sv -> var ) , get_name ( var ) ) ; fprintf ( dump_file , " offset " HOST_WIDE_INT_PRINT_DEC , SFT_OFFSET ( sv -> var ) ) ; fprintf ( dump_file , " size " HOST_WIDE_INT_PRINT_DEC , SFT_SIZE ( sv -> var ) ) ; fprintf ( dump_file , "\n" ) ; } lastfotype = currfotype ; lastfooffset = fo -> offset ; lastfosize = fosize ; * subvars = sv ; } } VEC_free ( fieldoff_s , heap , fieldstack ) ; } 