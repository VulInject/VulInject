static void apply_this_with ( gpointer data , gpointer user_data ) { pcmk__colocation_t * colocation = ( pcmk__colocation_t * ) data ; pe_resource_t * rsc = ( pe_resource_t * ) user_data ; GHashTable * archive = NULL ; pe_resource_t * other = colocation -> primary ; if ( ( colocation -> dependent_role >= RSC_ROLE_PROMOTED ) || ( ( colocation -> score < 0 ) && ( colocation -> score > - INFINITY ) ) ) { archive = pcmk__copy_node_table ( rsc -> allowed_nodes ) ; } pe_rsc_trace ( rsc , "%s: Assigning colocation %s primary %s first" "(score=%d role=%s)" , rsc -> id , colocation -> id , other -> id , colocation -> score , role2text ( colocation -> dependent_role ) ) ; other -> cmds -> assign ( other , NULL ) ; rsc -> cmds -> apply_coloc_score ( rsc , other , colocation , true ) ; if ( ( archive != NULL ) && ! pcmk__any_node_available ( rsc -> allowed_nodes ) ) { pe_rsc_info ( rsc , "%s: Reverting scores from colocation with %s " "because no nodes allowed" , rsc -> id , other -> id ) ; rsc -> allowed_nodes = archive ; archive = NULL ; } if ( archive != NULL ) { g_hash_table_destroy ( archive ) ; } } 