void iso9660_set_pvd ( void * pd , const char volume_id [ ] , const char publisher_id [ ] , const char preparer_id [ ] , const char application_id [ ] , uint32_t iso_size , const void * root_dir , uint32_t path_table_l_extent , uint32_t path_table_m_extent , uint32_t path_table_size , const time_t * pvd_time ) { iso9660_pvd_t ipd ; struct tm temp_tm ; cdio_assert ( sizeof ( iso9660_pvd_t ) == ISO_BLOCKSIZE ) ; cdio_assert ( pd != NULL ) ; cdio_assert ( volume_id != NULL ) ; cdio_assert ( application_id != NULL ) ; strncpy ( ( ( char * ) & ipd ) + ISO_XA_MARKER_OFFSET , ISO_XA_MARKER_STRING , strlen ( ISO_XA_MARKER_STRING ) + 1 ) ; ipd . type = to_711 ( ISO_VD_PRIMARY ) ; iso9660_strncpy_pad ( ipd . id , ISO_STANDARD_ID , 5 , ISO9660_DCHARS ) ; ipd . version = to_711 ( ISO_VERSION ) ; iso9660_strncpy_pad ( ipd . system_id , SYSTEM_ID , 32 , ISO9660_ACHARS ) ; iso9660_strncpy_pad ( ipd . volume_id , volume_id , 32 , ISO9660_DCHARS ) ; ipd . volume_space_size = to_733 ( iso_size ) ; ipd . volume_set_size = to_723 ( 1 ) ; ipd . volume_sequence_number = to_723 ( 1 ) ; ipd . logical_block_size = to_723 ( ISO_BLOCKSIZE ) ; ipd . path_table_size = to_733 ( path_table_size ) ; ipd . type_l_path_table = to_731 ( path_table_l_extent ) ; ipd . type_m_path_table = to_732 ( path_table_m_extent ) ; cdio_assert ( sizeof ( ipd . root_directory_record ) == 33 ) ; memcpy ( & ( ipd . root_directory_record ) , root_dir , sizeof ( ipd . root_directory_record ) ) ; ipd . root_directory_filename = '\0' ; ipd . root_directory_record . length = sizeof ( ipd . root_directory_record ) + 1 ; iso9660_strncpy_pad ( ipd . volume_set_id , VOLUME_SET_ID , ISO_MAX_VOLUMESET_ID , ISO9660_DCHARS ) ; iso9660_strncpy_pad ( ipd . publisher_id , publisher_id , ISO_MAX_PUBLISHER_ID , ISO9660_ACHARS ) ; iso9660_strncpy_pad ( ipd . preparer_id , preparer_id , ISO_MAX_PREPARER_ID , ISO9660_ACHARS ) ; iso9660_strncpy_pad ( ipd . application_id , application_id , ISO_MAX_APPLICATION_ID , ISO9660_ACHARS ) ; iso9660_strncpy_pad ( ipd . copyright_file_id , "" , 37 , ISO9660_DCHARS ) ; iso9660_strncpy_pad ( ipd . abstract_file_id , "" , 37 , ISO9660_DCHARS ) ; iso9660_strncpy_pad ( ipd . bibliographic_file_id , "" , 37 , ISO9660_DCHARS ) ; gmtime_r ( pvd_time , & temp_tm ) ; iso9660_set_ltime ( & temp_tm , & ( ipd . creation_date ) ) ; gmtime_r ( pvd_time , & temp_tm ) ; iso9660_set_ltime ( & temp_tm , & ( ipd . modification_date ) ) ; iso9660_set_ltime ( NULL , & ( ipd . expiration_date ) ) ; iso9660_set_ltime ( NULL , & ( ipd . effective_date ) ) ; ipd . file_structure_version = to_711 ( 1 ) ; memcpy ( pd , & ipd , sizeof ( ipd ) ) ; } 