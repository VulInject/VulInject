static int stm32_pctrl_dt_setup_irq ( struct platform_device * pdev , struct stm32_pinctrl * pctl ) { struct device_node * np = pdev -> dev . of_node , * parent ; struct device * dev = & pdev -> dev ; struct regmap * rm ; int offset , ret , i ; parent = of_irq_find_parent ( np ) ; if ( ! parent ) { return - ENXIO ; } pctl -> domain = irq_find_host ( parent ) ; pctl -> regmap = syscon_regmap_lookup_by_phandle ( np , "st,syscfg" ) ; if ( IS_ERR ( pctl -> regmap ) ) { return PTR_ERR ( pctl -> regmap ) ; } rm = pctl -> regmap ; ret = of_property_read_u32_index ( np , "st,syscfg" , 1 , & offset ) ; if ( ret ) { return ret ; } for ( i = 0 ; i < STM32_GPIO_PINS_PER_BANK ; i ++ ) { struct reg_field mux ; mux . reg = offset + ( i / 4 ) * 4 ; mux . lsb = ( i % 4 ) * 4 ; mux . msb = mux . lsb + 3 ; pctl -> irqmux [ i ] = devm_regmap_field_alloc ( dev , rm , mux ) ; if ( IS_ERR ( pctl -> irqmux [ i ] ) ) { return PTR_ERR ( pctl -> irqmux [ i ] ) ; } } return 0 ; } 