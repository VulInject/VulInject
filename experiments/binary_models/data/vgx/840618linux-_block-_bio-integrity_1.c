static blk_status_t bio_integrity_process ( struct bio * bio , struct bvec_iter * proc_iter , integrity_processing_fn * proc_fn ) { struct blk_integrity * bi = blk_get_integrity ( bio -> bi_bdev -> bd_disk ) ; struct blk_integrity_iter iter ; struct bvec_iter bviter ; struct bio_vec bv ; struct bio_integrity_payload * bip = bio_integrity ( bio ) ; blk_status_t ret = BLK_STS_OK ; iter . disk_name = bio -> bi_bdev -> bd_disk -> disk_name ; iter . interval = 1 << bi -> interval_exp ; iter . tuple_size = bi -> tuple_size ; iter . seed = proc_iter -> bi_sector ; iter . prot_buf = bvec_virt ( bip -> bip_vec ) ; __bio_for_each_segment ( , , , ) { void * kaddr = bvec_kmap_local ( & bv ) ; iter . data_buf = kaddr ; iter . data_size = bv . bv_len ; ret = proc_fn ( & iter ) ; kunmap_local ( kaddr ) ; } return ret ; } 