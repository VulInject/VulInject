static int open_kcore ( struct inode * inode , struct file * filp ) { int ret = security_locked_down ( LOCKDOWN_KCORE ) ; if ( ret ) { return ret ; } filp -> private_data = kmalloc ( PAGE_SIZE , GFP_KERNEL ) ; if ( ! filp -> private_data ) { return - ENOMEM ; } if ( kcore_need_update ) { kcore_update_ram ( ) ; } if ( i_size_read ( inode ) != proc_root_kcore -> size ) { inode_lock ( inode ) ; i_size_write ( inode , proc_root_kcore -> size ) ; inode_unlock ( inode ) ; } return 0 ; } 