void gf_path_iterator_del ( GF_PathIterator * it ) { if ( it -> seg ) { gf_free ( it -> seg ) ; } } ( ( delta . x > 0 ) ?- 1 : ( delta . x < 0 ) ?1 : ( delta . y > 0 ) ?- 1 : ( delta . y < 0 ) ?1 : 0 ) pcur = pts [ iread ++ ] ; delta . x = pcur . x - pprev . x ; delta . y = pcur . y - pprev . y ; if ( ( thisDir = ConvexCompare ( dcur ) ) == - curDir ) { ++ dirChanges ; } curDir = thisDir ; cross = ConvexCross ( dprev , dcur ) ; if ( cross > 0 ) { if ( angleSign == - 1 ) { return GF_POLYGON_COMPLEX_CW ; } angleSign = 1 ; } if ( cross < 0 ) { if ( angleSign == 1 ) { return GF_POLYGON_COMPLEX_CCW ; } angleSign = - 1 ; } pSecond = pThird ; dprev . x = dcur . x ; dprev . y = dcur . y ; GF_EXPORT u32 gf_polygone2d_get_convexity ( GF_Point2D * pts , u32 len ) { s32 curDir , thisDir = 0 , dirChanges = 0 , angleSign = 0 ; u32 iread ; Fixed cross ; GF_Point2D pSecond , pThird , pSaveSecond ; GF_Point2D dprev , dcur ; if ( len < 3 ) { return GF_POLYGON_CONVEX_LINE ; } iread = 1 ; ConvexGetPointDelta ( dprev , ( pts [ 0 ] ) , pSecond ) ; pSaveSecond = pSecond ; curDir = ConvexCompare ( dprev ) ; while ( iread < len ) { ConvexGetPointDelta ( dcur , pSecond , pThird ) ; if ( ( dcur . x == 0 ) && ( dcur . y == 0 ) ) { continue ; } ConvexCheckTriple ; } pThird = pts [ 0 ] ; dcur . x = pThird . x - pSecond . x ; dcur . y = pThird . y - pSecond . y ; if ( ConvexCompare ( dcur ) ) { ConvexCheckTriple ; } dcur . x = pSaveSecond . x - pSecond . x ; dcur . y = pSaveSecond . y - pSecond . y ; ConvexCheckTriple ; if ( dirChanges > 2 ) { return GF_POLYGON_COMPLEX ; } if ( angleSign > 0 ) { return GF_POLYGON_CONVEX_CCW ; } if ( angleSign < 0 ) { return GF_POLYGON_CONVEX_CW ; } return GF_POLYGON_CONVEX_LINE ; } 