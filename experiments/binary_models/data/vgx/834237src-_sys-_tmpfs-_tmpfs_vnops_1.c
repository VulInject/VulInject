int tmpfs_rename_enter ( struct mount * mount , struct tmpfs_mount * tmpfs , struct ucred * cred , struct vnode * fdvp , struct tmpfs_node * fdnode , struct componentname * fcnp , struct tmpfs_dirent * * fde_ret , struct vnode * * fvp_ret , struct vnode * tdvp , struct tmpfs_node * tdnode , struct componentname * tcnp , struct tmpfs_dirent * * tde_ret , struct vnode * * tvp_ret ) { int error ; KASSERT ( mount != NULL ) ; KASSERT ( tmpfs != NULL ) ; KASSERT ( fdvp != NULL ) ; KASSERT ( fdnode != NULL ) ; KASSERT ( fcnp != NULL ) ; KASSERT ( fde_ret != NULL ) ; KASSERT ( fvp_ret != NULL ) ; KASSERT ( tdvp != NULL ) ; KASSERT ( tdnode != NULL ) ; KASSERT ( tcnp != NULL ) ; KASSERT ( tvp_ret != NULL ) ; KASSERT ( fdnode -> tn_vnode == fdvp ) ; KASSERT ( tdnode -> tn_vnode == tdvp ) ; KASSERT ( fdnode -> tn_type == VDIR ) ; KASSERT ( tdnode -> tn_type == VDIR ) ; if ( fdvp == tdvp ) { KASSERT ( fdnode == tdnode ) ; error = tmpfs_rename_enter_common ( mount , tmpfs , cred , fdvp , fdnode , fcnp , fde_ret , fvp_ret , tcnp , tde_ret , tvp_ret ) ; } else { KASSERT ( fdnode != tdnode ) ; error = tmpfs_rename_enter_separate ( mount , tmpfs , cred , fdvp , fdnode , fcnp , fde_ret , fvp_ret , tdvp , tdnode , tcnp , tde_ret , tvp_ret ) ; } if ( error ) { return error ; } KASSERT ( * fde_ret != NULL ) ; KASSERT ( * fvp_ret != NULL ) ; KASSERT ( ( * tde_ret == NULL ) == ( * tvp_ret == NULL ) ) ; KASSERT ( ( * tde_ret == NULL ) || ( ( * tde_ret ) -> td_node != NULL ) ) ; KASSERT ( ( * tde_ret == NULL ) || ( ( * tde_ret ) -> td_node -> tn_vnode == * tvp_ret ) ) ; KASSERT ( VOP_ISLOCKED ( fdvp ) == LK_EXCLUSIVE ) ; KASSERT ( VOP_ISLOCKED ( * fvp_ret ) == LK_EXCLUSIVE ) ; KASSERT ( VOP_ISLOCKED ( tdvp ) == LK_EXCLUSIVE ) ; KASSERT ( ( * tvp_ret == NULL ) || ( VOP_ISLOCKED ( * tvp_ret ) == LK_EXCLUSIVE ) ) ; KASSERT ( * fvp_ret != fdvp ) ; KASSERT ( * fvp_ret != tdvp ) ; KASSERT ( * tvp_ret != fdvp ) ; KASSERT ( * tvp_ret != tdvp ) ; return 0 ; } 