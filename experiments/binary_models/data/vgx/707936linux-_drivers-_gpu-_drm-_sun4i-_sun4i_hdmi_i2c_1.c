int sun4i_hdmi_i2c_create ( struct device * dev , struct sun4i_hdmi * hdmi ) { struct i2c_adapter * adap ; int ret = 0 ; ret = sun4i_ddc_create ( hdmi , hdmi -> ddc_parent_clk ) ; if ( ret ) { return ret ; } ret = sun4i_hdmi_init_regmap_fields ( hdmi ) ; if ( ret ) { return ret ; } adap = devm_kzalloc ( dev , sizeof ( * adap ) , GFP_KERNEL ) ; adap -> owner = THIS_MODULE ; adap -> class = I2C_CLASS_DDC ; adap -> algo = & sun4i_hdmi_i2c_algorithm ; strlcpy ( adap -> name , "sun4i_hdmi_i2c adapter" , sizeof ( adap -> name ) ) ; i2c_set_adapdata ( adap , hdmi ) ; ret = i2c_add_adapter ( adap ) ; if ( ret ) { return ret ; } hdmi -> i2c = adap ; return ret ; } 