static int get_gpt_info ( struct blk_desc * dev_desc ) { int valid_parts = 0 , p , ret ; struct disk_partition info ; struct disk_part * new_disk_part ; INIT_LIST_HEAD ( & disk_partitions ) ; for ( p = 1 ; p <= MAX_SEARCH_PARTITIONS ; p ++ ) { ret = part_get_info ( dev_desc , p , & info ) ; new_disk_part = allocate_disk_part ( & info , valid_parts + 1 ) ; if ( IS_ERR ( new_disk_part ) ) { out } list_add_tail ( & new_disk_part -> list , & disk_partitions ) ; valid_parts ++ ; } if ( valid_parts == 0 ) { printf ( "** No valid partitions found **\n" ) ; out } return valid_parts ; out if ( valid_parts >= 1 ) { del_gpt_info ( ) ; } return - ENODEV ; } 