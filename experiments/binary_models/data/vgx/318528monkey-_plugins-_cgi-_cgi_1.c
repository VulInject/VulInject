int mk_cgi_stage30 ( struct mk_plugin * plugin , struct mk_http_session * cs , struct mk_http_request * sr , int n_params , struct mk_list * params ) { char * interpreter ; char * mimetype = NULL ; struct mk_vhost_handler_param * param ; ( void ) plugin ; const char * const file = sr -> real_path . data ; if ( ! sr -> file_info . is_file ) { return MK_PLUGIN_RET_NOT_ME ; } if ( cgi_req_get ( cs -> socket ) ) { PLUGIN_TRACE ( "Error, someone tried to retry\n" ) ; return MK_PLUGIN_RET_CONTINUE ; } if ( n_params > 0 ) { param = mk_api -> handler_param_get ( 0 , params ) ; if ( param ) { interpreter = param -> p . data ; } param = mk_api -> handler_param_get ( 0 , params ) ; if ( param ) { mimetype = param -> p . data ; } } int status = do_cgi ( file , sr -> uri_processed . data , sr , cs , plugin , interpreter , mimetype ) ; mk_api -> header_set_http_status ( sr , status ) ; if ( status != 200 ) { return MK_PLUGIN_RET_CLOSE_CONX ; } sr -> headers . cgi = SH_CGI ; return MK_PLUGIN_RET_CONTINUE ; } 