static int sparx5_tc_setup_qdisc_ets ( struct net_device * ndev , struct tc_ets_qopt_offload * qopt ) { struct tc_ets_qopt_offload_replace_params * params = & qopt -> replace_params ; struct sparx5_port * port = netdev_priv ( ndev ) ; int i ; if ( qopt -> parent != TC_H_ROOT ) { return - EOPNOTSUPP ; } switch ( qopt -> command ) { case TC_ETS_REPLACE : if ( params -> bands != SPX5_PRIOS ) { return - EOPNOTSUPP ; } for ( i = 0 ; i < SPX5_PRIOS ; ++ i ) { if ( params -> quanta [ i ] && params -> weights [ i ] == 0 ) { pr_err ( "Invalid ets configuration; band %d has weight zero" , i ) ; return - EINVAL ; } } return sparx5_tc_ets_add ( port , params ) ; case TC_ETS_DESTROY : return sparx5_tc_ets_del ( port ) ; case TC_ETS_GRAFT : return - EOPNOTSUPP ; default : return - EOPNOTSUPP ; } return - EOPNOTSUPP ; } 