static void display_vrf_import_rt ( struct vty * vty , struct vrf_irt_node * irt , json_object * json ) { const uint8_t * pnt ; uint8_t type , sub_type ; struct ecommunity_as eas ; struct ecommunity_ip eip ; struct listnode * node , * nnode ; struct bgp * tmp_bgp_vrf = NULL ; json_object * json_rt = NULL ; json_object * json_vrfs = NULL ; char rt_buf [ RT_ADDRSTRLEN ] ; if ( json ) { json_rt = json_object_new_object ( ) ; json_vrfs = json_object_new_array ( ) ; } pnt = ( uint8_t * ) & irt -> rt . val ; type = * pnt ++ ; sub_type = * pnt ++ ; if ( sub_type != ECOMMUNITY_ROUTE_TARGET ) { return ; } switch ( type ) { case ECOMMUNITY_ENCODE_AS : eas . as = ( * pnt ++ << 8 ) ; eas . as |= ( * pnt ++ ) ; ptr_get_be32 ( pnt , & eas . val ) ; snprintf ( rt_buf , sizeof ( rt_buf ) , "%u:%u" , eas . as , eas . val ) ; if ( json ) { json_object_string_add ( json_rt , "rt" , rt_buf ) ; } else { vty_out ( vty , "Route-target: %s" , rt_buf ) ; } break ; case ECOMMUNITY_ENCODE_IP : memcpy ( & eip . ip , pnt , 4 ) ; pnt += 4 ; eip . val = ( * pnt ++ << 8 ) ; eip . val |= ( * pnt ++ ) ; snprintfrr ( rt_buf , sizeof ( rt_buf ) , "%pI4:%u" , & eip . ip , eip . val ) ; if ( json ) { json_object_string_add ( json_rt , "rt" , rt_buf ) ; } else { vty_out ( vty , "Route-target: %s" , rt_buf ) ; } break ; case ECOMMUNITY_ENCODE_AS4 : pnt = ptr_get_be32 ( pnt , & eas . val ) ; eas . val = ( * pnt ++ << 8 ) ; eas . val |= ( * pnt ++ ) ; snprintf ( rt_buf , sizeof ( rt_buf ) , "%u:%u" , eas . as , eas . val ) ; if ( json ) { json_object_string_add ( json_rt , "rt" , rt_buf ) ; } else { vty_out ( vty , "Route-target: %s" , rt_buf ) ; } break ; default : return ; } if ( ! json ) { vty_out ( vty , "\nList of VRFs importing routes with this route-target:\n" ) ; } for ( ALL_LIST_ELEMENTS ( irt -> vrfs , node , nnode , tmp_bgp_vrf ) ; ) { if ( json ) { json_object_array_add ( json_vrfs , json_object_new_string ( vrf_id_to_name ( tmp_bgp_vrf -> vrf_id ) ) ) ; } else { vty_out ( vty , "  %s\n" , vrf_id_to_name ( tmp_bgp_vrf -> vrf_id ) ) ; } } if ( json ) { json_object_object_add ( json_rt , "vrfs" , json_vrfs ) ; json_object_object_add ( json , rt_buf , json_rt ) ; } } 