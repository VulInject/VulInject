_cairo_xlib_shm_surface_get_ximage ( , ) { cairo_xlib_shm_surface_t * shm = ( cairo_xlib_shm_surface_t * ) surface ; int native_byte_order = _cairo_is_little_endian ( ) ?LSBFirst : MSBFirst ; cairo_format_masks_t image_masks ; int ret ; ret = _pixman_format_to_masks ( shm -> image . pixman_format , & image_masks ) ; ximage -> width = shm -> image . width ; ximage -> height = shm -> image . height ; ximage -> format = ZPixmap ; ximage -> data = ( char * ) shm -> image . data ; ximage -> obdata = ( char * ) & shm -> info -> pool -> shm ; ximage -> byte_order = native_byte_order ; ximage -> bitmap_unit = 32 ; ximage -> bitmap_bit_order = native_byte_order ; ximage -> bitmap_pad = 32 ; ximage -> depth = shm -> image . depth ; ximage -> bytes_per_line = shm -> image . stride ; ximage -> bits_per_pixel = image_masks . bpp ; ximage -> red_mask = image_masks . red_mask ; ximage -> green_mask = image_masks . green_mask ; ximage -> blue_mask = image_masks . blue_mask ; ximage -> xoffset = 0 ; ret = XInitImage ( ximage ) ; assert ( ret != 0 ) ; } 