void LogExit ( const char * string ) { int i , numSorted ; gclient_t * cl ; G_LogPrintf ( "Exit: %s\n" , string ) ; level . intermissionQueued = level . time ; trap_SetConfigstring ( CS_INTERMISSION , "1" ) ; numSorted = level . numConnectedClients ; if ( numSorted > 32 ) { numSorted = 32 ; } if ( g_gametype . integer >= GT_TEAM ) { G_LogPrintf ( "red:%i  blue:%i\n" , level . teamScores [ TEAM_RED ] , level . teamScores [ TEAM_BLUE ] ) ; } for ( i = 0 ; i < numSorted ; i ++ ) { int ping ; cl = & level . clients [ level . sortedClients [ i ] ] ; if ( cl -> sess . sessionTeam == TEAM_SPECTATOR ) { continue ; } if ( cl -> pers . connected == CON_CONNECTING ) { continue ; } ping = cl -> ps . ping < 999 ?cl -> ps . ping : 999 ; G_LogPrintf ( "score: %i  ping: %i  client: %i %s\n" , cl -> ps . persistant [ PERS_SCORE ] , ping , level . sortedClients [ i ] , cl -> pers . netname ) ; } if ( g_gametype . integer == GT_WOLF_STOPWATCH ) { char cs [ MAX_STRING_CHARS ] ; int winner , defender ; trap_GetConfigstring ( CS_MULTI_INFO , cs , sizeof ( cs ) ) ; defender = atoi ( Info_ValueForKey ( cs , "defender" ) ) ; trap_GetConfigstring ( CS_MULTI_MAPWINNER , cs , sizeof ( cs ) ) ; winner = atoi ( Info_ValueForKey ( cs , "winner" ) ) ; if ( ! g_currentRound . integer ) { if ( winner == defender ) { trap_Cvar_Set ( "g_nextTimeLimit" , va ( "%f" , g_timelimit . value ) ) ; } else { trap_Cvar_Set ( "g_nextTimeLimit" , va ( "%f" , ( level . time - level . startTime ) / 60000.f ) ) ; } } else { trap_Cvar_Set ( "g_nextTimeLimit" , "0" ) ; } trap_Cvar_Set ( "g_currentRound" , va ( "%i" , ! g_currentRound . integer ) ) ; } } 