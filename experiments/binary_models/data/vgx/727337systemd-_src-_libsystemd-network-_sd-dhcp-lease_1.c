int dhcp_lease_insert_private_option ( sd_dhcp_lease * lease , uint8_t tag , const void * data , uint8_t len ) { struct sd_dhcp_raw_option * option , * before = NULL ; assert ( lease ) ; LIST_FOREACH ( , , ) { if ( tag < cur -> tag ) { before = cur ; break ; } if ( tag == cur -> tag ) { log_debug ( "Ignoring duplicate option, tagged %i." , tag ) ; return 0 ; } } option = new ( sd_dhcp_raw_option , 1 ) ; if ( ! option ) { return - ENOMEM ; } option -> tag = tag ; option -> length = len ; option -> data = memdup ( data , len ) ; if ( ! option -> data ) { return - ENOMEM ; } LIST_INSERT_BEFORE ( options , lease -> private_options , before , option ) ; return 0 ; } 