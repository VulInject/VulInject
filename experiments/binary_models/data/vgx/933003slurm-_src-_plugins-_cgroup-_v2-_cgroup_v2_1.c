static int _get_controllers ( char * path , bitstr_t * ctl_bitmap ) { char * buf , * ptr , * save_ptr , * ctl_filepath = NULL ; size_t sz ; xassert ( ctl_bitmap ) ; xstrfmtcat ( ctl_filepath , "%s/cgroup.controllers" , path ) ; if ( common_file_read_content ( ctl_filepath , & buf , & sz ) != SLURM_SUCCESS || ! buf ) { error ( "cannot read %s: %m" , ctl_filepath ) ; return SLURM_ERROR ; } xfree ( ctl_filepath ) ; ptr = strtok_r ( buf , " " , & save_ptr ) ; while ( ptr ) { for ( int i = 0 ; i < CG_CTL_CNT ; i ++ ) { if ( ! xstrcmp ( ctl_names [ i ] , "" ) ) { continue ; } if ( ! xstrcasecmp ( ctl_names [ i ] , ptr ) ) { bit_set ( ctl_bitmap , i ) ; break ; } } ptr = strtok_r ( NULL , " " , & save_ptr ) ; } xfree ( buf ) ; for ( int i = 0 ; i < CG_CTL_CNT ; i ++ ) { if ( ( i == CG_DEVICES ) || ( i == CG_TRACK ) ) { continue ; } if ( invoc_id && ! bit_test ( ctl_bitmap , i ) ) { error ( "Controller %s is not enabled!" , ctl_names [ i ] ) ; } } return SLURM_SUCCESS ; } 