static int stm32_fmc2_nfc_parse_child ( struct stm32_fmc2_nfc * nfc , ofnode node ) { struct stm32_fmc2_nand * nand = & nfc -> nand ; int cs [ FMC2_MAX_CE ] ; int ret , i ; if ( ! ofnode_get_property ( node , "reg" , & nand -> ncs ) ) { return - EINVAL ; } nand -> ncs /= sizeof ( u32 ) ; if ( ! nand -> ncs ) { log_err ( "Invalid reg property size\n" ) ; return - EINVAL ; } ret = ofnode_read_u32_array ( node , "reg" , cs , nand -> ncs ) ; if ( ret < 0 ) { log_err ( "Could not retrieve reg property\n" ) ; return - EINVAL ; } for ( i = 0 ; i < nand -> ncs ; i ++ ) { if ( cs [ i ] >= FMC2_MAX_CE ) { log_err ( "Invalid reg value: %d\n" , nand -> cs_used [ i ] ) ; return - EINVAL ; } if ( nfc -> cs_assigned & BIT ( cs [ i ] ) ) { log_err ( "Cs already assigned: %d\n" , nand -> cs_used [ i ] ) ; return - EINVAL ; } nfc -> cs_assigned |= BIT ( cs [ i ] ) ; nand -> cs_used [ i ] = cs [ i ] ; } gpio_request_by_name_nodev ( node , "wp-gpios" , 0 , & nand -> wp_gpio , GPIOD_IS_OUT | GPIOD_IS_OUT_ACTIVE ) ; nand -> chip . flash_node = node ; return 0 ; } 