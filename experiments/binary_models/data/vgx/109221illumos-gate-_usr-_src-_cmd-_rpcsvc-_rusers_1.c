static int collectnames ( void * resultsp , struct netbuf * raddrp , struct netconfig * nconf ) { struct utmpidlearr utmpidlearr ; struct entry * entryp , * lim ; struct nd_hostservlist * hs ; char host [ MACHINELEN + 1 ] ; utmpidlearr = * ( utmpidlearr * ) resultsp ; if ( netdir_getbyaddr ( nconf , & hs , raddrp ) ) { netdir_perror ( "netdir_getbyaddr" ) ; ( void ) sprintf ( host , "%.*s" , MACHINELEN , taddr2uaddr ( nconf , raddrp ) ) ; } else { ( void ) sprintf ( host , "%.*s" , MACHINELEN , hs -> h_hostservs -> h_host ) ; netdir_free ( ( char * ) hs , ND_HOSTSERVLIST ) ; } if ( curentry >= total_entries ) { struct entry * tmp ; total_entries += NUMENTRIES ; if ( ( tmp = realloc ( entry , sizeof ( entry ) * total_entries ) ) == NULL ) { return ( 1 ) ; } entry = tmp ; } lim = entry + curentry ; for ( entryp = entry ; entryp < lim ; entryp ++ ) { if ( strcmp ( entryp -> machine , host ) == 0 ) { return ( 0 ) ; } } return ( print_info ( ( utmpidlearr * ) resultsp , host ) ) ; } 