static int acpi_scan_hot_remove ( struct acpi_device * device ) { acpi_handle handle = device -> handle ; unsigned long long sta ; acpi_status status ; if ( device -> handler && device -> handler -> hotplug . demand_offline ) { if ( ! acpi_scan_is_offline ( device , true ) ) { return - EBUSY ; } } else { int error = acpi_scan_try_to_offline ( device ) ; } acpi_handle_debug ( handle , "Ejecting\n" ) ; acpi_bus_trim ( device ) ; acpi_evaluate_lck ( handle , 0 ) ; status = acpi_evaluate_ej0 ( handle ) ; if ( status == AE_NOT_FOUND ) { return - ENODEV ; } if ( ACPI_FAILURE ( status ) ) { return - EIO ; } status = acpi_evaluate_integer ( handle , "_STA" , NULL , & sta ) ; if ( ACPI_FAILURE ( status ) ) { acpi_handle_warn ( handle , "Status check after eject failed (0x%x)\n" , status ) ; } if ( sta & ACPI_STA_DEVICE_ENABLED ) { acpi_handle_warn ( handle , "Eject incomplete - status 0x%llx\n" , sta ) ; } return 0 ; } 