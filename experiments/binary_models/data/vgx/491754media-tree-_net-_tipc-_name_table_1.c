static struct name_seq * tipc_nameseq_create ( u32 type , struct hlist_head * seq_head ) { struct name_seq * nseq = kzalloc ( sizeof ( * nseq ) , GFP_ATOMIC ) ; struct sub_seq * sseq = tipc_subseq_alloc ( 1 ) ; if ( ! nseq || ! sseq ) { pr_warn ( "Name sequence creation failed, no memory\n" ) ; kfree ( sseq ) ; return NULL ; } spin_lock_init ( & nseq -> lock ) ; nseq -> type = type ; nseq -> sseqs = sseq ; nseq -> alloc = 1 ; INIT_HLIST_NODE ( & nseq -> ns_list ) ; INIT_LIST_HEAD ( & nseq -> subscriptions ) ; hlist_add_head_rcu ( & nseq -> ns_list , seq_head ) ; return nseq ; } 