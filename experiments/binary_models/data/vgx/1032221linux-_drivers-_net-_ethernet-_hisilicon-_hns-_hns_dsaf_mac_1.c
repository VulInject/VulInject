static int hns_mac_register_phydev ( struct mii_bus * mdio , struct hns_mac_cb * mac_cb , u32 addr ) { struct phy_device * phy ; const char * phy_type ; bool is_c45 ; int rc ; rc = fwnode_property_read_string ( mac_cb -> fw_port , "phy-mode" , & phy_type ) ; if ( rc < 0 ) { return rc ; } if ( ! strcmp ( phy_type , phy_modes ( PHY_INTERFACE_MODE_XGMII ) ) ) { is_c45 = true ; } if ( ! strcmp ( phy_type , phy_modes ( PHY_INTERFACE_MODE_SGMII ) ) ) { is_c45 = false ; } else { return - ENODATA ; } phy = get_phy_device ( mdio , addr , is_c45 ) ; phy -> irq = mdio -> irq [ addr ] ; rc = phy_device_register ( phy ) ; if ( rc ) { phy_device_free ( phy ) ; dev_err ( & mdio -> dev , "registered phy fail at address %i\n" , addr ) ; return - ENODEV ; } mac_cb -> phy_dev = phy ; dev_dbg ( & mdio -> dev , "registered phy at address %i\n" , addr ) ; return 0 ; } 