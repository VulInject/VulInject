static int task_bp_pinned ( int cpu , struct perf_event * bp , enum bp_type_idx type ) { struct rhlist_head * head , * pos ; struct perf_event * iter ; int count = 0 ; assert_bp_constraints_lock_held ( bp ) ; rcu_read_lock ( ) ; head = rhltable_lookup ( & task_bps_ht , & bp -> hw . target , task_bps_ht_params ) ; rhl_for_each_entry_rcu ( , , , ) { if ( find_slot_idx ( iter -> attr . bp_type ) != type ) { continue ; } if ( iter -> cpu >= 0 ) { if ( cpu == - 1 ) { count = - 1 ; out } if ( cpu != iter -> cpu ) { continue ; } } count += hw_breakpoint_weight ( iter ) ; } out rcu_read_unlock ( ) ; return count ; } 