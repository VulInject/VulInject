STATIC int xfs_iwalk_ag_recs ( struct xfs_iwalk_ag * iwag ) { struct xfs_mount * mp = iwag -> mp ; struct xfs_trans * tp = iwag -> tp ; struct xfs_perag * pag = iwag -> pag ; xfs_ino_t ino ; unsigned int i , j ; int error ; for ( i = 0 ; i < iwag -> nr_recs ; i ++ ) { struct xfs_inobt_rec_incore * irec = & iwag -> recs [ i ] ; trace_xfs_iwalk_ag_rec ( mp , pag -> pag_agno , irec ) ; if ( xfs_pwork_want_abort ( & iwag -> pwork ) ) { return 0 ; } if ( iwag -> inobt_walk_fn ) { error = iwag -> inobt_walk_fn ( mp , tp , pag -> pag_agno , irec , iwag -> data ) ; if ( error ) { return error ; } } for ( j = 0 ; j < XFS_INODES_PER_CHUNK ; j ++ ) { if ( xfs_pwork_want_abort ( & iwag -> pwork ) ) { return 0 ; } if ( XFS_INOBT_MASK ( j ) & irec -> ir_free ) { continue ; } ino = XFS_AGINO_TO_INO ( mp , pag -> pag_agno , irec -> ir_startino + j ) ; error = iwag -> iwalk_fn ( mp , tp , ino , iwag -> data ) ; if ( error ) { return error ; } } } return 0 ; } 