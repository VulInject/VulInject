static int blktrans_ioctl ( struct block_device * bdev , fmode_t mode , unsigned int cmd , unsigned long arg ) { struct mtd_blktrans_dev * dev = blktrans_dev_get ( bdev -> bd_disk ) ; int ret = - ENXIO ; mutex_lock ( & dev -> lock ) ; if ( ! dev -> mtd ) { unlock } switch ( cmd ) { case BLKFLSBUF : ret = dev -> tr -> flush ?dev -> tr -> flush ( dev ) : 0 ; break ; default : ret = - ENOTTY ; } unlock mutex_unlock ( & dev -> lock ) ; blktrans_dev_put ( dev ) ; return ret ; } 