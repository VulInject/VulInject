static void CalculateSwathAndDETConfiguration ( bool ForceSingleDPP , int NumberOfActivePlanes , unsigned int DETBufferSizeInKByte , double MaximumSwathWidthLuma [ ] , double MaximumSwathWidthChroma [ ] , enum scan_direction_class SourceScan [ ] , enum source_format_class SourcePixelFormat [ ] , enum dm_swizzle_mode SurfaceTiling [ ] , int ViewportWidth [ ] , int ViewportHeight [ ] , int SurfaceWidthY [ ] , int SurfaceWidthC [ ] , int SurfaceHeightY [ ] , int SurfaceHeightC [ ] , int Read256BytesBlockHeightY [ ] , int Read256BytesBlockHeightC [ ] , int Read256BytesBlockWidthY [ ] , int Read256BytesBlockWidthC [ ] , enum odm_combine_mode ODMCombineEnabled [ ] , int BlendingAndTiming [ ] , int BytePerPixY [ ] , int BytePerPixC [ ] , double BytePerPixDETY [ ] , double BytePerPixDETC [ ] , int HActive [ ] , double HRatio [ ] , double HRatioChroma [ ] , int DPPPerPlane [ ] , int swath_width_luma_ub [ ] , int swath_width_chroma_ub [ ] , double SwathWidth [ ] , double SwathWidthChroma [ ] , int SwathHeightY [ ] , int SwathHeightC [ ] , unsigned int DETBufferSizeY [ ] , unsigned int DETBufferSizeC [ ] , bool ViewportSizeSupportPerPlane [ ] , bool * ViewportSizeSupport ) { int MaximumSwathHeightY [ DC__NUM_DPP__MAX ] ; int MaximumSwathHeightC [ DC__NUM_DPP__MAX ] ; int MinimumSwathHeightY ; int MinimumSwathHeightC ; int RoundedUpMaxSwathSizeBytesY ; int RoundedUpMaxSwathSizeBytesC ; int RoundedUpMinSwathSizeBytesY ; int RoundedUpMinSwathSizeBytesC ; int RoundedUpSwathSizeBytesY ; int RoundedUpSwathSizeBytesC ; int SwathWidthSingleDPP [ DC__NUM_DPP__MAX ] ; double SwathWidthSingleDPPChroma [ DC__NUM_DPP__MAX ] ; int k ; CalculateSwathWidth ( ForceSingleDPP , NumberOfActivePlanes , SourcePixelFormat , SourceScan , ViewportWidth , ViewportHeight , SurfaceWidthY , SurfaceWidthC , SurfaceHeightY , SurfaceHeightC , ODMCombineEnabled , BytePerPixY , BytePerPixC , Read256BytesBlockHeightY , Read256BytesBlockHeightC , Read256BytesBlockWidthY , Read256BytesBlockWidthC , BlendingAndTiming , HActive , HRatio , DPPPerPlane , SwathWidthSingleDPP , SwathWidthSingleDPPChroma , SwathWidth , SwathWidthChroma , MaximumSwathHeightY , MaximumSwathHeightC , swath_width_luma_ub , swath_width_chroma_ub ) ; * ViewportSizeSupport = true ; for ( k = 0 ; k < NumberOfActivePlanes ; ++ k ) { if ( ( SourcePixelFormat [ k ] == dm_444_64 || SourcePixelFormat [ k ] == dm_444_32 || SourcePixelFormat [ k ] == dm_444_16 || SourcePixelFormat [ k ] == dm_mono_16 || SourcePixelFormat [ k ] == dm_mono_8 || SourcePixelFormat [ k ] == dm_rgbe ) ) { if ( SurfaceTiling [ k ] == dm_sw_linear || ( SourcePixelFormat [ k ] == dm_444_64 && ( SurfaceTiling [ k ] == dm_sw_64kb_s || SurfaceTiling [ k ] == dm_sw_64kb_s_t || SurfaceTiling [ k ] == dm_sw_64kb_s_x ) && SourceScan [ k ] != dm_vert ) ) { MinimumSwathHeightY = MaximumSwathHeightY [ k ] ; } if ( SourcePixelFormat [ k ] == dm_444_8 && SourceScan [ k ] == dm_vert ) { MinimumSwathHeightY = MaximumSwathHeightY [ k ] ; } else { MinimumSwathHeightY = MaximumSwathHeightY [ k ] / 2 ; } MinimumSwathHeightC = MaximumSwathHeightC [ k ] ; } else { if ( SurfaceTiling [ k ] == dm_sw_linear ) { MinimumSwathHeightY = MaximumSwathHeightY [ k ] ; MinimumSwathHeightC = MaximumSwathHeightC [ k ] ; } if ( SourcePixelFormat [ k ] == dm_rgbe_alpha && SourceScan [ k ] == dm_vert ) { MinimumSwathHeightY = MaximumSwathHeightY [ k ] / 2 ; MinimumSwathHeightC = MaximumSwathHeightC [ k ] ; } if ( SourcePixelFormat [ k ] == dm_rgbe_alpha ) { MinimumSwathHeightY = MaximumSwathHeightY [ k ] / 2 ; MinimumSwathHeightC = MaximumSwathHeightC [ k ] / 2 ; } if ( SourcePixelFormat [ k ] == dm_420_8 && SourceScan [ k ] == dm_vert ) { MinimumSwathHeightY = MaximumSwathHeightY [ k ] ; MinimumSwathHeightC = MaximumSwathHeightC [ k ] / 2 ; } else { MinimumSwathHeightC = MaximumSwathHeightC [ k ] / 2 ; MinimumSwathHeightY = MaximumSwathHeightY [ k ] / 2 ; } } RoundedUpMaxSwathSizeBytesY = swath_width_luma_ub [ k ] * BytePerPixDETY [ k ] * MaximumSwathHeightY [ k ] ; RoundedUpMinSwathSizeBytesY = swath_width_luma_ub [ k ] * BytePerPixDETY [ k ] * MinimumSwathHeightY ; if ( SourcePixelFormat [ k ] == dm_420_10 ) { RoundedUpMaxSwathSizeBytesY = dml_ceil ( ( double ) RoundedUpMaxSwathSizeBytesY , 256 ) ; RoundedUpMinSwathSizeBytesY = dml_ceil ( ( double ) RoundedUpMinSwathSizeBytesY , 256 ) ; } RoundedUpMaxSwathSizeBytesC = swath_width_chroma_ub [ k ] * BytePerPixDETC [ k ] * MaximumSwathHeightC [ k ] ; RoundedUpMinSwathSizeBytesC = swath_width_chroma_ub [ k ] * BytePerPixDETC [ k ] * MinimumSwathHeightC ; if ( SourcePixelFormat [ k ] == dm_420_10 ) { RoundedUpMaxSwathSizeBytesC = dml_ceil ( RoundedUpMaxSwathSizeBytesC , 256 ) ; RoundedUpMinSwathSizeBytesC = dml_ceil ( RoundedUpMinSwathSizeBytesC , 256 ) ; } if ( RoundedUpMaxSwathSizeBytesY + RoundedUpMaxSwathSizeBytesC <= DETBufferSizeInKByte * 1024 / 2 ) { SwathHeightY [ k ] = MaximumSwathHeightY [ k ] ; SwathHeightC [ k ] = MaximumSwathHeightC [ k ] ; RoundedUpSwathSizeBytesY = RoundedUpMaxSwathSizeBytesY ; RoundedUpSwathSizeBytesC = RoundedUpMaxSwathSizeBytesC ; } if ( RoundedUpMaxSwathSizeBytesY >= 1.5 * RoundedUpMaxSwathSizeBytesC && RoundedUpMinSwathSizeBytesY + RoundedUpMaxSwathSizeBytesC <= DETBufferSizeInKByte * 1024 / 2 ) { SwathHeightY [ k ] = MinimumSwathHeightY ; SwathHeightC [ k ] = MaximumSwathHeightC [ k ] ; RoundedUpSwathSizeBytesY = RoundedUpMinSwathSizeBytesY ; RoundedUpSwathSizeBytesC = RoundedUpMaxSwathSizeBytesC ; } if ( RoundedUpMaxSwathSizeBytesY < 1.5 * RoundedUpMaxSwathSizeBytesC && RoundedUpMaxSwathSizeBytesY + RoundedUpMinSwathSizeBytesC <= DETBufferSizeInKByte * 1024 / 2 ) { SwathHeightY [ k ] = MaximumSwathHeightY [ k ] ; SwathHeightC [ k ] = MinimumSwathHeightC ; RoundedUpSwathSizeBytesY = RoundedUpMaxSwathSizeBytesY ; RoundedUpSwathSizeBytesC = RoundedUpMinSwathSizeBytesC ; } else { SwathHeightY [ k ] = MinimumSwathHeightY ; SwathHeightC [ k ] = MinimumSwathHeightC ; RoundedUpSwathSizeBytesY = RoundedUpMinSwathSizeBytesY ; RoundedUpSwathSizeBytesC = RoundedUpMinSwathSizeBytesC ; } { double actDETBufferSizeInKByte = dml_ceil ( DETBufferSizeInKByte , 64 ) ; if ( SwathHeightC [ k ] == 0 ) { DETBufferSizeY [ k ] = actDETBufferSizeInKByte * 1024 ; DETBufferSizeC [ k ] = 0 ; } if ( RoundedUpSwathSizeBytesY <= 1.5 * RoundedUpSwathSizeBytesC ) { DETBufferSizeY [ k ] = actDETBufferSizeInKByte * 1024 / 2 ; DETBufferSizeC [ k ] = actDETBufferSizeInKByte * 1024 / 2 ; } else { DETBufferSizeY [ k ] = dml_floor ( actDETBufferSizeInKByte * 1024 * 2 / 3 , 1024 ) ; DETBufferSizeC [ k ] = actDETBufferSizeInKByte * 1024 / 3 ; } if ( RoundedUpMinSwathSizeBytesY + RoundedUpMinSwathSizeBytesC > actDETBufferSizeInKByte * 1024 / 2 || SwathWidth [ k ] > MaximumSwathWidthLuma [ k ] || ( SwathHeightC [ k ] > 0 && SwathWidthChroma [ k ] > MaximumSwathWidthChroma [ k ] ) ) { * ViewportSizeSupport = false ; ViewportSizeSupportPerPlane [ k ] = false ; } else { ViewportSizeSupportPerPlane [ k ] = true ; } } } } 