LIBIMOBILEDEVICE_API webinspector_error_t webinspector_send ( webinspector_client_t client , plist_t plist ) { webinspector_error_t res = WEBINSPECTOR_E_UNKNOWN_ERROR ; uint32_t offset = 0 ; int is_final_message = 0 ; char * packet = NULL ; uint32_t packet_length = 0 ; debug_info ( "Sending webinspector message..." ) ; debug_plist ( plist ) ; plist_to_bin ( plist , & packet , & packet_length ) ; if ( ! packet || packet_length == 0 ) { debug_info ( "Error converting plist to binary." ) ; return res ; } { if ( packet_length < WEBINSPECTOR_PARTIAL_PACKET_CHUNK_SIZE ) { is_final_message = 1 ; } else { is_final_message = 0 ; } plist_t outplist = plist_new_dict ( ) ; if ( ! is_final_message ) { plist_dict_set_item ( outplist , "WIRPartialMessageKey" , plist_new_data ( packet + offset , WEBINSPECTOR_PARTIAL_PACKET_CHUNK_SIZE ) ) ; offset += WEBINSPECTOR_PARTIAL_PACKET_CHUNK_SIZE ; packet_length -= WEBINSPECTOR_PARTIAL_PACKET_CHUNK_SIZE ; } else { plist_dict_set_item ( outplist , "WIRFinalMessageKey" , plist_new_data ( packet + offset , packet_length ) ) ; offset += packet_length ; packet_length -= packet_length ; } res = webinspector_error ( property_list_service_send_binary_plist ( client -> parent , outplist ) ) ; plist_free ( outplist ) ; outplist = NULL ; if ( res != WEBINSPECTOR_E_SUCCESS ) { debug_info ( "Sending plist failed with error %d" , res ) ; return res ; } } packet_length > 0 ; packet = NULL ; return res ; } 