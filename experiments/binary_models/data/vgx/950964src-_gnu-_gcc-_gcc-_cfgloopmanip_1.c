fix_bb_placements ( , , ) { sbitmap in_queue ; basic_block * queue , * qtop , * qbeg , * qend ; struct loop * base_loop ; edge e ; base_loop = from -> loop_father ; if ( base_loop == loops -> tree_root ) { return ; } in_queue = sbitmap_alloc ( last_basic_block ) ; sbitmap_zero ( in_queue ) ; SET_BIT ( in_queue , from -> index ) ; SET_BIT ( in_queue , base_loop -> header -> index ) ; queue = XNEWVEC ( basic_block , base_loop -> num_nodes + 1 ) ; qtop = queue + base_loop -> num_nodes + 1 ; qbeg = queue ; qend = queue + 1 ; * qbeg = from ; while ( qbeg != qend ) { edge_iterator ei ; from = * qbeg ; qbeg ++ ; if ( qbeg == qtop ) { qbeg = queue ; } RESET_BIT ( in_queue , from -> index ) ; if ( from -> loop_father -> header == from ) { if ( ! fix_loop_placement ( from -> loop_father ) ) { continue ; } } else { if ( ! fix_bb_placement ( loops , from ) ) { continue ; } } FOR_EACH_EDGE ( , , ) { if ( e -> flags & EDGE_IRREDUCIBLE_LOOP ) { * irred_invalidated = true ; } } FOR_EACH_EDGE ( , , ) { basic_block pred = e -> src ; struct loop * nca ; if ( e -> flags & EDGE_IRREDUCIBLE_LOOP ) { * irred_invalidated = true ; } if ( TEST_BIT ( in_queue , pred -> index ) ) { continue ; } nca = find_common_loop ( pred -> loop_father , base_loop ) ; if ( pred -> loop_father != base_loop && ( nca == base_loop || nca != pred -> loop_father ) ) { pred = pred -> loop_father -> header ; } if ( ! flow_loop_nested_p ( from -> loop_father , pred -> loop_father ) ) { continue ; } if ( TEST_BIT ( in_queue , pred -> index ) ) { continue ; } * qend = pred ; qend ++ ; if ( qend == qtop ) { qend = queue ; } SET_BIT ( in_queue , pred -> index ) ; } } free ( queue ) ; } 