static int resolver_cb_socket_readable ( struct thread * t ) { struct resolver_state * r = THREAD_ARG ( t ) ; int fd = THREAD_FD ( t ) ; vector_set_index ( r -> read_threads , fd , THREAD_RUNNING ) ; ares_process_fd ( r -> channel , fd , ARES_SOCKET_BAD ) ; if ( vector_lookup ( r -> read_threads , fd ) == THREAD_RUNNING ) { t = NULL ; THREAD_READ_ON ( master , t , resolver_cb_socket_readable , r , fd ) ; vector_set_index ( r -> read_threads , fd , t ) ; } resolver_update_timeouts ( r , NULL ) ; return 0 ; } 