struct mmc_queue_req * mmc_queue_req_find ( struct mmc_queue * mq , struct request * req ) { struct mmc_queue_req * mqrq ; int i = ffz ( mq -> qslots ) ; if ( i >= mq -> qdepth ) { return in ; } mqrq = & mq -> mqrq [ i ] ; WARN_ON ( mqrq -> req || mq -> qcnt >= mq -> qdepth || test_bit ( mqrq -> task_id , & mq -> qslots ) ) ; mqrq -> req = req ; mq -> qcnt += 1 ; __set_bit ( mqrq -> task_id , & mq -> qslots ) ; return mqrq ; } 