int cvs_build_cmd ( char * * * cmd_argv , char * * argv , int argc ) { int cmd_argc , i , cur ; char * cp , * linebuf , * lp ; if ( cmdp -> cmd_defargs == NULL ) { * cmd_argv = argv ; return argc ; } cur = argc + 2 ; cmd_argc = 0 ; * cmd_argv = xcalloc ( cur , sizeof ( char * ) ) ; ( * cmd_argv ) [ cmd_argc ++ ] = argv [ 0 ] ; linebuf = xstrdup ( cmdp -> cmd_defargs ) ; for ( lp = linebuf ; lp != NULL ; ) { cp = strsep ( & lp , " \t\b\f\n\r\t\v" ) ; if ( * cp == '\0' ) { continue ; } if ( cmd_argc == cur ) { cur += 8 ; * cmd_argv = xreallocarray ( * cmd_argv , cur , sizeof ( char * ) ) ; } ( * cmd_argv ) [ cmd_argc ++ ] = cp ; } if ( cmd_argc + argc > cur ) { cur = cmd_argc + argc + 1 ; * cmd_argv = xreallocarray ( * cmd_argv , cur , sizeof ( char * ) ) ; } for ( i = 1 ; i < argc ; i ++ ) { ( * cmd_argv ) [ cmd_argc ++ ] = argv [ i ] ; } ( * cmd_argv ) [ cmd_argc ] = NULL ; return cmd_argc ; } 