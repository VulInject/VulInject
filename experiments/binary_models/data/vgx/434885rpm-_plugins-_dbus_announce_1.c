static rpmRC open_dbus ( rpmPlugin plugin , rpmts ts ) { DBusError err ; int rc = 0 ; struct dbus_announce_data * state = rpmPluginGetData ( plugin ) ; if ( rpmtsFlags ( ts ) & ( RPMTRANS_FLAG_TEST | RPMTRANS_FLAG_BUILD_PROBS ) ) { return RPMRC_OK ; } if ( ! rstreq ( rpmtsRootDir ( ts ) , "/" ) ) { return RPMRC_OK ; } dbus_error_init ( & err ) ; state -> bus = dbus_bus_get_private ( DBUS_BUS_SYSTEM , & err ) ; if ( dbus_error_is_set ( & err ) ) { err } if ( state -> bus ) { rc = dbus_bus_request_name ( state -> bus , "org.rpm.announce" , DBUS_NAME_FLAG_REPLACE_EXISTING , & err ) ; } if ( dbus_error_is_set ( & err ) ) { err } if ( DBUS_REQUEST_NAME_REPLY_PRIMARY_OWNER != rc ) { dbus_announce_close_bus ( state ) ; err } return RPMRC_OK ; err rpmlog ( RPMLOG_WARNING , "dbus_announce plugin: Error connecting to dbus (%s)\n" , err . message ) ; dbus_error_free ( & err ) ; return RPMRC_OK ; } 