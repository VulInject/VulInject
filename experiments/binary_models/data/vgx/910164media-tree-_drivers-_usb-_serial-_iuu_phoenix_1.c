static int iuu_bulk_write ( struct usb_serial_port * port ) { struct iuu_private * priv = usb_get_serial_port_data ( port ) ; cfs_time_t flags ; int result ; int buf_len ; char * buf_ptr = port -> write_urb -> transfer_buffer ; spin_lock_irqsave ( & priv -> lock , flags ) ; * buf_ptr ++ = IUU_UART_ESC ; * buf_ptr ++ = IUU_UART_TX ; * buf_ptr ++ = priv -> writelen ; memcpy ( buf_ptr , priv -> writebuf , priv -> writelen ) ; buf_len = priv -> writelen ; priv -> writelen = 0 ; spin_unlock_irqrestore ( & priv -> lock , flags ) ; dev_dbg ( & port -> dev , "%s - writing %i chars : %*ph\n" , __func__ , buf_len , buf_len , buf_ptr ) ; usb_fill_bulk_urb ( port -> write_urb , port -> serial -> dev , usb_sndbulkpipe ( port -> serial -> dev , port -> bulk_out_endpointAddress ) , port -> write_urb -> transfer_buffer , buf_len + 3 , iuu_rxcmd , port ) ; result = usb_submit_urb ( port -> write_urb , GFP_ATOMIC ) ; usb_serial_port_softint ( port ) ; return result ; } 