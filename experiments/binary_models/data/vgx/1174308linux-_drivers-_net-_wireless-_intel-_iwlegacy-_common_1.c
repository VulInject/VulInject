int il_send_add_sta ( struct il_priv * il , struct il_addsta_cmd * sta , u8 flags ) { struct il_rx_pkt * pkt = NULL ; int ret = 0 ; u8 data [ sizeof ( * sta ) ] ; struct il_host_cmd cmd = { . id = C_ADD_STA . flags = flags . data = data } ; u8 sta_id __maybe_unused = sta -> sta . sta_id ; D_INFO ( "Adding sta %u (%pM) %ssynchronously\n" , sta_id , sta -> sta . addr , flags & CMD_ASYNC ?"a" : "" ) ; if ( flags & CMD_ASYNC ) { cmd . callback = il_add_sta_callback ; } else { cmd . flags |= CMD_WANT_SKB ; might_sleep ( ) ; } cmd . len = il -> ops -> build_addsta_hcmd ( sta , data ) ; ret = il_send_cmd ( il , & cmd ) ; if ( ret ) { return ret ; } pkt = ( il_rx_pkt * ) cmd . reply_page ; ret = il_process_add_sta_resp ( il , sta , pkt , true ) ; il_free_pages ( il , cmd . reply_page ) ; return ret ; } 