static inline int mbcs_getdma_start ( struct mbcs_soft * soft ) { void * mmr_base ; struct getdma * gdma ; uint64_t numPkts ; union cm_control cm_control ; mmr_base = soft -> mmr_base ; gdma = & soft -> getdma ; numPkts = ( gdma -> bytes + ( MBCS_CACHELINE_SIZE - 1 ) ) / MBCS_CACHELINE_SIZE ; mbcs_getdma_set ( mmr_base , tiocx_dma_addr ( gdma -> hostAddr ) , gdma -> localAddr , ( gdma -> localAddr < MB2 ) ?0 : ( gdma -> localAddr < MB4 ) ?1 : ( gdma -> localAddr < MB6 ) ?2 : 3 , numPkts , gdma -> DoneAmoEnable , gdma -> DoneIntEnable , gdma -> peerIO , gdma -> amoHostDest , gdma -> amoModType , gdma -> intrHostDest , gdma -> intrVector ) ; cm_control . cm_control_reg = MBCS_MMR_GET ( mmr_base , MBCS_CM_CONTROL ) ; cm_control . rd_dma_go = 1 ; MBCS_MMR_SET ( mmr_base , MBCS_CM_CONTROL , cm_control . cm_control_reg ) ; return 0 ; } 