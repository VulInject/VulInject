int ubifs_write_master ( struct ubifs_info * c ) { int err , lnum , offs , len ; ubifs_assert ( ! c -> ro_media && ! c -> ro_mount ) ; lnum = UBIFS_MST_LNUM ; offs = c -> mst_offs + c -> mst_node_alsz ; len = UBIFS_MST_NODE_SZ ; if ( offs + UBIFS_MST_NODE_SZ > c -> leb_size ) { err = ubifs_leb_unmap ( c , lnum ) ; if ( err ) { return err ; } offs = 0 ; } c -> mst_offs = offs ; c -> mst_node -> highest_inum = cpu_to_le64 ( c -> highest_inum ) ; err = ubifs_write_node ( c , c -> mst_node , len , lnum , offs ) ; if ( err ) { return err ; } lnum += 1 ; if ( offs == 0 ) { err = ubifs_leb_unmap ( c , lnum ) ; if ( err ) { return err ; } } err = ubifs_write_node ( c , c -> mst_node , len , lnum , offs ) ; return err ; } 