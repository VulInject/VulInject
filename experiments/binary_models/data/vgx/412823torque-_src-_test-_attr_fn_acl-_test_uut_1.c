START_TEST ( ) { pbs_attribute attr ; pbs_attribute newAttr ; memset ( & attr , 0 , sizeof ( attr ) ) ; decode_arst ( & attr , NULL , NULL , "brad@braddaw.com,lauradaw7@gmail.com,fred@farmer.org" , 0 ) ; decode_arst ( & newAttr , NULL , NULL , "brad@gmail.com,lauradaw7@bestgirl.com,fred@farming.org" , 0 ) ; fail_unless ( set_uacl ( & attr , & newAttr , SET ) == 0 ) ; fail_unless ( attr . at_val . at_arst -> as_usedptr == 3 ) ; free_arst ( & attr ) ; free_arst ( & newAttr ) ; memset ( & attr , 0 , sizeof ( attr ) ) ; decode_arst ( & attr , NULL , NULL , "brad@braddaw.com,lauradaw7@gmail.com,fred@farmer.org" , 0 ) ; memset ( & newAttr , 0 , sizeof ( newAttr ) ) ; decode_arst ( & newAttr , NULL , NULL , "brad@gmail.com,lauradaw7@bestgirl.com,fred@farmer.org" , 0 ) ; fail_unless ( set_uacl ( & attr , & newAttr , INCR ) == PBSE_DUPLIST ) ; free_arst ( & attr ) ; free_arst ( & newAttr ) ; memset ( & attr , 0 , sizeof ( attr ) ) ; decode_arst ( & attr , NULL , NULL , "brad@braddaw.com,lauradaw7@gmail.com,fred@farmer.org" , 0 ) ; memset ( & newAttr , 0 , sizeof ( newAttr ) ) ; decode_arst ( & newAttr , NULL , NULL , "brad@gmail.com,lauradaw7@bestgirl.com,fred@farming.org" , 0 ) ; fail_unless ( set_uacl ( & attr , & newAttr , INCR ) == 0 ) ; fail_unless ( attr . at_val . at_arst -> as_usedptr == 6 ) ; free_arst ( & attr ) ; free_arst ( & newAttr ) ; memset ( & attr , 0 , sizeof ( attr ) ) ; decode_arst ( & attr , NULL , NULL , "brad@braddaw.com,lauradaw7@gmail.com,fred@farmer.org" , 0 ) ; memset ( & newAttr , 0 , sizeof ( newAttr ) ) ; decode_arst ( & newAttr , NULL , NULL , "brad@gmail.com,lauradaw7@bestgirl.com,fred@farmer.org" , 0 ) ; fail_unless ( set_uacl ( & attr , & newAttr , DECR ) == 0 ) ; fail_unless ( attr . at_val . at_arst -> as_usedptr == 2 ) ; free_arst ( & attr ) ; free_arst ( & newAttr ) ; memset ( & attr , 0 , sizeof ( attr ) ) ; decode_arst ( & attr , NULL , NULL , "brad@braddaw.com,lauradaw7@gmail.com,fred@farmer.org" , 0 ) ; memset ( & newAttr , 0 , sizeof ( newAttr ) ) ; decode_arst ( & newAttr , NULL , NULL , "brad@gmail.com,lauradaw7@bestgirl.com,fred@farming.org" , 0 ) ; fail_unless ( set_hostacl ( & attr , & newAttr , SET ) == 0 ) ; fail_unless ( attr . at_val . at_arst -> as_usedptr == 3 ) ; free_arst ( & attr ) ; free_arst ( & newAttr ) ; memset ( & attr , 0 , sizeof ( attr ) ) ; decode_arst ( & attr , NULL , NULL , "brad@braddaw.com,lauradaw7@gmail.com,fred@farmer.org" , 0 ) ; memset ( & newAttr , 0 , sizeof ( newAttr ) ) ; decode_arst ( & newAttr , NULL , NULL , "brad@gmail.com,lauradaw7@bestgirl.com,fred@farmer.org" , 0 ) ; fail_unless ( set_hostacl ( & attr , & newAttr , INCR ) == PBSE_DUPLIST ) ; free_arst ( & attr ) ; free_arst ( & newAttr ) ; memset ( & attr , 0 , sizeof ( attr ) ) ; } 