struct rib_entry * rib_add ( struct rib * rib , struct bgpd_addr * prefix , int prefixlen ) { struct pt_entry * pte ; struct rib_entry * re ; pte = pt_get ( prefix , prefixlen ) ; if ( pte == NULL ) { pte = pt_add ( prefix , prefixlen ) ; } if ( ( re = calloc ( 1 , sizeof ( * re ) ) ) == NULL ) { fatal ( "rib_add" ) ; } TAILQ_INIT ( & re -> prefix_h ) ; re -> prefix = pt_ref ( pte ) ; re -> rib_id = rib -> id ; if ( RB_INSERT ( rib_tree , rib_tree ( rib ) , re ) != NULL ) { log_warnx ( "rib_add: insert failed" ) ; return ( NULL ) ; } rdemem . rib_cnt ++ ; return ( re ) ; } 