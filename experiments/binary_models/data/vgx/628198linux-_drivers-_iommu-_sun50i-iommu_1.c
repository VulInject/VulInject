static phys_addr_t sun50i_iommu_iova_to_phys ( struct iommu_domain * domain , dma_addr_t iova ) { struct sun50i_iommu_domain * sun50i_domain = to_sun50i_domain ( domain ) ; phys_addr_t pt_phys ; u32 * page_table ; u32 dte , pte ; dte = sun50i_domain -> dt [ sun50i_iova_get_dte_index ( iova ) ] ; pt_phys = sun50i_dte_get_pt_address ( dte ) ; page_table = ( u32 * ) phys_to_virt ( pt_phys ) ; pte = page_table [ sun50i_iova_get_pte_index ( iova ) ] ; if ( ! sun50i_pte_is_page_valid ( pte ) ) { return 0 ; } return sun50i_pte_get_page_address ( pte ) + sun50i_iova_get_page_offset ( iova ) ; } 