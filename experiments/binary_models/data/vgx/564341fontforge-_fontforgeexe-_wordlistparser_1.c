{ SplineChar * sc = 0 ; if ( startedWithBackSlash ) { if ( glyphname [ 0 ] == 'u' ) { glyphname ++ ; } unichar_t * endptr = 0 ; long unicodepoint = u_strtoul ( glyphname + 1 , & endptr , 16 ) ; TRACE ( "AAA glyphname:%s\n" , u_to_c ( glyphname + 1 ) ) ; TRACE ( "AAA unicodepoint:%ld\n" , unicodepoint ) ; sc = SFGetChar ( sf , unicodepoint , 0 ) ; if ( sc && endptr ) { unichar_t * endofglyphname = glyphname + u_strlen ( glyphname ) ; for ( ; endptr < endofglyphname ; endptr ++ ) { -- endpos ; } } if ( ! sc ) { uc_strcpy ( glyphname , "backslash" ) ; sc = SFGetChar ( sf , - 1 , u_to_c ( glyphname ) ) ; endpos = startpos ; } } else { if ( uc_startswith ( glyphname , "uni" ) ) { unichar_t * endptr = 0 , * tmp_gn ; int gn_len ; long unicodepoint = u_strtoul ( glyphname + 3 , & endptr , 16 ) ; SplineChar * tmp = 0 ; TRACE ( "uni prefix, codepoint: %ld\n" , unicodepoint ) ; sc = SFGetChar ( sf , unicodepoint , 0 ) ; gn_len = u_strlen ( glyphname ) ; tmp_gn = malloc ( ( gn_len + 1 ) * sizeof ( unichar_t ) ) ; u_strncpy ( tmp_gn , glyphname , gn_len ) ; for ( int i = gn_len ; i > 0 ; i -- ) { tmp_gn [ i ] = 0 ; tmp = SFGetChar ( sf , - 1 , u_to_c ( tmp_gn ) ) ; TRACE ( "looking for subst. char: %s\n" , u_to_c ( tmp_gn ) ) ; if ( tmp != NULL ) { TRACE ( "have subst. char: %s\n" , tmp -> name ) ; break ; } } if ( tmp != NULL ) { sc = tmp ; } else { if ( sc && endptr ) { unichar_t * endofglyphname = glyphname + u_strlen ( glyphname ) ; for ( ; endptr < endofglyphname ; endptr ++ ) { -- endpos ; } } } } if ( firstLookup && glyphname [ 0 ] == '#' ) { unichar_t * endptr = 0 ; long unicodepoint = u_strtoul ( glyphname + 1 , & endptr , 16 ) ; sc = SFGetChar ( sf , unicodepoint , 0 ) ; if ( sc && endptr ) { unichar_t * endofglyphname = glyphname + u_strlen ( glyphname ) ; for ( ; endptr < endofglyphname ; endptr ++ ) { -- endpos ; } } } if ( ! sc ) { sc = SFGetChar ( sf , - 1 , u_to_c ( glyphname ) ) ; } } if ( sc ) { if ( ! loopCounter && FullMatchEndsOnSpace ) { endpos ++ ; } * updated_in = endpos ; return sc ; } if ( glyphname [ 0 ] != '\0' ) { glyphname [ u_strlen ( glyphname ) - 1 ] = '\0' ; } } * updated_in = endpos ; return 0 ; 