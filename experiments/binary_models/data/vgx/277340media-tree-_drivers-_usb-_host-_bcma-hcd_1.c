static int bcma_hcd_probe ( struct bcma_device * core ) { int err ; struct bcma_hcd_device * usb_dev ; usb_dev = devm_kzalloc ( & core -> dev , sizeof ( bcma_hcd_device ) , GFP_KERNEL ) ; usb_dev -> core = core ; if ( core -> dev . of_node ) { usb_dev -> gpio_desc = devm_gpiod_get ( & core -> dev , "vcc" , GPIOD_OUT_HIGH ) ; } switch ( core -> id . id ) { case BCMA_CORE_USB20_HOST : if ( IS_ENABLED ( CONFIG_ARM ) ) { err = bcma_hcd_usb20_old_arm_init ( usb_dev ) ; } if ( IS_ENABLED ( CONFIG_MIPS ) ) { err = bcma_hcd_usb20_init ( usb_dev ) ; } else { err = - ENOTSUPP ; } break ; case BCMA_CORE_NS_USB20 : err = bcma_hcd_usb20_ns_init ( usb_dev ) ; break ; case BCMA_CORE_NS_USB30 : err = bcma_hcd_usb30_init ( usb_dev ) ; break ; default : return - ENODEV ; } if ( err ) { return err ; } bcma_set_drvdata ( core , usb_dev ) ; return 0 ; } 