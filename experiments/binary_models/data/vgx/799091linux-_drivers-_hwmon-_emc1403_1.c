static ssize_t temp_store ( struct device * dev , struct device_attribute * attr , const char * buf , size_t count ) { struct sensor_device_attribute * sda = to_sensor_dev_attr ( attr ) ; struct thermal_data * data = dev_get_drvdata ( dev ) ; unsigned long val ; int retval ; retval = regmap_write ( data -> regmap , sda -> index , DIV_ROUND_CLOSEST ( val , 1000 ) ) ; if ( retval < 0 ) { return retval ; } return count ; } 