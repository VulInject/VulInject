static int chStateInitialize ( bool privileged , const char * root , bool monolithic G_GNUC_UNUSED , virStateInhibitCallback callback G_GNUC_UNUSED , void * opaque G_GNUC_UNUSED ) { int ret = VIR_DRV_STATE_INIT_ERROR ; int rv ; if ( root != NULL ) { virReportError ( VIR_ERR_INVALID_ARG , "%s" , _ ( "Driver does not support embedded mode" ) ) ; return - 1 ; } ch_driver = g_new0 ( virCHDriver , 1 ) ; if ( virMutexInit ( & ch_driver -> lock ) < 0 ) { return VIR_DRV_STATE_INIT_ERROR ; } if ( ! ( ch_driver -> domains = virDomainObjListNew ( ) ) ) { cleanup } if ( ! ( ch_driver -> caps = virCHDriverCapsInit ( ) ) ) { cleanup } if ( ! ( ch_driver -> xmlopt = chDomainXMLConfInit ( ch_driver ) ) ) { cleanup } if ( ! ( ch_driver -> config = virCHDriverConfigNew ( privileged ) ) ) { cleanup } if ( ( rv = chExtractVersion ( ch_driver ) ) < 0 ) { if ( rv == - 2 ) { ret = VIR_DRV_STATE_INIT_SKIPPED ; } cleanup } ch_driver -> privileged = privileged ; ret = VIR_DRV_STATE_INIT_COMPLETE ; cleanup if ( ret != VIR_DRV_STATE_INIT_COMPLETE ) { chStateCleanup ( ) ; } return ret ; } 