static int msm_hdmi_init ( struct hdmi * hdmi ) { struct platform_device * pdev = hdmi -> pdev ; int ret ; hdmi -> workq = alloc_ordered_workqueue ( "msm_hdmi" , 0 ) ; if ( ! hdmi -> workq ) { ret = - ENOMEM ; fail } hdmi -> i2c = msm_hdmi_i2c_init ( hdmi ) ; if ( IS_ERR ( hdmi -> i2c ) ) { ret = PTR_ERR ( hdmi -> i2c ) ; DRM_DEV_ERROR ( & pdev -> dev , "failed to get i2c: %d\n" , ret ) ; hdmi -> i2c = NULL ; fail } hdmi -> hdcp_ctrl = msm_hdmi_hdcp_init ( hdmi ) ; if ( IS_ERR ( hdmi -> hdcp_ctrl ) ) { dev_warn ( & pdev -> dev , "failed to init hdcp: disabled\n" ) ; hdmi -> hdcp_ctrl = NULL ; } return 0 ; fail return ret ; } 