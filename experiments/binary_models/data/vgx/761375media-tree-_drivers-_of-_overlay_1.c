int of_overlay_destroy ( int id ) { struct of_overlay * ov ; int err ; mutex_lock ( & of_mutex ) ; ov = idr_find ( & ov_idr , id ) ; if ( ov == NULL ) { err = - ENODEV ; pr_err ( "destroy: Could not find overlay #%d\n" , id ) ; out } if ( ! overlay_removal_is_ok ( ov ) ) { err = - EBUSY ; out } of_overlay_notify ( ov , OF_OVERLAY_PRE_REMOVE ) ; list_del ( & ov -> node ) ; __of_changeset_revert ( & ov -> cset ) ; of_overlay_notify ( ov , OF_OVERLAY_POST_REMOVE ) ; of_free_overlay_info ( ov ) ; idr_remove ( & ov_idr , id ) ; of_changeset_destroy ( & ov -> cset ) ; err = 0 ; out mutex_unlock ( & of_mutex ) ; return err ; } 