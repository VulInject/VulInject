int qlcnic_83xx_configure_opmode ( struct qlcnic_adapter * adapter ) { struct qlcnic_hardware_context * ahw = adapter -> ahw ; u16 max_sds_rings , max_tx_rings ; int ret ; ret = qlcnic_83xx_get_nic_configuration ( adapter ) ; if ( ret == - EIO ) { return - EIO ; } if ( ret == QLCNIC_VNIC_MODE ) { ahw -> nic_mode = QLCNIC_VNIC_MODE ; max_sds_rings = QLCNIC_MAX_VNIC_SDS_RINGS ; max_tx_rings = QLCNIC_MAX_VNIC_TX_RINGS ; } if ( ret == QLC_83XX_DEFAULT_OPMODE ) { ahw -> nic_mode = QLCNIC_DEFAULT_MODE ; adapter -> nic_ops -> init_driver = qlcnic_83xx_init_default_driver ; ahw -> idc . state_entry = qlcnic_83xx_idc_ready_state_entry ; max_sds_rings = QLCNIC_MAX_SDS_RINGS ; max_tx_rings = QLCNIC_MAX_TX_RINGS ; } else { dev_err ( & adapter -> pdev -> dev , "%s: Invalid opmode %d\n" , __func__ , ret ) ; return - EIO ; } adapter -> max_sds_rings = min ( ahw -> max_rx_ques , max_sds_rings ) ; adapter -> max_tx_rings = min ( ahw -> max_tx_ques , max_tx_rings ) ; return 0 ; } 