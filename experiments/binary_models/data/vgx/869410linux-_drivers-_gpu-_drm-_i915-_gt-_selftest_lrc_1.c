static struct i915_vma * create_user_vma ( struct i915_address_space * vm , unsigned long size ) { struct drm_i915_gem_object * obj ; struct i915_vma * vma ; int err ; obj = i915_gem_object_create_internal ( vm -> i915 , size ) ; if ( IS_ERR ( obj ) ) { return ERR_CAST ( obj ) ; } vma = i915_vma_instance ( obj , vm , NULL ) ; if ( IS_ERR ( vma ) ) { i915_gem_object_put ( obj , NULL ) ; return vma ; } err = i915_vma_pin ( vma , 0 , 0 , PIN_USER ) ; if ( err ) { i915_gem_object_put ( obj ) ; return ERR_PTR ( err ) ; } return vma ; } 