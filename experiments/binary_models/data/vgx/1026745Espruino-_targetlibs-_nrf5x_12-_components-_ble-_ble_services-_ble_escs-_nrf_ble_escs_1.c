ret_code_t nrf_ble_escs_init ( nrf_ble_escs_t * p_escs , const nrf_ble_escs_init_t * p_escs_init ) { uint32_t err_code ; ble_uuid_t ble_uuid ; ble_uuid128_t ecs_base_uuid = ESCS_BASE_UUID ; uint8_t zero_val = 0 ; VERIFY_PARAM_NOT_NULL ( p_escs ) ; VERIFY_PARAM_NOT_NULL ( p_escs_init ) ; p_escs -> conn_handle = BLE_CONN_HANDLE_INVALID ; p_escs -> write_evt_handler = p_escs_init -> write_evt_handler ; p_escs -> read_evt_handler = p_escs_init -> read_evt_handler ; err_code = sd_ble_uuid_vs_add ( & ecs_base_uuid , & p_escs -> uuid_type ) ; VERIFY_SUCCESS ( err_code ) ; ble_uuid . type = p_escs -> uuid_type ; ble_uuid . uuid = BLE_UUID_ESCS_SERVICE ; err_code = sd_ble_gatts_service_add ( BLE_GATTS_SRVC_TYPE_PRIMARY , & ble_uuid , & p_escs -> service_handle ) ; VERIFY_SUCCESS ( err_code ) ; nrf_ble_escs_broadcast_cap_t temp = p_escs_init -> p_init_vals -> broadcast_cap ; temp . supp_frame_types = BYTES_SWAP_16BIT ( temp . supp_frame_types ) ; nrf_ble_escs_adv_interval_t temp_interval = p_escs_init -> p_init_vals -> adv_interval ; temp_interval = BYTES_SWAP_16BIT ( temp_interval ) ; err_code = char_add ( & BROADCAST_CAP_CHAR_INIT , p_escs , & temp , & p_escs -> broadcast_cap_handles ) ; VERIFY_SUCCESS ( err_code ) ; err_code = char_add ( & ACTIVE_SLOT_CHAR_INIT , p_escs , p_escs -> p_active_slot , & p_escs -> active_slot_handles ) ; VERIFY_SUCCESS ( err_code ) ; err_code = char_add ( & ADV_INTERVAL_CHAR_INIT , p_escs , & temp_interval , & p_escs -> adv_interval_handles ) ; VERIFY_SUCCESS ( err_code ) ; err_code = char_add ( & RADIO_TX_PWR_CHAR_INIT , p_escs , & ( p_escs_init -> p_init_vals -> radio_tx_pwr ) , & p_escs -> radio_tx_pwr_handles ) ; VERIFY_SUCCESS ( err_code ) ; err_code = char_add ( & ADV_TX_PWR_CHAR_INIT , p_escs , & ( p_escs_init -> p_init_vals -> adv_tx_pwr ) , & p_escs -> adv_tx_pwr_handles ) ; VERIFY_SUCCESS ( err_code ) ; err_code = char_add ( & LOCK_STATE_CHAR_INIT , p_escs , p_escs -> p_lock_state , & p_escs -> lock_state_handles ) ; VERIFY_SUCCESS ( err_code ) ; err_code = char_add ( & UNLOCK_CHAR_INIT , p_escs , & zero_val , & p_escs -> unlock_handles ) ; VERIFY_SUCCESS ( err_code ) ; err_code = char_add ( & PUBLIC_ECDH_KEY_CHAR_INIT , p_escs , & zero_val , & p_escs -> pub_ecdh_key_handles ) ; VERIFY_SUCCESS ( err_code ) ; err_code = char_add ( & EID_ID_KEY_CHAR_INIT , p_escs , & zero_val , & p_escs -> eid_id_key_handles ) ; VERIFY_SUCCESS ( err_code ) ; err_code = char_add ( & RW_ADV_SLOT_CHAR_INIT , p_escs , & zero_val , & p_escs -> rw_adv_slot_handles ) ; VERIFY_SUCCESS ( err_code ) ; err_code = char_add ( & FACTORY_RESET_CHAR_INIT , p_escs , & ( p_escs_init -> p_init_vals -> factory_reset ) , & p_escs -> factory_reset_handles ) ; VERIFY_SUCCESS ( err_code ) ; err_code = char_add ( & REMAIN_CONNECTABLE_CHAR_INIT , p_escs , & ( p_escs_init -> p_init_vals -> remain_connectable . r_is_non_connectable_supported ) , & p_escs -> remain_connectable_handles ) ; VERIFY_SUCCESS ( err_code ) ; return NRF_SUCCESS ; } 