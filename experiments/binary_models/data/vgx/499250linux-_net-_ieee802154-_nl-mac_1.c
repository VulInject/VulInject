static int ieee802154_llsec_parse_key_id ( struct genl_info * info , struct ieee802154_llsec_key_id * desc ) { memset ( desc , 0 , sizeof ( * desc ) ) ; if ( ! info -> attrs [ IEEE802154_ATTR_LLSEC_KEY_MODE ] ) { return - EINVAL ; } desc -> mode = nla_get_u8 ( info -> attrs [ IEEE802154_ATTR_LLSEC_KEY_MODE ] ) ; if ( desc -> mode == IEEE802154_SCF_KEY_IMPLICIT ) { desc -> device_addr . pan_id = nla_get_shortaddr ( info -> attrs [ IEEE802154_ATTR_PAN_ID ] ) ; if ( info -> attrs [ IEEE802154_ATTR_SHORT_ADDR ] ) { desc -> device_addr . mode = IEEE802154_ADDR_SHORT ; desc -> device_addr . short_addr = nla_get_shortaddr ( info -> attrs [ IEEE802154_ATTR_SHORT_ADDR ] ) ; } else { if ( ! info -> attrs [ IEEE802154_ATTR_HW_ADDR ] ) { return - EINVAL ; } desc -> device_addr . mode = IEEE802154_ADDR_LONG ; desc -> device_addr . extended_addr = nla_get_hwaddr ( info -> attrs [ IEEE802154_ATTR_HW_ADDR ] ) ; } } if ( desc -> mode != IEEE802154_SCF_KEY_IMPLICIT && ! info -> attrs [ IEEE802154_ATTR_LLSEC_KEY_ID ] ) { return - EINVAL ; } if ( desc -> mode == IEEE802154_SCF_KEY_SHORT_INDEX && ! info -> attrs [ IEEE802154_ATTR_LLSEC_KEY_SOURCE_SHORT ] ) { return - EINVAL ; } if ( desc -> mode == IEEE802154_SCF_KEY_HW_INDEX && ! info -> attrs [ IEEE802154_ATTR_LLSEC_KEY_SOURCE_EXTENDED ] ) { return - EINVAL ; } if ( desc -> mode != IEEE802154_SCF_KEY_IMPLICIT ) { desc -> id = nla_get_u8 ( info -> attrs [ IEEE802154_ATTR_LLSEC_KEY_ID ] ) ; } switch ( desc -> mode ) { case IEEE802154_SCF_KEY_SHORT_INDEX : { u32 source = nla_get_u32 ( info -> attrs [ IEEE802154_ATTR_LLSEC_KEY_SOURCE_SHORT ] ) ; desc -> short_source = cpu_to_le32 ( source ) ; break ; } case IEEE802154_SCF_KEY_HW_INDEX : desc -> extended_source = nla_get_hwaddr ( info -> attrs [ IEEE802154_ATTR_LLSEC_KEY_SOURCE_EXTENDED ] ) ; break ; } return 0 ; } 