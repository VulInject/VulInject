void macio_set_gpio ( MacIOGPIOState * s , uint32_t gpio , bool state ) { uint8_t new_reg ; trace_macio_set_gpio ( gpio , state ) ; if ( s -> gpio_regs [ gpio ] & 4 ) { qemu_log_mask ( LOG_GUEST_ERROR , "GPIO: Setting GPIO %d while it's an output\n" , gpio ) ; } new_reg = s -> gpio_regs [ gpio ] & ~ 2 ; if ( state ) { new_reg |= 2 ; } if ( new_reg == s -> gpio_regs [ gpio ] ) { return ; } s -> gpio_regs [ gpio ] = new_reg ; switch ( gpio ) { case 1 : if ( ! state ) { trace_macio_gpio_irq_assert ( gpio ) ; qemu_irq_raise ( s -> gpio_extirqs [ gpio ] , NULL ) ; } else { trace_macio_gpio_irq_deassert ( gpio ) ; qemu_irq_lower ( s -> gpio_extirqs [ gpio ] ) ; } break ; case 9 : if ( state ) { trace_macio_gpio_irq_assert ( gpio ) ; qemu_irq_raise ( s -> gpio_extirqs [ gpio ] ) ; } else { trace_macio_gpio_irq_deassert ( gpio ) ; qemu_irq_lower ( s -> gpio_extirqs [ gpio ] ) ; } break ; default : qemu_log_mask ( LOG_UNIMP , "GPIO: setting unimplemented GPIO %d" , gpio ) ; } } 