static ssize_t mwifiex_info_read ( struct file * file , char __user * ubuf , size_t count , loff_t * ppos ) { struct mwifiex_private * priv = ( mwifiex_private * ) file -> private_data ; struct net_device * netdev = priv -> netdev ; struct netdev_hw_addr * ha ; struct netdev_queue * txq ; unsigned long page = get_zeroed_page ( GFP_KERNEL ) ; char * p = ( char * ) page , fmt [ 64 ] ; struct mwifiex_bss_info info ; ssize_t ret ; int i ; if ( ! p ) { return - ENOMEM ; } memset ( & info , 0 , sizeof ( info ) ) ; ret = mwifiex_get_bss_info ( priv , & info ) ; if ( ret ) { free_and_exit } mwifiex_drv_get_driver_version ( priv -> adapter , fmt , sizeof ( fmt ) - 1 ) ; mwifiex_get_ver_ext ( priv , 0 ) ; p += sprintf ( p , "driver_name = " "\"mwifiex\"\n" ) ; p += sprintf ( p , "driver_version = %s" , fmt ) ; p += sprintf ( p , "\nverext = %s" , priv -> version_str ) ; p += sprintf ( p , "\ninterface_name=\"%s\"\n" , netdev -> name ) ; if ( info . bss_mode >= ARRAY_SIZE ( bss_modes ) ) { p += sprintf ( p , "bss_mode=\"%d\"\n" , info . bss_mode ) ; } else { p += sprintf ( p , "bss_mode=\"%s\"\n" , bss_modes [ info . bss_mode ] ) ; } p += sprintf ( p , "media_state=\"%s\"\n" , ( ! priv -> media_connected ?"Disconnected" : "Connected" ) ) ; p += sprintf ( p , "mac_address=\"%pM\"\n" , netdev -> dev_addr ) ; if ( GET_BSS_ROLE ( priv ) == MWIFIEX_BSS_ROLE_STA ) { p += sprintf ( p , "multicast_count=\"%d\"\n" , netdev_mc_count ( netdev ) ) ; p += sprintf ( p , "essid=\"%.*s\"\n" , info . ssid . ssid_len , info . ssid . ssid ) ; p += sprintf ( p , "bssid=\"%pM\"\n" , info . bssid ) ; p += sprintf ( p , "channel=\"%d\"\n" , ( int ) info . bss_chan ) ; p += sprintf ( p , "country_code = \"%s\"\n" , info . country_code ) ; p += sprintf ( p , "region_code=\"0x%x\"\n" , priv -> adapter -> region_code ) ; netdev_for_each_mc_addr ( , ) p += sprintf ( p , "multicast_address[%d]=\"%pM\"\n" , i ++ , ha -> addr ) ; } p += sprintf ( p , "num_tx_bytes = %lu\n" , priv -> stats . tx_bytes ) ; p += sprintf ( p , "num_rx_bytes = %lu\n" , priv -> stats . rx_bytes ) ; p += sprintf ( p , "num_tx_pkts = %lu\n" , priv -> stats . tx_packets ) ; p += sprintf ( p , "num_rx_pkts = %lu\n" , priv -> stats . rx_packets ) ; p += sprintf ( p , "num_tx_pkts_dropped = %lu\n" , priv -> stats . tx_dropped ) ; p += sprintf ( p , "num_rx_pkts_dropped = %lu\n" , priv -> stats . rx_dropped ) ; p += sprintf ( p , "num_tx_pkts_err = %lu\n" , priv -> stats . tx_errors ) ; p += sprintf ( p , "num_rx_pkts_err = %lu\n" , priv -> stats . rx_errors ) ; p += sprintf ( p , "carrier %s\n" , ( ( netif_carrier_ok ( priv -> netdev ) ) ?"on" : "off" ) ) ; p += sprintf ( p , "tx queue" ) ; for ( i = 0 ; i < netdev -> num_tx_queues ; i ++ ) { txq = netdev_get_tx_queue ( netdev , i ) ; p += sprintf ( p , " %d:%s" , i , netif_tx_queue_stopped ( txq ) ?"stopped" : "started" ) ; } p += sprintf ( p , "\n" ) ; ret = simple_read_from_buffer ( ubuf , count , ppos , ( char * ) page , ( unsigned long ) p - page ) ; free_and_exit free_page ( page ) ; return ret ; } 