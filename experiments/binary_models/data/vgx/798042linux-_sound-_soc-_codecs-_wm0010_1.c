static int wm0010_set_sysclk ( struct snd_soc_component * component , int source , int clk_id , unsigned int freq , int dir ) { struct wm0010_priv * wm0010 = snd_soc_component_get_drvdata ( component ) ; int i ; wm0010 -> sysclk = freq ; if ( freq < pll_clock_map [ ARRAY_SIZE ( pll_clock_map ) - 1 ] . max_sysclk ) { wm0010 -> max_spi_freq = 0 ; } else { for ( i = 0 ; i < ARRAY_SIZE ( pll_clock_map ) ; i ++ ) { if ( freq >= pll_clock_map [ i ] . max_sysclk ) { wm0010 -> max_spi_freq = pll_clock_map [ i ] . max_pll_spi_speed ; wm0010 -> pll_clkctrl1 = pll_clock_map [ i ] . pll_clkctrl1 ; break ; } } } return 0 ; } 