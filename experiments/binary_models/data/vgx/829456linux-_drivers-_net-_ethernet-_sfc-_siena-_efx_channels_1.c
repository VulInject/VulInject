static int efx_soft_enable_interrupts ( struct efx_nic * efx ) { struct efx_channel * channel , * end_channel ; int rc ; BUG_ON ( efx -> state == STATE_DISABLED ) ; efx -> irq_soft_enabled = true ; smp_wmb ( ) ; efx_for_each_channel ( , ) { if ( ! channel -> type -> keep_eventq ) { rc = efx_init_eventq ( channel ) ; if ( rc ) { fail } } efx_siena_start_eventq ( channel ) ; } efx_siena_mcdi_mode_event ( efx , NULL ) ; return 0 ; fail end_channel = channel ; efx_for_each_channel ( , ) { if ( channel == end_channel ) { break ; } efx_siena_stop_eventq ( channel ) ; if ( ! channel -> type -> keep_eventq ) { efx_fini_eventq ( channel ) ; } } return rc ; } 