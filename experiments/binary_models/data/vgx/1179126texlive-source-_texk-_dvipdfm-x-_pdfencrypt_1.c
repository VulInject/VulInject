compute_owner_password_V5 ( , ) { unsigned char vsalt [ 8 ] , ksalt [ 8 ] , hash [ 32 ] ; unsigned char * OE , iv [ AES_BLOCKSIZE ] ; int OE_len ; int i ; for ( i = 0 ; i < 8 ; i ++ ) { vsalt [ i ] = rand ( ) % 256 ; ksalt [ i ] = rand ( ) % 256 ; } compute_hash_V5 ( hash , oplain , vsalt , p_sec -> U , p_sec -> R ) ; memcpy ( p_sec -> O , hash , 32 ) ; memcpy ( p_sec -> O + 32 , vsalt , 8 ) ; memcpy ( p_sec -> O + 40 , ksalt , 8 ) ; compute_hash_V5 ( hash , oplain , ksalt , p_sec -> U , p_sec -> R ) ; memset ( iv , 0 , AES_BLOCKSIZE ) ; AES_cbc_encrypt ( hash , 32 , iv , 0 , p_sec -> key , p_sec -> key_size , & OE , & OE_len ) ; memcpy ( p_sec -> OE , OE , 32 ) ; RELEASE ( OE ) ; } 