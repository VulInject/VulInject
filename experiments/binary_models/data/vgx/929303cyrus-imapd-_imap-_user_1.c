EXPORTED int user_renamedata ( const char * olduser , const char * newuser ) { struct rename_rock rrock ; int i ; char * oldinbox = mboxname_user_mbox ( olduser , NULL ) ; char * newinbox = mboxname_user_mbox ( newuser , NULL ) ; seen_rename_user ( olduser , newuser ) ; rrock . olduser = olduser ; rrock . newuser = newuser ; rrock . oldinbox = oldinbox ; rrock . newinbox = newinbox ; strarray_t * subs = mboxlist_sublist ( olduser ) ; for ( i = 0 ; i < strarray_size ( subs ) ; i ++ ) { user_renamesub ( strarray_nth ( subs , i ) , & rrock ) ; } strarray_free ( subs ) ; user_renamesieve ( olduser , newuser ) ; free ( oldinbox ) ; return 0 ; } 