static int rtl8366rb_port_bridge_join ( struct dsa_switch * ds , int port , struct dsa_bridge bridge , bool * tx_fwd_offload , struct netlink_ext_ack * extack ) { struct realtek_priv * priv = ds -> priv ; int port_bitmap = 0 ; int ret , i ; for ( i = 0 ; i < RTL8366RB_PORT_NUM_CPU ; i ++ ) { if ( i == port ) { continue ; } if ( ! dsa_port_offloads_bridge ( dsa_to_port ( ds , i ) , & bridge ) ) { continue ; } ret = regmap_update_bits ( priv -> map , RTL8366RB_PORT_ISO ( i ) , RTL8366RB_PORT_ISO_PORTS ( BIT ( port ) ) , RTL8366RB_PORT_ISO_PORTS ( BIT ( port ) ) ) ; if ( ret ) { dev_err ( priv -> dev , "failed to join port %d\n" , port ) ; } port_bitmap |= BIT ( i ) ; } return regmap_update_bits ( priv -> map , RTL8366RB_PORT_ISO ( port ) , RTL8366RB_PORT_ISO_PORTS ( port_bitmap ) , RTL8366RB_PORT_ISO_PORTS ( port_bitmap ) ) ; } 