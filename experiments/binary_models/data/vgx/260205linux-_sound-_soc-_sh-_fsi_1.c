static int fsi_clk_enable ( struct device * dev , struct fsi_priv * fsi ) { struct fsi_clk * clock = & fsi -> clock ; int ret = - EINVAL ; if ( ! fsi_clk_is_valid ( fsi ) ) { return ret ; } if ( 0 == clock -> count ) { ret = clock -> set_rate ( dev , fsi ) ; if ( ret < 0 ) { return ret ; } ret = clk_enable ( clock -> xck ) ; if ( ret ) { err } ret = clk_enable ( clock -> ick ) ; if ( ret ) { disable_xck } ret = clk_enable ( clock -> div ) ; if ( ret ) { disable_ick } clock -> count ++ ; } return ret ; disable_ick clk_disable ( clock -> ick ) ; disable_xck clk_disable ( clock -> xck ) ; err return ret ; } 