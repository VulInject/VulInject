static task_t task_for_pid_workaround ( int pid ) { host_t myhost = mach_host_self ( ) ; mach_port_t psDefault = 0 ; mach_port_t psDefault_control = 0 ; task_array_t tasks = NULL ; mach_msg_type_number_t numTasks = 0 ; kern_return_t kr = - 1 ; int i ; kr = processor_set_default ( myhost , & psDefault ) ; if ( kr != KERN_SUCCESS ) { return MACH_PORT_NULL ; } kr = host_processor_set_priv ( myhost , psDefault , & psDefault_control ) ; if ( kr != KERN_SUCCESS ) { R_LOG_DEBUG ( "host_processor_set_priv failed with error 0x%x" , kr ) ; return MACH_PORT_NULL ; } numTasks = 0 ; kr = processor_set_tasks ( psDefault_control , & tasks , & numTasks ) ; if ( kr != KERN_SUCCESS ) { R_LOG_DEBUG ( "processor_set_tasks failed with error %x" , kr ) ; return MACH_PORT_NULL ; } if ( pid == 0 ) { return tasks [ 0 ] ; } for ( i = 0 ; i < numTasks ; i ++ ) { int pid2 = - 1 ; pid_for_task ( i , & pid2 ) ; if ( pid == pid2 ) { return tasks [ i ] ; } } return MACH_PORT_NULL ; } 