void dom_normalize ( xmlNodePtr nodep ) { xmlNodePtr child , nextp , newnextp ; xmlAttrPtr attr ; xmlChar * strContent ; child = nodep -> children ; while ( child != NULL ) { switch ( child -> type ) { case XML_TEXT_NODE : nextp = child -> next ; while ( nextp != NULL ) { if ( nextp -> type == XML_TEXT_NODE ) { newnextp = nextp -> next ; strContent = xmlNodeGetContent ( nextp ) ; xmlNodeAddContent ( child , strContent ) ; xmlFree ( strContent ) ; xmlUnlinkNode ( nextp ) ; php_libxml_node_free_resource ( nextp ) ; nextp = newnextp ; } else { break ; } } if ( is_empty_node ( child ) ) { nextp = child -> next ; xmlUnlinkNode ( child ) ; php_libxml_node_free_resource ( child ) ; child = nextp ; continue ; } break ; case XML_ELEMENT_NODE : dom_normalize ( child , NULL ) ; attr = child -> properties ; while ( attr != NULL ) { dom_normalize ( ( xmlNodePtr ) attr ) ; attr = attr -> next ; } break ; case XML_ATTRIBUTE_NODE : dom_normalize ( child ) ; break ; default : break ; } child = child -> next ; } } 