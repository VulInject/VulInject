static int octeon_spi_probe ( struct udevice * dev ) { struct octeon_spi * priv = dev_get_priv ( dev ) ; int ret ; if ( device_is_compatible ( dev , "cavium,thunder-8190-spi" ) ) { pci_dev_t bdf = dm_pci_get_bdf ( dev ) ; debug ( "SPI PCI device: %x\n" , bdf ) ; priv -> base = dm_pci_map_bar ( dev , PCI_BASE_ADDRESS_0 , 0 , 0 , PCI_REGION_TYPE , PCI_REGION_MEM ) ; priv -> base += 0x1000 ; if ( device_is_compatible ( dev , "cavium,thunderx-spi" ) ) { octeon_spi_ops . xfer = octeontx2_spi_xfer ; octeon_spi_ops . mem_ops = & octeontx2_spi_mem_ops ; } } else { priv -> base = dev_remap_addr ( dev ) ; } ret = clk_get_by_index ( dev , 0 , & priv -> clk ) ; ret = clk_enable ( & priv -> clk ) ; if ( ret ) { return ret ; } debug ( "SPI bus %s %d at %p\n" , dev -> name , dev_seq ( dev ) , priv -> base ) ; return 0 ; } 