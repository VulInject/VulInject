static void otx2vf_vfaf_mbox_up_handler ( struct work_struct * work ) { struct otx2_mbox_dev * mdev ; struct mbox_hdr * rsp_hdr ; struct mbox_msghdr * msg ; struct otx2_mbox * mbox ; struct mbox * vf_mbox ; struct otx2_nic * vf ; int offset , id ; vf_mbox = container_of ( work , mbox , mbox_up_wrk ) ; vf = vf_mbox -> pfvf ; mbox = & vf_mbox -> mbox_up ; mdev = & mbox -> dev [ 0 ] ; rsp_hdr = ( mbox_hdr * ) ( mdev -> mbase + mbox -> rx_start ) ; offset = mbox -> rx_start + ALIGN ( sizeof ( * rsp_hdr ) , MBOX_MSG_ALIGN ) ; for ( id = 0 ; id < vf_mbox -> up_num_msgs ; id ++ ) { msg = ( mbox_msghdr * ) ( mdev -> mbase + offset ) ; otx2vf_process_mbox_msg_up ( vf , msg ) ; offset = mbox -> rx_start + msg -> next_msgoff ; } otx2_mbox_msg_send ( mbox , 0 ) ; } 