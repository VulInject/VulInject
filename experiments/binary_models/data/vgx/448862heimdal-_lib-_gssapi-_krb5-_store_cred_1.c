static OM_uint32 add_env ( OM_uint32 * minor , gss_buffer_set_t * env , const char * var , const char * val ) { OM_uint32 major ; gss_buffer_desc b ; char * varval = NULL ; if ( asprintf ( & varval , "%s=%s" , var , val ) == - 1 || varval == NULL ) { * minor = ENOMEM ; return GSS_S_FAILURE ; } b . value = varval ; b . length = strlen ( varval ) + 1 ; major = gss_add_buffer_set_member ( minor , & b , env ) ; return major ; } 