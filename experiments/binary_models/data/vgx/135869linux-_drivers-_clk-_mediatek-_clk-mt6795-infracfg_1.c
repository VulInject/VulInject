static int clk_mt6795_infracfg_probe ( struct platform_device * pdev ) { struct clk_hw_onecell_data * clk_data ; struct device_node * node = pdev -> dev . of_node ; void __iomem * base ; int ret ; base = devm_platform_ioremap_resource ( pdev , 0 ) ; if ( IS_ERR ( base ) ) { return PTR_ERR ( base ) ; } clk_data = mtk_alloc_clk_data ( CLK_INFRA_NR_CLK ) ; ret = mtk_register_reset_controller_with_dev ( & pdev -> dev , & clk_rst_desc ) ; if ( ret ) { free_clk_data } ret = mtk_clk_register_gates ( & pdev -> dev , node , infra_gates , ARRAY_SIZE ( infra_gates ) , clk_data ) ; if ( ret ) { free_clk_data } ret = mtk_clk_register_cpumuxes ( & pdev -> dev , node , cpu_muxes , ARRAY_SIZE ( cpu_muxes ) , clk_data ) ; if ( ret ) { unregister_gates } ret = of_clk_add_hw_provider ( node , of_clk_hw_onecell_get , clk_data ) ; if ( ret ) { unregister_cpumuxes } return 0 ; unregister_cpumuxes mtk_clk_unregister_cpumuxes ( cpu_muxes , ARRAY_SIZE ( cpu_muxes ) , clk_data ) ; unregister_gates mtk_clk_unregister_gates ( infra_gates , ARRAY_SIZE ( infra_gates ) , clk_data ) ; free_clk_data mtk_free_clk_data ( clk_data ) ; return ret ; } 