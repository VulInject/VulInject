static void __init add_pcie_port ( int index , void __iomem * base ) { printk ( KERN_INFO "Dove PCIe port %d: " , index ) ; if ( orion_pcie_link_up ( base ) ) { struct pcie_port * pp = & pcie_port [ num_pcie_ports ++ ] ; struct clk * clk = clk_get_sys ( "pcie" , ( index ?"1" : "0" ) ) ; if ( ! IS_ERR ( clk ) ) { clk_prepare_enable ( clk ) ; } printk ( KERN_INFO "link up\n" ) ; pp -> index = index ; pp -> root_bus_nr = - 1 ; pp -> base = base ; spin_lock_init ( & pp -> conf_lock ) ; } else { printk ( KERN_INFO "link down, ignoring\n" ) ; } } 