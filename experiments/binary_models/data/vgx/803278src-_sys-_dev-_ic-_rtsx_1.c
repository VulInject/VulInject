int rtsx_bus_power_on ( struct rtsx_softc * sc ) { u_int8_t enable3 ; int err ; if ( sc -> flags & RTSX_F_525A ) { err = rtsx_write ( sc , RTSX_LDO_VCC_CFG1 , RTSX_LDO_VCC_TUNE_MASK , RTSX_LDO_VCC_3V3 ) ; } RTSX_WRITE ( sc , RTSX_CARD_SELECT , RTSX_SD_MOD_SEL ) ; RTSX_WRITE ( sc , RTSX_CARD_SHARE_MODE , RTSX_CARD_SHARE_48_SD ) ; RTSX_SET ( sc , RTSX_CARD_CLK_EN , RTSX_SD_CLK_EN ) ; RTSX_WRITE ( sc , RTSX_CARD_PULL_CTL1 , RTSX_PULL_CTL_ENABLE12 ) ; RTSX_WRITE ( sc , RTSX_CARD_PULL_CTL2 , RTSX_PULL_CTL_ENABLE12 ) ; if ( sc -> flags & RTSX_F_5229_TYPE_C ) { enable3 = RTSX_PULL_CTL_ENABLE3_TYPE_C ; } else { enable3 = RTSX_PULL_CTL_ENABLE3 ; } RTSX_WRITE ( sc , RTSX_CARD_PULL_CTL3 , enable3 ) ; RTSX_SET ( sc , RTSX_CARD_PWR_CTL , RTSX_SD_PARTIAL_PWR_ON ) ; if ( sc -> flags & RTSX_F_5209 ) { RTSX_SET ( sc , RTSX_PWR_GATE_CTRL , RTSX_LDO3318_SUSPEND ) ; } else { RTSX_SET ( sc , RTSX_PWR_GATE_CTRL , RTSX_LDO3318_VCC1 ) ; } delay ( 200 ) ; RTSX_CLR ( sc , RTSX_CARD_PWR_CTL , RTSX_SD_PWR_OFF ) ; if ( sc -> flags & RTSX_F_5209 ) { RTSX_CLR ( sc , RTSX_PWR_GATE_CTRL , RTSX_LDO3318_OFF ) ; } else { RTSX_SET ( sc , RTSX_PWR_GATE_CTRL , RTSX_LDO3318_VCC2 ) ; } RTSX_WRITE ( sc , RTSX_CARD_OE , RTSX_SD_OUTPUT_EN ) ; return 0 ; } 