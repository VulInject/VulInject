static int parse_line ( char * * line , char * * ret_key , char * * ret_attr , UdevRuleOperatorType * ret_op , char * * ret_value ) { char * key_begin , * key_end , * attr , * tmp ; UdevRuleOperatorType op ; int r ; assert ( line ) ; assert ( * line ) ; assert ( ret_key ) ; assert ( ret_op ) ; assert ( ret_value ) ; key_begin = skip_leading_chars ( * line , WHITESPACE "," ) ; for ( key_end = key_begin ; ; key_end ++ ) { if ( key_end [ 0 ] == '\0' ) { return - EINVAL ; } if ( strchr ( WHITESPACE "={" , key_end [ 0 ] ) ) { break ; } if ( strchr ( "+-!:" , key_end [ 0 ] ) && key_end [ 1 ] == '=' ) { break ; } } if ( key_end [ 0 ] == '{' ) { attr = key_end + 1 ; tmp = strchr ( attr , '}' ) ; if ( ! tmp ) { return - EINVAL ; } * tmp ++ = '\0' ; } else { attr = NULL ; tmp = key_end ; } tmp = skip_leading_chars ( tmp , NULL ) ; op = parse_operator ( tmp ) ; if ( op < 0 ) { return - EINVAL ; } key_end [ 0 ] = '\0' ; tmp += op == OP_ASSIGN ?1 : 2 ; tmp = skip_leading_chars ( tmp , NULL ) ; r = udev_rule_parse_value ( tmp , ret_value , line ) ; if ( r < 0 ) { return r ; } * ret_key = key_begin ; * ret_attr = attr ; * ret_op = op ; return 1 ; } 