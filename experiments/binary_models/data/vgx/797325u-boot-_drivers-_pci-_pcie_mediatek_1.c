static int mtk_pcie_parse_port_v2 ( struct udevice * dev , u32 slot ) { struct mtk_pcie * pcie = dev_get_priv ( dev ) ; struct mtk_pcie_port * port ; char name [ 10 ] ; int err ; port = devm_kzalloc ( dev , sizeof ( * port ) , GFP_KERNEL ) ; snprintf ( name , sizeof ( name ) , "port%d" , slot ) ; port -> base = dev_remap_addr_name ( dev , name ) ; if ( ! port -> base ) { debug ( "failed to map port%d base\n" , slot ) ; return - ENOENT ; } snprintf ( name , sizeof ( name ) , "sys_ck%d" , slot ) ; err = clk_get_by_name ( dev , name , & port -> sys_ck ) ; if ( err ) { debug ( "clk_get_by_name(sys_ck) failed: %d\n" , err ) ; return err ; } snprintf ( name , sizeof ( name ) , "ahb_ck%d" , slot ) ; err = clk_get_by_name ( dev , name , & port -> ahb_ck ) ; if ( err ) { debug ( "clk_get_by_name(ahb_ck) failed: %d\n" , err ) ; return err ; } snprintf ( name , sizeof ( name ) , "aux_ck%d" , slot ) ; err = clk_get_by_name ( dev , name , & port -> aux_ck ) ; if ( err ) { debug ( "clk_get_by_name(aux_ck) failed: %d\n" , err ) ; return err ; } snprintf ( name , sizeof ( name ) , "axi_ck%d" , slot ) ; err = clk_get_by_name ( dev , name , & port -> axi_ck ) ; if ( err ) { debug ( "clk_get_by_name(axi_ck) failed: %d\n" , err ) ; return err ; } snprintf ( name , sizeof ( name ) , "obff_ck%d" , slot ) ; err = clk_get_by_name ( dev , name , & port -> obff_ck ) ; if ( err ) { debug ( "clk_get_by_name(obff_ck) failed: %d\n" , err ) ; return err ; } snprintf ( name , sizeof ( name ) , "pipe_ck%d" , slot ) ; err = clk_get_by_name ( dev , name , & port -> pipe_ck ) ; if ( err ) { debug ( "clk_get_by_name(pipe_ck) failed: %d\n" , err ) ; return err ; } port -> slot = slot ; port -> pcie = pcie ; INIT_LIST_HEAD ( & port -> list ) ; list_add_tail ( & port -> list , & pcie -> ports ) ; return 0 ; } 