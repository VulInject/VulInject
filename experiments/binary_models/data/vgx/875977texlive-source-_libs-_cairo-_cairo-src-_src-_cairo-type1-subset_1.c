cairo_type1_font_subset_get_matrix ( , , , , , ) { const char * start , * end , * segment_end ; int ret , s_max , i , j ; char * s ; const char * decimal_point ; int decimal_point_len ; decimal_point = _cairo_get_locale_decimal_point ( ) ; decimal_point_len = strlen ( decimal_point ) ; assert ( decimal_point_len != 0 ) ; segment_end = font -> header_segment + font -> header_segment_size ; start = find_token ( font -> header_segment , segment_end , name ) ; if ( start == NULL ) { return CAIRO_INT_STATUS_UNSUPPORTED ; } end = find_token ( start , segment_end , "def" ) ; if ( end == NULL ) { return CAIRO_INT_STATUS_UNSUPPORTED ; } s_max = end - start + 5 * decimal_point_len + 1 ; s = _cairo_malloc ( s_max ) ; if ( unlikely ( s == NULL ) ) { return _cairo_error ( CAIRO_STATUS_NO_MEMORY ) ; } i = 0 ; j = 0 ; while ( i < end - start && j < s_max - decimal_point_len ) { if ( start [ i ] == '.' ) { strncpy ( s + j , decimal_point , decimal_point_len ) ; i ++ ; j += decimal_point_len ; } else { s [ j ++ ] = start [ i ++ ] ; } } s [ j ] = 0 ; start = strpbrk ( s , "{[" ) ; if ( ! start ) { return CAIRO_INT_STATUS_UNSUPPORTED ; } start ++ ; ret = 0 ; if ( * start ) { ret = sscanf ( start , "%lf %lf %lf %lf" , a , b , c , d ) ; } free ( s ) ; if ( ret != 4 ) { return CAIRO_INT_STATUS_UNSUPPORTED ; } return CAIRO_STATUS_SUCCESS ; } 