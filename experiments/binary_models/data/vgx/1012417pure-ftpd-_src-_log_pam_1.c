static const char * PAM_username ; static const char * PAM_password ; static int PAM_error ; size += sizeof ( pam_response ) ; if ( ( reply = realloc ( reply , size ) ) == NULL ) { PAM_error = 1 ; return PAM_CONV_ERR ; } static int PAM_conv ( int num_msg , const struct pam_message * * msg , struct pam_response * * resp , void * appdata_ptr ) { int count = 0 ; unsigned int replies = 0U ; struct pam_response * reply = NULL ; size_t size = ( size_t ) 0U ; ( void ) appdata_ptr ; * resp = NULL ; for ( count = 0 ; count < num_msg ; count ++ ) { switch ( msg [ count ] -> msg_style ) { case PAM_PROMPT_ECHO_ON : GET_MEM ; if ( ( reply [ replies ] . resp = strdup ( PAM_username ) ) == NULL ) { reply [ replies ] . resp_retcode = PAM_BUF_ERR ; PAM_error = 1 ; return PAM_CONV_ERR ; } reply [ replies ++ ] . resp_retcode = PAM_SUCCESS ; break ; case PAM_PROMPT_ECHO_OFF : GET_MEM ; memset ( & reply [ replies ] , 0 , sizeof reply [ replies ] ) ; if ( ( reply [ replies ] . resp = strdup ( PAM_password ) ) == NULL ) { reply [ replies ] . resp_retcode = PAM_BUF_ERR ; PAM_error = 1 ; return PAM_CONV_ERR ; } reply [ replies ++ ] . resp_retcode = PAM_SUCCESS ; break ; case PAM_TEXT_INFO : break ; case PAM_ERROR_MSG : default : free ( reply ) ; PAM_error = 1 ; return PAM_CONV_ERR ; } } * resp = reply ; return PAM_SUCCESS ; } 