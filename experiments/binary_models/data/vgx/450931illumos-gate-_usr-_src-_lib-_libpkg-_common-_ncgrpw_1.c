struct passwd * clpwnam ( char * nam ) { struct passwd * pw ; char * instroot , * buf ; FILE * pw_ptr ; if ( ( instroot = get_install_root ( ) ) != NULL ) { if ( asprintf ( & buf , "%s%s" , instroot , PASSWD ) < 0 ) { ( void ) fprintf ( stderr , pkg_gt ( ERR_MALLOC ) , "clpwnam()" , strlen ( instroot ) + strlen ( PASSWD ) , "buf" ) ; return ( NULL ) ; } if ( ( pw_ptr = fopen ( buf , "r" ) ) == NULL ) { return ( NULL ) ; } else { while ( ( pw = fgetpwent ( pw_ptr ) ) != NULL ) { if ( strcmp ( pw -> pw_name , nam ) == 0 ) { break ; } } } free ( buf ) ; ( void ) fclose ( pw_ptr ) ; return ( pw ) ; } else { return ( NULL ) ; } } 