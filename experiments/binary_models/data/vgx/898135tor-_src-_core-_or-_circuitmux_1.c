static chanid_circid_muxinfo_t * circuitmux_find_map_entry ( circuitmux_t * cmux , circuit_t * circ ) { chanid_circid_muxinfo_t search , * hashent = NULL ; tor_assert ( cmux ) ; tor_assert ( circ ) ; if ( circ -> n_chan ) { search . chan_id = circ -> n_chan -> global_identifier ; search . circ_id = circ -> n_circ_id ; hashent = HT_FIND ( chanid_circid_muxinfo_map , cmux -> chanid_circid_map , & search ) ; } if ( hashent ) { tor_assert ( hashent -> muxinfo . direction == CELL_DIRECTION_OUT ) ; } else { if ( circ -> magic == OR_CIRCUIT_MAGIC ) { search . circ_id = TO_OR_CIRCUIT ( circ ) -> p_circ_id ; if ( TO_OR_CIRCUIT ( circ ) -> p_chan ) { search . chan_id = TO_OR_CIRCUIT ( circ ) -> p_chan -> global_identifier ; hashent = HT_FIND ( chanid_circid_muxinfo_map , cmux -> chanid_circid_map , & search ) ; if ( hashent ) { tor_assert ( hashent -> muxinfo . direction == CELL_DIRECTION_IN ) ; } } } } return hashent ; } 