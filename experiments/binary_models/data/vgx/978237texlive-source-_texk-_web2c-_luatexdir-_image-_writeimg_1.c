void read_img ( image_dict * idict ) { char * filepath ; int callback_id ; if ( img_filename ( idict ) == NULL ) { normal_error ( "pdf backend" , "image file name missing" ) ; } callback_id = callback_defined ( find_image_file_callback ) ; if ( img_filepath ( idict ) == NULL ) { if ( callback_id > 0 ) { if ( run_callback ( callback_id , "S->S" , img_filename ( idict ) , & filepath ) ) { if ( filepath && ( strlen ( filepath ) > 0 ) ) { img_filepath ( idict ) = strdup ( filepath ) ; } } } if ( img_filepath ( idict ) == NULL && ( strstr ( img_filename ( idict ) , "data:application/pdf," ) != NULL ) ) { img_filepath ( idict ) = strdup ( img_filename ( idict ) ) ; } if ( callback_id == 0 ) { img_filepath ( idict ) = kpse_find_file ( img_filename ( idict ) , kpse_tex_format , true ) ; } if ( img_filepath ( idict ) == NULL ) { formatted_error ( "pdf backend" , "cannot find image file '%s'" , img_filename ( idict ) ) ; } } recorder_record_input ( img_filepath ( idict ) ) ; check_type_by_header ( idict ) ; check_type_by_extension ( idict ) ; switch ( img_type ( idict ) ) { case IMG_TYPE_PDFMEMSTREAM : case IMG_TYPE_PDF : read_pdf_info ( idict ) ; break ; case IMG_TYPE_PNG : read_png_info ( idict ) ; break ; case IMG_TYPE_JPG : read_jpg_info ( idict ) ; break ; case IMG_TYPE_JP2 : read_jp2_info ( idict ) ; break ; case IMG_TYPE_JBIG2 : read_jbig2_info ( idict ) ; break ; default : img_type ( idict ) = IMG_TYPE_NONE ; if ( pdf_ignore_unknown_images ) { normal_warning ( "pdf backend" , "internal error: ignoring unknown image type" ) ; } else { normal_error ( "pdf backend" , "internal error: unknown image type" ) ; } break ; } cur_file_name = NULL ; if ( img_type ( idict ) == IMG_TYPE_NONE ) { img_state ( idict ) = DICT_NEW ; } if ( img_state ( idict ) < DICT_FILESCANNED ) { img_state ( idict ) = DICT_FILESCANNED ; } } 