static int __emc2305_set_cur_state ( struct emc2305_data * data , int cdev_idx , unsigned long state ) { int ret ; struct i2c_client * client = data -> client ; u8 val , i ; state = max_t ( , , ) ; val = EMC2305_PWM_STATE2DUTY ( state , data -> max_state , EMC2305_FAN_MAX ) ; data -> cdev_data [ cdev_idx ] . cur_state = state ; if ( data -> pwm_separate ) { ret = i2c_smbus_write_byte_data ( client , EMC2305_REG_FAN_DRIVE ( cdev_idx ) , val ) ; } else { for ( i = 0 ; i < data -> pwm_num ; i ++ ) { ret = i2c_smbus_write_byte_data ( client , EMC2305_REG_FAN_DRIVE ( i ) , val ) ; if ( ret < 0 ) { return ret ; } } } return 0 ; } 