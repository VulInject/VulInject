int main ( int argc , const char * * argv ) { const char * fname = argv [ 1 ] ; struct stat sbuf ; int fd = open ( fname , O_RDONLY ) ; struct vparse_state parser ; char * data ; int r ; if ( argc != 2 ) { fprintf ( stderr , "Usage: %s fname\n" , argv [ 0 ] ) ; exit ( 1 ) ; } fstat ( fd , & sbuf ) ; data = malloc ( sbuf . st_size + 1 ) ; read ( fd , data , sbuf . st_size ) ; data [ sbuf . st_size ] = '\0' ; parser . base = data ; r = vparse_parse ( & parser , 0 ) ; if ( r ) { struct vparse_errorpos pos ; vparse_fillpos ( & parser , & pos ) ; printf ( "error %s at line %d char %d: %.*s ... %.*s<--- (started at line %d char %d)\n" , vparse_errstr ( r ) , pos . errorline , pos . errorchar , 20 , parser . base + pos . startpos , 20 , parser . base + pos . errorpos - 20 , pos . startline , pos . startchar ) ; return 1 ; } _dump ( parser . card ) ; vparse_free ( & parser ) ; return 0 ; } 