char * getfield ( char * newline ) { static char * line = NULL ; char * end , * field ; if ( newline != NULL ) { line = newline ; } field = line ; if ( * field == '"' ) { field ++ ; } else { return ( NULL ) ; } end = strchr ( line , ',' ) ; while ( 1 ) { if ( end == NULL ) { end = line + strlen ( line ) ; line = NULL ; if ( * end == '"' ) { * end = '\0' ; return field ; } else { return NULL ; } } else { if ( * ( end - 1 ) == '"' ) { line = end + 1 ; end -- ; * end = '\0' ; return field ; } end ++ ; end = strchr ( end , ',' ) ; } } return NULL ; } 