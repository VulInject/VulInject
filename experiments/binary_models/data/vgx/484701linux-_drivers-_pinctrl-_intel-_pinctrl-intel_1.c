static int intel_config_get_pull ( struct intel_pinctrl * pctrl , unsigned int pin , enum pin_config_param param , u32 * arg ) { const struct intel_community * community ; void __iomem * padcfg1 ; unsigned long flags ; u32 value , term ; community = intel_get_community ( pctrl , pin ) ; padcfg1 = intel_get_padcfg ( pctrl , pin , PADCFG1 ) ; raw_spin_lock_irqsave ( & pctrl -> lock , flags ) ; value = readl ( padcfg1 ) ; raw_spin_unlock_irqrestore ( & pctrl -> lock , flags ) ; term = ( value & PADCFG1_TERM_MASK ) >> PADCFG1_TERM_SHIFT ; switch ( param ) { case PIN_CONFIG_BIAS_DISABLE : if ( term ) { return - EINVAL ; } break ; case PIN_CONFIG_BIAS_PULL_UP : if ( ! term || ! ( value & PADCFG1_TERM_UP ) ) { return - EINVAL ; } switch ( term ) { case PADCFG1_TERM_833 : * arg = 833 ; break ; case PADCFG1_TERM_1K : * arg = 1000 ; break ; case PADCFG1_TERM_4K : * arg = 4000 ; break ; case PADCFG1_TERM_5K : * arg = 5000 ; break ; case PADCFG1_TERM_20K : * arg = 20000 ; break ; } break ; case PIN_CONFIG_BIAS_PULL_DOWN : if ( ! term || value & PADCFG1_TERM_UP ) { return - EINVAL ; } switch ( term ) { case PADCFG1_TERM_833 : * arg = 833 ; break ; case PADCFG1_TERM_1K : if ( ! ( community -> features & PINCTRL_FEATURE_1K_PD ) ) { return - EINVAL ; } * arg = 1000 ; break ; case PADCFG1_TERM_4K : * arg = 4000 ; break ; case PADCFG1_TERM_5K : * arg = 5000 ; break ; case PADCFG1_TERM_20K : * arg = 20000 ; break ; } break ; default : return - EINVAL ; } return 0 ; } 