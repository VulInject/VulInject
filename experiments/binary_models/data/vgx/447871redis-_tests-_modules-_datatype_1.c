int RedisModule_OnLoad ( RedisModuleCtx * ctx , RedisModuleString * * argv , int argc ) { REDISMODULE_NOT_USED ( argv ) ; REDISMODULE_NOT_USED ( argc ) ; if ( RedisModule_Init ( ctx , "datatype" , DATATYPE_ENC_VER , REDISMODULE_APIVER_1 ) == REDISMODULE_ERR ) { return REDISMODULE_ERR ; } RedisModule_SetModuleOptions ( ctx , REDISMODULE_OPTIONS_HANDLE_IO_ERRORS ) ; RedisModuleTypeMethods datatype_methods = { . version = REDISMODULE_TYPE_METHOD_VERSION . rdb_load = datatype_load . rdb_save = datatype_save . free = datatype_free . copy = datatype_copy } ; datatype = RedisModule_CreateDataType ( ctx , "test___dt" , 1 , & datatype_methods ) ; if ( RedisModule_CreateCommand ( ctx , "datatype.set" , datatype_set , "write deny-oom" , 1 , 1 , 1 ) == REDISMODULE_ERR ) { return REDISMODULE_ERR ; } if ( RedisModule_CreateCommand ( ctx , "datatype.get" , datatype_get , "" , 1 , 1 , 1 ) == REDISMODULE_ERR ) { return REDISMODULE_ERR ; } if ( RedisModule_CreateCommand ( ctx , "datatype.restore" , datatype_restore , "write deny-oom" , 1 , 1 , 1 ) == REDISMODULE_ERR ) { return REDISMODULE_ERR ; } if ( RedisModule_CreateCommand ( ctx , "datatype.dump" , datatype_dump , "" , 1 , 1 , 1 ) == REDISMODULE_ERR ) { return REDISMODULE_ERR ; } if ( RedisModule_CreateCommand ( ctx , "datatype.swap" , datatype_swap , "write" , 1 , 1 , 1 ) == REDISMODULE_ERR ) { return REDISMODULE_ERR ; } if ( RedisModule_CreateCommand ( ctx , "datatype.slow_loading" , datatype_slow_loading , "allow-loading" , 0 , 0 , 0 ) == REDISMODULE_ERR ) { return REDISMODULE_ERR ; } if ( RedisModule_CreateCommand ( ctx , "datatype.is_in_slow_loading" , datatype_is_in_slow_loading , "allow-loading" , 0 , 0 , 0 ) == REDISMODULE_ERR ) { return REDISMODULE_ERR ; } return REDISMODULE_OK ; } 