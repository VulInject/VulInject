static int recover_peb ( struct ubi_device * ubi , int pnum , int vol_id , int lnum , const void * buf , int offset , int len ) { int err , idx = vol_id2idx ( ubi , vol_id ) , tries ; struct ubi_volume * vol = ubi -> volumes [ idx ] ; struct ubi_vid_io_buf * vidb ; vidb = ubi_alloc_vid_buf ( ubi , GFP_NOFS ) ; for ( tries = 0 ; tries <= UBI_IO_RETRIES ; tries ++ ) { bool retry ; err = try_recover_peb ( vol , pnum , lnum , buf , offset , len , vidb , & retry ) ; if ( ! err || ! retry ) { break ; } ubi_msg ( ubi , "try again" ) ; } ubi_free_vid_buf ( vidb ) ; return err ; } 