static int qmi_encode_string_elem ( const struct qmi_elem_info * ei_array , void * buf_dst , const void * buf_src , u32 out_buf_len , int enc_level ) { int rc ; int encoded_bytes = 0 ; const struct qmi_elem_info * temp_ei = ei_array ; u32 string_len = 0 ; u32 string_len_sz = 0 ; string_len = strlen ( buf_src , NULL ) ; string_len_sz = temp_ei -> elem_len <= U8_MAX ?sizeof ( u8 ) : sizeof ( u16 ) ; if ( string_len > temp_ei -> elem_len ) { pr_err ( "%s: String to be encoded is longer - %d>%d\n" , __func__ , string_len , temp_ei -> elem_len ) ; return - EINVAL ; } if ( enc_level == 1 ) { if ( string_len + TLV_LEN_SIZE + TLV_TYPE_SIZE > out_buf_len ) { pr_err ( "%s: Output len %d>Out Buf len %d\n" , __func__ , string_len , out_buf_len ) ; return - ETOOSMALL ; } } else { if ( string_len + string_len_sz > out_buf_len ) { pr_err ( "%s: Output len %d>Out Buf len %d\n" , __func__ , string_len , out_buf_len ) ; return - ETOOSMALL ; } rc = qmi_encode_basic_elem ( buf_dst , & string_len , 1 , string_len_sz ) ; encoded_bytes += rc ; } rc = qmi_encode_basic_elem ( buf_dst + encoded_bytes , buf_src , string_len , temp_ei -> elem_size ) ; encoded_bytes += rc ; return encoded_bytes ; } 