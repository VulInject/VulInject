static int wm8728_spi_probe ( struct spi_device * spi ) { struct wm8728_priv * wm8728 ; int ret ; wm8728 = devm_kzalloc ( & spi -> dev , sizeof ( wm8728_priv ) , GFP_KERNEL ) ; wm8728 -> regmap = devm_regmap_init_spi ( spi , & wm8728_regmap ) ; if ( IS_ERR ( wm8728 -> regmap ) ) { return PTR_ERR ( wm8728 -> regmap ) ; } spi_set_drvdata ( spi , wm8728 ) ; ret = devm_snd_soc_register_component ( & spi -> dev , & soc_component_dev_wm8728 , & wm8728_dai , 1 ) ; return ret ; } 