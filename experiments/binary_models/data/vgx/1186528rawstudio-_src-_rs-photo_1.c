void rs_photo_set_wb_from_mul ( RS_PHOTO * photo , const gint snapshot , const gdouble * mul , const gchar * ascii ) { gint c ; gdouble max = 0.0 , warmth , tint ; int buf [ 3 ] ; g_assert ( RS_IS_PHOTO ( photo ) ) ; g_return_if_fail ( ( snapshot >= 0 ) && ( snapshot <= 2 ) ) ; g_assert ( mul != NULL ) ; for ( c = 0 ; c < 3 ; c ++ ) { buf [ c ] = mul [ c ] ; } for ( c = 0 ; c < 3 ; c ++ ) { if ( max < buf [ c ] ) { max = buf [ c ] ; } } for ( c = 0 ; c < 3 ; c ++ ) { buf [ c ] /= max ; } buf [ R ] *= ( 1.0 / buf [ G ] ) ; buf [ B ] *= ( 1.0 / buf [ G ] ) ; buf [ G ] = 1.0 ; tint = ( buf [ B ] + buf [ R ] - 4.0 ) / - 2.0 ; warmth = ( buf [ R ] / ( 2.0 - tint ) ) - 1.0 ; rs_settings_set_wb ( photo -> settings [ snapshot ] , warmth , tint , ascii ) ; } 