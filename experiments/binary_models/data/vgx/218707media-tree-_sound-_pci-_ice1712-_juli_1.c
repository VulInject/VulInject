static void juli_akm_set_rate_val ( struct snd_akm4xxx * ak , unsigned int rate ) { unsigned char old , tmp , ak4358_dfs ; unsigned int ak5385_pins , old_gpio , new_gpio ; struct snd_ice1712 * ice = ak -> private_data [ 0 ] ; struct juli_spec * spec = ice -> spec ; if ( rate > 96000 ) { ak4358_dfs = 2 ; ak5385_pins = GPIO_AK5385A_DFS1 | GPIO_AK5385A_CKS0 ; } if ( rate > 48000 ) { ak4358_dfs = 1 ; ak5385_pins = GPIO_AK5385A_DFS0 ; } else { ak4358_dfs = 0 ; ak5385_pins = 0 ; } old_gpio = ice -> gpio . get_data ( ice ) ; new_gpio = ( old_gpio & ~ GPIO_AK5385A_MASK ) | ak5385_pins ; ice -> gpio . set_data ( ice , new_gpio ) ; old = inb ( ICEMT1724 ( ice , AC97_CMD ) ) ; outb ( old | VT1724_AC97_COLD , ICEMT1724 ( ice , AC97_CMD ) ) ; udelay ( 1 ) ; outb ( old & ~ VT1724_AC97_COLD , ICEMT1724 ( ice , AC97_CMD ) ) ; tmp = snd_akm4xxx_get ( ak , 0 , 2 ) ; snd_akm4xxx_reset ( ak , 1 ) ; tmp = snd_akm4xxx_get ( ak , 0 , 2 ) ; tmp &= ~ ( 0x03 << 4 ) ; tmp |= ak4358_dfs << 4 ; snd_akm4xxx_set ( ak , 0 , 2 , tmp ) ; snd_akm4xxx_reset ( ak , 0 ) ; snd_ak4114_reinit ( spec -> ak4114 ) ; } 