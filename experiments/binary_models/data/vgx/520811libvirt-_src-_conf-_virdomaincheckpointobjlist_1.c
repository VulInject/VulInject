int virDomainListCheckpoints ( virDomainCheckpointObjList * checkpoints , virDomainMomentObj * from , virDomainPtr dom , virDomainCheckpointPtr * * chks , unsigned int flags ) { int count = virDomainCheckpointObjListGetNames ( checkpoints , from , NULL , 0 , flags ) ; virDomainCheckpointPtr * list = NULL ; char * * names ; int ret = - 1 ; size_t i ; if ( ! chks || count < 0 ) { return count ; } names = g_new0 ( char * , count ) ; list = g_new0 ( virDomainCheckpointPtr , count + 1 ) ; if ( virDomainCheckpointObjListGetNames ( checkpoints , from , names , count , flags ) < 0 ) { cleanup } for ( i = 0 ; i < count ; i ++ ) { if ( ( list [ i ] = virGetDomainCheckpoint ( dom , names [ i ] ) ) == NULL ) { cleanup } } ret = count ; * chks = list ; cleanup for ( i = 0 ; i < count ; i ++ ) { VIR_FREE ( names [ i ] ) ; } VIR_FREE ( names ) ; if ( ret < 0 && list ) { for ( i = 0 ; i < count ; i ++ ) { virObjectUnref ( list [ i ] ) ; } VIR_FREE ( list , NULL ) ; } return ret ; } 