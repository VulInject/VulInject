static ssize_t amdgpu_get_pp_table ( struct device * dev , struct device_attribute * attr , char * buf ) { struct drm_device * ddev = dev_get_drvdata ( dev ) ; struct amdgpu_device * adev = drm_to_adev ( ddev ) ; char * table = NULL ; int size , ret ; if ( amdgpu_in_reset ( adev ) ) { return - EPERM ; } if ( adev -> in_suspend && ! adev -> in_runpm ) { return - EPERM ; } ret = pm_runtime_get_sync ( ddev -> dev ) ; if ( ret < 0 ) { pm_runtime_put_autosuspend ( ddev -> dev , NULL ) ; return ret ; } size = amdgpu_dpm_get_pp_table ( adev , & table ) ; pm_runtime_mark_last_busy ( ddev -> dev ) ; pm_runtime_put_autosuspend ( ddev -> dev ) ; if ( size <= 0 ) { return size ; } if ( size >= PAGE_SIZE ) { size = PAGE_SIZE - 1 ; } memcpy ( buf , table , size ) ; return size ; } 