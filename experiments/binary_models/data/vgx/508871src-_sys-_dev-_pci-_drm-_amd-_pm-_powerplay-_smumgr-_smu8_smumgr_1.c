static int smu8_check_fw_load_finish ( struct pp_hwmgr * hwmgr , uint32_t firmware ) { int i ; uint32_t index = SMN_MP1_SRAM_START_ADDR + SMU8_FIRMWARE_HEADER_LOCATION + offsetof ( SMU8_Firmware_Header , UcodeLoadStatus ) ; cgs_write_register ( hwmgr -> device , mmMP0PUB_IND_INDEX , index ) ; for ( i = 0 ; i < hwmgr -> usec_timeout ; i ++ ) { if ( firmware == ( cgs_read_register ( hwmgr -> device , mmMP0PUB_IND_DATA ) & firmware ) ) { break ; } udelay ( 1 ) ; } if ( i >= hwmgr -> usec_timeout ) { pr_err ( "SMU check loaded firmware failed.\n" ) ; return - EINVAL ; } return 0 ; } 