static ssize_t store_current_governor ( struct device * dev , struct device_attribute * attr , const char * buf , size_t count ) { char gov_name [ CPUIDLE_NAME_LEN ] ; int ret = - EINVAL ; size_t len = count ; struct cpuidle_governor * gov ; memcpy ( gov_name , buf , len ) ; gov_name [ len ] = '\0' ; if ( gov_name [ len - 1 ] == '\n' ) { gov_name [ -- len ] = '\0' ; } mutex_lock ( & cpuidle_lock ) ; list_for_each_entry ( , , ) { if ( strlen ( gov -> name ) == len && ! strcmp ( gov -> name , gov_name ) ) { ret = cpuidle_switch_governor ( gov ) ; break ; } } mutex_unlock ( & cpuidle_lock ) ; if ( ret ) { return ret ; } else { return count ; } } 