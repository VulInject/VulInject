void crypto_mac_sha3_256 ( uint8_t * mac_out , size_t len_out , const uint8_t * key , size_t key_len , const uint8_t * msg , size_t msg_len ) { crypto_digest_t * digest ; const uint64_t key_len_netorder = tor_htonll ( key_len ) ; tor_assert ( mac_out ) ; tor_assert ( key ) ; digest = crypto_digest256_new ( DIGEST_SHA3_256 ) ; crypto_digest_add_bytes ( digest , ( const char * ) & key_len_netorder , sizeof ( key_len_netorder ) ) ; crypto_digest_add_bytes ( digest , ( const char * ) key , key_len ) ; crypto_digest_add_bytes ( digest , ( const char * ) msg , msg_len ) ; crypto_digest_get_digest ( digest , ( char * ) mac_out , len_out ) ; crypto_digest_free ( digest ) ; } 