int cpuidle_add_sysfs ( struct cpuidle_device * dev ) { struct cpuidle_device_kobj * kdev ; struct device * cpu_dev = get_cpu_device ( ( unsigned long ) dev -> cpu ) ; int error ; if ( ! cpu_dev ) { return - ENODEV ; } kdev = kmalloc ( sizeof ( * kdev ) , GFP_KERNEL ) ; if ( ! kdev ) { return - ENOMEM ; } kdev -> dev = dev ; dev -> kobj_dev = kdev ; init_completion ( & kdev -> kobj_unregister ) ; error = kobject_init_and_add ( & kdev -> kobj , & ktype_cpuidle , & cpu_dev -> kobj , "cpuidle" ) ; if ( error ) { kfree ( kdev ) ; return error ; } kobject_uevent ( & kdev -> kobj , KOBJ_ADD ) ; return 0 ; } 