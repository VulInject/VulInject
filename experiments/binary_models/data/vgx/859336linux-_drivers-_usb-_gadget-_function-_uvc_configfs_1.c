static ssize_t uvcg_extension_ba_source_id_store ( struct config_item * item , const char * page , size_t len ) { struct config_group * group = to_config_group ( item -> ci_parent ) ; struct mutex * su_mutex = & group -> cg_subsys -> su_mutex ; struct uvcg_extension * xu = to_uvcg_extension ( item ) ; struct config_item * opts_item ; struct f_uvc_opts * opts ; u8 * source_ids , * iter ; int ret , n = 0 ; mutex_lock ( su_mutex ) ; opts_item = item -> ci_parent -> ci_parent -> ci_parent ; opts = to_f_uvc_opts ( opts_item ) ; mutex_lock ( & opts -> lock ) ; ret = __uvcg_iter_item_entries ( page , len , __uvcg_count_item_entries , & n , sizeof ( u8 ) ) ; if ( ret ) { unlock } iter = source_ids = kcalloc ( n , sizeof ( u8 ) , GFP_KERNEL ) ; if ( ! source_ids ) { ret = - ENOMEM ; unlock } ret = __uvcg_iter_item_entries ( page , len , __uvcg_fill_item_entries , & iter , sizeof ( u8 ) ) ; if ( ret ) { unlock } kfree ( xu -> desc . baSourceID ) ; xu -> desc . baSourceID = source_ids ; xu -> desc . bNrInPins = n ; xu -> desc . bLength = UVC_DT_EXTENSION_UNIT_SIZE ( xu -> desc . bNrInPins , xu -> desc . bControlSize ) ; ret = len ; unlock mutex_unlock ( & opts -> lock ) ; mutex_unlock ( su_mutex ) ; return ret ; } 