struct drm_gem_object * mtk_gem_prime_import_sg_table ( struct drm_device * dev , struct dma_buf_attachment * attach , struct sg_table * sg ) { struct mtk_drm_gem_obj * mtk_gem ; int ret ; struct scatterlist * s ; unsigned int i ; dma_addr_t expected ; mtk_gem = mtk_drm_gem_init ( dev , attach -> dmabuf -> size ) ; if ( IS_ERR ( mtk_gem ) ) { return ERR_PTR ( PTR_ERR ( mtk_gem ) ) ; } expected = sg_dma_address ( sg -> sgl ) ; for_each_sg ( , , , ) { if ( sg_dma_address ( s ) != expected ) { DRM_ERROR ( "sg_table is not contiguous" ) ; ret = - EINVAL ; err_gem_free } expected = sg_dma_address ( s ) + sg_dma_len ( s ) ; } mtk_gem -> dma_addr = sg_dma_address ( sg -> sgl ) ; mtk_gem -> sg = sg ; return & mtk_gem -> base ; err_gem_free return ERR_PTR ( ret ) ; } 