static int iser_alloc_pi_ctx ( struct iser_device * device , struct ib_pd * pd , struct iser_fr_desc * desc , unsigned int size ) { struct iser_pi_context * pi_ctx = NULL ; int ret ; desc -> pi_ctx = kzalloc ( sizeof ( * desc -> pi_ctx ) , GFP_KERNEL ) ; pi_ctx = desc -> pi_ctx ; ret = iser_alloc_reg_res ( device , pd , & pi_ctx -> rsc , size ) ; if ( ret ) { iser_err ( "failed to allocate reg_resources\n" ) ; alloc_reg_res_err } pi_ctx -> sig_mr = ib_alloc_mr ( pd , IB_MR_TYPE_SIGNATURE , 2 ) ; if ( IS_ERR ( pi_ctx -> sig_mr ) ) { ret = PTR_ERR ( pi_ctx -> sig_mr ) ; sig_mr_failure } pi_ctx -> sig_mr_valid = 0 ; desc -> pi_ctx -> sig_protected = 0 ; return 0 ; sig_mr_failure iser_free_reg_res ( & pi_ctx -> rsc ) ; alloc_reg_res_err kfree ( desc -> pi_ctx ) ; return ret ; } 