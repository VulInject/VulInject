static struct ev7_pal_io_subpacket * marvel_find_io7_with_error ( struct ev7_lf_subpackets * lf_subpackets ) { struct ev7_pal_io_subpacket * io = lf_subpackets -> io ; struct io7 * io7 ; int i ; if ( ! io ) { return NULL ; } for ( io7 = NULL ; NULL != ( io7 = marvel_next_io7 ( io7 ) ) ; ) { unsigned long err_sum = 0 ; err_sum |= io7 -> csrs -> PO7_ERROR_SUM . csr ; for ( i = 0 ; i < IO7_NUM_PORTS ; i ++ ) { if ( ! io7 -> ports [ i ] . enabled ) { continue ; } err_sum |= io7 -> ports [ i ] . csrs -> POx_ERR_SUM . csr ; } if ( err_sum & ( 1UL << 63 ) ) { break ; } } if ( ! io7 ) { return NULL ; } io -> io_asic_rev = io7 -> csrs -> IO_ASIC_REV . csr ; io -> io_sys_rev = io7 -> csrs -> IO_SYS_REV . csr ; io -> io7_uph = io7 -> csrs -> IO7_UPH . csr ; io -> hpi_ctl = io7 -> csrs -> HPI_CTL . csr ; io -> crd_ctl = io7 -> csrs -> CRD_CTL . csr ; io -> hei_ctl = io7 -> csrs -> HEI_CTL . csr ; io -> po7_error_sum = io7 -> csrs -> PO7_ERROR_SUM . csr ; io -> po7_uncrr_sym = io7 -> csrs -> PO7_UNCRR_SYM . csr ; io -> po7_crrct_sym = io7 -> csrs -> PO7_CRRCT_SYM . csr ; io -> po7_ugbge_sym = io7 -> csrs -> PO7_UGBGE_SYM . csr ; io -> po7_err_pkt0 = io7 -> csrs -> PO7_ERR_PKT [ 0 ] . csr ; io -> po7_err_pkt1 = io7 -> csrs -> PO7_ERR_PKT [ 1 ] . csr ; for ( i = 0 ; i < IO7_NUM_PORTS ; i ++ ) { io7_ioport_csrs * csrs = io7 -> ports [ i ] . csrs ; if ( ! io7 -> ports [ i ] . enabled ) { continue ; } io -> ports [ i ] . pox_err_sum = csrs -> POx_ERR_SUM . csr ; io -> ports [ i ] . pox_tlb_err = csrs -> POx_TLB_ERR . csr ; io -> ports [ i ] . pox_spl_cmplt = csrs -> POx_SPL_COMPLT . csr ; io -> ports [ i ] . pox_trans_sum = csrs -> POx_TRANS_SUM . csr ; io -> ports [ i ] . pox_first_err = csrs -> POx_FIRST_ERR . csr ; io -> ports [ i ] . pox_mult_err = csrs -> POx_MULT_ERR . csr ; io -> ports [ i ] . pox_dm_source = csrs -> POx_DM_SOURCE . csr ; io -> ports [ i ] . pox_dm_dest = csrs -> POx_DM_DEST . csr ; io -> ports [ i ] . pox_dm_size = csrs -> POx_DM_SIZE . csr ; io -> ports [ i ] . pox_dm_ctrl = csrs -> POx_DM_CTRL . csr ; csrs -> POx_TLB_ERR . csr = io -> ports [ i ] . pox_tlb_err ; csrs -> POx_ERR_SUM . csr = io -> ports [ i ] . pox_err_sum ; mb ( ) ; csrs -> POx_ERR_SUM . csr ; } io7 -> csrs -> PO7_ERROR_SUM . csr = io -> po7_error_sum ; mb ( ) ; io7 -> csrs -> PO7_ERROR_SUM . csr ; lf_subpackets -> io_pid = io7 -> pe ; return io ; } 