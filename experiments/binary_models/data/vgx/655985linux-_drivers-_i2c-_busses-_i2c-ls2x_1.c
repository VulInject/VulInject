static int ls2x_i2c_rx ( struct ls2x_i2c_priv * priv , struct i2c_msg * msg ) { int ret ; u8 rxdata , * buf = msg -> buf ; u16 len = msg -> len ; ret = ls2x_i2c_start ( priv , msg ) ; while ( len -- ) { ret = ls2x_i2c_xfer_byte ( priv , LS2X_CR_READ | ( len ?0 : LS2X_CR_ACK ) , & rxdata ) ; if ( ret ) { return ret ; } * buf ++ = readb ( priv -> base + I2C_LS2X_RXR ) ; } return 0 ; } 