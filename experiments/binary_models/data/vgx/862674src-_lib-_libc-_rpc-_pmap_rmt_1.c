( xdr_rmtcallres ) ; static int newgetbroadcastnets ( struct in_addr * * addrsp ) { struct ifaddrs * ifap , * ifa ; struct sockaddr_in * sin ; struct in_addr * addrs ; int i = 0 , n = 0 ; if ( getifaddrs ( & ifap ) != 0 ) { return 0 ; } for ( ifa = ifap ; ifa ; ifa = ifa -> ifa_next ) { if ( ifa -> ifa_addr == NULL || ifa -> ifa_addr -> sa_family != AF_INET ) { continue ; } if ( ( ifa -> ifa_flags & IFF_BROADCAST ) && ( ifa -> ifa_flags & IFF_UP ) && ifa -> ifa_broadaddr && ifa -> ifa_broadaddr -> sa_family == AF_INET ) { n ++ ; } } addrs = calloc ( n , sizeof ( * addrs ) ) ; if ( addrs == NULL ) { return 0 ; } for ( ifa = ifap ; ifa ; ifa = ifa -> ifa_next ) { if ( ifa -> ifa_addr == NULL || ifa -> ifa_addr -> sa_family != AF_INET ) { continue ; } if ( ( ifa -> ifa_flags & IFF_BROADCAST ) && ( ifa -> ifa_flags & IFF_UP ) && ifa -> ifa_broadaddr && ifa -> ifa_broadaddr -> sa_family == AF_INET ) { sin = ( sockaddr_in * ) ifa -> ifa_broadaddr ; addrs [ i ++ ] = sin -> sin_addr ; } } freeifaddrs ( ifap ) ; * addrsp = addrs ; return i ; } 