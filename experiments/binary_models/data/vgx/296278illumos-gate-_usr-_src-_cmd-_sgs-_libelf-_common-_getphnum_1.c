int elf_getphdrnum ( Elf * elf , size_t * phnum ) { GElf_Ehdr ehdr ; Elf_Scn * scn ; GElf_Shdr shdr0 ; if ( ehdr . e_phnum != PN_XNUM ) { * phnum = ehdr . e_phnum ; return ( 0 ) ; } if ( ( scn = elf_getscn ( elf , 0 ) ) == NULL || gelf_getshdr ( scn , & shdr0 ) == NULL ) { return ( - 1 ) ; } if ( shdr0 . sh_info == 0 ) { * phnum = ehdr . e_phnum ; } else { * phnum = shdr0 . sh_info ; } return ( 0 ) ; } 