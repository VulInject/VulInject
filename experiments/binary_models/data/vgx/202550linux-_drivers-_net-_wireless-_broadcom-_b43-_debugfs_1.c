static int shm16write__write_file ( struct b43_wldev * dev , const char * buf , size_t count ) { unsigned int routing , addr , mask , set ; u16 val ; int res ; res = sscanf ( buf , "0x%X 0x%X 0x%X 0x%X" , & routing , & addr , & mask , & set ) ; if ( res != 4 ) { return - EINVAL ; } if ( addr > B43_MAX_SHM_ADDR ) { return - EADDRNOTAVAIL ; } if ( routing == B43_SHM_SHARED ) { if ( ( addr % 2 ) != 0 ) { return - EADDRNOTAVAIL ; } } if ( ( mask > 0xFFFF ) || ( set > 0xFFFF ) ) { return - E2BIG ; } if ( mask == 0 ) { val = 0 ; } else { val = b43_shm_read16 ( dev , routing , addr ) ; } val &= mask ; val |= set ; b43_shm_write16 ( dev , routing , addr , val ) ; return 0 ; } 