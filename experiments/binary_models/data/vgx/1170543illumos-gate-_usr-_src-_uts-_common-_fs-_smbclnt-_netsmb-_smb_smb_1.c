int smb_smb_echo ( struct smb_vc * vcp , struct smb_cred * scred , int timo ) { struct smb_rq * rqp ; struct mbchain * mbp ; int error ; error = smb_rq_alloc ( VCTOCP ( vcp ) , SMB_COM_ECHO , scred , & rqp ) ; if ( error ) { return ( error ) ; } mbp = & rqp -> sr_rq ; smb_rq_wstart ( rqp ) ; mb_put_uint16le ( mbp , 1 ) ; smb_rq_wend ( rqp ) ; smb_rq_bstart ( rqp ) ; mb_put_uint32le ( mbp , atomic_inc_32_nv ( & smbechoes ) ) ; smb_rq_bend ( rqp ) ; rqp -> sr_flags |= SMBR_NORECONNECT ; error = smb_rq_internal ( rqp , timo ) ; SMBSDEBUG ( "%d\n" , error ) ; smb_rq_done ( rqp , NULL ) ; return ( error ) ; } 