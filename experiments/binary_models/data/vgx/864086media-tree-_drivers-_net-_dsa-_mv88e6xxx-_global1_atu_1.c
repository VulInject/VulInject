int mv88e6xxx_g1_atu_set_age_time ( struct mv88e6xxx_chip * chip , unsigned int msecs ) { const unsigned int coeff = chip -> info -> age_time_coeff ; const unsigned int min = 0x01 * coeff ; const unsigned int max = 0xff * coeff ; u8 age_time ; u16 val ; int err ; age_time = ( msecs + coeff / 2 ) / coeff ; err = mv88e6xxx_g1_read ( chip , GLOBAL_ATU_CONTROL , & val ) ; if ( err ) { return err ; } val &= ~ 0xff0 ; val |= age_time << 4 ; err = mv88e6xxx_g1_write ( chip , GLOBAL_ATU_CONTROL , val ) ; if ( err ) { return err ; } dev_dbg ( chip -> dev , "AgeTime set to 0x%02x (%d ms)\n" , age_time , age_time * coeff ) ; return 0 ; } 