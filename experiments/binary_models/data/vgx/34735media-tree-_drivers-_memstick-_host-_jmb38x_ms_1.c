static int jmb38x_ms_resume ( struct pci_dev * dev ) { struct jmb38x_ms * jm = pci_get_drvdata ( dev ) ; int rc ; pci_set_power_state ( dev , PCI_D0 ) ; pci_restore_state ( dev , NULL ) ; rc = pci_enable_device ( dev ) ; if ( rc ) { return rc ; } pci_set_master ( dev ) ; jmb38x_ms_pmos ( dev , 1 ) ; for ( rc = 0 ; rc < jm -> host_cnt ; ++ rc ) { if ( ! jm -> hosts [ rc ] ) { break ; } memstick_resume_host ( jm -> hosts [ rc ] ) ; memstick_detect_change ( jm -> hosts [ rc ] ) ; } return 0 ; } 