static int __s5k6aa_set_frame_interval ( struct s5k6aa * s5k6aa , struct v4l2_subdev_frame_interval * fi ) { struct v4l2_mbus_framefmt * mbus_fmt = & s5k6aa -> preset -> mbus_fmt ; const struct s5k6aa_interval * fiv = & s5k6aa_intervals [ 0 ] ; unsigned int err , min_err = UINT_MAX ; unsigned int i , fr_time ; fr_time = fi -> interval . numerator * 10000 / fi -> interval . denominator ; for ( i = 0 ; i < ARRAY_SIZE ( s5k6aa_intervals ) ; i ++ ) { const struct s5k6aa_interval * iv = & s5k6aa_intervals [ i ] ; if ( mbus_fmt -> width > iv -> size . width || mbus_fmt -> height > iv -> size . height ) { continue ; } err = abs ( iv -> reg_fr_time - fr_time ) ; if ( err < min_err ) { fiv = iv ; min_err = err ; } } s5k6aa -> fiv = fiv ; v4l2_dbg ( 1 , debug , & s5k6aa -> sd , "Changed frame interval to %d us\n" , fiv -> reg_fr_time * 100 ) ; return 0 ; } 