static struct rtllib_txb * rtllib_alloc_txb ( int nr_frags , int txb_size , gfp_t gfp_mask ) { struct rtllib_txb * txb ; int i ; txb = kmalloc ( struct_size ( txb , fragments , nr_frags ) , gfp_mask ) ; if ( ! txb ) { return NULL ; } txb -> nr_frags = nr_frags ; txb -> frag_size = cpu_to_le16 ( txb_size ) ; for ( i = 0 ; i < nr_frags ; i ++ ) { txb -> fragments [ i ] = dev_alloc_skb ( txb_size ) ; if ( unlikely ( ! txb -> fragments [ i ] ) ) { err_free } memset ( txb -> fragments [ i ] -> cb , 0 , sizeof ( txb -> fragments [ i ] -> cb ) ) ; } return txb ; err_free while ( -- i >= 0 ) { dev_kfree_skb_any ( txb -> fragments [ i ] ) ; } kfree ( txb ) ; return NULL ; } 