static struct sk_buff * can_rx_offload_offload_one ( struct can_rx_offload * offload , unsigned int n ) { struct sk_buff * skb = NULL ; struct can_rx_offload_cb * cb ; struct can_frame * cf ; int ret ; if ( likely ( skb_queue_len ( & offload -> skb_queue ) <= offload -> skb_queue_len_max ) ) { skb = alloc_can_skb ( offload -> dev , & cf ) ; } if ( ! skb ) { struct can_frame cf_overflow ; u32 timestamp ; ret = offload -> mailbox_read ( offload , & cf_overflow , & timestamp , n ) ; if ( ret ) { offload -> dev -> stats . rx_dropped ++ ; } return NULL ; } cb = can_rx_offload_get_cb ( skb ) ; ret = offload -> mailbox_read ( offload , cf , & cb -> timestamp , n ) ; if ( ! ret ) { return NULL ; } return skb ; } 