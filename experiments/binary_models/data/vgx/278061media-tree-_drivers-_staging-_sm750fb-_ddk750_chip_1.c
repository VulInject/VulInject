static void set_memory_clock ( unsigned int frequency ) { unsigned int reg , divisor ; if ( frequency ) { if ( frequency > MHz ( 336 ) ) { frequency = MHz ( 336 ) ; } divisor = DIV_ROUND_CLOSEST ( get_mxclk_freq ( ) , frequency ) ; reg = peek32 ( CURRENT_GATE ) & ~ CURRENT_GATE_M2XCLK_MASK ; switch ( divisor ) { default : case 1 : reg |= CURRENT_GATE_M2XCLK_DIV_1 ; break ; case 2 : reg |= CURRENT_GATE_M2XCLK_DIV_2 ; break ; case 3 : reg |= CURRENT_GATE_M2XCLK_DIV_3 ; break ; case 4 : reg |= CURRENT_GATE_M2XCLK_DIV_4 ; break ; } sm750_set_current_gate ( reg ) ; } } 