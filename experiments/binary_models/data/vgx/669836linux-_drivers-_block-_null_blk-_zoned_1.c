int null_register_zoned_dev ( struct nullb * nullb ) { struct nullb_device * dev = nullb -> dev ; struct request_queue * q = nullb -> q ; disk_set_zoned ( nullb -> disk , BLK_ZONED_HM ) ; blk_queue_flag_set ( QUEUE_FLAG_ZONE_RESETALL , q ) ; blk_queue_required_elevator_features ( q , ELEVATOR_F_ZBD_SEQ_WRITE ) ; if ( queue_is_mq ( q ) ) { int ret = blk_revalidate_disk_zones ( nullb -> disk , NULL ) ; } else { blk_queue_chunk_sectors ( q , dev -> zone_size_sects ) ; nullb -> disk -> nr_zones = bdev_nr_zones ( nullb -> disk -> part0 ) ; } blk_queue_max_zone_append_sectors ( q , dev -> zone_size_sects ) ; disk_set_max_open_zones ( nullb -> disk , dev -> zone_max_open ) ; disk_set_max_active_zones ( nullb -> disk , dev -> zone_max_active ) ; return 0 ; } 