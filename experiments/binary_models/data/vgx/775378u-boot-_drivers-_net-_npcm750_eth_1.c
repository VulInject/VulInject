static int npcm750_mdio_write ( struct mii_dev * bus , int addr , int devad , int regs , u16 val ) { struct npcm750_eth_dev * priv = ( npcm750_eth_dev * ) bus -> priv ; struct emc_regs * reg = priv -> emc_regs_p ; int start ; int ret = - ETIMEDOUT , timeout = CFG_MDIO_TIMEOUT ; writel ( val , & reg -> miid ) ; writel ( ( addr << 0x08 ) | regs | PHYBUSY | PHYWR | ( MIIDA_MDCCR_60 << 20 ) , & reg -> miida ) ; start = get_timer ( 0 ) ; while ( get_timer ( start ) < timeout ) { if ( ! ( readl ( & reg -> miida ) & PHYBUSY ) ) { ret = 0 ; break ; } udelay ( 10 ) ; } return ret ; } 