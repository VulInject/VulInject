int iwx_rm_sta ( struct iwx_softc * sc , struct iwx_node * in ) { struct ieee80211com * ic = & sc -> sc_ic ; struct ieee80211_node * ni = & in -> in_ni ; int err , i ; err = iwx_flush_sta ( sc , in ) ; if ( err ) { printf ( "%s: could not flush Tx path (error %d)\n" , DEVNAME ( sc ) , err ) ; return err ; } err = iwx_rm_sta_cmd ( sc , in ) ; if ( err ) { printf ( "%s: could not remove STA (error %d)\n" , DEVNAME ( sc ) , err ) ; return err ; } in -> in_flags = 0 ; sc -> sc_rx_ba_sessions = 0 ; sc -> ba_rx . start_tidmask = 0 ; sc -> ba_rx . stop_tidmask = 0 ; sc -> ba_tx . start_tidmask = 0 ; sc -> ba_tx . stop_tidmask = 0 ; for ( i = IWX_FIRST_AGG_TX_QUEUE ; i < IWX_LAST_AGG_TX_QUEUE ; i ++ ) { sc -> qenablemsk &= ~ ( 1 << i ) ; } for ( i = 0 ; i < IEEE80211_NUM_TID ; i ++ ) { struct ieee80211_tx_ba * ba = & ni -> ni_tx_ba [ i ] ; if ( ba -> ba_state != IEEE80211_BA_AGREED ) { continue ; } ieee80211_delba_request ( ic , ni , 0 , 1 , i ) ; } return 0 ; } 