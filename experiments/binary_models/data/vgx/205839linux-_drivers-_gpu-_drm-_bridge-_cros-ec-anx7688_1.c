static bool cros_ec_anx7688_bridge_mode_fixup ( struct drm_bridge * bridge , const struct drm_display_mode * mode , struct drm_display_mode * adjusted_mode ) { struct cros_ec_anx7688 * anx = bridge_to_cros_ec_anx7688 ( bridge ) ; int totalbw , requiredbw ; u8 dpbw , lanecount ; u8 regs [ 2 ] ; int ret ; ret = regmap_bulk_read ( anx -> regmap , ANX7688_DP_BANDWIDTH_REG , regs , 2 ) ; if ( ret < 0 ) { DRM_ERROR ( "Failed to read bandwidth/lane count\n" ) ; return false ; } dpbw = regs [ 0 ] ; lanecount = regs [ 1 ] ; if ( dpbw > 0x19 || lanecount > 2 ) { DRM_ERROR ( "Invalid bandwidth/lane count (%02x/%d)\n" , dpbw , lanecount ) ; return false ; } totalbw = dpbw * lanecount * 270000 * 8 / 10 ; requiredbw = mode -> clock * 8 * 3 ; DRM_DEBUG_KMS ( "DP bandwidth: %d kHz (%02x/%d); mode requires %d Khz\n" , totalbw , dpbw , lanecount , requiredbw ) ; if ( totalbw == 0 ) { DRM_ERROR ( "Bandwidth/lane count are 0, not rejecting modes\n" ) ; return true ; } return totalbw >= requiredbw ; } 