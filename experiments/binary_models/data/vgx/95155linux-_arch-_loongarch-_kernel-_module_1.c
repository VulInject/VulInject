static int apply_r_larch_sop ( struct module * mod , u32 * location , Elf_Addr v , s64 * rela_stack , size_t * rela_stack_top , unsigned int type ) { int err = 0 ; s64 opr1 , opr2 , opr3 ; if ( type == R_LARCH_SOP_IF_ELSE ) { err = rela_stack_pop ( & opr3 , rela_stack , rela_stack_top ) ; } err = rela_stack_pop ( & opr2 , rela_stack , rela_stack_top ) ; if ( err ) { return err ; } err = rela_stack_pop ( & opr1 , rela_stack , rela_stack_top ) ; if ( err ) { return err ; } switch ( type ) { case R_LARCH_SOP_AND : err = rela_stack_push ( opr1 & opr2 , rela_stack , rela_stack_top ) ; break ; case R_LARCH_SOP_ADD : err = rela_stack_push ( opr1 + opr2 , rela_stack , rela_stack_top ) ; break ; case R_LARCH_SOP_SUB : err = rela_stack_push ( opr1 - opr2 , rela_stack , rela_stack_top ) ; break ; case R_LARCH_SOP_SL : err = rela_stack_push ( opr1 << opr2 , rela_stack , rela_stack_top ) ; break ; case R_LARCH_SOP_SR : err = rela_stack_push ( opr1 >> opr2 , rela_stack , rela_stack_top ) ; break ; case R_LARCH_SOP_IF_ELSE : err = rela_stack_push ( opr1 ?opr2 : opr3 , rela_stack , rela_stack_top ) ; break ; default : pr_err ( "%s: Unsupport relocation type %u\n" , mod -> name , type ) ; return - EINVAL ; } return err ; } 