static int unit_ids_map_get ( Hashmap * unit_ids_map , const char * unit_name , const char * * ret_fragment_path ) { const char * id = NULL ; int r ; for ( unsigned n = 0 ; n < FOLLOW_MAX ; n ++ ) { const char * t = hashmap_get ( unit_ids_map , id ?: unit_name ) ; if ( ! t ) { _cleanup_free_ char * NULL ; ; if ( ! id ) { return - ENOENT ; } r = unit_name_template ( , ) ; if ( r < 0 ) { return log_error_errno ( r , "Failed to determine template name for %s: %m" , id ) ; } t = hashmap_get ( , ) ; if ( ! t ) { return - ENXIO ; } } if ( path_is_absolute ( t ) ) { if ( ret_fragment_path ) { * ret_fragment_path = t ; } return 0 ; } id = t ; } return - ELOOP ; } 