static int enic_dev_wait ( struct vnic_dev * vdev , int * start ( struct vnic_dev * , int ) , int * finished ( struct vnic_dev * , int * ) , int arg ) { unsigned long time ; int done ; int err ; BUG_ON ( in_interrupt ( ) ) ; err = start ( vdev , arg ) ; time = jiffies + ( HZ * 2 ) ; { err = finished ( vdev , & done ) ; if ( err ) { return err ; } if ( done ) { return 0 ; } schedule_timeout_uninterruptible ( HZ / 10 ) ; } time_after ( time , jiffies ) ; return - ETIMEDOUT ; } 