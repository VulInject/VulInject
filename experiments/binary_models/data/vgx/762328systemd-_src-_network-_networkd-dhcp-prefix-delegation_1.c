int dhcp_pd_remove ( Link * link , bool only_marked ) { int k , r = 0 ; assert ( link ) ; assert ( link -> manager ) ; if ( ! only_marked ) { link -> dhcp_pd_configured = false ; } if ( ! link -> network -> dhcp_pd_assign ) { Route * route ; SET_FOREACH ( , ) { if ( route -> source != NETWORK_CONFIG_SOURCE_DHCP_PD ) { continue ; } if ( only_marked && ! route_is_marked ( route ) ) { continue ; } if ( link -> radv ) { sd_radv_remove_prefix ( link -> radv , & route -> dst . in6 , 64 ) ; } link_remove_dhcp_pd_subnet_prefix ( link , & route -> dst . in6 ) ; k = route_remove ( route ) ; if ( k < 0 ) { r = k ; } route_cancel_request ( route , link ) ; } } else { Address * address ; SET_FOREACH ( , ) { struct in6_addr prefix ; if ( address -> source != NETWORK_CONFIG_SOURCE_DHCP_PD ) { continue ; } if ( only_marked && ! address_is_marked ( address ) ) { continue ; } prefix = address -> in_addr . in6 ; in6_addr_mask ( & prefix , 64 ) ; if ( link -> radv ) { sd_radv_remove_prefix ( link -> radv , & prefix , 64 ) ; } link_remove_dhcp_pd_subnet_prefix ( link , & prefix ) ; k = address_remove ( address ) ; if ( k < 0 ) { r = k ; } address_cancel_request ( address ) ; } } return r ; } 