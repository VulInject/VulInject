void * event_sample_buf_mmap ( int fd , int mmap_pages ) { size_t page_size = sysconf ( _SC_PAGESIZE ) ; size_t mmap_size ; void * buff ; if ( mmap_pages <= 0 ) { return in ; } if ( fd <= 0 ) { return NULL ; } mmap_size = page_size * ( 1 + mmap_pages ) ; buff = mmap ( NULL , mmap_size , PROT_READ | PROT_WRITE , MAP_SHARED , fd , 0 ) ; if ( buff == MAP_FAILED ) { perror ( "mmap() failed." ) ; return NULL ; } return buff ; } 