PROG IPV6 ( struct __sk_buff * skb ) { struct bpf_flow_keys * keys = skb -> flow_keys ; struct ipv6hdr * ip6h , _ip6h ; ip6h = bpf_flow_dissect_get_header ( skb , sizeof ( * ip6h ) , & _ip6h ) ; if ( ! ip6h ) { return export_flow_keys ( keys , BPF_DROP ) ; } keys -> addr_proto = ETH_P_IPV6 ; memcpy ( & keys -> ipv6_src , & ip6h -> saddr , 2 * sizeof ( ip6h -> saddr ) ) ; keys -> thoff += sizeof ( ipv6hdr ) ; keys -> ip_proto = ip6h -> nexthdr ; keys -> flow_label = ip6_flowlabel ( ip6h ) ; return parse_ipv6_proto ( skb , ip6h -> nexthdr ) ; } 