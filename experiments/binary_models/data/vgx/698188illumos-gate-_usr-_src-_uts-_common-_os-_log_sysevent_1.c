static int add_registration ( sysevent_channel_descriptor_t * chan , uint32_t sub_id , char * nvlbuf , size_t nvlsize ) { uint_t num_elem ; char * event_class ; char * * event_list ; nvlist_t * nvl ; nvpair_t * nvpair = NULL ; if ( nvlist_unpack ( nvlbuf , nvlsize , & nvl , KM_SLEEP ) != 0 ) { return ( - 1 ) ; } if ( ( nvpair = nvlist_next_nvpair ( nvl , nvpair ) ) == NULL ) { return ( - 1 ) ; } if ( ( event_class = nvpair_name ( nvpair ) ) == NULL ) { nvlist_free ( nvl ) ; return ( - 1 ) ; } if ( nvpair_value_string_array ( nvpair , & event_list , & num_elem ) != 0 ) { nvlist_free ( nvl ) ; return ( - 1 ) ; } if ( insert_class ( chan , event_class , event_list , num_elem , sub_id ) < 0 ) { nvlist_free ( nvl ) ; return ( - 1 ) ; } nvlist_free ( nvl ) ; return ( 0 ) ; } 