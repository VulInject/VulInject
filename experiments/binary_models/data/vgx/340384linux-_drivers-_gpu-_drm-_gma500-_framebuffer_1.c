static int psb_framebuffer_init ( struct drm_device * dev , struct drm_framebuffer * fb , const struct drm_mode_fb_cmd2 * mode_cmd , struct drm_gem_object * obj ) { const struct drm_format_info * info ; int ret ; info = drm_get_format_info ( dev , mode_cmd ) ; if ( ! info || ! info -> depth || info -> cpp [ 0 ] > 4 ) { return - EINVAL ; } drm_helper_mode_fill_fb_struct ( dev , fb , mode_cmd ) ; fb -> obj [ 0 ] = obj ; ret = drm_framebuffer_init ( dev , fb , & psb_fb_funcs ) ; if ( ret ) { dev_err ( dev -> dev , "framebuffer init failed: %d\n" , ret ) ; return ret ; } return 0 ; } 