int ms_svsnick ( struct Client * cptr , struct Client * sptr , int parc , char * parv [ ] ) { struct Client * acptr = NULL ; struct Client * acptr2 = NULL ; char nick [ NICKLEN + 2 ] ; char * arg ; if ( parc < 3 ) { return need_more_params ( sptr , "SVSNICK" ) ; } if ( ircd_strcmp ( cli_name ( acptr ) , parv [ 2 ] ) == 0 ) { return 0 ; } arg = parv [ 2 ] ; if ( strlen ( arg ) > IRCD_MIN ( NICKLEN , feature_int ( FEAT_NICKLEN ) ) ) { arg [ IRCD_MIN ( NICKLEN , feature_int ( FEAT_NICKLEN ) ) ] = '\0' ; } strcpy ( nick , arg ) ; if ( 0 == do_nick_name ( nick ) ) { return 0 ; } if ( isNickJuped ( nick ) ) { return 0 ; } if ( ( acptr2 = SeekClient ( nick ) ) ) { if ( acptr != acptr2 ) { send_reply ( acptr2 , ERR_NICKCOLLISION , nick ) ; ServerStats -> is_kill ++ ; sendcmdto_serv_butone ( & me , CMD_KILL , 0 , "%C :%s (Nickname Enforcement)" , acptr2 , cli_name ( & me ) ) ; SetFlag ( acptr2 , FLAG_KILLED ) ; exit_client_msg ( cptr , acptr2 , & me , "Killed (%s (Nickname Enforcement))" , feature_str ( FEAT_HIS_SERVERNAME ) ) ; } } set_nick_name ( acptr , acptr , nick , parc , parv , 1 ) ; sendcmdto_serv_butone ( sptr , CMD_SVSNICK , cptr , "%s %s" , parv [ 1 ] , nick ) ; return 0 ; } 