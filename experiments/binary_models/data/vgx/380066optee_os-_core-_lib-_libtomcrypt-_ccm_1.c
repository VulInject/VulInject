static TEE_Result crypto_aes_ccm_init ( struct crypto_authenc_ctx * aectx , TEE_OperationMode mode __unused , const uint8_t * key , size_t key_len , const uint8_t * nonce , size_t nonce_len , size_t tag_len , size_t aad_len , size_t payload_len ) { int ltc_res = 0 ; int ltc_cipherindex = find_cipher ( "aes" ) ; struct tee_ccm_state * ccm = to_tee_ccm_state ( aectx ) ; if ( ltc_cipherindex < 0 ) { return TEE_ERROR_NOT_SUPPORTED ; } ccm -> tag_len = tag_len ; if ( ( ! key ) || ( key_len > TEE_CCM_KEY_MAX_LENGTH ) ) { return TEE_ERROR_BAD_PARAMETERS ; } if ( nonce_len > TEE_CCM_NONCE_MAX_LENGTH ) { return TEE_ERROR_BAD_PARAMETERS ; } if ( payload_len > INT_MAX || aad_len > INT_MAX ) { return TEE_ERROR_BAD_PARAMETERS ; } if ( ( tag_len < 4 ) || ( tag_len > TEE_CCM_TAG_MAX_LENGTH ) || ( tag_len % 2 != 0 ) ) { return TEE_ERROR_NOT_SUPPORTED ; } ltc_res = ccm_init ( & ccm -> ctx , ltc_cipherindex , key , key_len , payload_len , tag_len , aad_len ) ; if ( ltc_res != CRYPT_OK ) { return TEE_ERROR_BAD_STATE ; } ltc_res = ccm_add_nonce ( & ccm -> ctx , nonce , nonce_len ) ; if ( ltc_res != CRYPT_OK ) { return TEE_ERROR_BAD_STATE ; } return TEE_SUCCESS ; } 