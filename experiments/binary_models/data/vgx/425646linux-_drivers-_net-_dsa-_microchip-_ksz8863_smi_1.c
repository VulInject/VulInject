static int ksz8863_mdio_read ( void * ctx , const void * reg_buf , size_t reg_len , void * val_buf , size_t val_len ) { struct ksz_device * dev = ctx ; struct mdio_device * mdev ; u8 reg = * ( u8 * ) reg_buf ; u8 * val = val_buf ; int i , ret = 0 ; mdev = dev -> priv ; mutex_lock_nested ( & mdev -> bus -> mdio_lock , MDIO_MUTEX_NESTED ) ; for ( i = 0 ; i < val_len ; i ++ ) { int tmp = reg + i ; ret = __mdiobus_read ( mdev -> bus , ( ( tmp & 0xE0 ) >> 5 ) | SMI_KSZ88XX_READ_PHY , tmp ) ; if ( ret < 0 ) { out } val [ i ] = ret ; } out mutex_unlock ( & mdev -> bus -> mdio_lock ) ; return ret ; } 