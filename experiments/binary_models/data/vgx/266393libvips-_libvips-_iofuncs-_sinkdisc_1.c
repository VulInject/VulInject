static void wbuffer_free ( WriteBuffer * wbuffer ) { if ( wbuffer -> running ) { wbuffer -> kill = TRUE ; vips_semaphore_up ( & wbuffer -> go ) ; vips_semaphore_down ( & wbuffer -> finish ) ; VIPS_DEBUG_MSG ( "wbuffer_free:\n" ) ; wbuffer -> running = FALSE ; } VIPS_UNREF ( wbuffer -> region ) ; vips_semaphore_destroy ( & wbuffer -> go ) ; vips_semaphore_destroy ( & wbuffer -> nwrite ) ; vips_semaphore_destroy ( & wbuffer -> done ) ; vips_semaphore_destroy ( & wbuffer -> finish ) ; } 