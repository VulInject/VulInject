"	this->cpu = (processorid_t)arg0;" "	this->oldspeed = (uint64_t)arg1;" "	@times[this->cpu, this->oldspeed] = sum(timestamp - last[this->cpu]);" "	last[this->cpu] = timestamp;" "}" ":::cpu-change-speed" "/last[(processorid_t)arg0] == 0/" "{" "	this->cpu = (processorid_t)arg0;" "	this->oldspeed = (uint64_t)arg1;" "	@times[this->cpu, this->oldspeed] = sum(timestamp - begin);" "	last[this->cpu] = timestamp;" "}" ; static const char * dtp_cpufreq_c = "hrtime_t last;" "" "BEGIN" "{" "	begin = timestamp;" "}" "" ":::cpu-change-speed" "/(processorid_t)arg0 == $1&&" " last != 0/" "{" "	this->cpu = (processorid_t)arg0;" "	this->oldspeed = (uint64_t)arg1;" "	@times[this->cpu, this->oldspeed] = sum(timestamp - last);" "	last = timestamp;" "}" ":::cpu-change-speed" "/(processorid_t)arg0 == $1&&" " last == 0/" "{" "	this->cpu = (processorid_t)arg0;" "	this->oldspeed = (uint64_t)arg1;" "	@times[this->cpu, this->oldspeed] = sum(timestamp - begin);" "	last = timestamp;" "}" ; static int pt_cpufreq_setup ( void ) static int pt_cpufreq_snapshot ( void ) static int pt_cpufreq_dtrace_walk ( const dtrace_aggdata_t * , void * ) static void pt_cpufreq_stat_account ( double , uint_t ) static int pt_cpufreq_snapshot_cpu ( kstat_ctl_t * , uint_t ) static int pt_cpufreq_check_pm ( void ) static void pt_cpufreq_enable ( void ) static int pt_cpufreq_setup ( void ) { if ( ( dtp_argv = malloc ( sizeof ( char * ) * DTP_ARG_COUNT ) ) == NULL ) { return ( 1 ) ; } if ( ( dtp_argv [ 0 ] = malloc ( sizeof ( char ) * DTP_ARG_LENGTH ) ) == NULL ) { return ( 1 ) ; } ( void ) snprintf ( dtp_argv [ 0 ] , 5 , "%d\0" , g_ncpus_observed ) ; if ( PT_ON_CPU ) { if ( ( dtp_argv [ 1 ] = malloc ( sizeof ( char ) * DTP_ARG_LENGTH ) ) == NULL ) { free ( dtp_argv [ 0 ] ) ; free ( dtp_argv ) ; return ( 1 ) ; } ( void ) snprintf ( dtp_argv [ 1 ] , 5 , "%d\0" , g_observed_cpu ) ; } return ( 0 ) ; } 