static void test_multipart_messages ( struct i2c_client * client , struct ssif_info * ssif_info , unsigned char * resp ) { unsigned char msg [ 65 ] ; int ret ; bool do_middle ; if ( ssif_info -> max_xmit_msg_size <= 32 ) { return ; } do_middle = ssif_info -> max_xmit_msg_size > 63 ; msg [ 0 ] = IPMI_NETFN_APP_REQUEST << 2 ; msg [ 1 ] = IPMI_GET_DEVICE_ID_CMD ; ret = start_multipart_test ( client , msg , do_middle ) ; if ( ret ) { out_no_multi_part } ret = i2c_smbus_write_block_data ( client , SSIF_IPMI_MULTI_PART_REQUEST_END , 1 , msg + 64 ) ; if ( ! ret ) { ret = read_response ( client , resp ) ; } if ( ret > 0 ) { ssif_info -> cmd8_works = true ; return ; } ret = start_multipart_test ( client , msg , do_middle ) ; if ( ret ) { dev_err ( & client -> dev , "Second multipart test failed.\n" ) ; out_no_multi_part } ret = i2c_smbus_write_block_data ( client , SSIF_IPMI_MULTI_PART_REQUEST_MIDDLE , 0 , msg + 64 ) ; if ( ! ret ) { ret = read_response ( client , resp ) ; } if ( ret > 0 ) { return ; } if ( ssif_info -> max_xmit_msg_size > 63 ) { ssif_info -> max_xmit_msg_size = 63 ; } return ; out_no_multi_part ssif_info -> max_xmit_msg_size = 32 ; return ; } 