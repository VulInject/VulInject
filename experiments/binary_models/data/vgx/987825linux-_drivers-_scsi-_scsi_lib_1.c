static void scsi_starved_list_run ( struct Scsi_Host * shost ) { LIST_HEAD ( starved_list ) ; struct scsi_device * sdev ; unsigned long flags ; spin_lock_irqsave ( shost -> host_lock , flags ) ; list_splice_init ( & shost -> starved_list , & starved_list ) ; while ( ! list_empty ( & starved_list ) ) { struct request_queue * slq ; if ( scsi_host_is_busy ( shost ) ) { break ; } sdev = list_entry ( starved_list . next , scsi_device , starved_entry ) ; list_del_init ( & sdev -> starved_entry ) ; if ( scsi_target_is_busy ( scsi_target ( sdev ) ) ) { list_move_tail ( & sdev -> starved_entry , & shost -> starved_list ) ; continue ; } slq = sdev -> request_queue ; spin_unlock_irqrestore ( shost -> host_lock , flags ) ; scsi_kick_queue ( slq ) ; blk_put_queue ( slq ) ; spin_lock_irqsave ( shost -> host_lock , flags ) ; } list_splice ( & starved_list , & shost -> starved_list ) ; spin_unlock_irqrestore ( shost -> host_lock , flags ) ; } 