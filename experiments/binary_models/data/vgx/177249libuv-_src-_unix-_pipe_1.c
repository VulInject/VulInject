static int uv__pipe_getsockpeername ( const uv_pipe_t * handle , uv__peersockfunc func , char * buffer , size_t * size ) { struct sockaddr_un sa ; socklen_t addrlen ; int err ; addrlen = sizeof ( sa ) ; err = uv__getsockpeername ( ( const uv_handle_t * ) handle , func , ( sockaddr * ) & sa , ( int * ) & addrlen ) ; if ( err < 0 ) { * size = 0 ; return err ; } if ( sa . sun_path [ 0 ] == 0 ) { addrlen -= offsetof ( sockaddr_un , sun_path ) ; } else { addrlen = strlen ( sa . sun_path ) ; } if ( ( size_t ) addrlen >= * size ) { * size = addrlen + 1 ; return UV_ENOBUFS ; } memcpy ( buffer , sa . sun_path , addrlen ) ; * size = addrlen ; if ( buffer [ 0 ] != '\0' ) { buffer [ addrlen ] = '\0' ; } return 0 ; } 