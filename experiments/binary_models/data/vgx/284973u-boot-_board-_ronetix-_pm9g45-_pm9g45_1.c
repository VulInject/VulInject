static void pm9g45_nand_hw_init ( void ) { unsigned long csa ; struct at91_smc * smc = ( at91_smc * ) ATMEL_BASE_SMC ; struct at91_matrix * matrix = ( at91_matrix * ) ATMEL_BASE_MATRIX ; csa = readl ( & matrix -> ccr [ 6 ] ) | AT91_MATRIX_CSA_EBI_CS3A ; writel ( csa , & matrix -> ccr [ 6 ] ) ; writel ( AT91_SMC_SETUP_NWE ( 1 ) | AT91_SMC_SETUP_NCS_WR ( 0 ) | AT91_SMC_SETUP_NRD ( 1 ) | AT91_SMC_SETUP_NCS_RD ( 0 ) , & smc -> cs [ 3 ] . setup ) ; writel ( AT91_SMC_PULSE_NWE ( 4 ) | AT91_SMC_PULSE_NCS_WR ( 3 ) | AT91_SMC_PULSE_NRD ( 3 ) | AT91_SMC_PULSE_NCS_RD ( 2 ) , & smc -> cs [ 3 ] . pulse ) ; writel ( AT91_SMC_CYCLE_NWE ( 7 ) | AT91_SMC_CYCLE_NRD ( 4 ) , & smc -> cs [ 3 ] . cycle ) ; writel ( AT91_SMC_MODE_RM_NRD | AT91_SMC_MODE_WM_NWE | AT91_SMC_MODE_EXNW_DISABLE | AT91_SMC_MODE_DBW_8 | AT91_SMC_MODE_TDF_CYCLE ( 3 ) , & smc -> cs [ 3 ] . mode ) ; at91_periph_clk_enable ( ATMEL_ID_PIOC ) ; gpio_direction_input ( CFG_SYS_NAND_READY_PIN , NULL ) ; gpio_direction_output ( CFG_SYS_NAND_ENABLE_PIN , 1 ) ; } 