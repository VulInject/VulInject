void aat_dumpmorx ( struct alltabs * at , SplineFont * sf ) { FILE * temp = GFileTmpfile ( ) ; struct feature * features = NULL , * features_by_type ; int nchains , i ; OTLookup * otl ; struct lookup_subtable * sub ; for ( otl = sf -> gsub_lookups ; otl != NULL ; otl = otl -> next ) { otl -> ticked = false ; } SFLigaturePrepare ( sf ) ; for ( otl = sf -> gsub_lookups ; otl != NULL ; otl = otl -> next ) { if ( ! Macable ( sf , otl ) ) { continue ; } if ( otl -> lookup_type == gsub_single && IsOtfArabicFormFeature ( otl ) ) { if ( otl -> ticked ) { } if ( HasCursiveConnectionSM ( sf ) ) { } else { features = aat_dumpmorx_cvtopentypeforms ( at , sf , temp , features ) ; } } else { for ( sub = otl -> subtables ; sub != NULL ; sub = sub -> next ) { switch ( otl -> lookup_type ) { case gsub_single : features = aat_dumpmorx_substitutions ( at , sf , temp , features , sub ) ; break ; case gsub_ligature : features = aat_dumpmorx_ligatures ( at , sf , temp , features , sub ) ; break ; case morx_indic : case morx_context : case morx_insert : features = aat_dumpmorx_asm ( at , sf , temp , features , sub -> sm ) ; break ; default : if ( sf -> sm == NULL ) { features = aat_dumpmorx_cvtopentype ( at , sf , temp , features , sub ) ; } } } } } SFLigatureCleanup ( sf ) ; if ( features == NULL ) { fclose ( temp , NULL ) ; return ; } features = featuresReverse ( features ) ; features_by_type = featuresOrderByType ( features ) ; features_by_type = AddExclusiveNoops ( sf , features_by_type ) ; aat_dumpfeat ( at , sf , features_by_type ) ; nchains = featuresAssignFlagsChains ( features , features_by_type ) ; SetExclusiveOffs ( features_by_type ) ; at -> morx = GFileTmpfile ( ) ; putlong ( at -> morx , 0x00020000 ) ; putlong ( at -> morx , nchains ) ; for ( i = 0 ; i < nchains ; ++ i ) { morxDumpChain ( at , features , features_by_type , i , temp ) ; } fclose ( temp ) ; morxfeaturesfree ( features_by_type ) ; at -> morxlen = ftell ( at -> morx ) ; if ( at -> morxlen & 1 ) { putc ( '\0' , at -> morx ) ; } if ( ( at -> morxlen + 1 ) & 2 ) { putshort ( at -> morx , 0 ) ; } } 