static void do_conflicted_diff ( diff_expects * exp , unsigned long flags ) { const char * a_commit = "26a125ee1bf" ; git_tree * a = resolve_commit_oid_to_tree ( g_repo , a_commit ) ; git_diff_options opts = GIT_DIFF_OPTIONS_INIT ; git_index_entry ancestor = { { 0 } } , ours = { { 0 } } , theirs = { { 0 } } ; git_diff * diff = NULL ; git_index * index ; opts . context_lines = 1 ; opts . interhunk_lines = 1 ; opts . flags |= flags ; memset ( exp , 0 , sizeof ( diff_expects ) ) ; cl_git_pass ( git_repository_index ( & index , g_repo ) ) ; ancestor . path = ours . path = theirs . path = "staged_changes" ; ancestor . mode = ours . mode = theirs . mode = GIT_FILEMODE_BLOB ; git_oid__fromstr ( & ancestor . id , "d427e0b2e138501a3d15cc376077a3631e15bd46" , GIT_OID_SHA1 ) ; git_oid__fromstr ( & ours . id , "ee3fa1b8c00aff7fe02065fdb50864bb0d932ccf" , GIT_OID_SHA1 ) ; git_oid__fromstr ( & theirs . id , "2bd0a343aeef7a2cf0d158478966a6e587ff3863" , GIT_OID_SHA1 ) ; cl_git_pass ( git_index_conflict_add ( index , & ancestor , & ours , & theirs ) ) ; cl_git_pass ( git_diff_tree_to_index ( & diff , g_repo , a , index , & opts ) ) ; cl_git_pass ( git_diff_foreach ( diff , diff_file_cb , diff_binary_cb , diff_hunk_cb , diff_line_cb , exp ) ) ; git_diff_free ( diff ) ; git_tree_free ( a ) ; git_index_free ( index ) ; } 