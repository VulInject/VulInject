uint8_t drm_ps_decode ( drm_ps_info * ps , uint8_t guess , qmf_t X_left [ 38 ] [ 64 ] , qmf_t X_right [ 38 ] [ 64 ] ) { if ( ps == NULL ) { memcpy ( X_right , X_left , sizeof ( qmf_t ) * 30 * 64 ) ; return 0 ; } if ( ! ps -> drm_ps_data_available && ! guess ) { memcpy ( X_right , X_left , sizeof ( qmf_t ) * 30 * 64 ) ; memset ( ps -> g_prev_pan_index , 0 , sizeof ( ps -> g_prev_pan_index ) ) ; return 0 ; } if ( ! guess ) { ps -> sa_decode_error = 0 ; ps -> pan_decode_error = 0 ; drm_ps_delta_decode ( ps ) ; } else { ps -> sa_decode_error = 1 ; ps -> pan_decode_error = 1 ; } ps -> drm_ps_data_available = 0 ; drm_calc_sa_side_signal ( ps , X_left ) ; drm_add_ambiance ( ps , X_left , X_right ) ; if ( ps -> bs_enable_sa ) { ps -> g_last_had_sa = 1 ; memcpy ( ps -> g_prev_sa_index , ps -> g_sa_index , sizeof ( int8_t ) * DRM_NUM_SA_BANDS ) ; } else { ps -> g_last_had_sa = 0 ; } if ( ps -> bs_enable_pan ) { drm_add_pan ( ps , X_left , X_right ) ; ps -> g_last_had_pan = 1 ; memcpy ( ps -> g_prev_pan_index , ps -> g_pan_index , sizeof ( int8_t ) * DRM_NUM_PAN_BANDS ) ; } else { ps -> g_last_had_pan = 0 ; } return 0 ; } 