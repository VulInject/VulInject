int smbfs_subrinit ( void ) { ulong_t nsmbnode_max ; if ( nsmbnode <= 0 ) { nsmbnode = ncsize ; } nsmbnode_max = ( ulong_t ) ( ( kmem_maxavail ( ) >> 2 ) / sizeof ( smbnode ) ) ; if ( nsmbnode > nsmbnode_max || ( nsmbnode == 0 && ncsize == 0 ) ) { cmn_err ( CE_NOTE , "setting nsmbnode to max value of %ld" , nsmbnode_max ) ; nsmbnode = nsmbnode_max ; } smbnode_cache = kmem_cache_create ( "smbnode_cache" , sizeof ( smbnode_t ) , 0 , NULL , NULL , smbfs_kmem_reclaim , NULL , NULL , 0 ) ; mutex_init ( & smbfreelist_lock , NULL , MUTEX_DEFAULT , NULL ) ; mutex_init ( & smbfs_minor_lock , MUTEX_DEFAULT , NULL ) ; if ( ( smbfs_major = getudev ( ) ) == - 1 ) { cmn_err ( CE_WARN , "smbfs: init: can't get unique device number" ) ; smbfs_major = 0 ; } smbfs_minor = 0 ; return ( 0 ) ; } 