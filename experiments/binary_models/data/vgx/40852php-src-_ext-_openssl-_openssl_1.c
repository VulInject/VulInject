PHP_FUNCTION ( ) { X509 * cert ; zend_object * cert_obj ; zend_string * cert_str ; zval * zcainfo = NULL ; X509_STORE * cainfo = NULL ; STACK_OF ( X509 ) * untrustedchain = NULL ; zend_long purpose ; char * untrusted = NULL ; int untrusted_len = 0 ; int ret ; ZEND_PARSE_PARAMETERS_START ( 2 , 4 ) Z_PARAM_OBJ_OF_CLASS_OR_STR ( , , ) Z_PARAM_LONG ( ) Z_PARAM_OPTIONAL Z_PARAM_ARRAY ( zcainfo ) Z_PARAM_STRING_OR_NULL ( untrusted , untrusted_len ) ZEND_PARSE_PARAMETERS_END ( ) ; RETVAL_LONG ( - 1 ) ; if ( untrusted ) { untrustedchain = php_openssl_load_all_certs_from_file ( untrusted , untrusted_len , 4 ) ; if ( untrustedchain == NULL ) { clean_exit } } cainfo = php_openssl_setup_verify ( zcainfo , 3 ) ; if ( cainfo == NULL ) { clean_exit } cert = php_openssl_x509_from_param ( cert_obj , cert_str , 1 ) ; if ( cert == NULL ) { clean_exit } ret = check_cert ( cainfo , cert , untrustedchain , ( int ) purpose ) ; if ( ret != 0 && ret != 1 ) { RETVAL_LONG ( ret ) ; } else { RETVAL_BOOL ( ret ) ; } if ( cert_str ) { X509_free ( cert ) ; } clean_exit if ( cainfo ) { X509_STORE_free ( cainfo ) ; } if ( untrustedchain ) { sk_X509_pop_free ( untrustedchain , X509_free ) ; } } 