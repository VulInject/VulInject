void zebra_ptm_sock_read ( struct thread * thread ) { int sock ; int rc ; errno = 0 ; sock = THREAD_FD ( thread ) ; if ( sock == - 1 ) { return ; } { rc = ptm_lib_process_msg ( ptm_hdl , sock , ptm_cb . in_data , ZEBRA_PTM_MAX_SOCKBUF , NULL ) ; } rc > 0 ; if ( ( ( rc == 0 ) && ! errno ) || ( errno && ( errno != EWOULDBLOCK ) && ( errno != EAGAIN ) ) ) { flog_err_sys ( EC_LIB_SOCKET , "%s routing socket error: %s(%d) bytes %d" , __func__ , safe_strerror ( errno ) , errno , rc ) ; close ( ptm_cb . ptm_sock ) ; ptm_cb . ptm_sock = - 1 ; zebra_ptm_reset_status ( 0 ) ; ptm_cb . t_timer = NULL ; thread_add_timer ( zrouter . master , zebra_ptm_connect , ptm_cb . reconnect_time , & ptm_cb . t_timer ) ; return ; } ptm_cb . t_read = NULL ; thread_add_read ( zrouter . master , zebra_ptm_sock_read , NULL , ptm_cb . ptm_sock , & ptm_cb . t_read ) ; } 