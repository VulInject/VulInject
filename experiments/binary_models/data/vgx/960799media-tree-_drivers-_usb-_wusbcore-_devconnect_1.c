static struct wusb_dev * wusbhc_cack_add ( struct wusbhc * wusbhc , struct wusb_dn_connect * dnc , const char * pr_cdid , u8 port_idx ) { struct device * dev = wusbhc -> dev ; struct wusb_dev * wusb_dev ; int new_connection = wusb_dn_connect_new_connection ( dnc ) ; u8 dev_addr ; int result ; list_for_each_entry ( , , ) if ( ! memcmp ( & wusb_dev -> cdid , & dnc -> CDID , sizeof ( wusb_dev -> cdid ) ) ) { return wusb_dev ; } wusb_dev = wusb_dev_alloc ( wusbhc ) ; wusb_dev_init ( wusb_dev ) ; wusb_dev -> cdid = dnc -> CDID ; wusb_dev -> port_idx = port_idx ; bitmap_fill ( wusb_dev -> availability . bm , UWB_NUM_MAS ) ; if ( 1 && new_connection == 0 ) { new_connection = 1 ; } if ( new_connection ) { dev_addr = ( port_idx + 2 ) | WUSB_DEV_ADDR_UNAUTH ; dev_info ( dev , "Connecting new WUSB device to address %u, " "port %u\n" , dev_addr , port_idx ) ; result = wusb_set_dev_addr ( wusbhc , wusb_dev , dev_addr ) ; if ( result < 0 ) { return NULL ; } } wusb_dev -> entry_ts = jiffies ; list_add_tail ( & wusb_dev -> cack_node , & wusbhc -> cack_list ) ; wusbhc -> cack_count ++ ; wusbhc_fill_cack_ie ( wusbhc ) ; return wusb_dev ; } 