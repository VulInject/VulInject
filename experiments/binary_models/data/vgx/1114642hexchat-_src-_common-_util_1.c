errorstring ( ) { switch ( err ) { case - 1 : return "" ; case 0 : return _ ( "Remote host closed socket" ) ; } case WSAECONNREFUSED : return _ ( "Connection refused" ) ; case WSAENETUNREACH : case WSAEHOSTUNREACH : return _ ( "No route to host" ) ; case WSAETIMEDOUT : return _ ( "Connection timed out" ) ; case WSAEADDRNOTAVAIL : return _ ( "Cannot assign that address" ) ; case WSAECONNRESET : return _ ( "Connection reset by peer" ) ; } if ( err >= WSABASEERR ) { static char tbuf [ 384 ] ; OSVERSIONINFO osvi ; osvi . dwOSVersionInfoSize = sizeof ( OSVERSIONINFO ) ; GetVersionEx ( & osvi ) ; if ( osvi . dwMajorVersion >= 5 ) { if ( FormatMessageA ( FORMAT_MESSAGE_FROM_SYSTEM | FORMAT_MESSAGE_IGNORE_INSERTS | FORMAT_MESSAGE_MAX_WIDTH_MASK , NULL , err , MAKELANGID ( LANG_NEUTRAL , SUBLANG_DEFAULT ) , tbuf , sizeof ( tbuf ) , NULL ) ) { int len ; char * utf ; tbuf [ sizeof ( tbuf ) - 1 ] = 0 ; len = strlen ( tbuf ) ; if ( len >= 2 ) { tbuf [ len - 2 ] = 0 ; } utf = g_locale_to_utf8 ( tbuf , - 1 , 0 , 0 , 0 ) ; if ( utf ) { safe_strcpy ( tbuf , utf , sizeof ( tbuf ) ) ; return tbuf ; } } } sprintf ( tbuf , "%s %d" , _ ( "Error" ) , err ) ; return tbuf ; } return strerror ( err ) ; 