static int rt5616_set_dai_fmt ( struct snd_soc_dai * dai , unsigned int fmt ) { struct snd_soc_codec * codec = dai -> codec ; struct rt5616_priv * rt5616 = snd_soc_codec_get_drvdata ( codec ) ; int reg_val = 0 ; switch ( fmt & SND_SOC_DAIFMT_MASTER_MASK ) { case SND_SOC_DAIFMT_CBM_CFM : rt5616 -> master [ dai -> id ] = 1 ; break ; case SND_SOC_DAIFMT_CBS_CFS : reg_val |= RT5616_I2S_MS_S ; rt5616 -> master [ dai -> id ] = 0 ; break ; default : return - EINVAL ; } switch ( fmt & SND_SOC_DAIFMT_INV_MASK ) { case SND_SOC_DAIFMT_NB_NF : break ; case SND_SOC_DAIFMT_IB_NF : reg_val |= RT5616_I2S_BP_INV ; break ; default : return - EINVAL ; } switch ( fmt & SND_SOC_DAIFMT_FORMAT_MASK ) { case SND_SOC_DAIFMT_I2S : break ; case SND_SOC_DAIFMT_LEFT_J : reg_val |= RT5616_I2S_DF_LEFT ; break ; case SND_SOC_DAIFMT_DSP_A : reg_val |= RT5616_I2S_DF_PCM_A ; break ; case SND_SOC_DAIFMT_DSP_B : reg_val |= RT5616_I2S_DF_PCM_B ; break ; default : return - EINVAL ; } snd_soc_update_bits ( codec , RT5616_I2S1_SDP , RT5616_I2S_MS_MASK | RT5616_I2S_BP_MASK | RT5616_I2S_DF_MASK , reg_val ) ; return 0 ; } 