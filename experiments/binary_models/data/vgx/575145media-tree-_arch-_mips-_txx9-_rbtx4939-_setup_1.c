static void rbtx4939_led_brightness_set ( struct led_classdev * led_cdev , enum led_brightness value ) { struct rbtx4939_led_data * led_dat = container_of ( led_cdev , rbtx4939_led_data , cdev ) ; unsigned int num = led_dat -> num ; cfs_time_t flags ; local_irq_save ( flags ) ; led_val [ num ] = ( led_val [ num ] & 0x7f ) | ( value ?0x80 : 0 ) ; writeb ( led_val [ num ] , rbtx4939_7seg_addr ( num / 4 , num % 4 ) ) ; local_irq_restore ( flags ) ; } 