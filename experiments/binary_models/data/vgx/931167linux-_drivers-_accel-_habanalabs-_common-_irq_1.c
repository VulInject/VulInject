static int handle_registration_node ( struct hl_device * hdev , struct hl_user_pending_interrupt * pend , struct list_head * * free_list , ktime_t now ) { struct timestamp_reg_free_node * free_node ; u64 timestamp ; if ( ! ( * free_list ) ) { * free_list = kmalloc ( sizeof ( list_head ) , GFP_ATOMIC ) ; if ( ! ( * free_list ) ) { return - ENOMEM ; } INIT_LIST_HEAD ( * free_list ) ; } free_node = kmalloc ( sizeof ( * free_node ) , GFP_ATOMIC ) ; if ( ! free_node ) { return - ENOMEM ; } timestamp = ktime_to_ns ( now ) ; * pend -> ts_reg_info . timestamp_kernel_addr = timestamp ; dev_dbg ( hdev -> dev , "Timestamp is set to ts cb address (%p), ts: 0x%llx\n" , pend -> ts_reg_info . timestamp_kernel_addr , * ( u64 * ) pend -> ts_reg_info . timestamp_kernel_addr ) ; list_del ( & pend -> wait_list_node ) ; free_node -> buf = pend -> ts_reg_info . buf ; free_node -> cq_cb = pend -> ts_reg_info . cq_cb ; list_add ( & free_node -> free_objects_node , * free_list ) ; return 0 ; } 