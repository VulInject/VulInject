int rt_hash ( struct rtentry * rt , struct sockaddr * dst , uint32_t * src ) { uint32_t a , b , c ; if ( src == NULL || ! rtisvalid ( rt ) || ! ISSET ( rt -> rt_flags , RTF_MPATH ) ) { return ( - 1 ) ; } a = b = 0x9e3779b9 ; c = rt_hashjitter ; switch ( dst -> sa_family ) { case AF_INET : { struct sockaddr_in * sin ; sin = satosin ( dst ) ; a += sin -> sin_addr . s_addr ; b += src [ 0 ] ; mix ( a , b , c ) ; break ; } case AF_INET6 : { struct sockaddr_in6 * sin6 ; if ( ! ip6_multipath ) { return ( - 1 ) ; } sin6 = satosin6 ( dst ) ; a += sin6 -> sin6_addr . s6_addr32 [ 0 ] ; b += sin6 -> sin6_addr . s6_addr32 [ 2 ] ; c += src [ 0 ] ; mix ( a , b , c ) ; a += sin6 -> sin6_addr . s6_addr32 [ 1 ] ; b += sin6 -> sin6_addr . s6_addr32 [ 3 ] ; c += src [ 1 ] ; mix ( a , b , c ) ; a += sin6 -> sin6_addr . s6_addr32 [ 2 ] ; b += sin6 -> sin6_addr . s6_addr32 [ 1 ] ; c += src [ 2 ] ; mix ( a , b , c ) ; a += sin6 -> sin6_addr . s6_addr32 [ 3 ] ; b += sin6 -> sin6_addr . s6_addr32 [ 0 ] ; c += src [ 3 ] ; mix ( a , b , c ) ; break ; } } return ( c & 0xffff ) ; } 