static int si514_probe ( struct i2c_client * client ) { struct clk_si514 * data ; struct clk_init_data init ; int err ; data = devm_kzalloc ( & client -> dev , sizeof ( * data ) , GFP_KERNEL ) ; init . ops = & si514_clk_ops ; init . flags = 0 ; init . num_parents = 0 ; data -> hw . init = & init ; data -> i2c_client = client ; if ( of_property_read_string ( client -> dev . of_node , "clock-output-names" , & init . name ) ) { init . name = client -> dev . of_node -> name ; } data -> regmap = devm_regmap_init_i2c ( client , & si514_regmap_config ) ; if ( IS_ERR ( data -> regmap ) ) { dev_err ( & client -> dev , "failed to allocate register map\n" ) ; return PTR_ERR ( data -> regmap ) ; } i2c_set_clientdata ( client , data ) ; err = devm_clk_hw_register ( & client -> dev , & data -> hw ) ; if ( err ) { dev_err ( & client -> dev , "clock registration failed\n" ) ; return err ; } err = of_clk_add_hw_provider ( client -> dev . of_node , of_clk_hw_simple_get , & data -> hw ) ; if ( err ) { dev_err ( & client -> dev , "unable to add clk provider\n" ) ; return err ; } return 0 ; } 