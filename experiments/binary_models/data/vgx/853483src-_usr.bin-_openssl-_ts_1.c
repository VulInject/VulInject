static TS_RESP * create_response ( CONF * conf , const char * section , char * queryfile , char * passin , char * inkey , char * signer , char * chain , const char * policy ) { int ret = 0 ; TS_RESP * response = NULL ; BIO * query_bio = NULL ; TS_RESP_CTX * resp_ctx = NULL ; if ( ( query_bio = BIO_new_file ( queryfile , "rb" ) ) == NULL ) { end } if ( ( section = TS_CONF_get_tsa_section ( conf , section ) ) == NULL ) { end } if ( ( resp_ctx = TS_RESP_CTX_new ( ) ) == NULL ) { end } if ( ! TS_CONF_set_serial ( conf , section , serial_cb , resp_ctx ) ) { end } if ( ! TS_CONF_set_signer_cert ( conf , section , signer , resp_ctx ) ) { end } if ( ! TS_CONF_set_certs ( conf , section , chain , resp_ctx ) ) { end } if ( ! TS_CONF_set_signer_key ( conf , section , inkey , passin , resp_ctx ) ) { end } if ( ! TS_CONF_set_def_policy ( conf , section , policy , resp_ctx ) ) { end } if ( ! TS_CONF_set_policies ( conf , section , resp_ctx ) ) { end } if ( ! TS_CONF_set_digests ( conf , section , resp_ctx ) ) { end } if ( ! TS_CONF_set_accuracy ( conf , section , resp_ctx ) ) { end } if ( ! TS_CONF_set_clock_precision_digits ( conf , section , resp_ctx ) ) { end } if ( ! TS_CONF_set_ordering ( conf , section , resp_ctx ) ) { end } if ( ! TS_CONF_set_tsa_name ( conf , section , resp_ctx ) ) { end } if ( ! TS_CONF_set_ess_cert_id_chain ( conf , section , resp_ctx ) ) { end } if ( ( response = TS_RESP_create_response ( resp_ctx , query_bio ) ) == NULL ) { end } ret = 1 ; end if ( ! ret ) { TS_RESP_free ( response ) ; response = NULL ; } BIO_free_all ( query_bio ) ; return response ; } 