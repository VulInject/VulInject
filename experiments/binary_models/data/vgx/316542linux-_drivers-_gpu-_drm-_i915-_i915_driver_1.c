static int i915_drm_suspend ( struct drm_device * dev ) { struct drm_i915_private * dev_priv = to_i915 ( dev ) ; struct pci_dev * pdev = to_pci_dev ( dev_priv -> drm . dev ) ; pci_power_t opregion_target_state ; disable_rpm_wakeref_asserts ( & dev_priv -> runtime_pm ) ; intel_power_domains_disable ( dev_priv ) ; if ( HAS_DISPLAY ( dev_priv ) ) { drm_kms_helper_poll_disable ( dev ) ; } pci_save_state ( pdev ) ; intel_display_suspend ( dev ) ; intel_dp_mst_suspend ( dev_priv ) ; intel_runtime_pm_disable_interrupts ( dev_priv ) ; intel_hpd_cancel_work ( dev_priv ) ; intel_suspend_encoders ( dev_priv , NULL ) ; intel_suspend_hw ( dev_priv ) ; intel_dpt_suspend ( dev_priv ) ; i915_ggtt_suspend ( to_gt ( dev_priv ) -> ggtt ) ; i915_save_display ( dev_priv ) ; opregion_target_state = suspend_to_idle ( dev_priv ) ?PCI_D1 : PCI_D3cold ; intel_opregion_suspend ( dev_priv , opregion_target_state ) ; intel_fbdev_set_suspend ( dev , FBINFO_STATE_SUSPENDED , true ) ; dev_priv -> suspend_count ++ ; intel_dmc_ucode_suspend ( dev_priv ) ; enable_rpm_wakeref_asserts ( & dev_priv -> runtime_pm ) ; i915_gem_drain_freed_objects ( dev_priv ) ; return 0 ; } 