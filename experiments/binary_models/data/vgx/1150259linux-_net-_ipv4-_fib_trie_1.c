static struct key_vector * tnode_new ( t_key key , int pos , int bits ) { unsigned int shift = pos + bits ; struct key_vector * tn ; struct tnode * tnode ; BUG_ON ( ! bits || ( shift > KEYLENGTH ) ) ; tnode = tnode_alloc ( bits ) ; if ( ! tnode ) { return in ; } pr_debug ( "AT %p s=%zu %zu\n" , tnode , TNODE_SIZE ( 0 ) , sizeof ( key_vector * ) << bits ) ; if ( bits == KEYLENGTH ) { tnode -> full_children = 1 ; } else { tnode -> empty_children = 1ul << bits ; } tn = tnode -> kv ; tn -> key = ( shift < KEYLENGTH ) ?( key >> shift ) << shift : 0 ; tn -> pos = pos ; tn -> bits = bits ; tn -> slen = pos ; return tn ; } 