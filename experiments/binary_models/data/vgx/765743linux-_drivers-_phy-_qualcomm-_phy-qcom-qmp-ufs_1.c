static int qmp_ufs_init ( struct phy * phy ) { struct qmp_ufs * qmp = phy_get_drvdata ( phy ) ; const struct qmp_phy_cfg * cfg = qmp -> cfg ; int ret ; dev_vdbg ( qmp -> dev , "Initializing QMP phy\n" ) ; if ( cfg -> no_pcs_sw_reset ) { if ( ! qmp -> ufs_reset ) { qmp -> ufs_reset = devm_reset_control_get_exclusive ( qmp -> dev , "ufsphy" ) ; if ( IS_ERR ( qmp -> ufs_reset ) ) { ret = PTR_ERR ( qmp -> ufs_reset ) ; dev_err ( qmp -> dev , "failed to get UFS reset: %d\n" , ret ) ; return ret ; } } ret = reset_control_assert ( qmp -> ufs_reset ) ; if ( ret ) { return ret ; } } ret = qmp_ufs_com_init ( qmp ) ; if ( ret ) { return ret ; } return 0 ; } 