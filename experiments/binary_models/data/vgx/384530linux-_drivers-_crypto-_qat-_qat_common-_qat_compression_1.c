static int qat_compression_free_instances ( struct adf_accel_dev * accel_dev ) { struct qat_compression_instance * inst ; struct list_head * list_ptr , * tmp ; int i ; list_for_each_safe ( , , ) { inst = list_entry ( list_ptr , qat_compression_instance , list ) ; for ( i = 0 ; i < atomic_read ( & inst -> refctr ) ; i ++ ) { qat_compression_put_instance ( inst ) ; } if ( inst -> dc_tx ) { adf_remove_ring ( inst -> dc_tx ) ; } if ( inst -> dc_rx ) { adf_remove_ring ( inst -> dc_rx ) ; } list_del ( list_ptr ) ; } return 0 ; } 