void ivpu_fw_boot_params_setup ( struct ivpu_device * vdev , struct vpu_boot_params * boot_params ) { struct ivpu_bo * ipc_mem_rx = vdev -> ipc -> mem_rx ; if ( ! ivpu_fw_is_cold_boot ( vdev ) ) { vdev -> pm -> is_warmboot = true ; return ; } vdev -> pm -> is_warmboot = false ; boot_params -> magic = VPU_BOOT_PARAMS_MAGIC ; boot_params -> vpu_id = to_pci_dev ( vdev -> drm . dev ) -> bus -> number ; boot_params -> frequency = ivpu_hw_reg_pll_freq_get ( vdev ) ; boot_params -> shared_region_base = vdev -> hw -> ranges . global_low . start ; boot_params -> shared_region_size = vdev -> hw -> ranges . global_low . end - vdev -> hw -> ranges . global_low . start ; boot_params -> ipc_header_area_start = ipc_mem_rx -> vpu_addr ; boot_params -> ipc_header_area_size = ipc_mem_rx -> base . size / 2 ; boot_params -> ipc_payload_area_start = ipc_mem_rx -> vpu_addr + ipc_mem_rx -> base . size / 2 ; boot_params -> ipc_payload_area_size = ipc_mem_rx -> base . size / 2 ; boot_params -> global_aliased_pio_base = vdev -> hw -> ranges . global_aliased_pio . start ; boot_params -> global_aliased_pio_size = ivpu_hw_range_size ( & vdev -> hw -> ranges . global_aliased_pio ) ; boot_params -> autoconfig = 1 ; boot_params -> cache_defaults [ VPU_BOOT_L2_CACHE_CFG_NN ] . use = 1 ; boot_params -> cache_defaults [ VPU_BOOT_L2_CACHE_CFG_NN ] . cfg = ADDR_TO_L2_CACHE_CFG ( vdev -> hw -> ranges . global_high . start ) ; if ( vdev -> fw -> mem_shave_nn ) { boot_params -> shave_nn_fw_base = vdev -> fw -> mem_shave_nn -> vpu_addr ; } boot_params -> watchdog_irq_mss = WATCHDOG_MSS_REDIRECT ; boot_params -> watchdog_irq_nce = WATCHDOG_NCE_REDIRECT ; boot_params -> si_stepping = ivpu_revision ( vdev ) ; boot_params -> device_id = ivpu_device_id ( vdev ) ; boot_params -> feature_exclusion = vdev -> hw -> tile_fuse ; boot_params -> sku = vdev -> hw -> sku ; boot_params -> min_freq_pll_ratio = vdev -> hw -> pll . min_ratio ; boot_params -> pn_freq_pll_ratio = vdev -> hw -> pll . pn_ratio ; boot_params -> max_freq_pll_ratio = vdev -> hw -> pll . max_ratio ; boot_params -> punit_telemetry_sram_base = ivpu_hw_reg_telemetry_offset_get ( vdev ) ; boot_params -> punit_telemetry_sram_size = ivpu_hw_reg_telemetry_size_get ( vdev ) ; boot_params -> vpu_telemetry_enable = ivpu_hw_reg_telemetry_enable_get ( vdev ) ; wmb ( ) ; ivpu_fw_boot_params_print ( vdev , boot_params ) ; } 