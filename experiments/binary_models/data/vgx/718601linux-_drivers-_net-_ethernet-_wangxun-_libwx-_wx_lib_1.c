static int wx_alloc_q_vectors ( struct wx * wx ) { unsigned int rxr_idx = 0 , txr_idx = 0 , v_idx = 0 ; unsigned int rxr_remaining = wx -> num_rx_queues ; unsigned int txr_remaining = wx -> num_tx_queues ; unsigned int q_vectors = wx -> num_q_vectors ; int rqpv , tqpv ; int err ; for ( ; v_idx < q_vectors ; v_idx ++ ) { rqpv = DIV_ROUND_UP ( rxr_remaining , q_vectors - v_idx ) ; tqpv = DIV_ROUND_UP ( txr_remaining , q_vectors - v_idx ) ; err = wx_alloc_q_vector ( wx , q_vectors , v_idx , tqpv , txr_idx , rqpv , rxr_idx ) ; if ( err ) { err_out } rxr_remaining -= rqpv ; txr_remaining -= tqpv ; rxr_idx ++ ; txr_idx ++ ; } return 0 ; err_out wx -> num_rx_queues = 0 ; wx -> num_q_vectors = 0 ; while ( v_idx -- ) { wx_free_q_vector ( wx , v_idx ) ; } return - ENOMEM ; } 