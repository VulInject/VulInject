void base32_encode ( char * dest , size_t destlen , const char * src , size_t srclen ) { unsigned int i , v , u ; size_t nbits = srclen * 8 ; size_t bit ; tor_assert ( base32_encoded_size ( srclen ) <= destlen ) ; tor_assert ( destlen < SIZE_T_CEILING ) ; for ( i = 0 , bit = 0 ; bit < nbits ; ++ i , bit += 5 ) { size_t idx = bit / 8 ; v = ( ( uint8_t ) src [ idx ] ) << 8 ; if ( idx + 1 < srclen ) { v += ( uint8_t ) src [ idx + 1 ] ; } u = ( v >> ( 11 - ( bit % 8 ) ) ) & 0x1F ; dest [ i ] = BASE32_CHARS [ u ] ; } dest [ i ] = '\0' ; } 