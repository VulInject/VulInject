int br_parse_vlan_tunnel_info ( struct nlattr * attr , struct vtunnel_info * tinfo ) { struct nlattr * tb [ IFLA_BRIDGE_VLAN_TUNNEL_MAX + 1 ] ; u32 tun_id ; u16 vid , flags = 0 ; int err ; err = nla_parse_nested ( tb , IFLA_BRIDGE_VLAN_TUNNEL_MAX , attr , vlan_tunnel_policy , NULL ) ; if ( err < 0 ) { return err ; } if ( ! tb [ IFLA_BRIDGE_VLAN_TUNNEL_ID ] || ! tb [ IFLA_BRIDGE_VLAN_TUNNEL_VID ] ) { return - EINVAL ; } tun_id = nla_get_u32 ( tb [ IFLA_BRIDGE_VLAN_TUNNEL_ID ] ) ; vid = nla_get_u16 ( tb [ IFLA_BRIDGE_VLAN_TUNNEL_VID ] ) ; if ( vid >= VLAN_VID_MASK ) { return - ERANGE ; } if ( tb [ IFLA_BRIDGE_VLAN_TUNNEL_FLAGS ] ) { flags = nla_get_u16 ( tb [ IFLA_BRIDGE_VLAN_TUNNEL_FLAGS ] ) ; } tinfo -> tunid = tun_id ; tinfo -> vid = vid ; tinfo -> flags = flags ; return 0 ; } 