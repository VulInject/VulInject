void access_test ( void ) { assert ( user_uid ) ; int i ; pid_t child = fork ( ) ; if ( child == - 1 ) { errExit ( "fork" ) ; } if ( child == 0 ) { if ( setgid ( user_gid ) != 0 ) { errExit ( "setgid" ) ; } if ( setuid ( user_uid ) != 0 ) { errExit ( "setuid" ) ; } for ( i = 0 ; i < files_cnt ; i ++ ) { assert ( td [ i ] . tfile ) ; FILE * fp = fopen ( td [ i ] . tfile , "r" ) ; if ( fp ) { printf ( "   Warning: I can read %s\n" , td [ i ] . tdir ) ; fclose ( fp , NULL ) ; } } exit ( 0 ) ; } int status ; wait ( & status ) ; } 