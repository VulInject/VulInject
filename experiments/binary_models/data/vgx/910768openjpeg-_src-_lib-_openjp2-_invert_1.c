OPJ_UINT32 nb_compo ; static void opj_lupSolve ( OPJ_FLOAT32 * pResult , OPJ_FLOAT32 * pMatrix , OPJ_FLOAT32 * pVector , OPJ_UINT32 * pPermutations , OPJ_UINT32 nb_compo , OPJ_FLOAT32 * p_intermediate_data ) static void opj_lupInvert ( OPJ_FLOAT32 * pSrcMatrix , OPJ_FLOAT32 * pDestMatrix , OPJ_UINT32 nb_compo , OPJ_UINT32 * pPermutations , OPJ_FLOAT32 * p_src_temp , OPJ_FLOAT32 * p_dest_temp , OPJ_FLOAT32 * p_swap_area ) OPJ_BOOL opj_matrix_inversion_f ( OPJ_FLOAT32 * pSrcMatrix , OPJ_FLOAT32 * pDestMatrix , OPJ_UINT32 nb_compo ) { OPJ_BYTE * l_data = 00 ; OPJ_UINT32 l_permutation_size = nb_compo * ( OPJ_UINT32 ) sizeof ( OPJ_UINT32 ) ; OPJ_UINT32 l_swap_size = nb_compo * ( OPJ_UINT32 ) sizeof ( OPJ_FLOAT32 ) ; OPJ_UINT32 l_total_size = l_permutation_size + 3 * l_swap_size ; OPJ_UINT32 * lPermutations = 00 ; OPJ_FLOAT32 * l_double_data = 00 ; l_data = ( OPJ_BYTE * ) opj_malloc ( l_total_size ) ; if ( l_data == 0 ) { return OPJ_FALSE ; } lPermutations = ( OPJ_UINT32 * ) l_data ; l_double_data = ( OPJ_FLOAT32 * ) ( l_data + l_permutation_size ) ; if ( ! opj_lupDecompose ( pSrcMatrix , lPermutations , l_double_data , nb_compo ) ) { opj_free ( l_data ) ; return OPJ_FALSE ; } opj_lupInvert ( pSrcMatrix , pDestMatrix , nb_compo , lPermutations , l_double_data , l_double_data + nb_compo , l_double_data + 2 * nb_compo ) ; opj_free ( l_data ) ; return OPJ_TRUE ; } 