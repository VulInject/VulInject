struct wilc * wilc_create_wiphy ( struct device * dev ) { struct wiphy * wiphy ; struct wilc * wl ; int ret ; wiphy = wiphy_new ( & wilc_cfg80211_ops , sizeof ( * wl ) ) ; if ( ! wiphy ) { return NULL ; } wl = wiphy_priv ( wiphy ) ; memcpy ( wl -> bitrates , wilc_bitrates , sizeof ( wilc_bitrates ) ) ; memcpy ( wl -> channels , wilc_2ghz_channels , sizeof ( wilc_2ghz_channels ) ) ; wl -> band . bitrates = wl -> bitrates ; wl -> band . n_bitrates = ARRAY_SIZE ( wl -> bitrates ) ; wl -> band . channels = wl -> channels ; wl -> band . n_channels = ARRAY_SIZE ( wilc_2ghz_channels ) ; wl -> band . ht_cap . ht_supported = 1 ; wl -> band . ht_cap . cap |= ( 1 << IEEE80211_HT_CAP_RX_STBC_SHIFT ) ; wl -> band . ht_cap . mcs . rx_mask [ 0 ] = 0xff ; wl -> band . ht_cap . ampdu_factor = IEEE80211_HT_MAX_AMPDU_8K ; wl -> band . ht_cap . ampdu_density = IEEE80211_HT_MPDU_DENSITY_NONE ; wiphy -> bands [ NL80211_BAND_2GHZ ] = & wl -> band ; wiphy -> max_scan_ssids = WILC_MAX_NUM_PROBED_SSID ; wiphy -> wowlan = & wowlan_support ; wiphy -> max_num_pmkids = WILC_MAX_NUM_PMKIDS ; wiphy -> max_scan_ie_len = 1000 ; wiphy -> signal_type = CFG80211_SIGNAL_TYPE_MBM ; memcpy ( wl -> cipher_suites , wilc_cipher_suites , sizeof ( wilc_cipher_suites ) ) ; wiphy -> cipher_suites = wl -> cipher_suites ; wiphy -> n_cipher_suites = ARRAY_SIZE ( wilc_cipher_suites ) ; wiphy -> mgmt_stypes = wilc_wfi_cfg80211_mgmt_types ; wiphy -> max_remain_on_channel_duration = 500 ; wiphy -> interface_modes = BIT ( NL80211_IFTYPE_STATION ) | BIT ( NL80211_IFTYPE_AP ) | BIT ( NL80211_IFTYPE_MONITOR ) | BIT ( NL80211_IFTYPE_P2P_GO ) | BIT ( NL80211_IFTYPE_P2P_CLIENT ) ; wiphy -> flags |= WIPHY_FLAG_HAS_REMAIN_ON_CHANNEL ; wiphy -> features |= NL80211_FEATURE_SAE ; set_wiphy_dev ( wiphy , dev ) ; wl -> wiphy = wiphy ; ret = wiphy_register ( wiphy ) ; if ( ret ) { return NULL ; } return wl ; } 