int papr_sysparm_set ( papr_sysparm_t param , const struct papr_sysparm_buf * buf ) { const s32 token = rtas_function_token ( RTAS_FN_IBM_SET_SYSTEM_PARAMETER ) ; struct rtas_work_area * work_area ; s32 fwrc ; int ret ; might_sleep ( ) ; if ( token == RTAS_UNKNOWN_SERVICE ) { return - ENOENT ; } work_area = rtas_work_area_alloc ( sizeof ( * buf ) ) ; memcpy ( rtas_work_area_raw_buf ( work_area ) , buf , sizeof ( * buf ) ) ; { fwrc = rtas_call ( token , 2 , 1 , NULL , param . token , rtas_work_area_phys ( work_area ) ) ; } rtas_busy_delay ( fwrc ) ; switch ( fwrc ) { case 0 : ret = 0 ; break ; case - 3 : ret = - EOPNOTSUPP ; break ; case - 9002 : ret = - EPERM ; break ; case - 9999 : ret = - EINVAL ; break ; default : pr_err ( "unexpected ibm,set-system-parameter result %d\n" , fwrc ) ; fallthrough ; case - 1 : ret = - EIO ; break ; } rtas_work_area_free ( work_area ) ; return ret ; } 