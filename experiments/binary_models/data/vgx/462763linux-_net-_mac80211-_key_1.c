static bool ieee80211_key_identical ( ieee80211_sub_if_data * sdata , ieee80211_key * old , ieee80211_key * new ) ( u8 tkip_old [ WLAN_KEY_LEN_TKIP ] , tkip_new [ WLAN_KEY_LEN_TKIP ] , u8 * tk_old , * tk_new , ( ! old || new -> conf . keylen != old -> conf . keylen ) return false ; ) ; tk_old = old -> conf . key ; tk_new = new -> conf . key ; if ( sdata -> vif . type == NL80211_IFTYPE_STATION && new -> conf . cipher == WLAN_CIPHER_SUITE_TKIP && new -> conf . keylen == WLAN_KEY_LEN_TKIP && ! ( new -> conf . flags & IEEE80211_KEY_FLAG_PAIRWISE ) ) { memcpy ( tkip_old , tk_old , WLAN_KEY_LEN_TKIP ) ; memcpy ( tkip_new , tk_new , WLAN_KEY_LEN_TKIP ) ; memset ( tkip_new + NL80211_TKIP_DATA_OFFSET_TX_MIC_KEY , 0 , 8 ) ; tk_old = tkip_old ; tk_new = tkip_new ; } return ! crypto_memneq ( tk_old , tk_new , new -> conf . keylen ) ; 