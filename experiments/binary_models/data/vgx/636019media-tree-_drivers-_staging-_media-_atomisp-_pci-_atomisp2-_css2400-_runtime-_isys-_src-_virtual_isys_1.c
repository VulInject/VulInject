static bool calculate_ibuf_ctrl_cfg ( const input_system_channel_t * channel , const input_system_input_port_t * input_port , const input_system_cfg_t * isys_cfg , ibuf_ctrl_cfg_t * cfg ) { const int32_t bits_per_byte = 8 ; int32_t bits_per_pixel ; int32_t bytes_per_pixel ; int32_t left_padding ; ( void ) input_port ; bits_per_pixel = isys_cfg -> input_port_resolution . bits_per_pixel ; bytes_per_pixel = ceil_div ( bits_per_pixel , bits_per_byte ) ; left_padding = CEIL_MUL ( isys_cfg -> output_port_attr . left_padding , ISP_VEC_NELEMS ) * bytes_per_pixel ; cfg -> online = isys_cfg -> online ; cfg -> dma_cfg . channel = channel -> dma_channel ; cfg -> dma_cfg . cmd = _DMA_V2_MOVE_A2B_NO_SYNC_CHK_COMMAND ; cfg -> dma_cfg . shift_returned_items = 0 ; cfg -> dma_cfg . elems_per_word_in_dest = 0 ; cfg -> ib_buffer . start_addr = channel -> ib_buffer . start_addr ; cfg -> ib_buffer . stride = channel -> ib_buffer . stride ; cfg -> ib_buffer . lines = channel -> ib_buffer . lines ; if ( cfg -> online ) { cfg -> dest_buf_cfg . start_addr = ISP_INPUT_BUF_START_ADDR + left_padding ; cfg -> dest_buf_cfg . stride = bytes_per_pixel * isys_cfg -> output_port_attr . max_isp_input_width ; cfg -> dest_buf_cfg . lines = LINES_OF_ISP_INPUT_BUF ; } if ( isys_cfg -> raw_packed ) { cfg -> dest_buf_cfg . stride = calculate_stride ( bits_per_pixel , isys_cfg -> input_port_resolution . pixels_per_line , isys_cfg -> raw_packed , isys_cfg -> input_port_resolution . align_req_in_bytes ) ; } else { cfg -> dest_buf_cfg . stride = channel -> ib_buffer . stride ; } cfg -> items_per_store = 1 ; cfg -> stores_per_frame = isys_cfg -> input_port_resolution . lines_per_frame ; cfg -> stream2mmio_cfg . sync_cmd = _STREAM2MMIO_CMD_TOKEN_SYNC_FRAME ; cfg -> stream2mmio_cfg . store_cmd = _STREAM2MMIO_CMD_TOKEN_STORE_PACKETS ; return true ; } 