void * gf_ssl_server_context_new ( const char * cert , const char * key ) { const SSL_METHOD * method ; SSL_CTX * ctx ; method = SSLv23_server_method ( ) ; ctx = SSL_CTX_new ( method ) ; if ( ! ctx ) { GF_LOG ( GF_LOG_ERROR , GF_LOG_CORE , ( "Unable to create SSL context\n" ) ) ; ERR_print_errors_fp ( stderr ) ; return NULL ; } SSL_CTX_set_ecdh_auto ( ctx , 1 ) ; if ( SSL_CTX_use_certificate_file ( ctx , cert , SSL_FILETYPE_PEM ) <= 0 ) { ERR_print_errors_fp ( stderr ) ; SSL_CTX_free ( ctx ) ; return NULL ; } if ( SSL_CTX_use_PrivateKey_file ( ctx , key , SSL_FILETYPE_PEM ) <= 0 ) { ERR_print_errors_fp ( stderr ) ; SSL_CTX_free ( ctx ) ; return NULL ; } if ( gf_log_tool_level_on ( GF_LOG_NETWORK , GF_LOG_DEBUG ) ) { SSL_CTX_set_msg_callback ( ctx , ssl_on_log ) ; } if ( ! gf_opts_get_bool ( "core" , "no-h2" ) ) { next_proto_list [ 0 ] = NGHTTP2_PROTO_VERSION_ID_LEN ; memcpy ( & next_proto_list [ 1 ] , NGHTTP2_PROTO_VERSION_ID , NGHTTP2_PROTO_VERSION_ID_LEN ) ; next_proto_list_len = 1 + NGHTTP2_PROTO_VERSION_ID_LEN ; SSL_CTX_set_next_protos_advertised_cb ( ctx , next_proto_cb , NULL ) ; if ( gf_sys_is_cov_mode ( ) ) { next_proto_cb ( NULL , NULL , NULL , NULL ) ; h2_error_callback ( NULL , NULL , 0 , NULL ) ; on_user_pass ( NULL , NULL , NULL , GF_FALSE ) ; } SSL_CTX_set_alpn_select_cb ( ctx , alpn_select_proto_cb ) ; } return ctx ; } 