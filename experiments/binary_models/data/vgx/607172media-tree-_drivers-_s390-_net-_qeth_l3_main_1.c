static void qeth_l3_add_vlan_mc6 ( struct qeth_card * card ) { struct inet6_dev * in_dev ; u16 vid ; QETH_CARD_TEXT ( card , 4 , "admc6vl" ) ; if ( ! qeth_is_supported ( card , IPA_FULL_VLAN ) ) { return ; } for_each_set_bit ( , , ) { struct net_device * netdev ; netdev = __vlan_find_dev_deep_rcu ( card -> dev , htons ( ETH_P_8021Q ) , vid ) ; if ( netdev == NULL || ! ( netdev -> flags & IFF_UP ) ) { continue ; } in_dev = in6_dev_get ( netdev ) ; if ( ! in_dev ) { continue ; } read_lock_bh ( & in_dev -> lock ) ; qeth_l3_add_mc6_to_hash ( card , in_dev ) ; read_unlock_bh ( & in_dev -> lock ) ; in6_dev_put ( in_dev , NULL ) ; } } 