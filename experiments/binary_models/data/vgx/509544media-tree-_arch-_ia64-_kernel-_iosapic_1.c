int iosapic_remove ( unsigned int gsi_base ) { int i , irq , index , err = 0 ; unsigned long flags ; spin_lock_irqsave ( & iosapic_lock , flags ) ; index = find_iosapic ( gsi_base ) ; if ( index < 0 ) { printk ( KERN_WARNING "%s: No IOSAPIC for GSI base %u\n" , __func__ , gsi_base ) ; out } if ( iosapic_lists [ index ] . rtes_inuse ) { err = - EBUSY ; printk ( KERN_WARNING "%s: IOSAPIC for GSI base %u is busy\n" , __func__ , gsi_base ) ; out } for ( i = gsi_base ; i < gsi_base + iosapic_lists [ index ] . num_rte ; i ++ ) { irq = __gsi_to_irq ( i ) ; err = iosapic_delete_rte ( irq , i ) ; if ( err ) { out } } iounmap ( iosapic_lists [ index ] . addr ) ; iosapic_free ( index ) ; out spin_unlock_irqrestore ( & iosapic_lock , flags ) ; return err ; } 