static unsigned long rcu_torture_fwd_prog_cbfree ( struct rcu_fwd * rfp ) { unsigned long flags ; unsigned long freed = 0 ; struct rcu_fwd_cb * rfcp ; for ( ; ; ) { spin_lock_irqsave ( & rfp -> rcu_fwd_lock , flags ) ; rfcp = rfp -> rcu_fwd_cb_head ; if ( ! rfcp ) { spin_unlock_irqrestore ( & rfp -> rcu_fwd_lock , flags ) ; break ; } rfp -> rcu_fwd_cb_head = rfcp -> rfc_next ; if ( ! rfp -> rcu_fwd_cb_head ) { rfp -> rcu_fwd_cb_tail = & rfp -> rcu_fwd_cb_head ; } spin_unlock_irqrestore ( & rfp -> rcu_fwd_lock , flags ) ; freed ++ ; rcu_torture_fwd_prog_cond_resched ( freed ) ; if ( tick_nohz_full_enabled ( ) ) { local_irq_save ( flags ) ; rcu_momentary_dyntick_idle ( ) ; local_irq_restore ( flags ) ; } } return freed ; } 