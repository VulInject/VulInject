static int AddMulticastMembershipIPv6 ( int s , unsigned int ifindex ) { struct ipv6_mreq mr ; mr . ipv6mr_interface = ifindex ; inet_pton ( AF_INET6 , LL_SSDP_MCAST_ADDR , & mr . ipv6mr_multiaddr ) ; if ( setsockopt ( s , IPPROTO_IPV6 , IPV6_ADD_MEMBERSHIP , & mr , sizeof ( ipv6_mreq ) ) < 0 ) { syslog ( LOG_ERR , "setsockopt(udp, IPV6_ADD_MEMBERSHIP): %m" ) ; return - 1 ; } inet_pton ( AF_INET6 , SL_SSDP_MCAST_ADDR , & mr . ipv6mr_multiaddr ) ; if ( setsockopt ( s , IPPROTO_IPV6 , IPV6_ADD_MEMBERSHIP , & mr , sizeof ( ipv6_mreq ) ) < 0 ) { syslog ( LOG_ERR , "setsockopt(udp, IPV6_ADD_MEMBERSHIP): %m" ) ; return - 1 ; } inet_pton ( AF_INET6 , GL_SSDP_MCAST_ADDR , & mr . ipv6mr_multiaddr ) ; if ( setsockopt ( s , IPPROTO_IPV6 , IPV6_ADD_MEMBERSHIP , & mr , sizeof ( ipv6_mreq ) ) < 0 ) { syslog ( LOG_ERR , "setsockopt(udp, IPV6_ADD_MEMBERSHIP): %m" ) ; return - 1 ; } return 0 ; } 