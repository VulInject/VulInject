container_id = g_strndup ( last , 12 ) ; if ( strlen ( container_id ) != 12 ) { log_debug ( "Failed to get container ID" ) ; continue ; } g_autofree char * docker_inspect_cmdline = NULL ; if ( root_dir != NULL ) { docker_inspect_cmdline = g_strdup_printf ( "chroot %s /bin/sh -c \"docker inspect %s\"" , root_dir , container_id ) ; } else { docker_inspect_cmdline = g_strdup_printf ( "docker inspect %s" , container_id ) ; } log_debug ( "Executing: '%s'" , docker_inspect_cmdline ) ; output = libreport_run_in_shell_and_save_output ( 0 , docker_inspect_cmdline , "/" , NULL ) ; if ( output == NULL || strcmp ( output , "[]\n" ) == 0 ) { log_debug ( "Unsupported container ID: '%s'" , container_id ) ; g_free ( container_id ) ; container_id = NULL ; output = NULL ; continue ; } break ; ( mntnf_file ) ; if ( container_id == NULL ) { error_msg ( "Could not inspect the container" ) ; dump_docker_info_cleanup } dd_save_text ( dd , FILENAME_CONTAINER_ID , container_id ) ; dd_save_text ( dd , FILENAME_DOCKER_INSPECT , output ) ; json = json_tokener_parse ( output ) ; if ( json == NULL ) { error_msg ( "Unable parse response from docker" ) ; dump_docker_info_cleanup } json_object * container = json_object_array_get_idx ( json , 0 ) ; if ( container == NULL ) { error_msg ( "docker does not contain array of containers" ) ; dump_docker_info_cleanup } json_object * config = NULL ; if ( ! json_object_object_get_ex ( container , "Config" , & config ) ) { error_msg ( "container does not have 'Config' member" ) ; dump_docker_info_cleanup } json_object * image = NULL ; if ( ! json_object_object_get_ex ( config , "Image" , & image ) ) { error_msg ( "Config does not have 'Image' member" ) ; dump_docker_info_cleanup } char * name = libreport_strtrimch ( g_strdup ( json_object_to_json_string ( image ) ) , '"' ) ; dd_save_text ( dd , FILENAME_CONTAINER_IMAGE , name ) ; dump_docker_info_cleanup if ( json != NULL ) { json_object_put ( json ) ; } libreport_mountinfo_destroy ( & mntnf ) ; return ; 