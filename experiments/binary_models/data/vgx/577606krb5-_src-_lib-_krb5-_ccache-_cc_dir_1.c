static krb5_error_code KRB5_CALLCONV dcc_ptcursor_new ( krb5_context context , krb5_cc_ptcursor * cursor_out ) { krb5_error_code ret ; char * dirname = NULL , * primary_path = NULL , * primary = NULL ; DIR * dir = NULL ; * cursor_out = NULL ; ret = get_context_subsidiary_file ( context , & primary ) ; if ( ret ) { cleanup } if ( primary != NULL ) { ret = make_cursor ( NULL , primary , NULL , cursor_out ) ; if ( ret ) { free ( primary ) ; } return ret ; } ret = get_context_default_dir ( context , & dirname ) ; if ( ret || dirname == NULL ) { cleanup } dir = opendir ( dirname ) ; if ( dir == NULL ) { cleanup } ret = primary_pathname ( dirname , & primary_path ) ; if ( ret ) { cleanup } ret = read_primary_file ( context , primary_path , dirname , & primary ) ; if ( ret ) { krb5_clear_error_message ( context ) ; } ret = make_cursor ( dirname , primary , dir , cursor_out ) ; if ( ret ) { cleanup } dirname = primary = NULL ; dir = NULL ; cleanup free ( dirname ) ; free ( primary ) ; if ( dir ) { closedir ( dir ) ; } if ( * cursor_out == NULL ) { return make_cursor ( NULL , NULL , NULL , cursor_out ) ; } return 0 ; } 