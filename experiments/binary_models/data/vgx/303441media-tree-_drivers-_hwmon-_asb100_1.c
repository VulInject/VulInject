static int asb100_probe ( struct i2c_client * client , const struct i2c_device_id * id ) { int err ; struct asb100_data * data ; data = devm_kzalloc ( & client -> dev , sizeof ( asb100_data ) , GFP_KERNEL ) ; i2c_set_clientdata ( client , data ) ; mutex_init ( & data -> lock ) ; mutex_init ( & data -> update_lock ) ; err = asb100_detect_subclients ( client ) ; if ( err ) { return err ; } asb100_init_client ( client ) ; data -> fan_min [ 0 ] = asb100_read_value ( client , ASB100_REG_FAN_MIN ( 0 ) ) ; data -> fan_min [ 1 ] = asb100_read_value ( client , ASB100_REG_FAN_MIN ( 1 ) ) ; data -> fan_min [ 2 ] = asb100_read_value ( client , ASB100_REG_FAN_MIN ( 2 ) ) ; err = sysfs_create_group ( & client -> dev . kobj , & asb100_group ) ; if ( err ) { ERROR3 } data -> hwmon_dev = hwmon_device_register ( & client -> dev ) ; if ( IS_ERR ( data -> hwmon_dev ) ) { err = PTR_ERR ( data -> hwmon_dev ) ; ERROR4 } return 0 ; ERROR4 sysfs_remove_group ( & client -> dev . kobj , & asb100_group ) ; ERROR3 i2c_unregister_device ( data -> lm75 [ 1 ] ) ; i2c_unregister_device ( data -> lm75 [ 0 ] ) ; return err ; } 