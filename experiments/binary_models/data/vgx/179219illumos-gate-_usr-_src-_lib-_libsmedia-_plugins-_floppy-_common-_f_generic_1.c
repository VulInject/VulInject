int32_t _m_get_device_info ( rmedia_handle_t * handle , void * ip ) { smdevice_info_t * dev_info = ( smdevice_info_t * ) ip ; char * vendor_name , * product_name , * fw_version ; if ( handle == NULL ) { DPRINTF ( "Null Handle\n" ) ; errno = EINVAL ; return ( - 1 ) ; } if ( handle -> sm_signature != ( int32_t ) LIBSMEDIA_SIGNATURE ) { DPRINTF ( "Invalid signature in handle.\n" ) ; DPRINTF2 ( "Signature expected=0x%x found=0x%x\n" , LIBSMEDIA_SIGNATURE , handle -> sm_signature ) ; errno = EINVAL ; return ( - 1 ) ; } if ( handle -> sm_fd < 0 ) { DPRINTF ( "Invalid file handle.\n" ) ; errno = EINVAL ; return ( - 1 ) ; } vendor_name = ( char * ) malloc ( 1 ) ; if ( vendor_name == NULL ) { if ( ! errno ) { errno = ENOMEM ; } return ( - 1 ) ; } product_name = ( char * ) malloc ( 1 ) ; if ( product_name == NULL ) { if ( ! errno ) { errno = ENOMEM ; } return ( - 1 ) ; } fw_version = ( char * ) malloc ( 1 ) ; if ( fw_version == NULL ) { free ( vendor_name ) ; free ( product_name ) ; if ( ! errno ) { errno = ENOMEM ; } return ( - 1 ) ; } vendor_name [ 0 ] = 0 ; product_name [ 0 ] = 0 ; fw_version [ 0 ] = 0 ; dev_info -> sm_interface_type = IF_FLOPPY ; dev_info -> sm_vendor_name = vendor_name ; dev_info -> sm_product_name = product_name ; dev_info -> sm_firmware_version = fw_version ; return ( 0 ) ; } 