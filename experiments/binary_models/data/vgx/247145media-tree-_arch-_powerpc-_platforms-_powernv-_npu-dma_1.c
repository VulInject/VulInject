void pnv_npu_try_dma_set_bypass ( struct pci_dev * gpdev , bool bypass ) { int i ; struct pnv_phb * phb ; struct pci_dn * pdn ; struct pnv_ioda_pe * npe ; struct pci_dev * npdev ; for ( i = 0 ; ; ++ i ) { npdev = pnv_pci_get_npu_dev ( gpdev , i ) ; if ( ! npdev ) { break ; } pdn = pci_get_pdn ( npdev ) ; if ( WARN_ON ( ! pdn || pdn -> pe_number == IODA_INVALID_PE ) ) { return ; } phb = pci_bus_to_host ( npdev -> bus ) -> private_data ; npe = & phb -> ioda . pe_array [ pdn -> pe_number ] ; if ( bypass ) { dev_info ( & npdev -> dev , "Using 64-bit DMA iommu bypass\n" ) ; pnv_npu_dma_set_bypass ( npe ) ; } else { dev_info ( & npdev -> dev , "Using 32-bit DMA via iommu\n" ) ; pnv_npu_dma_set_32 ( npe , NULL ) ; } } } 