static int get_board_id ( const char * * pin_names , const char * * ids_names , int size , bool * valid , u32 * id ) { struct gpio_desc desc ; int i , ret , val ; * valid = false ; for ( i = 0 ; i < size ; i ++ ) { ret = dm_gpio_lookup_name ( pin_names [ i ] , & desc ) ; if ( ret ) { printf ( "Can't lookup request SWx gpios\n" ) ; return ret ; } ret = dm_gpio_request ( & desc , ids_names [ i ] ) ; if ( ret ) { printf ( "Can't lookup request SWx gpios\n" ) ; return ret ; } dm_gpio_set_dir_flags ( & desc , GPIOD_IS_IN ) ; val = dm_gpio_get_value ( & desc ) ; if ( val < 0 ) { printf ( "Can't get SW%d ID\n" , i ) ; * id = 0 ; return val ; } * id |= val << i ; } * valid = true ; return 0 ; } 