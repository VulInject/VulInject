static KMF_RETURN get_keyalg_from_cert ( KMF_DATA * cert , KMF_KEY_ALG * keyalg ) { KMF_RETURN rv ; KMF_X509_CERTIFICATE * SignerCert = NULL ; KMF_ALGORITHM_INDEX AlgorithmId ; rv = DerDecodeSignedCertificate ( cert , & SignerCert ) ; if ( rv != KMF_OK ) { return ( rv ) ; } AlgorithmId = x509_algoid_to_algid ( & SignerCert -> signature . algorithmIdentifier . algorithm ) ; switch ( AlgorithmId ) { case KMF_ALGID_MD5WithRSA : case KMF_ALGID_SHA1WithRSA : case KMF_ALGID_SHA256WithRSA : case KMF_ALGID_SHA384WithRSA : case KMF_ALGID_SHA512WithRSA : * keyalg = KMF_RSA ; break ; case KMF_ALGID_SHA1WithDSA : case KMF_ALGID_SHA256WithDSA : * keyalg = KMF_DSA ; break ; case KMF_ALGID_SHA1WithECDSA : case KMF_ALGID_SHA256WithECDSA : case KMF_ALGID_SHA384WithECDSA : case KMF_ALGID_SHA512WithECDSA : case KMF_ALGID_ECDSA : * keyalg = KMF_ECDSA ; break ; default : rv = KMF_ERR_BAD_ALGORITHM ; } kmf_free_signed_cert ( SignerCert ) ; return ( rv ) ; } 