scrollback_shrink ( ) { char * buf , * p ; gsize len ; gint offset , lines = 0 ; const gint max_lines = MIN ( prefs . hex_text_max_lines , SCROLLBACK_MAX ) ; p = buf ; while ( p != buf + len ) { if ( * p == '\n' ) { lines ++ ; } p ++ ; } offset = lines - max_lines ; p = buf ; lines = 0 ; while ( p != buf + len ) { if ( * p == '\n' ) { lines ++ ; if ( lines == offset ) { p ++ ; break ; } } p ++ ; } if ( g_file_replace_contents ( sess -> scrollfile , p , strlen ( p ) , NULL , FALSE , G_FILE_CREATE_PRIVATE , NULL , NULL , NULL ) ) { sess -> scrollwritten = lines ; } g_free ( buf ) ; } 