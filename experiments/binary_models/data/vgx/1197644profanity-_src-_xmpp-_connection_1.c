void connection_disconnect ( void ) { if ( conn . conn_last_event == XMPP_CONN_CONNECT ) { conn . conn_status = JABBER_DISCONNECTING ; xmpp_disconnect ( conn . xmpp_conn ) ; while ( conn . conn_status == JABBER_DISCONNECTING ) { session_process_events ( ) ; } } else { conn . conn_status = JABBER_DISCONNECTED ; } if ( ! conn . xmpp_in_event_loop ) { if ( conn . xmpp_conn ) { xmpp_conn_release ( conn . xmpp_conn ) ; conn . xmpp_conn = xmpp_conn_new ( conn . xmpp_ctx ) ; } } prof_identifier = NULL ; } 