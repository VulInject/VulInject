static int sun8i_codec_component_probe ( struct snd_soc_component * component ) { struct snd_soc_dapm_context * dapm = snd_soc_component_get_dapm ( component ) ; struct sun8i_codec * scodec = snd_soc_component_get_drvdata ( component ) ; int ret ; if ( scodec -> quirks -> legacy_widgets ) { ret = snd_soc_dapm_new_controls ( dapm , sun8i_codec_legacy_widgets , ARRAY_SIZE ( sun8i_codec_legacy_widgets ) ) ; if ( ret ) { return ret ; } ret = snd_soc_dapm_add_routes ( dapm , sun8i_codec_legacy_routes , ARRAY_SIZE ( sun8i_codec_legacy_routes ) ) ; if ( ret ) { return ret ; } } regmap_update_bits ( scodec -> regmap , SUN8I_SYSCLK_CTL , SUN8I_SYSCLK_CTL_AIF1CLK_SRC_MASK | SUN8I_SYSCLK_CTL_AIF2CLK_SRC_MASK , SUN8I_SYSCLK_CTL_AIF1CLK_SRC_PLL | SUN8I_SYSCLK_CTL_AIF2CLK_SRC_PLL ) ; regmap_update_bits ( scodec -> regmap , SUN8I_SYSCLK_CTL , BIT ( SUN8I_SYSCLK_CTL_SYSCLK_SRC ) , SUN8I_SYSCLK_CTL_SYSCLK_SRC_AIF1CLK ) ; sun8i_codec_update_sample_rate ( scodec , NULL ) ; return 0 ; } 