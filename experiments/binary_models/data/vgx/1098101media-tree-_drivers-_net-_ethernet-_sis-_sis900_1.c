static void sis900_init_rx_ring ( struct net_device * net_dev ) { struct sis900_private * sis_priv = netdev_priv ( net_dev ) ; void __iomem * ioaddr = sis_priv -> ioaddr ; int i ; sis_priv -> cur_rx = 0 ; sis_priv -> dirty_rx = 0 ; for ( i = 0 ; i < NUM_RX_DESC ; i ++ ) { sis_priv -> rx_skbuff [ i ] = NULL ; sis_priv -> rx_ring [ i ] . link = sis_priv -> rx_ring_dma + ( ( i + 1 ) % NUM_RX_DESC ) * sizeof ( BufferDesc ) ; sis_priv -> rx_ring [ i ] . cmdsts = 0 ; sis_priv -> rx_ring [ i ] . bufptr = 0 ; } for ( i = 0 ; i < NUM_RX_DESC ; i ++ ) { struct sk_buff * skb ; sis_priv -> rx_skbuff [ i ] = skb ; sis_priv -> rx_ring [ i ] . cmdsts = RX_BUF_SIZE ; sis_priv -> rx_ring [ i ] . bufptr = pci_map_single ( sis_priv -> pci_dev , skb -> data , RX_BUF_SIZE , PCI_DMA_FROMDEVICE ) ; if ( unlikely ( pci_dma_mapping_error ( sis_priv -> pci_dev , sis_priv -> rx_ring [ i ] . bufptr ) ) ) { dev_kfree_skb ( skb ) ; sis_priv -> rx_skbuff [ i ] = NULL ; break ; } } sis_priv -> dirty_rx = ( unsigned int ) ( i - NUM_RX_DESC ) ; sw32 ( rxdp , sis_priv -> rx_ring_dma ) ; if ( netif_msg_hw ( sis_priv ) ) { printk ( KERN_DEBUG "%s: RX descriptor register loaded with: %8.8x\n" , net_dev -> name , sr32 ( rxdp ) ) ; } } 