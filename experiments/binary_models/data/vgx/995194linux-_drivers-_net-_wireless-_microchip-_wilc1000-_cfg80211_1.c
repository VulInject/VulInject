static int change_virtual_intf ( struct wiphy * wiphy , struct net_device * dev , enum nl80211_iftype type , struct vif_params * params ) { struct wilc * wl = wiphy_priv ( wiphy ) ; struct wilc_vif * vif = netdev_priv ( dev ) ; struct wilc_priv * priv = & vif -> priv ; switch ( type ) { case NL80211_IFTYPE_STATION : vif -> connecting = false ; dev -> ieee80211_ptr -> iftype = type ; priv -> wdev . iftype = type ; vif -> monitor_flag = 0 ; if ( vif -> iftype == WILC_AP_MODE || vif -> iftype == WILC_GO_MODE ) { wilc_wfi_deinit_mon_interface ( wl , true ) ; } vif -> iftype = WILC_STATION_MODE ; if ( wl -> initialized ) { wilc_set_operation_mode ( vif , wilc_get_vif_idx ( vif ) , WILC_STATION_MODE , vif -> idx ) ; } break ; case NL80211_IFTYPE_P2P_CLIENT : vif -> connecting = false ; dev -> ieee80211_ptr -> iftype = type ; priv -> wdev . iftype = type ; vif -> monitor_flag = 0 ; vif -> iftype = WILC_CLIENT_MODE ; if ( wl -> initialized ) { wilc_set_operation_mode ( vif , wilc_get_vif_idx ( vif ) , WILC_STATION_MODE , vif -> idx ) ; } break ; case NL80211_IFTYPE_AP : dev -> ieee80211_ptr -> iftype = type ; priv -> wdev . iftype = type ; vif -> iftype = WILC_AP_MODE ; if ( wl -> initialized ) { wilc_set_operation_mode ( vif , wilc_get_vif_idx ( vif ) , WILC_AP_MODE , vif -> idx ) ; } break ; case NL80211_IFTYPE_P2P_GO : dev -> ieee80211_ptr -> iftype = type ; priv -> wdev . iftype = type ; vif -> iftype = WILC_GO_MODE ; if ( wl -> initialized ) { wilc_set_operation_mode ( vif , wilc_get_vif_idx ( vif ) , WILC_AP_MODE , vif -> idx ) ; } break ; default : netdev_err ( dev , "Unknown interface type= %d\n" , type ) ; return - EINVAL ; } return 0 ; } 