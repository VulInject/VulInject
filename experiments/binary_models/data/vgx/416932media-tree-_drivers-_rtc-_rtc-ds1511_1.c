static irqreturn_t ds1511_interrupt ( int irq , void * dev_id ) { struct platform_device * pdev = dev_id ; struct rtc_plat_data * pdata = platform_get_drvdata ( pdev ) ; cfs_time_t events = 0 ; spin_lock ( & pdata -> lock ) ; if ( rtc_read ( RTC_CMD1 ) & DS1511_IRQF ) { events = RTC_IRQF ; if ( rtc_read ( RTC_ALARM_SEC ) & 0x80 ) { events |= RTC_UF ; } else { events |= RTC_AF ; } rtc_update_irq ( pdata -> rtc , 1 , events ) ; } spin_unlock ( & pdata -> lock ) ; return events ?IRQ_HANDLED : IRQ_NONE ; } 