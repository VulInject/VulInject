static ssize_t fpty_read ( struct corerouter_peer * main_peer ) { struct forkptyrouter_session * fpty_session = ( forkptyrouter_session * ) main_peer -> session ; ssize_t len = cr_read ( main_peer , "fpty_read()" ) ; if ( fpty_session -> uwsgi ) { ssize_t rlen = fpty_parse_uwsgi ( main_peer ) ; if ( rlen < 0 ) { return - 1 ; } if ( rlen == 0 ) { return 1 ; } fpty_session -> restore_size = main_peer -> in -> pos - rlen ; main_peer -> session -> peers -> out = main_peer -> in ; main_peer -> session -> peers -> out -> pos = rlen ; } else { main_peer -> session -> peers -> out = main_peer -> in ; } main_peer -> session -> peers -> out_pos = 0 ; cr_write_to_backend ( main_peer -> session -> peers , fpty_instance_write ) ; return len ; } 