int parse_pai_header ( struct sip_msg * const msg ) { p_id_body_t * pai_b ; p_id_body_t * * prev_pid_b ; hdr_field_t * hf ; void * * vp ; if ( ! msg -> pai ) { if ( parse_headers ( msg , HDR_PAI_F , 0 ) < 0 ) { LM_ERR ( "Error parsing PAI header\n" ) ; return - 1 ; } } if ( msg -> pai -> parsed ) { return 0 ; } vp = & msg -> pai -> parsed ; prev_pid_b = ( p_id_body_t * * ) vp ; for ( hf = msg -> pai ; hf != NULL ; hf = next_sibling_hdr ( hf ) ) { if ( parse_pai_ppi_body ( hf -> body . s , hf -> body . len , & pai_b ) < 0 ) { return - 1 ; } hf -> parsed = ( void * ) pai_b ; * prev_pid_b = pai_b ; prev_pid_b = & pai_b -> next ; if ( parse_headers ( msg , HDR_PAI_F , 1 ) < 0 ) { LM_ERR ( "Error looking for subsequent PAI header" ) ; return - 1 ; } } return 0 ; } 