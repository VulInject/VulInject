static int st_lsm6dsx_shub_config_channels ( struct st_lsm6dsx_sensor * sensor , bool enable ) { const struct st_lsm6dsx_shub_settings * hub_settings ; const struct st_lsm6dsx_ext_dev_settings * settings ; u8 config [ 9 ] { } ; , enable_mask , slv_addr ; struct st_lsm6dsx_hw * hw = sensor -> hw ; struct st_lsm6dsx_sensor * cur_sensor ; int i , j = 0 ; hub_settings = & hw -> settings -> shub_settings ; if ( enable ) { enable_mask = hw -> enable_mask | BIT ( sensor -> id ) ; } else { enable_mask = hw -> enable_mask & ~ BIT ( sensor -> id ) ; } for ( i = ST_LSM6DSX_ID_EXT0 ; i <= ST_LSM6DSX_ID_EXT2 ; i ++ ) { cur_sensor = iio_priv ( hw -> iio_devs [ i ] ) ; if ( ! ( enable_mask & BIT ( cur_sensor -> id ) ) ) { continue ; } settings = cur_sensor -> ext_info . settings ; config [ j ] = ( sensor -> ext_info . addr << 1 ) | 1 ; config [ j + 1 ] = settings -> out . addr ; config [ j + 2 ] = ( settings -> out . len & ST_LS6DSX_READ_OP_MASK ) | hub_settings -> batch_en ; j += 3 ; } slv_addr = ST_LSM6DSX_SLV_ADDR ( 1 , hub_settings -> slv0_addr ) ; return st_lsm6dsx_shub_write_reg ( hw , slv_addr , config , sizeof ( config ) ) ; } 