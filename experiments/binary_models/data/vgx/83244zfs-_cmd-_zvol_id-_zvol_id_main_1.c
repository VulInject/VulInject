int main ( int argc , char * * argv ) { int fd , error = 0 ; int zvol_name [ ZFS_MAX_DATASET_NAME_LEN ] ; char zvol_name_part [ ZFS_MAX_DATASET_NAME_LEN ] ; char * dev_name ; struct stat64 statbuf ; int dev_minor , dev_part ; int i ; if ( argc < 2 ) { printf ( "Usage: %s /dev/zvol_device_node\n" , argv [ 0 ] ) ; return ( EINVAL ) ; } dev_name = argv [ 1 ] ; error = stat64 ( dev_name , & statbuf ) ; if ( error != 0 ) { printf ( "Unable to access device file: %s\n" , dev_name ) ; return ( errno ) ; } dev_minor = minor ( statbuf . st_rdev ) ; dev_part = dev_minor % ZVOL_MINORS ; fd = open ( dev_name , O_RDONLY ) ; if ( fd < 0 ) { printf ( "Unable to open device file: %s\n" , dev_name ) ; return ( errno ) ; } error = ioctl_get_msg ( zvol_name , fd ) ; if ( error < 0 ) { printf ( "ioctl_get_msg failed:%s\n" , strerror ( errno ) ) ; return ( errno ) ; } if ( dev_part > 0 ) { snprintf ( zvol_name_part , ZFS_MAX_DATASET_NAME_LEN , "%s-part%d" , zvol_name , dev_part ) ; } else { snprintf ( zvol_name_part , ZFS_MAX_DATASET_NAME_LEN , "%s" , zvol_name ) ; } for ( i = 0 ; i < strlen ( zvol_name_part ) ; i ++ ) { if ( isblank ( zvol_name_part [ i ] ) ) { zvol_name_part [ i ] = '+' ; } } printf ( "%s\n" , zvol_name_part ) ; close ( fd ) ; return ( error ) ; } 