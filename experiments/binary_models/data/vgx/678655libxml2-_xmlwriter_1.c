int xmlTextWriterStartElementNS ( xmlTextWriterPtr writer , const xmlChar * prefix , const xmlChar * name , const xmlChar * namespaceURI ) { int count ; int sum ; xmlChar * buf ; if ( ( writer == NULL ) || ( name == NULL ) || ( * name == '\0' ) ) { return - 1 ; } buf = NULL ; if ( prefix != 0 ) { buf = xmlStrdup ( prefix ) ; buf = xmlStrcat ( buf , BAD_CAST ":" ) ; } buf = xmlStrcat ( buf , name ) ; sum = 0 ; count = xmlTextWriterStartElement ( writer , buf ) ; xmlFree ( buf ) ; if ( count < 0 ) { return - 1 ; } sum += count ; if ( namespaceURI != 0 ) { xmlTextWriterNsStackEntry * p = ( xmlTextWriterNsStackEntry * ) xmlMalloc ( sizeof ( xmlTextWriterNsStackEntry ) ) ; if ( p == 0 ) { xmlWriterErrMsg ( writer , XML_ERR_NO_MEMORY , "xmlTextWriterStartElementNS : out of memory!\n" ) ; return - 1 ; } buf = xmlStrdup ( BAD_CAST "xmlns" ) ; if ( prefix != 0 ) { buf = xmlStrcat ( buf , BAD_CAST ":" ) ; buf = xmlStrcat ( buf , prefix ) ; } p -> prefix = buf ; p -> uri = xmlStrdup ( namespaceURI ) ; if ( p -> uri == 0 ) { xmlWriterErrMsg ( writer , XML_ERR_NO_MEMORY , "xmlTextWriterStartElementNS : out of memory!\n" ) ; xmlFree ( p ) ; return - 1 ; } p -> elem = xmlListFront ( writer -> nodes , NULL ) ; xmlListPushFront ( writer -> nsstack , p ) ; } return sum ; } 