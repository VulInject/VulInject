static size_t rk_iommu_unmap_iova ( struct rk_iommu_domain * rk_domain , u32 * pte_addr , dma_addr_t pte_dma , size_t size ) { unsigned int pte_count ; unsigned int pte_total = size / SPAGE_SIZE ; assert_spin_locked ( & rk_domain -> dt_lock ) ; for ( pte_count = 0 ; pte_count < pte_total ; pte_count ++ ) { u32 pte = pte_addr [ pte_count ] ; if ( ! rk_pte_is_page_valid ( pte ) ) { break ; } pte_addr [ pte_count ] = rk_mk_pte_invalid ( pte , NULL ) ; } rk_table_flush ( rk_domain , pte_dma , pte_count ) ; return pte_count * SPAGE_SIZE ; } 