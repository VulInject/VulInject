static int enetc_probe ( struct udevice * dev ) { struct enetc_priv * priv = dev_get_priv ( dev ) ; int res ; if ( ofnode_valid ( dev_ofnode ( dev ) ) && ! ofnode_is_enabled ( dev_ofnode ( dev ) ) ) { enetc_dbg ( dev , "interface disabled\n" ) ; return - ENODEV ; } priv -> enetc_txbd = memalign ( ENETC_BD_ALIGN , sizeof ( enetc_tx_bd ) * ENETC_BD_CNT ) ; priv -> enetc_rxbd = memalign ( ENETC_BD_ALIGN , sizeof ( enetc_rx_bd ) * ENETC_BD_CNT ) ; if ( ! priv -> enetc_txbd || ! priv -> enetc_rxbd ) { free ( priv -> enetc_rxbd ) ; return - ENOMEM ; } priv -> regs_base = dm_pci_map_bar ( dev , PCI_BASE_ADDRESS_0 , 0 , 0 , PCI_REGION_TYPE , 0 ) ; if ( ! priv -> regs_base ) { enetc_dbg ( dev , "failed to map BAR0\n" ) ; return - EINVAL ; } priv -> port_regs = priv -> regs_base + ENETC_PORT_REGS_OFF ; dm_pci_clrset_config16 ( dev , PCI_COMMAND , 0 , PCI_COMMAND_MEMORY ) ; enetc_start_pcs ( dev ) ; res = enetc_config_phy ( dev ) ; if ( res ) { enetc_remove ( dev ) ; } return res ; } 