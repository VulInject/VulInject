static umode_t nvdimm_visible ( struct kobject * kobj , struct attribute * a , int n ) { struct device * dev = container_of ( kobj , typeof ( * dev ) , kobj ) ; struct nvdimm * nvdimm = to_nvdimm ( dev ) ; if ( a != & dev_attr_security . attr && a != & dev_attr_frozen . attr ) { return a -> mode ; } if ( a == & dev_attr_security . attr ) { if ( nvdimm -> sec . ops -> freeze || nvdimm -> sec . ops -> disable || nvdimm -> sec . ops -> change_key || nvdimm -> sec . ops -> erase || nvdimm -> sec . ops -> overwrite ) { return a -> mode ; } return 0444 ; } if ( nvdimm -> sec . ops -> freeze ) { return a -> mode ; } return 0 ; } 