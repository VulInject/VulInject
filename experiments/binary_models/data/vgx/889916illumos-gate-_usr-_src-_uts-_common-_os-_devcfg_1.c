static dev_info_t * find_sibling ( dev_info_t * head , char * cname , char * caddr , uint_t flag , int * callback ( dev_info_t * , char * , int ) ) { dev_info_t * dip ; char * addr , * buf ; major_t major ; uint_t by ; by = flag & ( FIND_NODE_BY_DRIVER | FIND_NODE_BY_NODENAME | FIND_NODE_BY_ADDR ) ; ASSERT ( by && BIT_ONLYONESET ( by ) ) ; ASSERT ( ( ( flag & FIND_ADDR_BY_INIT ) == 0 ) || ( ( flag & FIND_ADDR_BY_CALLBACK ) == 0 ) ) ; if ( by == FIND_NODE_BY_DRIVER ) { major = ddi_name_to_major ( cname ) ; if ( major == DDI_MAJOR_T_NONE ) { return ( NULL ) ; } } if ( flag & FIND_ADDR_BY_CALLBACK ) { buf = kmem_alloc ( MAXNAMELEN , KM_SLEEP ) ; } if ( head == NULL ) { return ( NULL ) ; } ASSERT ( DEVI_BUSY_OWNED ( ddi_get_parent ( head ) ) ) ; for ( dip = head ; dip ; dip = ddi_get_next_sibling ( dip ) ) { if ( by == FIND_NODE_BY_NODENAME ) { if ( strcmp ( cname , DEVI ( dip ) -> devi_node_name ) != 0 ) { continue ; } } if ( by == FIND_NODE_BY_DRIVER ) { if ( DEVI ( dip ) -> devi_major != major ) { continue ; } } if ( ( addr = DEVI ( dip ) -> devi_addr ) == NULL ) { if ( flag & FIND_ADDR_BY_INIT ) { if ( ddi_initchild ( ddi_get_parent ( dip ) , dip ) != DDI_SUCCESS ) { continue ; } addr = DEVI ( dip ) -> devi_addr ; } if ( flag & FIND_ADDR_BY_CALLBACK ) { if ( ( callback == NULL ) || ( callback ( dip , buf , MAXNAMELEN ) != DDI_SUCCESS ) ) { continue ; } addr = buf ; } else { continue ; } } ASSERT ( addr != NULL ) ; if ( strcmp ( caddr , addr ) == 0 ) { break ; } } if ( flag & FIND_ADDR_BY_CALLBACK ) { kmem_free ( buf , MAXNAMELEN ) ; } return ( dip ) ; } 