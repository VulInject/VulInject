int drm_debugfs_create_files ( const struct drm_info_list * files , int count , struct dentry * root , struct drm_minor * minor ) { struct drm_device * dev = minor -> dev ; struct dentry * ent ; struct drm_info_node * tmp ; int i , ret ; for ( i = 0 ; i < count ; i ++ ) { u32 features = files [ i ] . driver_features ; if ( features != 0 && ( dev -> driver -> driver_features & features ) != features ) { continue ; } tmp = kmalloc ( sizeof ( drm_info_node ) , GFP_KERNEL ) ; if ( tmp == NULL ) { ret = - 1 ; fail } ent = debugfs_create_file ( files [ i ] . name , S_IFREG | S_IRUGO , root , tmp , & drm_debugfs_fops ) ; if ( ! ent ) { DRM_ERROR ( "Cannot create /sys/kernel/debug/dri/%pd/%s\n" , root , files [ i ] . name ) ; ret = - 1 ; fail } tmp -> minor = minor ; tmp -> dent = ent ; tmp -> info_ent = & files [ i ] ; mutex_lock ( & minor -> debugfs_lock ) ; list_add ( & tmp -> list , & minor -> debugfs_list ) ; mutex_unlock ( & minor -> debugfs_lock ) ; } return 0 ; fail drm_debugfs_remove_files ( files , count , minor ) ; return ret ; } 