static MonoString * sr_mono_pv_gets ( MonoString * pv ) { str pvn = { 0 } ; pv_spec_t * pvs ; pv_value_t val ; sr_mono_env_t * env_M ; int pl ; env_M = sr_mono_env_get ( ) ; pvn . s = mono_string_to_utf8 ( pv ) ; if ( pvn . s == NULL || env_M -> msg == NULL ) { error } pvn . len = strlen ( pvn . s ) ; LM_DBG ( "pv get: %s\n" , pvn . s ) ; pl = pv_locate_name ( & pvn ) ; if ( pl != pvn . len ) { LM_ERR ( "invalid pv [%s] (%d/%d)\n" , pvn . s , pl , pvn . len ) ; error } pvs = pv_cache_get ( & pvn ) ; if ( pvs == NULL ) { LM_ERR ( "cannot get pv spec for [%s]\n" , pvn . s ) ; error } if ( pv_get_spec_value ( env_M -> msg , pvs , & val ) != 0 ) { LM_ERR ( "unable to get pv value for [%s]\n" , pvn . s ) ; error } if ( ( val . flags & PV_VAL_NULL ) || ! ( val . flags & PV_VAL_STR ) ) { mono_free ( pvn . s ) ; return NULL ; } mono_free ( pvn . s ) ; return mono_string_new_len ( mono_domain_get ( ) , val . rs . s , val . rs . len ) ; error if ( pvn . s != NULL ) { mono_free ( pvn . s ) ; } return NULL ; } 