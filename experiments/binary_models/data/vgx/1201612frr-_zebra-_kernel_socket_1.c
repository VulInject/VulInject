void kernel_update_multi ( struct dplane_ctx_list_head * ctx_list ) { struct zebra_dplane_ctx * ctx ; struct dplane_ctx_list_head handled_list ; enum zebra_dplane_result res = ZEBRA_DPLANE_REQUEST_SUCCESS ; dplane_ctx_q_init ( & handled_list ) ; while ( true ) { ctx = dplane_ctx_dequeue ( ctx_list ) ; if ( ctx == NULL ) { break ; } if ( dplane_ctx_is_skip_kernel ( ctx ) ) { res = ZEBRA_DPLANE_REQUEST_SUCCESS ; skip_one } switch ( dplane_ctx_get_op ( ctx ) ) { case DPLANE_OP_ROUTE_INSTALL : case DPLANE_OP_ROUTE_UPDATE : case DPLANE_OP_ROUTE_DELETE : res = kernel_route_update ( ctx ) ; break ; case DPLANE_OP_NH_INSTALL : case DPLANE_OP_NH_UPDATE : case DPLANE_OP_NH_DELETE : res = kernel_nexthop_update ( ctx ) ; break ; case DPLANE_OP_LSP_INSTALL : case DPLANE_OP_LSP_UPDATE : case DPLANE_OP_LSP_DELETE : res = kernel_lsp_update ( ctx , NULL ) ; break ; case DPLANE_OP_PW_INSTALL : case DPLANE_OP_PW_UNINSTALL : res = kernel_pw_update ( ctx ) ; break ; case DPLANE_OP_ADDR_INSTALL : case DPLANE_OP_ADDR_UNINSTALL : res = kernel_address_update_ctx ( ctx ) ; break ; case DPLANE_OP_MAC_INSTALL : case DPLANE_OP_MAC_DELETE : res = kernel_mac_update_ctx ( ctx ) ; break ; case DPLANE_OP_NEIGH_INSTALL : case DPLANE_OP_NEIGH_UPDATE : case DPLANE_OP_NEIGH_DELETE : case DPLANE_OP_VTEP_ADD : case DPLANE_OP_VTEP_DELETE : case DPLANE_OP_NEIGH_DISCOVER : res = kernel_neigh_update_ctx ( ctx ) ; break ; case DPLANE_OP_RULE_ADD : case DPLANE_OP_RULE_DELETE : case DPLANE_OP_RULE_UPDATE : res = kernel_pbr_rule_update ( ctx ) ; break ; case DPLANE_OP_INTF_INSTALL : case DPLANE_OP_INTF_UPDATE : case DPLANE_OP_INTF_DELETE : res = kernel_intf_update ( ctx ) ; break ; case DPLANE_OP_TC_QDISC_INSTALL : case DPLANE_OP_TC_QDISC_UNINSTALL : case DPLANE_OP_TC_CLASS_ADD : case DPLANE_OP_TC_CLASS_DELETE : case DPLANE_OP_TC_CLASS_UPDATE : case DPLANE_OP_TC_FILTER_ADD : case DPLANE_OP_TC_FILTER_DELETE : case DPLANE_OP_TC_FILTER_UPDATE : res = kernel_tc_update ( ctx ) ; break ; case DPLANE_OP_SYS_ROUTE_ADD : case DPLANE_OP_SYS_ROUTE_DELETE : case DPLANE_OP_ROUTE_NOTIFY : case DPLANE_OP_LSP_NOTIFY : res = ZEBRA_DPLANE_REQUEST_SUCCESS ; break ; case DPLANE_OP_INTF_NETCONFIG : res = kernel_intf_netconf_update ( ctx ) ; break ; case DPLANE_OP_NONE : case DPLANE_OP_BR_PORT_UPDATE : case DPLANE_OP_IPTABLE_ADD : case DPLANE_OP_IPTABLE_DELETE : case DPLANE_OP_IPSET_ADD : case DPLANE_OP_IPSET_DELETE : case DPLANE_OP_IPSET_ENTRY_ADD : case DPLANE_OP_IPSET_ENTRY_DELETE : case DPLANE_OP_NEIGH_IP_INSTALL : case DPLANE_OP_NEIGH_IP_DELETE : case DPLANE_OP_NEIGH_TABLE_UPDATE : case DPLANE_OP_GRE_SET : case DPLANE_OP_INTF_ADDR_ADD : case DPLANE_OP_INTF_ADDR_DEL : zlog_err ( "Unhandled dplane data for %s" , dplane_op2str ( dplane_ctx_get_op ( ctx ) ) ) ; res = ZEBRA_DPLANE_REQUEST_FAILURE ; } skip_one dplane_ctx_set_status ( ctx , res ) ; dplane_ctx_enqueue_tail ( & handled_list , ctx ) ; } dplane_ctx_q_init ( ctx_list ) ; dplane_ctx_list_append ( ctx_list , & handled_list ) ; } 