static int copy_core_reg_indices ( const struct kvm_vcpu * vcpu , u64 __user * uindices ) { unsigned int i ; int n = 0 ; for ( i = 0 ; i < sizeof ( kvm_regs ) / sizeof ( __u32 ) ; i ++ ) { u64 reg = KVM_REG_ARM64 | KVM_REG_ARM_CORE | i ; int size = core_reg_size_from_offset ( vcpu , i ) ; switch ( size ) { case sizeof ( __u32 ) : reg |= KVM_REG_SIZE_U32 ; break ; case sizeof ( __u64 ) : reg |= KVM_REG_SIZE_U64 ; break ; case sizeof ( __uint128_t ) : reg |= KVM_REG_SIZE_U128 ; break ; default : WARN_ON ( 1 ) ; continue ; } if ( uindices ) { if ( put_user ( reg , uindices ) ) { return - EFAULT ; } uindices ++ ; } n ++ ; } return n ; } 