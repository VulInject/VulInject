int adv7533_attach_dsi ( struct adv7511 * adv ) { struct device * dev = & adv -> i2c_main -> dev ; struct mipi_dsi_host * host ; struct mipi_dsi_device * dsi ; int ret ; const struct mipi_dsi_device_info info = { . type = "adv7533" . channel = 0 . node = NULL } ; host = of_find_mipi_dsi_host_by_node ( adv -> host_node ) ; if ( ! host ) { return dev_err_probe ( dev , - EPROBE_DEFER , "failed to find dsi host\n" ) ; } dsi = devm_mipi_dsi_device_register_full ( dev , host , & info ) ; if ( IS_ERR ( dsi ) ) { return dev_err_probe ( dev , PTR_ERR ( dsi ) , "failed to create dsi device\n" ) ; } adv -> dsi = dsi ; dsi -> lanes = adv -> num_dsi_lanes ; dsi -> format = MIPI_DSI_FMT_RGB888 ; dsi -> mode_flags = MIPI_DSI_MODE_VIDEO | MIPI_DSI_MODE_VIDEO_SYNC_PULSE | MIPI_DSI_MODE_NO_EOT_PACKET | MIPI_DSI_MODE_VIDEO_HSE ; ret = devm_mipi_dsi_attach ( dev , dsi ) ; if ( ret < 0 ) { return dev_err_probe ( dev , ret , "failed to attach dsi to host\n" ) ; } return 0 ; } 