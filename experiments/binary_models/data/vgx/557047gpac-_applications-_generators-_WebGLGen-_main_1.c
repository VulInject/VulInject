static void put_arg_get ( FILE * ifce_c , char * fname , int idx , char * arg_type , char * arg_name ) { int is_array ; const char * native_type = get_arg_type ( arg_type , & is_array ) ; if ( ! native_type ) { return ; } if ( ! strcmp ( native_type , "Bool" ) ) { fprintf ( ifce_c , "\tWGL_GET_BOOL(%s, argv[%d]);\n" , arg_name , idx ) ; } if ( ! strcmp ( native_type , "s32" ) ) { fprintf ( ifce_c , "\tWGL_GET_S32(%s, argv[%d]);\n" , arg_name , idx ) ; } if ( ! strcmp ( native_type , "u32" ) ) { fprintf ( ifce_c , "\tWGL_GET_U32(%s, argv[%d]);\n" , arg_name , idx ) ; } if ( ! strcmp ( native_type , "u64" ) ) { fprintf ( ifce_c , "\tWGL_GET_U64(%s, argv[%d]);\n" , arg_name , idx ) ; } if ( ! strcmp ( native_type , "s64" ) ) { fprintf ( ifce_c , "\tWGL_GET_S64(%s, argv[%d]);\n" , arg_name , idx ) ; } if ( ! strcmp ( native_type , "s16" ) ) { fprintf ( ifce_c , "\tWGL_GET_S16(%s, argv[%d]);\n" , arg_name , idx ) ; } if ( ! strcmp ( native_type , "u16" ) ) { fprintf ( ifce_c , "\tWGL_GET_U16(%s, argv[%d]);\n" , arg_name , idx ) ; } if ( ! strcmp ( arg_type , "GLclampf" ) ) { fprintf ( ifce_c , "\tWGL_GET_FLOAT_CLAMP(%s, argv[%d]);\n" , arg_name , idx ) ; } if ( ! strcmp ( native_type , "Float" ) ) { fprintf ( ifce_c , "\tWGL_GET_FLOAT(%s, argv[%d]);\n" , arg_name , idx ) ; } if ( ! strcmp ( native_type , "const char *" ) ) { fprintf ( ifce_c , "\tWGL_GET_STRING(%s, argv[%d]);\n" , arg_name , idx ) ; } if ( ! strcmp ( native_type , "WebGLProgram" ) || ! strcmp ( native_type , "WebGLShader" ) || ! strcmp ( native_type , "WebGLBuffer" ) || ! strcmp ( native_type , "WebGLFramebuffer" ) || ! strcmp ( native_type , "WebGLRenderbuffer" ) || ! strcmp ( native_type , "WebGLTexture" ) || ! strcmp ( native_type , "WebGLUniformLocation" ) ) { fprintf ( ifce_c , "\tWGL_GET_GLID(%s, argv[%d], %s_class_id);\n" , arg_name , idx , native_type ) ; } if ( ! strcmp ( arg_type , "BufferDataSource?" ) ) { fprintf ( ifce_c , "\tif(!JS_IsObject(argv[%d])) {\n" , idx ) ; fprintf ( ifce_c , "\t\tWGL_GET_U32(%s_size, argv[%d]);\n" , arg_name , idx ) ; fprintf ( ifce_c , "\t} else {\n" ) ; fprintf ( ifce_c , "\t\t%s = wgl_GetArrayBuffer(ctx,&%s_size, argv[%d]);\n" , arg_name , arg_name , idx ) ; fprintf ( ifce_c , "\t}\n" ) ; } if ( is_array && ! strcmp ( native_type , "u8 *" ) ) { fprintf ( ifce_c , "\tif(!JS_IsArray(ctx, argv[%d])) return js_throw_err(ctx, WGL_INVALID_VALUE);\n" , idx ) ; fprintf ( ifce_c , "\t%s = wgl_GetArrayBuffer(ctx,&%s_size, argv[%d]);\n" , arg_name , arg_name , idx ) ; } if ( is_array && ( ! strcmp ( native_type , "Float *" ) || ! strcmp ( native_type , "s32 *" ) ) ) { u32 vlen = 1 ; if ( strstr ( fname , "2fv" ) ) { vlen = 2 ; } if ( strstr ( fname , "3fv" ) ) { vlen = 3 ; } if ( strstr ( fname , "4fv" ) ) { vlen = 4 ; } if ( ! strcmp ( native_type , "s32 *" ) ) { fprintf ( ifce_c , "\tif (!WGL_LOAD_INT32_VEC(ctx, argv[%d], (s32 **)&%s,&%s_size, %d)) return js_throw_err(ctx, WGL_INVALID_VALUE);\n" , idx , arg_name , arg_name , vlen ) ; } else { Bool is_matrix = GF_FALSE ; if ( strstr ( fname , "Matrix" ) ) { is_matrix = GF_TRUE ; } if ( strstr ( fname , "vertexAttrib" ) ) { fprintf ( ifce_c , "\tif (!WGL_LOAD_FLOAT_VEC(ctx, argv[%d], (Float **)&%s, NULL, %d, %d)) return js_throw_err(ctx, WGL_INVALID_VALUE);\n" , idx , arg_name , vlen , is_matrix ) ; } else { fprintf ( ifce_c , "\tif (!WGL_LOAD_FLOAT_VEC(ctx, argv[%d], (Float **)&%s,&%s_size, %d, %d)) return js_throw_err(ctx, WGL_INVALID_VALUE);\n" , idx , arg_name , arg_name , vlen , is_matrix ) ; } } } else { fprintf ( stderr , "arg type %s not supported\n" , arg_type ) ; } } 