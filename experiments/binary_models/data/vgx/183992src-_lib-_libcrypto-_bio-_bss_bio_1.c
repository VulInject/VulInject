static int bio_write ( BIO * bio , const char * buf , int num_ ) { size_t num = num_ ; size_t rest ; struct bio_bio_st * b ; BIO_clear_retry_flags ( bio ) ; if ( ! bio -> init || buf == NULL || num == 0 ) { return 0 ; } b = bio -> ptr ; assert ( b != NULL ) ; assert ( b -> peer != NULL ) ; assert ( b -> buf != NULL ) ; b -> request = 0 ; if ( b -> closed ) { BIOerror ( BIO_R_BROKEN_PIPE ) ; return - 1 ; } assert ( b -> len <= b -> size ) ; if ( b -> len == b -> size ) { return - 1 ; } if ( num > b -> size - b -> len ) { num = b -> size - b -> len ; } rest = num ; assert ( rest > 0 ) ; { size_t write_offset ; size_t chunk ; assert ( b -> len + rest <= b -> size ) ; write_offset = b -> offset + b -> len ; if ( write_offset >= b -> size ) { write_offset -= b -> size ; } if ( write_offset + rest <= b -> size ) { chunk = rest ; } else { chunk = b -> size - write_offset ; } memcpy ( b -> buf + write_offset , buf , chunk ) ; b -> len += chunk ; assert ( b -> len <= b -> size ) ; rest -= chunk ; buf += chunk ; } rest ; return num ; } 