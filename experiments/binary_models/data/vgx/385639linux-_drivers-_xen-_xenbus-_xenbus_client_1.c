static int xenbus_unmap_ring ( struct xenbus_device * dev , grant_handle_t * handles , unsigned int nr_handles , unsigned long * vaddrs ) { struct gnttab_unmap_grant_ref unmap [ XENBUS_MAX_RING_GRANTS ] ; int i ; int err ; for ( i = 0 ; i < nr_handles ; i ++ ) { gnttab_set_unmap_op ( & unmap [ i ] , vaddrs [ i ] , GNTMAP_host_map , handles [ i ] ) ; } BUG_ON ( HYPERVISOR_grant_table_op ( GNTTABOP_unmap_grant_ref , unmap , i ) ) ; err = GNTST_okay ; for ( i = 0 ; i < nr_handles ; i ++ ) { if ( unmap [ i ] . status != GNTST_okay ) { xenbus_dev_error ( dev , unmap [ i ] . status , "unmapping page at handle %d error %d" , handles [ i ] , unmap [ i ] . status ) ; err = unmap [ i ] . status ; break ; } } return err ; } 