static MagickBooleanType ReadDistributeCacheMetacontent ( SplayTreeInfo * registry , int file , const size_t session_key , ExceptionInfo * exception ) { const Quantum * p ; const unsigned char * metacontent ; Image * image ; MagickAddressType key = ( MagickAddressType ) session_key ; MagickOffsetType count ; MagickSizeType length ; RectangleInfo region ; unsigned char message [ MagickPathExtent ] , * q ; image = ( Image * ) GetValueFromSplayTree ( registry , ( const void * ) key ) ; length = sizeof ( region . width ) + sizeof ( region . height ) + sizeof ( region . x ) + sizeof ( region . y ) + sizeof ( length ) ; count = dpc_read ( file , length , message ) ; if ( count != ( MagickOffsetType ) length ) { return ( MagickFalse ) ; } q = message ; ( void ) memcpy ( & region . width , q , sizeof ( region . width ) ) ; q += sizeof ( region . width ) ; ( void ) memcpy ( & region . height , q , sizeof ( region . height ) ) ; q += sizeof ( region . height ) ; ( void ) memcpy ( & region . x , q , sizeof ( region . x ) ) ; q += sizeof ( region . x ) ; ( void ) memcpy ( & region . y , q , sizeof ( region . y ) ) ; q += sizeof ( region . y ) ; ( void ) memcpy ( & length , q , sizeof ( length ) ) ; q += sizeof ( length ) ; p = GetVirtualPixels ( image , region . x , region . y , region . width , region . height , exception ) ; if ( p == ( const Quantum * ) NULL ) { return ( MagickFalse ) ; } metacontent = ( const unsigned char * ) GetVirtualMetacontent ( image ) ; count = dpc_send ( file , length , metacontent ) ; if ( count != ( MagickOffsetType ) length ) { return ( MagickFalse ) ; } return ( MagickTrue ) ; } 