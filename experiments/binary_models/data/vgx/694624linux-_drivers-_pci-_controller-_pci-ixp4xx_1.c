static int ixp4xx_pci_read_config ( struct pci_bus * bus , unsigned int devfn , int where , int size , u32 * value ) { struct ixp4xx_pci * p = bus -> sysdata ; u32 n , addr , val , cmd ; u8 bus_num = bus -> number ; int ret ; * value = 0xffffffff ; n = where % 4 ; cmd = ixp4xx_byte_lane_enable_bits ( n , size ) ; addr = ixp4xx_config_addr ( bus_num , devfn , where ) ; cmd |= NP_CMD_CONFIGREAD ; dev_dbg ( p -> dev , "read_config from %d size %d dev %d:%d:%d address: %08x cmd: %08x\n" , where , size , bus_num , PCI_SLOT ( devfn ) , PCI_FUNC ( devfn ) , addr , cmd ) ; ret = ixp4xx_pci_read_indirect ( p , addr , cmd , & val ) ; if ( ret ) { return PCIBIOS_DEVICE_NOT_FOUND ; } val >>= ( 8 * n ) ; switch ( size ) { case 1 : val &= U8_MAX ; dev_dbg ( p -> dev , "%s read byte %02x\n" , __func__ , val ) ; break ; case 2 : val &= U16_MAX ; dev_dbg ( p -> dev , "%s read word %04x\n" , __func__ , val ) ; break ; case 4 : val &= U32_MAX ; dev_dbg ( p -> dev , "%s read long %08x\n" , __func__ , val ) ; break ; default : dev_err ( p -> dev , "%s illegal size\n" , __func__ ) ; return PCIBIOS_DEVICE_NOT_FOUND ; } * value = val ; return PCIBIOS_SUCCESSFUL ; } 