static int iio_device_add_event ( struct iio_dev * indio_dev , const struct iio_chan_spec * chan , unsigned int spec_index , enum iio_event_type type , enum iio_event_direction dir , enum iio_shared_by shared_by , const unsigned long * mask ) { struct iio_dev_opaque * iio_dev_opaque = to_iio_dev_opaque ( indio_dev ) ; ssize_t * show ( struct device * dev , struct device_attribute * attr , char * buf ) ssize_t * store ( struct device * dev , struct device_attribute * attr , const char * buf , size_t len ) unsigned int attrcount = 0 ; unsigned int i ; char * postfix ; int ret ; for_each_set_bit ( , , 8 ) { if ( i >= ARRAY_SIZE ( iio_ev_info_text ) ) { return - EINVAL ; } if ( dir != IIO_EV_DIR_NONE ) { postfix = kasprintf ( GFP_KERNEL , "%s_%s_%s" , iio_ev_type_text [ type ] , iio_ev_dir_text [ dir ] , iio_ev_info_text [ i ] ) ; } else { postfix = kasprintf ( GFP_KERNEL , "%s_%s" , iio_ev_type_text [ type ] , iio_ev_info_text [ i ] ) ; } if ( postfix == NULL ) { return - ENOMEM ; } if ( i == IIO_EV_INFO_ENABLE ) { show = iio_ev_state_show ; store = iio_ev_state_store ; } else { show = iio_ev_value_show ; store = iio_ev_value_store ; } ret = __iio_add_chan_devattr ( postfix , chan , show , store , ( i << 16 ) | spec_index , shared_by , & indio_dev -> dev , NULL , & iio_dev_opaque -> event_interface -> dev_attr_list ) ; if ( ( ret == - EBUSY ) && ( shared_by != IIO_SEPARATE ) ) { continue ; } if ( ret ) { return ret ; } attrcount ++ ; } return attrcount ; } 