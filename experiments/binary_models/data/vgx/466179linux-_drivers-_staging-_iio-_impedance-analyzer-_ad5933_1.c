static ssize_t ad5933_show_frequency ( struct device * dev , struct device_attribute * attr , char * buf ) { struct iio_dev * indio_dev = dev_to_iio_dev ( dev ) ; struct ad5933_state * st = iio_priv ( indio_dev ) ; struct iio_dev_attr * this_attr = to_iio_dev_attr ( attr ) ; int ret ; unsigned long long freqreg ; { __be32 d32 ; u8 d8 [ 4 ] ; } , dat ret = iio_device_claim_direct_mode ( indio_dev ) ; ret = ad5933_i2c_read ( st -> client , this_attr -> address , 3 , & dat . d8 [ 1 ] ) ; iio_device_release_direct_mode ( indio_dev ) ; if ( ret < 0 ) { return ret ; } freqreg = be32_to_cpu ( dat . d32 ) & 0xFFFFFF ; freqreg = ( u64 ) freqreg * ( u64 ) ( st -> mclk_hz / 4 ) ; do_div ( freqreg , BIT ( 27 ) ) ; return sprintf ( buf , "%d\n" , ( int ) freqreg ) ; } 