struct clk * pmc_register_main_osc ( struct pmc_data * pmc , const char * name , struct clk * parent , bool bypass ) { struct clk * clk = NULL ; clk = clk_alloc ( name , & pmc_main_osc_clk_ops , & parent , 1 ) ; if ( ! clk ) { panic ( ) ; } clk -> priv = pmc ; if ( bypass ) { io_clrsetbits32 ( pmc -> base + AT91_CKGR_MOR , MOR_KEY_MASK | AT91_PMC_OSCBYPASS , AT91_PMC_OSCBYPASS | AT91_PMC_KEY ) ; } if ( clk_register ( clk ) ) { return NULL ; } return clk ; } 