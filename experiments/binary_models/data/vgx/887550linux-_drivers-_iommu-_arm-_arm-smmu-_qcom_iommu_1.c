static int qcom_iommu_attach_dev ( struct iommu_domain * domain , struct device * dev ) { struct qcom_iommu_dev * qcom_iommu = to_iommu ( dev ) ; struct qcom_iommu_domain * qcom_domain = to_qcom_iommu_domain ( domain ) ; int ret ; if ( ! qcom_iommu ) { dev_err ( dev , "cannot attach to IOMMU, is it on the same bus?\n" ) ; return - ENXIO ; } pm_runtime_get_sync ( qcom_iommu -> dev , NULL ) ; ret = qcom_iommu_init_domain ( domain , qcom_iommu , dev ) ; pm_runtime_put_sync ( qcom_iommu -> dev ) ; if ( ret < 0 ) { return ret ; } if ( qcom_domain -> iommu != qcom_iommu ) { return - EINVAL ; } return 0 ; } 