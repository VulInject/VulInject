static ssize_t trigger_request_store ( struct device * dev , struct device_attribute * attr , const char * buf , size_t count ) { int rc ; char * name ; name = kstrndup ( buf , count , GFP_KERNEL ) ; pr_info ( "loading '%s'\n" , name ) ; mutex_lock ( & test_fw_mutex ) ; release_firmware ( test_firmware ) ; test_firmware = NULL ; rc = request_firmware ( & test_firmware , name , dev ) ; if ( rc ) { pr_info ( "load of '%s' failed: %d\n" , name , rc ) ; out } pr_info ( "loaded: %zu\n" , test_firmware -> size ) ; rc = count ; out mutex_unlock ( & test_fw_mutex ) ; kfree ( name ) ; return rc ; } 