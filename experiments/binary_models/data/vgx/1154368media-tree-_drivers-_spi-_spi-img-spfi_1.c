static int img_spfi_remove ( struct platform_device * pdev ) { struct spi_master * master = platform_get_drvdata ( pdev ) ; struct img_spfi * spfi = spi_master_get_devdata ( master ) ; if ( spfi -> tx_ch ) { dma_release_channel ( spfi -> tx_ch ) ; } if ( spfi -> rx_ch ) { dma_release_channel ( spfi -> rx_ch ) ; } pm_runtime_disable ( spfi -> dev ) ; if ( ! pm_runtime_status_suspended ( spfi -> dev ) ) { clk_disable_unprepare ( spfi -> spfi_clk , NULL ) ; clk_disable_unprepare ( spfi -> sys_clk ) ; } return 0 ; } 