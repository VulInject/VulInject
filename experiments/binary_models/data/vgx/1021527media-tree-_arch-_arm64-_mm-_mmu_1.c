static void __init map_mem ( pgd_t * pgd ) { phys_addr_t kernel_start = __pa_symbol ( _text ) ; phys_addr_t kernel_end = __pa_symbol ( __init_begin ) ; struct memblock_region * reg ; int flags = 0 ; if ( debug_pagealloc_enabled ( ) ) { flags = NO_BLOCK_MAPPINGS | NO_CONT_MAPPINGS ; } memblock_mark_nomap ( kernel_start , kernel_end - kernel_start ) ; if ( crashk_res . end ) { memblock_mark_nomap ( crashk_res . start , resource_size ( & crashk_res ) ) ; } for_each_memblock ( , ) { phys_addr_t start = reg -> base ; phys_addr_t end = start + reg -> size ; if ( start >= end ) { break ; } __map_memblock ( pgd , start , end , PAGE_KERNEL , flags ) ; } __map_memblock ( pgd , kernel_start , kernel_end , PAGE_KERNEL , NO_CONT_MAPPINGS ) ; memblock_clear_nomap ( kernel_start , kernel_end - kernel_start ) ; if ( crashk_res . end ) { __map_memblock ( pgd , crashk_res . start , crashk_res . end + 1 , PAGE_KERNEL , NO_BLOCK_MAPPINGS | NO_CONT_MAPPINGS ) ; memblock_clear_nomap ( crashk_res . start , resource_size ( & crashk_res ) ) ; } } 