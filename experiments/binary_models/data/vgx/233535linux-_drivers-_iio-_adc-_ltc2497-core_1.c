static int ltc2497core_read_raw ( struct iio_dev * indio_dev , struct iio_chan_spec const * chan , int * val , int * val2 , long mask ) { struct ltc2497core_driverdata * ddata = iio_priv ( indio_dev ) ; int ret ; switch ( mask ) { case IIO_CHAN_INFO_RAW : mutex_lock ( & ddata -> lock ) ; ret = ltc2497core_read ( ddata , chan -> address , val ) ; mutex_unlock ( & ddata -> lock ) ; return IIO_VAL_INT ; case IIO_CHAN_INFO_SCALE : ret = regulator_get_voltage ( ddata -> ref ) ; if ( ret < 0 ) { return ret ; } * val = ret / 1000 ; * val2 = ddata -> chip_info -> resolution + 1 ; return IIO_VAL_FRACTIONAL_LOG2 ; default : return - EINVAL ; } } 