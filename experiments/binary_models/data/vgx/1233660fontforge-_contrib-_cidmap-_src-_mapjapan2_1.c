if ( * buffer == '\0' ) { return ( - 1 ) ; } = strtol ( buffer , & end , 16 ) ; if ( * end == 'v' ) { val += VERTMARK ; ++ end ; } if ( * end == ',' ) { vals [ 0 ] = val ; i = 1 ; while ( * end == ',' && i < 9 ) { buffer = end + 1 ; vals [ i ] = strtol ( buffer , & end , 16 ) ; if ( * end == 'v' ) { vals [ i ] += VERTMARK ; ++ end ; } ++ i ; } vals [ i ] = 0 ; best = 0 ; val = - 1 ; for ( i = 0 ; vals [ i ] != 0 ; ++ i ) { if ( ucs2_score ( vals [ i ] ) > best ) { val = vals [ i ] ; best = ucs2_score ( vals [ i ] ) ; } } if ( mults != NULL ) { for ( i = j = 0 ; vals [ i ] != 0 ; ++ i ) { if ( vals [ i ] != val && ! ( vals [ i ] & VERTMARK ) ) { mults [ j ++ ] = vals [ i ] ; } } } if ( j > MULT_MAX ) { fprintf ( stderr , "Too many multiple values for %04x, need %d slots\n" , ( unsigned int ) ( val ) , j ) ; exit ( 1 ) ; } } return ( val ) ; 