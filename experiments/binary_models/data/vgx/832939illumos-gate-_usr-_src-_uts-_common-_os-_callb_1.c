void * callb_execute_class ( int class ) int code { callb_t * cp ; void * ret = NULL ; ASSERT ( class < NCBCLASS ) ; mutex_enter ( & ct -> ct_lock ) ; for ( cp = ct -> ct_first_cb [ class ] ; cp != NULL && ret == 0 ; cp = cp -> c_next ) { while ( cp -> c_flag & CALLB_EXECUTING ) { cv_wait ( & cp -> c_done_cv , & ct -> ct_lock ) ; } cp -> c_flag |= CALLB_EXECUTING ; printf ( "callb_execute: name=%s func=%p arg=%p\n" , cp -> c_name , ( void * ) cp -> c_func , ( void * ) cp -> c_arg ) ; mutex_exit ( & ct -> ct_lock ) ; if ( ! * cp -> c_func ( cp -> c_arg , code ) ) { ret = cp -> c_name ; } mutex_enter ( & ct -> ct_lock ) ; cp -> c_flag &= ~ CALLB_EXECUTING ; cv_broadcast ( & cp -> c_done_cv ) ; } mutex_exit ( & ct -> ct_lock ) ; return ( ret ) ; } ; 