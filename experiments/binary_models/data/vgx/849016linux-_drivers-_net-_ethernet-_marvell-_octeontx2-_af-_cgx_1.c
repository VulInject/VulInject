void cgx_lmac_promisc_config ( int cgx_id , int lmac_id , bool enable ) { struct cgx * cgx = cgx_get_pdata ( cgx_id ) ; struct lmac * lmac = lmac_pdata ( lmac_id , cgx ) ; u16 max_dmac = lmac -> mac_to_index_bmap . max ; struct mac_ops * mac_ops ; int index , i ; u64 cfg = 0 ; int id ; id = get_sequence_id_of_lmac ( cgx , lmac_id ) ; mac_ops = cgx -> mac_ops ; if ( enable ) { cfg = cgx_read ( cgx , lmac_id , CGXX_CMRX_RX_DMAC_CTL0 ) ; cfg &= ~ CGX_DMAC_CAM_ACCEPT ; cfg |= ( CGX_DMAC_BCAST_MODE | CGX_DMAC_MCAST_MODE ) ; cgx_write ( cgx , lmac_id , CGXX_CMRX_RX_DMAC_CTL0 , cfg ) ; for ( i = 0 ; i < max_dmac ; i ++ ) { index = id * max_dmac + i ; cfg = cgx_read ( cgx , 0 , ( CGXX_CMRX_RX_DMAC_CAM0 + index * 0x8 ) ) ; cfg &= ~ CGX_DMAC_CAM_ADDR_ENABLE ; cgx_write ( cgx , 0 , ( CGXX_CMRX_RX_DMAC_CAM0 + index * 0x8 ) , cfg ) ; } } else { cfg = cgx_read ( cgx , lmac_id , CGXX_CMRX_RX_DMAC_CTL0 ) ; cfg |= CGX_DMAC_CAM_ACCEPT | CGX_DMAC_MCAST_MODE ; cgx_write ( cgx , lmac_id , CGXX_CMRX_RX_DMAC_CTL0 , cfg ) ; for ( i = 0 ; i < max_dmac ; i ++ ) { index = id * max_dmac + i ; cfg = cgx_read ( cgx , 0 , ( CGXX_CMRX_RX_DMAC_CAM0 + index * 0x8 ) ) ; if ( ( cfg & CGX_RX_DMAC_ADR_MASK ) != 0 ) { cfg |= CGX_DMAC_CAM_ADDR_ENABLE ; cgx_write ( cgx , 0 , ( CGXX_CMRX_RX_DMAC_CAM0 + index * 0x8 ) , cfg ) ; } } } } 