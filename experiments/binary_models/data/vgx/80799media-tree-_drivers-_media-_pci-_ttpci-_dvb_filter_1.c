int found = 0 ; int c = 0 ; u8 frame = 0 ; int fr = 0 ; while ( ! found && c < count ) { u8 * b = mbuf + c ; if ( b [ 0 ] == 0x0b && b [ 1 ] == 0x77 ) { found = 1 ; } else { c ++ ; } } if ( pr ) { printk ( KERN_DEBUG "Audiostream: AC3" ) ; } ai -> off = c ; if ( c + 5 >= count ) { return - 1 ; } ai -> layer = 0 ; headr = mbuf + c + 2 ; frame = ( headr [ 2 ] & 0x3f ) ; ai -> bit_rate = ac3_bitrates [ frame >> 1 ] * 1000 ; if ( pr ) { printk ( KERN_CONT "  BRate: %d kb/s" , ( int ) ai -> bit_rate / 1000 ) ; } ai -> frequency = ( headr [ 2 ] & 0xc0 ) >> 6 ; fr = ( headr [ 2 ] & 0xc0 ) >> 6 ; ai -> frequency = freq [ fr ] * 100 ; if ( pr ) { printk ( KERN_CONT "  Freq: %d Hz\n" , ( int ) ai -> frequency ) ; } ai -> framesize = ac3_frames [ fr ] [ frame >> 1 ] ; if ( ( frame & 1 ) && ( fr == 1 ) ) { ai -> framesize ++ ; } ai -> framesize = ai -> framesize << 1 ; if ( pr ) { printk ( KERN_DEBUG "  Framesize %d\n" , ( int ) ai -> framesize ) ; } return 0 ; 