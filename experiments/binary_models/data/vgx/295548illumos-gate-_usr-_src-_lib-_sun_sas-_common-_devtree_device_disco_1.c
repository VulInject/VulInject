void fillDomainPortWWN ( struct sun_sas_port * port_ptr ) { const char ROUTINE [ ] "fillDomainPortWWN" ; ; struct sun_sas_port * disco_port_ptr ; struct phy_info * phy_ptr ; int domainPort = 0 ; struct ScsiEntryList * mapping_ptr ; for ( disco_port_ptr = port_ptr -> first_attached_port ; disco_port_ptr != NULL ; disco_port_ptr = disco_port_ptr -> next ) { if ( disco_port_ptr -> port_attributes . PortType == HBA_PORTTYPE_SASEXPANDER && wwnConversion ( disco_port_ptr -> port_attributes . PortSpecificAttribute . SASPort -> AttachedSASAddress . wwn ) == wwnConversion ( port_ptr -> port_attributes . PortSpecificAttribute . SASPort -> LocalSASAddress . wwn ) ) { ( void ) memcpy ( & domainPort , disco_port_ptr -> port_attributes . PortSpecificAttribute . SASPort -> LocalSASAddress . wwn , 8 ) ; break ; } } if ( domainPort == 0 ) { if ( port_ptr -> first_attached_port ) { if ( wwnConversion ( port_ptr -> port_attributes . PortSpecificAttribute . SASPort -> LocalSASAddress . wwn ) == wwnConversion ( port_ptr -> first_attached_port -> port_attributes . PortSpecificAttribute . SASPort -> AttachedSASAddress . wwn ) ) { ( void ) memcpy ( & domainPort , port_ptr -> first_attached_port -> port_attributes . PortSpecificAttribute . SASPort -> LocalSASAddress . wwn , 8 ) ; } else { log ( LOG_DEBUG , ROUTINE , "DomainPortWWN is not set. " "Device(s) are visible on the HBA port " "but there is no expander or directly " "attached port with matching upsteam " "attached SAS address for " "HBA port (Local SAS Address: %016llx)." , wwnConversion ( port_ptr -> port_attributes . PortSpecificAttribute . SASPort -> LocalSASAddress . wwn ) ) ; return ; } } else { log ( LOG_DEBUG , ROUTINE , "DomainPortWWN is not set.  No properly " "configured smp or directly attached port " "found on HBA port(Local SAS Address: %016llx)." , wwnConversion ( port_ptr -> port_attributes . PortSpecificAttribute . SASPort -> LocalSASAddress . wwn ) ) ; return ; } } for ( phy_ptr = port_ptr -> first_phy ; phy_ptr != NULL ; phy_ptr = phy_ptr -> next ) { ( void ) memcpy ( phy_ptr -> phy . domainPortWWN . wwn , & domainPort , 8 ) ; } for ( disco_port_ptr = port_ptr -> first_attached_port ; disco_port_ptr != NULL ; disco_port_ptr = disco_port_ptr -> next ) { for ( mapping_ptr = disco_port_ptr -> scsiInfo ; mapping_ptr != NULL ; mapping_ptr = mapping_ptr -> next ) { ( void ) memcpy ( mapping_ptr -> entry . PortLun . domainPortWWN . wwn , & domainPort , 8 ) ; } } } 