u64 get_leaf_frame_caller_aarch64 ( struct perf_sample * sample , struct thread * thread , int usr_idx ) { int ret ; struct entries entries = { } ; struct regs_dump old_regs = sample -> user_regs ; if ( ! ( sample -> user_regs . mask & SMPL_REG_MASK ( PERF_REG_ARM64_PC ) ) ) { sample -> user_regs . cache_mask |= SMPL_REG_MASK ( PERF_REG_ARM64_PC ) ; sample -> user_regs . cache_regs [ PERF_REG_ARM64_PC ] = sample -> callchain -> ips [ usr_idx + 1 ] ; } if ( ! ( sample -> user_regs . mask & SMPL_REG_MASK ( PERF_REG_ARM64_SP ) ) ) { sample -> user_regs . cache_mask |= SMPL_REG_MASK ( PERF_REG_ARM64_SP ) ; sample -> user_regs . cache_regs [ PERF_REG_ARM64_SP ] = 0 ; } ret = unwind__get_entries ( add_entry , & entries , thread , sample , 2 , true ) ; sample -> user_regs = old_regs ; if ( ret || entries . length != 2 ) { return ret ; } return callchain_param . order == ORDER_CALLER ?entries . stack [ 0 ] : entries . stack [ 1 ] ; } 