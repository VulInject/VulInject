void vuidm5p ( queue_t * const qp , mblk_t * mp ) { int r , code ; uchar_t * bufp ; bufp = mp -> b_rptr ; r = MBLKL ( mp ) ; for ( r -- ; r >= 0 ; r -- ) { code = * bufp ++ ; switch ( STATEP -> state ) { default : resync case LOGI_START : if ( ( code & LOGI_NOT_BMASK ) != LOGI_START_CODE ) { break ; } STATEP -> state = LOGI_BUTTON ; STATEP -> deltax = STATEP -> deltay = 0 ; STATEP -> buttons = ( ~ code ) & LOGI_BMASK ; break ; case LOGI_BUTTON : if ( ( code & LOGI_NOT_BMASK ) == LOGI_START_CODE ) { STATEP -> state = LOGI_START ; resync } STATEP -> deltax += ( signed char ) code ; STATEP -> state = LOGI_DELTA_X1 ; break ; case LOGI_DELTA_X1 : if ( ( code & LOGI_NOT_BMASK ) == LOGI_START_CODE ) { STATEP -> state = LOGI_START ; resync } STATEP -> deltay += ( signed char ) code ; STATEP -> state = LOGI_DELTA_Y1 ; break ; case LOGI_DELTA_Y1 : if ( ( code & LOGI_NOT_BMASK ) == LOGI_START_CODE ) { STATEP -> state = LOGI_START ; resync } STATEP -> deltax += ( signed char ) code ; STATEP -> state = LOGI_DELTA_X2 ; break ; case LOGI_DELTA_X2 : if ( ( code & LOGI_NOT_BMASK ) == LOGI_START_CODE ) { STATEP -> state = LOGI_START ; resync } STATEP -> deltay += ( signed char ) code ; STATEP -> state = LOGI_START ; if ( STATEP -> deltax ) { VUID_PUTNEXT ( qp , ( uchar_t ) LOC_X_DELTA , FE_PAIR_ABSOLUTE , ( uchar_t ) LOC_X_ABSOLUTE , STATEP -> deltax ) ; } if ( STATEP -> deltay ) { VUID_PUTNEXT ( qp , ( uchar_t ) LOC_Y_DELTA , FE_PAIR_ABSOLUTE , ( uchar_t ) LOC_Y_ABSOLUTE , STATEP -> deltay ) ; } STATEP -> deltax = STATEP -> deltay = 0 ; if ( STATEP -> buttons != STATEP -> oldbuttons ) { vuidm5p_sendButtonEvent ( qp , NULL ) ; STATEP -> oldbuttons = STATEP -> buttons ; } } } freemsg ( mp ) ; } 