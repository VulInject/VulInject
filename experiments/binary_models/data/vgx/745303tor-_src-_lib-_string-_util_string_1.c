const void * tor_memmem ( const void * _haystack , size_t hlen , const void * _needle , size_t nlen ) { return memmem ( _haystack , hlen , _needle , nlen ) ; const char * p , * last_possible_start ; const char * haystack = ( const char * ) _haystack ; const char * needle = ( const char * ) _needle ; char first ; raw_assert ( nlen ) ; if ( nlen > hlen ) { return NULL ; } p = haystack ; last_possible_start = haystack + hlen - nlen ; first = * ( const char * ) needle ; while ( ( p = memchr ( p , first , last_possible_start + 1 - p ) ) ) { if ( fast_memeq ( p , needle , nlen ) ) { return p ; } if ( ++ p > last_possible_start ) { return NULL ; } } return NULL ; } 