static int imx8ulp_clk_cgc1_init ( struct platform_device * pdev ) { struct device * dev = & pdev -> dev ; struct clk_hw_onecell_data * clk_data ; struct clk_hw * * clks ; void __iomem * base ; clk_data = devm_kzalloc ( dev , struct_size ( clk_data , hws , IMX8ULP_CLK_CGC1_END ) , GFP_KERNEL ) ; clk_data -> num = IMX8ULP_CLK_CGC1_END ; clks = clk_data -> hws ; clks [ IMX8ULP_CLK_DUMMY ] = imx_clk_hw_fixed ( "dummy" , 0 ) ; base = devm_platform_ioremap_resource ( pdev , 0 ) ; if ( WARN_ON ( IS_ERR ( base ) ) ) { return PTR_ERR ( base ) ; } clks [ IMX8ULP_CLK_SPLL2_PRE_SEL ] = imx_clk_hw_mux_flags ( "spll2_pre_sel" , base + 0x510 , 0 , 1 , pll_pre_sels , ARRAY_SIZE ( pll_pre_sels ) , CLK_SET_PARENT_GATE ) ; clks [ IMX8ULP_CLK_SPLL3_PRE_SEL ] = imx_clk_hw_mux_flags ( "spll3_pre_sel" , base + 0x610 , 0 , 1 , pll_pre_sels , ARRAY_SIZE ( pll_pre_sels ) , CLK_SET_PARENT_GATE ) ; clks [ IMX8ULP_CLK_SPLL2 ] = imx_clk_hw_pllv4 ( IMX_PLLV4_IMX8ULP , "spll2" , "spll2_pre_sel" , base + 0x500 ) ; clks [ IMX8ULP_CLK_SPLL3 ] = imx_clk_hw_pllv4 ( IMX_PLLV4_IMX8ULP , "spll3" , "spll3_pre_sel" , base + 0x600 ) ; clks [ IMX8ULP_CLK_SPLL3_VCODIV ] = imx_clk_hw_divider ( "spll3_vcodiv" , "spll3" , base + 0x604 , 0 , 6 ) ; clks [ IMX8ULP_CLK_SPLL3_PFD0 ] = imx_clk_hw_pfdv2 ( IMX_PFDV2_IMX8ULP , "spll3_pfd0" , "spll3_vcodiv" , base + 0x614 , 0 ) ; clks [ IMX8ULP_CLK_SPLL3_PFD1 ] = imx_clk_hw_pfdv2 ( IMX_PFDV2_IMX8ULP , "spll3_pfd1" , "spll3_vcodiv" , base + 0x614 , 1 ) ; clks [ IMX8ULP_CLK_SPLL3_PFD2 ] = imx_clk_hw_pfdv2 ( IMX_PFDV2_IMX8ULP , "spll3_pfd2" , "spll3_vcodiv" , base + 0x614 , 2 ) ; clks [ IMX8ULP_CLK_SPLL3_PFD3 ] = imx_clk_hw_pfdv2 ( IMX_PFDV2_IMX8ULP , "spll3_pfd3" , "spll3_vcodiv" , base + 0x614 , 3 ) ; clks [ IMX8ULP_CLK_SPLL3_PFD0_DIV1_GATE ] = imx_clk_hw_gate_dis ( "spll3_pfd0_div1_gate" , "spll3_pfd0" , base + 0x608 , 7 ) ; clks [ IMX8ULP_CLK_SPLL3_PFD0_DIV2_GATE ] = imx_clk_hw_gate_dis ( "spll3_pfd0_div2_gate" , "spll3_pfd0" , base + 0x608 , 15 ) ; clks [ IMX8ULP_CLK_SPLL3_PFD1_DIV1_GATE ] = imx_clk_hw_gate_dis ( "spll3_pfd1_div1_gate" , "spll3_pfd1" , base + 0x608 , 23 ) ; clks [ IMX8ULP_CLK_SPLL3_PFD1_DIV2_GATE ] = imx_clk_hw_gate_dis ( "spll3_pfd1_div2_gate" , "spll3_pfd1" , base + 0x608 , 31 ) ; clks [ IMX8ULP_CLK_SPLL3_PFD2_DIV1_GATE ] = imx_clk_hw_gate_dis ( "spll3_pfd2_div1_gate" , "spll3_pfd2" , base + 0x60c , 7 ) ; clks [ IMX8ULP_CLK_SPLL3_PFD2_DIV2_GATE ] = imx_clk_hw_gate_dis ( "spll3_pfd2_div2_gate" , "spll3_pfd2" , base + 0x60c , 15 ) ; clks [ IMX8ULP_CLK_SPLL3_PFD3_DIV1_GATE ] = imx_clk_hw_gate_dis ( "spll3_pfd3_div1_gate" , "spll3_pfd3" , base + 0x60c , 23 ) ; clks [ IMX8ULP_CLK_SPLL3_PFD3_DIV2_GATE ] = imx_clk_hw_gate_dis ( "spll3_pfd3_div2_gate" , "spll3_pfd3" , base + 0x60c , 31 ) ; clks [ IMX8ULP_CLK_SPLL3_PFD0_DIV1 ] = imx_clk_hw_divider ( "spll3_pfd0_div1" , "spll3_pfd0_div1_gate" , base + 0x608 , 0 , 6 ) ; clks [ IMX8ULP_CLK_SPLL3_PFD0_DIV2 ] = imx_clk_hw_divider ( "spll3_pfd0_div2" , "spll3_pfd0_div2_gate" , base + 0x608 , 8 , 6 ) ; clks [ IMX8ULP_CLK_SPLL3_PFD1_DIV1 ] = imx_clk_hw_divider ( "spll3_pfd1_div1" , "spll3_pfd1_div1_gate" , base + 0x608 , 16 , 6 ) ; clks [ IMX8ULP_CLK_SPLL3_PFD1_DIV2 ] = imx_clk_hw_divider ( "spll3_pfd1_div2" , "spll3_pfd1_div2_gate" , base + 0x608 , 24 , 6 ) ; clks [ IMX8ULP_CLK_SPLL3_PFD2_DIV1 ] = imx_clk_hw_divider ( "spll3_pfd2_div1" , "spll3_pfd2_div1_gate" , base + 0x60c , 0 , 6 ) ; clks [ IMX8ULP_CLK_SPLL3_PFD2_DIV2 ] = imx_clk_hw_divider ( "spll3_pfd2_div2" , "spll3_pfd2_div2_gate" , base + 0x60c , 8 , 6 ) ; clks [ IMX8ULP_CLK_SPLL3_PFD3_DIV1 ] = imx_clk_hw_divider ( "spll3_pfd3_div1" , "spll3_pfd3_div1_gate" , base + 0x60c , 16 , 6 ) ; clks [ IMX8ULP_CLK_SPLL3_PFD3_DIV2 ] = imx_clk_hw_divider ( "spll3_pfd3_div2" , "spll3_pfd3_div2_gate" , base + 0x60c , 24 , 6 ) ; clks [ IMX8ULP_CLK_A35_SEL ] = imx_clk_hw_mux2 ( "a35_sel" , base + 0x14 , 28 , 2 , a35_sels , ARRAY_SIZE ( a35_sels ) ) ; clks [ IMX8ULP_CLK_A35_DIV ] = imx_clk_hw_divider_flags ( "a35_div" , "a35_sel" , base + 0x14 , 21 , 6 , CLK_SET_RATE_PARENT | CLK_IS_CRITICAL ) ; clks [ IMX8ULP_CLK_NIC_SEL ] = imx_clk_hw_mux2 ( "nic_sel" , base + 0x34 , 28 , 2 , nic_sels , ARRAY_SIZE ( nic_sels ) ) ; clks [ IMX8ULP_CLK_NIC_AD_DIVPLAT ] = imx_clk_hw_divider_flags ( "nic_ad_divplat" , "nic_sel" , base + 0x34 , 21 , 6 , CLK_SET_RATE_PARENT | CLK_IS_CRITICAL ) ; clks [ IMX8ULP_CLK_NIC_PER_DIVPLAT ] = imx_clk_hw_divider_flags ( "nic_per_divplat" , "nic_ad_divplat" , base + 0x34 , 14 , 6 , CLK_SET_RATE_PARENT | CLK_IS_CRITICAL ) ; clks [ IMX8ULP_CLK_XBAR_AD_DIVPLAT ] = imx_clk_hw_divider_flags ( "xbar_ad_divplat" , "nic_ad_divplat" , base + 0x38 , 14 , 6 , CLK_SET_RATE_PARENT | CLK_IS_CRITICAL ) ; clks [ IMX8ULP_CLK_XBAR_DIVBUS ] = imx_clk_hw_divider_flags ( "xbar_divbus" , "nic_ad_divplat" , base + 0x38 , 7 , 6 , CLK_SET_RATE_PARENT | CLK_IS_CRITICAL ) ; clks [ IMX8ULP_CLK_XBAR_AD_SLOW ] = imx_clk_hw_divider_flags ( "xbar_ad_slow" , "nic_ad_divplat" , base + 0x38 , 0 , 6 , CLK_SET_RATE_PARENT | CLK_IS_CRITICAL ) ; clks [ IMX8ULP_CLK_SOSC_DIV1_GATE ] = imx_clk_hw_gate_dis ( "sosc_div1_gate" , "sosc" , base + 0x108 , 7 ) ; clks [ IMX8ULP_CLK_SOSC_DIV2_GATE ] = imx_clk_hw_gate_dis ( "sosc_div2_gate" , "sosc" , base + 0x108 , 15 ) ; clks [ IMX8ULP_CLK_SOSC_DIV3_GATE ] = imx_clk_hw_gate_dis ( "sosc_div3_gate" , "sosc" , base + 0x108 , 23 ) ; clks [ IMX8ULP_CLK_SOSC_DIV1 ] = imx_clk_hw_divider ( "sosc_div1" , "sosc_div1_gate" , base + 0x108 , 0 , 6 ) ; clks [ IMX8ULP_CLK_SOSC_DIV2 ] = imx_clk_hw_divider ( "sosc_div2" , "sosc_div2_gate" , base + 0x108 , 8 , 6 ) ; clks [ IMX8ULP_CLK_SOSC_DIV3 ] = imx_clk_hw_divider ( "sosc_div3" , "sosc_div3_gate" , base + 0x108 , 16 , 6 ) ; clks [ IMX8ULP_CLK_FROSC_DIV1_GATE ] = imx_clk_hw_gate_dis ( "frosc_div1_gate" , "frosc" , base + 0x208 , 7 ) ; clks [ IMX8ULP_CLK_FROSC_DIV2_GATE ] = imx_clk_hw_gate_dis ( "frosc_div2_gate" , "frosc" , base + 0x208 , 15 ) ; clks [ IMX8ULP_CLK_FROSC_DIV3_GATE ] = imx_clk_hw_gate_dis ( "frosc_div3_gate" , "frosc" , base + 0x208 , 23 ) ; clks [ IMX8ULP_CLK_FROSC_DIV1 ] = imx_clk_hw_divider ( "frosc_div1" , "frosc_div1_gate" , base + 0x208 , 0 , 6 ) ; clks [ IMX8ULP_CLK_FROSC_DIV2 ] = imx_clk_hw_divider ( "frosc_div2" , "frosc_div2_gate" , base + 0x208 , 8 , 6 ) ; clks [ IMX8ULP_CLK_FROSC_DIV3 ] = imx_clk_hw_divider ( "frosc_div3" , "frosc_div3_gate" , base + 0x208 , 16 , 6 ) ; clks [ IMX8ULP_CLK_AUD_CLK1 ] = imx_clk_hw_mux2 ( "aud_clk1" , base + 0x900 , 0 , 3 , aud_clk1_sels , ARRAY_SIZE ( aud_clk1_sels ) ) ; clks [ IMX8ULP_CLK_SAI4_SEL ] = imx_clk_hw_mux2 ( "sai4_sel" , base + 0x904 , 0 , 2 , sai45_sels , ARRAY_SIZE ( sai45_sels ) ) ; clks [ IMX8ULP_CLK_SAI5_SEL ] = imx_clk_hw_mux2 ( "sai5_sel" , base + 0x904 , 8 , 2 , sai45_sels , ARRAY_SIZE ( sai45_sels ) ) ; clks [ IMX8ULP_CLK_ENET_TS_SEL ] = imx_clk_hw_mux2 ( "enet_ts" , base + 0x700 , 24 , 3 , enet_ts_sels , ARRAY_SIZE ( enet_ts_sels ) ) ; imx_check_clk_hws ( clks , clk_data -> num ) ; return devm_of_clk_add_hw_provider ( dev , of_clk_hw_onecell_get , clk_data ) ; } 