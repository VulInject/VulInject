static void gpio_irq_handler ( struct irq_desc * desc ) { struct davinci_gpio_regs __iomem * g ; u32 mask = 0xffff ; int bank_num ; struct davinci_gpio_controller * d ; struct davinci_gpio_irq_data * irqdata ; irqdata = ( davinci_gpio_irq_data * ) irq_desc_get_handler_data ( desc ) ; bank_num = irqdata -> bank_num ; g = irqdata -> regs ; d = irqdata -> chip ; if ( ( bank_num % 2 ) == 1 ) { mask <<= 16 ; } chained_irq_enter ( irq_desc_get_chip ( desc ) , desc ) ; while ( 1 ) { u32 status ; int bit ; irq_hw_number_t hw_irq ; status = readl_relaxed ( & g -> intstat ) & mask ; writel_relaxed ( status , & g -> intstat ) ; while ( status ) { bit = __ffs ( status ) ; status &= ~ BIT ( bit ) ; hw_irq = ( bank_num / 2 ) * 32 + bit ; generic_handle_irq ( irq_find_mapping ( d -> irq_domain , hw_irq ) ) ; } } chained_irq_exit ( irq_desc_get_chip ( desc ) , desc ) ; } 