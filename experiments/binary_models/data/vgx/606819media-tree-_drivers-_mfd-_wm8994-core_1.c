static int wm8994_set_pdata_from_of ( struct wm8994 * wm8994 ) { struct device_node * np = wm8994 -> dev -> of_node ; struct wm8994_pdata * pdata = & wm8994 -> pdata ; int i ; if ( ! np ) { return 0 ; } if ( of_property_read_u32_array ( np , "wlf,gpio-cfg" , pdata -> gpio_defaults , ARRAY_SIZE ( pdata -> gpio_defaults ) ) >= 0 ) { for ( i = 0 ; i < ARRAY_SIZE ( pdata -> gpio_defaults ) ; i ++ ) { if ( wm8994 -> pdata . gpio_defaults [ i ] == 0 ) { pdata -> gpio_defaults [ i ] = WM8994_CONFIGURE_GPIO ; } } } of_property_read_u32_array ( np , "wlf,micbias-cfg" , pdata -> micbias , ARRAY_SIZE ( pdata -> micbias ) ) ; pdata -> lineout1_diff = true ; pdata -> lineout2_diff = true ; if ( of_find_property ( np , "wlf,lineout1-se" , NULL ) ) { pdata -> lineout1_diff = false ; } if ( of_find_property ( np , "wlf,lineout2-se" , NULL ) ) { pdata -> lineout2_diff = false ; } if ( of_find_property ( np , "wlf,lineout1-feedback" , NULL ) ) { pdata -> lineout1fb = true ; } if ( of_find_property ( np , "wlf,lineout2-feedback" , NULL ) ) { pdata -> lineout2fb = true ; } if ( of_find_property ( np , "wlf,ldoena-always-driven" , NULL ) ) { pdata -> lineout2fb = true ; } pdata -> ldo [ 0 ] . enable = of_get_named_gpio ( np , "wlf,ldo1ena" , 0 ) ; if ( pdata -> ldo [ 0 ] . enable < 0 ) { pdata -> ldo [ 0 ] . enable = 0 ; } pdata -> ldo [ 1 ] . enable = of_get_named_gpio ( np , "wlf,ldo2ena" , 0 ) ; if ( pdata -> ldo [ 1 ] . enable < 0 ) { pdata -> ldo [ 1 ] . enable = 0 ; } return 0 ; } 