static int qcom_mhi_qrtr_probe ( struct mhi_device * mhi_dev , const struct mhi_device_id * id ) { struct qrtr_mhi_dev * qdev ; int rc ; qdev = devm_kzalloc ( & mhi_dev -> dev , sizeof ( * qdev ) , GFP_KERNEL ) ; qdev -> mhi_dev = mhi_dev ; qdev -> dev = & mhi_dev -> dev ; qdev -> ep . xmit = qcom_mhi_qrtr_send ; dev_set_drvdata ( & mhi_dev -> dev , qdev ) ; rc = qrtr_endpoint_register ( & qdev -> ep , QRTR_EP_NID_AUTO ) ; if ( rc ) { return rc ; } rc = mhi_prepare_for_transfer_autoqueue ( mhi_dev ) ; if ( rc ) { qrtr_endpoint_unregister ( & qdev -> ep ) ; return rc ; } dev_dbg ( qdev -> dev , "Qualcomm MHI QRTR driver probed\n" ) ; return 0 ; } 