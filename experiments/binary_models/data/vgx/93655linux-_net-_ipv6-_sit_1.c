static void __net_exit sit_destroy_tunnels ( struct net * net , struct list_head * head ) { struct sit_net * sitn = net_generic ( net , sit_net_id ) ; struct net_device * dev , * aux ; int prio ; for_each_netdev_safe ( , , ) if ( dev -> rtnl_link_ops == & sit_link_ops ) { unregister_netdevice_queue ( dev , head ) ; } for ( prio = 0 ; prio < 4 ; prio ++ ) { int h ; for ( h = 0 ; h < ( prio ?IP6_SIT_HASH_SIZE : 1 ) ; h ++ ) { struct ip_tunnel * t ; t = rtnl_dereference ( sitn -> tunnels [ prio ] [ h ] , NULL ) ; while ( t ) { if ( ! net_eq ( dev_net ( t -> dev ) , net ) ) { unregister_netdevice_queue ( t -> dev , head ) ; } t = rtnl_dereference ( t -> next ) ; } } } } 