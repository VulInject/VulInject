static int imx_bus_target ( struct device * dev , unsigned long * freq , u32 flags ) { struct dev_pm_opp * new_opp ; int ret ; new_opp = devfreq_recommended_opp ( dev , freq , flags ) ; if ( IS_ERR ( new_opp ) ) { ret = PTR_ERR ( new_opp ) ; dev_err ( dev , "failed to get recommended opp: %d\n" , ret ) ; return ret ; } dev_pm_opp_put ( new_opp , NULL ) ; return dev_pm_opp_set_rate ( dev , * freq ) ; } 