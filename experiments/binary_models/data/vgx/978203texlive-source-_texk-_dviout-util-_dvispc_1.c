err fprintf ( stderr , "%s is not correct DVI file\n" , dvi -> file_name ) ; Exit ( 254 ) ; ( endofs = - 3L fseek ( dvi -> file_ptr , endofs , SEEK_END ) , ( code = read_byte ( dvi -> file_ptr ) ) != ID && code != IDP endofs -- ) { if ( code == EOF || code != END_DVI ) { err } } ; f_ptex = ( code == IDP ) ?1 : 0 ; fseek ( dvi -> file_ptr , endofs - 4L , SEEK_END ) ; dvi -> pt_post = ftell ( dvi -> file_ptr ) ; if ( ( top_add = dvi -> post = read_long ( dvi -> file_ptr ) ) <= 0 ) { err } fseek ( dvi -> file_ptr , dvi -> post - 4 , SEEK_SET ) ; if ( AdID == read_long ( dvi -> file_ptr ) ) { num_add = 1 ; } if ( ( code = read_byte ( dvi -> file_ptr ) ) != POST ) { err } if ( ( dvi -> last_bop = read_long ( dvi -> file_ptr ) ) <= 0 ) { err } fseek ( dvi -> file_ptr , dvi -> post - 20 , SEEK_SET ) ; if ( num_add ) { int i , j , size ; char * s ; bofn = read_long ( dvi -> file_ptr ) ; eofn = read_long ( dvi -> file_ptr ) ; num_add = last_add = read_long ( dvi -> file_ptr ) ; top_add = read_long ( dvi -> file_ptr ) ; fseek ( dvi -> file_ptr , dvi -> post - 20 - 8 * num_add , SEEK_SET ) ; for ( i = 0 ; i < num_add ; i ++ ) { pt_bod [ i ] = read_long ( dvi -> file_ptr ) ; lod [ i ] = read_long ( dvi -> file_ptr ) ; } fseek ( dvi -> file_ptr , bofn , SEEK_SET ) ; size = eofn - bofn ; s = malloc ( size ) ; for ( i = 0 ; i < size ; i ++ ) { s [ i ] = read_byte ( dvi -> file_ptr ) ; } pt_name [ 0 ] = s ; for ( i = j = 0 ; i < size ; ) { if ( ! s [ i ++ ] ) { pt_name [ ++ j ] = s + i ; } } } fseek ( dvi -> file_ptr , dvi -> post , SEEK_SET ) ; if ( ( uchar ) read_byte ( dvi -> file_ptr ) != POST ) { error ( "No Postamble" ) ; } if ( ( dvi -> last_bop = read_long ( dvi -> file_ptr ) ) <= 0 ) { error ( "Negative Pointer(Last BOP)" ) ; } dvi -> num = read_long ( dvi -> file_ptr , NULL ) ; dvi -> den = read_long ( dvi -> file_ptr ) ; dvi -> mag = read_long ( dvi -> file_ptr ) ; dvi -> l = read_long ( dvi -> file_ptr ) ; dvi -> u = read_long ( dvi -> file_ptr ) ; dvi -> stack_depth = read_short ( dvi -> file_ptr ) ; dvi -> total_page = read_short ( dvi -> file_ptr ) ; if ( dvi -> num <= 0 || dvi -> den <= 0 || dvi -> mag <= 0 ) { error ( "Reading Illegal Long" ) ; } if ( dvi -> stack_depth < 0 || dvi -> total_page <= 0 ) { error ( "Reading Illegal Integer" ) ; } 