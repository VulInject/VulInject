MODULE_LICENSE ( "GPL" ) ; MODULE_ALIAS ( "platform:pcspkr" ) ; static int pcspkr_event ( struct input_dev * dev , unsigned int type , unsigned int code , int value ) { unsigned int count = 0 ; cfs_time_t flags ; if ( type != EV_SND ) { return - EINVAL ; } switch ( code ) { case SND_BELL : if ( value ) { value = 1000 ; } break ; case SND_TONE : break ; default : return - EINVAL ; } if ( value > 20 && value < 32767 ) { count = PIT_TICK_RATE / value ; } raw_spin_lock_irqsave ( & i8253_lock , flags ) ; if ( count ) { outb_p ( 0xB6 , 0x43 ) ; outb_p ( count & 0xff , 0x42 ) ; outb ( ( count >> 8 ) & 0xff , 0x42 ) ; outb_p ( inb_p ( 0x61 ) | 3 , 0x61 ) ; } else { outb ( inb_p ( 0x61 ) & 0xFC , 0x61 ) ; } raw_spin_unlock_irqrestore ( & i8253_lock , flags ) ; return 0 ; } 