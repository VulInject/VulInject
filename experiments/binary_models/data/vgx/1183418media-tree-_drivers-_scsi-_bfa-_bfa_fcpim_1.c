void bfa_itnim_attach ( struct bfa_fcpim_s * fcpim ) { struct bfa_s * bfa = fcpim -> bfa ; struct bfa_fcp_mod_s * fcp = fcpim -> fcp ; struct bfa_itnim_s * itnim ; int i , j ; INIT_LIST_HEAD ( & fcpim -> itnim_q ) ; itnim = ( bfa_itnim_s * ) bfa_mem_kva_curp ( fcp ) ; fcpim -> itnim_arr = itnim ; for ( i = 0 ; i < fcpim -> num_itnims ; i ++ , itnim ++ ) { itnim -> bfa = bfa ; itnim -> fcpim = fcpim ; itnim -> reqq = BFA_REQQ_QOS_LO ; itnim -> rport = BFA_RPORT_FROM_TAG ( bfa , i ) ; itnim -> iotov_active = BFA_FALSE ; bfa_reqq_winit ( & itnim -> reqq_wait , bfa_itnim_qresume , itnim ) ; INIT_LIST_HEAD ( & itnim -> io_q ) ; INIT_LIST_HEAD ( & itnim -> io_cleanup_q ) ; INIT_LIST_HEAD ( & itnim -> pending_q ) ; INIT_LIST_HEAD ( & itnim -> tsk_q ) ; INIT_LIST_HEAD ( & itnim -> delay_comp_q ) ; for ( j = 0 ; j < BFA_IOBUCKET_MAX ; j ++ ) { itnim -> ioprofile . io_latency . min [ j ] = ~ 0 ; } bfa_sm_set_state ( itnim , bfa_itnim_sm_uninit ) ; } bfa_mem_kva_curp ( fcp ) = ( u8 * ) itnim ; } 