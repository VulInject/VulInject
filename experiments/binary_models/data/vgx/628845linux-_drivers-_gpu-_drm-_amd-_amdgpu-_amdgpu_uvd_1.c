MODULE_FIRMWARE ( FIRMWARE_VEGA10 ) ; MODULE_FIRMWARE ( FIRMWARE_VEGA12 ) ; MODULE_FIRMWARE ( FIRMWARE_VEGA20 ) ; static void amdgpu_uvd_idle_work_handler ( struct work_struct * work ) static void amdgpu_uvd_force_into_uvd_segment ( struct amdgpu_bo * abo ) static int amdgpu_uvd_create_msg_bo_helper ( struct amdgpu_device * adev , uint32_t size , struct amdgpu_bo * * bo_ptr ) { struct ttm_operation_ctx ctx = { true false } ; struct amdgpu_bo * bo = NULL ; void * addr ; int r ; r = amdgpu_bo_create_reserved ( adev , size , PAGE_SIZE , AMDGPU_GEM_DOMAIN_GTT , & bo , NULL , & addr ) ; if ( r ) { return r ; } if ( adev -> uvd . address_64_bit ) { succ } amdgpu_bo_kunmap ( bo , NULL ) ; amdgpu_bo_unpin ( bo ) ; amdgpu_bo_placement_from_domain ( bo , AMDGPU_GEM_DOMAIN_VRAM ) ; amdgpu_uvd_force_into_uvd_segment ( bo ) ; r = ttm_bo_validate ( & bo -> tbo , & bo -> placement , & ctx ) ; if ( r ) { err } r = amdgpu_bo_pin ( bo , AMDGPU_GEM_DOMAIN_VRAM ) ; if ( r ) { err_pin } r = amdgpu_bo_kmap ( bo , & addr ) ; if ( r ) { err_kmap } succ amdgpu_bo_unreserve ( bo ) ; * bo_ptr = bo ; return 0 ; err_kmap amdgpu_bo_unpin ( bo ) ; err_pin err amdgpu_bo_unreserve ( bo ) ; amdgpu_bo_unref ( & bo ) ; return r ; } 