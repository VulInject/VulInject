static ssize_t rproc_coredump_write ( struct file * filp , const char __user * user_buf , size_t count , loff_t * ppos ) { struct rproc * rproc = filp -> private_data ; int ret , err = 0 ; char buf [ 20 ] ; ret = copy_from_user ( buf , user_buf , count ) ; if ( ret ) { return - EFAULT ; } if ( buf [ count - 1 ] == '\n' ) { buf [ count - 1 ] = '\0' ; } if ( rproc -> state == RPROC_CRASHED ) { dev_err ( & rproc -> dev , "can't change coredump configuration\n" ) ; err = - EBUSY ; out } if ( ! strncmp ( buf , "disabled" , count ) ) { rproc -> dump_conf = RPROC_COREDUMP_DISABLED ; } if ( ! strncmp ( buf , "enabled" , count ) ) { rproc -> dump_conf = RPROC_COREDUMP_ENABLED ; } if ( ! strncmp ( buf , "inline" , count ) ) { rproc -> dump_conf = RPROC_COREDUMP_INLINE ; } else { dev_err ( & rproc -> dev , "Invalid coredump configuration\n" ) ; err = - EINVAL ; } out return err ?err : count ; } static const struct file_operations rproc_coredump_fops = { . read = rproc_coredump_read . write = rproc_coredump_write . open = simple_open . llseek = generic_file_llseek } ; 