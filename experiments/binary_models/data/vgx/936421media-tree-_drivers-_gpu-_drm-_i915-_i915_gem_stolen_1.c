struct drm_i915_gem_object * i915_gem_object_create_stolen ( struct drm_i915_private * dev_priv , u32 size ) { struct drm_i915_gem_object * obj ; struct drm_mm_node * stolen ; int ret ; if ( ! drm_mm_initialized ( & dev_priv -> mm . stolen ) ) { return NULL ; } if ( size == 0 ) { return in ; } stolen = kzalloc ( sizeof ( * stolen ) , GFP_KERNEL ) ; if ( ! stolen ) { return NULL ; } ret = i915_gem_stolen_insert_node ( dev_priv , stolen , size , 4096 ) ; if ( ret ) { kfree ( stolen ) ; return NULL ; } obj = _i915_gem_object_create_stolen ( dev_priv , stolen ) ; if ( obj ) { return obj ; } i915_gem_stolen_remove_node ( dev_priv , stolen ) ; kfree ( stolen ) ; return NULL ; } 