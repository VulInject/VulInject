static void ssb_pmu_resources_init ( struct ssb_chipcommon * cc ) { struct ssb_bus * bus = cc -> dev -> bus ; u32 min_msk = 0 , max_msk = 0 ; unsigned int i ; const struct pmu_res_updown_tab_entry * updown_tab = NULL ; int updown_tab_size = 0 ; const struct pmu_res_depend_tab_entry * depend_tab = NULL ; unsigned int depend_tab_size = 0 ; switch ( bus -> chip_id ) { case 0x4312 : min_msk = 0xCBB ; break ; case 0x4322 : case 43222 : break ; case 0x4325 : min_msk = ( 1 << SSB_PMURES_4325_CBUCK_BURST ) | ( 1 << SSB_PMURES_4325_LNLDO2_PU ) ; if ( chipco_read32 ( cc , SSB_CHIPCO_CHIPSTAT ) & SSB_CHIPCO_CHST_4325_PMUTOP_2B ) { min_msk |= ( 1 << SSB_PMURES_4325_CLDO_CBUCK_BURST ) ; } max_msk = 0xFFFFF ; updown_tab = pmu_res_updown_tab_4325a0 ; updown_tab_size = ARRAY_SIZE ( pmu_res_updown_tab_4325a0 ) ; depend_tab = pmu_res_depend_tab_4325a0 ; depend_tab_size = ARRAY_SIZE ( pmu_res_depend_tab_4325a0 ) ; break ; case 0x4328 : min_msk = ( 1 << SSB_PMURES_4328_EXT_SWITCHER_PWM ) | ( 1 << SSB_PMURES_4328_BB_SWITCHER_PWM ) | ( 1 << SSB_PMURES_4328_XTAL_EN ) ; max_msk = 0xFFFFF ; updown_tab = pmu_res_updown_tab_4328a0 ; updown_tab_size = ARRAY_SIZE ( pmu_res_updown_tab_4328a0 ) ; depend_tab = pmu_res_depend_tab_4328a0 ; depend_tab_size = ARRAY_SIZE ( pmu_res_depend_tab_4328a0 ) ; break ; case 0x5354 : max_msk = 0xFFFFF ; break ; default : ssb_err ( "ERROR: PMU resource config unknown for device %04X\n" , bus -> chip_id ) ; } if ( updown_tab ) { for ( i = 0 ; i < updown_tab_size ; i ++ ) { chipco_write32 ( cc , SSB_CHIPCO_PMU_RES_TABSEL , updown_tab [ i ] . resource ) ; chipco_write32 ( cc , SSB_CHIPCO_PMU_RES_UPDNTM , updown_tab [ i ] . updown ) ; } } if ( depend_tab ) { for ( i = 0 ; i < depend_tab_size ; i ++ ) { chipco_write32 ( cc , SSB_CHIPCO_PMU_RES_TABSEL , depend_tab [ i ] . resource ) ; switch ( depend_tab [ i ] . task ) { case PMU_RES_DEP_SET : chipco_write32 ( cc , SSB_CHIPCO_PMU_RES_DEPMSK , depend_tab [ i ] . depend ) ; break ; case PMU_RES_DEP_ADD : chipco_set32 ( cc , SSB_CHIPCO_PMU_RES_DEPMSK , depend_tab [ i ] . depend ) ; break ; case PMU_RES_DEP_REMOVE : chipco_mask32 ( cc , SSB_CHIPCO_PMU_RES_DEPMSK , ~ ( depend_tab [ i ] . depend ) ) ; break ; default : SSB_WARN_ON ( 1 ) ; } } } if ( min_msk ) { chipco_write32 ( cc , SSB_CHIPCO_PMU_MINRES_MSK , min_msk ) ; } if ( max_msk ) { chipco_write32 ( cc , SSB_CHIPCO_PMU_MAXRES_MSK , max_msk ) ; } } 