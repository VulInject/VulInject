const char * mtype_memstr ( char * buf , size_t len , unsigned long bytes ) { unsigned int m , k ; if ( ! bytes ) { return "0 bytes" ; } if ( bytes > 0x7fffffff ) { return ">2GB" ; } m = bytes >> 20 ; k = bytes >> 10 ; if ( m > 10 ) { if ( bytes & ( 1 << 19 ) ) { m ++ ; } snprintf ( buf , len , "%d MiB" , m ) ; } if ( k > 10 ) { if ( bytes & ( 1 << 9 ) ) { k ++ ; } snprintf ( buf , len , "%d KiB" , k ) ; } else { snprintf ( buf , len , "%ld bytes" , bytes ) ; } return buf ; } 