static int __init init_cxl ( void ) { int rc = 0 ; if ( ( rc = cxl_file_init ( ) ) ) { return rc ; } cxl_debugfs_init ( ) ; if ( cxl_is_power8 ( ) ) { rc = register_cxl_calls ( & cxl_calls ) ; if ( rc ) { err } } if ( cpu_has_feature ( CPU_FTR_HVMODE ) ) { cxl_ops = & cxl_native_ops ; rc = pci_register_driver ( & cxl_pci_driver ) ; } else { cxl_ops = & cxl_guest_ops ; rc = platform_driver_register ( & cxl_of_driver ) ; } if ( rc ) { err1 } return 0 ; err1 if ( cxl_is_power8 ( ) ) { unregister_cxl_calls ( & cxl_calls ) ; } err cxl_debugfs_exit ( ) ; cxl_file_exit ( ) ; return rc ; } 