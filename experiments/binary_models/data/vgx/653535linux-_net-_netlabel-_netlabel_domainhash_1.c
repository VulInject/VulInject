static int netlbl_domhsh_validate ( const struct netlbl_dom_map * entry ) { struct netlbl_af4list * iter4 ; struct netlbl_domaddr4_map * map4 ; struct netlbl_af6list * iter6 ; struct netlbl_domaddr6_map * map6 ; if ( entry == NULL ) { return - EINVAL ; } if ( entry -> family != AF_INET && entry -> family != AF_INET6 && ( entry -> family != AF_UNSPEC || entry -> def . type != NETLBL_NLTYPE_UNLABELED ) ) { return - EINVAL ; } switch ( entry -> def . type ) { case NETLBL_NLTYPE_UNLABELED : if ( entry -> def . cipso != NULL || entry -> def . calipso != NULL || entry -> def . addrsel != NULL ) { return - EINVAL ; } break ; case NETLBL_NLTYPE_CIPSOV4 : if ( entry -> family != AF_INET || entry -> def . cipso == NULL ) { return - EINVAL ; } break ; case NETLBL_NLTYPE_CALIPSO : if ( entry -> family != AF_INET6 || entry -> def . calipso == NULL ) { return - EINVAL ; } break ; case NETLBL_NLTYPE_ADDRSELECT : netlbl_af4list_foreach ( , ) { map4 = netlbl_domhsh_addr4_entry ( iter4 ) ; switch ( map4 -> def . type ) { case NETLBL_NLTYPE_UNLABELED : break ; case NETLBL_NLTYPE_CIPSOV4 : if ( map4 -> def . cipso == NULL ) { return - EINVAL ; } break ; default : return - EINVAL ; } } netlbl_af6list_foreach ( , ) { map6 = netlbl_domhsh_addr6_entry ( iter6 ) ; switch ( map6 -> def . type ) { case NETLBL_NLTYPE_UNLABELED : if ( map6 -> def . calipso != NULL ) { return - EINVAL ; } break ; case NETLBL_NLTYPE_CALIPSO : if ( map6 -> def . calipso == NULL ) { return - EINVAL ; } break ; default : return - EINVAL ; } } break ; default : return - EINVAL ; } return 0 ; } 