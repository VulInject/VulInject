static int rkvdec_vp9_run_preamble ( struct rkvdec_ctx * ctx , struct rkvdec_vp9_run * run ) { const struct v4l2_ctrl_vp9_frame * dec_params ; const struct v4l2_ctrl_vp9_compressed_hdr * prob_updates ; struct rkvdec_vp9_ctx * vp9_ctx = ctx -> priv ; struct v4l2_ctrl * ctrl ; unsigned int fctx_idx ; int ret ; rkvdec_run_preamble ( ctx , & run -> base ) ; ctrl = v4l2_ctrl_find ( & ctx -> ctrl_hdl , V4L2_CID_STATELESS_VP9_FRAME ) ; dec_params = ctrl -> p_cur . p ; ret = validate_dec_params ( ctx , dec_params ) ; if ( ret ) { return ret ; } run -> decode_params = dec_params ; ctrl = v4l2_ctrl_find ( & ctx -> ctrl_hdl , V4L2_CID_STATELESS_VP9_COMPRESSED_HDR ) ; if ( WARN_ON ( ! ctrl ) ) { return - EINVAL ; } prob_updates = ctrl -> p_cur . p ; vp9_ctx -> cur . tx_mode = prob_updates -> tx_mode ; fctx_idx = v4l2_vp9_reset_frame_ctx ( dec_params , vp9_ctx -> frame_context ) ; vp9_ctx -> cur . frame_context_idx = fctx_idx ; vp9_ctx -> probability_tables = vp9_ctx -> frame_context [ fctx_idx ] ; v4l2_vp9_fw_update_probs ( & vp9_ctx -> probability_tables , prob_updates , dec_params ) ; return 0 ; } 