int mISDN_ctrl_bchannel ( struct bchannel * bch , struct mISDN_ctrl_req * cq ) { int ret = 0 ; switch ( cq -> op ) { case MISDN_CTRL_GETOP : cq -> op = MISDN_CTRL_RX_BUFFER | MISDN_CTRL_FILL_EMPTY | MISDN_CTRL_RX_OFF ; break ; case MISDN_CTRL_FILL_EMPTY : if ( cq -> p1 ) { test_and_set_bit ( FLG_FILLEMPTY , & bch -> Flags ) ; } else { test_and_clear_bit ( FLG_FILLEMPTY , & bch -> Flags ) ; } break ; case MISDN_CTRL_RX_OFF : cq -> p2 = bch -> dropcnt ; if ( cq -> p1 ) { test_and_set_bit ( FLG_RX_OFF , & bch -> Flags ) ; } else { test_and_clear_bit ( FLG_RX_OFF , & bch -> Flags ) ; } bch -> dropcnt = 0 ; break ; case MISDN_CTRL_RX_BUFFER : if ( cq -> p2 > MISDN_CTRL_RX_SIZE_IGNORE ) { bch -> next_maxlen = cq -> p2 ; } if ( cq -> p1 > MISDN_CTRL_RX_SIZE_IGNORE ) { bch -> next_minlen = cq -> p1 ; } cq -> p1 = bch -> minlen ; cq -> p2 = bch -> maxlen ; break ; default : pr_info ( "mISDN unhandled control %x operation\n" , cq -> op ) ; ret = - EINVAL ; break ; } return ret ; } 