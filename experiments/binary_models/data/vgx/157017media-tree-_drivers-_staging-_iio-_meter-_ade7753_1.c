static int ade7753_initial_setup ( struct iio_dev * indio_dev ) { int ret ; struct device * dev = & indio_dev -> dev ; struct ade7753_state * st = iio_priv ( indio_dev ) ; st -> us -> mode = SPI_MODE_3 ; spi_setup ( st -> us ) ; ret = ade7753_set_irq ( dev , false ) ; if ( ret ) { dev_err ( dev , "disable irq failed" ) ; err_ret } ade7753_reset ( dev , NULL ) ; usleep_range ( ADE7753_STARTUP_DELAY , ADE7753_STARTUP_DELAY + 100 ) ; err_ret return ret ; } 