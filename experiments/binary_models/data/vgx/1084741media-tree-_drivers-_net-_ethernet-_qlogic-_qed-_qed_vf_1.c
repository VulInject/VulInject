int qed_vf_pf_rxq_start ( struct qed_hwfn * p_hwfn , struct qed_queue_cid * p_cid , u16 bd_max_bytes , dma_addr_t bd_chain_phys_addr , dma_addr_t cqe_pbl_addr , u16 cqe_pbl_size , void __iomem * * pp_prod ) { struct qed_vf_iov * p_iov = p_hwfn -> vf_iov_info ; struct pfvf_start_queue_resp_tlv * resp ; struct vfpf_start_rxq_tlv * req ; u8 rx_qid = p_cid -> rel . queue_id ; int rc ; req = qed_vf_pf_prep ( p_hwfn , CHANNEL_TLV_START_RXQ , sizeof ( * req ) ) ; req -> rx_qid = rx_qid ; req -> cqe_pbl_addr = cqe_pbl_addr ; req -> cqe_pbl_size = cqe_pbl_size ; req -> rxq_addr = bd_chain_phys_addr ; req -> hw_sb = p_cid -> rel . sb ; req -> sb_index = p_cid -> rel . sb_idx ; req -> bd_max_bytes = bd_max_bytes ; req -> stat_id = - 1 ; if ( p_iov -> b_pre_fp_hsi ) { u8 hw_qid = p_iov -> acquire_resp . resc . hw_qid [ rx_qid ] ; int init_prod_val = 0 ; * pp_prod = ( u8 __iomem * ) p_hwfn -> regview + MSTORM_QZONE_START ( p_hwfn -> cdev ) + hw_qid * MSTORM_QZONE_SIZE ; __internal_ram_wr ( p_hwfn , * pp_prod , sizeof ( u32 ) , ( u32 * ) ( & init_prod_val ) ) ; } qed_add_tlv ( p_hwfn , & p_iov -> offset , CHANNEL_TLV_LIST_END , sizeof ( channel_list_end_tlv ) ) ; resp = & p_iov -> pf2vf_reply -> queue_start ; rc = qed_send_msg2pf ( p_hwfn , & resp -> hdr . status , sizeof ( * resp ) ) ; if ( rc ) { exit } if ( resp -> hdr . status != PFVF_STATUS_SUCCESS ) { rc = - EINVAL ; exit } if ( ! p_iov -> b_pre_fp_hsi ) { u32 init_prod_val = 0 ; * pp_prod = ( u8 __iomem * ) p_hwfn -> regview + resp -> offset ; DP_VERBOSE ( p_hwfn , QED_MSG_IOV , "Rxq[0x%02x]: producer at %p [offset 0x%08x]\n" , rx_qid , * pp_prod , resp -> offset ) ; __internal_ram_wr ( p_hwfn , * pp_prod , sizeof ( u32 ) , ( u32 * ) & init_prod_val ) ; } exit qed_vf_pf_req_end ( p_hwfn , rc ) ; return rc ; } 