static u8 ks0127_read ( struct v4l2_subdev * sd , u8 reg ) { struct i2c_client * client = v4l2_get_subdevdata ( sd ) ; int val = 0 ; struct i2c_msg msgs [ ] { { . addr = client -> addr . len = sizeof ( reg ) . buf = & reg } { . addr = client -> addr . flags = I2C_M_RD | I2C_M_NO_RD_ACK . len = sizeof ( val ) . buf = & val } } ; ; int ret ; ret = i2c_transfer ( client -> adapter , msgs , ARRAY_SIZE ( msgs ) ) ; if ( ret != ARRAY_SIZE ( msgs ) ) { v4l2_dbg ( 1 , debug , sd , "read error\n" ) ; } return val ; } 