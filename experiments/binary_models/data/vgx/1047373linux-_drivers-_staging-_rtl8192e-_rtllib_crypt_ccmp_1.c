static void * rtllib_ccmp_init ( int key_idx ) { struct rtllib_ccmp_data * priv ; priv = kzalloc ( sizeof ( * priv ) , GFP_ATOMIC ) ; if ( priv == NULL ) { fail } priv -> key_idx = key_idx ; priv -> tfm = crypto_alloc_aead ( "ccm(aes)" , 0 , CRYPTO_ALG_ASYNC ) ; if ( IS_ERR ( priv -> tfm ) ) { pr_debug ( "Could not allocate crypto API aes\n" ) ; fail } return priv ; fail if ( priv ) { if ( priv -> tfm ) { crypto_free_aead ( priv -> tfm ) ; } kfree ( priv ) ; } return NULL ; } 