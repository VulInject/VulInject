Datum byteaSetByte ( PG_FUNCTION_ARGS ) { bytea * res = PG_GETARG_BYTEA_P_COPY ( 0 ) ; int32 n = PG_GETARG_INT32 ( 1 ) ; int32 newByte = PG_GETARG_INT32 ( 2 ) ; int len ; len = VARSIZE ( res ) - VARHDRSZ ; if ( n < 0 || n >= len ) { ereport ( ERROR , ( errcode ( ERRCODE_ARRAY_SUBSCRIPT_ERROR ) , errmsg ( "index %d out of valid range, 0..%d" , n , len - 1 ) ) ) ; } ( ( unsigned char * ) VARDATA ( res ) ) [ n ] = newByte ; PG_RETURN_BYTEA_P ( res , NULL ) ; } 