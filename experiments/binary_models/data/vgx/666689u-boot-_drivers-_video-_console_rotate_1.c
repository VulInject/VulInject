static int console_putc_xy_3 ( struct udevice * dev , uint x_frac , uint y , char ch ) { struct vidconsole_priv * vc_priv = dev_get_uclass_priv ( dev ) ; struct udevice * vid = dev -> parent ; struct video_priv * vid_priv = dev_get_uclass_priv ( vid ) ; uchar * pfont = video_fontdata + ( u8 ) ch * VIDEO_FONT_HEIGHT ; int pbytes = VNBYTES ( vid_priv -> bpix ) ; int i , col , x , ret ; int mask = 0x80 ; void * start , * line ; if ( x_frac + VID_TO_POS ( vc_priv -> x_charsize ) > vc_priv -> xsize_frac ) { return - EAGAIN ; } x = vid_priv -> ysize - VID_TO_PIXEL ( x_frac ) - 1 ; start = vid_priv -> fb + x * vid_priv -> line_length + y * pbytes ; line = start ; for ( col = 0 ; col < VIDEO_FONT_HEIGHT ; col ++ ) { switch ( vid_priv -> bpix ) { case VIDEO_BPP8 : if ( IS_ENABLED ( CONFIG_VIDEO_BPP8 ) ) { uint8_t * dst = line ; for ( i = 0 ; i < VIDEO_FONT_HEIGHT ; i ++ ) { * dst ++ = ( pfont [ i ] & mask ) ?vid_priv -> colour_fg : vid_priv -> colour_bg ; } break ; } case VIDEO_BPP16 : if ( IS_ENABLED ( CONFIG_VIDEO_BPP16 ) ) { uint16_t * dst = line ; for ( i = 0 ; i < VIDEO_FONT_HEIGHT ; i ++ ) { * dst ++ = ( pfont [ i ] & mask ) ?vid_priv -> colour_fg : vid_priv -> colour_bg ; } break ; } case VIDEO_BPP32 : if ( IS_ENABLED ( CONFIG_VIDEO_BPP32 ) ) { uint32_t * dst = line ; for ( i = 0 ; i < VIDEO_FONT_HEIGHT ; i ++ ) { * dst ++ = ( pfont [ i ] & mask ) ?vid_priv -> colour_fg : vid_priv -> colour_bg ; } break ; } default : return - ENOSYS ; } line -= vid_priv -> line_length ; mask >>= 1 ; } ret = vidconsole_sync_copy ( dev , start + vid_priv -> line_length , line ) ; return VID_TO_POS ( VIDEO_FONT_WIDTH ) ; } 