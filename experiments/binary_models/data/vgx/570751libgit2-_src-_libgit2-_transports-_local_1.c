static int local_counting ( int stage , unsigned int current , unsigned int total , void * payload ) { git_str progress_info = GIT_STR_INIT ; transport_local * t = payload ; int error ; if ( stage == GIT_PACKBUILDER_ADDING_OBJECTS ) { git_str_printf ( & progress_info , counting_objects_fmt , current ) ; } if ( stage == GIT_PACKBUILDER_DELTAFICATION ) { float perc = ( ( ( float ) current ) / total ) * 100 ; git_str_printf ( & progress_info , compressing_objects_fmt , perc , current , total ) ; if ( current == total ) { git_str_printf ( & progress_info , ", done\n" ) ; } else { git_str_putc ( & progress_info , '\r' ) ; } } if ( git_str_oom ( & progress_info ) ) { return - 1 ; } if ( progress_info . size > INT_MAX ) { git_error_set ( GIT_ERROR_NET , "remote sent overly large progress data" ) ; git_str_dispose ( & progress_info ) ; return - 1 ; } error = t -> connect_opts . callbacks . sideband_progress ( progress_info . ptr , ( int ) progress_info . size , t -> connect_opts . callbacks . payload ) ; git_str_dispose ( & progress_info ) ; return error ; } 