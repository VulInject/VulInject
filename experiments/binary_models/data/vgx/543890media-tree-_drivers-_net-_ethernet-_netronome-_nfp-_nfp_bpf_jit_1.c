static void nfp_outro_tc_legacy ( struct nfp_prog * nfp_prog ) { const u8 act2code [ ] { [ NN_ACT_TC_DROP ] = 0x22 [ NN_ACT_TC_REDIR ] = 0x24 } ; ; nfp_prog -> tgt_abort = nfp_prog_current_offset ( nfp_prog , NULL ) ; wrp_immed ( nfp_prog , reg_both ( 0 ) , 0 ) ; nfp_prog -> tgt_out = nfp_prog_current_offset ( nfp_prog ) ; emit_br_byte_neq ( nfp_prog , reg_b ( 0 ) , 0xff , 0 , nfp_prog -> tgt_done , 2 ) ; emit_alu ( nfp_prog , reg_a ( 0 ) , reg_none ( ) , ALU_OP_NONE , NFP_BPF_ABI_FLAGS ) ; emit_ld_field ( nfp_prog , reg_a ( 0 ) , 0xc , reg_imm ( 0x11 ) , SHF_SC_L_SHF , 16 ) ; emit_br ( nfp_prog , BR_UNC , nfp_prog -> tgt_done , 1 ) ; emit_ld_field ( nfp_prog , reg_a ( 0 ) , 0xc , reg_imm ( act2code [ nfp_prog -> act ] ) , SHF_SC_L_SHF , 16 ) ; } 