( llist_add_batch ) ; struct llist_node * llist_del_first ( struct llist_head * head ) { struct llist_node * entry , * old_entry , * next ; entry = smp_load_acquire ( & head -> first ) ; for ( ; ; ) { old_entry = entry ; next = READ_ONCE ( entry -> next ) ; entry = cmpxchg ( & head -> first , old_entry , next ) ; if ( entry == old_entry ) { break ; } } return entry ; } 