static int sci_clk_determine_rate ( struct clk_hw * hw , struct clk_rate_request * req ) { struct sci_clk * clk = to_sci_clk ( hw ) ; int ret ; u64 new_rate ; if ( clk -> cached_req && clk -> cached_req == req -> rate ) { return 0 ; } ret = clk -> provider -> ops -> get_best_match_freq ( clk -> provider -> sci , clk -> dev_id , clk -> clk_id , req -> min_rate , req -> rate , req -> max_rate , & new_rate ) ; if ( ret ) { dev_err ( clk -> provider -> dev , "determine-rate failed for dev=%d, clk=%d, ret=%d\n" , clk -> dev_id , clk -> clk_id , ret ) ; return ret ; } clk -> cached_req = req -> rate ; clk -> cached_res = new_rate ; req -> rate = new_rate ; return 0 ; } 