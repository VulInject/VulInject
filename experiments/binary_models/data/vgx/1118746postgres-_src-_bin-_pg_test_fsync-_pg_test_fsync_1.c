( 0 ) static const char * progname ; static unsigned int secs_per_test = 5 ; static int needs_unlink = 0 ; static char full_buf [ DEFAULT_XLOG_SEG_SIZE ] , * buf , * filename = FSYNC_FILENAME ; static struct timeval start_t , stop_t ; static sig_atomic_t alarm_triggered = false ; static void handle_args ( int argc , char * argv [ ] ) static void prepare_buf ( void ) static void test_open ( void ) static void test_non_sync ( void ) static void test_sync ( int writes_per_op ) static void test_open_syncs ( void ) static void test_open_sync ( const char * msg , int writes_size ) static void test_file_descriptor_sync ( void ) static void process_alarm ( SIGNAL_ARGS ) static DWORD WINAPI process_alarm ( LPVOID param ) static void signal_cleanup ( SIGNAL_ARGS ) static int pg_fsync_writethrough ( int fd ) static void print_elapse ( struct timeval start_t , struct timeval stop_t , int ops ) int main ( int argc , char * argv [ ] ) { pg_logging_init ( argv [ 0 ] ) ; set_pglocale_pgservice ( argv [ 0 ] , PG_TEXTDOMAIN ( "pg_test_fsync" ) ) ; progname = get_progname ( argv [ 0 ] ) ; handle_args ( argc , argv ) ; pqsignal ( SIGINT , signal_cleanup ) ; pqsignal ( SIGTERM , signal_cleanup ) ; pqsignal ( SIGALRM , process_alarm ) ; pqsignal ( SIGHUP , signal_cleanup ) ; pg_prng_seed ( & pg_global_prng_state , ( uint64 ) time ( NULL ) ) ; prepare_buf ( ) ; test_open ( ) ; test_sync ( 1 ) ; test_sync ( 2 ) ; test_open_syncs ( ) ; test_file_descriptor_sync ( ) ; test_non_sync ( ) ; unlink ( filename , NULL ) ; return 0 ; } 