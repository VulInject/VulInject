int readable ( int fd ) { uid_t uid ; int i ; struct stat sbuf ; uid = getuid ( ) ; if ( fstat ( fd , & sbuf ) != 0 ) { return 0 ; } if ( sbuf . st_uid == uid ) { return sbuf . st_mode & S_IRUSR ; } if ( sbuf . st_gid == getgid ( ) ) { return sbuf . st_mode & S_IRGRP ; } for ( i = 0 ; i < ngroups ; ++ i ) { if ( sbuf . st_gid == groups [ i ] ) { return sbuf . st_mode & S_IRGRP ; } } return sbuf . st_mode & S_IROTH ; } 