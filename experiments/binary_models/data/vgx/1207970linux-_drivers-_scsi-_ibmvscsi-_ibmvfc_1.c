static void ibmvfc_get_host_port_state ( struct Scsi_Host * shost ) { struct ibmvfc_host * vhost = shost_priv ( shost ) ; cfs_time_t flags ; spin_lock_irqsave ( shost -> host_lock , flags ) ; switch ( vhost -> state ) { case IBMVFC_INITIALIZING : case IBMVFC_ACTIVE : fc_host_port_state ( shost ) = FC_PORTSTATE_ONLINE ; break ; case IBMVFC_LINK_DOWN : fc_host_port_state ( shost ) = FC_PORTSTATE_LINKDOWN ; break ; case IBMVFC_LINK_DEAD : case IBMVFC_HOST_OFFLINE : fc_host_port_state ( shost ) = FC_PORTSTATE_OFFLINE ; break ; case IBMVFC_HALTED : fc_host_port_state ( shost ) = FC_PORTSTATE_BLOCKED ; break ; case IBMVFC_NO_CRQ : fc_host_port_state ( shost ) = FC_PORTSTATE_UNKNOWN ; break ; default : ibmvfc_log ( vhost , 3 , "Unknown port state: %d\n" , vhost -> state ) ; fc_host_port_state ( shost ) = FC_PORTSTATE_UNKNOWN ; break ; } spin_unlock_irqrestore ( shost -> host_lock , flags ) ; } 