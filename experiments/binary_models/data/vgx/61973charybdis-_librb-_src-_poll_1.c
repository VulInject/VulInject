void rb_setselect_poll ( rb_fde_t * F , unsigned int type , PF * handler , void * client_data ) { if ( F == NULL ) { return ; } if ( type & RB_SELECT_READ ) { F -> read_handler = handler ; F -> read_data = client_data ; if ( handler != NULL ) { F -> pflags |= POLLRDNORM ; } else { F -> pflags &= ~ POLLRDNORM ; } } if ( type & RB_SELECT_WRITE ) { F -> write_handler = handler ; F -> write_data = client_data ; if ( handler != NULL ) { F -> pflags |= POLLWRNORM ; } else { F -> pflags &= ~ POLLWRNORM ; } } resize_pollarray ( F -> fd , NULL ) ; if ( F -> pflags <= 0 ) { pollfd_list . pollfds [ F -> fd ] . events = 0 ; pollfd_list . pollfds [ F -> fd ] . fd = - 1 ; if ( F -> fd == pollfd_list . maxindex ) { while ( pollfd_list . maxindex >= 0 && pollfd_list . pollfds [ pollfd_list . maxindex ] . fd == - 1 ) { pollfd_list . maxindex -- ; } } } else { pollfd_list . pollfds [ F -> fd ] . events = F -> pflags ; pollfd_list . pollfds [ F -> fd ] . fd = F -> fd ; if ( F -> fd > pollfd_list . maxindex ) { pollfd_list . maxindex = F -> fd ; } } } 