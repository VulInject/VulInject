cm_xref ( ) { if ( arg == START ) { char * arg1 = get_xref_token ( 1 ) ; char * arg2 = get_xref_token ( 0 ) ; char * arg3 = get_xref_token ( 0 ) ; char * arg4 = get_xref_token ( 0 ) ; char * arg5 = get_xref_token ( 0 ) ; char * tem ; if ( ! * arg1 ) { line_error ( _ ( "First argument to cross-reference may not be empty" ) ) ; } if ( docbook ) { if ( ! ref_flag ) { add_word ( px_ref_flag || printing_index ?( char * ) _ ( "see " ) : ( char * ) _ ( "See " ) ) ; } if ( ! * arg4 && ! * arg5 ) { char * arg1_id = xml_id ( arg1 ) ; if ( * arg2 || * arg3 ) { xml_insert_element_with_attribute ( XREFNODENAME , START , "linkend=\"%s\"" , arg1_id ) ; execute_string ( "%s" , * arg3 ?arg3 : arg2 ) ; xml_insert_element ( XREFNODENAME , END ) ; } else { xml_insert_element_with_attribute ( XREF , START , "linkend=\"%s\"" , arg1_id ) ; xml_insert_element ( XREF , END ) ; free ( arg1_id ) ; } } if ( * arg5 ) { add_word_args ( _ ( "See section ``%s'' in " ) , * arg3 ?arg3 : arg1 ) ; xml_insert_element ( CITE , START ) ; add_word ( arg5 ) ; xml_insert_element ( CITE , END ) ; } if ( * arg4 ) { } } if ( xml ) { if ( ! ref_flag ) { add_word_args ( "%s" , px_ref_flag ?_ ( "see " ) : _ ( "See " ) ) ; } xml_insert_element ( XREF , START ) ; xml_insert_element ( XREFNODENAME , START ) ; execute_string ( "%s" , arg1 ) ; xml_insert_element ( XREFNODENAME , END ) ; if ( * arg2 ) { xml_insert_element ( XREFINFONAME , START ) ; execute_string ( "%s" , arg2 ) ; xml_insert_element ( XREFINFONAME , END ) ; } if ( * arg3 ) { xml_insert_element ( XREFPRINTEDDESC , START ) ; execute_string ( "%s" , arg3 ) ; xml_insert_element ( XREFPRINTEDDESC , END ) ; } if ( * arg4 ) { xml_insert_element ( XREFINFOFILE , START ) ; execute_string ( "%s" , arg4 ) ; xml_insert_element ( XREFINFOFILE , END ) ; } if ( * arg5 ) { xml_insert_element ( XREFPRINTEDNAME , START ) ; execute_string ( "%s" , arg5 ) ; xml_insert_element ( XREFPRINTEDNAME , END ) ; } xml_insert_element ( XREF , END ) ; } if ( html ) { if ( ! ref_flag ) { add_word_args ( "%s" , px_ref_flag ?_ ( "see " ) : _ ( "See " ) ) ; } } else { add_word_args ( "%s" , px_ref_flag ?"*note " : "*Note " ) ; } if ( ! xml ) { if ( * arg5 || * arg4 ) { char * ref_name ; if ( ! * arg2 ) { if ( * arg3 ) { ref_name = arg3 ; } else { ref_name = arg1 ; } } else { ref_name = arg2 ; } if ( html ) { char * file_arg = arg4 ; add_html_elt ( "<a href=" ) ; { char * p = strrchr ( file_arg , '/' ) ; if ( p ) { file_arg = p + 1 ; } p = strrchr ( file_arg , '.' ) ; if ( p != NULL ) { * p = 0 ; } } if ( ! * file_arg ) { warning ( _ ( "Empty file name for HTML cross reference in `%s'" ) , arg4 ) ; } if ( splitting ) { execute_string ( "\"../%s/" , file_arg ) ; } else { execute_string ( "\"%s.html" , file_arg ) ; } in_fixed_width_font ++ ; tem = expansion ( arg1 , 0 ) ; in_fixed_width_font -- ; add_anchor_name ( tem , 1 ) ; free ( tem ) ; add_word ( "\">" ) ; execute_string ( "%s" , ref_name ) ; add_word ( "</a>" ) ; } else { execute_string ( "%s:" , ref_name ) ; in_fixed_width_font ++ ; execute_string ( " (%s)%s" , arg4 , arg1 ) ; add_xref_punctuation ( ) ; in_fixed_width_font -- ; } if ( arg1 ) { free ( arg1 ) ; } if ( arg2 ) { free ( arg2 ) ; } if ( arg3 ) { free ( arg3 ) ; } if ( arg4 ) { free ( arg4 ) ; } if ( arg5 ) { free ( arg5 ) ; } return ; } else { remember_node_reference ( arg1 , line_number , followed_reference ) ; } if ( * arg3 ) { if ( html ) { add_html_elt ( "<a href=\"" ) ; in_fixed_width_font ++ ; tem = expansion ( arg1 , 0 ) ; in_fixed_width_font -- ; add_anchor_name ( tem , 1 ) ; free ( tem ) ; add_word ( "\">" ) ; execute_string ( "%s" , * arg2 ?arg2 : arg3 ) ; add_word ( "</a>" ) ; } else { execute_string ( "%s:" , * arg2 ?arg2 : arg3 ) ; in_fixed_width_font ++ ; execute_string ( " %s" , arg1 ) ; add_xref_punctuation ( ) ; in_fixed_width_font -- ; } } else { if ( html ) { add_html_elt ( "<a href=\"" ) ; in_fixed_width_font ++ ; tem = expansion ( arg1 , 0 ) ; in_fixed_width_font -- ; add_anchor_name ( tem , 1 ) ; free ( tem ) ; add_word ( "\">" ) ; if ( * arg2 ) { execute_string ( "%s" , arg2 ) ; } else { char * fref = get_float_ref ( arg1 ) ; execute_string ( "%s" , fref ?fref : arg1 ) ; free ( fref ) ; } add_word ( "</a>" ) ; } else { if ( * arg2 ) { execute_string ( "%s:" , arg2 ) ; in_fixed_width_font ++ ; execute_string ( " %s" , arg1 ) ; add_xref_punctuation ( ) ; in_fixed_width_font -- ; } else { char * fref = get_float_ref ( arg1 ) ; if ( fref ) { execute_string ( "%s:" , fref ) ; in_fixed_width_font ++ ; execute_string ( " %s" , arg1 ) ; add_xref_punctuation ( ) ; in_fixed_width_font -- ; } else { in_fixed_width_font ++ ; execute_string ( "%s::" , arg1 ) ; in_fixed_width_font -- ; } } } } } if ( arg1 ) { free ( arg1 ) ; } if ( arg2 ) { free ( arg2 ) ; } if ( arg3 ) { free ( arg3 ) ; } if ( arg4 ) { free ( arg4 ) ; } if ( arg5 ) { free ( arg5 ) ; } } else { int temp = next_nonwhitespace_character ( ) ; if ( temp == - 1 ) { warning ( _ ( "End of file reached while looking for `.' or `,'" ) ) ; } if ( temp != '.' && temp != ',' ) { warning ( _ ( "`.' or `,' must follow @%s, not `%c'" ) , command , temp ) ; } } } 