BOOL NTOWFv2A ( LPSTR Password , UINT32 PasswordLength , LPSTR User , UINT32 UserLength , LPSTR Domain , UINT32 DomainLength , BYTE * NtHash ) { LPWSTR UserW = NULL ; LPWSTR DomainW = NULL ; LPWSTR PasswordW = NULL ; BOOL result = FALSE ; size_t userCharLength = 0 ; size_t domainCharLength = 0 ; size_t pwdCharLength = 0 ; if ( ! NtHash ) { return FALSE ; } UserW = ConvertUtf8NToWCharAlloc ( User , UserLength , & userCharLength ) ; DomainW = ConvertUtf8NToWCharAlloc ( Domain , DomainLength , & domainCharLength ) ; PasswordW = ConvertUtf8NToWCharAlloc ( Password , PasswordLength , & pwdCharLength ) ; if ( ! UserW || ! DomainW || ! PasswordW ) { out_fail } if ( ! NTOWFv2W ( PasswordW , pwdCharLength * sizeof ( WCHAR ) , UserW , userCharLength * sizeof ( WCHAR ) , DomainW , domainCharLength * sizeof ( WCHAR ) , NtHash ) ) { out_fail } result = TRUE ; out_fail free ( UserW ) ; free ( PasswordW ) ; return result ; } 