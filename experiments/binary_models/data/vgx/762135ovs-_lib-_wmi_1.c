static boolean initialize_wmi ( IWbemLocator * * ploc , IWbemContext * * pcontext ) { HRESULT hres = 0 ; hres = CoInitialize ( NULL ) ; hres = CoInitializeSecurity ( NULL , - 1 , NULL , NULL , RPC_C_AUTHN_LEVEL_DEFAULT , RPC_C_IMP_LEVEL_IMPERSONATE , NULL , EOAC_NONE , NULL ) ; if ( FAILED ( hres ) ) { return false ; } hres = CoCreateInstance ( & CLSID_WbemContext , NULL , CLSCTX_INPROC_SERVER , & IID_IWbemContext , ( void * * ) pcontext ) ; if ( FAILED ( hres ) ) { return false ; } fill_context ( * pcontext ) ; hres = CoCreateInstance ( & CLSID_WbemLocator , NULL , CLSCTX_INPROC_SERVER , & IID_IWbemLocator , ( LPVOID * ) ploc ) ; if ( FAILED ( hres ) ) { return false ; } return true ; } 