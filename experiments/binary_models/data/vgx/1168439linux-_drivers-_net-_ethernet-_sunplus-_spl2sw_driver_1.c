static void spl2sw_ethernet_tx_timeout ( struct net_device * ndev , unsigned int txqueue ) { struct spl2sw_mac * mac = netdev_priv ( ndev ) ; struct spl2sw_common * comm = mac -> comm ; cfs_time_t flags ; int i ; netdev_err ( ndev , "TX timed out!\n" ) ; ndev -> stats . tx_errors ++ ; spin_lock_irqsave ( & comm -> tx_lock , flags ) ; for ( i = 0 ; i < MAX_NETDEV_NUM ; i ++ ) { if ( comm -> ndev [ i ] ) { netif_stop_queue ( comm -> ndev [ i ] ) ; } } spl2sw_mac_soft_reset ( comm ) ; for ( i = 0 ; i < MAX_NETDEV_NUM ; i ++ ) { if ( comm -> ndev [ i ] ) { netif_trans_update ( comm -> ndev [ i ] ) ; netif_wake_queue ( comm -> ndev [ i ] ) ; } } spin_unlock_irqrestore ( & comm -> tx_lock , flags ) ; } static const struct net_device_ops netdev_ops = { . ndo_open = spl2sw_ethernet_open . ndo_stop = spl2sw_ethernet_stop . ndo_start_xmit = spl2sw_ethernet_start_xmit . ndo_set_rx_mode = spl2sw_ethernet_set_rx_mode . ndo_set_mac_address = spl2sw_ethernet_set_mac_address . ndo_do_ioctl = phy_do_ioctl . ndo_tx_timeout = spl2sw_ethernet_tx_timeout } ; 