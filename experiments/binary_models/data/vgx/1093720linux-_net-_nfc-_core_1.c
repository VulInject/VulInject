int nfc_dep_link_down ( struct nfc_dev * dev ) { int rc = 0 ; pr_debug ( "dev_name=%s\n" , dev_name ( & dev -> dev ) ) ; if ( ! dev -> ops -> dep_link_down ) { return - EOPNOTSUPP ; } device_lock ( & dev -> dev ) ; if ( dev -> shutting_down ) { rc = - ENODEV ; error } if ( dev -> dep_link_up == false ) { rc = - EALREADY ; error } rc = dev -> ops -> dep_link_down ( dev ) ; if ( ! rc ) { dev -> dep_link_up = false ; dev -> rf_mode = NFC_RF_NONE ; nfc_llcp_mac_is_down ( dev ) ; nfc_genl_dep_link_down_event ( dev ) ; } error device_unlock ( & dev -> dev ) ; return rc ; } 