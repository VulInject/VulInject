static json_t * OutputStats2Json ( json_t * js , const char * key ) { void * iter ; const char * dot = strchr ( key , '.' ) ; if ( strlen ( dot ) > 2 ) { if ( * ( dot + 1 ) == '.' && * ( dot + 2 ) != '\0' ) { dot = strchr ( dot + 2 , '.' ) ; } } size_t predot_len = ( dot - key ) + 1 ; char s [ predot_len ] ; strlcpy ( s , key , predot_len ) ; iter = json_object_iter_at ( js , s ) ; const char * s2 = strchr ( dot + 1 , '.' ) ; json_t * value = json_object_iter_value ( iter ) ; if ( value == NULL ) { value = json_object ( ) ; if ( ! strncmp ( s , "detect" , 6 ) ) { json_t * js_engine = NULL ; TmEcode ret = OutputEngineStats2Json ( & js_engine , OUTPUT_ENGINE_ALL ) ; if ( ret == TM_ECODE_OK && js_engine ) { json_object_set_new ( value , "engines" , js_engine ) ; } } json_object_set_new ( js , s , value ) ; } if ( s2 != NULL ) { return OutputStats2Json ( value , & key [ dot - key + 1 ] ) ; } return value ; } 