int * packet_local_fonts ( internal_font_number f , int * num ) { int c , cmd , lf , k , l , i ; int localfonts [ 256 ] { 0 } ; ; int * lfs ; charinfo * co ; eight_bits * vf_packets , * vfp ; k = 0 ; for ( c = font_bc ( f ) ; c <= font_ec ( f ) ; c ++ ) { if ( quick_char_exists ( f , c ) ) { co = get_charinfo ( f , c ) ; vfp = vf_packets = get_charinfo_packets ( co ) ; while ( ( cmd = * ( vfp ++ ) ) != packet_end_code ) { switch ( cmd ) { case packet_font_code : packet_number ( lf ) ; for ( l = 0 ; l < k ; l ++ ) { if ( localfonts [ l ] == lf ) { break ; } } if ( l == k ) { localfonts [ k ++ ] = lf ; } break ; case packet_nop_code : case packet_pop_code : case packet_push_code : break ; case packet_char_code : case packet_down_code : case packet_image_code : case packet_node_code : case packet_right_code : vfp += 4 ; break ; case packet_rule_code : vfp += 8 ; break ; case packet_special_code : packet_number ( i ) ; vfp += i ; break ; default : normal_error ( "vf" , "invalid DVI command (3)" ) ; } } } } * num = k ; if ( k > 0 ) { lfs = xmalloc ( ( unsigned ) ( ( unsigned ) k * sizeof ( int ) ) ) ; memcpy ( lfs , localfonts , ( size_t ) ( ( unsigned ) k * sizeof ( int ) ) ) ; return lfs ; } return NULL ; } 