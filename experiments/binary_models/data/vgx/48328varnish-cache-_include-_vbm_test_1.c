int main ( void ) { const unsigned sz = VBITMAP_SZ ( 1 ) ; char spc [ sz ] ; struct vbitmap * vb = vbit_init ( spc , sz ) ; VBITMAP_TYPE * obits ; unsigned nbits ; assert ( vb ) ; obits = vb -> bits ; nbits = vb -> nbits ; assert ( nbits == VBITMAP_WORD ) ; vbit_set ( vb , nbits - 1 ) ; assert ( vbit_test ( vb , nbits - 1 ) ) ; assert ( vb -> bits ) ; assert ( vb -> bits ) ; assert ( vb -> bits == obits ) ; vbit_set ( vb , nbits ) ; assert ( vbit_test ( vb , nbits - 1 ) ) ; assert ( vbit_test ( vb , nbits ) ) ; assert ( vb -> nbits == VBITMAP_LUMP ) ; assert ( vb -> bits != obits ) ; assert ( vb -> flags & VBITMAP_FL_MALLOC_BITS ) ; assert ( vb -> bits ) ; vbit_destroy ( vb ) ; assert ( vb -> bits == NULL ) ; assert ( vb -> nbits == 0 ) ; assert ( 20 < VBITMAP_LUMP ) ; vbit_set ( vb , 20 ) ; assert ( vbit_test ( vb , 20 ) ) ; assert ( vb -> nbits == VBITMAP_LUMP ) ; assert ( vb -> flags & VBITMAP_FL_MALLOC_BITS ) ; vbit_set ( vb , VBITMAP_LUMP ) ; assert ( vbit_test ( vb , 20 ) ) ; assert ( vbit_test ( vb , VBITMAP_LUMP ) ) ; assert ( vb -> nbits == 2 * VBITMAP_LUMP ) ; assert ( vb -> flags & VBITMAP_FL_MALLOC_BITS ) ; vbit_destroy ( vb ) ; return ( 0 ) ; } 