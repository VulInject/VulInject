cherokee_split_pathinfo ( , , , , ) { char * cur ; struct stat st ; char * last_dir ; if ( init_pos > path -> len ) { return ret_not_found ; } for ( cur = path -> buf + init_pos ; * cur && ( cur < path -> buf + path -> len ) ; cur ++ ) { if ( * cur != '/' ) { continue ; } * cur = '\0' ; if ( cherokee_stat ( path -> buf , & st ) == - 1 ) { * cur = '/' ; if ( ( allow_dirs ) && ( last_dir != NULL ) ) { * pathinfo = last_dir ; * pathinfo_len = ( path -> buf + path -> len ) - last_dir ; return ret_ok ; } return ret_not_found ; } if ( S_ISDIR ( st . st_mode ) ) { * cur = '/' ; last_dir = cur ; continue ; } * cur = '/' ; * pathinfo = cur ; * pathinfo_len = ( path -> buf + path -> len ) - cur ; return ret_ok ; } * pathinfo_len = 0 ; return ret_ok ; } 