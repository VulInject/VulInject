static int find_opt ( s , lookup_long , optstart , len , err_code , opt_offset ) _scanopt_t * s ; int lookup_long ; char * optstart ; int len ; int * err_code ; int * opt_offset ; { int nmatch = 0 , lastr_val = 0 , i ; * err_code = 0 ; * opt_offset = - 1 ; for ( i = 0 ; i < s -> optc ; i ++ ) { char * optname ; optname = ( char * ) ( s -> options [ i ] . opt_fmt + ( lookup_long ?2 : 1 ) ) ; if ( lookup_long && ( s -> aux [ i ] . flags & IS_LONG ) ) { if ( len > s -> aux [ i ] . namelen ) { continue ; } if ( strncmp ( optname , optstart , len ) == 0 ) { nmatch ++ ; * opt_offset = i ; if ( len == s -> aux [ i ] . namelen ) { nmatch = 1 ; break ; } if ( lastr_val && lastr_val == s -> options [ i ] . r_val ) { nmatch -- ; } lastr_val = s -> options [ i ] . r_val ; } } if ( ! lookup_long && ! ( s -> aux [ i ] . flags & IS_LONG ) ) { if ( optname [ 0 ] == optstart [ 0 ] ) { nmatch ++ ; * opt_offset = i ; } } } if ( nmatch == 0 ) { * err_code = SCANOPT_ERR_OPT_UNRECOGNIZED ; * opt_offset = - 1 ; } if ( nmatch > 1 ) { * err_code = SCANOPT_ERR_OPT_AMBIGUOUS ; * opt_offset = - 1 ; } return * err_code ?0 : 1 ; } 