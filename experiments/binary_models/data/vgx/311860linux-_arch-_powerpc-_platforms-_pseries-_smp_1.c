static __init void pSeries_smp_probe ( void ) { if ( xive_enabled ( ) ) { xive_smp_probe ( ) ; } else { xics_smp_probe ( ) ; } if ( ! cpu_has_feature ( CPU_FTR_SMT ) ) { return ; } check_kvm_guest ( ) ; if ( is_kvm_guest ( ) ) { if ( xive_enabled ( ) ) { return ; } if ( is_secure_guest ( ) ) { return ; } } ic_cause_ipi = smp_ops -> cause_ipi ; smp_ops -> cause_ipi = dbell_or_ic_cause_ipi ; } 