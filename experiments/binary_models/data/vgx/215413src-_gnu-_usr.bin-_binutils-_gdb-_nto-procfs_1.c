procfs_pidlist ( , ) { DIR * dp = NULL ; struct dirent * dirp = NULL ; int fd = - 1 ; char buf [ 512 ] ; procfs_info * pidinfo = NULL ; procfs_debuginfo * info = NULL ; procfs_status * status = NULL ; pid_t num_threads = 0 ; pid_t pid ; char name [ 512 ] ; dp = opendir ( nto_procfs_path ) ; if ( dp == NULL ) { fprintf_unfiltered ( gdb_stderr , "failed to opendir \"%s\" - %d (%s)" , nto_procfs_path , errno , safe_strerror ( errno ) ) ; return ; } rewinddir ( dp ) ; { { dirp = readdir ( dp ) ; if ( dirp == NULL ) { closedir ( dp , NULL ) ; return ; } snprintf ( buf , 511 , "%s/%s/as" , nto_procfs_path , dirp -> d_name ) ; pid = atoi ( dirp -> d_name ) ; } pid == 0 ; fd = open ( buf , O_RDONLY ) ; if ( fd == - 1 ) { fprintf_unfiltered ( gdb_stderr , "failed to open %s - %d (%s)\n" , buf , errno , safe_strerror ( errno ) ) ; closedir ( dp ) ; return ; } pidinfo = ( procfs_info * ) buf ; if ( devctl ( fd , DCMD_PROC_INFO , pidinfo , sizeof ( buf ) , 0 ) != EOK ) { fprintf_unfiltered ( gdb_stderr , "devctl DCMD_PROC_INFO failed - %d (%s)\n" , errno , safe_strerror ( errno ) ) ; break ; } num_threads = pidinfo -> num_threads ; info = ( procfs_debuginfo * ) buf ; if ( devctl ( fd , DCMD_PROC_MAPDEBUG_BASE , info , sizeof ( buf ) , 0 ) != EOK ) { strcpy ( name , "unavailable" ) ; } else { strcpy ( name , info -> path ) ; } status = ( procfs_status * ) buf ; for ( status -> tid = 1 ; status -> tid <= num_threads ; status -> tid ++ ) { if ( devctl ( fd , DCMD_PROC_TIDSTATUS , status , sizeof ( buf ) , 0 ) != EOK && status -> tid != 0 ) { break ; } if ( status -> tid != 0 ) { printf_filtered ( "%s - %d/%d\n" , name , pid , status -> tid ) ; } } close ( fd ) ; } dirp != NULL ; close ( fd ) ; closedir ( dp ) ; return ; } 