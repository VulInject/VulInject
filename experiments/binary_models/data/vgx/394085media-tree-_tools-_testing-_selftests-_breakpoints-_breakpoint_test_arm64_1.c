static bool set_watchpoint ( pid_t pid , int size , int wp ) { const volatile uint8_t * addr = & var [ 32 + wp ] ; const int offset = ( uintptr_t ) addr % 8 ; const unsigned int byte_mask = ( ( 1 << size ) - 1 ) << offset ; const unsigned int type = 2 ; const unsigned int enable = 1 ; const unsigned int control = byte_mask << 5 | type << 3 | enable ; struct user_hwdebug_state dreg_state ; struct iovec iov ; dreg_state . dbg_regs [ 0 ] . addr = ( uintptr_t ) ( addr - offset ) ; dreg_state . dbg_regs [ 0 ] . ctrl = control ; iov . iov_base = & dreg_state ; iov . iov_len = offsetof ( user_hwdebug_state , dbg_regs ) + sizeof ( dreg_state . dbg_regs [ 0 ] ) ; if ( ptrace ( PTRACE_SETREGSET , pid , NT_ARM_HW_WATCH , & iov ) == 0 ) { return true ; } if ( errno == EIO ) { printf ( "ptrace(PTRACE_SETREGSET, NT_ARM_HW_WATCH) " "not supported on this hardware\n" ) ; ksft_exit_skip ( ) ; } perror ( "ptrace(PTRACE_SETREGSET, NT_ARM_HW_WATCH) failed" ) ; return false ; } 