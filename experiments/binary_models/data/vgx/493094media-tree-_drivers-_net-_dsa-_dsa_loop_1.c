static int dsa_loop_port_vlan_dump ( struct dsa_switch * ds , int port , struct switchdev_obj_port_vlan * vlan , int * cb ( struct switchdev_obj * obj ) ) { struct dsa_loop_priv * ps = ds -> priv ; struct mii_bus * bus = ps -> bus ; struct dsa_loop_vlan * vl ; u16 vid , vid_start = 0 ; int err = 0 ; dev_dbg ( ds -> dev , "%s\n" , __func__ ) ; mdiobus_read ( bus , ps -> port_base + port , MII_BMSR ) ; for ( vid = vid_start ; vid < DSA_LOOP_VLANS ; vid ++ ) { vl = & ps -> vlans [ vid ] ; vlan -> vid_begin = vlan -> vid_end = vid ; vlan -> flags = 0 ; if ( vl -> untagged & BIT ( port ) ) { vlan -> flags |= BRIDGE_VLAN_INFO_UNTAGGED ; } if ( ps -> pvid == vid ) { vlan -> flags |= BRIDGE_VLAN_INFO_PVID ; } err = cb ( & vlan -> obj ) ; if ( err ) { break ; } } return err ; } 