static int mod_init ( void ) { LM_DBG ( "Loading...\n" ) ; request = 0 ; responsejson . s = 0 ; responsejson . len = 0 ; requestjson . len = 0 ; callback_singleton = shm_malloc ( sizeof ( int ) ) ; * callback_singleton = 0 ; cdp_avp = 0 ; if ( load_cdp_api ( & cdpb ) != 0 ) { LM_ERR ( "can't load CDP API\n" ) ; error } cdp_avp = load_cdp_avp ( ) ; if ( ! cdp_avp ) { LM_ERR ( "can't load CDP_AVP API\n" ) ; error } event_route_diameter = route_get ( & event_rt , "diameter:request" ) ; if ( event_route_diameter < 0 ) { LM_ERR ( "No diameter:request event route found\n" ) ; error } LM_DBG ( "Found Route diameter:request: %i\n" , event_route_diameter ) ; event_route_diameter_response = route_get ( & event_rt , "diameter:response" ) ; if ( event_route_diameter_response < 0 ) { LM_WARN ( "No diameter:response event route found, asynchronous operations disabled.\n" ) ; } else { LM_DBG ( "Found Route diameter:response: %i\n" , event_route_diameter_response ) ; } return 0 ; error LM_ERR ( "Failed to initialise ims_diameter_server module\n" ) ; return - 1 ; } 