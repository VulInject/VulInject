static int get_metadata ( AVFormatContext * s , const char * const tag , const unsigned size ) { uint8_t * buf ; buf = av_malloc ( size + 1 ) ; if ( ! buf ) { return AVERROR ( ENOMEM ) ; } if ( avio_read ( s -> pb , buf , size ) != size ) { av_free ( buf ) ; return AVERROR ( EIO ) ; } if ( empty_string ( buf , size ) ) { av_free ( buf ) ; return 0 ; } buf [ size ] = 0 ; av_dict_set ( & s -> metadata , tag , buf , AV_DICT_DONT_STRDUP_VAL ) ; return 0 ; } 