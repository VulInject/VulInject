int drm_sched_job_add_dependency ( struct drm_sched_job * job , struct dma_fence * fence ) { struct dma_fence * entry ; unsigned long index ; u32 id = 0 ; int ret ; xa_for_each ( , , ) { if ( entry -> context != fence -> context ) { continue ; } if ( dma_fence_is_later ( fence , entry ) ) { dma_fence_put ( entry ) ; xa_store ( & job -> dependencies , index , fence , GFP_KERNEL ) ; } else { dma_fence_put ( fence ) ; } return 0 ; } ret = xa_alloc ( & job -> dependencies , & id , fence , xa_limit_32b , GFP_KERNEL ) ; if ( ret != 0 ) { dma_fence_put ( fence ) ; } return ret ; } 