void carl9170_usb_stop ( struct ar9170 * ar ) { int ret ; carl9170_set_state_when ( ar , CARL9170_IDLE , CARL9170_STOPPED ) ; ret = carl9170_usb_flush ( ar ) ; if ( ret ) { dev_err ( & ar -> udev -> dev , "kill pending tx urbs.\n" ) ; } usb_poison_anchored_urbs ( & ar -> tx_anch ) ; carl9170_usb_handle_tx_err ( ar ) ; spin_lock_bh ( & ar -> cmd_lock ) ; spin_unlock_bh ( & ar -> cmd_lock ) ; complete ( & ar -> cmd_wait ) ; } 