void gicv3_init_irqs_and_mmio ( GICv3State * s , qemu_irq_handler handler , const MemoryRegionOps * ops ) { SysBusDevice * sbd = SYS_BUS_DEVICE ( s ) ; int i ; int cpuidx ; i = s -> num_irq - GIC_INTERNAL + GIC_INTERNAL * s -> num_cpu ; qdev_init_gpio_in ( DEVICE ( s ) , handler , i ) ; for ( i = 0 ; i < s -> num_cpu ; i ++ ) { sysbus_init_irq ( sbd , & s -> cpu [ i ] . parent_irq ) ; } for ( i = 0 ; i < s -> num_cpu ; i ++ ) { sysbus_init_irq ( sbd , & s -> cpu [ i ] . parent_fiq ) ; } for ( i = 0 ; i < s -> num_cpu ; i ++ ) { sysbus_init_irq ( sbd , & s -> cpu [ i ] . parent_virq ) ; } for ( i = 0 ; i < s -> num_cpu ; i ++ ) { sysbus_init_irq ( sbd , & s -> cpu [ i ] . parent_vfiq ) ; } memory_region_init_io ( & s -> iomem_dist , OBJECT ( s ) , ops , s , "gicv3_dist" , 0x10000 ) ; sysbus_init_mmio ( sbd , & s -> iomem_dist ) ; s -> redist_regions = g_new0 ( GICv3RedistRegion , s -> nb_redist_regions ) ; cpuidx = 0 ; for ( i = 0 ; i < s -> nb_redist_regions ; i ++ ) { char * name = g_strdup_printf ( "gicv3_redist_region[%d]" , i ) ; GICv3RedistRegion * region = & s -> redist_regions [ i ] ; region -> gic = s ; region -> cpuidx = cpuidx ; cpuidx += s -> redist_region_count [ i ] ; memory_region_init_io ( & region -> iomem , OBJECT ( s ) , ops ?& ops [ 1 ] : NULL , region , name , s -> redist_region_count [ i ] * GICV3_REDIST_SIZE ) ; sysbus_init_mmio ( sbd , & region -> iomem ) ; } } 