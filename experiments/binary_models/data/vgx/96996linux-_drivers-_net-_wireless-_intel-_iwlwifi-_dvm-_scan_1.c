static void iwl_process_scan_complete ( struct iwl_priv * priv ) { bool aborted ; lockdep_assert_held ( & priv -> mutex ) ; IWL_DEBUG_SCAN ( priv , "Completed scan.\n" ) ; cancel_delayed_work ( & priv -> scan_check ) ; aborted = test_and_clear_bit ( STATUS_SCAN_ABORTING , & priv -> status ) ; if ( aborted ) { IWL_DEBUG_SCAN ( priv , "Aborted scan completed.\n" ) ; } if ( ! test_and_clear_bit ( STATUS_SCANNING , & priv -> status ) ) { IWL_DEBUG_SCAN ( priv , "Scan already completed.\n" ) ; out_settings } if ( priv -> scan_type != IWL_SCAN_NORMAL && ! aborted ) { int err ; if ( priv -> scan_request == NULL ) { out_complete } err = iwl_scan_initiate ( priv , priv -> scan_vif , IWL_SCAN_NORMAL , priv -> scan_request -> channels [ 0 ] -> band ) ; if ( err ) { IWL_DEBUG_SCAN ( priv , "failed to initiate pending scan: %d\n" , err ) ; aborted = true ; out_complete } return ; } out_complete iwl_complete_scan ( priv , aborted ) ; out_settings if ( ! iwl_is_ready_rf ( priv ) ) { return ; } iwlagn_post_scan ( priv ) ; } 