int main ( int argc , char * * argv ) { struct utmpx * utmpx ; FILE * fp ; fp = fopen ( WTMPX_FILE , "a+" ) ; if ( fp == NULL ) { fprintf ( stderr , "%s: %s: %s\n" , argv [ 0 ] , WTMPX_FILE , strerror ( errno ) ) ; exit ( 1 ) ; } while ( ( utmpx = getutxent ( ) ) != NULL ) { if ( ( utmpx -> ut_type == USER_PROCESS ) && ! ( nonuserx ( * utmpx ) ) ) { time ( & utmpx -> ut_xtime ) ; fwrite ( utmpx , sizeof ( * utmpx ) , 1 , fp ) ; } } fclose ( fp , NULL ) ; exit ( 0 ) ; } 