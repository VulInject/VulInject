static inline int au1000_usb_init ( unsigned long rb , int reg ) { void __iomem * base = ( void __iomem * ) KSEG1ADDR ( rb + reg ) ; unsigned long r = __raw_readl ( base ) ; struct clk * c ; c = clk_get ( NULL , "usbh_clk" ) ; if ( IS_ERR ( c ) ) { return - ENODEV ; } if ( clk_round_rate ( c , 48000000 ) != 48000000 ) { clk_put ( c , NULL ) ; return - ENODEV ; } if ( clk_set_rate ( c , 48000000 ) ) { clk_put ( c ) ; return - ENODEV ; } clk_put ( c ) ; r |= USBHEN_BE ; r |= USBHEN_C ; __raw_writel ( r , base ) ; wmb ( ) ; udelay ( 1000 ) ; return 0 ; } 