static long sgx_ioc_enclave_create ( struct sgx_encl * encl , void __user * arg ) { struct sgx_enclave_create create_arg ; void * secs ; int ret ; if ( test_bit ( SGX_ENCL_CREATED , & encl -> flags ) ) { return - EINVAL ; } if ( copy_from_user ( & create_arg , arg , sizeof ( create_arg ) ) ) { return - EFAULT ; } secs = kmalloc ( PAGE_SIZE , GFP_KERNEL ) ; if ( ! secs ) { return - ENOMEM ; } if ( copy_from_user ( secs , ( void __user * ) create_arg . src , PAGE_SIZE ) ) { ret = - EFAULT ; } else { ret = sgx_encl_create ( encl , secs ) ; } return ret ; } 