static int sun4i_frontend_bind ( struct device * dev , struct device * master , void * data ) { struct platform_device * pdev = to_platform_device ( dev ) ; struct sun4i_frontend * frontend ; struct drm_device * drm = data ; struct sun4i_drv * drv = drm -> dev_private ; void __iomem * regs ; frontend = devm_kzalloc ( dev , sizeof ( * frontend ) , GFP_KERNEL ) ; if ( ! frontend ) { return - ENOMEM ; } dev_set_drvdata ( dev , frontend ) ; frontend -> dev = dev ; frontend -> node = dev -> of_node ; frontend -> data = of_device_get_match_data ( dev ) ; regs = devm_platform_ioremap_resource ( pdev , 0 ) ; if ( IS_ERR ( regs ) ) { return PTR_ERR ( regs ) ; } frontend -> regs = devm_regmap_init_mmio ( dev , regs , & sun4i_frontend_regmap_config ) ; if ( IS_ERR ( frontend -> regs ) ) { dev_err ( dev , "Couldn't create the frontend regmap\n" ) ; return PTR_ERR ( frontend -> regs ) ; } frontend -> reset = devm_reset_control_get ( dev , NULL ) ; if ( IS_ERR ( frontend -> reset ) ) { dev_err ( dev , "Couldn't get our reset line\n" ) ; return PTR_ERR ( frontend -> reset ) ; } frontend -> bus_clk = devm_clk_get ( dev , "ahb" ) ; if ( IS_ERR ( frontend -> bus_clk ) ) { dev_err ( dev , "Couldn't get our bus clock\n" ) ; return PTR_ERR ( frontend -> bus_clk ) ; } frontend -> mod_clk = devm_clk_get ( dev , "mod" ) ; if ( IS_ERR ( frontend -> mod_clk ) ) { dev_err ( dev , "Couldn't get our mod clock\n" ) ; return PTR_ERR ( frontend -> mod_clk ) ; } frontend -> ram_clk = devm_clk_get ( dev , "ram" ) ; if ( IS_ERR ( frontend -> ram_clk ) ) { dev_err ( dev , "Couldn't get our ram clock\n" ) ; return PTR_ERR ( frontend -> ram_clk ) ; } list_add_tail ( & frontend -> list , & drv -> frontend_list ) ; pm_runtime_enable ( dev ) ; return 0 ; } 