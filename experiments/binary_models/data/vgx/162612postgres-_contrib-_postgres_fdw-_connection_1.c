static bool pgfdw_cancel_query ( PGconn * conn ) { PGcancel * cancel ; char errbuf [ 256 ] ; PGresult * result = NULL ; TimestampTz endtime ; bool timed_out ; endtime = TimestampTzPlusMilliseconds ( GetCurrentTimestamp ( ) , 30000 ) ; if ( ( cancel = PQgetCancel ( conn ) ) ) { if ( ! PQcancel ( cancel , errbuf , sizeof ( errbuf ) ) ) { ereport ( WARNING , ( errcode ( ERRCODE_CONNECTION_FAILURE ) , errmsg ( "could not send cancel request: %s" , errbuf ) ) ) ; PQfreeCancel ( cancel ) ; return false ; } PQfreeCancel ( cancel ) ; } if ( pgfdw_get_cleanup_result ( conn , endtime , & result , & timed_out ) ) { if ( timed_out ) { ereport ( WARNING , ( errmsg ( "could not get result of cancel request due to timeout" ) ) ) ; } else { ereport ( WARNING , ( errcode ( ERRCODE_CONNECTION_FAILURE ) , errmsg ( "could not get result of cancel request: %s" , pchomp ( PQerrorMessage ( conn ) ) ) ) ) ; } return false ; } return true ; } 