void ral_rssadapt_lower_rate ( struct ieee80211com * ic , struct ieee80211_node * ni , struct ral_rssadapt * ra , struct ral_rssdesc * id ) { struct ieee80211_rateset * rs = & ni -> in_rates ; uint16_t last_thr ; uint32_t i , thridx , top ; ra -> ra_nfail ++ ; for ( i = 0 , top = RAL_RSSADAPT_BKT0 ; i < RAL_RSSADAPT_BKTS ; i ++ , top <<= RAL_RSSADAPT_BKTPOWER ) { thridx = i ; if ( id -> id_len <= top ) { break ; } } last_thr = ra -> ra_rate_thresh [ thridx ] [ id -> id_rateidx ] ; ra -> ra_rate_thresh [ thridx ] [ id -> id_rateidx ] = interpolate ( master_expavgctl . rc_thresh , last_thr , ( id -> id_rssi << 8 ) ) ; } 