int miocpullup ( mblk_t * iocmp , size_t size ) { struct iocblk * iocp = ( iocblk * ) iocmp -> b_rptr ; mblk_t * datamp = iocmp -> b_cont ; mblk_t * newdatamp ; ASSERT ( MBLKL ( iocmp ) == sizeof ( iocblk ) ) ; if ( MBLKL ( iocmp ) != sizeof ( iocblk ) ) { cmn_err ( CE_WARN , "miocpullup: passed mblk_t %p is not an ioctl" " mblk_t" , ( void * ) iocmp ) ; return ( EINVAL ) ; } if ( iocp -> ioc_count == TRANSPARENT ) { return ( EINVAL ) ; } if ( size == 0 ) { return ( 0 ) ; } if ( datamp == NULL ) { return ( EINVAL ) ; } if ( MBLKL ( datamp ) >= size ) { return ( 0 ) ; } newdatamp = msgpullup ( datamp , size ) ; if ( newdatamp == NULL ) { if ( msgdsize ( datamp ) < size ) { return ( EINVAL ) ; } return ( ENOMEM ) ; } iocmp -> b_cont = newdatamp ; return ( 0 ) ; } 