static void applespi_setup_read_txfrs ( struct applespi_data * applespi ) { struct spi_message * msg = & applespi -> rd_m ; struct spi_transfer * dl_t = & applespi -> dl_t ; struct spi_transfer * rd_t = & applespi -> rd_t ; memset ( rd_t , 0 , sizeof ( * rd_t ) ) ; dl_t -> delay . value = applespi -> spi_settings . spi_cs_delay ; dl_t -> delay . unit = SPI_DELAY_UNIT_USECS ; rd_t -> rx_buf = applespi -> rx_buffer ; rd_t -> len = APPLESPI_PACKET_SIZE ; spi_message_init ( msg ) ; spi_message_add_tail ( dl_t , msg ) ; spi_message_add_tail ( rd_t , msg ) ; } 