int safe_read ( int fd , void * buf , size_t sz ) { int ret ; size_t cnt = 0 ; char * cp = ( char * ) buf ; { switch ( ret = read ( fd , cp + cnt , sz - cnt ) ) { case 0 : return ( 1 ) ; case - 1 : if ( errno == EAGAIN ) { return ( 1 ) ; } if ( errno != EINTR ) { error_msg ( gettext ( "Unexpected read error: %s" ) , strerror ( errno ) ) ; return ( - 1 ) ; } break ; default : cnt += ret ; } } cnt != sz ; return ( 0 ) ; } 