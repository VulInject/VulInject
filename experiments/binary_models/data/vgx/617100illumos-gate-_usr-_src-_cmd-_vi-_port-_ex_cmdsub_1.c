void zop ( int hadpr ) { int c , nlines , op ; bool excl ; zhadpr = hadpr ; notempty ( ) ; znoclear = 0 ; excl = exclam ( ) ; switch ( c = op = getchar ( ) ) { case '^' : zweight = 1 ; case '-' : case '+' : while ( peekchar ( ) == op ) { ignchar ( ) ; zweight ++ ; } case '=' : case '.' : c = getchar ( ) ; break ; case EOF : znoclear ++ ; break ; default : op = 0 ; break ; } if ( isdigit ( c ) ) { nlines = c - '0' ; for ( ; ; ) { c = getchar ( ) ; if ( ! isdigit ( c ) ) { break ; } nlines *= 10 ; nlines += c - '0' ; } if ( nlines < lines ) { znoclear ++ ; } value ( vi_WINDOW ) = nlines ; if ( op == '=' ) { nlines += 2 ; } } else { nlines = op == EOF ?value ( vi_SCROLL ) : excl ?lines - 1 : value ( vi_WINDOW ) ; } if ( inopen || c != EOF ) { ungetchar ( c ) ; donewline ( ) ; } addr1 = addr2 ; if ( addr2 == 0 && dot < dol && op == 0 ) { addr1 = addr2 = dot + 1 ; } setdot ( ) ; zop2 ( nlines , op ) ; } 