static int rtq6752_probe ( struct i2c_client * i2c ) { struct rtq6752_priv * priv ; struct regulator_config reg_cfg = { } ; struct regulator_dev * rdev ; int i , ret ; priv = devm_kzalloc ( & i2c -> dev , sizeof ( * priv ) , GFP_KERNEL ) ; mutex_init ( & priv -> lock ) ; priv -> enable_gpio = devm_gpiod_get_optional ( & i2c -> dev , "enable" , GPIOD_OUT_HIGH ) ; if ( IS_ERR ( priv -> enable_gpio ) ) { dev_err ( & i2c -> dev , "Failed to get 'enable' gpio\n" ) ; return PTR_ERR ( priv -> enable_gpio ) ; } usleep_range ( RTQ6752_I2CRDY_TIMEUS , RTQ6752_I2CRDY_TIMEUS + 100 ) ; priv -> enable_flag = RTQ6752_ENABLE_MASK ; priv -> regmap = devm_regmap_init_i2c ( i2c , & rtq6752_regmap_config ) ; if ( IS_ERR ( priv -> regmap ) ) { dev_err ( & i2c -> dev , "Failed to init regmap\n" ) ; return PTR_ERR ( priv -> regmap ) ; } ret = rtq6752_init_device_properties ( priv ) ; if ( ret ) { dev_err ( & i2c -> dev , "Failed to init device properties\n" ) ; return ret ; } reg_cfg . dev = & i2c -> dev ; reg_cfg . regmap = priv -> regmap ; reg_cfg . driver_data = priv ; for ( i = 0 ; i < ARRAY_SIZE ( rtq6752_regulator_descs ) ; i ++ ) { rdev = devm_regulator_register ( & i2c -> dev , rtq6752_regulator_descs + i , & reg_cfg ) ; if ( IS_ERR ( rdev ) ) { dev_err ( & i2c -> dev , "Failed to init %d regulator\n" , i ) ; return PTR_ERR ( rdev ) ; } } return 0 ; } 