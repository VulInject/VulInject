void mmp2_pm_enter_lowpower_mode ( int state ) { uint32_t idle_cfg , apcr ; idle_cfg = __raw_readl ( APMU_PJ_IDLE_CFG ) ; apcr = __raw_readl ( MPMU_PCR_PJ , NULL ) ; apcr &= ~ ( MPMU_PCR_PJ_SLPEN | MPMU_PCR_PJ_DDRCORSD | MPMU_PCR_PJ_APBSD | MPMU_PCR_PJ_AXISD | MPMU_PCR_PJ_VCTCXOSD | ( 1 << 13 ) ) ; idle_cfg &= ~ APMU_PJ_IDLE_CFG_PJ_IDLE ; switch ( state ) { case POWER_MODE_SYS_SLEEP : apcr |= MPMU_PCR_PJ_SLPEN ; apcr |= MPMU_PCR_PJ_VCTCXOSD ; case POWER_MODE_CHIP_SLEEP : apcr |= MPMU_PCR_PJ_SLPEN ; case POWER_MODE_APPS_SLEEP : apcr |= MPMU_PCR_PJ_APBSD ; case POWER_MODE_APPS_IDLE : apcr |= MPMU_PCR_PJ_AXISD ; apcr |= MPMU_PCR_PJ_DDRCORSD ; idle_cfg |= APMU_PJ_IDLE_CFG_PJ_PWRDWN ; apcr |= MPMU_PCR_PJ_SPSD ; case POWER_MODE_CORE_EXTIDLE : idle_cfg |= APMU_PJ_IDLE_CFG_PJ_IDLE ; idle_cfg &= ~ APMU_PJ_IDLE_CFG_ISO_MODE_CNTRL_MASK ; idle_cfg |= APMU_PJ_IDLE_CFG_PWR_SW ( 3 ) | APMU_PJ_IDLE_CFG_L2_PWR_SW ; break ; case POWER_MODE_CORE_INTIDLE : apcr &= ~ MPMU_PCR_PJ_SPSD ; break ; } apcr |= ( 1 << 30 ) | ( 1 << 25 ) ; __raw_writel ( idle_cfg , APMU_PJ_IDLE_CFG ) ; __raw_writel ( apcr , MPMU_PCR_PJ ) ; } 