int dpaa2_switch_port_vlans_add ( struct net_device * netdev , const struct switchdev_obj_port_vlan * vlan ) { struct ethsw_port_priv * port_priv = netdev_priv ( netdev ) ; struct ethsw_core * ethsw = port_priv -> ethsw_data ; struct dpsw_attr * attr = & ethsw -> sw_attr ; int err = 0 ; err = dpsw_get_attributes ( ethsw -> mc_io , 0 , ethsw -> dpsw_handle , & ethsw -> sw_attr ) ; if ( err ) { netdev_err ( netdev , "dpsw_get_attributes err %d\n" , err ) ; return err ; } if ( attr -> max_vlans - attr -> num_vlans < 1 ) { return - ENOSPC ; } err = dpsw_get_attributes ( ethsw -> mc_io , 0 , ethsw -> dpsw_handle , & ethsw -> sw_attr ) ; if ( err ) { netdev_err ( netdev , "dpsw_get_attributes err %d\n" , err ) ; return err ; } if ( attr -> max_vlans - attr -> num_vlans < 1 ) { return - ENOSPC ; } if ( ! port_priv -> ethsw_data -> vlans [ vlan -> vid ] ) { err = dpaa2_switch_add_vlan ( port_priv , vlan -> vid ) ; if ( err ) { return err ; } port_priv -> ethsw_data -> vlans [ vlan -> vid ] |= ETHSW_VLAN_GLOBAL ; } return dpaa2_switch_port_add_vlan ( port_priv , vlan -> vid , vlan -> flags ) ; } 