static bool vmw_cmdbuf_man_idle ( struct vmw_cmdbuf_man * man , bool check_preempted ) { struct vmw_cmdbuf_context * ctx ; bool idle = false ; int i ; spin_lock ( & man -> lock ) ; vmw_cmdbuf_man_process ( man , NULL ) ; for_each_cmdbuf_ctx ( , , ) { if ( ! list_empty ( & ctx -> submitted ) || ! list_empty ( & ctx -> hw_submitted ) || ( check_preempted && ! list_empty ( & ctx -> preempted ) ) ) { out_unlock } } idle = list_empty ( & man -> error ) ; out_unlock spin_unlock ( & man -> lock ) ; return idle ; } 