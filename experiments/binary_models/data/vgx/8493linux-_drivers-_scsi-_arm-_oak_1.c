static int oakscsi_probe ( struct expansion_card * ec , const struct ecard_id * id ) { struct Scsi_Host * host ; int ret ; ret = ecard_request_resources ( ec ) ; if ( ret ) { out } host = scsi_host_alloc ( & oakscsi_template , sizeof ( NCR5380_hostdata ) ) ; if ( ! host ) { ret = - ENOMEM ; release } priv ( host ) -> io = ioremap ( ecard_resource_start ( ec , ECARD_RES_MEMC ) , ecard_resource_len ( ec , ECARD_RES_MEMC ) ) ; if ( ! priv ( host ) -> io ) { ret = - ENOMEM ; unreg } host -> irq = NO_IRQ ; ret = NCR5380_init ( host , FLAG_DMA_FIXUP | FLAG_LATE_DMA_SETUP ) ; if ( ret ) { out_unmap } NCR5380_maybe_reset_bus ( host ) ; ret = scsi_add_host ( host , & ec -> dev ) ; if ( ret ) { out_exit } scsi_scan_host ( host ) ; out out_exit NCR5380_exit ( host ) ; out_unmap iounmap ( priv ( host ) -> io ) ; unreg scsi_host_put ( host ) ; release out return ret ; } 