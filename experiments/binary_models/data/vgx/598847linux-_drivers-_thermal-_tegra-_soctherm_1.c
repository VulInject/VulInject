static int soctherm_thermtrips_parse ( struct platform_device * pdev ) { struct device * dev = & pdev -> dev ; struct tegra_soctherm * ts = dev_get_drvdata ( dev ) ; struct tsensor_group_thermtrips * tt = ts -> soc -> thermtrips ; const int max_num_prop = ts -> soc -> num_ttgs * 2 ; u32 * tlb ; int i , j , n , ret ; n = of_property_count_u32_elems ( dev -> of_node , "nvidia,thermtrips" ) ; if ( n <= 0 ) { dev_info ( dev , "missing thermtrips, will use critical trips as shut down temp\n" ) ; return n ; } n = min ( max_num_prop , n ) ; tlb = devm_kcalloc ( & pdev -> dev , max_num_prop , sizeof ( u32 ) , GFP_KERNEL ) ; if ( ! tlb ) { return - ENOMEM ; } ret = of_property_read_u32_array ( dev -> of_node , "nvidia,thermtrips" , tlb , n ) ; if ( ret ) { dev_err ( dev , "invalid num ele: thermtrips:%d\n" , ret ) ; return ret ; } i = 0 ; for ( j = 0 ; j < n ; j = j + 2 ) { if ( tlb [ j ] >= TEGRA124_SOCTHERM_SENSOR_NUM ) { continue ; } tt [ i ] . id = tlb [ j ] ; tt [ i ] . temp = tlb [ j + 1 ] ; i ++ ; } return 0 ; } 