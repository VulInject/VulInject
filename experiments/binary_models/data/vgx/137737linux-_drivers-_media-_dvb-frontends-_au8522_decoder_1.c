static int au8522_probe ( struct i2c_client * client ) { struct au8522_state * state ; struct v4l2_ctrl_handler * hdl ; struct v4l2_subdev * sd ; int instance ; int ret ; instance = au8522_get_state ( & state , client -> adapter , client -> addr ) ; switch ( instance ) { case 0 : printk ( KERN_ERR "au8522_decoder allocation failed\n" ) ; return - EIO ; case 1 : printk ( KERN_INFO "au8522_decoder creating new instance...\n" ) ; break ; default : printk ( KERN_INFO "au8522_decoder attach existing instance.\n" ) ; break ; } state -> config . demod_address = 0x8e >> 1 ; state -> i2c = client -> adapter ; sd = & state -> sd ; v4l2_i2c_subdev_init ( sd , client , & au8522_ops ) ; state -> pads [ AU8522_PAD_IF_INPUT ] . flags = MEDIA_PAD_FL_SINK ; state -> pads [ AU8522_PAD_IF_INPUT ] . sig_type = PAD_SIGNAL_ANALOG ; state -> pads [ AU8522_PAD_VID_OUT ] . flags = MEDIA_PAD_FL_SOURCE ; state -> pads [ AU8522_PAD_VID_OUT ] . sig_type = PAD_SIGNAL_DV ; state -> pads [ AU8522_PAD_AUDIO_OUT ] . flags = MEDIA_PAD_FL_SOURCE ; state -> pads [ AU8522_PAD_AUDIO_OUT ] . sig_type = PAD_SIGNAL_AUDIO ; sd -> entity . function = MEDIA_ENT_F_ATV_DECODER ; ret = media_entity_pads_init ( & sd -> entity , ARRAY_SIZE ( state -> pads ) , state -> pads ) ; if ( ret < 0 ) { v4l_info ( client , "failed to initialize media entity!\n" ) ; return ret ; } hdl = & state -> hdl ; v4l2_ctrl_handler_init ( hdl , 4 ) ; v4l2_ctrl_new_std ( hdl , & au8522_ctrl_ops , V4L2_CID_BRIGHTNESS , 0 , 255 , 1 , 109 ) ; v4l2_ctrl_new_std ( hdl , & au8522_ctrl_ops , V4L2_CID_CONTRAST , 0 , 255 , 1 , AU8522_TVDEC_CONTRAST_REG00BH_CVBS ) ; v4l2_ctrl_new_std ( hdl , & au8522_ctrl_ops , V4L2_CID_SATURATION , 0 , 255 , 1 , 128 ) ; v4l2_ctrl_new_std ( hdl , & au8522_ctrl_ops , V4L2_CID_HUE , - 32768 , 32767 , 1 , 0 ) ; sd -> ctrl_handler = hdl ; if ( hdl -> error ) { int err = hdl -> error ; v4l2_ctrl_handler_free ( hdl ) ; au8522_release_state ( state ) ; return err ; } state -> c = client ; state -> std = V4L2_STD_NTSC_M ; state -> vid_input = AU8522_COMPOSITE_CH1 ; state -> aud_input = AU8522_AUDIO_NONE ; state -> id = 8522 ; state -> rev = 0 ; au8522_writereg ( state , 0x106 , 1 ) ; return 0 ; } 