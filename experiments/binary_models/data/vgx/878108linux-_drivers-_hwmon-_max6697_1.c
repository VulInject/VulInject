static umode_t max6697_is_visible ( struct kobject * kobj , struct attribute * attr , int index ) { struct device * dev = kobj_to_dev ( kobj ) ; struct max6697_data * data = dev_get_drvdata ( dev ) ; const struct max6697_chip_data * chip = data -> chip ; int channel = index / 7 ; int nr = index % 7 ; if ( ( nr == 3 || nr == 4 ) && ! ( chip -> have_crit & ( 1 << channel ) ) ) { return 0 ; } if ( nr == 5 && ! ( chip -> have_fault & ( 1 << channel ) ) ) { return 0 ; } if ( nr == 6 ) { if ( data -> type != max6581 || channel == 0 ) { return 0 ; } } return attr -> mode ; } 