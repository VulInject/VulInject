static int snd_emux_load_patch_seq_oss ( struct snd_seq_oss_arg * arg , int format , const char __user * buf , int offs , int count ) { struct snd_emux * emu ; struct snd_emux_port * p ; int rc ; p = arg -> private_data ; if ( snd_BUG_ON ( ! p ) ) { return - ENXIO ; } emu = p -> emu ; if ( snd_BUG_ON ( ! emu ) ) { return - ENXIO ; } if ( format == GUS_PATCH ) { rc = snd_soundfont_load_guspatch ( emu -> sflist , buf , count , SF_CLIENT_NO ( p -> chset . port ) ) ; } if ( format == SNDRV_OSS_SOUNDFONT_PATCH ) { struct soundfont_patch_info patch ; if ( count < ( int ) sizeof ( patch ) ) { return - EINVAL ; } if ( copy_from_user ( & patch , buf , sizeof ( patch ) ) ) { return - EFAULT ; } if ( patch . type >= SNDRV_SFNT_LOAD_INFO && patch . type <= SNDRV_SFNT_PROBE_DATA ) { rc = snd_soundfont_load ( emu -> sflist , buf , count , SF_CLIENT_NO ( p -> chset . port ) ) ; } else { if ( emu -> ops . load_fx ) { rc = emu -> ops . load_fx ( emu , patch . type , patch . optarg , buf , count ) ; } else { rc = - EINVAL ; } } } else { rc = 0 ; } return rc ; } 