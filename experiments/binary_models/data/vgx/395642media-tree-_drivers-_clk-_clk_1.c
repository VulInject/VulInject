static int clk_mux_determine_rate_flags ( struct clk_hw * hw , struct clk_rate_request * req , unsigned long flags ) { struct clk_core * core = hw -> core , * parent , * best_parent = NULL ; int i , num_parents , ret ; unsigned long best = 0 ; struct clk_rate_request parent_req = * req ; if ( core -> flags & CLK_SET_RATE_NO_REPARENT ) { parent = core -> parent ; if ( core -> flags & CLK_SET_RATE_PARENT ) { ret = __clk_determine_rate ( parent ?parent -> hw : NULL , & parent_req ) ; if ( ret ) { return ret ; } best = parent_req . rate ; } if ( parent ) { best = clk_core_get_rate_nolock ( parent ) ; } else { best = clk_core_get_rate_nolock ( core ) ; } out } num_parents = core -> num_parents ; for ( i = 0 ; i < num_parents ; i ++ ) { parent = clk_core_get_parent_by_index ( core , i ) ; if ( ! parent ) { continue ; } if ( core -> flags & CLK_SET_RATE_PARENT ) { parent_req = * req ; ret = __clk_determine_rate ( parent -> hw , & parent_req ) ; if ( ret ) { continue ; } } else { parent_req . rate = clk_core_get_rate_nolock ( parent ) ; } if ( mux_is_better_rate ( req -> rate , parent_req . rate , best , flags ) ) { best_parent = parent ; best = parent_req . rate ; } } out if ( best_parent ) { req -> best_parent_hw = best_parent -> hw ; } req -> best_parent_rate = best ; req -> rate = best ; return 0 ; } 