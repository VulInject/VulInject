static int open_svr ( const char * svr , int udp , struct sockaddr_storage * addr , socklen_t * addrlen ) { int fd = - 1 ; if ( ! extstrtoaddr ( svr , addr , addrlen , UNBOUND_DNS_PORT ) ) { printf ( "fatal: bad server specs '%s'\n" , svr ) ; exit ( 1 ) ; } fd = socket ( addr_is_ip6 ( addr , * addrlen ) ?PF_INET6 : PF_INET , udp ?SOCK_DGRAM : SOCK_STREAM , 0 ) ; if ( fd == - 1 ) { perror ( "socket() error" ) ; printf ( "socket: %s\n" , wsa_strerror ( WSAGetLastError ( ) ) ) ; exit ( 1 ) ; } if ( connect ( fd , ( sockaddr * ) addr , * addrlen ) < 0 ) { perror ( "connect() error" ) ; printf ( "connect: %s\n" , wsa_strerror ( WSAGetLastError ( ) ) ) ; exit ( 1 ) ; } return fd ; } 