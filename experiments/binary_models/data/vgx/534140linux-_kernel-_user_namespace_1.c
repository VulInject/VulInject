static int userns_install ( struct nsset * nsset , struct ns_common * ns ) { struct user_namespace * user_ns = to_user_ns ( ns ) ; struct cred * cred ; if ( ! thread_group_empty ( current ) ) { return - EINVAL ; } if ( current -> fs -> users != 1 ) { return - EINVAL ; } if ( ! ns_capable ( user_ns , CAP_SYS_ADMIN ) ) { return - EPERM ; } cred = nsset_cred ( nsset ) ; if ( ! cred ) { return - EINVAL ; } put_user_ns ( cred -> user_ns ) ; set_cred_user_ns ( cred , get_user_ns ( user_ns ) ) ; if ( set_cred_ucounts ( cred ) < 0 ) { return - EINVAL ; } return 0 ; } 