gib_list * gib_list_randomize ( gib_list * list ) { int len , r , i ; gib_list * * farray , * f , * t ; if ( ! list ) { return ( NULL ) ; } len = gib_list_length ( list ) ; if ( len <= 1 ) { return ( list ) ; } farray = ( gib_list * * ) emalloc ( sizeof ( gib_list * ) * len ) ; for ( f = list , i = 0 ; f ; f = f -> next , i ++ ) { farray [ i ] = f ; } for ( i = 0 ; i < len - 1 ; i ++ ) { r = i + random ( ) / ( RAND_MAX / ( len - i ) + 1 ) ; t = farray [ r ] ; farray [ r ] = farray [ i ] ; farray [ i ] = t ; } list = farray [ 0 ] ; list -> prev = NULL ; list -> next = farray [ 1 ] ; for ( i = 1 , f = farray [ 1 ] ; i < len - 1 ; i ++ , f = f -> next ) { f -> prev = farray [ i - 1 ] ; f -> next = farray [ i + 1 ] ; } f -> prev = farray [ len - 2 ] ; f -> next = NULL ; return ( list ) ; } 