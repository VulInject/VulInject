static int abx80x_set_alarm ( struct device * dev , struct rtc_wkalrm * t ) { struct i2c_client * client = to_i2c_client ( dev ) ; u8 alarm [ 6 ] ; int err ; alarm [ 0 ] = 0x0 ; alarm [ 1 ] = bin2bcd ( t -> time . tm_sec ) ; alarm [ 2 ] = bin2bcd ( t -> time . tm_min ) ; alarm [ 3 ] = bin2bcd ( t -> time . tm_hour ) ; alarm [ 4 ] = bin2bcd ( t -> time . tm_mday ) ; alarm [ 5 ] = bin2bcd ( t -> time . tm_mon + 1 ) ; err = i2c_smbus_write_i2c_block_data ( client , ABX8XX_REG_AHTH , sizeof ( alarm ) , alarm ) ; if ( err < 0 ) { dev_err ( & client -> dev , "Unable to write alarm registers\n" ) ; return - EIO ; } if ( t -> enabled ) { err = i2c_smbus_write_byte_data ( client , ABX8XX_REG_IRQ , ( ABX8XX_IRQ_IM_1_4 | ABX8XX_IRQ_AIE ) ) ; if ( err ) { return err ; } } return 0 ; } 