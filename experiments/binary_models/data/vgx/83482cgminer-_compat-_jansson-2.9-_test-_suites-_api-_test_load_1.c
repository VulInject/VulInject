static void decode_int_as_real ( ) { json_t * json ; json_error_t error ; const char * imprecise ; json_int_t expected ; char big [ 311 ] ; json = json_loads ( "42" , JSON_DECODE_INT_AS_REAL | JSON_DECODE_ANY , & error ) ; if ( ! json || ! json_is_real ( json ) || json_real_value ( json ) != 42.0 ) { fail ( "json_load decode int as real failed - int" ) ; } json_decref ( json ) ; imprecise = "9007199254740993" ; expected = 9007199254740992ll ; json = json_loads ( imprecise , JSON_DECODE_INT_AS_REAL | JSON_DECODE_ANY , & error ) ; if ( ! json || ! json_is_real ( json ) || expected != ( json_int_t ) json_real_value ( json ) ) { fail ( "json_load decode int as real failed - expected imprecision" ) ; } json_decref ( json ) ; big [ 0 ] = '1' ; big [ 310 ] = '\0' ; json = json_loads ( big , JSON_DECODE_INT_AS_REAL | JSON_DECODE_ANY , & error ) ; if ( json || strcmp ( error . text , "real number overflow" ) != 0 ) { fail ( "json_load decode int as real failed - expected overflow" ) ; } json_decref ( json ) ; } 