static int yas5xx_read_raw ( struct iio_dev * indio_dev , struct iio_chan_spec const * chan , int * val , int * val2 , long mask ) { struct yas5xx * yas5xx = iio_priv ( indio_dev ) ; const struct yas5xx_chip_info * ci = yas5xx -> chip_info ; s32 t , x , y , z ; int ret ; switch ( mask ) { case IIO_CHAN_INFO_PROCESSED : case IIO_CHAN_INFO_RAW : pm_runtime_get_sync ( yas5xx -> dev ) ; ret = ci -> get_measure ( yas5xx , & t , & x , & y , & z ) ; pm_runtime_mark_last_busy ( yas5xx -> dev ) ; pm_runtime_put_autosuspend ( yas5xx -> dev ) ; switch ( chan -> address ) { case 0 : * val = t ; break ; case 1 : * val = x ; break ; case 2 : * val = y ; break ; case 3 : * val = z ; break ; default : dev_err ( yas5xx -> dev , "unknown channel\n" ) ; return - EINVAL ; } return IIO_VAL_INT ; case IIO_CHAN_INFO_SCALE : * val = 1 ; * val2 = ci -> scaling_val2 ; return IIO_VAL_FRACTIONAL ; default : return - EINVAL ; } } 