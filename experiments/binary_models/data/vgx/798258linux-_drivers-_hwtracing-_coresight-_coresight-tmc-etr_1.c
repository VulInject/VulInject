static struct etr_sg_table * tmc_init_etr_sg_table ( struct device * dev , int node , unsigned long size , void * * pages ) { int nr_entries , nr_tpages ; int nr_dpages = size >> PAGE_SHIFT ; struct tmc_sg_table * sg_table ; struct etr_sg_table * etr_table ; etr_table = kzalloc ( sizeof ( * etr_table ) , GFP_KERNEL ) ; if ( ! etr_table ) { return ERR_PTR ( - ENOMEM ) ; } nr_entries = tmc_etr_sg_table_entries ( nr_dpages ) ; nr_tpages = DIV_ROUND_UP ( nr_entries , ETR_SG_PTRS_PER_SYSPAGE ) ; sg_table = tmc_alloc_sg_table ( dev , node , nr_tpages , nr_dpages , pages ) ; if ( IS_ERR ( sg_table ) ) { kfree ( etr_table ) ; return ERR_CAST ( sg_table ) ; } etr_table -> sg_table = sg_table ; etr_table -> hwaddr = sg_table -> table_daddr ; tmc_etr_sg_table_populate ( etr_table , NULL ) ; tmc_sg_table_sync_table ( sg_table ) ; tmc_etr_sg_table_dump ( etr_table ) ; return etr_table ; } 