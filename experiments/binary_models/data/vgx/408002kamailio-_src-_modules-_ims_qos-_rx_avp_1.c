AAA_AVP * rx_create_codec_data_avp ( str * raw_sdp_stream , int number , int direction ) { str data ; int l = 0 ; AAA_AVP * result ; data . len = 0 ; switch ( direction ) { case 0 : data . len = 13 ; break ; case 1 : data . len = 14 ; break ; case 2 : data . len = 15 ; break ; case 3 : data . len = 16 ; break ; default : break ; } data . len += raw_sdp_stream -> len + 1 ; LM_DBG ( "data.len is calculated %i, sdp-stream has a len of %i\n" , data . len , raw_sdp_stream -> len ) ; data . s = ( char * ) pkg_malloc ( data . len ) ; switch ( direction ) { case 0 : memcpy ( data . s , "uplink\noffer\n" , 13 ) ; l = 13 ; break ; case 1 : memcpy ( data . s , "uplink\nanswer\n" , 14 ) ; l = 14 ; break ; case 2 : memcpy ( data . s , "downlink\noffer\n" , 15 ) ; l = 15 ; break ; case 3 : memcpy ( data . s , "downlink\nanswer\n" , 16 ) ; l = 16 ; break ; default : break ; } memcpy ( data . s + l , raw_sdp_stream -> s , raw_sdp_stream -> len ) ; LM_DBG ( "data.s = \"%.*s\"\n" , data . len , data . s ) ; result = cdpb . AAACreateAVP ( AVP_IMS_Codec_Data , AAA_AVP_FLAG_MANDATORY | AAA_AVP_FLAG_VENDOR_SPECIFIC , IMS_vendor_id_3GPP , data . s , data . len , AVP_DUPLICATE_DATA ) ; pkg_free ( data . s ) ; return result ; } 