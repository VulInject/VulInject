static int max98925_dai_set_fmt ( struct snd_soc_dai * codec_dai , unsigned int fmt ) { struct snd_soc_component * component = codec_dai -> component ; struct max98925_priv * max98925 = snd_soc_component_get_drvdata ( component ) ; int invert = 0 ; dev_dbg ( component -> dev , "%s: fmt 0x%08X\n" , __func__ , fmt ) ; switch ( fmt & SND_SOC_DAIFMT_CLOCK_PROVIDER_MASK ) { case SND_SOC_DAIFMT_CBC_CFC : regmap_update_bits ( max98925 -> regmap , MAX98925_DAI_CLK_MODE2 , M98925_DAI_MAS_MASK , 0 ) ; max98925_set_sense_data ( max98925 ) ; break ; case SND_SOC_DAIFMT_CBP_CFP : regmap_update_bits ( max98925 -> regmap , MAX98925_DAI_CLK_MODE2 , M98925_DAI_MAS_MASK , M98925_DAI_MAS_MASK ) ; break ; default : dev_err ( component -> dev , "DAI clock mode unsupported" ) ; return - EINVAL ; } switch ( fmt & SND_SOC_DAIFMT_INV_MASK ) { case SND_SOC_DAIFMT_NB_NF : break ; case SND_SOC_DAIFMT_NB_IF : invert = M98925_DAI_WCI_MASK ; break ; case SND_SOC_DAIFMT_IB_NF : invert = M98925_DAI_BCI_MASK ; break ; case SND_SOC_DAIFMT_IB_IF : invert = M98925_DAI_BCI_MASK | M98925_DAI_WCI_MASK ; break ; default : dev_err ( component -> dev , "DAI invert mode unsupported" ) ; return - EINVAL ; } regmap_update_bits ( max98925 -> regmap , MAX98925_FORMAT , M98925_DAI_BCI_MASK | M98925_DAI_WCI_MASK , invert ) ; return 0 ; } 