static bool pll_adjust_pix_clk ( struct dce110_clk_src * clk_src , struct pixel_clk_params * pix_clk_params , struct pll_settings * pll_settings ) { int actual_pix_clk_100hz = 0 ; uint32_t requested_clk_100hz = 0 ; struct bp_adjust_pixel_clock_parameters bp_adjust_pixel_clock_params = { 0 } ; enum bp_result bp_result ; switch ( pix_clk_params -> signal_type ) { case SIGNAL_TYPE_HDMI_TYPE_A : { requested_clk_100hz = pix_clk_params -> requested_pix_clk_100hz ; if ( pix_clk_params -> pixel_encoding != PIXEL_ENCODING_YCBCR422 ) { switch ( pix_clk_params -> color_depth ) { case COLOR_DEPTH_101010 : requested_clk_100hz = ( requested_clk_100hz * 5 ) >> 2 ; break ; case COLOR_DEPTH_121212 : requested_clk_100hz = ( requested_clk_100hz * 6 ) >> 2 ; break ; case COLOR_DEPTH_161616 : requested_clk_100hz = requested_clk_100hz * 2 ; break ; default : break ; } } actual_pix_clk_100hz = requested_clk_100hz ; } break ; case SIGNAL_TYPE_DISPLAY_PORT : case SIGNAL_TYPE_DISPLAY_PORT_MST : case SIGNAL_TYPE_EDP : requested_clk_100hz = pix_clk_params -> requested_sym_clk * 10 ; actual_pix_clk_100hz = pix_clk_params -> requested_pix_clk_100hz ; break ; default : requested_clk_100hz = pix_clk_params -> requested_pix_clk_100hz ; actual_pix_clk_100hz = pix_clk_params -> requested_pix_clk_100hz ; break ; } bp_adjust_pixel_clock_params . pixel_clock = requested_clk_100hz / 10 ; bp_adjust_pixel_clock_params . encoder_object_id = pix_clk_params -> encoder_object_id ; bp_adjust_pixel_clock_params . signal_type = pix_clk_params -> signal_type ; bp_adjust_pixel_clock_params . ss_enable = pix_clk_params -> flags . ENABLE_SS ; bp_result = clk_src -> bios -> funcs -> adjust_pixel_clock ( clk_src -> bios , & bp_adjust_pixel_clock_params ) ; if ( bp_result == BP_RESULT_OK ) { pll_settings -> actual_pix_clk_100hz = actual_pix_clk_100hz ; pll_settings -> adjusted_pix_clk_100hz = bp_adjust_pixel_clock_params . adjusted_pixel_clock * 10 ; pll_settings -> reference_divider = bp_adjust_pixel_clock_params . reference_divider ; pll_settings -> pix_clk_post_divider = bp_adjust_pixel_clock_params . pixel_clock_post_divider ; return true ; } return false ; } 