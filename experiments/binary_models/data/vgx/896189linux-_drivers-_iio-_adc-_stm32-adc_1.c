static int stm32_adc_get_legacy_chan_count ( struct iio_dev * indio_dev , struct stm32_adc * adc ) { struct device * dev = & indio_dev -> dev ; const struct stm32_adc_info * adc_info = adc -> cfg -> adc_info ; int num_channels = 0 , ret ; ret = device_property_count_u32 ( dev , "st,adc-channels" ) ; if ( ret > adc_info -> max_channels ) { dev_err ( & indio_dev -> dev , "Bad st,adc-channels?\n" ) ; return - EINVAL ; } if ( ret > 0 ) { num_channels += ret ; } ret = device_property_count_u32 ( dev , "st,adc-diff-channels" ) ; ret /= ( int ) ( sizeof ( stm32_adc_diff_channel ) / sizeof ( u32 ) ) ; if ( ret > adc_info -> max_channels ) { dev_err ( & indio_dev -> dev , "Bad st,adc-diff-channels?\n" ) ; return - EINVAL ; } if ( ret > 0 ) { adc -> num_diff = ret ; num_channels += ret ; } adc -> nsmps = device_property_count_u32 ( dev , "st,min-sample-time-nsecs" ) ; if ( adc -> nsmps > 1 && adc -> nsmps != num_channels ) { dev_err ( & indio_dev -> dev , "Invalid st,min-sample-time-nsecs\n" ) ; return - EINVAL ; } return num_channels ; } 