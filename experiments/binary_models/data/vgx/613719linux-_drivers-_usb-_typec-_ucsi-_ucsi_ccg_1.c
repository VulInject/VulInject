static int ccg_read_response ( struct ucsi_ccg * uc ) { unsigned long target = jiffies + msecs_to_jiffies ( 1000 ) ; struct device * dev = uc -> dev ; u8 intval ; int status ; { status = ccg_read ( uc , CCGX_RAB_INTR_REG , & intval , sizeof ( intval ) ) ; if ( intval & DEV_INT ) { break ; } usleep_range ( 500 , 600 ) ; } time_is_after_jiffies ( target ) ; if ( time_is_before_jiffies ( target ) ) { dev_err ( dev , "response timeout error\n" ) ; return - ETIME ; } status = ccg_read ( uc , CCGX_RAB_RESPONSE , ( u8 * ) & uc -> dev_resp , sizeof ( uc -> dev_resp ) ) ; if ( status < 0 ) { return status ; } status = ccg_write ( uc , CCGX_RAB_INTR_REG , & intval , sizeof ( intval ) ) ; if ( status < 0 ) { return status ; } return 0 ; } 