static int fixedphy_config ( struct phy_device * phydev ) { ofnode node = phy_get_ofnode ( phydev ) ; struct fixed_link * priv ; bool old_binding = false ; u32 old_val [ 5 ] ; u32 val ; if ( ! ofnode_valid ( node ) ) { return - EINVAL ; } val = ofnode_read_u32_default ( node , "speed" , 0 ) ; if ( ! val ) { old_binding = true ; if ( ofnode_read_u32_array ( node , "fixed-link" , old_val , ARRAY_SIZE ( old_val ) ) ) { printf ( "ERROR: no/invalid<fixed-link>property!\n" ) ; return - ENOENT ; } val = old_val [ 2 ] ; } if ( val != SPEED_10 && val != SPEED_100 && val != SPEED_1000 && val != SPEED_2500 && val != SPEED_10000 ) { printf ( "ERROR: no/invalid speed given in fixed-link node!\n" ) ; return - EINVAL ; } priv = malloc ( sizeof ( * priv ) ) ; if ( ! priv ) { return - ENOMEM ; } phydev -> priv = priv ; priv -> link_speed = val ; if ( ! old_binding ) { priv -> duplex = ofnode_read_bool ( node , "full-duplex" ) ; priv -> pause = ofnode_read_bool ( node , "pause" ) ; priv -> asym_pause = ofnode_read_bool ( node , "asym-pause" ) ; } else { priv -> duplex = old_val [ 1 ] ; priv -> pause = old_val [ 3 ] ; priv -> asym_pause = old_val [ 4 ] ; } return 0 ; } 