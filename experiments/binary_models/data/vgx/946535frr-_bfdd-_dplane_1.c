static int bfd_dplane_enqueue ( struct bfd_dplane_ctx * bdc , const void * buf , size_t buflen ) { size_t rlen ; if ( buflen > STREAM_WRITEABLE ( bdc -> outbuf ) ) { bdc -> out_fullev ++ ; return - 1 ; } bfd_dplane_debug_message ( ( bfddp_message * ) buf ) ; stream_write ( bdc -> outbuf , buf , buflen ) ; bdc -> out_msgs ++ ; rlen = STREAM_READABLE ( bdc -> outbuf ) ; if ( bdc -> out_bytes_peak < rlen ) { bdc -> out_bytes_peak = rlen ; } if ( bdc -> outbufev == NULL ) { thread_add_write ( master , bfd_dplane_write , bdc , bdc -> sock , & bdc -> outbufev ) ; } return 0 ; } 