struct passwd * xgetpwnam ( const char * username , char * * pwdbuf ) { struct passwd * pwd = NULL , * res = NULL ; int rc ; assert ( pwdbuf ) ; assert ( username ) ; * pwdbuf = xmalloc ( UL_GETPW_BUFSIZ ) ; pwd = xcalloc ( 1 , sizeof ( passwd ) ) ; errno = 0 ; rc = getpwnam_r ( username , pwd , * pwdbuf , UL_GETPW_BUFSIZ , & res ) ; if ( rc != 0 ) { errno = rc ; failed } if ( ! res ) { errno = EINVAL ; failed } return pwd ; failed free ( * pwdbuf ) ; return NULL ; } 