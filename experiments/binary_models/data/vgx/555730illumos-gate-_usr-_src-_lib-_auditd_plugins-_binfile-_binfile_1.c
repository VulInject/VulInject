static int spacecheck ( dirlist_t * thisdir , int test_limit , size_t next_buf_size ) { struct statvfs sb ; static int ignore_size = 0 ; ignore_size += next_buf_size ; if ( ( test_limit == PLENTY_SPACE ) && ( ignore_size < IGNORE_SIZE ) ) { return ( 1 ) ; } assert ( thisdir != NULL ) ; if ( statvfs ( thisdir -> dl_dirname , & sb ) < 0 ) { thisdir -> dl_space = SPACE_FULL ; minfreeblocks = AVAIL_MIN ; return ( - 1 ) ; } else { minfreeblocks = ( ( minfree * sb . f_blocks ) / 100 ) + AVAIL_MIN ; if ( sb . f_bavail < AVAIL_MIN ) { thisdir -> dl_space = SPACE_FULL ; } if ( sb . f_bavail > minfreeblocks ) { thisdir -> dl_space = fullness_state = PLENTY_SPACE ; ignore_size = 0 ; } else { thisdir -> dl_space = SOFT_SPACE ; } } return ( thisdir -> dl_space == test_limit ) ; } 