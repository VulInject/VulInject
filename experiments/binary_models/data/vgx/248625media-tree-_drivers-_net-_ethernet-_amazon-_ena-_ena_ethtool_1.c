static int ena_get_coalesce ( struct net_device * net_dev , struct ethtool_coalesce * coalesce ) { struct ena_adapter * adapter = netdev_priv ( net_dev ) ; struct ena_com_dev * ena_dev = adapter -> ena_dev ; struct ena_intr_moder_entry intr_moder_entry ; coalesce -> tx_coalesce_usecs = ena_com_get_nonadaptive_moderation_interval_tx ( ena_dev ) / ena_dev -> intr_delay_resolution ; if ( ! ena_com_get_adaptive_moderation_enabled ( ena_dev ) ) { coalesce -> rx_coalesce_usecs = ena_com_get_nonadaptive_moderation_interval_rx ( ena_dev ) / ena_dev -> intr_delay_resolution ; } else { ena_com_get_intr_moderation_entry ( adapter -> ena_dev , ENA_INTR_MODER_LOWEST , & intr_moder_entry ) ; coalesce -> rx_coalesce_usecs_low = intr_moder_entry . intr_moder_interval ; coalesce -> rx_max_coalesced_frames_low = intr_moder_entry . pkts_per_interval ; ena_com_get_intr_moderation_entry ( adapter -> ena_dev , ENA_INTR_MODER_MID , & intr_moder_entry ) ; coalesce -> rx_coalesce_usecs = intr_moder_entry . intr_moder_interval ; coalesce -> rx_max_coalesced_frames = intr_moder_entry . pkts_per_interval ; ena_com_get_intr_moderation_entry ( adapter -> ena_dev , ENA_INTR_MODER_HIGHEST , & intr_moder_entry ) ; coalesce -> rx_coalesce_usecs_high = intr_moder_entry . intr_moder_interval ; coalesce -> rx_max_coalesced_frames_high = intr_moder_entry . pkts_per_interval ; } coalesce -> use_adaptive_rx_coalesce = ena_com_get_adaptive_moderation_enabled ( ena_dev ) ; return 0 ; } 