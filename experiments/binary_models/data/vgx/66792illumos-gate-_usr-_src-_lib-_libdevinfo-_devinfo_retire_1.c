static void rcm_finalize ( rcm_arg_t * rp , int retcode ) { rio_path_t * p ; rio_path_t * tmp ; int flags = RCM_RETIRE_NOTIFY ; int retval ; int error ; di_retire_t * dp ; dp = rp -> rcm_dp ; RIO_ASSERT ( dp , retcode == 0 || retcode == - 1 ) ; dp -> rt_debug ( dp -> rt_hdl , "[INFO]: rcm_finalize: retcode=%d: dev=%s\n" , retcode , rp -> rcm_root ) ; for ( p = rp -> rcm_cons_nodes ; p ; ) { tmp = p ; p = tmp -> rpt_next ; } rp -> rcm_cons_nodes = NULL ; dp -> rt_debug ( dp -> rt_hdl , "[INFO]: rcm_finalize: cons_nodes NULL\n" ) ; for ( p = rp -> rcm_rsrc_minors ; p ; ) { tmp = p ; p = tmp -> rpt_next ; if ( retcode == 0 ) { retval = rp -> rcm_remove ( rp -> rcm_handle , tmp -> rpt_path , flags , NULL ) ; error = errno ; } else { RIO_ASSERT ( dp , retcode == - 1 ) ; retval = rp -> rcm_online ( rp -> rcm_handle , tmp -> rpt_path , flags , NULL ) ; error = errno ; } if ( retval != RCM_SUCCESS ) { dp -> rt_debug ( dp -> rt_hdl , "[ERROR]: rcm_finalize: " "rcm_%s: retval=%d: error=%s: path=%s\n" , retcode == 0 ?"remove" : "online" , retval , strerror ( error ) , tmp -> rpt_path ) ; } else { dp -> rt_debug ( dp -> rt_hdl , "[INFO]: rcm_finalize: " "rcm_%s: SUCCESS: path=%s\n" , retcode == 0 ?"remove" : "online" , tmp -> rpt_path ) ; } free ( tmp ) ; } rp -> rcm_rsrc_minors = NULL ; } 