static int kirkwood_thermal_probe ( struct platform_device * pdev ) { struct thermal_zone_device * thermal = NULL ; struct kirkwood_thermal_priv * priv ; int ret ; priv = devm_kzalloc ( & pdev -> dev , sizeof ( * priv ) , GFP_KERNEL ) ; priv -> sensor = devm_platform_get_and_ioremap_resource ( pdev , 0 , NULL ) ; if ( IS_ERR ( priv -> sensor ) ) { return PTR_ERR ( priv -> sensor ) ; } thermal = thermal_zone_device_register ( "kirkwood_thermal" , 0 , 0 , priv , & ops , NULL , 0 , 0 ) ; if ( IS_ERR ( thermal ) ) { dev_err ( & pdev -> dev , "Failed to register thermal zone device\n" ) ; return PTR_ERR ( thermal ) ; } ret = thermal_zone_device_enable ( thermal ) ; if ( ret ) { thermal_zone_device_unregister ( thermal ) ; dev_err ( & pdev -> dev , "Failed to enable thermal zone device\n" ) ; return ret ; } platform_set_drvdata ( pdev , thermal ) ; return 0 ; } 