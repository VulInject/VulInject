static void blk_throtl_update_idletime ( struct throtl_grp * tg ) { unsigned long now = ktime_get_ns ( ) >> 10 ; cfs_time_t last_finish_time = tg -> last_finish_time ; if ( now <= last_finish_time || last_finish_time == 0 || last_finish_time == tg -> checked_last_finish_time ) { return ; } tg -> avg_idletime = ( tg -> avg_idletime * 7 + now - last_finish_time ) >> 3 ; tg -> checked_last_finish_time = last_finish_time ; } 