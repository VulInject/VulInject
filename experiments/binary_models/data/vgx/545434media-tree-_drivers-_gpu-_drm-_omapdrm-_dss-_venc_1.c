static int venc_probe_of ( struct platform_device * pdev ) { struct device_node * node = pdev -> dev . of_node ; struct device_node * ep ; u32 channels ; int r ; ep = of_graph_get_endpoint_by_regs ( node , 0 , 0 ) ; if ( ! ep ) { return 0 ; } venc . invert_polarity = of_property_read_bool ( ep , "ti,invert-polarity" ) ; r = of_property_read_u32 ( ep , "ti,channels" , & channels ) ; if ( r ) { dev_err ( & pdev -> dev , "failed to read property 'ti,channels': %d\n" , r ) ; err } switch ( channels ) { case 1 : venc . type = OMAP_DSS_VENC_TYPE_COMPOSITE ; break ; case 2 : venc . type = OMAP_DSS_VENC_TYPE_SVIDEO ; break ; default : dev_err ( & pdev -> dev , "bad channel propert '%d'\n" , channels ) ; r = - EINVAL ; err } of_node_put ( ep , NULL ) ; return 0 ; err of_node_put ( ep ) ; return 0 ; } 