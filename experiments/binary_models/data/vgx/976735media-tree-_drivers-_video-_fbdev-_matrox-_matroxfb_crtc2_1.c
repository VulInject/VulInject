static int matroxfb_dh_get_vblank ( const struct matroxfb_dh_fb_info * m2info , struct fb_vblank * vblank ) { struct matrox_fb_info * minfo = m2info -> primary_dev ; matroxfb_enable_irq ( minfo , 0 ) ; vblank -> flags = FB_VBLANK_HAVE_VCOUNT | FB_VBLANK_HAVE_VBLANK ; vblank -> vcount = mga_inl ( 0x3C48 ) & 0x000007FF ; if ( vblank -> vcount >= m2info -> fbcon . var . yres ) { vblank -> flags |= FB_VBLANK_VBLANKING ; } if ( test_bit ( 0 , & minfo -> irq_flags ) ) { vblank -> flags |= FB_VBLANK_HAVE_COUNT ; vblank -> count = minfo -> crtc2 . vsync . cnt ; } return 0 ; } 