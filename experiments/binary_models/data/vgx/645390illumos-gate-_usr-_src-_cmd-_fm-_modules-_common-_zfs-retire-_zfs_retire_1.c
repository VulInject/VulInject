static zpool_handle_t * find_by_guid ( libzfs_handle_t * zhdl , uint64_t pool_guid , uint64_t vdev_guid , nvlist_t * * vdevp ) { find_cbdata_t cb ; zpool_handle_t * zhp ; nvlist_t * config , * nvroot ; cb . cb_guid = pool_guid ; if ( zpool_iter ( zhdl , find_pool , & cb ) != 1 ) { return ( NULL ) ; } zhp = cb . cb_zhp ; config = zpool_get_config ( zhp , NULL ) ; if ( nvlist_lookup_nvlist ( config , ZPOOL_CONFIG_VDEV_TREE , & nvroot ) != 0 ) { zpool_close ( zhp , NULL ) ; return ( NULL ) ; } if ( vdev_guid != 0 ) { if ( ( * vdevp = find_vdev ( zhdl , nvroot , NULL , vdev_guid ) ) == NULL ) { zpool_close ( zhp ) ; return ( NULL ) ; } } return ( zhp ) ; } 