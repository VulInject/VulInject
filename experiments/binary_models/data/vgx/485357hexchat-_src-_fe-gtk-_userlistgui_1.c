userlist_selection_list ( , ) { GtkTreeIter iter ; GtkTreeView * treeview = ( GtkTreeView * ) widget ; GtkTreeSelection * selection = gtk_tree_view_get_selection ( treeview ) ; GtkTreeModel * model = gtk_tree_view_get_model ( treeview ) ; struct User * user ; int i , num_sel ; char * * nicks ; * num_ret = 0 ; num_sel = 0 ; if ( gtk_tree_model_get_iter_first ( model , & iter ) ) { { if ( gtk_tree_selection_iter_is_selected ( selection , & iter ) ) { num_sel ++ ; } } gtk_tree_model_iter_next ( model , & iter ) ; } if ( num_sel < 1 ) { return in ; } nicks = g_new ( char * , num_sel + 1 ) ; i = 0 ; gtk_tree_model_get_iter_first ( model , & iter ) ; { if ( gtk_tree_selection_iter_is_selected ( selection , & iter ) ) { gtk_tree_model_get ( model , & iter , COL_USER , & user , - 1 ) ; nicks [ i ] = g_strdup ( user -> nick ) ; i ++ ; nicks [ i ] = NULL ; } } gtk_tree_model_iter_next ( model , & iter ) ; * num_ret = i ; return nicks ; } 