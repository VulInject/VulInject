unsigned long get_wchan ( struct task_struct * p ) { struct pt_regs * regs0 ; unsigned long fp , pc ; unsigned long stack_limit ; int count = 0 ; if ( ! p || p == current || p -> state == TASK_RUNNING ) { return 0 ; } stack_limit = ( unsigned long ) ( p + 1 ) ; fp = p -> thread . fp ; regs0 = p -> thread . frame0 ; { if ( fp < stack_limit || fp >= ( unsigned long ) regs0 || fp & 3 ) { return 0 ; } pc = ( ( unsigned long * ) fp ) [ 2 ] ; fp = * ( unsigned long * ) fp ; } count ++ < 16 ; return 0 ; } 