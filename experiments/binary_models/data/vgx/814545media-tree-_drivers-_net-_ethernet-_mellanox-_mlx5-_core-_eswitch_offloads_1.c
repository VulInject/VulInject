int mlx5_eswitch_inline_mode_get ( struct mlx5_eswitch * esw , int nvfs , u8 * mode ) { u8 prev_mlx5_mode , mlx5_mode = MLX5_INLINE_MODE_L2 ; struct mlx5_core_dev * dev = esw -> dev ; int vport ; if ( ! MLX5_CAP_GEN ( dev , vport_group_manager ) ) { return - EOPNOTSUPP ; } switch ( MLX5_CAP_ETH ( dev , wqe_inline_mode ) ) { case MLX5_CAP_INLINE_MODE_NOT_REQUIRED : mlx5_mode = MLX5_INLINE_MODE_NONE ; out case MLX5_CAP_INLINE_MODE_L2 : mlx5_mode = MLX5_INLINE_MODE_L2 ; out case MLX5_CAP_INLINE_MODE_VPORT_CONTEXT : query_vports } query_vports for ( vport = 1 ; vport <= nvfs ; vport ++ ) { mlx5_query_nic_vport_min_inline ( dev , vport , & mlx5_mode ) ; if ( vport > 1 && prev_mlx5_mode != mlx5_mode ) { return - EINVAL ; } prev_mlx5_mode = mlx5_mode ; } out * mode = mlx5_mode ; return 0 ; } 