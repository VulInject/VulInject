static void sge_tx_timer_cb ( unsigned long data ) { struct adapter * adapter = ( adapter * ) data ; struct sge * s = & adapter -> sge ; unsigned int i , budget ; budget = MAX_TIMER_TX_RECLAIM ; i = s -> ethtxq_rover ; { struct sge_eth_txq * txq = & s -> ethtxq [ i ] ; if ( reclaimable ( & txq -> q ) && __netif_tx_trylock ( txq -> txq ) ) { int avail = reclaimable ( & txq -> q ) ; if ( avail > budget ) { avail = budget ; } free_tx_desc ( adapter , & txq -> q , avail , true ) ; txq -> q . in_use -= avail ; __netif_tx_unlock ( txq -> txq ) ; budget -= avail ; } i ++ ; if ( i >= s -> ethqsets ) { i = 0 ; } } i != s -> ethtxq_rover ; s -> ethtxq_rover = i ; mod_timer ( & s -> tx_timer , jiffies + ( budget ?TX_QCHECK_PERIOD : 2 ) ) ; } 