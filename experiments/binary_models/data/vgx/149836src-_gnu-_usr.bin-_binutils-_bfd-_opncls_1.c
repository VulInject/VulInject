find_separate_debug_file ( , ) { char * basename ; char * dir ; char * debugfile ; unsigned long crc32 ; int i ; BFD_ASSERT ( abfd , NULL ) ; if ( debug_file_directory == NULL ) { debug_file_directory = "." ; } if ( ! abfd -> filename ) { return NULL ; } basename = get_debug_link_info ( abfd , & crc32 ) ; if ( basename == NULL ) { return NULL ; } if ( strlen ( basename ) < 1 ) { free ( basename ) ; return NULL ; } dir = strdup ( abfd -> filename ) ; if ( dir == NULL ) { free ( basename ) ; return NULL ; } BFD_ASSERT ( strlen ( dir ) != 0 ) ; for ( i = strlen ( dir ) - 1 ; i >= 0 ; i -- ) { if ( IS_DIR_SEPARATOR ( dir [ i ] ) ) { break ; } } dir [ i + 1 ] = '\0' ; BFD_ASSERT ( '/' 0 '\0' ) debugfile = malloc ( strlen ( debug_file_directory ) + 1 + strlen ( dir ) + strlen ( ".debug/" ) + strlen ( basename ) + 1 ) ; if ( debugfile == NULL ) { free ( basename ) ; free ( dir ) ; return NULL ; } strcpy ( debugfile , dir ) ; strcat ( debugfile , basename ) ; if ( separate_debug_file_exists ( debugfile , crc32 ) ) { free ( basename ) ; free ( dir ) ; return debugfile ; } strcpy ( debugfile , dir ) ; strcat ( debugfile , ".debug/" ) ; strcat ( debugfile , basename ) ; if ( separate_debug_file_exists ( debugfile , crc32 ) ) { free ( basename ) ; free ( dir ) ; return debugfile ; } strcpy ( debugfile , debug_file_directory ) ; i = strlen ( debug_file_directory ) - 1 ; if ( i > 0 && debug_file_directory [ i ] != '/' && dir [ 0 ] != '/' ) { strcat ( debugfile , "/" ) ; } strcat ( debugfile , dir ) ; strcat ( debugfile , basename ) ; if ( separate_debug_file_exists ( debugfile , crc32 ) ) { free ( basename ) ; free ( dir ) ; return debugfile ; } free ( debugfile ) ; free ( basename ) ; free ( dir ) ; return NULL ; } 