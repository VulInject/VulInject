START_TEST ( ) { int res ; pr_redis_t * redis ; mark_point ( ) ; redis = pr_redis_conn_new ( NULL , NULL , 0 ) ; ck_assert_msg ( redis == NULL , "Failed to handle null pool" ) ; ck_assert_msg ( errno == EINVAL , "Expected EINVAL (%d), got %s (%d)" , EINVAL , strerror ( errno ) , errno ) ; mark_point ( ) ; redis = pr_redis_conn_new ( p , NULL , 0 ) ; ck_assert_msg ( redis != NULL , "Failed to open connection to Redis: %s" , strerror ( errno ) ) ; mark_point ( ) ; res = pr_redis_conn_destroy ( redis ) ; ck_assert_msg ( res == TRUE , "Failed to close redis: %s" , strerror ( errno ) ) ; if ( getenv ( "CI" ) == NULL && getenv ( "CIRRUS_CLONE_DEPTH" ) == NULL && getenv ( "TRAVIS" ) == NULL ) { redis_set_server ( "127.1.2.3" , redis_port , 0UL , NULL , NULL ) ; mark_point ( ) ; redis = pr_redis_conn_new ( p , NULL , 0 ) ; ck_assert_msg ( redis == NULL , "Failed to handle invalid address" ) ; ck_assert_msg ( errno == EIO , "Expected EIO (%d), got %s (%d)" , EIO , strerror ( errno ) , errno ) ; } redis_set_server ( redis_server , 1020 , 0UL , NULL , NULL ) ; mark_point ( ) ; redis = pr_redis_conn_new ( p , NULL , 0 ) ; ck_assert_msg ( redis == NULL , "Failed to handle invalid port" ) ; ck_assert_msg ( errno == EIO , "Expected EIO (%d), got %s (%d)" , EIO , strerror ( errno ) , errno ) ; redis_set_server ( redis_server , redis_port , 0UL , NULL ) ; } 