static struct batadv_dat_candidate * batadv_dat_select_candidates ( struct batadv_priv * bat_priv , __be32 ip_dst , unsigned short vid ) { int select ; batadv_dat_addr_t last_max = BATADV_DAT_ADDR_MAX , ip_key ; struct batadv_dat_candidate * res ; struct batadv_dat_entry dat ; if ( ! bat_priv -> orig_hash ) { return in ; } res = kmalloc_array ( BATADV_DAT_CANDIDATES_NUM , sizeof ( * res ) , GFP_ATOMIC ) ; if ( ! res ) { return NULL ; } dat . ip = ip_dst ; dat . vid = vid ; ip_key = ( batadv_dat_addr_t ) batadv_hash_dat ( & dat , BATADV_DAT_ADDR_MAX ) ; batadv_dbg ( BATADV_DBG_DAT , bat_priv , "%s(): IP=%pI4 hash(IP)=%u\n" , __func__ , & ip_dst , ip_key ) ; for ( select = 0 ; select < BATADV_DAT_CANDIDATES_NUM ; select ++ ) { batadv_choose_next_candidate ( bat_priv , res , select , ip_key , & last_max ) ; } return res ; } 