int kvm_set_routing_entry ( struct kvm * kvm , struct kvm_kernel_irq_routing_entry * e , const struct kvm_irq_routing_entry * ue ) { switch ( ue -> type ) { case KVM_IRQ_ROUTING_IRQCHIP : e -> irqchip . pin = ue -> u . irqchip . pin ; switch ( ue -> u . irqchip . irqchip ) { case KVM_IRQCHIP_PIC_SLAVE : e -> irqchip . pin += PIC_NUM_PINS / 2 ; fallthrough ; case KVM_IRQCHIP_PIC_MASTER : if ( ue -> u . irqchip . pin >= PIC_NUM_PINS / 2 ) { return - EINVAL ; } e -> set = kvm_set_pic_irq ; break ; case KVM_IRQCHIP_IOAPIC : if ( ue -> u . irqchip . pin >= KVM_IOAPIC_NUM_PINS ) { return - EINVAL ; } e -> set = kvm_set_ioapic_irq ; break ; default : return - EINVAL ; } e -> irqchip . irqchip = ue -> u . irqchip . irqchip ; break ; case KVM_IRQ_ROUTING_MSI : e -> set = kvm_set_msi ; e -> msi . address_lo = ue -> u . msi . address_lo ; e -> msi . address_hi = ue -> u . msi . address_hi ; e -> msi . data = ue -> u . msi . data ; if ( kvm_msi_route_invalid ( kvm , e ) ) { return - EINVAL ; } break ; case KVM_IRQ_ROUTING_HV_SINT : e -> set = kvm_hv_set_sint ; e -> hv_sint . vcpu = ue -> u . hv_sint . vcpu ; e -> hv_sint . sint = ue -> u . hv_sint . sint ; break ; case KVM_IRQ_ROUTING_XEN_EVTCHN : return kvm_xen_setup_evtchn ( kvm , e , ue ) ; default : return - EINVAL ; } return 0 ; } 