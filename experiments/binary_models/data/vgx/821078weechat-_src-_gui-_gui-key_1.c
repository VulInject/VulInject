gui_key_grab_end_timer_cb ( , , ) { char * expanded_key , * expanded_key2 ; struct t_gui_key * ptr_key ; ( void ) pointer ; ( void ) data ; ( void ) remaining_calls ; expanded_key = gui_key_get_expanded_name ( gui_key_combo_buffer ) ; if ( expanded_key ) { if ( ! utf8_is_valid ( expanded_key , - 1 , NULL ) ) { expanded_key2 = string_iconv_to_internal ( "iso-8859-1" , expanded_key ) ; if ( expanded_key2 ) { expanded_key = expanded_key2 ; } else { utf8_normalize ( expanded_key , '?' ) ; } } if ( gui_current_window -> buffer -> input ) { gui_input_insert_string ( gui_current_window -> buffer , expanded_key ) ; if ( gui_key_grab_command ) { ptr_key = gui_key_search ( gui_keys [ GUI_KEY_CONTEXT_DEFAULT ] , gui_key_combo_buffer ) ; if ( ptr_key ) { gui_input_insert_string ( gui_current_window -> buffer , " " ) ; gui_input_insert_string ( gui_current_window -> buffer , ptr_key -> command ) ; } } gui_input_text_changed_modifier_and_signal ( gui_current_window -> buffer , 1 , 1 ) ; } free ( expanded_key ) ; } gui_key_grab = 0 ; gui_key_grab_count = 0 ; gui_key_grab_command = 0 ; gui_key_combo_buffer [ 0 ] = '\0' ; return WEECHAT_RC_OK ; } 