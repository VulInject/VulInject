int sm_io_setinfo ( fp , what , valp ) SM_FILE_T * fp ; int what ; void * valp ; { SM_FILE_T * v = ( SM_FILE_T * ) valp ; SM_REQUIRE_ISA ( fp , SmFileMagic ) ; switch ( what ) { case SM_IO_WHAT_VECTORS : fp -> f_close = v -> f_close ; fp -> f_read = v -> f_read ; fp -> f_seek = v -> f_seek ; fp -> f_write = v -> f_write ; fp -> f_open = v -> f_open ; fp -> f_setinfo = v -> f_setinfo ; fp -> f_getinfo = v -> f_getinfo ; sm_free ( fp -> f_type ) ; fp -> f_type = sm_strdup_x ( v -> f_type , NULL ) ; return 0 ; case SM_IO_WHAT_TIMEOUT : fp -> f_timeout = * ( ( int * ) valp ) ; return 0 ; } if ( fp -> f_setinfo == NULL ) { errno = EINVAL ; return - 1 ; } else { return * fp -> f_setinfo ( fp , what , valp ) ; } } 