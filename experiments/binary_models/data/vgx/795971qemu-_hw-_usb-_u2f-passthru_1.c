static void u2f_transaction_add ( U2FPassthruState * key , uint32_t cid , const uint8_t nonce [ NONCE_SIZE ] ) { uint8_t index ; struct transaction * transaction ; if ( key -> current_transactions_num >= CURRENT_TRANSACTIONS_NUM ) { index = key -> current_transactions_start ; transaction = & key -> current_transactions [ index ] ; u2f_transaction_close ( key , transaction -> cid ) ; } index = key -> current_transactions_end ; key -> current_transactions_end = ( index + 1 ) % CURRENT_TRANSACTIONS_NUM ; ++ key -> current_transactions_num ; transaction = & key -> current_transactions [ index ] ; transaction -> cid = cid ; transaction -> resp_bcnt = 0 ; if ( nonce != NULL ) { memcpy ( transaction -> nonce , nonce , NONCE_SIZE ) ; } } 