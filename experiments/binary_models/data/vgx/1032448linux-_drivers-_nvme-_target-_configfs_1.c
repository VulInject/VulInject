static ssize_t nvmet_ns_ana_grpid_store ( struct config_item * item , const char * page , size_t count ) { struct nvmet_ns * ns = to_nvmet_ns ( item ) ; u32 oldgrpid , newgrpid ; int ret ; ret = kstrtou32 ( page , 0 , & newgrpid ) ; if ( ret ) { return ret ; } down_write ( & nvmet_ana_sem ) ; oldgrpid = ns -> anagrpid ; nvmet_ana_group_enabled [ newgrpid ] ++ ; ns -> anagrpid = newgrpid ; nvmet_ana_group_enabled [ oldgrpid ] -- ; nvmet_ana_chgcnt ++ ; up_write ( & nvmet_ana_sem ) ; nvmet_send_ana_event ( ns -> subsys , NULL ) ; return count ; } 