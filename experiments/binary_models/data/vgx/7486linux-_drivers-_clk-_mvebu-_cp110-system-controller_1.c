static struct clk_hw * cp110_register_gate ( const char * name , const char * parent_name , struct regmap * regmap , u8 bit_idx ) { struct cp110_gate_clk * gate ; struct clk_hw * hw ; struct clk_init_data init ; int ret ; gate = kzalloc ( sizeof ( * gate ) , GFP_KERNEL ) ; if ( ! gate ) { return ERR_PTR ( - ENOMEM ) ; } init . name = name ; init . ops = & cp110_gate_ops ; init . parent_names = & parent_name ; init . num_parents = 1 ; gate -> regmap = regmap ; gate -> bit_idx = bit_idx ; gate -> hw . init = & init ; hw = & gate -> hw ; ret = clk_hw_register ( NULL , hw ) ; if ( ret ) { kfree ( gate ) ; hw = ERR_PTR ( ret ) ; } return hw ; } 