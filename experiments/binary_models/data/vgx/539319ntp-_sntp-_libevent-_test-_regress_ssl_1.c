static void eventcb ( struct bufferevent * bev , short what , void * ctx ) { TT_BLATHER ( ( "Got event %d" , ( int ) what ) ) ; if ( what & BEV_EVENT_CONNECTED ) { SSL * ssl ; X509 * peer_cert ; ++ n_connected ; ssl = bufferevent_openssl_get_ssl ( bev ) ; tt_assert ( ssl ) ; peer_cert = SSL_get_peer_certificate ( ssl ) ; if ( 0 == strcmp ( ctx , "server" ) ) { tt_assert ( peer_cert == NULL ) ; } else { tt_assert ( peer_cert != NULL ) ; } if ( stop_when_connected ) { if ( -- pending_connect_events == 0 ) { event_base_loopexit ( exit_base , NULL ) ; } } } if ( what & BEV_EVENT_EOF ) { TT_BLATHER ( ( "Got a good EOF" ) ) ; ++ got_close ; } if ( what & BEV_EVENT_ERROR ) { TT_BLATHER ( ( "Got an error." ) ) ; ++ got_error ; bufferevent_free ( bev ) ; } end } 