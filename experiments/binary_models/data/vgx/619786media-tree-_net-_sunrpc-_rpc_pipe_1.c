static int rpc_populate ( struct dentry * parent , const struct rpc_filelist * files , int start , int eof , void * private ) { struct inode * dir = d_inode ( parent ) ; struct dentry * dentry ; int i , err ; inode_lock ( dir , NULL ) ; for ( i = start ; i < eof ; i ++ ) { dentry = __rpc_lookup_create_exclusive ( parent , files [ i ] . name ) ; err = PTR_ERR ( dentry ) ; if ( IS_ERR ( dentry ) ) { out_bad } switch ( files [ i ] . mode & S_IFMT ) { default : BUG ( ) ; case S_IFREG : err = __rpc_create ( dir , dentry , files [ i ] . mode , files [ i ] . i_fop , private ) ; break ; case S_IFDIR : err = __rpc_mkdir ( dir , dentry , files [ i ] . mode , NULL , private ) ; } if ( err != 0 ) { out_bad } } inode_unlock ( dir ) ; return 0 ; out_bad __rpc_depopulate ( parent , files , start , eof ) ; inode_unlock ( dir ) ; printk ( KERN_WARNING "%s: %s failed to populate directory %pd\n" , __FILE__ , __func__ , parent ) ; return err ; } 