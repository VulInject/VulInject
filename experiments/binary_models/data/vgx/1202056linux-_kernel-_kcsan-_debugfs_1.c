static DEFINE_SPINLOCK ( report_filterlist_lock ) ; static noinline void microbenchmark ( unsigned long iters ) { const struct kcsan_ctx ctx_save = current -> kcsan_ctx ; const bool was_enabled = READ_ONCE ( kcsan_enabled ) ; u64 cycles ; WRITE_ONCE ( kcsan_enabled , false ) ; pr_info ( "%s begin | iters: %lu\n" , __func__ , iters ) ; cycles = get_cycles ( ) ; while ( iters -- ) { unsigned long addr = iters & ( ( PAGE_SIZE << 8 ) - 1 ) ; int type = ! ( iters & 0x7f ) ?KCSAN_ACCESS_ATOMIC : ( ! ( iters & 0xf ) ?KCSAN_ACCESS_WRITE : 0 ) ; __kcsan_check_access ( ( void * ) addr , sizeof ( long ) , type ) ; } cycles = get_cycles ( ) - cycles ; pr_info ( "%s end   | cycles: %llu\n" , __func__ , cycles ) ; WRITE_ONCE ( kcsan_enabled , was_enabled ) ; current -> kcsan_ctx = ctx_save ; } 