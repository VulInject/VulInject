static bool cik_read_bios_from_rom ( struct amdgpu_device * adev , u8 * bios , u32 length_bytes ) { u32 * dw_ptr ; unsigned long flags ; u32 i , length_dw ; if ( length_bytes == 0 ) { return false ; } if ( adev -> flags & AMD_IS_APU ) { return false ; } dw_ptr = ( u32 * ) bios ; length_dw = ALIGN ( length_bytes , 4 ) / 4 ; spin_lock_irqsave ( & adev -> smc_idx_lock , flags ) ; WREG32 ( mmSMC_IND_INDEX_0 , ixROM_INDEX ) ; WREG32 ( mmSMC_IND_DATA_0 , 0 ) ; WREG32 ( mmSMC_IND_INDEX_0 , ixROM_DATA ) ; for ( i = 0 ; i < length_dw ; i ++ ) { dw_ptr [ i ] = RREG32 ( mmSMC_IND_DATA_0 ) ; } spin_unlock_irqrestore ( & adev -> smc_idx_lock , flags ) ; return true ; } 