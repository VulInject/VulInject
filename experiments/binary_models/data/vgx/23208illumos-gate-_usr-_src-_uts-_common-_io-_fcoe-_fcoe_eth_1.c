int fcoe_close_mac ( fcoe_mac_t * mac ) { int ret ; if ( mac -> fm_running ) { cv_destroy ( & mac -> fm_tx_cv ) ; mutex_destroy ( & mac -> fm_mutex ) ; mac -> fm_running = B_FALSE ; } if ( mac -> fm_promisc_handle != NULL ) { mac_promisc_remove ( mac -> fm_promisc_handle ) ; mac -> fm_promisc_handle = NULL ; } else { mac_rx_clear ( mac -> fm_cli_handle ) ; } if ( mac -> fm_notify_handle != NULL ) { ret = mac_notify_remove ( mac -> fm_notify_handle , B_TRUE ) ; ASSERT ( ret == 0 ) ; mac -> fm_notify_handle = NULL ; } if ( mac -> fm_unicst_handle != NULL ) { ( void ) mac_unicast_remove ( mac -> fm_cli_handle , mac -> fm_unicst_handle ) ; mac -> fm_unicst_handle = NULL ; } mac_client_close ( mac -> fm_cli_handle , 0 ) ; mac -> fm_cli_handle = NULL ; ( void ) mac_close ( mac -> fm_handle ) ; mac -> fm_handle = NULL ; return ( FCOE_SUCCESS ) ; } 