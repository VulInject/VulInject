void control_writeln ( const char * str ) { ssize_t len = strlen ( str ) ; ssize_t ret ; timeout_begin ( TIMEOUT ) ; { ret = send ( control_fd , str , len , MSG_MORE ) ; timeout_check ( "send" ) ; } ret < 0 && errno == EINTR ; if ( ret != len ) { perror ( "send" ) ; exit ( EXIT_FAILURE , NULL ) ; } { ret = send ( control_fd , "\n" , 1 , 0 ) ; timeout_check ( "send" ) ; } ret < 0 && errno == EINTR ; if ( ret != 1 ) { perror ( "send" ) ; exit ( EXIT_FAILURE ) ; } timeout_end ( ) ; } 