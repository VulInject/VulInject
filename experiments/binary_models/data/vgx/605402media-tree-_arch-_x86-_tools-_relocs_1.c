static void read_shdrs ( FILE * fp ) { int i ; Elf_Shdr shdr ; secs = calloc ( ehdr . e_shnum , sizeof ( section ) ) ; if ( ! secs ) { die ( "Unable to allocate %d section headers\n" , ehdr . e_shnum ) ; } if ( fseek ( fp , ehdr . e_shoff , SEEK_SET ) < 0 ) { die ( "Seek to %d failed: %s\n" , ehdr . e_shoff , strerror ( errno ) ) ; } for ( i = 0 ; i < ehdr . e_shnum ; i ++ ) { struct section * sec = & secs [ i ] ; if ( fread ( & shdr , sizeof shdr , 1 , fp ) != 1 ) { die ( "Cannot read ELF section headers %d/%d: %s\n" , i , ehdr . e_shnum , strerror ( errno ) ) ; } sec -> shdr . sh_name = elf_word_to_cpu ( shdr . sh_name , NULL ) ; sec -> shdr . sh_type = elf_word_to_cpu ( shdr . sh_type ) ; sec -> shdr . sh_flags = elf_xword_to_cpu ( shdr . sh_flags ) ; sec -> shdr . sh_addr = elf_addr_to_cpu ( shdr . sh_addr ) ; sec -> shdr . sh_offset = elf_off_to_cpu ( shdr . sh_offset ) ; sec -> shdr . sh_size = elf_xword_to_cpu ( shdr . sh_size ) ; sec -> shdr . sh_link = elf_word_to_cpu ( shdr . sh_link ) ; sec -> shdr . sh_info = elf_word_to_cpu ( shdr . sh_info ) ; sec -> shdr . sh_addralign = elf_xword_to_cpu ( shdr . sh_addralign ) ; sec -> shdr . sh_entsize = elf_xword_to_cpu ( shdr . sh_entsize ) ; if ( sec -> shdr . sh_link < ehdr . e_shnum ) { sec -> link = & secs [ sec -> shdr . sh_link ] ; } } } 