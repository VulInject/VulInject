static void ucsi_poll_worker ( struct work_struct * work ) { struct ucsi_work * uwork = container_of ( work , ucsi_work , work . work ) ; struct ucsi_connector * con = uwork -> con ; int ret ; mutex_lock ( & con -> lock ) ; if ( ! con -> partner ) { list_del ( & uwork -> node ) ; mutex_unlock ( & con -> lock ) ; return ; } ret = uwork -> cb ( con ) ; if ( uwork -> count -- && ( ret == - EBUSY || ret == - ETIMEDOUT ) ) { queue_delayed_work ( con -> wq , & uwork -> work , uwork -> delay ) ; } else { list_del ( & uwork -> node ) ; kfree ( uwork ) ; } mutex_unlock ( & con -> lock ) ; } 