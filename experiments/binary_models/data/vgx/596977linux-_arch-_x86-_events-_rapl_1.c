static int rapl_cpu_online ( unsigned int cpu ) { struct rapl_pmu * pmu = cpu_to_rapl_pmu ( cpu ) ; int target ; if ( ! pmu ) { pmu = kzalloc_node ( sizeof ( * pmu ) , GFP_KERNEL , cpu_to_node ( cpu ) ) ; if ( ! pmu ) { return - ENOMEM ; } raw_spin_lock_init ( & pmu -> lock ) ; INIT_LIST_HEAD ( & pmu -> active_list ) ; pmu -> pmu = & rapl_pmus -> pmu ; pmu -> timer_interval = ms_to_ktime ( rapl_timer_ms ) ; rapl_hrtimer_init ( pmu ) ; rapl_pmus -> pmus [ topology_logical_die_id ( cpu ) ] = pmu ; } target = cpumask_any_and ( & rapl_cpu_mask , topology_die_cpumask ( cpu ) ) ; cpumask_set_cpu ( cpu , & rapl_cpu_mask ) ; pmu -> cpu = cpu ; return 0 ; } 