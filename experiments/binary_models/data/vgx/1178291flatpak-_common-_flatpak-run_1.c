get_dconf_data ( , , , , , , , , ) { DConfClient * client = NULL ; g_autofree char * prefix = NULL ; g_autoptr ( ) defaults_data = NULL ; g_autoptr ( ) values_data = NULL ; g_autoptr ( ) locks_data = NULL ; defaults_data = g_key_file_new ( ) ; values_data = g_key_file_new ( ) ; locks_data = g_string_new ( "" ) ; client = dconf_client_new ( ) ; prefix = flatpak_dconf_path_for_app_id ( app_id ) ; if ( migrate_path ) { g_info ( "Add values in dir '%s', prefix is '%s'" , migrate_path , prefix ) ; if ( flatpak_dconf_path_is_similar ( migrate_path , prefix ) ) { add_dconf_dir_to_keyfile ( values_data , client , migrate_path , DCONF_READ_USER_VALUE ) ; } else { g_warning ( "Ignoring D-Conf migrate-path setting %s" , migrate_path ) ; } } g_info ( "Add defaults in dir %s" , prefix ) ; add_dconf_dir_to_keyfile ( defaults_data , client , prefix , DCONF_READ_DEFAULT_VALUE ) ; g_info ( "Add locks in dir %s" , prefix ) ; add_dconf_locks_to_list ( locks_data , client , prefix ) ; if ( paths ) { int i ; for ( i = 0 ; paths [ i ] ; i ++ ) { if ( dconf_is_dir ( paths [ i ] , NULL ) ) { g_info ( "Add defaults in dir %s" , paths [ i ] ) ; add_dconf_dir_to_keyfile ( defaults_data , client , paths [ i ] , DCONF_READ_DEFAULT_VALUE ) ; g_info ( "Add locks in dir %s" , paths [ i ] ) ; add_dconf_locks_to_list ( locks_data , client , paths [ i ] ) ; } if ( dconf_is_key ( paths [ i ] , NULL ) ) { g_info ( "Add individual key %s" , paths [ i ] ) ; add_dconf_key_to_keyfile ( defaults_data , client , paths [ i ] , DCONF_READ_DEFAULT_VALUE ) ; add_dconf_key_to_keyfile ( values_data , client , paths [ i ] , DCONF_READ_USER_VALUE ) ; } else { g_warning ( "Ignoring settings path '%s': neither dir nor key" , paths [ i ] ) ; } } } * defaults = g_key_file_to_data ( defaults_data , defaults_size , NULL ) ; * values = g_key_file_to_data ( values_data , values_size , NULL ) ; * locks_size = locks_data -> len ; * locks = g_string_free ( g_steal_pointer ( & locks_data ) , FALSE ) ; } 