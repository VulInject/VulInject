int omap_drm_irq_install ( struct drm_device * dev ) { struct omap_drm_private * priv = dev -> dev_private ; unsigned int num_mgrs = priv -> dispc_ops -> get_num_mgrs ( ) ; unsigned int max_planes ; int i ; int ret ; spin_lock_init ( & priv -> wait_lock ) ; INIT_LIST_HEAD ( & priv -> wait_list ) ; priv -> irq_mask = DISPC_IRQ_OCP_ERR ; max_planes = min ( ARRAY_SIZE ( priv -> planes ) , ARRAY_SIZE ( omap_underflow_irqs ) ) ; for ( i = 0 ; i < max_planes ; ++ i ) { if ( priv -> planes [ i ] ) { priv -> irq_mask |= omap_underflow_irqs [ i ] ; } } for ( i = 0 ; i < num_mgrs ; ++ i ) { priv -> irq_mask |= priv -> dispc_ops -> mgr_get_sync_lost_irq ( i ) ; } priv -> dispc_ops -> runtime_get ( ) ; priv -> dispc_ops -> clear_irqstatus ( 0xffffffff ) ; priv -> dispc_ops -> runtime_put ( ) ; ret = priv -> dispc_ops -> request_irq ( omap_irq_handler , dev ) ; if ( ret < 0 ) { return ret ; } dev -> irq_enabled = true ; return 0 ; } 