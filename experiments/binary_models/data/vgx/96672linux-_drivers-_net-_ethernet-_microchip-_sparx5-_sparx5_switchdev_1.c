static void sparx5_switchdev_bridge_fdb_event_work ( struct work_struct * work ) { struct sparx5_switchdev_event_work * switchdev_work = container_of ( work , sparx5_switchdev_event_work , work ) ; struct net_device * dev = switchdev_work -> dev ; struct switchdev_notifier_fdb_info * fdb_info ; struct sparx5_port * port ; struct sparx5 * sparx5 ; bool host_addr ; u16 vid ; rtnl_lock ( ) ; if ( ! sparx5_netdevice_check ( dev ) ) { host_addr = true ; sparx5 = switchdev_work -> sparx5 ; } else { host_addr = false ; sparx5 = switchdev_work -> sparx5 ; port = netdev_priv ( dev ) ; } fdb_info = & switchdev_work -> fdb_info ; if ( fdb_info -> vid == 0 ) { vid = 1 ; } else { vid = fdb_info -> vid ; } switch ( switchdev_work -> event ) { case SWITCHDEV_FDB_ADD_TO_DEVICE : if ( host_addr ) { sparx5_add_mact_entry ( sparx5 , dev , PGID_CPU , fdb_info -> addr , vid ) ; } else { sparx5_add_mact_entry ( sparx5 , port -> ndev , port -> portno , fdb_info -> addr , vid ) ; } break ; case SWITCHDEV_FDB_DEL_TO_DEVICE : sparx5_del_mact_entry ( sparx5 , fdb_info -> addr , vid ) ; break ; } rtnl_unlock ( ) ; kfree ( switchdev_work ) ; dev_put ( dev ) ; } 