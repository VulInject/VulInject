static void spear_smi_hw_init ( struct spear_smi * dev ) { cfs_time_t rate = 0 ; u32 prescale = 0 ; u32 val ; rate = clk_get_rate ( dev -> clk ) ; prescale = DIV_ROUND_UP ( rate , dev -> clk_rate ) ; val = HOLD1 | BANK_EN | DSEL_TIME | ( prescale << 8 ) ; mutex_lock ( & dev -> lock ) ; writel ( 0 , dev -> io_base + SMI_SR ) ; writel ( val , dev -> io_base + SMI_CR1 ) ; mutex_unlock ( & dev -> lock ) ; } 