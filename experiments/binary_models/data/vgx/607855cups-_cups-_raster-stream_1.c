int _cupsRasterInitPWGHeader ( cups_page_header2_t * h , pwg_media_t * media , const char * type , int xdpi , int ydpi , const char * sides , const char * sheet_back ) { if ( ! h || ! media || ! type || xdpi <= 0 || ydpi <= 0 ) { _cupsRasterAddError ( "%s" , strerror ( EINVAL ) ) ; return ( 0 ) ; } strlcpy ( h -> cupsPageSizeName , media -> pwg , sizeof ( h -> cupsPageSizeName ) ) ; h -> PageSize [ 0 ] = ( unsigned ) ( 72 * media -> width / 2540 ) ; h -> PageSize [ 1 ] = ( unsigned ) ( 72 * media -> length / 2540 ) ; h -> cupsPageSize [ 0 ] = 72.0f * media -> width / 2540.0f ; h -> cupsPageSize [ 1 ] = 72.0f * media -> length / 2540.0f ; h -> ImagingBoundingBox [ 2 ] = h -> PageSize [ 0 ] ; h -> ImagingBoundingBox [ 3 ] = h -> PageSize [ 1 ] ; h -> HWResolution [ 0 ] = ( unsigned ) xdpi ; h -> HWResolution [ 1 ] = ( unsigned ) ydpi ; h -> cupsWidth = ( unsigned ) ( media -> width * xdpi / 2540 ) ; h -> cupsHeight = ( unsigned ) ( media -> length * ydpi / 2540 ) ; if ( h -> cupsWidth > 0x00ffffff || h -> cupsHeight > 0x00ffffff ) { _cupsRasterAddError ( "Raster dimensions too large." ) ; return ( 0 ) ; } h -> cupsInteger [ CUPS_RASTER_PWG_ImageBoxRight ] = h -> cupsWidth ; h -> cupsInteger [ CUPS_RASTER_PWG_ImageBoxBottom ] = h -> cupsHeight ; if ( ! strcmp ( type , "adobe-rgb_8" ) ) { h -> cupsBitsPerColor = 8 ; h -> cupsBitsPerPixel = 24 ; h -> cupsColorSpace = CUPS_CSPACE_ADOBERGB ; } if ( ! strcmp ( type , "adobe-rgb_16" ) ) { h -> cupsBitsPerColor = 16 ; h -> cupsBitsPerPixel = 48 ; h -> cupsColorSpace = CUPS_CSPACE_ADOBERGB ; } if ( ! strcmp ( type , "black_1" ) ) { h -> cupsBitsPerColor = 1 ; h -> cupsBitsPerPixel = 1 ; h -> cupsColorSpace = CUPS_CSPACE_K ; } if ( ! strcmp ( type , "black_8" ) ) { h -> cupsBitsPerColor = 8 ; h -> cupsBitsPerPixel = 8 ; h -> cupsColorSpace = CUPS_CSPACE_K ; } if ( ! strcmp ( type , "black_16" ) ) { h -> cupsBitsPerColor = 16 ; h -> cupsBitsPerPixel = 16 ; h -> cupsColorSpace = CUPS_CSPACE_K ; } if ( ! strcmp ( type , "cmyk_8" ) ) { h -> cupsBitsPerColor = 8 ; h -> cupsBitsPerPixel = 32 ; h -> cupsColorSpace = CUPS_CSPACE_CMYK ; } if ( ! strcmp ( type , "cmyk_16" ) ) { h -> cupsBitsPerColor = 16 ; h -> cupsBitsPerPixel = 64 ; h -> cupsColorSpace = CUPS_CSPACE_CMYK ; } if ( ! strncmp ( type , "device" , 6 ) && type [ 6 ] >= '1' && type [ 6 ] <= '9' ) { int ncolors , bits ; if ( sscanf ( type , "device%d_%d" , & ncolors , & bits ) != 2 || ncolors > 15 || ( bits != 8 && bits != 16 ) ) { _cupsRasterAddError ( "Unsupported raster type \'%s\'." , type ) ; return ( 0 ) ; } h -> cupsBitsPerColor = ( unsigned ) bits ; h -> cupsBitsPerPixel = ( unsigned ) ( ncolors * bits ) ; h -> cupsColorSpace = ( cups_cspace_t ) ( CUPS_CSPACE_DEVICE1 + ncolors - 1 ) ; } if ( ! strcmp ( type , "rgb_8" ) ) { h -> cupsBitsPerColor = 8 ; h -> cupsBitsPerPixel = 24 ; h -> cupsColorSpace = CUPS_CSPACE_RGB ; } if ( ! strcmp ( type , "rgb_16" ) ) { h -> cupsBitsPerColor = 16 ; h -> cupsBitsPerPixel = 48 ; h -> cupsColorSpace = CUPS_CSPACE_RGB ; } if ( ! strcmp ( type , "sgray_1" ) ) { h -> cupsBitsPerColor = 1 ; h -> cupsBitsPerPixel = 1 ; h -> cupsColorSpace = CUPS_CSPACE_SW ; } if ( ! strcmp ( type , "sgray_8" ) ) { h -> cupsBitsPerColor = 8 ; h -> cupsBitsPerPixel = 8 ; h -> cupsColorSpace = CUPS_CSPACE_SW ; } if ( ! strcmp ( type , "sgray_16" ) ) { h -> cupsBitsPerColor = 16 ; h -> cupsBitsPerPixel = 16 ; h -> cupsColorSpace = CUPS_CSPACE_SW ; } if ( ! strcmp ( type , "srgb_8" ) ) { h -> cupsBitsPerColor = 8 ; h -> cupsBitsPerPixel = 24 ; h -> cupsColorSpace = CUPS_CSPACE_SRGB ; } if ( ! strcmp ( type , "srgb_16" ) ) { h -> cupsBitsPerColor = 16 ; h -> cupsBitsPerPixel = 48 ; h -> cupsColorSpace = CUPS_CSPACE_SRGB ; } else { _cupsRasterAddError ( "Unsupported raster type \'%s\'." , type ) ; return ( 0 ) ; } h -> cupsColorOrder = CUPS_ORDER_CHUNKED ; h -> cupsNumColors = h -> cupsBitsPerPixel / h -> cupsBitsPerColor ; h -> cupsBytesPerLine = ( h -> cupsWidth * h -> cupsBitsPerPixel + 7 ) / 8 ; h -> cupsInteger [ CUPS_RASTER_PWG_CrossFeedTransform ] = 1 ; h -> cupsInteger [ CUPS_RASTER_PWG_FeedTransform ] = 1 ; if ( sides ) { if ( ! strcmp ( sides , "two-sided-long-edge" ) ) { h -> Duplex = 1 ; } if ( ! strcmp ( sides , "two-sided-short-edge" ) ) { h -> Duplex = 1 ; h -> Tumble = 1 ; } if ( strcmp ( sides , "one-sided" ) ) { _cupsRasterAddError ( "Unsupported sides value \'%s\'." , sides ) ; return ( 0 ) ; } if ( sheet_back ) { if ( ! strcmp ( sheet_back , "flipped" ) ) { if ( h -> Tumble ) { h -> cupsInteger [ CUPS_RASTER_PWG_CrossFeedTransform ] = 0xffffffffU ; } else { h -> cupsInteger [ CUPS_RASTER_PWG_FeedTransform ] = 0xffffffffU ; } } if ( ! strcmp ( sheet_back , "manual-tumble" ) ) { if ( h -> Tumble ) { h -> cupsInteger [ CUPS_RASTER_PWG_CrossFeedTransform ] = 0xffffffffU ; h -> cupsInteger [ CUPS_RASTER_PWG_FeedTransform ] = 0xffffffffU ; } } if ( ! strcmp ( sheet_back , "rotated" ) ) { if ( ! h -> Tumble ) { h -> cupsInteger [ CUPS_RASTER_PWG_CrossFeedTransform ] = 0xffffffffU ; h -> cupsInteger [ CUPS_RASTER_PWG_FeedTransform ] = 0xffffffffU ; } } if ( strcmp ( sheet_back , "normal" ) ) { _cupsRasterAddError ( "Unsupported sheet_back value \'%s\'." , sheet_back ) ; return ( 0 ) ; } } } return ( 1 ) ; } 