static int test_memcg_oom_group_score_events ( const char * root ) { int ret = KSFT_FAIL ; char * memcg ; int safe_pid ; memcg = cg_name ( root , "memcg_test_0" ) ; if ( ! memcg ) { cleanup } if ( cg_create ( memcg ) ) { cleanup } if ( cg_write ( memcg , "memory.max" , "50M" ) ) { cleanup } if ( cg_write ( memcg , "memory.swap.max" , "0" ) ) { cleanup } if ( cg_write ( memcg , "memory.oom.group" , "1" ) ) { cleanup } safe_pid = cg_run_nowait ( memcg , alloc_anon_noexit , ( void * ) MB ( 1 ) ) ; if ( set_oom_adj_score ( safe_pid , OOM_SCORE_ADJ_MIN ) ) { cleanup } cg_run_nowait ( memcg , alloc_anon_noexit , ( void * ) MB ( 1 ) ) ; if ( ! cg_run ( memcg , alloc_anon , ( void * ) MB ( 100 ) ) ) { cleanup } if ( cg_read_key_long ( memcg , "memory.events" , "oom_kill " ) != 3 ) { cleanup } if ( kill ( safe_pid , SIGKILL ) ) { cleanup } ret = KSFT_PASS ; cleanup if ( memcg ) { cg_destroy ( memcg ) ; } return ret ; } 