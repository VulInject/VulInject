int addmasterkey ( char * master , char * netname , algtype_t algtype ) { keybuf3 * secret , * ; int bytelen = strlen ( master ) ; keylen_t keylen = bytelen * 4 ; key_netstarg3 tmp ; if ( ( secret = setkeybuf3 ( master , bytelen ) ) == NULL ) { return ( 0 ) ; } if ( ( public = getkeybuf3 ( bytelen + 1 ) ) == NULL ) { return ( 0 ) ; } tmp . st_priv_key = * secret ; free ( secret ) ; tmp . st_pub_key = * public ; free ( public ) ; tmp . st_netname = strdup ( netname ) ; tmp . keylen = keylen ; tmp . algtype = algtype ; return ( store_netname3 ( 0 , & tmp ) ) ; } 