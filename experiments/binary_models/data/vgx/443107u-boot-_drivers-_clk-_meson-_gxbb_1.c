static int meson_set_gate_by_id ( struct clk * clk , unsigned long id , bool on ) { struct meson_clk * priv = dev_get_priv ( clk -> dev ) ; struct meson_gate * gate ; debug ( "%s: %sabling %ld\n" , __func__ , on ?"en" : "dis" , id ) ; switch ( id ) { case CLKID_VPU : return meson_set_gate_by_id ( clk , meson_mux_get_parent ( clk , CLKID_VPU ) , on ) ; case CLKID_VAPB_SEL : return meson_set_gate_by_id ( clk , meson_mux_get_parent ( clk , CLKID_VAPB_SEL ) , on ) ; } if ( id >= ARRAY_SIZE ( gates ) ) { return - ENOENT ; } gate = & gates [ id ] ; debug ( "%s: really %sabling %ld\n" , __func__ , on ?"en" : "dis" , id ) ; regmap_update_bits ( priv -> map , gate -> reg , BIT ( gate -> bit ) , on ?BIT ( gate -> bit ) : 0 ) ; switch ( id ) { case CLKID_VAPB : return meson_set_gate_by_id ( clk , CLKID_VAPB_SEL , on ) ; } return 0 ; } 