static int vgxy61_configure ( struct vgxy61_dev * sensor ) { u32 sensor_freq ; u8 prediv , mult ; int line_length ; int ret = 0 ; compute_pll_parameters_by_freq ( sensor -> clk_freq , & prediv , & mult ) ; sensor_freq = ( mult * sensor -> clk_freq ) / prediv ; sensor -> data_rate_in_mbps = sensor_freq ; sensor -> pclk = sensor_freq / 5 ; line_length = vgxy61_read_reg ( sensor , VGXY61_REG_LINE_LENGTH ) ; sensor -> line_length = line_length ; vgxy61_write_reg ( sensor , VGXY61_REG_EXT_CLOCK , sensor -> clk_freq , & ret ) ; vgxy61_write_reg ( sensor , VGXY61_REG_CLK_PLL_PREDIV , prediv , & ret ) ; vgxy61_write_reg ( sensor , VGXY61_REG_CLK_SYS_PLL_MULT , mult , & ret ) ; vgxy61_write_reg ( sensor , VGXY61_REG_OIF_CTRL , sensor -> oif_ctrl , & ret ) ; vgxy61_write_reg ( sensor , VGXY61_REG_FRAME_CONTENT_CTRL , 0 , & ret ) ; vgxy61_write_reg ( sensor , VGXY61_REG_BYPASS_CTRL , 4 , & ret ) ; if ( ret ) { return ret ; } vgxy61_update_gpios_strobe_polarity ( sensor , sensor -> gpios_polarity ) ; vgxy61_write_reg ( sensor , VGXY61_REG_PATGEN_LONG_DATA_GR , 0x800 , & ret ) ; vgxy61_write_reg ( sensor , VGXY61_REG_PATGEN_LONG_DATA_R , 0x800 , & ret ) ; vgxy61_write_reg ( sensor , VGXY61_REG_PATGEN_LONG_DATA_B , 0x800 , & ret ) ; vgxy61_write_reg ( sensor , VGXY61_REG_PATGEN_LONG_DATA_GB , 0x800 , & ret ) ; vgxy61_write_reg ( sensor , VGXY61_REG_PATGEN_SHORT_DATA_GR , 0x800 , & ret ) ; vgxy61_write_reg ( sensor , VGXY61_REG_PATGEN_SHORT_DATA_R , 0x800 , & ret ) ; vgxy61_write_reg ( sensor , VGXY61_REG_PATGEN_SHORT_DATA_B , 0x800 , & ret ) ; vgxy61_write_reg ( sensor , VGXY61_REG_PATGEN_SHORT_DATA_GB , 0x800 , & ret ) ; if ( ret ) { return ret ; } return 0 ; } 