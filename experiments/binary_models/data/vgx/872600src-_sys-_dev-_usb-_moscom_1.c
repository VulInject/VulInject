int moscom_param ( void * vsc , int portno , struct termios * t ) { struct moscom_softc * sc = ( moscom_softc * ) vsc ; int data ; if ( t -> c_ospeed <= 0 || t -> c_ospeed > 115200 ) { return ( EINVAL ) ; } data = MOSCOM_BAUD_REF / t -> c_ospeed ; moscom_cmd ( sc , MOSCOM_LCR , MOSCOM_LCR_DIVLATCH_EN ) ; moscom_cmd ( sc , MOSCOM_BAUDLO , data & 0xFF ) ; moscom_cmd ( sc , MOSCOM_BAUDHI , ( data >> 8 ) & 0xFF ) ; if ( ISSET ( t -> c_cflag , CSTOPB ) ) { data = MOSCOM_LCR_STOP_BITS_2 ; } else { data = MOSCOM_LCR_STOP_BITS_1 ; } if ( ISSET ( t -> c_cflag , PARENB ) ) { if ( ISSET ( t -> c_cflag , PARODD ) ) { data |= MOSCOM_LCR_PARITY_ODD ; } else { data |= MOSCOM_LCR_PARITY_EVEN ; } } else { data |= MOSCOM_LCR_PARITY_NONE ; } switch ( ISSET ( t -> c_cflag , CSIZE ) ) { case CS5 : data |= MOSCOM_LCR_DBITS ( 5 ) ; break ; case CS6 : data |= MOSCOM_LCR_DBITS ( 6 ) ; break ; case CS7 : data |= MOSCOM_LCR_DBITS ( 7 ) ; break ; case CS8 : data |= MOSCOM_LCR_DBITS ( 8 ) ; break ; } sc -> sc_lcr = data ; moscom_cmd ( sc , MOSCOM_LCR , sc -> sc_lcr ) ; if ( ISSET ( t -> c_cflag , CRTSCTS ) ) { } } if ( ISSET ( t -> c_iflag , IXON | IXOFF ) ) { } else { } return ( 0 ) ; 