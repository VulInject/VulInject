static int mt9m114_s_config ( struct v4l2_subdev * sd , int irq , void * platform_data ) { struct mt9m114_device * dev = to_mt9m114_sensor ( sd ) ; struct i2c_client * client = v4l2_get_subdevdata ( sd ) ; int ret ; if ( NULL == platform_data ) { return - ENODEV ; } dev -> platform_data = ( camera_sensor_platform_data * ) platform_data ; if ( dev -> platform_data -> platform_init ) { ret = dev -> platform_data -> platform_init ( client ) ; if ( ret ) { v4l2_err ( client , "mt9m114 platform init err\n" ) ; return ret ; } } ret = power_up ( sd ) ; if ( ret ) { v4l2_err ( client , "mt9m114 power-up err" ) ; return ret ; } ret = mt9m114_detect ( dev , client ) ; if ( ret ) { v4l2_err ( client , "mt9m114_detect err s_config.\n" ) ; fail_detect } ret = dev -> platform_data -> csi_cfg ( sd , 1 ) ; if ( ret ) { fail_csi_cfg } ret = mt9m114_set_suspend ( sd , NULL ) ; if ( ret ) { v4l2_err ( client , "mt9m114 suspend err" ) ; return ret ; } ret = power_down ( sd ) ; if ( ret ) { v4l2_err ( client , "mt9m114 power down err" ) ; return ret ; } return ret ; fail_csi_cfg dev -> platform_data -> csi_cfg ( sd , 0 ) ; fail_detect power_down ( sd ) ; dev_err ( & client -> dev , "sensor power-gating failed\n" ) ; return ret ; } 