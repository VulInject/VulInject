static int lan743x_hs_otp_read ( struct lan743x_adapter * adapter , u32 offset , u32 length , u8 * data ) { int ret ; int i ; ret = lan743x_hs_syslock_acquire ( adapter , LOCK_TIMEOUT_MAX_CNT ) ; lan743x_hs_otp_power_up ( adapter ) ; ret = lan743x_hs_otp_cmd_cmplt_chk ( adapter ) ; if ( ret < 0 ) { power_down } lan743x_hs_syslock_release ( adapter ) ; for ( i = 0 ; i < length ; i ++ ) { ret = lan743x_hs_syslock_acquire ( adapter , LOCK_TIMEOUT_MAX_CNT ) ; if ( ret < 0 ) { return ret ; } lan743x_hs_otp_set_address ( adapter , offset + i ) ; lan743x_hs_otp_read_go ( adapter ) ; ret = lan743x_hs_otp_cmd_cmplt_chk ( adapter ) ; if ( ret < 0 ) { power_down } data [ i ] = lan743x_csr_read ( adapter , HS_OTP_READ_DATA ) ; lan743x_hs_syslock_release ( adapter ) ; } ret = lan743x_hs_syslock_acquire ( adapter , LOCK_TIMEOUT_MAX_CNT ) ; if ( ret < 0 ) { return ret ; } power_down lan743x_hs_otp_power_down ( adapter ) ; lan743x_hs_syslock_release ( adapter ) ; return ret ; } 