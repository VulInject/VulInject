static int at91_pinconf_set ( struct pinctrl_dev * pctldev , unsigned pin_id , unsigned long * configs , unsigned num_configs ) { struct at91_pinctrl * info = pinctrl_dev_get_drvdata ( pctldev ) ; unsigned mask ; void __iomem * pio ; int i ; unsigned long config ; unsigned pin ; for ( i = 0 ; i < num_configs ; i ++ ) { config = configs [ i ] ; dev_dbg ( info -> dev , "%s:%d, pin_id=%d, config=0x%lx" , __func__ , __LINE__ , pin_id , config ) ; pio = pin_to_controller ( info , pin_to_bank ( pin_id ) ) ; pin = pin_id % MAX_NB_GPIO_PER_BANK ; mask = pin_to_mask ( pin ) ; if ( config & PULL_UP && config & PULL_DOWN ) { return - EINVAL ; } at91_mux_set_output ( pio , mask , config & OUTPUT , ( config & OUTPUT_VAL ) >> OUTPUT_VAL_SHIFT ) ; at91_mux_set_pullup ( pio , mask , config & PULL_UP ) ; at91_mux_set_multidrive ( pio , mask , config & MULTI_DRIVE ) ; if ( info -> ops -> set_deglitch ) { info -> ops -> set_deglitch ( pio , mask , config & DEGLITCH ) ; } if ( info -> ops -> set_debounce ) { info -> ops -> set_debounce ( pio , mask , config & DEBOUNCE , ( config & DEBOUNCE_VAL ) >> DEBOUNCE_VAL_SHIFT ) ; } if ( info -> ops -> set_pulldown ) { info -> ops -> set_pulldown ( pio , mask , config & PULL_DOWN ) ; } if ( info -> ops -> disable_schmitt_trig && config & DIS_SCHMIT ) { info -> ops -> disable_schmitt_trig ( pio , mask ) ; } if ( info -> ops -> set_drivestrength ) { info -> ops -> set_drivestrength ( pio , pin , ( config & DRIVE_STRENGTH ) >> DRIVE_STRENGTH_SHIFT ) ; } } return 0 ; } if ( config & flag ) { if ( num_conf ) { seq_puts ( s , "|" ) ; } seq_puts ( s , # flag ) ; num_conf ++ ; } ( 0 ) 