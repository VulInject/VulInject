static char * get_usb_devlink ( char * devfs_path , const char * dir_name ) { char * result = NULL ; DIR * dp ; if ( ( dp = opendir ( dir_name ) ) != NULL ) { struct dirent * ep ; while ( ( ep = readdir ( dp ) ) != NULL ) { char path [ MAXPATHLEN ] , lpath [ MAXPATHLEN ] ; strncpy ( path , dir_name , strlen ( dir_name ) ) ; strncat ( path , ep -> d_name , strlen ( ep -> d_name ) ) ; if ( ( readlink ( path , lpath , sizeof ( lpath ) ) > 0 ) && ( strstr ( lpath , devfs_path ) != NULL ) ) { result = strdup ( path ) ; break ; } memset ( path , 0 , sizeof ( path ) ) ; } closedir ( dp ) ; } return ( result ) ; } 