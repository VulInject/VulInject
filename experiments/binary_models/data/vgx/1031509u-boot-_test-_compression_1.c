static int run_test ( struct unit_test_state * uts , char * name , mutate_func compress , mutate_func uncompress ) { struct buf_state sbuf , * buf = & sbuf ; int ret ; printf ( " testing %s ...\n" , name ) ; buf -> orig_buf = ( void * ) plain ; buf -> orig_size = strlen ( buf -> orig_buf ) ; errcheck ( buf -> orig_size > 0 ) ; buf -> compressed_size = TEST_BUFFER_SIZE ; buf -> uncompressed_size = TEST_BUFFER_SIZE ; buf -> compressed_buf = malloc ( buf -> compressed_size ) ; errcheck ( buf -> compressed_buf ) ; buf -> uncompressed_buf = malloc ( buf -> uncompressed_size ) ; errcheck ( buf -> uncompressed_buf ) ; buf -> compare_buf = malloc ( buf -> uncompressed_size ) ; errcheck ( buf -> compare_buf ) ; ret = run_test_internal ( uts , name , compress , uncompress , buf ) ; out printf ( " %s: %s\n" , name , ret == 0 ?"ok" : "FAILED" ) ; free ( buf -> uncompressed_buf ) ; free ( buf -> compressed_buf ) ; return ret ; } 