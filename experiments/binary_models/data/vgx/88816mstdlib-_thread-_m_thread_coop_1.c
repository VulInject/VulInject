static M_bool M_thread_coop_mutex_lock ( M_thread_mutex_t * mutex ) { M_thread_coop_t * thread ; if ( mutex == NULL ) { return M_FALSE ; } thread = M_llist_node_val ( M_llist_first ( coop_active_threads ) ) ; if ( mutex -> thread_locked != thread ) { while ( mutex -> thread_locked ) { thread -> wait_mutex = mutex ; M_thread_coop_yield ( M_TRUE ) ; } } mutex -> thread_locked = thread ; mutex -> cnt ++ ; return M_TRUE ; } 