static int rsi_mgmt_pkt_to_core ( struct rsi_common * common , u8 * msg , s32 msg_len , u8 type ) { struct rsi_hw * adapter = common -> priv ; struct ieee80211_tx_info * info ; struct skb_info * rx_params ; u8 pad_bytes = msg [ 4 ] ; u8 pkt_recv ; struct sk_buff * skb ; char * buffer ; if ( type == RX_DOT11_MGMT ) { msg_len -= pad_bytes ; if ( msg_len <= 0 ) { rsi_dbg ( MGMT_RX_ZONE , "%s: Invalid rx msg of len = %d\n" , __func__ , msg_len ) ; return - EINVAL ; } skb = dev_alloc_skb ( msg_len ) ; if ( ! skb ) { rsi_dbg ( ERR_ZONE , "%s: Failed to allocate skb\n" , __func__ ) ; return - ENOMEM ; } buffer = skb_put ( skb , msg_len ) ; memcpy ( buffer , ( u8 * ) ( msg + FRAME_DESC_SZ + pad_bytes ) , msg_len ) ; pkt_recv = buffer [ 0 ] ; info = IEEE80211_SKB_CB ( skb ) ; rx_params = ( skb_info * ) info -> driver_data ; rx_params -> rssi = rsi_get_rssi ( msg ) ; rx_params -> channel = rsi_get_channel ( msg ) ; rsi_indicate_pkt_to_os ( common , skb ) ; } else { rsi_dbg ( MGMT_TX_ZONE , "%s: Internal Packet\n" , __func__ ) ; } return 0 ; } 