static void cia_decode_mem_error ( struct el_CIA_sysdata_mcheck * cia , const char * msg ) { unsigned long mem_port_addr ; cfs_time_t mem_port_mask ; const char * mem_port_cmd ; const char * seq_state ; const char * set_select ; unsigned long tmp ; if ( ( cia -> mem_err1 >> 20 ) & 1 ) { cia_decode_pci_error ( cia , msg ) ; } else { printk ( KERN_CRIT "CIA machine check: %s\n" , msg ) ; } mem_port_addr = cia -> mem_err0 & 0xfffffff0 ; mem_port_addr |= ( cia -> mem_err1 & 0x83UL ) << 32 ; mem_port_mask = ( cia -> mem_err1 >> 12 ) & 0xF ; tmp = ( cia -> mem_err1 >> 8 ) & 0xF ; tmp |= ( ( cia -> mem_err1 >> 20 ) & 1 ) << 4 ; if ( ( tmp & 0x1E ) == 0x06 ) { mem_port_cmd = "WRITE BLOCK or WRITE BLOCK LOCK" ; } if ( ( tmp & 0x1C ) == 0x08 ) { mem_port_cmd = "READ MISS or READ MISS MODIFY" ; } if ( tmp == 0x1C ) { mem_port_cmd = "BC VICTIM" ; } if ( ( tmp & 0x1E ) == 0x0E ) { mem_port_cmd = "READ MISS MODIFY" ; } if ( ( tmp & 0x1C ) == 0x18 ) { mem_port_cmd = "DMA READ or DMA READ MODIFY" ; } if ( ( tmp & 0x1E ) == 0x12 ) { mem_port_cmd = "DMA WRITE" ; } else { mem_port_cmd = "Unknown" ; } tmp = ( cia -> mem_err1 >> 16 ) & 0xF ; switch ( tmp ) { case 0x0 : seq_state = "Idle" ; break ; case 0x1 : seq_state = "DMA READ or DMA WRITE" ; break ; case 0x2 : case 0x3 : seq_state = "READ MISS (or READ MISS MODIFY) with victim" ; break ; case 0x4 : case 0x5 : case 0x6 : seq_state = "READ MISS (or READ MISS MODIFY) with no victim" ; break ; case 0x8 : case 0x9 : case 0xB : seq_state = "Refresh" ; break ; case 0xC : seq_state = "Idle, waiting for DMA pending read" ; break ; case 0xE : case 0xF : seq_state = "Idle, ras precharge" ; break ; default : seq_state = "Unknown" ; break ; } tmp = ( cia -> mem_err1 >> 24 ) & 0x1F ; switch ( tmp ) { case 0x00 : set_select = "Set 0 selected" ; break ; case 0x01 : set_select = "Set 1 selected" ; break ; case 0x02 : set_select = "Set 2 selected" ; break ; case 0x03 : set_select = "Set 3 selected" ; break ; case 0x04 : set_select = "Set 4 selected" ; break ; case 0x05 : set_select = "Set 5 selected" ; break ; case 0x06 : set_select = "Set 6 selected" ; break ; case 0x07 : set_select = "Set 7 selected" ; break ; case 0x08 : set_select = "Set 8 selected" ; break ; case 0x09 : set_select = "Set 9 selected" ; break ; case 0x0A : set_select = "Set A selected" ; break ; case 0x0B : set_select = "Set B selected" ; break ; case 0x0C : set_select = "Set C selected" ; break ; case 0x0D : set_select = "Set D selected" ; break ; case 0x0E : set_select = "Set E selected" ; break ; case 0x0F : set_select = "Set F selected" ; break ; case 0x10 : set_select = "No set selected" ; break ; case 0x1F : set_select = "Refresh cycle" ; break ; default : set_select = "Unknown" ; break ; } printk ( KERN_CRIT "  Memory port command: %s\n" , mem_port_cmd ) ; printk ( KERN_CRIT "  Memory port address: %#010lx, mask: %#lx\n" , mem_port_addr , mem_port_mask ) ; printk ( KERN_CRIT "  Memory sequencer state: %s\n" , seq_state ) ; printk ( KERN_CRIT "  Memory set: %s\n" , set_select ) ; } 