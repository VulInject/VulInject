static int zcp_props_list ( lua_State * state ) { const char * dsname = lua_tostring ( state , 1 ) ; dsl_pool_t * dp = zcp_run_info ( state ) -> zri_pool ; objset_t * os ; nvlist_t * * props = lua_newuserdata ( state , sizeof ( nvlist_t * ) ) ; dsl_dataset_t * ds = zcp_dataset_hold ( state , dp , dsname , FTAG ) ; VERIFY0 ( dmu_objset_from_ds ( ds , & os ) ) ; VERIFY0 ( dsl_prop_get_all ( os , props ) ) ; dsl_dataset_rele ( ds , FTAG ) ; luaL_getmetatable ( state , zcp_props_list_info . name ) ; ( void ) lua_setmetatable ( state , - 2 ) ; lua_pushlightuserdata ( state , NULL ) ; lua_pushcclosure ( state , & zcp_props_iter , 2 ) ; return ( 1 ) ; } 