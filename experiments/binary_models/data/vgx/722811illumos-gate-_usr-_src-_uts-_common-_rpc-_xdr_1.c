bool_t xdr_string ( XDR * xdrs , char * * cpp , const uint_t maxsize ) { char * sp = * cpp ; uint_t size ; uint_t nodesize ; switch ( xdrs -> x_op ) { case XDR_FREE : if ( sp == NULL ) { return ( TRUE ) ; } case XDR_ENCODE : size = ( sp != NULL ) ?( uint_t ) strlen ( sp ) : 0 ; break ; case XDR_DECODE : break ; } if ( ! xdr_u_int ( xdrs , & size ) ) { return ( FALSE ) ; } nodesize = size + 1 ; switch ( xdrs -> x_op ) { case XDR_DECODE : if ( nodesize == 0 ) { return ( TRUE ) ; } if ( sp == NULL ) { sp = ( char * ) mem_alloc ( nodesize ) ; } sp [ size ] = 0 ; if ( ! xdr_opaque ( xdrs , sp , size ) ) { if ( * cpp == NULL ) { mem_free ( sp , nodesize ) ; } return ( FALSE ) ; } if ( strlen ( sp ) != size ) { if ( * cpp == NULL ) { mem_free ( sp , nodesize ) ; } return ( FALSE ) ; } * cpp = sp ; return ( TRUE ) ; case XDR_ENCODE : return ( xdr_opaque ( xdrs , sp , size ) ) ; case XDR_FREE : mem_free ( sp , nodesize ) ; * cpp = NULL ; return ( TRUE ) ; } return ( FALSE ) ; } 