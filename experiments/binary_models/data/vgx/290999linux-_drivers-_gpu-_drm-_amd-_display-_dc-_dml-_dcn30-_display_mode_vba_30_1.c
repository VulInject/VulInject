static void CalculateMetaAndPTETimes ( int NumberOfActivePlanes , bool GPUVMEnable , int MetaChunkSize , int MinMetaChunkSizeBytes , int HTotal [ ] , double VRatio [ ] , double VRatioChroma [ ] , double DestinationLinesToRequestRowInVBlank [ ] , double DestinationLinesToRequestRowInImmediateFlip [ ] , bool DCCEnable [ ] , double PixelClock [ ] , int BytePerPixelY [ ] , int BytePerPixelC [ ] , enum scan_direction_class SourceScan [ ] , int dpte_row_height [ ] , int dpte_row_height_chroma [ ] , int meta_row_width [ ] , int meta_row_width_chroma [ ] , int meta_row_height [ ] , int meta_row_height_chroma [ ] , int meta_req_width [ ] , int meta_req_width_chroma [ ] , int meta_req_height [ ] , int meta_req_height_chroma [ ] , int dpte_group_bytes [ ] , int PTERequestSizeY [ ] , int PTERequestSizeC [ ] , int PixelPTEReqWidthY [ ] , int PixelPTEReqHeightY [ ] , int PixelPTEReqWidthC [ ] , int PixelPTEReqHeightC [ ] , int dpte_row_width_luma_ub [ ] , int dpte_row_width_chroma_ub [ ] , double DST_Y_PER_PTE_ROW_NOM_L [ ] , double DST_Y_PER_PTE_ROW_NOM_C [ ] , double DST_Y_PER_META_ROW_NOM_L [ ] , double DST_Y_PER_META_ROW_NOM_C [ ] , double TimePerMetaChunkNominal [ ] , double TimePerChromaMetaChunkNominal [ ] , double TimePerMetaChunkVBlank [ ] , double TimePerChromaMetaChunkVBlank [ ] , double TimePerMetaChunkFlip [ ] , double TimePerChromaMetaChunkFlip [ ] , double time_per_pte_group_nom_luma [ ] , double time_per_pte_group_vblank_luma [ ] , double time_per_pte_group_flip_luma [ ] , double time_per_pte_group_nom_chroma [ ] , double time_per_pte_group_vblank_chroma [ ] , double time_per_pte_group_flip_chroma [ ] ) { unsigned int meta_chunk_width = 0 ; unsigned int min_meta_chunk_width = 0 ; unsigned int meta_chunk_per_row_int = 0 ; unsigned int meta_row_remainder = 0 ; unsigned int meta_chunk_threshold = 0 ; unsigned int meta_chunks_per_row_ub = 0 ; unsigned int meta_chunk_width_chroma = 0 ; unsigned int min_meta_chunk_width_chroma = 0 ; unsigned int meta_chunk_per_row_int_chroma = 0 ; unsigned int meta_row_remainder_chroma = 0 ; unsigned int meta_chunk_threshold_chroma = 0 ; unsigned int meta_chunks_per_row_ub_chroma = 0 ; unsigned int dpte_group_width_luma = 0 ; int dpte_groups_per_row_luma_ub = 0 ; unsigned int dpte_group_width_chroma = 0 ; unsigned int dpte_groups_per_row_chroma_ub = 0 ; unsigned int k ; for ( k = 0 ; k < NumberOfActivePlanes ; ++ k ) { DST_Y_PER_PTE_ROW_NOM_L [ k ] = dpte_row_height [ k ] / VRatio [ k ] ; if ( BytePerPixelC [ k ] == 0 ) { DST_Y_PER_PTE_ROW_NOM_C [ k ] = 0 ; } else { DST_Y_PER_PTE_ROW_NOM_C [ k ] = dpte_row_height_chroma [ k ] / VRatioChroma [ k ] ; } DST_Y_PER_META_ROW_NOM_L [ k ] = meta_row_height [ k ] / VRatio [ k ] ; if ( BytePerPixelC [ k ] == 0 ) { DST_Y_PER_META_ROW_NOM_C [ k ] = 0 ; } else { DST_Y_PER_META_ROW_NOM_C [ k ] = meta_row_height_chroma [ k ] / VRatioChroma [ k ] ; } } for ( k = 0 ; k < NumberOfActivePlanes ; ++ k ) { if ( DCCEnable [ k ] == true ) { meta_chunk_width = MetaChunkSize * 1024 * 256 / BytePerPixelY [ k ] / meta_row_height [ k ] ; min_meta_chunk_width = MinMetaChunkSizeBytes * 256 / BytePerPixelY [ k ] / meta_row_height [ k ] ; meta_chunk_per_row_int = meta_row_width [ k ] / meta_chunk_width ; meta_row_remainder = meta_row_width [ k ] % meta_chunk_width ; if ( SourceScan [ k ] != dm_vert ) { meta_chunk_threshold = 2 * min_meta_chunk_width - meta_req_width [ k ] ; } else { meta_chunk_threshold = 2 * min_meta_chunk_width - meta_req_height [ k ] ; } if ( meta_row_remainder <= meta_chunk_threshold ) { meta_chunks_per_row_ub = meta_chunk_per_row_int + 1 ; } else { meta_chunks_per_row_ub = meta_chunk_per_row_int + 2 ; } TimePerMetaChunkNominal [ k ] = meta_row_height [ k ] / VRatio [ k ] * HTotal [ k ] / PixelClock [ k ] / meta_chunks_per_row_ub ; TimePerMetaChunkVBlank [ k ] = DestinationLinesToRequestRowInVBlank [ k ] * HTotal [ k ] / PixelClock [ k ] / meta_chunks_per_row_ub ; TimePerMetaChunkFlip [ k ] = DestinationLinesToRequestRowInImmediateFlip [ k ] * HTotal [ k ] / PixelClock [ k ] / meta_chunks_per_row_ub ; if ( BytePerPixelC [ k ] == 0 ) { TimePerChromaMetaChunkNominal [ k ] = 0 ; TimePerChromaMetaChunkVBlank [ k ] = 0 ; TimePerChromaMetaChunkFlip [ k ] = 0 ; } else { meta_chunk_width_chroma = MetaChunkSize * 1024 * 256 / BytePerPixelC [ k ] / meta_row_height_chroma [ k ] ; min_meta_chunk_width_chroma = MinMetaChunkSizeBytes * 256 / BytePerPixelC [ k ] / meta_row_height_chroma [ k ] ; meta_chunk_per_row_int_chroma = ( double ) meta_row_width_chroma [ k ] / meta_chunk_width_chroma ; meta_row_remainder_chroma = meta_row_width_chroma [ k ] % meta_chunk_width_chroma ; if ( SourceScan [ k ] != dm_vert ) { meta_chunk_threshold_chroma = 2 * min_meta_chunk_width_chroma - meta_req_width_chroma [ k ] ; } else { meta_chunk_threshold_chroma = 2 * min_meta_chunk_width_chroma - meta_req_height_chroma [ k ] ; } if ( meta_row_remainder_chroma <= meta_chunk_threshold_chroma ) { meta_chunks_per_row_ub_chroma = meta_chunk_per_row_int_chroma + 1 ; } else { meta_chunks_per_row_ub_chroma = meta_chunk_per_row_int_chroma + 2 ; } TimePerChromaMetaChunkNominal [ k ] = meta_row_height_chroma [ k ] / VRatioChroma [ k ] * HTotal [ k ] / PixelClock [ k ] / meta_chunks_per_row_ub_chroma ; TimePerChromaMetaChunkVBlank [ k ] = DestinationLinesToRequestRowInVBlank [ k ] * HTotal [ k ] / PixelClock [ k ] / meta_chunks_per_row_ub_chroma ; TimePerChromaMetaChunkFlip [ k ] = DestinationLinesToRequestRowInImmediateFlip [ k ] * HTotal [ k ] / PixelClock [ k ] / meta_chunks_per_row_ub_chroma ; } } else { TimePerMetaChunkNominal [ k ] = 0 ; TimePerMetaChunkVBlank [ k ] = 0 ; TimePerMetaChunkFlip [ k ] = 0 ; TimePerChromaMetaChunkNominal [ k ] = 0 ; TimePerChromaMetaChunkVBlank [ k ] = 0 ; TimePerChromaMetaChunkFlip [ k ] = 0 ; } } for ( k = 0 ; k < NumberOfActivePlanes ; ++ k ) { if ( GPUVMEnable == true ) { if ( SourceScan [ k ] != dm_vert ) { dpte_group_width_luma = dpte_group_bytes [ k ] / PTERequestSizeY [ k ] * PixelPTEReqWidthY [ k ] ; } else { dpte_group_width_luma = dpte_group_bytes [ k ] / PTERequestSizeY [ k ] * PixelPTEReqHeightY [ k ] ; } dpte_groups_per_row_luma_ub = dml_ceil ( 1.0 * dpte_row_width_luma_ub [ k ] / dpte_group_width_luma , 1 ) ; time_per_pte_group_nom_luma [ k ] = DST_Y_PER_PTE_ROW_NOM_L [ k ] * HTotal [ k ] / PixelClock [ k ] / dpte_groups_per_row_luma_ub ; time_per_pte_group_vblank_luma [ k ] = DestinationLinesToRequestRowInVBlank [ k ] * HTotal [ k ] / PixelClock [ k ] / dpte_groups_per_row_luma_ub ; time_per_pte_group_flip_luma [ k ] = DestinationLinesToRequestRowInImmediateFlip [ k ] * HTotal [ k ] / PixelClock [ k ] / dpte_groups_per_row_luma_ub ; if ( BytePerPixelC [ k ] == 0 ) { time_per_pte_group_nom_chroma [ k ] = 0 ; time_per_pte_group_vblank_chroma [ k ] = 0 ; time_per_pte_group_flip_chroma [ k ] = 0 ; } else { if ( SourceScan [ k ] != dm_vert ) { dpte_group_width_chroma = dpte_group_bytes [ k ] / PTERequestSizeC [ k ] * PixelPTEReqWidthC [ k ] ; } else { dpte_group_width_chroma = dpte_group_bytes [ k ] / PTERequestSizeC [ k ] * PixelPTEReqHeightC [ k ] ; } dpte_groups_per_row_chroma_ub = dml_ceil ( 1.0 * dpte_row_width_chroma_ub [ k ] / dpte_group_width_chroma , 1 ) ; time_per_pte_group_nom_chroma [ k ] = DST_Y_PER_PTE_ROW_NOM_C [ k ] * HTotal [ k ] / PixelClock [ k ] / dpte_groups_per_row_chroma_ub ; time_per_pte_group_vblank_chroma [ k ] = DestinationLinesToRequestRowInVBlank [ k ] * HTotal [ k ] / PixelClock [ k ] / dpte_groups_per_row_chroma_ub ; time_per_pte_group_flip_chroma [ k ] = DestinationLinesToRequestRowInImmediateFlip [ k ] * HTotal [ k ] / PixelClock [ k ] / dpte_groups_per_row_chroma_ub ; } } else { time_per_pte_group_nom_luma [ k ] = 0 ; time_per_pte_group_vblank_luma [ k ] = 0 ; time_per_pte_group_flip_luma [ k ] = 0 ; time_per_pte_group_nom_chroma [ k ] = 0 ; time_per_pte_group_vblank_chroma [ k ] = 0 ; time_per_pte_group_flip_chroma [ k ] = 0 ; } } } 