static int gntdev_copy ( struct gntdev_copy_batch * batch ) { int i ; gnttab_batch_copy ( batch -> ops , batch -> nr_ops ) ; gntdev_put_pages ( batch ) ; for ( i = 0 ; i < batch -> nr_ops ; i ++ ) { s16 status = batch -> ops [ i ] . status ; s16 old_status ; if ( status == GNTST_okay ) { continue ; } if ( __get_user ( old_status , batch -> status [ i ] ) ) { return - EFAULT ; } if ( old_status != GNTST_okay ) { continue ; } if ( __put_user ( status , batch -> status [ i ] ) ) { return - EFAULT ; } } batch -> nr_ops = 0 ; return 0 ; } 