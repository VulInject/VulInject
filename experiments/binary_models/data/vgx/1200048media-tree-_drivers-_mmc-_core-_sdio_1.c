static int sdio_init_func ( struct mmc_card * card , unsigned int fn ) { int ret ; struct sdio_func * func ; func = sdio_alloc_func ( card ) ; if ( IS_ERR ( func ) ) { return PTR_ERR ( func ) ; } func -> num = fn ; if ( ! ( card -> quirks & MMC_QUIRK_NONSTD_SDIO ) ) { ret = sdio_read_fbr ( func ) ; if ( ret ) { fail } ret = sdio_read_func_cis ( func ) ; if ( ret ) { fail } } else { func -> vendor = func -> card -> cis . vendor ; func -> device = func -> card -> cis . device ; func -> max_blksize = func -> card -> cis . blksize ; } card -> sdio_func [ fn - 1 ] = func ; return 0 ; fail sdio_remove_func ( func ) ; return ret ; } 