static int fprobe_init_rethook ( struct fprobe * fp , int num ) { int i , size ; if ( num < 0 ) { return - EINVAL ; } if ( ! fp -> exit_handler ) { fp -> rethook = NULL ; return 0 ; } size = num * num_possible_cpus ( ) * 2 ; if ( size < 0 ) { return - E2BIG ; } fp -> rethook = rethook_alloc ( ( void * ) fp , fprobe_exit_handler ) ; if ( ! fp -> rethook ) { return - ENOMEM ; } for ( i = 0 ; i < size ; i ++ ) { struct fprobe_rethook_node * node ; node = kzalloc ( sizeof ( * node ) , GFP_KERNEL ) ; if ( ! node ) { fp -> rethook = NULL ; return - ENOMEM ; } rethook_add_node ( fp -> rethook , & node -> node ) ; } return 0 ; } 