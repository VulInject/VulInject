struct ia_css_shading_table * ia_css_shading_table_alloc ( unsigned int width , unsigned int height ) { unsigned int i ; struct ia_css_shading_table * me ; IA_CSS_ENTER ( "" ) ; me = kmalloc ( sizeof ( * me ) , GFP_KERNEL ) ; if ( me == NULL ) { IA_CSS_ERROR ( "out of memory" ) ; return me ; } me -> width = width ; me -> height = height ; me -> sensor_width = 0 ; me -> sensor_height = 0 ; me -> fraction_bits = 0 ; for ( i = 0 ; i < IA_CSS_SC_NUM_COLORS ; i ++ ) { me -> data [ i ] = sh_css_malloc ( width * height * sizeof ( * me -> data [ 0 ] ) ) ; if ( me -> data [ i ] == NULL ) { unsigned int j ; for ( j = 0 ; j < i ; j ++ ) { sh_css_free ( me -> data [ j ] ) ; me -> data [ j ] = NULL ; } return NULL ; } } IA_CSS_LEAVE ( "" ) ; return me ; } 