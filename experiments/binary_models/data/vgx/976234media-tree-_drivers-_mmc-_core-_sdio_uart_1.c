static int sdio_uart_write ( struct tty_struct * tty , const unsigned char * buf , int count ) { struct sdio_uart_port * port = tty -> driver_data ; int ret ; ret = kfifo_in_locked ( & port -> xmit_fifo , buf , count , & port -> write_lock ) ; if ( ! ( port -> ier & UART_IER_THRI ) ) { int err = sdio_uart_claim_func ( port ) ; if ( ! err ) { sdio_uart_start_tx ( port ) ; sdio_uart_irq ( port -> func ) ; sdio_uart_release_func ( port ) ; } else { ret = err ; } } return ret ; } 