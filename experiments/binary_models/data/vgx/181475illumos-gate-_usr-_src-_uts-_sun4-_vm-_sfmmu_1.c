caddr_t sfmmu_ktsb_alloc ( caddr_t tsbbase ) { caddr_t vaddr ; if ( enable_bigktsb ) { ktsb_base = ( caddr_t ) roundup ( ( uintptr_t ) tsbbase , ktsb_sz ) ; vaddr = prom_alloc ( ktsb_base , ktsb_sz , ktsb_sz ) ; if ( vaddr != ktsb_base ) { cmn_err ( CE_PANIC , "sfmmu_ktsb_alloc: can't alloc" " 8K bigktsb" ) ; } ktsb_base = vaddr ; tsbbase = ktsb_base + ktsb_sz ; PRM_DEBUG ( ktsb_base , NULL ) ; PRM_DEBUG ( tsbbase ) ; } if ( ktsb4m_szcode > TSB_64K_SZCODE ) { ASSERT ( ktsb_phys && enable_bigktsb ) ; ktsb4m_base = ( caddr_t ) roundup ( ( uintptr_t ) tsbbase , ktsb4m_sz ) ; vaddr = ( caddr_t ) BOP_ALLOC ( bootops , ktsb4m_base , ktsb4m_sz , ktsb4m_sz ) ; if ( vaddr != ktsb4m_base ) { cmn_err ( CE_PANIC , "sfmmu_ktsb_alloc: can't alloc" " 4M bigktsb" ) ; } ktsb4m_base = vaddr ; tsbbase = ktsb4m_base + ktsb4m_sz ; PRM_DEBUG ( ktsb4m_base ) ; PRM_DEBUG ( tsbbase ) ; } return ( tsbbase ) ; } 