static tool_rc process_inputs ( ESYS_CONTEXT * ectx ) { tool_rc rc = tpm2_auth_util_from_optarg ( ectx , ctx . object . auth_new , & ctx . object . new , true ) ; ctx . new_auth = tpm2_session_get_auth_value ( ctx . object . new ) ; rc = tpm2_util_object_load_auth ( ectx , ctx . object . ctx , ctx . object . auth_current , & ctx . object . obj , false , TPM2_HANDLE_ALL_W_NV ) ; if ( rc != tool_rc_success ) { return rc ; } if ( ctx . object . obj . tr_handle == ESYS_TR_RH_NULL ) { LOG_ERR ( "Cannot change the null hierarchy authorization" ) ; return tool_rc_general_error ; } bool load_parent = object_needs_parent ( & ctx . object . obj ) ; if ( load_parent && ! ctx . parent . ctx ) { LOG_ERR ( "Expected parent object information via -C" ) ; return tool_rc_option_error ; } if ( load_parent ) { rc = tpm2_util_object_load ( ectx , ctx . parent . ctx , & ctx . parent . obj , TPM2_HANDLE_ALL_W_NV ) ; if ( rc != tool_rc_success ) { return rc ; } } rc = tpm2_util_aux_sessions_setup ( ectx , ctx . aux_session_cnt , ctx . aux_session_path , ctx . aux_session_handle , ctx . aux_session ) ; if ( rc != tool_rc_success ) { return rc ; } tpm2_session * all_sessions [ MAX_SESSIONS ] { ctx . object . obj . session ctx . aux_session [ 0 ] ctx . aux_session [ 1 ] } ; ; const char * * cphash_path = ctx . cp_hash_path ?& ctx . cp_hash_path : 0 ; const char * * rphash_path = ctx . rp_hash_path ?& ctx . rp_hash_path : 0 ; ctx . parameter_hash_algorithm = tpm2_util_calculate_phash_algorithm ( ectx , cphash_path , & ctx . cp_hash , rphash_path , & ctx . rp_hash , all_sessions ) ; ctx . is_command_dispatch = ( ctx . cp_hash_path && ! ctx . rp_hash_path ) ?false : true ; return tool_rc_success ; } 