int cxio_hal_pblpool_create ( struct cxio_rdev * rdev_p ) { unsigned pbl_start , pbl_chunk ; rdev_p -> pbl_pool = gen_pool_create ( MIN_PBL_SHIFT , - 1 ) ; pbl_start = rdev_p -> rnic_info . pbl_base ; pbl_chunk = rdev_p -> rnic_info . pbl_top - pbl_start + 1 ; while ( pbl_start < rdev_p -> rnic_info . pbl_top ) { pbl_chunk = min ( rdev_p -> rnic_info . pbl_top - pbl_start + 1 , pbl_chunk ) ; if ( gen_pool_add ( rdev_p -> pbl_pool , pbl_start , pbl_chunk , - 1 ) ) { pr_debug ( "%s failed to add PBL chunk (%x/%x)\n" , __func__ , pbl_start , pbl_chunk ) ; if ( pbl_chunk <= 1024 << MIN_PBL_SHIFT ) { pr_warn ( "%s: Failed to add all PBL chunks (%x/%x)\n" , __func__ , pbl_start , rdev_p -> rnic_info . pbl_top - pbl_start ) ; return 0 ; } pbl_chunk >>= 1 ; } else { pr_debug ( "%s added PBL chunk (%x/%x)\n" , __func__ , pbl_start , pbl_chunk ) ; pbl_start += pbl_chunk ; } } return 0 ; } 