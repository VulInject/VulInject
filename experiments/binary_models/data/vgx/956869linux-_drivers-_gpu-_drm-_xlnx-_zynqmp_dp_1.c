static int zynqmp_dp_update_vs_emph ( struct zynqmp_dp * dp ) { unsigned int i ; int ret ; ret = drm_dp_dpcd_write ( & dp -> aux , DP_TRAINING_LANE0_SET , dp -> train_set , dp -> mode . lane_cnt ) ; for ( i = 0 ; i < dp -> mode . lane_cnt ; i ++ ) { u32 reg = ZYNQMP_DP_SUB_TX_PHY_PRECURSOR_LANE_0 + i * 4 ; union phy_configure_opts opts = { 0 } ; u8 train = dp -> train_set [ i ] ; opts . dp . voltage [ 0 ] = ( train & DP_TRAIN_VOLTAGE_SWING_MASK ) >> DP_TRAIN_VOLTAGE_SWING_SHIFT ; opts . dp . pre [ 0 ] = ( train & DP_TRAIN_PRE_EMPHASIS_MASK ) >> DP_TRAIN_PRE_EMPHASIS_SHIFT ; phy_configure ( dp -> phy [ i ] , & opts ) ; zynqmp_dp_write ( dp , reg , 0x2 ) ; } return 0 ; } 