GList * services_os_get_single_directory_list ( const char * root , gboolean files , gboolean executable ) { GList * list = NULL ; struct dirent * * namelist ; int entries = 0 , lpc = 0 ; char buffer [ PATH_MAX ] ; entries = scandir ( root , & namelist , NULL , alphasort ) ; if ( entries <= 0 ) { return list ; } for ( lpc = 0 ; lpc < entries ; lpc ++ ) { struct stat sb ; if ( '.' == namelist [ lpc ] -> d_name [ 0 ] ) { free ( namelist [ lpc ] ) ; continue ; } snprintf ( buffer , sizeof ( buffer ) , "%s/%s" , root , namelist [ lpc ] -> d_name ) ; if ( stat ( buffer , & sb ) ) { continue ; } if ( S_ISDIR ( sb . st_mode ) ) { if ( files ) { free ( namelist [ lpc ] ) ; continue ; } } if ( S_ISREG ( sb . st_mode ) ) { if ( files == FALSE ) { free ( namelist [ lpc ] ) ; continue ; } if ( executable && ( sb . st_mode & S_IXUSR ) == 0 && ( sb . st_mode & S_IXGRP ) == 0 && ( sb . st_mode & S_IXOTH ) == 0 ) { free ( namelist [ lpc ] ) ; continue ; } } list = g_list_append ( list , strdup ( namelist [ lpc ] -> d_name ) ) ; free ( namelist [ lpc ] ) ; } return list ; } 