static void * s390_elf_load ( struct kimage * image , char * kernel , unsigned long kernel_len , char * initrd , unsigned long initrd_len , char * cmdline , unsigned long cmdline_len ) { const Elf_Ehdr * ehdr ; const Elf_Phdr * phdr ; size_t size ; int i ; ehdr = ( Elf_Ehdr * ) kernel ; if ( ehdr -> e_type != ET_EXEC || ehdr -> e_ident [ EI_CLASS ] != ELFCLASS64 || ! elf_check_arch ( ehdr ) ) { return ERR_PTR ( - EINVAL ) ; } if ( ! ehdr -> e_phnum || ehdr -> e_phentsize != sizeof ( Elf_Phdr ) ) { return ERR_PTR ( - EINVAL ) ; } size = ehdr -> e_ehsize + ehdr -> e_phoff ; size += ehdr -> e_phentsize * ehdr -> e_phnum ; phdr = ( void * ) ehdr + ehdr -> e_phoff ; size = ALIGN ( size , phdr -> p_align ) ; for ( i = 0 ; i < ehdr -> e_phnum ; i ++ , phdr ++ ) { if ( phdr -> p_type == PT_INTERP ) { return ERR_PTR ( - EINVAL ) ; } if ( phdr -> p_offset > kernel_len ) { return ERR_PTR ( - EINVAL ) ; } size += ALIGN ( phdr -> p_filesz , phdr -> p_align ) ; } if ( size > kernel_len ) { return ERR_PTR ( - EINVAL ) ; } return kexec_file_add_components ( image , kexec_file_add_kernel_elf ) ; } 