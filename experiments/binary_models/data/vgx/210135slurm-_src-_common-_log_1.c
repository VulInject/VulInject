extern char * log_build_step_id_str ( slurm_step_id_t * step_id , char * buf , int buf_size , uint16_t flags ) { int pos = 0 ; xassert ( buf_size > 1 ) ; buf [ pos ] = '\0' ; if ( flags & STEP_ID_FLAG_SPACE ) { buf [ pos ++ ] = ' ' ; } if ( flags & STEP_ID_FLAG_PS ) { pos += snprintf ( buf + pos , buf_size - pos , "%%.0s" ) ; } if ( ! ( flags & STEP_ID_FLAG_NO_PREFIX ) ) { pos += snprintf ( buf + pos , buf_size - pos , "%s" , ( ! step_id || ( step_id -> step_id != NO_VAL ) ) ?"StepId=" : "JobId=" ) ; } if ( ! step_id || ! step_id -> job_id ) { snprintf ( buf + pos , buf_size - pos , "Invalid" ) ; return buf ; } if ( step_id -> job_id && ! ( flags & STEP_ID_FLAG_NO_JOB ) ) { pos += snprintf ( buf + pos , buf_size - pos , "%u%s" , step_id -> job_id , step_id -> step_id == NO_VAL ?"" : "." ) ; } if ( ( pos >= buf_size ) || ( step_id -> step_id == NO_VAL ) ) { return buf ; } if ( step_id -> step_id == SLURM_BATCH_SCRIPT ) { pos += snprintf ( buf + pos , buf_size - pos , "batch" ) ; } if ( step_id -> step_id == SLURM_EXTERN_CONT ) { pos += snprintf ( buf + pos , buf_size - pos , "extern" ) ; } if ( step_id -> step_id == SLURM_INTERACTIVE_STEP ) { pos += snprintf ( buf + pos , buf_size - pos , "interactive" ) ; } if ( step_id -> step_id == SLURM_PENDING_STEP ) { pos += snprintf ( buf + pos , buf_size - pos , "TDB" ) ; } else { pos += snprintf ( buf + pos , buf_size - pos , "%u" , step_id -> step_id ) ; } if ( pos >= buf_size ) { return buf ; } if ( step_id -> step_het_comp != NO_VAL ) { snprintf ( buf + pos , buf_size - pos , "+%u" , step_id -> step_het_comp ) ; } return buf ; } 