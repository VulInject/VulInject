static int steam_send_report ( struct steam_device * steam , u8 * cmd , int size ) { struct hid_report * r ; u8 * buf ; unsigned int retries = 50 ; int ret ; r = steam -> hdev -> report_enum [ HID_FEATURE_REPORT ] . report_id_hash [ 0 ] ; if ( ! r ) { hid_err ( steam -> hdev , "No HID_FEATURE_REPORT submitted -  nothing to read\n" ) ; return - EINVAL ; } if ( hid_report_len ( r ) < 64 ) { return - EINVAL ; } buf = hid_alloc_report_buf ( r , GFP_KERNEL ) ; if ( ! buf ) { return - ENOMEM ; } memcpy ( buf + 1 , cmd , size ) ; { ret = hid_hw_raw_request ( steam -> hdev , 0 , buf , max ( size , 64 ) + 1 , HID_FEATURE_REPORT , HID_REQ_SET_REPORT ) ; if ( ret != - EPIPE ) { break ; } msleep ( 20 ) ; } -- retries ; if ( ret < 0 ) { hid_err ( steam -> hdev , "%s: error %d (%*ph)\n" , __func__ , ret , size , cmd ) ; } return ret ; } 