int rdfulline ( fd , line , lim ) FILE * fd ; char * line ; int lim ; { register char * p , * c ; char buf [ BUFSIZ ] ; size_t blr , btox ; p = line ; for ( ; fgets ( buf , BUFSIZ , fd ) != NULL ; ) { if ( buf [ 0 ] == '#' ) { continue ; } c = & buf [ strlen ( buf ) - 1 ] ; while ( c >= buf && ( * c == '\n' || * c == '\t' || * c == ' ' ) ) { * c -- = NULLCHAR ; } if ( buf [ 0 ] == '\n' || buf [ 0 ] == NULLCHAR ) { continue ; } blr = lim - 1 - ( p - line ) ; btox = blr < strlen ( buf ) ?blr : strlen ( buf ) ; ( void ) strncpy ( p , buf , btox ) ; p += btox - 1 ; if ( * ( p - 1 ) == '\\' ) { p -- ; } else { break ; } } * ++ p = '\0' ; return ( p - line - 1 ) ; } 