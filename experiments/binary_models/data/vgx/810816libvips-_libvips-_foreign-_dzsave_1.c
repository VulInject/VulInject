static gboolean tile_equal ( VipsImage * image , int threshold , VipsPel * restrict ink ) { const int bytes = VIPS_IMAGE_SIZEOF_PEL ( image ) ; VipsRect rect ; VipsRegion * region ; int x , y , b ; region = vips_region_new ( image ) ; rect . left = 0 ; rect . top = 0 ; rect . width = image -> Xsize ; rect . height = image -> Ysize ; if ( vips_region_prepare ( region , & rect ) ) { return ( FALSE ) ; } for ( y = 0 ; y < image -> Ysize ; y ++ ) { VipsPel * restrict p = VIPS_REGION_ADDR ( region , 0 , y ) ; for ( x = 0 ; x < image -> Xsize ; x ++ ) { for ( b = 0 ; b < bytes ; b ++ ) { if ( VIPS_ABS ( p [ b ] - ink [ b ] ) > threshold ) { g_object_unref ( region ) ; return ( FALSE ) ; } } p += bytes ; } } g_object_unref ( region ) ; return ( TRUE ) ; } 