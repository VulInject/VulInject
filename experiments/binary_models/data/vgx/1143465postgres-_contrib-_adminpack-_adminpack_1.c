PG_FUNCTION_INFO_V1 ( pg_file_unlink ) ; PG_FUNCTION_INFO_V1 ( pg_file_unlink_v1_1 ) ; PG_FUNCTION_INFO_V1 ( pg_logdir_ls ) ; PG_FUNCTION_INFO_V1 ( pg_logdir_ls_v1_1 ) ; static int64 pg_file_write_internal ( text * file , text * data , bool replace ) static bool pg_file_rename_internal ( text * file1 , text * file2 , text * file3 ) static Datum pg_logdir_ls_internal ( FunctionCallInfo fcinfo ) static char * convert_and_check_filename ( text * arg ) { char * filename = text_to_cstring ( arg ) ; canonicalize_path ( filename , NULL ) ; if ( has_privs_of_role ( GetUserId ( ) , ROLE_PG_WRITE_SERVER_FILES ) ) { return filename ; } if ( is_absolute_path ( filename ) ) { if ( ! path_is_prefix_of_path ( DataDir , filename ) ) { ereport ( ERROR , ( errcode ( ERRCODE_INSUFFICIENT_PRIVILEGE ) , errmsg ( "absolute path not allowed" ) ) ) ; } } if ( ! path_is_relative_and_below_cwd ( filename ) ) { ereport ( ERROR , ( errcode ( ERRCODE_INSUFFICIENT_PRIVILEGE ) , errmsg ( "path must be in or below the current directory" ) ) ) ; } return filename ; } 