static void test_libbpf_bpf_map_type_str ( void ) { struct btf * btf ; const struct btf_type * t ; const struct btf_enum * e ; int i , n , id ; btf = btf__parse ( "/sys/kernel/btf/vmlinux" , NULL ) ; if ( ! ASSERT_OK_PTR ( btf , "btf_parse" ) ) { return ; } id = btf__find_by_name_kind ( btf , "bpf_map_type" , BTF_KIND_ENUM ) ; if ( ! ASSERT_GT ( id , 0 , "bpf_map_type_id" ) ) { cleanup } t = btf__type_by_id ( btf , id ) ; e = btf_enum ( t ) ; n = btf_vlen ( t ) ; for ( i = 0 ; i < n ; e ++ , i ++ ) { enum bpf_map_type map_type = ( bpf_map_type ) e -> val ; const char * map_type_name ; const char * map_type_str ; char buf [ 256 ] ; map_type_name = btf__str_by_offset ( btf , e -> name_off ) ; map_type_str = libbpf_bpf_map_type_str ( map_type ) ; ASSERT_OK_PTR ( map_type_str , map_type_name ) ; sprintf ( buf , "BPF_MAP_TYPE_%s" , map_type_str ) ; uppercase ( buf ) ; if ( strcmp ( map_type_name , "BPF_MAP_TYPE_CGROUP_STORAGE_DEPRECATED" ) == 0 ) { continue ; } ASSERT_STREQ ( buf , map_type_name , "exp_str_value" ) ; } cleanup btf__free ( btf ) ; } 