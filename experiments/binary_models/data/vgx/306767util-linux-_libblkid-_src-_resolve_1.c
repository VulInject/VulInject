char * blkid_get_devname ( blkid_cache cache , const char * token , const char * value ) { blkid_dev dev ; blkid_cache c = cache ; char * t = NULL , * v = NULL ; char * ret = NULL ; if ( ! token ) { return NULL ; } if ( ! cache && blkid_get_cache ( & c , NULL ) < 0 ) { return NULL ; } DBG ( TAG , ul_debug ( "looking for %s%s%s %s" , token , value ?"=" : "" , value ?value : "" , cache ?"in cache" : "from disk" ) ) ; if ( ! value ) { if ( ! strchr ( token , '=' ) ) { ret = strdup ( token ) ; out } if ( blkid_parse_tag_string ( token , & t , & v ) != 0 || ! t || ! v ) { out } token = t ; value = v ; } dev = blkid_find_dev_with_tag ( c , token , value ) ; if ( ! dev ) { out } ret = dev -> bid_name ?strdup ( dev -> bid_name ) : NULL ; out free ( v ) ; if ( ! cache ) { blkid_put_cache ( c ) ; } return ret ; } 