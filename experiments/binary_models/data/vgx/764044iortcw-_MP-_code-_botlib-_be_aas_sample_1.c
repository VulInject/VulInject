aas_face_t * AAS_TraceEndFace ( aas_trace_t * trace ) { int i , facenum ; aas_area_t * area ; aas_face_t * face , * firstface = NULL ; if ( ! ( * aasworld ) . loaded ) { return NULL ; } if ( trace -> startsolid ) { return in ; } area = & ( * aasworld ) . areas [ trace -> lastarea ] ; for ( i = 0 ; i < area -> numfaces ; i ++ ) { facenum = ( * aasworld ) . faceindex [ area -> firstface + i ] ; face = & ( * aasworld ) . faces [ abs ( facenum ) ] ; if ( ( face -> planenum & ~ 1 ) == ( trace -> planenum & ~ 1 ) ) { if ( AAS_InsideFace ( face , ( * aasworld ) . planes [ face -> planenum ] . normal , trace -> endpos , 0.01 ) ) { return face ; } } } return firstface ; } 