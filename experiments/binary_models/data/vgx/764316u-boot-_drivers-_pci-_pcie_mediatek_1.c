static int mtk_pcie_parse_port ( struct udevice * dev , u32 slot ) { struct mtk_pcie * pcie = dev_get_priv ( dev ) ; struct mtk_pcie_port * port ; char name [ 10 ] ; int err ; port = devm_kzalloc ( dev , sizeof ( * port ) , GFP_KERNEL ) ; snprintf ( name , sizeof ( name ) , "port%d" , slot ) ; port -> base = dev_remap_addr_name ( dev , name ) ; if ( ! port -> base ) { return - ENOENT ; } snprintf ( name , sizeof ( name ) , "sys_ck%d" , slot ) ; err = clk_get_by_name ( dev , name , & port -> sys_ck ) ; if ( err ) { return err ; } err = reset_get_by_index ( dev , slot , & port -> reset ) ; if ( err ) { return err ; } err = generic_phy_get_by_index ( dev , slot , & port -> phy ) ; if ( err ) { return err ; } port -> slot = slot ; port -> pcie = pcie ; INIT_LIST_HEAD ( & port -> list ) ; list_add_tail ( & port -> list , & pcie -> ports ) ; return 0 ; } 