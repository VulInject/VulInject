gimp_controller_editor_edit_clicked ( , ) { GtkTreeModel * model ; GtkTreeIter iter ; gchar * event_name = NULL ; gchar * event_blurb ; gchar * action_name = NULL ; gimp_controller_info_set_event_snooper ( editor -> info , NULL , NULL ) ; if ( gtk_tree_selection_get_selected ( editor -> sel , & model , & iter ) ) { gtk_tree_model_get ( model , & iter , COLUMN_EVENT , & event_name , COLUMN_BLURB , & event_blurb , COLUMN_ACTION , & action_name , - 1 ) ; } if ( event_name ) { GtkWidget * view ; gchar * title ; title = g_strdup_printf ( _ ( "Select Action for Event '%s'" ) , event_blurb ) ; editor -> edit_dialog = gimp_viewable_dialog_new ( g_list_prepend ( NULL , editor -> info ) , editor -> context , _ ( "Select Controller Event Action" ) , "gimp-controller-action-dialog" , GIMP_ICON_EDIT , title , gtk_widget_get_toplevel ( GTK_WIDGET ( editor ) ) , gimp_standard_help_func , GIMP_HELP_PREFS_INPUT_CONTROLLERS , _ ( "_Cancel" ) , GTK_RESPONSE_CANCEL , _ ( "_OK" ) , GTK_RESPONSE_OK , NULL ) ; g_free ( title ) ; gimp_dialog_set_alternative_button_order ( GTK_DIALOG ( editor -> edit_dialog ) , GTK_RESPONSE_OK , GTK_RESPONSE_CANCEL , - 1 ) ; g_object_add_weak_pointer ( G_OBJECT ( editor -> edit_dialog ) , ( gpointer ) & editor -> edit_dialog ) ; gimp_dialog_factory_add_foreign ( gimp_dialog_factory_get_singleton ( ) , "gimp-controller-action-dialog" , editor -> edit_dialog , gimp_widget_get_monitor ( button ) ) ; g_signal_connect ( editor -> edit_dialog , "response" , G_CALLBACK ( gimp_controller_editor_edit_response ) , editor ) ; view = gimp_action_editor_new ( gimp_ui_managers_from_name ( "<Image>" ) -> data , action_name , FALSE ) ; gtk_container_set_border_width ( GTK_CONTAINER ( view ) , 12 ) ; gtk_box_pack_start ( GTK_BOX ( gtk_dialog_get_content_area ( GTK_DIALOG ( editor -> edit_dialog ) ) ) , view , TRUE , TRUE , 0 ) ; gtk_widget_show ( view ) ; g_signal_connect ( GIMP_ACTION_EDITOR ( view ) -> view , "row-activated" , G_CALLBACK ( gimp_controller_editor_edit_activated ) , editor ) ; editor -> edit_sel = gtk_tree_view_get_selection ( GTK_TREE_VIEW ( GIMP_ACTION_EDITOR ( view ) -> view ) ) ; g_object_add_weak_pointer ( G_OBJECT ( editor -> edit_sel ) , ( gpointer ) & editor -> edit_sel ) ; gtk_widget_set_sensitive ( GTK_WIDGET ( editor ) , FALSE ) ; gtk_widget_show ( editor -> edit_dialog ) ; g_free ( event_name ) ; g_free ( event_blurb ) ; g_free ( action_name ) ; } } 