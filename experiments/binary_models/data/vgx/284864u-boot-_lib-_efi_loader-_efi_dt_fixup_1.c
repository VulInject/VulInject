void efi_carve_out_dt_rsv ( void * fdt ) { int nr_rsv , i ; u64 addr , size ; int nodeoffset , subnode ; nr_rsv = fdt_num_mem_rsv ( fdt ) ; for ( i = 0 ; i < nr_rsv ; i ++ ) { efi_reserve_memory ( addr , size , true ) ; } nodeoffset = fdt_subnode_offset ( fdt , 0 , "reserved-memory" ) ; if ( nodeoffset >= 0 ) { subnode = fdt_first_subnode ( fdt , nodeoffset ) ; while ( subnode >= 0 ) { fdt_addr_t fdt_addr ; fdt_size_t fdt_size ; fdt_addr = fdtdec_get_addr_size_auto_parent ( fdt , nodeoffset , subnode , "reg" , 0 , & fdt_size , false ) ; if ( fdt_addr != FDT_ADDR_T_NONE && fdtdec_get_is_enabled ( fdt , subnode ) ) { bool nomap ; nomap = ! ! fdt_getprop ( fdt , subnode , "no-map" , NULL ) ; efi_reserve_memory ( fdt_addr , fdt_size , nomap ) ; } subnode = fdt_next_subnode ( fdt , subnode ) ; } } } 