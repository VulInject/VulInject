int Mat_VarReadData73 ( mat_t * mat , matvar_t * matvar , void * data , int * start , int * stride , int * edge ) { int err = MATIO_E_NO_ERROR , k ; hid_t fid , dset_id , ref_id , dset_space , mem_space ; hsize_t * dset_start_stride_edge ; hsize_t * dset_start , * dset_stride , * dset_edge ; if ( NULL == mat || NULL == matvar || NULL == data || NULL == start || NULL == stride || NULL == edge ) { return MATIO_E_BAD_ARGUMENT ; } if ( NULL == matvar -> internal -> hdf5_name && 0 > matvar -> internal -> id ) { return MATIO_E_FAIL_TO_IDENTIFY ; } fid = * ( hid_t * ) mat -> fp ; dset_start_stride_edge = ( hsize_t * ) malloc ( matvar -> rank * 3 * sizeof ( hsize_t ) ) ; if ( NULL == dset_start_stride_edge ) { return MATIO_E_OUT_OF_MEMORY ; } dset_start = & dset_start_stride_edge [ 0 ] ; dset_stride = & dset_start_stride_edge [ matvar -> rank ] ; dset_edge = & dset_start_stride_edge [ 2 * matvar -> rank ] ; for ( k = 0 ; k < matvar -> rank ; k ++ ) { dset_start [ k ] = start [ matvar -> rank - k - 1 ] ; dset_stride [ k ] = stride [ matvar -> rank - k - 1 ] ; dset_edge [ k ] = edge [ matvar -> rank - k - 1 ] ; } mem_space = H5Screate_simple ( matvar -> rank , dset_edge , NULL ) ; switch ( matvar -> class_type ) { case MAT_C_DOUBLE : case MAT_C_SINGLE : case MAT_C_INT64 : case MAT_C_UINT64 : case MAT_C_INT32 : case MAT_C_UINT32 : case MAT_C_INT16 : case MAT_C_UINT16 : case MAT_C_INT8 : case MAT_C_UINT8 : if ( NULL != matvar -> internal -> hdf5_name ) { ref_id = H5Dopen ( fid , matvar -> internal -> hdf5_name , H5P_DEFAULT ) ; if ( ref_id == H5I_INVALID_HID ) { Mat_Critical ( "Unexpected error from H5Dopen" ) ; } } else { ref_id = matvar -> internal -> id ; H5Iinc_ref ( ref_id ) ; } if ( 0 < matvar -> internal -> hdf5_ref ) { dset_id = H5RDEREFERENCE ( ref_id , H5R_OBJECT , & matvar -> internal -> hdf5_ref ) ; } else { dset_id = ref_id ; H5Iinc_ref ( dset_id ) ; } dset_space = H5Dget_space ( dset_id ) ; H5Sselect_hyperslab ( dset_space , H5S_SELECT_SET , dset_start , dset_stride , dset_edge , NULL ) ; err = Mat_H5ReadData ( dset_id , ClassType2H5T ( matvar -> class_type ) , mem_space , dset_space , matvar -> isComplex , data ) ; H5Sclose ( dset_space ) ; H5Dclose ( dset_id ) ; H5Dclose ( ref_id ) ; break ; default : err = MATIO_E_FAIL_TO_IDENTIFY ; break ; } H5Sclose ( mem_space ) ; return err ; } 