static int st_thermal_get_temp ( struct thermal_zone_device * th , int * temperature ) { struct st_thermal_sensor * sensor = th -> devdata ; struct device * dev = sensor -> dev ; unsigned int temp ; unsigned int overflow ; int ret ; ret = regmap_field_read ( sensor -> overflow , & overflow ) ; if ( overflow ) { return - EIO ; } ret = regmap_field_read ( sensor -> temp_data , & temp ) ; if ( ret ) { return ret ; } temp += sensor -> cdata -> temp_adjust_val ; temp = mcelsius ( temp ) ; dev_dbg ( dev , "temperature: %d\n" , temp ) ; * temperature = temp ; return 0 ; } 