static void dset ( Char * ) struct directory dhead ; struct directory * dcwd ; int printd ; static int dirflag = 0 ; void dinit ( Char * hp ) { char * tcp ; Char * cp = NULL ; struct directory * dp ; char path [ PATH_MAX ] ; static const char emsg [ ] "csh: Trying to start from \"%s\"\n" ; ; tcp = getcwd ( path , PATH_MAX ) ; if ( tcp == NULL || * tcp == '\0' ) { ( void ) fprintf ( csherr , "csh: %s\n" , strerror ( errno ) ) ; if ( hp && * hp ) { tcp = short2str ( hp ) ; if ( chdir ( tcp ) == 0 ) { cp = hp ; } ( void ) fprintf ( csherr , emsg , vis_str ( hp ) ) ; } } else { struct stat swd , shp ; if ( stat ( tcp , & swd ) == - 1 ) { ( void ) fprintf ( csherr , "csh: %s: %s\n" , tcp , strerror ( errno ) ) ; } else { if ( hp && * hp && stat ( short2str ( hp ) , & shp ) != - 1 && swd . st_dev == shp . st_dev && swd . st_ino == shp . st_ino ) { cp = hp ; } else { char * cwd ; if ( ( cwd = getenv ( "PWD" ) ) != NULL ) { if ( stat ( cwd , & shp ) != - 1 && swd . st_dev == shp . st_dev && swd . st_ino == shp . st_ino ) { tcp = cwd ; } } cp = dcanon ( SAVE ( tcp ) , STRNULL ) ; } } } if ( cp == NULL ) { ( void ) fprintf ( csherr , emsg , "/" ) ; if ( chdir ( "/" ) == - 1 ) { xexit ( 1 ) ; } cp = SAVE ( "/" ) ; } dp = xcalloc ( 1 , sizeof ( directory ) ) ; dp -> di_name = Strsave ( cp ) ; dhead . di_next = dhead . di_prev = dp ; dp -> di_next = dp -> di_prev = & dhead ; printd = 0 ; dnewcwd ( dp ) ; } 