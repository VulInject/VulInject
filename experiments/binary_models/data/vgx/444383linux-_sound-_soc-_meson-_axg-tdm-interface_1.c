static int axg_tdm_iface_probe ( struct platform_device * pdev ) { struct device * dev = & pdev -> dev ; struct snd_soc_dai_driver * dai_drv ; struct axg_tdm_iface * iface ; int ret , i ; iface = devm_kzalloc ( dev , sizeof ( * iface ) , GFP_KERNEL ) ; platform_set_drvdata ( pdev , iface ) ; dai_drv = devm_kcalloc ( dev , ARRAY_SIZE ( axg_tdm_iface_dai_drv ) , sizeof ( * dai_drv ) , GFP_KERNEL ) ; if ( ! dai_drv ) { return - ENOMEM ; } for ( i = 0 ; i < ARRAY_SIZE ( axg_tdm_iface_dai_drv ) ; i ++ ) { memcpy ( & dai_drv [ i ] , & axg_tdm_iface_dai_drv [ i ] , sizeof ( * dai_drv ) ) ; } iface -> sclk = devm_clk_get ( dev , "sclk" ) ; if ( IS_ERR ( iface -> sclk ) ) { return dev_err_probe ( dev , PTR_ERR ( iface -> sclk ) , "failed to get sclk\n" ) ; } iface -> lrclk = devm_clk_get ( dev , "lrclk" ) ; if ( IS_ERR ( iface -> lrclk ) ) { return dev_err_probe ( dev , PTR_ERR ( iface -> lrclk ) , "failed to get lrclk\n" ) ; } iface -> mclk = devm_clk_get ( dev , "mclk" ) ; if ( IS_ERR ( iface -> mclk ) ) { ret = PTR_ERR ( iface -> mclk ) ; if ( ret == - ENOENT ) { iface -> mclk = NULL ; } else { return dev_err_probe ( dev , ret , "failed to get mclk\n" ) ; } } return devm_snd_soc_register_component ( dev , & axg_tdm_iface_component_drv , dai_drv , ARRAY_SIZE ( axg_tdm_iface_dai_drv ) ) ; } 