dump_static_insn_cost ( , , ) FILE * file ; const char * message ; const char * prefix ; { cost { unsigned HOST_WIDE_INT cost ; unsigned int count ; } basic_block bb ; struct cost load , store , regcopy , selfcopy , overall ; memset ( & store , 0 , sizeof ( store ) ) ; memset ( & regcopy , 0 , sizeof ( regcopy ) ) ; memset ( & selfcopy , 0 , sizeof ( selfcopy ) ) ; memset ( & overall , 0 , sizeof ( overall ) ) ; if ( ! file ) { return ; } FOR_EACH_BB ( ) { unsigned HOST_WIDE_INT block_cost = bb -> frequency ; rtx insn , set ; for ( insn = bb -> head ; insn ; insn = NEXT_INSN ( insn ) ) { if ( INSN_P ( insn ) && ( ( set = single_set ( insn ) ) != NULL ) ) { rtx src = SET_SRC ( set ) ; rtx dest = SET_DEST ( set ) ; struct cost * pcost = NULL ; overall . cost += block_cost ; overall . count ++ ; if ( rtx_equal_p ( src , dest ) ) { pcost = & selfcopy ; } if ( GET_CODE ( src ) == GET_CODE ( dest ) && ( ( GET_CODE ( src ) == REG ) || ( GET_CODE ( src ) == SUBREG && GET_CODE ( SUBREG_REG ( src ) ) == REG && GET_CODE ( SUBREG_REG ( dest ) ) == REG ) ) ) { pcost = & regcopy ; } else { if ( GET_CODE ( src ) == SUBREG ) { src = SUBREG_REG ( src ) ; } if ( GET_CODE ( dest ) == SUBREG ) { dest = SUBREG_REG ( dest ) ; } if ( GET_CODE ( src ) == MEM && GET_CODE ( dest ) != MEM && memref_is_stack_slot ( src ) ) { pcost = & load ; } if ( GET_CODE ( src ) != MEM && GET_CODE ( dest ) == MEM && memref_is_stack_slot ( dest ) ) { pcost = & store ; } } if ( pcost ) { pcost -> cost += block_cost ; pcost -> count ++ ; } } if ( insn == bb -> end ) { break ; } } } if ( ! prefix ) { prefix = "" ; } fprintf ( file , "static insn cost %s\n" , message ?message : "" ) ; fprintf ( file , "  %soverall:\tnum=%6d\tcost=" , prefix , overall . count ) ; fprintf ( file , HOST_WIDE_INT_PRINT_DEC_SPACE , 8 , overall . cost ) ; fprintf ( file , "\n" ) ; fprintf ( file , "  %sloads:\tnum=%6d\tcost=" , prefix , load . count ) ; fprintf ( file , HOST_WIDE_INT_PRINT_DEC_SPACE , 8 , load . cost ) ; fprintf ( file , "\n" ) ; fprintf ( file , "  %sstores:\tnum=%6d\tcost=" , prefix , store . count ) ; fprintf ( file , HOST_WIDE_INT_PRINT_DEC_SPACE , 8 , store . cost ) ; fprintf ( file , "\n" ) ; fprintf ( file , "  %sregcopy:\tnum=%6d\tcost=" , prefix , regcopy . count ) ; fprintf ( file , HOST_WIDE_INT_PRINT_DEC_SPACE , 8 , regcopy . cost ) ; fprintf ( file , "\n" ) ; fprintf ( file , "  %sselfcpy:\tnum=%6d\tcost=" , prefix , selfcopy . count ) ; fprintf ( file , HOST_WIDE_INT_PRINT_DEC_SPACE , 8 , selfcopy . cost ) ; fprintf ( file , "\n" ) ; } 