struct device * nand_ecc_get_engine_dev ( struct device * host ) { struct platform_device * ecc_pdev ; struct device_node * np ; np = of_parse_phandle ( host -> of_node , "nand-ecc-engine" , 0 ) ; if ( ! np ) { return host ; } ecc_pdev = of_find_device_by_node ( np ) ; if ( ! ecc_pdev ) { of_node_put ( np , NULL ) ; return NULL ; } platform_device_put ( ecc_pdev ) ; of_node_put ( np ) ; return & ecc_pdev -> dev ; } 