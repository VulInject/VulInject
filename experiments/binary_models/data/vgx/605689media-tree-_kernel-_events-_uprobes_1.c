static struct uprobe * alloc_uprobe ( struct inode * inode , loff_t offset ) { struct uprobe * uprobe , * cur_uprobe ; uprobe = kmalloc ( sizeof ( uprobe ) , GFP_KERNEL ) ; if ( ! uprobe ) { return NULL ; } uprobe -> inode = igrab ( inode ) ; uprobe -> offset = offset ; init_rwsem ( & uprobe -> register_rwsem ) ; init_rwsem ( & uprobe -> consumer_rwsem ) ; cur_uprobe = insert_uprobe ( uprobe ) ; if ( cur_uprobe ) { kfree ( uprobe ) ; uprobe = cur_uprobe ; iput ( inode ) ; } return uprobe ; } 