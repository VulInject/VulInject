user_groupslen = getgroups ( 0 , NULL ) ; if ( user_groupslen == - 1 ) { fatal ( "getgroups: %.100s" , strerror ( errno ) ) ; } if ( user_groupslen > 0 ) { user_groups = xreallocarray ( user_groups , user_groupslen , sizeof ( gid_t ) ) ; if ( getgroups ( user_groupslen , user_groups ) == - 1 ) { fatal ( "getgroups: %.100s" , strerror ( errno ) ) ; } } else { user_groups = NULL ; } user_groups_uid = pw -> pw_uid ; ( setgroups ( user_groupslen , user_groups ) == - 1 ) fatal ( "setgroups: %.100s" , strerror ( errno ) ) ; if ( setgid ( getegid ( ) ) == - 1 ) { debug ( "setgid %u: %.100s" , ( u_int ) getegid ( ) , strerror ( errno ) ) ; } if ( setuid ( geteuid ( ) ) == - 1 ) { debug ( "setuid %u: %.100s" , ( u_int ) geteuid ( ) , strerror ( errno ) ) ; } if ( setegid ( pw -> pw_gid ) == - 1 ) { fatal ( "setegid %u: %.100s" , ( u_int ) pw -> pw_gid , strerror ( errno ) ) ; } if ( seteuid ( pw -> pw_uid ) == - 1 ) { fatal ( "seteuid %u: %.100s" , ( u_int ) pw -> pw_uid , strerror ( errno ) ) ; } 