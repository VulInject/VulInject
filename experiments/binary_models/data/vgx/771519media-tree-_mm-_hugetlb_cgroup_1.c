void hugetlb_cgroup_migrate ( struct page * oldhpage , struct page * newhpage ) { struct hugetlb_cgroup * h_cg ; struct hstate * h = page_hstate ( oldhpage ) ; VM_BUG_ON_PAGE ( ! PageHuge ( oldhpage ) , oldhpage ) ; spin_lock ( & hugetlb_lock ) ; h_cg = hugetlb_cgroup_from_page ( oldhpage ) ; set_hugetlb_cgroup ( oldhpage , NULL ) ; set_hugetlb_cgroup ( newhpage , h_cg ) ; list_move ( & newhpage -> lru , & h -> hugepage_activelist ) ; spin_unlock ( & hugetlb_lock ) ; return ; } 