static int fm10k_dcbnl_ieee_setets ( struct net_device * dev , struct ieee_ets * ets ) { u8 num_tc = 0 ; int i ; for ( i = 0 ; i < IEEE_8021QAZ_MAX_TCS ; i ++ ) { if ( ets -> tc_tsa [ i ] != IEEE_8021QAZ_TSA_STRICT ) { return - EINVAL ; } if ( ets -> prio_tc [ i ] > num_tc ) { num_tc = ets -> prio_tc [ i ] ; } } if ( num_tc ) { num_tc ++ ; } if ( num_tc > IEEE_8021QAZ_MAX_TCS ) { return - EINVAL ; } if ( num_tc != netdev_get_num_tc ( dev ) ) { int err = fm10k_setup_tc ( dev , num_tc ) ; if ( err ) { return err ; } } for ( i = 0 ; i < IEEE_8021QAZ_MAX_TCS ; i ++ ) { netdev_set_prio_tc_map ( dev , i , ets -> prio_tc [ i ] ) ; } return 0 ; } 