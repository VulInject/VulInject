static void acpi_processor_hotplug_notify ( acpi_handle handle , u32 event , void * data ) { struct acpi_processor * pr ; struct acpi_device * device = NULL ; u32 ost_code = ACPI_OST_SC_NON_SPECIFIC_FAILURE ; int result ; acpi_scan_lock_acquire ( ) ; switch ( event ) { case ACPI_NOTIFY_BUS_CHECK : case ACPI_NOTIFY_DEVICE_CHECK : ACPI_DEBUG_PRINT ( ( ACPI_DB_INFO , "Processor driver received %s event\n" , ( event == ACPI_NOTIFY_BUS_CHECK ) ?"ACPI_NOTIFY_BUS_CHECK" : "ACPI_NOTIFY_DEVICE_CHECK" ) ) ; if ( ! is_processor_present ( handle ) ) { break ; } acpi_bus_get_device ( handle , & device ) ; if ( acpi_device_enumerated ( device ) ) { break ; } result = acpi_bus_scan ( handle ) ; if ( result ) { pr_err ( PREFIX "Unable to add the device\n" ) ; break ; } acpi_bus_get_device ( handle , & device ) ; if ( ! acpi_device_enumerated ( device ) ) { pr_err ( PREFIX "Missing device object\n" ) ; break ; } ost_code = ACPI_OST_SC_SUCCESS ; break ; case ACPI_NOTIFY_EJECT_REQUEST : ACPI_DEBUG_PRINT ( ( ACPI_DB_INFO , "received ACPI_NOTIFY_EJECT_REQUEST\n" ) ) ; if ( acpi_bus_get_device ( handle , & device ) ) { pr_err ( PREFIX "Device don't exist, dropping EJECT\n" ) ; break ; } pr = acpi_driver_data ( device ) ; if ( ! pr ) { pr_err ( PREFIX "Driver data is NULL, dropping EJECT\n" ) ; break ; } acpi_processor_device_remove ( device ) ; break ; default : ACPI_DEBUG_PRINT ( ( ACPI_DB_INFO , "Unsupported event [0x%x]\n" , event ) ) ; out } ( void ) acpi_evaluate_ost ( handle , event , ost_code , NULL ) ; out acpi_scan_lock_release ( ) ; } 