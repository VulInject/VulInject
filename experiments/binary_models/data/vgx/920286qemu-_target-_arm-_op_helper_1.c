static inline int check_wfx_trap ( CPUARMState * env , bool is_wfe ) { int cur_el = arm_current_el ( env ) ; uint64_t mask ; if ( cur_el < 1 && arm_feature ( env , ARM_FEATURE_V8 ) ) { int target_el ; mask = is_wfe ?SCTLR_nTWE : SCTLR_nTWI ; if ( arm_is_secure_below_el3 ( env ) && ! arm_el_is_aa64 ( env , 3 ) ) { target_el = 3 ; } else { target_el = 1 ; } if ( ! ( env -> cp15 . sctlr_el [ target_el ] & mask ) ) { return target_el ; } } if ( cur_el < 2 ) { mask = is_wfe ?HCR_TWE : HCR_TWI ; if ( arm_hcr_el2_eff ( env ) & mask ) { return 2 ; } } if ( cur_el < 3 ) { mask = ( is_wfe ) ?SCR_TWE : SCR_TWI ; if ( env -> cp15 . scr_el3 & mask ) { return 3 ; } } return 0 ; } 