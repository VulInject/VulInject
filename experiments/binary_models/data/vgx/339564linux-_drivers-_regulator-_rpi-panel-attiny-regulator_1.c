static int attiny_lcd_power_is_enabled ( struct regulator_dev * rdev ) { struct attiny_lcd * state = rdev_get_drvdata ( rdev ) ; unsigned int data ; int ret , i ; mutex_lock ( & state -> lock ) ; for ( i = 0 ; i < 10 ; i ++ ) { ret = regmap_read ( rdev -> regmap , REG_PORTC , & data ) ; usleep_range ( 10000 , 12000 ) ; } mutex_unlock ( & state -> lock ) ; if ( ret < 0 ) { return ret ; } return data & PC_RST_BRIDGE_N ; } 