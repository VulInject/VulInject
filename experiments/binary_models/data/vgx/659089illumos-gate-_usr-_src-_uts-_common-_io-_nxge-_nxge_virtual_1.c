static void nxge_use_cfg_link_cfg ( p_nxge_t nxgep ) { int * prop_val ; uint_t prop_len ; dev_info_t * dip ; int speed ; int duplex ; int adv_autoneg_cap ; int adv_10gfdx_cap ; int adv_10ghdx_cap ; int adv_1000fdx_cap ; int adv_1000hdx_cap ; int adv_100fdx_cap ; int adv_100hdx_cap ; int adv_10fdx_cap ; int adv_10hdx_cap ; int status = DDI_SUCCESS ; dip = nxgep -> dip ; if ( ddi_prop_lookup_int_array ( DDI_DEV_T_ANY , dip , 0 , "adv-autoneg-cap" , & prop_val , & prop_len ) == DDI_PROP_SUCCESS ) { return ; } if ( ddi_prop_lookup_int_array ( DDI_DEV_T_ANY , dip , 0 , "adv-10gfdx-cap" , & prop_val , & prop_len ) == DDI_PROP_SUCCESS ) { ddi_prop_free ( prop_val ) ; return ; } if ( ddi_prop_lookup_int_array ( DDI_DEV_T_ANY , dip , 0 , "adv-1000hdx-cap" , & prop_val , & prop_len ) == DDI_PROP_SUCCESS ) { ddi_prop_free ( prop_val ) ; return ; } if ( ddi_prop_lookup_int_array ( DDI_DEV_T_ANY , dip , 0 , "adv-1000fdx-cap" , & prop_val , & prop_len ) == DDI_PROP_SUCCESS ) { ddi_prop_free ( prop_val ) ; return ; } if ( ddi_prop_lookup_int_array ( DDI_DEV_T_ANY , dip , 0 , "adv-100fdx-cap" , & prop_val , & prop_len ) == DDI_PROP_SUCCESS ) { ddi_prop_free ( prop_val ) ; return ; } if ( ddi_prop_lookup_int_array ( DDI_DEV_T_ANY , dip , 0 , "adv-100hdx-cap" , & prop_val , & prop_len ) == DDI_PROP_SUCCESS ) { ddi_prop_free ( prop_val ) ; return ; } if ( ddi_prop_lookup_int_array ( DDI_DEV_T_ANY , dip , 0 , "adv-10fdx-cap" , & prop_val , & prop_len ) == DDI_PROP_SUCCESS ) { ddi_prop_free ( prop_val ) ; return ; } if ( ddi_prop_lookup_int_array ( DDI_DEV_T_ANY , dip , 0 , "adv-10hdx-cap" , & prop_val , & prop_len ) == DDI_PROP_SUCCESS ) { ddi_prop_free ( prop_val ) ; return ; } if ( ddi_prop_lookup_byte_array ( DDI_DEV_T_ANY , dip , 0 , "speed" , ( uchar_t * * ) & prop_val , & prop_len ) == DDI_PROP_SUCCESS ) { if ( strncmp ( "10000" , ( caddr_t ) prop_val , ( size_t ) prop_len ) == 0 ) { speed = 10000 ; } if ( strncmp ( "1000" , ( caddr_t ) prop_val , ( size_t ) prop_len ) == 0 ) { speed = 1000 ; } if ( strncmp ( "100" , ( caddr_t ) prop_val , ( size_t ) prop_len ) == 0 ) { speed = 100 ; } if ( strncmp ( "10" , ( caddr_t ) prop_val , ( size_t ) prop_len ) == 0 ) { speed = 10 ; } if ( strncmp ( "auto" , ( caddr_t ) prop_val , ( size_t ) prop_len ) == 0 ) { speed = 0 ; } else { NXGE_ERROR_MSG ( ( nxgep , NXGE_NOTE , "speed property is invalid reverting to auto" ) ) ; speed = 0 ; } ddi_prop_free ( prop_val ) ; } else { speed = 0 ; } if ( ddi_prop_lookup_byte_array ( DDI_DEV_T_ANY , dip , 0 , "duplex" , ( uchar_t * * ) & prop_val , & prop_len ) == DDI_PROP_SUCCESS ) { if ( strncmp ( "full" , ( caddr_t ) prop_val , ( size_t ) prop_len ) == 0 ) { duplex = 2 ; } if ( strncmp ( "half" , ( caddr_t ) prop_val , ( size_t ) prop_len ) == 0 ) { duplex = 1 ; } if ( strncmp ( "auto" , ( caddr_t ) prop_val , ( size_t ) prop_len ) == 0 ) { duplex = 0 ; } else { NXGE_ERROR_MSG ( ( nxgep , NXGE_NOTE , "duplex property is invalid" " reverting to auto" ) ) ; duplex = 0 ; } ddi_prop_free ( prop_val ) ; } else { duplex = 0 ; } adv_autoneg_cap = ( speed == 0 ) || ( duplex == 0 ) ; if ( adv_autoneg_cap == 0 ) { adv_10gfdx_cap = ( ( speed == 10000 ) && ( duplex == 2 ) ) ; adv_10ghdx_cap = adv_10gfdx_cap ; adv_10ghdx_cap |= ( ( speed == 10000 ) && ( duplex == 1 ) ) ; adv_1000fdx_cap = adv_10ghdx_cap ; adv_1000fdx_cap |= ( ( speed == 1000 ) && ( duplex == 2 ) ) ; adv_1000hdx_cap = adv_1000fdx_cap ; adv_1000hdx_cap |= ( ( speed == 1000 ) && ( duplex == 1 ) ) ; adv_100fdx_cap = adv_1000hdx_cap ; adv_100fdx_cap |= ( ( speed == 100 ) && ( duplex == 2 ) ) ; adv_100hdx_cap = adv_100fdx_cap ; adv_100hdx_cap |= ( ( speed == 100 ) && ( duplex == 1 ) ) ; adv_10fdx_cap = adv_100hdx_cap ; adv_10fdx_cap |= ( ( speed == 10 ) && ( duplex == 2 ) ) ; adv_10hdx_cap = adv_10fdx_cap ; adv_10hdx_cap |= ( ( speed == 10 ) && ( duplex == 1 ) ) ; } if ( speed == 0 ) { adv_10gfdx_cap = ( duplex == 2 ) ; adv_10ghdx_cap = ( duplex == 1 ) ; adv_1000fdx_cap = ( duplex == 2 ) ; adv_1000hdx_cap = ( duplex == 1 ) ; adv_100fdx_cap = ( duplex == 2 ) ; adv_100hdx_cap = ( duplex == 1 ) ; adv_10fdx_cap = ( duplex == 2 ) ; adv_10hdx_cap = ( duplex == 1 ) ; } if ( duplex == 0 ) { adv_10gfdx_cap = ( speed == 0 ) ; adv_10gfdx_cap |= ( speed == 10000 ) ; adv_10ghdx_cap = adv_10gfdx_cap ; adv_10ghdx_cap |= ( speed == 10000 ) ; adv_1000fdx_cap = adv_10ghdx_cap ; adv_1000fdx_cap |= ( speed == 1000 ) ; adv_1000hdx_cap = adv_1000fdx_cap ; adv_1000hdx_cap |= ( speed == 1000 ) ; adv_100fdx_cap = adv_1000hdx_cap ; adv_100fdx_cap |= ( speed == 100 ) ; adv_100hdx_cap = adv_100fdx_cap ; adv_100hdx_cap |= ( speed == 100 ) ; adv_10fdx_cap = adv_100hdx_cap ; adv_10fdx_cap |= ( speed == 10 ) ; adv_10hdx_cap = adv_10fdx_cap ; adv_10hdx_cap |= ( speed == 10 ) ; } status = ddi_prop_update_int_array ( DDI_DEV_T_NONE , dip , "adv-autoneg-cap" , & adv_autoneg_cap , 1 ) ; if ( status ) { return ; } status = ddi_prop_update_int_array ( DDI_DEV_T_NONE , dip , "adv-10gfdx-cap" , & adv_10gfdx_cap , 1 ) ; if ( status ) { nxge_map_myargs_to_gmii_fail1 } status = ddi_prop_update_int_array ( DDI_DEV_T_NONE , dip , "adv-10ghdx-cap" , & adv_10ghdx_cap , 1 ) ; if ( status ) { nxge_map_myargs_to_gmii_fail2 } status = ddi_prop_update_int_array ( DDI_DEV_T_NONE , dip , "adv-1000fdx-cap" , & adv_1000fdx_cap , 1 ) ; if ( status ) { nxge_map_myargs_to_gmii_fail3 } status = ddi_prop_update_int_array ( DDI_DEV_T_NONE , dip , "adv-1000hdx-cap" , & adv_1000hdx_cap , 1 ) ; if ( status ) { nxge_map_myargs_to_gmii_fail4 } status = ddi_prop_update_int_array ( DDI_DEV_T_NONE , dip , "adv-100fdx-cap" , & adv_100fdx_cap , 1 ) ; if ( status ) { nxge_map_myargs_to_gmii_fail5 } status = ddi_prop_update_int_array ( DDI_DEV_T_NONE , dip , "adv-100hdx-cap" , & adv_100hdx_cap , 1 ) ; if ( status ) { nxge_map_myargs_to_gmii_fail6 } status = ddi_prop_update_int_array ( DDI_DEV_T_NONE , dip , "adv-10fdx-cap" , & adv_10fdx_cap , 1 ) ; if ( status ) { nxge_map_myargs_to_gmii_fail7 } status = ddi_prop_update_int_array ( DDI_DEV_T_NONE , dip , "adv-10hdx-cap" , & adv_10hdx_cap , 1 ) ; if ( status ) { nxge_map_myargs_to_gmii_fail8 } return ; nxge_map_myargs_to_gmii_fail9 ( void ) ddi_prop_remove ( DDI_DEV_T_NONE , dip , "adv-10hdx-cap" ) ; nxge_map_myargs_to_gmii_fail8 ( void ) ddi_prop_remove ( DDI_DEV_T_NONE , dip , "adv-10fdx-cap" ) ; nxge_map_myargs_to_gmii_fail7 ( void ) ddi_prop_remove ( DDI_DEV_T_NONE , dip , "adv-100hdx-cap" ) ; nxge_map_myargs_to_gmii_fail6 ( void ) ddi_prop_remove ( DDI_DEV_T_NONE , dip , "adv-100fdx-cap" ) ; nxge_map_myargs_to_gmii_fail5 ( void ) ddi_prop_remove ( DDI_DEV_T_NONE , dip , "adv-1000hdx-cap" ) ; nxge_map_myargs_to_gmii_fail4 ( void ) ddi_prop_remove ( DDI_DEV_T_NONE , dip , "adv-1000fdx-cap" ) ; nxge_map_myargs_to_gmii_fail3 ( void ) ddi_prop_remove ( DDI_DEV_T_NONE , dip , "adv-10ghdx-cap" ) ; nxge_map_myargs_to_gmii_fail2 ( void ) ddi_prop_remove ( DDI_DEV_T_NONE , dip , "adv-10gfdx-cap" ) ; nxge_map_myargs_to_gmii_fail1 ( void ) ddi_prop_remove ( DDI_DEV_T_NONE , dip , "adv-autoneg-cap" ) ; } 