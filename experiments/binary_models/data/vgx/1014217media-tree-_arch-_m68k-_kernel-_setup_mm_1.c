int m68k_realnum_memory ; EXPORT_SYMBOL ( m68k_realnum_memory ) ; unsigned long m68k_memoffset ; struct m68k_mem_info m68k_memory [ NUM_MEMINFO ] ; EXPORT_SYMBOL ( m68k_memory ) ; static struct m68k_mem_info m68k_ramdisk __initdata ; static char m68k_command_line [ CL_SIZE ] __initdata ; void * mach_sched_init ( irq_handler_t handler ) __initdata = NULL void * mach_init_IRQ ( void ) __initdata = NULL void * mach_get_model ( char * model ) void * mach_get_hardware_list ( struct seq_file * m ) int * mach_hwclk ( int , struct rtc_time * ) EXPORT_SYMBOL ( mach_hwclk ) ; int * mach_set_clock_mmss ( unsigned long ) unsigned int * mach_get_ss ( void ) int * mach_get_rtc_pll ( struct rtc_pll_info * ) int * mach_set_rtc_pll ( struct rtc_pll_info * ) EXPORT_SYMBOL ( mach_get_ss ) ; EXPORT_SYMBOL ( mach_get_rtc_pll , NULL ) ; EXPORT_SYMBOL ( mach_set_rtc_pll ) ; void * mach_reset ( void ) void * mach_halt ( void ) void * mach_power_off ( void ) long mach_max_dma_address = 0x00ffffff ; void * mach_heartbeat ( int ) EXPORT_SYMBOL ( mach_heartbeat ) ; void * mach_l2_flush ( int ) void * mach_beep ( unsigned int , unsigned int ) EXPORT_SYMBOL ( mach_beep ) ; int isa_type ; int isa_sex ; EXPORT_SYMBOL ( isa_type ) ; EXPORT_SYMBOL ( isa_sex ) ; extern int amiga_parse_bootinfo ( const struct bi_record * ) extern int atari_parse_bootinfo ( const struct bi_record * ) extern int mac_parse_bootinfo ( const struct bi_record * ) extern int q40_parse_bootinfo ( const struct bi_record * ) extern int bvme6000_parse_bootinfo ( const struct bi_record * ) extern int mvme16x_parse_bootinfo ( const struct bi_record * ) extern int mvme147_parse_bootinfo ( const struct bi_record * ) extern int hp300_parse_bootinfo ( const struct bi_record * ) extern int apollo_parse_bootinfo ( const struct bi_record * ) extern void config_amiga ( void ) extern void config_atari ( void ) extern void config_mac ( void ) extern void config_sun3 ( void ) extern void config_apollo ( void ) extern void config_mvme147 ( void ) extern void config_mvme16x ( void ) extern void config_bvme6000 ( void ) extern void config_hp300 ( void ) extern void config_q40 ( void ) extern void config_sun3x ( void ) extern void paging_init ( void ) static void __init m68k_parse_bootinfo ( const struct bi_record * record ) { uint16_t tag ; save_bootinfo ( record ) ; while ( ( tag = be16_to_cpu ( record -> tag ) ) != BI_LAST ) { int unknown = 0 ; const void * data = record -> data ; uint16_t size = be16_to_cpu ( record -> size ) ; switch ( tag ) { case BI_MACHTYPE : case BI_CPUTYPE : case BI_FPUTYPE : case BI_MMUTYPE : break ; case BI_MEMCHUNK : if ( m68k_num_memory < NUM_MEMINFO ) { const struct mem_info * m = data ; m68k_memory [ m68k_num_memory ] . addr = be32_to_cpu ( m -> addr ) ; m68k_memory [ m68k_num_memory ] . size = be32_to_cpu ( m -> size ) ; m68k_num_memory ++ ; } else { pr_warn ( "%s: too many memory chunks\n" , __func__ ) ; } break ; case BI_RAMDISK : { const struct mem_info * m = data ; m68k_ramdisk . addr = be32_to_cpu ( m -> addr ) ; m68k_ramdisk . size = be32_to_cpu ( m -> size ) ; } break ; case BI_COMMAND_LINE : strlcpy ( m68k_command_line , data , sizeof ( m68k_command_line ) ) ; break ; default : if ( MACH_IS_AMIGA ) { unknown = amiga_parse_bootinfo ( record ) ; } if ( MACH_IS_ATARI ) { unknown = atari_parse_bootinfo ( record ) ; } if ( MACH_IS_MAC ) { unknown = mac_parse_bootinfo ( record ) ; } if ( MACH_IS_Q40 ) { unknown = q40_parse_bootinfo ( record ) ; } if ( MACH_IS_BVME6000 ) { unknown = bvme6000_parse_bootinfo ( record ) ; } if ( MACH_IS_MVME16x ) { unknown = mvme16x_parse_bootinfo ( record ) ; } if ( MACH_IS_MVME147 ) { unknown = mvme147_parse_bootinfo ( record ) ; } if ( MACH_IS_HP300 ) { unknown = hp300_parse_bootinfo ( record ) ; } if ( MACH_IS_APOLLO ) { unknown = apollo_parse_bootinfo ( record ) ; } else { unknown = 1 ; } } if ( unknown ) { pr_warn ( "%s: unknown tag 0x%04x ignored\n" , __func__ , tag ) ; } record = ( bi_record * ) ( ( unsigned long ) record + size ) ; } m68k_realnum_memory = m68k_num_memory ; if ( m68k_num_memory > 1 ) { pr_warn ( "%s: ignoring last %i chunks of physical memory\n" , __func__ , ( m68k_num_memory - 1 ) ) ; m68k_num_memory = 1 ; } } 