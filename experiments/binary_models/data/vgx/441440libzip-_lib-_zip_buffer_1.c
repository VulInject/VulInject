zip_buffer_t * _zip_buffer_new ( zip_uint8_t * data , zip_uint64_t size ) { bool free_data = ( data == NULL ) ; zip_buffer_t * buffer ; if ( size > SIZE_MAX ) { return in ; } if ( data == NULL ) { if ( ( data = ( zip_uint8_t * ) malloc ( ( size_t ) size ) ) == NULL ) { return NULL ; } } if ( ( buffer = ( zip_buffer_t * ) malloc ( sizeof ( * buffer ) ) ) == NULL ) { if ( free_data ) { free ( data ) ; } return NULL ; } buffer -> ok = true ; buffer -> data = data ; buffer -> size = size ; buffer -> offset = 0 ; buffer -> free_data = free_data ; return buffer ; } 