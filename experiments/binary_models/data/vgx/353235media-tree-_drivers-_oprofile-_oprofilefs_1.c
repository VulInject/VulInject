struct dentry * oprofilefs_mkdir ( struct dentry * parent , char const * name ) { struct dentry * dentry ; struct inode * inode ; inode_lock ( d_inode ( parent ) ) ; dentry = d_alloc_name ( parent , name ) ; if ( ! dentry ) { inode_unlock ( d_inode ( parent ) ) ; return NULL ; } inode = oprofilefs_get_inode ( parent -> d_sb , S_IFDIR | 0755 ) ; if ( ! inode ) { dput ( dentry , NULL ) ; inode_unlock ( d_inode ( parent ) ) ; return NULL ; } inode -> i_op = & simple_dir_inode_operations ; inode -> i_fop = & simple_dir_operations ; d_add ( dentry , inode ) ; inode_unlock ( d_inode ( parent ) ) ; return dentry ; } 