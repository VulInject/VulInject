UINT msi_format_field ( _In_ MSIHANDLE hInstall , _In_ MSIHANDLE hRecord , _In_ unsigned int iField , _Out_ LPTSTR * pszValue ) { if ( pszValue == NULL ) { return ERROR_BAD_ARGUMENTS ; } LPTSTR szValue = NULL ; UINT uiResult = msi_get_record_string ( hRecord , iField , & szValue ) ; if ( uiResult != ERROR_SUCCESS ) { return uiResult ; } if ( szValue [ 0 ] == 0 ) { * pszValue = szValue ; return ERROR_SUCCESS ; } MSIHANDLE hRecordEx = MsiCreateRecord ( 1 ) ; if ( ! hRecordEx ) { uiResult = ERROR_INVALID_HANDLE ; msg ( M_NONFATAL , "%s: MsiCreateRecord failed" , __FUNCTION__ ) ; cleanup_szValue } uiResult = MsiRecordSetString ( hRecordEx , 0 , szValue ) ; if ( uiResult != ERROR_SUCCESS ) { SetLastError ( uiResult ) ; msg ( M_NONFATAL | M_ERRNO , "%s: MsiRecordSetString failed" , __FUNCTION__ ) ; cleanup_hRecordEx } uiResult = msi_format_record ( hInstall , hRecordEx , pszValue ) ; cleanup_hRecordEx MsiCloseHandle ( hRecordEx ) ; cleanup_szValue return uiResult ; } 