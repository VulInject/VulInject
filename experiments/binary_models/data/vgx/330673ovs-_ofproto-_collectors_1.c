int collectors_create ( const struct sset * targets , int default_port , struct collectors * * collectorsp ) { struct collectors * c ; const char * name ; int retval = 0 ; c = xmalloc ( sizeof c ) ; c -> fds = xmalloc ( sizeof c -> fds * sset_count ( targets ) ) ; c -> n_fds = 0 ; SSET_FOR_EACH ( , ) { int error ; int fd ; error = inet_open_active ( SOCK_DGRAM , name , default_port , NULL , & fd , 0 ) ; if ( fd >= 0 ) { c -> fds [ c -> n_fds ++ ] = fd ; } else { static struct vlog_rate_limit rl = VLOG_RATE_LIMIT_INIT ( 1 , 5 ) ; VLOG_WARN_RL ( & rl , "couldn't open connection to collector %s (%s)" , name , ovs_strerror ( error ) ) ; if ( ! retval ) { retval = error ; } } } if ( c -> n_fds ) { * collectorsp = c ; } else { * collectorsp = NULL ; } return retval ; } 