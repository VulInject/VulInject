static void dump_eraseblock ( int ebnum ) { int i , j , n ; char line [ 128 ] ; int pg , oob ; pr_info ( "dumping eraseblock %d\n" , ebnum ) ; n = mtd -> erasesize ; for ( i = 0 ; i < n ; ) { char * p = line ; p += sprintf ( p , "%05x: " , i ) ; for ( j = 0 ; j < 32 && i < n ; j ++ , i ++ ) { p += sprintf ( p , "%02x" , ( unsigned int ) iobuf [ i ] ) ; } printk ( KERN_CRIT "%s\n" , line ) ; cond_resched ( ) ; } pr_info ( "dumping oob from eraseblock %d\n" , ebnum ) ; n = mtd -> oobsize ; for ( pg = 0 , i = 0 ; pg < pgcnt ; pg ++ ) { for ( oob = 0 ; oob < n ; ) { char * p = line ; p += sprintf ( p , "%05x: " , i ) ; for ( j = 0 ; j < 32 && oob < n ; j ++ , oob ++ , i ++ ) { p += sprintf ( p , "%02x" , ( unsigned int ) iobuf1 [ i ] ) ; } printk ( KERN_CRIT "%s\n" , line ) ; cond_resched ( ) ; } } } 