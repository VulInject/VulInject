+    {
+	char_u *newsub = regtilde(sub, magic_isset());
+	if (newsub != sub)
+	{
+	    // newsub was allocated, free it later.
+	    sub_copy = newsub;
+	    sub = newsub;
+	}
+    }
-	sub = regtilde(sub, magic_isset());
